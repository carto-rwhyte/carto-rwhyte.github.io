var h6=Object.defineProperty;var u6=(s,e,t)=>e in s?h6(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var u=(s,e,t)=>(u6(s,typeof e!="symbol"?e+"":e,t),t),h1=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var wt=(s,e,t)=>(h1(s,e,"read from private field"),t?t.call(s):e.get(s)),ls=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},cs=(s,e,t,i)=>(h1(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t);var lf=(s,e,t)=>(h1(s,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();const d6="modulepreload",f6=function(s,e){return new URL(s,e).href},C2={},jc=function(e,t,i){if(!t||t.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map(r=>{if(r=f6(r,i),r in C2)return;C2[r]=!0;const o=r.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let h=n.length-1;h>=0;h--){const d=n[h];if(d.href===r&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":d6,o||(c.as="script",c.crossOrigin=""),c.href=r,document.head.appendChild(c),o)return new Promise((h,d)=>{c.addEventListener("load",h),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>e())};jc(()=>import("./needle-asap-bdfb2296.js"),[],import.meta.url);/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Wc="162",Lf={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},kf={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},$N=0,sI=1,ez=2,p6=3,m6=0,CP=1,EP=2,sc=3,As=0,Gn=1,Pi=2,An=0,pd=1,Ed=2,rI=3,oI=4,TP=5,sd=100,tz=101,iz=102,aI=103,Lw=104,nz=200,sz=201,rz=202,oz=203,kw=204,Fw=205,az=206,lz=207,cz=208,hz=209,uz=210,dz=211,fz=212,pz=213,mz=214,MP=0,hC=1,qA=2,Tp=3,Hg=4,uC=5,dC=6,Q0=7,j0=0,gz=1,vz=2,_o=0,uv=1,W0=2,yz=3,q0=4,Az=5,dv=6,Mp=7,lI="attached",_z="detached",fC=300,uu=301,Td=302,bo=303,Vg=304,fv=306,wo=1e3,ps=1001,du=1002,ei=1003,Qg=1004,g6=1004,zh=1005,v6=1005,Nt=1006,cp=1007,y6=1007,go=1008,A6=1008,Ri=1009,bz=1010,xz=1011,pC=1012,IP=1013,El=1014,vn=1015,$i=1016,RP=1017,PP=1018,tu=1020,wz=1021,Ti=1023,mC=1024,Sz=1025,md=1026,Md=1027,Tl=1028,BP=1029,ld=1030,DP=1031,OP=1033,iA=33776,rw=33777,ow=33778,nA=33779,Uw=35840,cI=35841,Nw=35842,hI=35843,gC=36196,zw=37492,Gw=37496,Hw=37808,uI=37809,dI=37810,fI=37811,XA=37812,pI=37813,mI=37814,gI=37815,vI=37816,yI=37817,AI=37818,_I=37819,bI=37820,xI=37821,sA=36492,wI=36494,SI=36495,Cz=36283,CI=36284,EI=36285,TI=36286,YA=2200,LP=2201,Ez=2202,Ip=2300,Id=2301,aw=2302,Zf=2400,$f=2401,KA=2402,vC=2500,kP=2501,Tz=0,FP=1,Vw=2,Mz=3e3,MI=3001,Sr=3200,yC=3201,kd=0,Iz=1,jr="",_t="srgb",Ui="srgb-linear",X0="display-p3",pv="display-p3-linear",JA="linear",on="srgb",ZA="rec709",$A="p3",Rz=0,$u=7680,Pz=7681,Bz=7682,Dz=7683,Oz=34055,Lz=34056,kz=5386,II=512,Fz=513,Uz=514,Nz=515,zz=516,Gz=517,Hz=518,Qw=519,Vz=512,Qz=513,jz=514,UP=515,Wz=516,qz=517,Xz=518,Yz=519,e0=35044,Hr=35048,_6=35040,b6=35045,x6=35049,w6=35041,S6=35046,C6=35050,E6=35042,T6="100",jw="300 es",Ww=1035,Cc=2e3,t0=2001;let Zs=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const n=i.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e);e.target=null}}};const Br=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let E2=1234567;const hp=Math.PI/180,jg=180/Math.PI;function ma(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Br[s&255]+Br[s>>8&255]+Br[s>>16&255]+Br[s>>24&255]+"-"+Br[e&255]+Br[e>>8&255]+"-"+Br[e>>16&15|64]+Br[e>>24&255]+"-"+Br[t&63|128]+Br[t>>8&255]+"-"+Br[t>>16&255]+Br[t>>24&255]+Br[i&255]+Br[i>>8&255]+Br[i>>16&255]+Br[i>>24&255]).toLowerCase()}function Zn(s,e,t){return Math.max(e,Math.min(t,s))}function NP(s,e){return(s%e+e)%e}function M6(s,e,t,i,n){return i+(s-e)*(n-i)/(t-e)}function I6(s,e,t){return s!==e?(t-s)/(e-s):0}function rA(s,e,t){return(1-t)*s+t*e}function R6(s,e,t,i){return rA(s,e,1-Math.exp(-t*i))}function P6(s,e=1){return e-Math.abs(NP(s,e*2)-e)}function B6(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*(3-2*s))}function D6(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*s*(s*(s*6-15)+10))}function O6(s,e){return s+Math.floor(Math.random()*(e-s+1))}function L6(s,e){return s+Math.random()*(e-s)}function k6(s){return s*(.5-Math.random())}function F6(s){s!==void 0&&(E2=s);let e=E2+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function U6(s){return s*hp}function N6(s){return s*jg}function RI(s){return(s&s-1)===0&&s!==0}function z6(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function qw(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function G6(s,e,t,i,n){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+i)/2),h=o((e+i)/2),d=r((e-i)/2),f=o((e-i)/2),p=r((i-e)/2),m=o((i-e)/2);switch(n){case"XYX":s.set(a*h,l*d,l*f,a*c);break;case"YZY":s.set(l*f,a*h,l*d,a*c);break;case"ZXZ":s.set(l*d,l*f,a*h,a*c);break;case"XZX":s.set(a*h,l*m,l*p,a*c);break;case"YXY":s.set(l*p,a*h,l*m,a*c);break;case"ZYZ":s.set(l*m,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function po(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function ni(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const li={DEG2RAD:hp,RAD2DEG:jg,generateUUID:ma,clamp:Zn,euclideanModulo:NP,mapLinear:M6,inverseLerp:I6,lerp:rA,damp:R6,pingpong:P6,smoothstep:B6,smootherstep:D6,randInt:O6,randFloat:L6,randFloatSpread:k6,seededRandom:F6,degToRad:U6,radToDeg:N6,isPowerOfTwo:RI,ceilPowerOfTwo:z6,floorPowerOfTwo:qw,setQuaternionFromProperEuler:G6,normalize:ni,denormalize:po};class Z{constructor(e=0,t=0){Z.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Zn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*n+e.x,this.y=r*n+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ht{constructor(e,t,i,n,r,o,a,l,c){Ht.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,n,r,o,a,l,c)}set(e,t,i,n,r,o,a,l,c){const h=this.elements;return h[0]=e,h[1]=n,h[2]=a,h[3]=t,h[4]=r,h[5]=l,h[6]=i,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],h=i[4],d=i[7],f=i[2],p=i[5],m=i[8],v=n[0],y=n[3],g=n[6],_=n[1],A=n[4],b=n[7],E=n[2],C=n[5],T=n[8];return r[0]=o*v+a*_+l*E,r[3]=o*y+a*A+l*C,r[6]=o*g+a*b+l*T,r[1]=c*v+h*_+d*E,r[4]=c*y+h*A+d*C,r[7]=c*g+h*b+d*T,r[2]=f*v+p*_+m*E,r[5]=f*y+p*A+m*C,r[8]=f*g+p*b+m*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t*o*h-t*a*c-i*r*h+i*a*l+n*r*c-n*o*l}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=h*o-a*c,f=a*l-h*r,p=c*r-o*l,m=t*d+i*f+n*p;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/m;return e[0]=d*v,e[1]=(n*c-h*i)*v,e[2]=(a*i-n*o)*v,e[3]=f*v,e[4]=(h*t-n*l)*v,e[5]=(n*r-a*t)*v,e[6]=p*v,e[7]=(i*l-c*t)*v,e[8]=(o*t-i*r)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-n*c,n*l,-n*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(u1.makeScale(e,t)),this}rotate(e){return this.premultiply(u1.makeRotation(-e)),this}translate(e,t){return this.premultiply(u1.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const u1=new Ht;function Kz(s){for(let e=s.length-1;e>=0;--e)if(s[e]>=65535)return!0;return!1}const H6={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function ng(s,e){return new H6[s](e)}function i0(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}function Jz(){const s=i0("canvas");return s.style.display="block",s}const T2={};function Zz(s){s in T2||(T2[s]=!0,console.warn(s))}const M2=new Ht().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),I2=new Ht().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),ob={[Ui]:{transfer:JA,primaries:ZA,toReference:s=>s,fromReference:s=>s},[_t]:{transfer:on,primaries:ZA,toReference:s=>s.convertSRGBToLinear(),fromReference:s=>s.convertLinearToSRGB()},[pv]:{transfer:JA,primaries:$A,toReference:s=>s.applyMatrix3(I2),fromReference:s=>s.applyMatrix3(M2)},[X0]:{transfer:on,primaries:$A,toReference:s=>s.convertSRGBToLinear().applyMatrix3(I2),fromReference:s=>s.applyMatrix3(M2).convertLinearToSRGB()}},V6=new Set([Ui,pv]),ki={enabled:!0,_workingColorSpace:Ui,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(s){if(!V6.has(s))throw new Error(`Unsupported working color space, "${s}".`);this._workingColorSpace=s},convert:function(s,e,t){if(this.enabled===!1||e===t||!e||!t)return s;const i=ob[e].toReference,n=ob[t].fromReference;return n(i(s))},fromWorkingColorSpace:function(s,e){return this.convert(s,this._workingColorSpace,e)},toWorkingColorSpace:function(s,e){return this.convert(s,e,this._workingColorSpace)},getPrimaries:function(s){return ob[s].primaries},getTransfer:function(s){return s===jr?JA:ob[s].transfer}};function Tg(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function d1(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}let fm;class zP{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{fm===void 0&&(fm=i0("canvas")),fm.width=e.width,fm.height=e.height;const i=fm.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=fm}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=i0("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let o=0;o<r.length;o++)r[o]=Tg(r[o]/255)*255;return i.putImageData(n,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Tg(t[i]/255)*255):t[i]=Tg(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Q6=0;class qh{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Q6++}),this.uuid=ma(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let r;if(Array.isArray(n)){r=[];for(let o=0,a=n.length;o<a;o++)n[o].isDataTexture?r.push(f1(n[o].image)):r.push(f1(n[o]))}else r=f1(n);i.url=r}return t||(e.images[this.uuid]=i),i}}function f1(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?zP.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let j6=0;class Pt extends Zs{constructor(e=Pt.DEFAULT_IMAGE,t=Pt.DEFAULT_MAPPING,i=ps,n=ps,r=Nt,o=go,a=Ti,l=Ri,c=Pt.DEFAULT_ANISOTROPY,h=jr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:j6++}),this.uuid=ma(),this.name="",this.source=new qh(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Z(0,0),this.repeat=new Z(1,1),this.center=new Z(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ht,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==fC)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case wo:e.x=e.x-Math.floor(e.x);break;case ps:e.x=e.x<0?0:1;break;case du:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case wo:e.y=e.y-Math.floor(e.y);break;case ps:e.y=e.y<0?0:1;break;case du:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}Pt.DEFAULT_IMAGE=null;Pt.DEFAULT_MAPPING=fC;Pt.DEFAULT_ANISOTROPY=1;class Je{constructor(e=0,t=0,i=0,n=1){Je.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;const l=e.elements,c=l[0],h=l[4],d=l[8],f=l[1],p=l[5],m=l[9],v=l[2],y=l[6],g=l[10];if(Math.abs(h-f)<.01&&Math.abs(d-v)<.01&&Math.abs(m-y)<.01){if(Math.abs(h+f)<.1&&Math.abs(d+v)<.1&&Math.abs(m+y)<.1&&Math.abs(c+p+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const A=(c+1)/2,b=(p+1)/2,E=(g+1)/2,C=(h+f)/4,T=(d+v)/4,M=(m+y)/4;return A>b&&A>E?A<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(A),n=C/i,r=T/i):b>E?b<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(b),i=C/n,r=M/n):E<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(E),i=T/r,n=M/r),this.set(i,n,r,t),this}let _=Math.sqrt((y-m)*(y-m)+(d-v)*(d-v)+(f-h)*(f-h));return Math.abs(_)<.001&&(_=1),this.x=(y-m)/_,this.y=(d-v)/_,this.z=(f-h)/_,this.w=Math.acos((c+p+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class $z extends Zs{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Je(0,0,e,t),this.scissorTest=!1,this.viewport=new Je(0,0,e,t);const n={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Nt,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},i);const r=new Pt(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);r.flipY=!1,r.generateMipmaps=i.generateMipmaps,r.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=r.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,r=this.textures.length;n<r;n++)this.textures[n].image.width=e,this.textures[n].image.height=t,this.textures[n].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,n=e.textures.length;i<n;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new qh(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Yt extends $z{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class AC extends Pt{constructor(e=null,t=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=ei,this.minFilter=ei,this.wrapR=ps,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class W6 extends Yt{constructor(e=1,t=1,i=1,n={}){super(e,t,n),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new AC(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class _C extends Pt{constructor(e=null,t=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=ei,this.minFilter=ei,this.wrapR=ps,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class q6 extends Yt{constructor(e=1,t=1,i=1,n={}){super(e,t,n),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new _C(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class xe{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,o,a){let l=i[n+0],c=i[n+1],h=i[n+2],d=i[n+3];const f=r[o+0],p=r[o+1],m=r[o+2],v=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d;return}if(a===1){e[t+0]=f,e[t+1]=p,e[t+2]=m,e[t+3]=v;return}if(d!==v||l!==f||c!==p||h!==m){let y=1-a;const g=l*f+c*p+h*m+d*v,_=g>=0?1:-1,A=1-g*g;if(A>Number.EPSILON){const E=Math.sqrt(A),C=Math.atan2(E,g*_);y=Math.sin(y*C)/E,a=Math.sin(a*C)/E}const b=a*_;if(l=l*y+f*b,c=c*y+p*b,h=h*y+m*b,d=d*y+v*b,y===1-a){const E=1/Math.sqrt(l*l+c*c+h*h+d*d);l*=E,c*=E,h*=E,d*=E}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,n,r,o){const a=i[n],l=i[n+1],c=i[n+2],h=i[n+3],d=r[o],f=r[o+1],p=r[o+2],m=r[o+3];return e[t]=a*m+h*d+l*p-c*f,e[t+1]=l*m+h*f+c*d-a*p,e[t+2]=c*m+h*p+a*f-l*d,e[t+3]=h*m-a*d-l*f-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,n=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(n/2),d=a(r/2),f=l(i/2),p=l(n/2),m=l(r/2);switch(o){case"XYZ":this._x=f*h*d+c*p*m,this._y=c*p*d-f*h*m,this._z=c*h*m+f*p*d,this._w=c*h*d-f*p*m;break;case"YXZ":this._x=f*h*d+c*p*m,this._y=c*p*d-f*h*m,this._z=c*h*m-f*p*d,this._w=c*h*d+f*p*m;break;case"ZXY":this._x=f*h*d-c*p*m,this._y=c*p*d+f*h*m,this._z=c*h*m+f*p*d,this._w=c*h*d-f*p*m;break;case"ZYX":this._x=f*h*d-c*p*m,this._y=c*p*d+f*h*m,this._z=c*h*m-f*p*d,this._w=c*h*d+f*p*m;break;case"YZX":this._x=f*h*d+c*p*m,this._y=c*p*d+f*h*m,this._z=c*h*m-f*p*d,this._w=c*h*d-f*p*m;break;case"XZY":this._x=f*h*d-c*p*m,this._y=c*p*d-f*h*m,this._z=c*h*m+f*p*d,this._w=c*h*d+f*p*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],h=t[6],d=t[10],f=i+a+d;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(h-l)*p,this._y=(r-c)*p,this._z=(o-n)*p}else if(i>a&&i>d){const p=2*Math.sqrt(1+i-a-d);this._w=(h-l)/p,this._x=.25*p,this._y=(n+o)/p,this._z=(r+c)/p}else if(a>d){const p=2*Math.sqrt(1+a-i-d);this._w=(r-c)/p,this._x=(n+o)/p,this._y=.25*p,this._z=(l+h)/p}else{const p=2*Math.sqrt(1+d-i-a);this._w=(o-n)/p,this._x=(r+c)/p,this._y=(l+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Zn(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,h=t._w;return this._x=i*h+o*a+n*c-r*l,this._y=n*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-n*a,this._w=o*h-i*a-n*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,n=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+n*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*i+t*this._x,this._y=p*n+t*this._y,this._z=p*r+t*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),d=Math.sin((1-t)*h)/c,f=Math.sin(t*h)/c;return this._w=o*d+this._w*f,this._x=i*d+this._x*f,this._y=n*d+this._y*f,this._z=r*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(n*Math.sin(e),n*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class w{constructor(e=0,t=0,i=0){w.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(R2.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(R2.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*n-a*i),h=2*(a*t-r*n),d=2*(r*i-o*t);return this.x=t+l*c+o*d-a*h,this.y=i+l*h+a*c-r*d,this.z=n+l*d+r*h-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=n*l-r*a,this.y=r*o-i*l,this.z=i*a-n*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return p1.copy(this).projectOnVector(e),this.sub(p1)}reflect(e){return this.sub(p1.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Zn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const p1=new w,R2=new xe;class Si{constructor(e=new w(1/0,1/0,1/0),t=new w(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(rl.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(rl.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=rl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const r=i.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=r.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,rl):rl.fromBufferAttribute(r,o),rl.applyMatrix4(e.matrixWorld),this.expandByPoint(rl);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),ab.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),ab.copy(i.boundingBox)),ab.applyMatrix4(e.matrixWorld),this.union(ab)}const n=e.children;for(let r=0,o=n.length;r<o;r++)this.expandByObject(n[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,rl),rl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(jv),lb.subVectors(this.max,jv),pm.subVectors(e.a,jv),mm.subVectors(e.b,jv),gm.subVectors(e.c,jv),Pu.subVectors(mm,pm),Bu.subVectors(gm,mm),cf.subVectors(pm,gm);let t=[0,-Pu.z,Pu.y,0,-Bu.z,Bu.y,0,-cf.z,cf.y,Pu.z,0,-Pu.x,Bu.z,0,-Bu.x,cf.z,0,-cf.x,-Pu.y,Pu.x,0,-Bu.y,Bu.x,0,-cf.y,cf.x,0];return!m1(t,pm,mm,gm,lb)||(t=[1,0,0,0,1,0,0,0,1],!m1(t,pm,mm,gm,lb))?!1:(cb.crossVectors(Pu,Bu),t=[cb.x,cb.y,cb.z],m1(t,pm,mm,gm,lb))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,rl).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(rl).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(dh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),dh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),dh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),dh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),dh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),dh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),dh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),dh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(dh),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const dh=[new w,new w,new w,new w,new w,new w,new w,new w],rl=new w,ab=new Si,pm=new w,mm=new w,gm=new w,Pu=new w,Bu=new w,cf=new w,jv=new w,lb=new w,cb=new w,hf=new w;function m1(s,e,t,i,n){for(let r=0,o=s.length-3;r<=o;r+=3){hf.fromArray(s,r);const a=n.x*Math.abs(hf.x)+n.y*Math.abs(hf.y)+n.z*Math.abs(hf.z),l=e.dot(hf),c=t.dot(hf),h=i.dot(hf);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}const X6=new Si,Wv=new w,g1=new w;class _n{constructor(e=new w,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):X6.setFromPoints(e).getCenter(i);let n=0;for(let r=0,o=e.length;r<o;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Wv.subVectors(e,this.center);const t=Wv.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),n=(i-this.radius)*.5;this.center.addScaledVector(Wv,n/i),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(g1.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Wv.copy(e.center).add(g1)),this.expandByPoint(Wv.copy(e.center).sub(g1))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const fh=new w,v1=new w,hb=new w,Du=new w,y1=new w,ub=new w,A1=new w;class jo{constructor(e=new w,t=new w(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,fh)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=fh.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(fh.copy(this.origin).addScaledVector(this.direction,t),fh.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){v1.copy(e).add(t).multiplyScalar(.5),hb.copy(t).sub(e).normalize(),Du.copy(this.origin).sub(v1);const r=e.distanceTo(t)*.5,o=-this.direction.dot(hb),a=Du.dot(this.direction),l=-Du.dot(hb),c=Du.lengthSq(),h=Math.abs(1-o*o);let d,f,p,m;if(h>0)if(d=o*l-a,f=o*a-l,m=r*h,d>=0)if(f>=-m)if(f<=m){const v=1/h;d*=v,f*=v,p=d*(d+o*f+2*a)+f*(o*d+f+2*l)+c}else f=r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;else f=-r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;else f<=-m?(d=Math.max(0,-(-o*r+a)),f=d>0?-r:Math.min(Math.max(-r,-l),r),p=-d*d+f*(f+2*l)+c):f<=m?(d=0,f=Math.min(Math.max(-r,-l),r),p=f*(f+2*l)+c):(d=Math.max(0,-(o*r+a)),f=d>0?r:Math.min(Math.max(-r,-l),r),p=-d*d+f*(f+2*l)+c);else f=o>0?-r:r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,d),n&&n.copy(v1).addScaledVector(hb,f),p}intersectSphere(e,t){fh.subVectors(e.center,this.origin);const i=fh.dot(this.direction),n=fh.dot(fh)-i*i,r=e.radius*e.radius;if(n>r)return null;const o=Math.sqrt(r-n),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,d=1/this.direction.z,f=this.origin;return c>=0?(i=(e.min.x-f.x)*c,n=(e.max.x-f.x)*c):(i=(e.max.x-f.x)*c,n=(e.min.x-f.x)*c),h>=0?(r=(e.min.y-f.y)*h,o=(e.max.y-f.y)*h):(r=(e.max.y-f.y)*h,o=(e.min.y-f.y)*h),i>o||r>n||((r>i||isNaN(i))&&(i=r),(o<n||isNaN(n))&&(n=o),d>=0?(a=(e.min.z-f.z)*d,l=(e.max.z-f.z)*d):(a=(e.max.z-f.z)*d,l=(e.min.z-f.z)*d),i>l||a>n)||((a>i||i!==i)&&(i=a),(l<n||n!==n)&&(n=l),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return this.intersectBox(e,fh)!==null}intersectTriangle(e,t,i,n,r){y1.subVectors(t,e),ub.subVectors(i,e),A1.crossVectors(y1,ub);let o=this.direction.dot(A1),a;if(o>0){if(n)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Du.subVectors(this.origin,e);const l=a*this.direction.dot(ub.crossVectors(Du,ub));if(l<0)return null;const c=a*this.direction.dot(y1.cross(Du));if(c<0||l+c>o)return null;const h=-a*Du.dot(A1);return h<0?null:this.at(h/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class fe{constructor(e,t,i,n,r,o,a,l,c,h,d,f,p,m,v,y){fe.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,n,r,o,a,l,c,h,d,f,p,m,v,y)}set(e,t,i,n,r,o,a,l,c,h,d,f,p,m,v,y){const g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=a,g[13]=l,g[2]=c,g[6]=h,g[10]=d,g[14]=f,g[3]=p,g[7]=m,g[11]=v,g[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new fe().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/vm.setFromMatrixColumn(e,0).length(),r=1/vm.setFromMatrixColumn(e,1).length(),o=1/vm.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(n),c=Math.sin(n),h=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){const f=o*h,p=o*d,m=a*h,v=a*d;t[0]=l*h,t[4]=-l*d,t[8]=c,t[1]=p+m*c,t[5]=f-v*c,t[9]=-a*l,t[2]=v-f*c,t[6]=m+p*c,t[10]=o*l}else if(e.order==="YXZ"){const f=l*h,p=l*d,m=c*h,v=c*d;t[0]=f+v*a,t[4]=m*a-p,t[8]=o*c,t[1]=o*d,t[5]=o*h,t[9]=-a,t[2]=p*a-m,t[6]=v+f*a,t[10]=o*l}else if(e.order==="ZXY"){const f=l*h,p=l*d,m=c*h,v=c*d;t[0]=f-v*a,t[4]=-o*d,t[8]=m+p*a,t[1]=p+m*a,t[5]=o*h,t[9]=v-f*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const f=o*h,p=o*d,m=a*h,v=a*d;t[0]=l*h,t[4]=m*c-p,t[8]=f*c+v,t[1]=l*d,t[5]=v*c+f,t[9]=p*c-m,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const f=o*l,p=o*c,m=a*l,v=a*c;t[0]=l*h,t[4]=v-f*d,t[8]=m*d+p,t[1]=d,t[5]=o*h,t[9]=-a*h,t[2]=-c*h,t[6]=p*d+m,t[10]=f-v*d}else if(e.order==="XZY"){const f=o*l,p=o*c,m=a*l,v=a*c;t[0]=l*h,t[4]=-d,t[8]=c*h,t[1]=f*d+v,t[5]=o*h,t[9]=p*d-m,t[2]=m*d-p,t[6]=a*h,t[10]=v*d+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Y6,e,K6)}lookAt(e,t,i){const n=this.elements;return $o.subVectors(e,t),$o.lengthSq()===0&&($o.z=1),$o.normalize(),Ou.crossVectors(i,$o),Ou.lengthSq()===0&&(Math.abs(i.z)===1?$o.x+=1e-4:$o.z+=1e-4,$o.normalize(),Ou.crossVectors(i,$o)),Ou.normalize(),db.crossVectors($o,Ou),n[0]=Ou.x,n[4]=db.x,n[8]=$o.x,n[1]=Ou.y,n[5]=db.y,n[9]=$o.y,n[2]=Ou.z,n[6]=db.z,n[10]=$o.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],h=i[1],d=i[5],f=i[9],p=i[13],m=i[2],v=i[6],y=i[10],g=i[14],_=i[3],A=i[7],b=i[11],E=i[15],C=n[0],T=n[4],M=n[8],R=n[12],S=n[1],I=n[5],L=n[9],U=n[13],D=n[2],V=n[6],O=n[10],F=n[14],N=n[3],q=n[7],$=n[11],oe=n[15];return r[0]=o*C+a*S+l*D+c*N,r[4]=o*T+a*I+l*V+c*q,r[8]=o*M+a*L+l*O+c*$,r[12]=o*R+a*U+l*F+c*oe,r[1]=h*C+d*S+f*D+p*N,r[5]=h*T+d*I+f*V+p*q,r[9]=h*M+d*L+f*O+p*$,r[13]=h*R+d*U+f*F+p*oe,r[2]=m*C+v*S+y*D+g*N,r[6]=m*T+v*I+y*V+g*q,r[10]=m*M+v*L+y*O+g*$,r[14]=m*R+v*U+y*F+g*oe,r[3]=_*C+A*S+b*D+E*N,r[7]=_*T+A*I+b*V+E*q,r[11]=_*M+A*L+b*O+E*$,r[15]=_*R+A*U+b*F+E*oe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],h=e[2],d=e[6],f=e[10],p=e[14],m=e[3],v=e[7],y=e[11],g=e[15];return m*(+r*l*d-n*c*d-r*a*f+i*c*f+n*a*p-i*l*p)+v*(+t*l*p-t*c*f+r*o*f-n*o*p+n*c*h-r*l*h)+y*(+t*c*d-t*a*p-r*o*d+i*o*p+r*a*h-i*c*h)+g*(-n*a*h-t*l*d+t*a*f+n*o*d-i*o*f+i*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],m=e[12],v=e[13],y=e[14],g=e[15],_=d*y*c-v*f*c+v*l*p-a*y*p-d*l*g+a*f*g,A=m*f*c-h*y*c-m*l*p+o*y*p+h*l*g-o*f*g,b=h*v*c-m*d*c+m*a*p-o*v*p-h*a*g+o*d*g,E=m*d*l-h*v*l-m*a*f+o*v*f+h*a*y-o*d*y,C=t*_+i*A+n*b+r*E;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/C;return e[0]=_*T,e[1]=(v*f*r-d*y*r-v*n*p+i*y*p+d*n*g-i*f*g)*T,e[2]=(a*y*r-v*l*r+v*n*c-i*y*c-a*n*g+i*l*g)*T,e[3]=(d*l*r-a*f*r-d*n*c+i*f*c+a*n*p-i*l*p)*T,e[4]=A*T,e[5]=(h*y*r-m*f*r+m*n*p-t*y*p-h*n*g+t*f*g)*T,e[6]=(m*l*r-o*y*r-m*n*c+t*y*c+o*n*g-t*l*g)*T,e[7]=(o*f*r-h*l*r+h*n*c-t*f*c-o*n*p+t*l*p)*T,e[8]=b*T,e[9]=(m*d*r-h*v*r-m*i*p+t*v*p+h*i*g-t*d*g)*T,e[10]=(o*v*r-m*a*r+m*i*c-t*v*c-o*i*g+t*a*g)*T,e[11]=(h*a*r-o*d*r-h*i*c+t*d*c+o*i*p-t*a*p)*T,e[12]=E*T,e[13]=(h*v*n-m*d*n+m*i*f-t*v*f-h*i*y+t*d*y)*T,e[14]=(m*a*n-o*v*n-m*i*l+t*v*l+o*i*y-t*a*y)*T,e[15]=(o*d*n-h*a*n+h*i*l-t*d*l-o*i*f+t*a*f)*T,this}scale(e){const t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,a=e.y,l=e.z,c=r*o,h=r*a;return this.set(c*o+i,c*a-n*l,c*l+n*a,0,c*a+n*l,h*a+i,h*l-n*o,0,c*l-n*a,h*l+n*o,r*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,o){return this.set(1,i,r,0,e,1,o,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,h=o+o,d=a+a,f=r*c,p=r*h,m=r*d,v=o*h,y=o*d,g=a*d,_=l*c,A=l*h,b=l*d,E=i.x,C=i.y,T=i.z;return n[0]=(1-(v+g))*E,n[1]=(p+b)*E,n[2]=(m-A)*E,n[3]=0,n[4]=(p-b)*C,n[5]=(1-(f+g))*C,n[6]=(y+_)*C,n[7]=0,n[8]=(m+A)*T,n[9]=(y-_)*T,n[10]=(1-(f+v))*T,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=vm.set(n[0],n[1],n[2]).length();const o=vm.set(n[4],n[5],n[6]).length(),a=vm.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],ol.copy(this);const c=1/r,h=1/o,d=1/a;return ol.elements[0]*=c,ol.elements[1]*=c,ol.elements[2]*=c,ol.elements[4]*=h,ol.elements[5]*=h,ol.elements[6]*=h,ol.elements[8]*=d,ol.elements[9]*=d,ol.elements[10]*=d,t.setFromRotationMatrix(ol),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,n,r,o,a=Cc){const l=this.elements,c=2*r/(t-e),h=2*r/(i-n),d=(t+e)/(t-e),f=(i+n)/(i-n);let p,m;if(a===Cc)p=-(o+r)/(o-r),m=-2*o*r/(o-r);else if(a===t0)p=-o/(o-r),m=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=h,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,n,r,o,a=Cc){const l=this.elements,c=1/(t-e),h=1/(i-n),d=1/(o-r),f=(t+e)*c,p=(i+n)*h;let m,v;if(a===Cc)m=(o+r)*d,v=-2*d;else if(a===t0)m=r*d,v=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-f,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=v,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const vm=new w,ol=new fe,Y6=new w(0,0,0),K6=new w(1,1,1),Ou=new w,db=new w,$o=new w,P2=new fe,B2=new xe;class oi{constructor(e=0,t=0,i=0,n=oi.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const n=e.elements,r=n[0],o=n[4],a=n[8],l=n[1],c=n[5],h=n[9],d=n[2],f=n[6],p=n[10];switch(t){case"XYZ":this._y=Math.asin(Zn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Zn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(Zn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Zn(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Zn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-Zn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return P2.makeRotationFromQuaternion(e),this.setFromRotationMatrix(P2,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return B2.setFromEuler(this),this.setFromQuaternion(B2,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}oi.DEFAULT_ORDER="XYZ";class Wr{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let J6=0;const D2=new w,ym=new xe,ph=new fe,fb=new w,qv=new w,Z6=new w,$6=new xe,O2=new w(1,0,0),L2=new w(0,1,0),k2=new w(0,0,1),ej={type:"added"},tj={type:"removed"},_1={type:"childadded",child:null},b1={type:"childremoved",child:null};class ge extends Zs{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:J6++}),this.uuid=ma(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ge.DEFAULT_UP.clone();const e=new w,t=new oi,i=new xe,n=new w(1,1,1);function r(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new fe},normalMatrix:{value:new Ht}}),this.matrix=new fe,this.matrixWorld=new fe,this.matrixAutoUpdate=ge.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ge.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Wr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ym.setFromAxisAngle(e,t),this.quaternion.multiply(ym),this}rotateOnWorldAxis(e,t){return ym.setFromAxisAngle(e,t),this.quaternion.premultiply(ym),this}rotateX(e){return this.rotateOnAxis(O2,e)}rotateY(e){return this.rotateOnAxis(L2,e)}rotateZ(e){return this.rotateOnAxis(k2,e)}translateOnAxis(e,t){return D2.copy(e).applyQuaternion(this.quaternion),this.position.add(D2.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(O2,e)}translateY(e){return this.translateOnAxis(L2,e)}translateZ(e){return this.translateOnAxis(k2,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ph.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?fb.copy(e):fb.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),qv.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ph.lookAt(qv,fb,this.up):ph.lookAt(fb,qv,this.up),this.quaternion.setFromRotationMatrix(ph),n&&(ph.extractRotation(n.matrixWorld),ym.setFromRotationMatrix(ph),this.quaternion.premultiply(ym.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ej),_1.child=e,this.dispatchEvent(_1),_1.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(tj),b1.child=e,this.dispatchEvent(b1),b1.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),ph.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),ph.multiply(e.parent.matrixWorld)),e.applyMatrix4(ph),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const n=this.children;for(let r=0,o=n.length;r<o;r++)n[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qv,e,Z6),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qv,$6,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++){const r=t[i];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const n=this.children;for(let r=0,o=n.length;r<o;r++){const a=n[r];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),n.maxGeometryCount=this._maxGeometryCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const d=l[c];r(e.shapes,d)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));n.material=a}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];n.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),h=o(e.images),d=o(e.shapes),f=o(e.skeletons),p=o(e.animations),m=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),h.length>0&&(i.images=h),d.length>0&&(i.shapes=d),f.length>0&&(i.skeletons=f),p.length>0&&(i.animations=p),m.length>0&&(i.nodes=m)}return i.object=n,i;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const n=e.children[i];this.add(n.clone())}return this}}ge.DEFAULT_UP=new w(0,1,0);ge.DEFAULT_MATRIX_AUTO_UPDATE=!0;ge.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const al=new w,mh=new w,x1=new w,gh=new w,Am=new w,_m=new w,F2=new w,w1=new w,S1=new w,C1=new w;class mo{constructor(e=new w,t=new w,i=new w){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),al.subVectors(e,t),n.cross(al);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){al.subVectors(n,t),mh.subVectors(i,t),x1.subVectors(e,t);const o=al.dot(al),a=al.dot(mh),l=al.dot(x1),c=mh.dot(mh),h=mh.dot(x1),d=o*c-a*a;if(d===0)return r.set(0,0,0),null;const f=1/d,p=(c*l-a*h)*f,m=(o*h-a*l)*f;return r.set(1-p-m,m,p)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,gh)===null?!1:gh.x>=0&&gh.y>=0&&gh.x+gh.y<=1}static getInterpolation(e,t,i,n,r,o,a,l){return this.getBarycoord(e,t,i,n,gh)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(r,gh.x),l.addScaledVector(o,gh.y),l.addScaledVector(a,gh.z),l)}static isFrontFacing(e,t,i,n){return al.subVectors(i,t),mh.subVectors(e,t),al.cross(mh).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return al.subVectors(this.c,this.b),mh.subVectors(this.a,this.b),al.cross(mh).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return mo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return mo.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,n,r){return mo.getInterpolation(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return mo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return mo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,n=this.b,r=this.c;let o,a;Am.subVectors(n,i),_m.subVectors(r,i),w1.subVectors(e,i);const l=Am.dot(w1),c=_m.dot(w1);if(l<=0&&c<=0)return t.copy(i);S1.subVectors(e,n);const h=Am.dot(S1),d=_m.dot(S1);if(h>=0&&d<=h)return t.copy(n);const f=l*d-h*c;if(f<=0&&l>=0&&h<=0)return o=l/(l-h),t.copy(i).addScaledVector(Am,o);C1.subVectors(e,r);const p=Am.dot(C1),m=_m.dot(C1);if(m>=0&&p<=m)return t.copy(r);const v=p*c-l*m;if(v<=0&&c>=0&&m<=0)return a=c/(c-m),t.copy(i).addScaledVector(_m,a);const y=h*m-p*d;if(y<=0&&d-h>=0&&p-m>=0)return F2.subVectors(r,n),a=(d-h)/(d-h+(p-m)),t.copy(n).addScaledVector(F2,a);const g=1/(y+v+f);return o=v*g,a=f*g,t.copy(i).addScaledVector(Am,o).addScaledVector(_m,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const e4={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Lu={h:0,s:0,l:0},pb={h:0,s:0,l:0};function E1(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*6*(2/3-t):s}class me{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const n=e;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=_t){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ki.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n=ki.workingColorSpace){return this.r=e,this.g=t,this.b=i,ki.toWorkingColorSpace(this,n),this}setHSL(e,t,i,n=ki.workingColorSpace){if(e=NP(e,1),t=Zn(t,0,1),i=Zn(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=E1(o,r,e+1/3),this.g=E1(o,r,e),this.b=E1(o,r,e-1/3)}return ki.toWorkingColorSpace(this,n),this}setStyle(e,t=_t){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=n[1],a=n[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=n[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=_t){const i=e4[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Tg(e.r),this.g=Tg(e.g),this.b=Tg(e.b),this}copyLinearToSRGB(e){return this.r=d1(e.r),this.g=d1(e.g),this.b=d1(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=_t){return ki.fromWorkingColorSpace(Dr.copy(this),e),Math.round(Zn(Dr.r*255,0,255))*65536+Math.round(Zn(Dr.g*255,0,255))*256+Math.round(Zn(Dr.b*255,0,255))}getHexString(e=_t){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ki.workingColorSpace){ki.fromWorkingColorSpace(Dr.copy(this),t);const i=Dr.r,n=Dr.g,r=Dr.b,o=Math.max(i,n,r),a=Math.min(i,n,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const d=o-a;switch(c=h<=.5?d/(o+a):d/(2-o-a),o){case i:l=(n-r)/d+(n<r?6:0);break;case n:l=(r-i)/d+2;break;case r:l=(i-n)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=ki.workingColorSpace){return ki.fromWorkingColorSpace(Dr.copy(this),t),e.r=Dr.r,e.g=Dr.g,e.b=Dr.b,e}getStyle(e=_t){ki.fromWorkingColorSpace(Dr.copy(this),e);const t=Dr.r,i=Dr.g,n=Dr.b;return e!==_t?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(n*255)})`}offsetHSL(e,t,i){return this.getHSL(Lu),this.setHSL(Lu.h+e,Lu.s+t,Lu.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Lu),e.getHSL(pb);const i=rA(Lu.h,pb.h,t),n=rA(Lu.s,pb.s,t),r=rA(Lu.l,pb.l,t);return this.setHSL(i,n,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,n=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*n,this.g=r[1]*t+r[4]*i+r[7]*n,this.b=r[2]*t+r[5]*i+r[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Dr=new me;me.NAMES=e4;let ij=0;class Vt extends Zs{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ij++}),this.uuid=ma(),this.name="",this.type="Material",this.blending=pd,this.side=As,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=kw,this.blendDst=Fw,this.blendEquation=sd,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new me(0,0,0),this.blendAlpha=0,this.depthFunc=Tp,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Qw,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=$u,this.stencilZFail=$u,this.stencilZPass=$u,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const n=this[t];if(n===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==pd&&(i.blending=this.blending),this.side!==As&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==kw&&(i.blendSrc=this.blendSrc),this.blendDst!==Fw&&(i.blendDst=this.blendDst),this.blendEquation!==sd&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Tp&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Qw&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==$u&&(i.stencilFail=this.stencilFail),this.stencilZFail!==$u&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==$u&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(t){const r=n(e.textures),o=n(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const n=t.length;i=new Array(n);for(let r=0;r!==n;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Kt extends Vt{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new me(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new oi,this.combine=j0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Gh=nj();function nj(){const s=new ArrayBuffer(4),e=new Float32Array(s),t=new Uint32Array(s),i=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(i[l]=0,i[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(i[l]=1024>>-c-14,i[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(i[l]=c+15<<10,i[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(i[l]=31744,i[l|256]=64512,n[l]=24,n[l|256]=24):(i[l]=31744,i[l|256]=64512,n[l]=13,n[l|256]=13)}const r=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;!(c&8388608);)c<<=1,h-=8388608;c&=-8388609,h+=947912704,r[l]=c|h}for(let l=1024;l<2048;++l)r[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:n,mantissaTable:r,exponentTable:o,offsetTable:a}}function Ro(s){Math.abs(s)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),s=Zn(s,-65504,65504),Gh.floatView[0]=s;const e=Gh.uint32View[0],t=e>>23&511;return Gh.baseTable[t]+((e&8388607)>>Gh.shiftTable[t])}function Fy(s){const e=s>>10;return Gh.uint32View[0]=Gh.mantissaTable[Gh.offsetTable[e]+(s&1023)]+Gh.exponentTable[e],Gh.floatView[0]}const ep={toHalfFloat:Ro,fromHalfFloat:Fy},hs=new w,mb=new Z;class ot{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=e0,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=vn,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Zz("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)mb.fromBufferAttribute(this,t),mb.applyMatrix3(e),this.setXY(t,mb.x,mb.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)hs.fromBufferAttribute(this,t),hs.applyMatrix3(e),this.setXYZ(t,hs.x,hs.y,hs.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)hs.fromBufferAttribute(this,t),hs.applyMatrix4(e),this.setXYZ(t,hs.x,hs.y,hs.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)hs.fromBufferAttribute(this,t),hs.applyNormalMatrix(e),this.setXYZ(t,hs.x,hs.y,hs.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)hs.fromBufferAttribute(this,t),hs.transformDirection(e),this.setXYZ(t,hs.x,hs.y,hs.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=po(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=ni(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=po(t,this.array)),t}setX(e,t){return this.normalized&&(t=ni(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=po(t,this.array)),t}setY(e,t){return this.normalized&&(t=ni(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=po(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ni(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=po(t,this.array)),t}setW(e,t){return this.normalized&&(t=ni(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array),n=ni(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array),n=ni(n,this.array),r=ni(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==e0&&(e.usage=this.usage),e}}class sj extends ot{constructor(e,t,i){super(new Int8Array(e),t,i)}}class rj extends ot{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class oj extends ot{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class aj extends ot{constructor(e,t,i){super(new Int16Array(e),t,i)}}class bC extends ot{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class lj extends ot{constructor(e,t,i){super(new Int32Array(e),t,i)}}class GP extends ot{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class cj extends ot{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=Fy(this.array[e*this.itemSize]);return this.normalized&&(t=po(t,this.array)),t}setX(e,t){return this.normalized&&(t=ni(t,this.array)),this.array[e*this.itemSize]=Ro(t),this}getY(e){let t=Fy(this.array[e*this.itemSize+1]);return this.normalized&&(t=po(t,this.array)),t}setY(e,t){return this.normalized&&(t=ni(t,this.array)),this.array[e*this.itemSize+1]=Ro(t),this}getZ(e){let t=Fy(this.array[e*this.itemSize+2]);return this.normalized&&(t=po(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ni(t,this.array)),this.array[e*this.itemSize+2]=Ro(t),this}getW(e){let t=Fy(this.array[e*this.itemSize+3]);return this.normalized&&(t=po(t,this.array)),t}setW(e,t){return this.normalized&&(t=ni(t,this.array)),this.array[e*this.itemSize+3]=Ro(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array)),this.array[e+0]=Ro(t),this.array[e+1]=Ro(i),this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array),n=ni(n,this.array)),this.array[e+0]=Ro(t),this.array[e+1]=Ro(i),this.array[e+2]=Ro(n),this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array),n=ni(n,this.array),r=ni(r,this.array)),this.array[e+0]=Ro(t),this.array[e+1]=Ro(i),this.array[e+2]=Ro(n),this.array[e+3]=Ro(r),this}}class nt extends ot{constructor(e,t,i){super(new Float32Array(e),t,i)}}let hj=0;const Ia=new fe,T1=new ge,bm=new w,ea=new Si,Xv=new Si,Gs=new w;class pt extends Zs{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:hj++}),this.uuid=ma(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Kz(e)?GP:bC)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new Ht().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ia.makeRotationFromQuaternion(e),this.applyMatrix4(Ia),this}rotateX(e){return Ia.makeRotationX(e),this.applyMatrix4(Ia),this}rotateY(e){return Ia.makeRotationY(e),this.applyMatrix4(Ia),this}rotateZ(e){return Ia.makeRotationZ(e),this.applyMatrix4(Ia),this}translate(e,t,i){return Ia.makeTranslation(e,t,i),this.applyMatrix4(Ia),this}scale(e,t,i){return Ia.makeScale(e,t,i),this.applyMatrix4(Ia),this}lookAt(e){return T1.lookAt(e),T1.updateMatrix(),this.applyMatrix4(T1.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(bm).negate(),this.translate(bm.x,bm.y,bm.z),this}setFromPoints(e){const t=[];for(let i=0,n=e.length;i<n;i++){const r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new nt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Si);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new w(-1/0,-1/0,-1/0),new w(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,n=t.length;i<n;i++){const r=t[i];ea.setFromBufferAttribute(r),this.morphTargetsRelative?(Gs.addVectors(this.boundingBox.min,ea.min),this.boundingBox.expandByPoint(Gs),Gs.addVectors(this.boundingBox.max,ea.max),this.boundingBox.expandByPoint(Gs)):(this.boundingBox.expandByPoint(ea.min),this.boundingBox.expandByPoint(ea.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new _n);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new w,1/0);return}if(e){const i=this.boundingSphere.center;if(ea.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];Xv.setFromBufferAttribute(a),this.morphTargetsRelative?(Gs.addVectors(ea.min,Xv.min),ea.expandByPoint(Gs),Gs.addVectors(ea.max,Xv.max),ea.expandByPoint(Gs)):(ea.expandByPoint(Xv.min),ea.expandByPoint(Xv.max))}ea.getCenter(i);let n=0;for(let r=0,o=e.count;r<o;r++)Gs.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(Gs));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)Gs.fromBufferAttribute(a,c),l&&(bm.fromBufferAttribute(e,c),Gs.add(bm)),n=Math.max(n,i.distanceToSquared(Gs))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,n=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ot(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let M=0;M<i.count;M++)a[M]=new w,l[M]=new w;const c=new w,h=new w,d=new w,f=new Z,p=new Z,m=new Z,v=new w,y=new w;function g(M,R,S){c.fromBufferAttribute(i,M),h.fromBufferAttribute(i,R),d.fromBufferAttribute(i,S),f.fromBufferAttribute(r,M),p.fromBufferAttribute(r,R),m.fromBufferAttribute(r,S),h.sub(c),d.sub(c),p.sub(f),m.sub(f);const I=1/(p.x*m.y-m.x*p.y);isFinite(I)&&(v.copy(h).multiplyScalar(m.y).addScaledVector(d,-p.y).multiplyScalar(I),y.copy(d).multiplyScalar(p.x).addScaledVector(h,-m.x).multiplyScalar(I),a[M].add(v),a[R].add(v),a[S].add(v),l[M].add(y),l[R].add(y),l[S].add(y))}let _=this.groups;_.length===0&&(_=[{start:0,count:e.count}]);for(let M=0,R=_.length;M<R;++M){const S=_[M],I=S.start,L=S.count;for(let U=I,D=I+L;U<D;U+=3)g(e.getX(U+0),e.getX(U+1),e.getX(U+2))}const A=new w,b=new w,E=new w,C=new w;function T(M){E.fromBufferAttribute(n,M),C.copy(E);const R=a[M];A.copy(R),A.sub(E.multiplyScalar(E.dot(R))).normalize(),b.crossVectors(C,R);const I=b.dot(l[M])<0?-1:1;o.setXYZW(M,A.x,A.y,A.z,I)}for(let M=0,R=_.length;M<R;++M){const S=_[M],I=S.start,L=S.count;for(let U=I,D=I+L;U<D;U+=3)T(e.getX(U+0)),T(e.getX(U+1)),T(e.getX(U+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new ot(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let f=0,p=i.count;f<p;f++)i.setXYZ(f,0,0,0);const n=new w,r=new w,o=new w,a=new w,l=new w,c=new w,h=new w,d=new w;if(e)for(let f=0,p=e.count;f<p;f+=3){const m=e.getX(f+0),v=e.getX(f+1),y=e.getX(f+2);n.fromBufferAttribute(t,m),r.fromBufferAttribute(t,v),o.fromBufferAttribute(t,y),h.subVectors(o,r),d.subVectors(n,r),h.cross(d),a.fromBufferAttribute(i,m),l.fromBufferAttribute(i,v),c.fromBufferAttribute(i,y),a.add(h),l.add(h),c.add(h),i.setXYZ(m,a.x,a.y,a.z),i.setXYZ(v,l.x,l.y,l.z),i.setXYZ(y,c.x,c.y,c.z)}else for(let f=0,p=t.count;f<p;f+=3)n.fromBufferAttribute(t,f+0),r.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),h.subVectors(o,r),d.subVectors(n,r),h.cross(d),i.setXYZ(f+0,h.x,h.y,h.z),i.setXYZ(f+1,h.x,h.y,h.z),i.setXYZ(f+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Gs.fromBufferAttribute(e,t),Gs.normalize(),e.setXYZ(t,Gs.x,Gs.y,Gs.z)}toNonIndexed(){function e(a,l){const c=a.array,h=a.itemSize,d=a.normalized,f=new c.constructor(l.length*h);let p=0,m=0;for(let v=0,y=l.length;v<y;v++){a.isInterleavedBufferAttribute?p=l[v]*a.data.stride+a.offset:p=l[v]*h;for(let g=0;g<h;g++)f[m++]=c[p++]}return new ot(f,h,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new pt,i=this.index.array,n=this.attributes;for(const a in n){const l=n[a],c=e(l,i);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let h=0,d=c.length;h<d;h++){const f=c[h],p=e(f,i);l.push(p)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const n={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let d=0,f=c.length;d<f;d++){const p=c[d];h.push(p.toJSON(e.data))}h.length>0&&(n[l]=h,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const n=e.attributes;for(const c in n){const h=n[c];this.setAttribute(c,h.clone(t))}const r=e.morphAttributes;for(const c in r){const h=[],d=r[c];for(let f=0,p=d.length;f<p;f++)h.push(d[f].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,h=o.length;c<h;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const U2=new fe,uf=new jo,gb=new _n,N2=new w,xm=new w,wm=new w,Sm=new w,M1=new w,vb=new w,yb=new Z,Ab=new Z,_b=new Z,z2=new w,G2=new w,H2=new w,bb=new w,xb=new w;class le extends ge{constructor(e=new pt,t=new Kt){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,t){const i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(n,e);const a=this.morphTargetInfluences;if(r&&a){vb.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const h=a[l],d=r[l];h!==0&&(M1.fromBufferAttribute(d,e),o?vb.addScaledVector(M1,h):vb.addScaledVector(M1.sub(t),h))}t.add(vb)}return t}raycast(e,t){const i=this.geometry,n=this.material,r=this.matrixWorld;n!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),gb.copy(i.boundingSphere),gb.applyMatrix4(r),uf.copy(e.ray).recast(e.near),!(gb.containsPoint(uf.origin)===!1&&(uf.intersectSphere(gb,N2)===null||uf.origin.distanceToSquared(N2)>(e.far-e.near)**2))&&(U2.copy(r).invert(),uf.copy(e.ray).applyMatrix4(U2),!(i.boundingBox!==null&&uf.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,uf)))}_computeIntersections(e,t,i){let n;const r=this.geometry,o=this.material,a=r.index,l=r.attributes.position,c=r.attributes.uv,h=r.attributes.uv1,d=r.attributes.normal,f=r.groups,p=r.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,v=f.length;m<v;m++){const y=f[m],g=o[y.materialIndex],_=Math.max(y.start,p.start),A=Math.min(a.count,Math.min(y.start+y.count,p.start+p.count));for(let b=_,E=A;b<E;b+=3){const C=a.getX(b),T=a.getX(b+1),M=a.getX(b+2);n=wb(this,g,e,i,c,h,d,C,T,M),n&&(n.faceIndex=Math.floor(b/3),n.face.materialIndex=y.materialIndex,t.push(n))}}else{const m=Math.max(0,p.start),v=Math.min(a.count,p.start+p.count);for(let y=m,g=v;y<g;y+=3){const _=a.getX(y),A=a.getX(y+1),b=a.getX(y+2);n=wb(this,o,e,i,c,h,d,_,A,b),n&&(n.faceIndex=Math.floor(y/3),t.push(n))}}else if(l!==void 0)if(Array.isArray(o))for(let m=0,v=f.length;m<v;m++){const y=f[m],g=o[y.materialIndex],_=Math.max(y.start,p.start),A=Math.min(l.count,Math.min(y.start+y.count,p.start+p.count));for(let b=_,E=A;b<E;b+=3){const C=b,T=b+1,M=b+2;n=wb(this,g,e,i,c,h,d,C,T,M),n&&(n.faceIndex=Math.floor(b/3),n.face.materialIndex=y.materialIndex,t.push(n))}}else{const m=Math.max(0,p.start),v=Math.min(l.count,p.start+p.count);for(let y=m,g=v;y<g;y+=3){const _=y,A=y+1,b=y+2;n=wb(this,o,e,i,c,h,d,_,A,b),n&&(n.faceIndex=Math.floor(y/3),t.push(n))}}}}function uj(s,e,t,i,n,r,o,a){let l;if(e.side===Gn?l=i.intersectTriangle(o,r,n,!0,a):l=i.intersectTriangle(n,r,o,e.side===As,a),l===null)return null;xb.copy(a),xb.applyMatrix4(s.matrixWorld);const c=t.ray.origin.distanceTo(xb);return c<t.near||c>t.far?null:{distance:c,point:xb.clone(),object:s}}function wb(s,e,t,i,n,r,o,a,l,c){s.getVertexPosition(a,xm),s.getVertexPosition(l,wm),s.getVertexPosition(c,Sm);const h=uj(s,e,t,i,xm,wm,Sm,bb);if(h){n&&(yb.fromBufferAttribute(n,a),Ab.fromBufferAttribute(n,l),_b.fromBufferAttribute(n,c),h.uv=mo.getInterpolation(bb,xm,wm,Sm,yb,Ab,_b,new Z)),r&&(yb.fromBufferAttribute(r,a),Ab.fromBufferAttribute(r,l),_b.fromBufferAttribute(r,c),h.uv1=mo.getInterpolation(bb,xm,wm,Sm,yb,Ab,_b,new Z)),o&&(z2.fromBufferAttribute(o,a),G2.fromBufferAttribute(o,l),H2.fromBufferAttribute(o,c),h.normal=mo.getInterpolation(bb,xm,wm,Sm,z2,G2,H2,new w),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const d={a,b:l,c,normal:new w,materialIndex:0};mo.getNormal(xm,wm,Sm,d.normal),h.face=d}return h}class Xi extends pt{constructor(e=1,t=1,i=1,n=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:o};const a=this;n=Math.floor(n),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],h=[],d=[];let f=0,p=0;m("z","y","x",-1,-1,i,t,e,o,r,0),m("z","y","x",1,-1,i,t,-e,o,r,1),m("x","z","y",1,1,e,i,t,n,o,2),m("x","z","y",1,-1,e,i,-t,n,o,3),m("x","y","z",1,-1,e,t,i,n,r,4),m("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(l),this.setAttribute("position",new nt(c,3)),this.setAttribute("normal",new nt(h,3)),this.setAttribute("uv",new nt(d,2));function m(v,y,g,_,A,b,E,C,T,M,R){const S=b/T,I=E/M,L=b/2,U=E/2,D=C/2,V=T+1,O=M+1;let F=0,N=0;const q=new w;for(let $=0;$<O;$++){const oe=$*I-U;for(let ae=0;ae<V;ae++){const Re=ae*S-L;q[v]=Re*_,q[y]=oe*A,q[g]=D,c.push(q.x,q.y,q.z),q[v]=0,q[y]=0,q[g]=C>0?1:-1,h.push(q.x,q.y,q.z),d.push(ae/T),d.push(1-$/M),F+=1}}for(let $=0;$<M;$++)for(let oe=0;oe<T;oe++){const ae=f+oe+V*$,Re=f+oe+V*($+1),se=f+(oe+1)+V*($+1),ye=f+(oe+1)+V*$;l.push(ae,Re,ye),l.push(Re,se,ye),N+=6}a.addGroup(p,N,R),p+=N,f+=F}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xi(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Wg(s){const e={};for(const t in s){e[t]={};for(const i in s[t]){const n=s[t][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=n.clone():Array.isArray(n)?e[t][i]=n.slice():e[t][i]=n}}return e}function ro(s){const e={};for(let t=0;t<s.length;t++){const i=Wg(s[t]);for(const n in i)e[n]=i[n]}return e}function dj(s){const e=[];for(let t=0;t<s.length;t++)e.push(s[t].clone());return e}function t4(s){return s.getRenderTarget()===null?s.outputColorSpace:ki.workingColorSpace}const fu={clone:Wg,merge:ro};var fj=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,pj=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Rt extends Vt{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=fj,this.fragmentShader=pj,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Wg(e.uniforms),this.uniformsGroups=dj(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const o=this.uniforms[n].value;o&&o.isTexture?t.uniforms[n]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[n]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[n]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[n]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[n]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[n]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[n]={type:"m4",value:o.toArray()}:t.uniforms[n]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const n in this.extensions)this.extensions[n]===!0&&(i[n]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}let Y0=class extends ge{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new fe,this.projectionMatrix=new fe,this.projectionMatrixInverse=new fe,this.coordinateSystem=Cc}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const ku=new w,V2=new Z,Q2=new Z;class zt extends Y0{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=jg*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(hp*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return jg*2*Math.atan(Math.tan(hp*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){ku.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(ku.x,ku.y).multiplyScalar(-e/ku.z),ku.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(ku.x,ku.y).multiplyScalar(-e/ku.z)}getViewSize(e,t){return this.getViewBounds(e,V2,Q2),t.subVectors(Q2,V2)}setViewOffset(e,t,i,n,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(hp*.5*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*n/l,t-=o.offsetY*i/c,n*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Cm=-90,Em=1;class HP extends ge{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new zt(Cm,Em,e,t);n.layers=this.layers,this.add(n);const r=new zt(Cm,Em,e,t);r.layers=this.layers,this.add(r);const o=new zt(Cm,Em,e,t);o.layers=this.layers,this.add(o);const a=new zt(Cm,Em,e,t);a.layers=this.layers,this.add(a);const l=new zt(Cm,Em,e,t);l.layers=this.layers,this.add(l);const c=new zt(Cm,Em,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,n,r,o,a,l]=t;for(const c of t)this.remove(c);if(e===Cc)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===t0)i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,o,a,l,c,h]=this.children,d=e.getRenderTarget(),f=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const v=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,n),e.render(t,r),e.setRenderTarget(i,1,n),e.render(t,o),e.setRenderTarget(i,2,n),e.render(t,a),e.setRenderTarget(i,3,n),e.render(t,l),e.setRenderTarget(i,4,n),e.render(t,c),i.texture.generateMipmaps=v,e.setRenderTarget(i,5,n),e.render(t,h),e.setRenderTarget(d,f,p),e.xr.enabled=m,i.texture.needsPMREMUpdate=!0}}class K0 extends Pt{constructor(e,t,i,n,r,o,a,l,c,h){e=e!==void 0?e:[],t=t!==void 0?t:uu,super(e,t,i,n,r,o,a,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class VP extends Yt{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},n=[i,i,i,i,i,i];this.texture=new K0(n,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Nt}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new Xi(5,5,5),r=new Rt({name:"CubemapFromEquirect",uniforms:Wg(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Gn,blending:An});r.uniforms.tEquirect.value=t;const o=new le(n,r),a=t.minFilter;return t.minFilter===go&&(t.minFilter=Nt),new HP(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,n){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,n);e.setRenderTarget(r)}}const I1=new w,mj=new w,gj=new Ht;class Ar{constructor(e=new w(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=I1.subVectors(i,t).cross(mj.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(I1),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||gj.getNormalMatrix(e),n=this.coplanarPoint(I1).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const df=new _n,Sb=new w;class Rp{constructor(e=new Ar,t=new Ar,i=new Ar,n=new Ar,r=new Ar,o=new Ar){this.planes=[e,t,i,n,r,o]}set(e,t,i,n,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Cc){const i=this.planes,n=e.elements,r=n[0],o=n[1],a=n[2],l=n[3],c=n[4],h=n[5],d=n[6],f=n[7],p=n[8],m=n[9],v=n[10],y=n[11],g=n[12],_=n[13],A=n[14],b=n[15];if(i[0].setComponents(l-r,f-c,y-p,b-g).normalize(),i[1].setComponents(l+r,f+c,y+p,b+g).normalize(),i[2].setComponents(l+o,f+h,y+m,b+_).normalize(),i[3].setComponents(l-o,f-h,y-m,b-_).normalize(),i[4].setComponents(l-a,f-d,y-v,b-A).normalize(),t===Cc)i[5].setComponents(l+a,f+d,y+v,b+A).normalize();else if(t===t0)i[5].setComponents(a,d,v,A).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),df.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),df.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(df)}intersectsSprite(e){return df.center.set(0,0,0),df.radius=.7071067811865476,df.applyMatrix4(e.matrixWorld),this.intersectsSphere(df)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(Sb.x=n.normal.x>0?e.max.x:e.min.x,Sb.y=n.normal.y>0?e.max.y:e.min.y,Sb.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Sb)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function i4(){let s=null,e=!1,t=null,i=null;function n(r,o){t(r,o),i=s.requestAnimationFrame(n)}return{start:function(){e!==!0&&t!==null&&(i=s.requestAnimationFrame(n),e=!0)},stop:function(){s.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){s=r}}}function vj(s,e){const t=e.isWebGL2,i=new WeakMap;function n(c,h){const d=c.array,f=c.usage,p=d.byteLength,m=s.createBuffer();s.bindBuffer(h,m),s.bufferData(h,d,f),c.onUploadCallback();let v;if(d instanceof Float32Array)v=s.FLOAT;else if(d instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)v=s.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else v=s.UNSIGNED_SHORT;else if(d instanceof Int16Array)v=s.SHORT;else if(d instanceof Uint32Array)v=s.UNSIGNED_INT;else if(d instanceof Int32Array)v=s.INT;else if(d instanceof Int8Array)v=s.BYTE;else if(d instanceof Uint8Array)v=s.UNSIGNED_BYTE;else if(d instanceof Uint8ClampedArray)v=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:m,type:v,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version,size:p}}function r(c,h,d){const f=h.array,p=h._updateRange,m=h.updateRanges;if(s.bindBuffer(d,c),p.count===-1&&m.length===0&&s.bufferSubData(d,0,f),m.length!==0){for(let v=0,y=m.length;v<y;v++){const g=m[v];t?s.bufferSubData(d,g.start*f.BYTES_PER_ELEMENT,f,g.start,g.count):s.bufferSubData(d,g.start*f.BYTES_PER_ELEMENT,f.subarray(g.start,g.start+g.count))}h.clearUpdateRanges()}p.count!==-1&&(t?s.bufferSubData(d,p.offset*f.BYTES_PER_ELEMENT,f,p.offset,p.count):s.bufferSubData(d,p.offset*f.BYTES_PER_ELEMENT,f.subarray(p.offset,p.offset+p.count)),p.count=-1),h.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),i.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const h=i.get(c);h&&(s.deleteBuffer(h.buffer),i.delete(c))}function l(c,h){if(c.isGLBufferAttribute){const f=i.get(c);(!f||f.version<c.version)&&i.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const d=i.get(c);if(d===void 0)i.set(c,n(c,h));else if(d.version<c.version){if(d.size!==c.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(d.buffer,c,h),d.version=c.version}}return{get:o,remove:a,update:l}}class _s extends pt{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const r=e/2,o=t/2,a=Math.floor(i),l=Math.floor(n),c=a+1,h=l+1,d=e/a,f=t/l,p=[],m=[],v=[],y=[];for(let g=0;g<h;g++){const _=g*f-o;for(let A=0;A<c;A++){const b=A*d-r;m.push(b,-_,0),v.push(0,0,1),y.push(A/a),y.push(1-g/l)}}for(let g=0;g<l;g++)for(let _=0;_<a;_++){const A=_+c*g,b=_+c*(g+1),E=_+1+c*(g+1),C=_+1+c*g;p.push(A,b,C),p.push(b,E,C)}this.setIndex(p),this.setAttribute("position",new nt(m,3)),this.setAttribute("normal",new nt(v,3)),this.setAttribute("uv",new nt(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _s(e.width,e.height,e.widthSegments,e.heightSegments)}}var yj=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Aj=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,_j=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,bj=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,xj=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,wj=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Sj=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Cj=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Ej=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Tj=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,Mj=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Ij=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Rj=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Pj=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Bj=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Dj=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Oj=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Lj=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,kj=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Fj=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Uj=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Nj=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,zj=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Gj=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Hj=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Vj=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Qj=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,jj=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Wj=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,qj=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Xj="gl_FragColor = linearToOutputTexel( gl_FragColor );",Yj=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,Kj=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Jj=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Zj=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,$j=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,eW=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,tW=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,iW=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,nW=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,sW=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,rW=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,oW=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,aW=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lW=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,cW=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,hW=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,uW=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,dW=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,fW=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,pW=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,mW=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,gW=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,vW=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,yW=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,AW=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,_W=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,bW=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,xW=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,wW=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,SW=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,CW=`#ifdef USE_MAP
#ifdef USE_MIPMAP_BIAS
    vec4 sampledDiffuseColor = texture2D( map, vMapUv, mipmapBias );
#else
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
#endif
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,EW=`#ifdef USE_MAP
	uniform sampler2D map;
        
#ifdef USE_MIPMAP_BIAS
    uniform float mipmapBias;
#endif
#endif`,TW=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,MW=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,IW=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,RW=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,PW=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,BW=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,DW=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,OW=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,LW=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,kW=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,FW=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,UW=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,NW=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,zW=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,GW=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,HW=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,VW=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,QW=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,jW=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,WW=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,qW=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,XW=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,YW=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,KW=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,JW=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,ZW=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,$W=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,e9=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,t9=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,i9=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,n9=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,s9=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,r9=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,o9=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,a9=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,l9=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,c9=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,h9=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,u9=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	float startCompression = 0.8 - 0.04;
	float desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min(color.r, min(color.g, color.b));
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max(color.r, max(color.g, color.b));
	if (peak < startCompression) return color;
	float d = 1. - startCompression;
	float newPeak = 1. - d * d / (peak + d - startCompression);
	color *= newPeak / peak;
	float g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);
	return mix(color, vec3(1, 1, 1), g);
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,d9=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,f9=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,p9=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,m9=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,g9=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,v9=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const y9=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,A9=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,_9=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,b9=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,x9=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,w9=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,S9=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,C9=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,E9=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,T9=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,M9=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,I9=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,R9=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,P9=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,B9=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,D9=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,O9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,L9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,k9=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,F9=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,U9=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,N9=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,z9=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,G9=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,H9=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,V9=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Q9=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,j9=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,W9=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,q9=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,X9=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Y9=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,K9=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,J9=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Dt={alphahash_fragment:yj,alphahash_pars_fragment:Aj,alphamap_fragment:_j,alphamap_pars_fragment:bj,alphatest_fragment:xj,alphatest_pars_fragment:wj,aomap_fragment:Sj,aomap_pars_fragment:Cj,batching_pars_vertex:Ej,batching_vertex:Tj,begin_vertex:Mj,beginnormal_vertex:Ij,bsdfs:Rj,iridescence_fragment:Pj,bumpmap_pars_fragment:Bj,clipping_planes_fragment:Dj,clipping_planes_pars_fragment:Oj,clipping_planes_pars_vertex:Lj,clipping_planes_vertex:kj,color_fragment:Fj,color_pars_fragment:Uj,color_pars_vertex:Nj,color_vertex:zj,common:Gj,cube_uv_reflection_fragment:Hj,defaultnormal_vertex:Vj,displacementmap_pars_vertex:Qj,displacementmap_vertex:jj,emissivemap_fragment:Wj,emissivemap_pars_fragment:qj,colorspace_fragment:Xj,colorspace_pars_fragment:Yj,envmap_fragment:Kj,envmap_common_pars_fragment:Jj,envmap_pars_fragment:Zj,envmap_pars_vertex:$j,envmap_physical_pars_fragment:uW,envmap_vertex:eW,fog_vertex:tW,fog_pars_vertex:iW,fog_fragment:nW,fog_pars_fragment:sW,gradientmap_pars_fragment:rW,lightmap_fragment:oW,lightmap_pars_fragment:aW,lights_lambert_fragment:lW,lights_lambert_pars_fragment:cW,lights_pars_begin:hW,lights_toon_fragment:dW,lights_toon_pars_fragment:fW,lights_phong_fragment:pW,lights_phong_pars_fragment:mW,lights_physical_fragment:gW,lights_physical_pars_fragment:vW,lights_fragment_begin:yW,lights_fragment_maps:AW,lights_fragment_end:_W,logdepthbuf_fragment:bW,logdepthbuf_pars_fragment:xW,logdepthbuf_pars_vertex:wW,logdepthbuf_vertex:SW,map_fragment:CW,map_pars_fragment:EW,map_particle_fragment:TW,map_particle_pars_fragment:MW,metalnessmap_fragment:IW,metalnessmap_pars_fragment:RW,morphinstance_vertex:PW,morphcolor_vertex:BW,morphnormal_vertex:DW,morphtarget_pars_vertex:OW,morphtarget_vertex:LW,normal_fragment_begin:kW,normal_fragment_maps:FW,normal_pars_fragment:UW,normal_pars_vertex:NW,normal_vertex:zW,normalmap_pars_fragment:GW,clearcoat_normal_fragment_begin:HW,clearcoat_normal_fragment_maps:VW,clearcoat_pars_fragment:QW,iridescence_pars_fragment:jW,opaque_fragment:WW,packing:qW,premultiplied_alpha_fragment:XW,project_vertex:YW,dithering_fragment:KW,dithering_pars_fragment:JW,roughnessmap_fragment:ZW,roughnessmap_pars_fragment:$W,shadowmap_pars_fragment:e9,shadowmap_pars_vertex:t9,shadowmap_vertex:i9,shadowmask_pars_fragment:n9,skinbase_vertex:s9,skinning_pars_vertex:r9,skinning_vertex:o9,skinnormal_vertex:a9,specularmap_fragment:l9,specularmap_pars_fragment:c9,tonemapping_fragment:h9,tonemapping_pars_fragment:u9,transmission_fragment:d9,transmission_pars_fragment:f9,uv_pars_fragment:p9,uv_pars_vertex:m9,uv_vertex:g9,worldpos_vertex:v9,background_vert:y9,background_frag:A9,backgroundCube_vert:_9,backgroundCube_frag:b9,cube_vert:x9,cube_frag:w9,depth_vert:S9,depth_frag:C9,distanceRGBA_vert:E9,distanceRGBA_frag:T9,equirect_vert:M9,equirect_frag:I9,linedashed_vert:R9,linedashed_frag:P9,meshbasic_vert:B9,meshbasic_frag:D9,meshlambert_vert:O9,meshlambert_frag:L9,meshmatcap_vert:k9,meshmatcap_frag:F9,meshnormal_vert:U9,meshnormal_frag:N9,meshphong_vert:z9,meshphong_frag:G9,meshphysical_vert:H9,meshphysical_frag:V9,meshtoon_vert:Q9,meshtoon_frag:j9,points_vert:W9,points_frag:q9,shadow_vert:X9,shadow_frag:Y9,sprite_vert:K9,sprite_frag:J9},ze={common:{diffuse:{value:new me(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ht},alphaMap:{value:null},alphaMapTransform:{value:new Ht},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ht}},envmap:{envMap:{value:null},envMapRotation:{value:new Ht},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ht}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ht}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ht},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ht},normalScale:{value:new Z(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ht},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ht}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ht}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ht}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new me(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new me(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ht},alphaTest:{value:0},uvTransform:{value:new Ht}},sprite:{diffuse:{value:new me(16777215)},opacity:{value:1},center:{value:new Z(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ht},alphaMap:{value:null},alphaMapTransform:{value:new Ht},alphaTest:{value:0}}},_r={basic:{uniforms:ro([ze.common,ze.specularmap,ze.envmap,ze.aomap,ze.lightmap,ze.fog]),vertexShader:Dt.meshbasic_vert,fragmentShader:Dt.meshbasic_frag},lambert:{uniforms:ro([ze.common,ze.specularmap,ze.envmap,ze.aomap,ze.lightmap,ze.emissivemap,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.fog,ze.lights,{emissive:{value:new me(0)}}]),vertexShader:Dt.meshlambert_vert,fragmentShader:Dt.meshlambert_frag},phong:{uniforms:ro([ze.common,ze.specularmap,ze.envmap,ze.aomap,ze.lightmap,ze.emissivemap,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.fog,ze.lights,{emissive:{value:new me(0)},specular:{value:new me(1118481)},shininess:{value:30}}]),vertexShader:Dt.meshphong_vert,fragmentShader:Dt.meshphong_frag},standard:{uniforms:ro([ze.common,ze.envmap,ze.aomap,ze.lightmap,ze.emissivemap,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.roughnessmap,ze.metalnessmap,ze.fog,ze.lights,{emissive:{value:new me(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Dt.meshphysical_vert,fragmentShader:Dt.meshphysical_frag},toon:{uniforms:ro([ze.common,ze.aomap,ze.lightmap,ze.emissivemap,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.gradientmap,ze.fog,ze.lights,{emissive:{value:new me(0)}}]),vertexShader:Dt.meshtoon_vert,fragmentShader:Dt.meshtoon_frag},matcap:{uniforms:ro([ze.common,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.fog,{matcap:{value:null}}]),vertexShader:Dt.meshmatcap_vert,fragmentShader:Dt.meshmatcap_frag},points:{uniforms:ro([ze.points,ze.fog]),vertexShader:Dt.points_vert,fragmentShader:Dt.points_frag},dashed:{uniforms:ro([ze.common,ze.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Dt.linedashed_vert,fragmentShader:Dt.linedashed_frag},depth:{uniforms:ro([ze.common,ze.displacementmap]),vertexShader:Dt.depth_vert,fragmentShader:Dt.depth_frag},normal:{uniforms:ro([ze.common,ze.bumpmap,ze.normalmap,ze.displacementmap,{opacity:{value:1}}]),vertexShader:Dt.meshnormal_vert,fragmentShader:Dt.meshnormal_frag},sprite:{uniforms:ro([ze.sprite,ze.fog]),vertexShader:Dt.sprite_vert,fragmentShader:Dt.sprite_frag},background:{uniforms:{uvTransform:{value:new Ht},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Dt.background_vert,fragmentShader:Dt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ht}},vertexShader:Dt.backgroundCube_vert,fragmentShader:Dt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Dt.cube_vert,fragmentShader:Dt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Dt.equirect_vert,fragmentShader:Dt.equirect_frag},distanceRGBA:{uniforms:ro([ze.common,ze.displacementmap,{referencePosition:{value:new w},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Dt.distanceRGBA_vert,fragmentShader:Dt.distanceRGBA_frag},shadow:{uniforms:ro([ze.lights,ze.fog,{color:{value:new me(0)},opacity:{value:1}}]),vertexShader:Dt.shadow_vert,fragmentShader:Dt.shadow_frag}};_r.physical={uniforms:ro([_r.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ht},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ht},clearcoatNormalScale:{value:new Z(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ht},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ht},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ht},sheen:{value:0},sheenColor:{value:new me(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ht},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ht},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ht},transmissionSamplerSize:{value:new Z},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ht},attenuationDistance:{value:0},attenuationColor:{value:new me(0)},specularColor:{value:new me(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ht},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ht},anisotropyVector:{value:new Z},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ht}}]),vertexShader:Dt.meshphysical_vert,fragmentShader:Dt.meshphysical_frag};const Cb={r:0,b:0,g:0},ff=new oi,Z9=new fe;function $9(s,e,t,i,n,r,o){const a=new me(0);let l=r===!0?0:1,c,h,d=null,f=0,p=null;function m(y,g){let _=!1,A=g.isScene===!0?g.background:null;A&&A.isTexture&&(A=(g.backgroundBlurriness>0?t:e).get(A)),A===null?v(a,l):A&&A.isColor&&(v(A,1),_=!0);const b=s.xr.getEnvironmentBlendMode();b==="additive"?i.buffers.color.setClear(0,0,0,1,o):b==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(s.autoClear||_)&&s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil),A&&(A.isCubeTexture||A.mapping===fv)?(h===void 0&&(h=new le(new Xi(1,1,1),new Rt({name:"BackgroundCubeMaterial",uniforms:Wg(_r.backgroundCube.uniforms),vertexShader:_r.backgroundCube.vertexShader,fragmentShader:_r.backgroundCube.fragmentShader,side:Gn,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(E,C,T){this.matrixWorld.copyPosition(T.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),ff.copy(g.backgroundRotation),ff.x*=-1,ff.y*=-1,ff.z*=-1,A.isCubeTexture&&A.isRenderTargetTexture===!1&&(ff.y*=-1,ff.z*=-1),h.material.uniforms.envMap.value=A,h.material.uniforms.flipEnvMap.value=A.isCubeTexture&&A.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(Z9.makeRotationFromEuler(ff)),h.material.toneMapped=ki.getTransfer(A.colorSpace)!==on,(d!==A||f!==A.version||p!==s.toneMapping)&&(h.material.needsUpdate=!0,d=A,f=A.version,p=s.toneMapping),h.layers.enableAll(),y.unshift(h,h.geometry,h.material,0,0,null)):A&&A.isTexture&&(c===void 0&&(c=new le(new _s(2,2),new Rt({name:"BackgroundMaterial",uniforms:Wg(_r.background.uniforms),vertexShader:_r.background.vertexShader,fragmentShader:_r.background.fragmentShader,side:As,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=A,c.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,c.material.toneMapped=ki.getTransfer(A.colorSpace)!==on,A.matrixAutoUpdate===!0&&A.updateMatrix(),c.material.uniforms.uvTransform.value.copy(A.matrix),(d!==A||f!==A.version||p!==s.toneMapping)&&(c.material.needsUpdate=!0,d=A,f=A.version,p=s.toneMapping),c.layers.enableAll(),y.unshift(c,c.geometry,c.material,0,0,null))}function v(y,g){y.getRGB(Cb,t4(s)),i.buffers.color.setClear(Cb.r,Cb.g,Cb.b,g,o)}return{getClearColor:function(){return a},setClearColor:function(y,g=1){a.set(y),l=g,v(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(y){l=y,v(a,l)},render:m}}function e7(s,e,t,i){const n=s.getParameter(s.MAX_VERTEX_ATTRIBS),r=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||r!==null,a={},l=y(null);let c=l,h=!1;function d(D,V,O,F,N){let q=!1;if(o){const $=v(F,O,V);c!==$&&(c=$,p(c.object)),q=g(D,F,O,N),q&&_(D,F,O,N)}else{const $=V.wireframe===!0;(c.geometry!==F.id||c.program!==O.id||c.wireframe!==$)&&(c.geometry=F.id,c.program=O.id,c.wireframe=$,q=!0)}N!==null&&t.update(N,s.ELEMENT_ARRAY_BUFFER),(q||h)&&(h=!1,M(D,V,O,F),N!==null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t.get(N).buffer))}function f(){return i.isWebGL2?s.createVertexArray():r.createVertexArrayOES()}function p(D){return i.isWebGL2?s.bindVertexArray(D):r.bindVertexArrayOES(D)}function m(D){return i.isWebGL2?s.deleteVertexArray(D):r.deleteVertexArrayOES(D)}function v(D,V,O){const F=O.wireframe===!0;let N=a[D.id];N===void 0&&(N={},a[D.id]=N);let q=N[V.id];q===void 0&&(q={},N[V.id]=q);let $=q[F];return $===void 0&&($=y(f()),q[F]=$),$}function y(D){const V=[],O=[],F=[];for(let N=0;N<n;N++)V[N]=0,O[N]=0,F[N]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:V,enabledAttributes:O,attributeDivisors:F,object:D,attributes:{},index:null}}function g(D,V,O,F){const N=c.attributes,q=V.attributes;let $=0;const oe=O.getAttributes();for(const ae in oe)if(oe[ae].location>=0){const se=N[ae];let ye=q[ae];if(ye===void 0&&(ae==="instanceMatrix"&&D.instanceMatrix&&(ye=D.instanceMatrix),ae==="instanceColor"&&D.instanceColor&&(ye=D.instanceColor)),se===void 0||se.attribute!==ye||ye&&se.data!==ye.data)return!0;$++}return c.attributesNum!==$||c.index!==F}function _(D,V,O,F){const N={},q=V.attributes;let $=0;const oe=O.getAttributes();for(const ae in oe)if(oe[ae].location>=0){let se=q[ae];se===void 0&&(ae==="instanceMatrix"&&D.instanceMatrix&&(se=D.instanceMatrix),ae==="instanceColor"&&D.instanceColor&&(se=D.instanceColor));const ye={};ye.attribute=se,se&&se.data&&(ye.data=se.data),N[ae]=ye,$++}c.attributes=N,c.attributesNum=$,c.index=F}function A(){const D=c.newAttributes;for(let V=0,O=D.length;V<O;V++)D[V]=0}function b(D){E(D,0)}function E(D,V){const O=c.newAttributes,F=c.enabledAttributes,N=c.attributeDivisors;O[D]=1,F[D]===0&&(s.enableVertexAttribArray(D),F[D]=1),N[D]!==V&&((i.isWebGL2?s:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](D,V),N[D]=V)}function C(){const D=c.newAttributes,V=c.enabledAttributes;for(let O=0,F=V.length;O<F;O++)V[O]!==D[O]&&(s.disableVertexAttribArray(O),V[O]=0)}function T(D,V,O,F,N,q,$){$===!0?s.vertexAttribIPointer(D,V,O,N,q):s.vertexAttribPointer(D,V,O,F,N,q)}function M(D,V,O,F){if(i.isWebGL2===!1&&(D.isInstancedMesh||F.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;A();const N=F.attributes,q=O.getAttributes(),$=V.defaultAttributeValues;for(const oe in q){const ae=q[oe];if(ae.location>=0){let Re=N[oe];if(Re===void 0&&(oe==="instanceMatrix"&&D.instanceMatrix&&(Re=D.instanceMatrix),oe==="instanceColor"&&D.instanceColor&&(Re=D.instanceColor)),Re!==void 0){const se=Re.normalized,ye=Re.itemSize,Ae=t.get(Re);if(Ae===void 0)continue;const je=Ae.buffer,Be=Ae.type,We=Ae.bytesPerElement,lt=i.isWebGL2===!0&&(Be===s.INT||Be===s.UNSIGNED_INT||Re.gpuType===IP);if(Re.isInterleavedBufferAttribute){const rt=Re.data,W=rt.stride,Ge=Re.offset;if(rt.isInstancedInterleavedBuffer){for(let we=0;we<ae.locationSize;we++)E(ae.location+we,rt.meshPerAttribute);D.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=rt.meshPerAttribute*rt.count)}else for(let we=0;we<ae.locationSize;we++)b(ae.location+we);s.bindBuffer(s.ARRAY_BUFFER,je);for(let we=0;we<ae.locationSize;we++)T(ae.location+we,ye/ae.locationSize,Be,se,W*We,(Ge+ye/ae.locationSize*we)*We,lt)}else{if(Re.isInstancedBufferAttribute){for(let rt=0;rt<ae.locationSize;rt++)E(ae.location+rt,Re.meshPerAttribute);D.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=Re.meshPerAttribute*Re.count)}else for(let rt=0;rt<ae.locationSize;rt++)b(ae.location+rt);s.bindBuffer(s.ARRAY_BUFFER,je);for(let rt=0;rt<ae.locationSize;rt++)T(ae.location+rt,ye/ae.locationSize,Be,se,ye*We,ye/ae.locationSize*rt*We,lt)}}else if($!==void 0){const se=$[oe];if(se!==void 0)switch(se.length){case 2:s.vertexAttrib2fv(ae.location,se);break;case 3:s.vertexAttrib3fv(ae.location,se);break;case 4:s.vertexAttrib4fv(ae.location,se);break;default:s.vertexAttrib1fv(ae.location,se)}}}}C()}function R(){L();for(const D in a){const V=a[D];for(const O in V){const F=V[O];for(const N in F)m(F[N].object),delete F[N];delete V[O]}delete a[D]}}function S(D){if(a[D.id]===void 0)return;const V=a[D.id];for(const O in V){const F=V[O];for(const N in F)m(F[N].object),delete F[N];delete V[O]}delete a[D.id]}function I(D){for(const V in a){const O=a[V];if(O[D.id]===void 0)continue;const F=O[D.id];for(const N in F)m(F[N].object),delete F[N];delete O[D.id]}}function L(){U(),h=!0,c!==l&&(c=l,p(c.object))}function U(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:d,reset:L,resetDefaultState:U,dispose:R,releaseStatesOfGeometry:S,releaseStatesOfProgram:I,initAttributes:A,enableAttribute:b,disableUnusedAttributes:C}}function t7(s,e,t,i){const n=i.isWebGL2;let r;function o(h){r=h}function a(h,d){s.drawArrays(r,h,d),t.update(d,r,1)}function l(h,d,f){if(f===0)return;let p,m;if(n)p=s,m="drawArraysInstanced";else if(p=e.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",p===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}p[m](r,h,d,f),t.update(d,r,f)}function c(h,d,f){if(f===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let m=0;m<f;m++)this.render(h[m],d[m]);else{p.multiDrawArraysWEBGL(r,h,0,d,0,f);let m=0;for(let v=0;v<f;v++)m+=d[v];t.update(m,r,1)}}this.setMode=o,this.render=a,this.renderInstances=l,this.renderMultiDraw=c}function i7(s,e,t){let i;function n(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const T=e.get("EXT_texture_filter_anisotropic");i=s.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function r(T){if(T==="highp"){if(s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision>0)return"highp";T="mediump"}return T==="mediump"&&s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&s.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),h=t.logarithmicDepthBuffer===!0,d=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),f=s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS),p=s.getParameter(s.MAX_TEXTURE_SIZE),m=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),v=s.getParameter(s.MAX_VERTEX_ATTRIBS),y=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS),g=s.getParameter(s.MAX_VARYING_VECTORS),_=s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS),A=f>0,b=o||e.has("OES_texture_float"),E=A&&b,C=o?s.getParameter(s.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:d,maxVertexTextures:f,maxTextureSize:p,maxCubemapSize:m,maxAttributes:v,maxVertexUniforms:y,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:A,floatFragmentTextures:b,floatVertexTextures:E,maxSamples:C}}function n7(s){const e=this;let t=null,i=0,n=!1,r=!1;const o=new Ar,a=new Ht,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f){const p=d.length!==0||f||i!==0||n;return n=f,i=d.length,p},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(d,f){t=h(d,f,0)},this.setState=function(d,f,p){const m=d.clippingPlanes,v=d.clipIntersection,y=d.clipShadows,g=s.get(d);if(!n||m===null||m.length===0||r&&!y)r?h(null):c();else{const _=r?0:i,A=_*4;let b=g.clippingState||null;l.value=b,b=h(m,f,A,p);for(let E=0;E!==A;++E)b[E]=t[E];g.clippingState=b,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=_}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function h(d,f,p,m){const v=d!==null?d.length:0;let y=null;if(v!==0){if(y=l.value,m!==!0||y===null){const g=p+v*4,_=f.matrixWorldInverse;a.getNormalMatrix(_),(y===null||y.length<g)&&(y=new Float32Array(g));for(let A=0,b=p;A!==v;++A,b+=4)o.copy(d[A]).applyMatrix4(_,a),o.normal.toArray(y,b),y[b+3]=o.constant}l.value=y,l.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,y}}function s7(s){let e=new WeakMap;function t(o,a){return a===bo?o.mapping=uu:a===Vg&&(o.mapping=Td),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===bo||a===Vg)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new VP(l.height);return c.fromEquirectangularTexture(s,o),e.set(o,c),o.addEventListener("dispose",n),t(c.texture,o.mapping)}else return null}}return o}function n(o){const a=o.target;a.removeEventListener("dispose",n);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap}return{get:i,dispose:r}}class Nl extends Y0{constructor(e=-1,t=1,i=1,n=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-e,o=i+e,a=n+t,l=n-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const sg=4,j2=[.125,.215,.35,.446,.526,.582],zf=20,R1=new Nl,W2=new me;let P1=null,B1=0,D1=0,O1=!1;const Ff=(1+Math.sqrt(5))/2,Tm=1/Ff,q2=[new w(1,1,1),new w(-1,1,1),new w(1,1,-1),new w(-1,1,-1),new w(0,Ff,Tm),new w(0,Ff,-Tm),new w(Tm,0,Ff),new w(-Tm,0,Ff),new w(Ff,Tm,0),new w(-Ff,Tm,0)];class PI{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){P1=this._renderer.getRenderTarget(),B1=this._renderer.getActiveCubeFace(),D1=this._renderer.getActiveMipmapLevel(),O1=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=J2(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=K2(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(P1,B1,D1),this._renderer.xr.enabled=O1,e.scissorTest=!1,Eb(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===uu||e.mapping===Td?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),P1=this._renderer.getRenderTarget(),B1=this._renderer.getActiveCubeFace(),D1=this._renderer.getActiveMipmapLevel(),O1=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Nt,minFilter:Nt,generateMipmaps:!1,type:$i,format:Ti,colorSpace:Ui,depthBuffer:!1},n=Y2(e,t,i),{_lodMax:r}=this;if({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=X2(r),this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Y2(e,t,i);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=X2(o)),this._blurMaterial=r7(o,e,t)}return n}_compileMaterial(e){const t=new le(this._lodPlanes[0],e);this._renderer.compile(t,R1)}_sceneToCubeUV(e,t,i,n){const a=new zt(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,f=h.toneMapping;h.getClearColor(W2),h.toneMapping=_o,h.autoClear=!1;const p=new Kt({name:"PMREM.Background",side:Gn,depthWrite:!1,depthTest:!1}),m=new le(new Xi,p);let v=!1;const y=e.background;y?y.isColor&&(p.color.copy(y),e.background=null,v=!0):(p.color.copy(W2),v=!0);for(let g=0;g<6;g++){const _=g%3;_===0?(a.up.set(0,l[g],0),a.lookAt(c[g],0,0)):_===1?(a.up.set(0,0,l[g]),a.lookAt(0,c[g],0)):(a.up.set(0,l[g],0),a.lookAt(0,0,c[g]));const A=this._cubeSize;Eb(n,_*A,g>2?A:0,A,A),h.setRenderTarget(n),v&&h.render(m,a),h.render(e,a)}m.geometry.dispose(),m.material.dispose(),h.toneMapping=f,h.autoClear=d,e.background=y}_textureToCubeUV(e,t){const i=this._renderer,n=e.mapping===uu||e.mapping===Td;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=J2()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=K2());const r=n?this._cubemapMaterial:this._equirectMaterial,o=new le(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;const l=this._cubeSize;Eb(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,R1)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){const r=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),o=q2[(n-1)%q2.length];this._blur(e,n-1,n,r,o)}t.autoClear=i}_blur(e,t,i,n,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,n,"latitudinal",r),this._halfBlur(o,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,d=new le(this._lodPlanes[n],c),f=c.uniforms,p=this._sizeLods[i]-1,m=isFinite(r)?Math.PI/(2*p):2*Math.PI/(2*zf-1),v=r/m,y=isFinite(r)?1+Math.floor(h*v):zf;y>zf&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${zf}`);const g=[];let _=0;for(let T=0;T<zf;++T){const M=T/v,R=Math.exp(-M*M/2);g.push(R),T===0?_+=R:T<y&&(_+=2*R)}for(let T=0;T<g.length;T++)g[T]=g[T]/_;f.envMap.value=e.texture,f.samples.value=y,f.weights.value=g,f.latitudinal.value=o==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:A}=this;f.dTheta.value=m,f.mipInt.value=A-i;const b=this._sizeLods[n],E=3*b*(n>A-sg?n-A+sg:0),C=4*(this._cubeSize-b);Eb(t,E,C,3*b,2*b),l.setRenderTarget(t),l.render(d,R1)}}function X2(s){const e=[],t=[],i=[];let n=s;const r=s-sg+1+j2.length;for(let o=0;o<r;o++){const a=Math.pow(2,n);t.push(a);let l=1/a;o>s-sg?l=j2[o-s+sg-1]:o===0&&(l=0),i.push(l);const c=1/(a-2),h=-c,d=1+c,f=[h,h,d,h,d,d,h,h,d,d,h,d],p=6,m=6,v=3,y=2,g=1,_=new Float32Array(v*m*p),A=new Float32Array(y*m*p),b=new Float32Array(g*m*p);for(let C=0;C<p;C++){const T=C%3*2/3-1,M=C>2?0:-1,R=[T,M,0,T+2/3,M,0,T+2/3,M+1,0,T,M,0,T+2/3,M+1,0,T,M+1,0];_.set(R,v*m*C),A.set(f,y*m*C);const S=[C,C,C,C,C,C];b.set(S,g*m*C)}const E=new pt;E.setAttribute("position",new ot(_,v)),E.setAttribute("uv",new ot(A,y)),E.setAttribute("faceIndex",new ot(b,g)),e.push(E),n>sg&&n--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function Y2(s,e,t){const i=new Yt(s,e,t);return i.texture.mapping=fv,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Eb(s,e,t,i,n){s.viewport.set(e,t,i,n),s.scissor.set(e,t,i,n)}function r7(s,e,t){const i=new Float32Array(zf),n=new w(0,1,0);return new Rt({name:"SphericalGaussianBlur",defines:{n:zf,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${s}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:QP(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:An,depthTest:!1,depthWrite:!1})}function K2(){return new Rt({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:QP(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:An,depthTest:!1,depthWrite:!1})}function J2(){return new Rt({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:QP(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:An,depthTest:!1,depthWrite:!1})}function QP(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function o7(s){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===bo||l===Vg,h=l===uu||l===Td;if(c||h)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let d=e.get(a);return t===null&&(t=new PI(s)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}else{if(e.has(a))return e.get(a).texture;{const d=a.image;if(c&&d&&d.height>0||h&&d&&n(d)){t=new PI(s);const f=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,f),a.addEventListener("dispose",r),f.texture}else return null}}}return a}function n(a){let l=0;const c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function a7(s){const e={};function t(i){if(e[i]!==void 0)return e[i];let n;switch(i){case"WEBGL_depth_texture":n=s.getExtension("WEBGL_depth_texture")||s.getExtension("MOZ_WEBGL_depth_texture")||s.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=s.getExtension("WEBGL_compressed_texture_s3tc")||s.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=s.getExtension(i)}return e[i]=n,n}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?(t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance")):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const n=t(i);return n===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),n}}}function l7(s,e,t,i){const n={},r=new WeakMap;function o(d){const f=d.target;f.index!==null&&e.remove(f.index);for(const m in f.attributes)e.remove(f.attributes[m]);for(const m in f.morphAttributes){const v=f.morphAttributes[m];for(let y=0,g=v.length;y<g;y++)e.remove(v[y])}f.removeEventListener("dispose",o),delete n[f.id];const p=r.get(f);p&&(e.remove(p),r.delete(f)),i.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function a(d,f){return n[f.id]===!0||(f.addEventListener("dispose",o),n[f.id]=!0,t.memory.geometries++),f}function l(d){const f=d.attributes;for(const m in f)e.update(f[m],s.ARRAY_BUFFER);const p=d.morphAttributes;for(const m in p){const v=p[m];for(let y=0,g=v.length;y<g;y++)e.update(v[y],s.ARRAY_BUFFER)}}function c(d){const f=[],p=d.index,m=d.attributes.position;let v=0;if(p!==null){const _=p.array;v=p.version;for(let A=0,b=_.length;A<b;A+=3){const E=_[A+0],C=_[A+1],T=_[A+2];f.push(E,C,C,T,T,E)}}else if(m!==void 0){const _=m.array;v=m.version;for(let A=0,b=_.length/3-1;A<b;A+=3){const E=A+0,C=A+1,T=A+2;f.push(E,C,C,T,T,E)}}else return;const y=new(Kz(f)?GP:bC)(f,1);y.version=v;const g=r.get(d);g&&e.remove(g),r.set(d,y)}function h(d){const f=r.get(d);if(f){const p=d.index;p!==null&&f.version<p.version&&c(d)}else c(d);return r.get(d)}return{get:a,update:l,getWireframeAttribute:h}}function c7(s,e,t,i){const n=i.isWebGL2;let r;function o(p){r=p}let a,l;function c(p){a=p.type,l=p.bytesPerElement}function h(p,m){s.drawElements(r,m,a,p*l),t.update(m,r,1)}function d(p,m,v){if(v===0)return;let y,g;if(n)y=s,g="drawElementsInstanced";else if(y=e.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",y===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}y[g](r,m,a,p*l,v),t.update(m,r,v)}function f(p,m,v){if(v===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let g=0;g<v;g++)this.render(p[g]/l,m[g]);else{y.multiDrawElementsWEBGL(r,m,0,a,p,0,v);let g=0;for(let _=0;_<v;_++)g+=m[_];t.update(g,r,1)}}this.setMode=o,this.setIndex=c,this.render=h,this.renderInstances=d,this.renderMultiDraw=f}function h7(s){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,o,a){switch(t.calls++,o){case s.TRIANGLES:t.triangles+=a*(r/3);break;case s.LINES:t.lines+=a*(r/2);break;case s.LINE_STRIP:t.lines+=a*(r-1);break;case s.LINE_LOOP:t.lines+=a*r;break;case s.POINTS:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function n(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:n,update:i}}function u7(s,e){return s[0]-e[0]}function d7(s,e){return Math.abs(e[1])-Math.abs(s[1])}function f7(s,e,t){const i={},n=new Float32Array(8),r=new WeakMap,o=new Je,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,h,d){const f=c.morphTargetInfluences;if(e.isWebGL2===!0){const p=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,m=p!==void 0?p.length:0;let v=r.get(h);if(v===void 0||v.count!==m){let L=function(){S.dispose(),r.delete(h),h.removeEventListener("dispose",L)};v!==void 0&&v.texture.dispose();const y=h.morphAttributes.position!==void 0,g=h.morphAttributes.normal!==void 0,_=h.morphAttributes.color!==void 0,A=h.morphAttributes.position||[],b=h.morphAttributes.normal||[],E=h.morphAttributes.color||[];let C=0;y===!0&&(C=1),g===!0&&(C=2),_===!0&&(C=3);let T=h.attributes.position.count*C,M=1;T>e.maxTextureSize&&(M=Math.ceil(T/e.maxTextureSize),T=e.maxTextureSize);const R=new Float32Array(T*M*4*m),S=new AC(R,T,M,m);S.type=vn,S.needsUpdate=!0;const I=C*4;for(let U=0;U<m;U++){const D=A[U],V=b[U],O=E[U],F=T*M*4*U;for(let N=0;N<D.count;N++){const q=N*I;y===!0&&(o.fromBufferAttribute(D,N),R[F+q+0]=o.x,R[F+q+1]=o.y,R[F+q+2]=o.z,R[F+q+3]=0),g===!0&&(o.fromBufferAttribute(V,N),R[F+q+4]=o.x,R[F+q+5]=o.y,R[F+q+6]=o.z,R[F+q+7]=0),_===!0&&(o.fromBufferAttribute(O,N),R[F+q+8]=o.x,R[F+q+9]=o.y,R[F+q+10]=o.z,R[F+q+11]=O.itemSize===4?o.w:1)}}v={count:m,texture:S,size:new Z(T,M)},r.set(h,v),h.addEventListener("dispose",L)}if(c.isInstancedMesh===!0&&c.morphTexture!==null)d.getUniforms().setValue(s,"morphTexture",c.morphTexture,t);else{let y=0;for(let _=0;_<f.length;_++)y+=f[_];const g=h.morphTargetsRelative?1:1-y;d.getUniforms().setValue(s,"morphTargetBaseInfluence",g),d.getUniforms().setValue(s,"morphTargetInfluences",f)}d.getUniforms().setValue(s,"morphTargetsTexture",v.texture,t),d.getUniforms().setValue(s,"morphTargetsTextureSize",v.size)}else{const p=f===void 0?0:f.length;let m=i[h.id];if(m===void 0||m.length!==p){m=[];for(let A=0;A<p;A++)m[A]=[A,0];i[h.id]=m}for(let A=0;A<p;A++){const b=m[A];b[0]=A,b[1]=f[A]}m.sort(d7);for(let A=0;A<8;A++)A<p&&m[A][1]?(a[A][0]=m[A][0],a[A][1]=m[A][1]):(a[A][0]=Number.MAX_SAFE_INTEGER,a[A][1]=0);a.sort(u7);const v=h.morphAttributes.position,y=h.morphAttributes.normal;let g=0;for(let A=0;A<8;A++){const b=a[A],E=b[0],C=b[1];E!==Number.MAX_SAFE_INTEGER&&C?(v&&h.getAttribute("morphTarget"+A)!==v[E]&&h.setAttribute("morphTarget"+A,v[E]),y&&h.getAttribute("morphNormal"+A)!==y[E]&&h.setAttribute("morphNormal"+A,y[E]),n[A]=C,g+=C):(v&&h.hasAttribute("morphTarget"+A)===!0&&h.deleteAttribute("morphTarget"+A),y&&h.hasAttribute("morphNormal"+A)===!0&&h.deleteAttribute("morphNormal"+A),n[A]=0)}const _=h.morphTargetsRelative?1:1-g;d.getUniforms().setValue(s,"morphTargetBaseInfluence",_),d.getUniforms().setValue(s,"morphTargetInfluences",n)}}return{update:l}}function p7(s,e,t,i){let n=new WeakMap;function r(l){const c=i.render.frame,h=l.geometry,d=e.get(l,h);if(n.get(d)!==c&&(e.update(d),n.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),n.get(l)!==c&&(t.update(l.instanceMatrix,s.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,s.ARRAY_BUFFER),n.set(l,c))),l.isSkinnedMesh){const f=l.skeleton;n.get(f)!==c&&(f.update(),n.set(f,c))}return d}function o(){n=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:o}}class mv extends Pt{constructor(e,t,i,n,r,o,a,l,c,h){if(h=h!==void 0?h:md,h!==md&&h!==Md)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===md&&(i=El),i===void 0&&h===Md&&(i=tu),super(null,n,r,o,a,l,h,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:ei,this.minFilter=l!==void 0?l:ei,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const n4=new Pt,s4=new mv(1,1);s4.compareFunction=UP;const r4=new AC,o4=new _C,a4=new K0,Z2=[],$2=[],eL=new Float32Array(16),tL=new Float32Array(9),iL=new Float32Array(4);function gv(s,e,t){const i=s[0];if(i<=0||i>0)return s;const n=e*t;let r=Z2[n];if(r===void 0&&(r=new Float32Array(n),Z2[n]=r),e!==0){i.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,s[o].toArray(r,a)}return r}function ks(s,e){if(s.length!==e.length)return!1;for(let t=0,i=s.length;t<i;t++)if(s[t]!==e[t])return!1;return!0}function Fs(s,e){for(let t=0,i=e.length;t<i;t++)s[t]=e[t]}function xC(s,e){let t=$2[e];t===void 0&&(t=new Int32Array(e),$2[e]=t);for(let i=0;i!==e;++i)t[i]=s.allocateTextureUnit();return t}function m7(s,e){const t=this.cache;t[0]!==e&&(s.uniform1f(this.addr,e),t[0]=e)}function g7(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ks(t,e))return;s.uniform2fv(this.addr,e),Fs(t,e)}}function v7(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(s.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(ks(t,e))return;s.uniform3fv(this.addr,e),Fs(t,e)}}function y7(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ks(t,e))return;s.uniform4fv(this.addr,e),Fs(t,e)}}function A7(s,e){const t=this.cache,i=e.elements;if(i===void 0){if(ks(t,e))return;s.uniformMatrix2fv(this.addr,!1,e),Fs(t,e)}else{if(ks(t,i))return;iL.set(i),s.uniformMatrix2fv(this.addr,!1,iL),Fs(t,i)}}function _7(s,e){const t=this.cache,i=e.elements;if(i===void 0){if(ks(t,e))return;s.uniformMatrix3fv(this.addr,!1,e),Fs(t,e)}else{if(ks(t,i))return;tL.set(i),s.uniformMatrix3fv(this.addr,!1,tL),Fs(t,i)}}function b7(s,e){const t=this.cache,i=e.elements;if(i===void 0){if(ks(t,e))return;s.uniformMatrix4fv(this.addr,!1,e),Fs(t,e)}else{if(ks(t,i))return;eL.set(i),s.uniformMatrix4fv(this.addr,!1,eL),Fs(t,i)}}function x7(s,e){const t=this.cache;t[0]!==e&&(s.uniform1i(this.addr,e),t[0]=e)}function w7(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ks(t,e))return;s.uniform2iv(this.addr,e),Fs(t,e)}}function S7(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(ks(t,e))return;s.uniform3iv(this.addr,e),Fs(t,e)}}function C7(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ks(t,e))return;s.uniform4iv(this.addr,e),Fs(t,e)}}function E7(s,e){const t=this.cache;t[0]!==e&&(s.uniform1ui(this.addr,e),t[0]=e)}function T7(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ks(t,e))return;s.uniform2uiv(this.addr,e),Fs(t,e)}}function M7(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(ks(t,e))return;s.uniform3uiv(this.addr,e),Fs(t,e)}}function I7(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ks(t,e))return;s.uniform4uiv(this.addr,e),Fs(t,e)}}function R7(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n);const r=this.type===s.SAMPLER_2D_SHADOW?s4:n4;t.setTexture2D(e||r,n)}function P7(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n),t.setTexture3D(e||o4,n)}function B7(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n),t.setTextureCube(e||a4,n)}function D7(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n),t.setTexture2DArray(e||r4,n)}function O7(s){switch(s){case 5126:return m7;case 35664:return g7;case 35665:return v7;case 35666:return y7;case 35674:return A7;case 35675:return _7;case 35676:return b7;case 5124:case 35670:return x7;case 35667:case 35671:return w7;case 35668:case 35672:return S7;case 35669:case 35673:return C7;case 5125:return E7;case 36294:return T7;case 36295:return M7;case 36296:return I7;case 35678:case 36198:case 36298:case 36306:case 35682:return R7;case 35679:case 36299:case 36307:return P7;case 35680:case 36300:case 36308:case 36293:return B7;case 36289:case 36303:case 36311:case 36292:return D7}}function L7(s,e){s.uniform1fv(this.addr,e)}function k7(s,e){const t=gv(e,this.size,2);s.uniform2fv(this.addr,t)}function F7(s,e){const t=gv(e,this.size,3);s.uniform3fv(this.addr,t)}function U7(s,e){const t=gv(e,this.size,4);s.uniform4fv(this.addr,t)}function N7(s,e){const t=gv(e,this.size,4);s.uniformMatrix2fv(this.addr,!1,t)}function z7(s,e){const t=gv(e,this.size,9);s.uniformMatrix3fv(this.addr,!1,t)}function G7(s,e){const t=gv(e,this.size,16);s.uniformMatrix4fv(this.addr,!1,t)}function H7(s,e){s.uniform1iv(this.addr,e)}function V7(s,e){s.uniform2iv(this.addr,e)}function Q7(s,e){s.uniform3iv(this.addr,e)}function j7(s,e){s.uniform4iv(this.addr,e)}function W7(s,e){s.uniform1uiv(this.addr,e)}function q7(s,e){s.uniform2uiv(this.addr,e)}function X7(s,e){s.uniform3uiv(this.addr,e)}function Y7(s,e){s.uniform4uiv(this.addr,e)}function K7(s,e,t){const i=this.cache,n=e.length,r=xC(t,n);ks(i,r)||(s.uniform1iv(this.addr,r),Fs(i,r));for(let o=0;o!==n;++o)t.setTexture2D(e[o]||n4,r[o])}function J7(s,e,t){const i=this.cache,n=e.length,r=xC(t,n);ks(i,r)||(s.uniform1iv(this.addr,r),Fs(i,r));for(let o=0;o!==n;++o)t.setTexture3D(e[o]||o4,r[o])}function Z7(s,e,t){const i=this.cache,n=e.length,r=xC(t,n);ks(i,r)||(s.uniform1iv(this.addr,r),Fs(i,r));for(let o=0;o!==n;++o)t.setTextureCube(e[o]||a4,r[o])}function $7(s,e,t){const i=this.cache,n=e.length,r=xC(t,n);ks(i,r)||(s.uniform1iv(this.addr,r),Fs(i,r));for(let o=0;o!==n;++o)t.setTexture2DArray(e[o]||r4,r[o])}function eq(s){switch(s){case 5126:return L7;case 35664:return k7;case 35665:return F7;case 35666:return U7;case 35674:return N7;case 35675:return z7;case 35676:return G7;case 5124:case 35670:return H7;case 35667:case 35671:return V7;case 35668:case 35672:return Q7;case 35669:case 35673:return j7;case 5125:return W7;case 36294:return q7;case 36295:return X7;case 36296:return Y7;case 35678:case 36198:case 36298:case 36306:case 35682:return K7;case 35679:case 36299:case 36307:return J7;case 35680:case 36300:case 36308:case 36293:return Z7;case 36289:case 36303:case 36311:case 36292:return $7}}class tq{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=O7(t.type)}}class iq{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=eq(t.type)}}class nq{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const n=this.seq;for(let r=0,o=n.length;r!==o;++r){const a=n[r];a.setValue(e,t[a.id],i)}}}const L1=/(\w+)(\])?(\[|\.)?/g;function nL(s,e){s.seq.push(e),s.map[e.id]=e}function sq(s,e,t){const i=s.name,n=i.length;for(L1.lastIndex=0;;){const r=L1.exec(i),o=L1.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===n){nL(t,c===void 0?new tq(a,s,e):new iq(a,s,e));break}else{let d=t.map[a];d===void 0&&(d=new nq(a),nL(t,d)),t=d}}}class lw{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const r=e.getActiveUniform(t,n),o=e.getUniformLocation(t,r.name);sq(r,o,this)}}setValue(e,t,i,n){const r=this.map[t];r!==void 0&&r.setValue(e,i,n)}setOptional(e,t,i){const n=t[i];n!==void 0&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let r=0,o=t.length;r!==o;++r){const a=t[r],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,n)}}static seqWithValue(e,t){const i=[];for(let n=0,r=e.length;n!==r;++n){const o=e[n];o.id in t&&i.push(o)}return i}}function sL(s,e,t){const i=s.createShader(e);return s.shaderSource(i,t),s.compileShader(i),i}const rq=37297;let oq=0;function aq(s,e){const t=s.split(`
`),i=[],n=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=n;o<r;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}function lq(s){const e=ki.getPrimaries(ki.workingColorSpace),t=ki.getPrimaries(s);let i;switch(e===t?i="":e===$A&&t===ZA?i="LinearDisplayP3ToLinearSRGB":e===ZA&&t===$A&&(i="LinearSRGBToLinearDisplayP3"),s){case Ui:case pv:return[i,"LinearTransferOETF"];case _t:case X0:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",s),[i,"LinearTransferOETF"]}}function rL(s,e,t){const i=s.getShaderParameter(e,s.COMPILE_STATUS),n=s.getShaderInfoLog(e).trim();if(i&&n==="")return"";const r=/ERROR: 0:(\d+)/.exec(n);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+n+`

`+aq(s.getShaderSource(e),o)}else return n}function cq(s,e){const t=lq(e);return`vec4 ${s}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function hq(s,e){let t;switch(e){case uv:t="Linear";break;case W0:t="Reinhard";break;case yz:t="OptimizedCineon";break;case q0:t="ACESFilmic";break;case dv:t="AgX";break;case Mp:t="Neutral";break;case Az:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+s+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function uq(s){return[s.extensionDerivatives||s.envMapCubeUVHeight||s.bumpMap||s.normalMapTangentSpace||s.clearcoatNormalMap||s.flatShading||s.alphaToCoverage||s.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(s.extensionFragDepth||s.logarithmicDepthBuffer)&&s.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",s.extensionDrawBuffers&&s.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(s.extensionShaderTextureLOD||s.envMap||s.transmission)&&s.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(rg).join(`
`)}function dq(s){return[s.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",s.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(rg).join(`
`)}function fq(s){const e=[];for(const t in s){const i=s[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function pq(s,e){const t={},i=s.getProgramParameter(e,s.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const r=s.getActiveAttrib(e,n),o=r.name;let a=1;r.type===s.FLOAT_MAT2&&(a=2),r.type===s.FLOAT_MAT3&&(a=3),r.type===s.FLOAT_MAT4&&(a=4),t[o]={type:r.type,location:s.getAttribLocation(e,o),locationSize:a}}return t}function rg(s){return s!==""}function oL(s,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return s.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function aL(s,e){return s.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const mq=/^[ \t]*#include +<([\w\d./]+)>/gm;function BI(s){return s.replace(mq,vq)}const gq=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function vq(s,e){let t=Dt[e];if(t===void 0){const i=gq.get(e);if(i!==void 0)t=Dt[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return BI(t)}const yq=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function lL(s){return s.replace(yq,Aq)}function Aq(s,e,t,i){let n="";for(let r=parseInt(e);r<parseInt(t);r++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return n}function cL(s){let e=`precision ${s.precision} float;
	precision ${s.precision} int;
	precision ${s.precision} sampler2D;
	precision ${s.precision} samplerCube;
	`;return s.isWebGL2&&(e+=`precision ${s.precision} sampler3D;
		precision ${s.precision} sampler2DArray;
		precision ${s.precision} sampler2DShadow;
		precision ${s.precision} samplerCubeShadow;
		precision ${s.precision} sampler2DArrayShadow;
		precision ${s.precision} isampler2D;
		precision ${s.precision} isampler3D;
		precision ${s.precision} isamplerCube;
		precision ${s.precision} isampler2DArray;
		precision ${s.precision} usampler2D;
		precision ${s.precision} usampler3D;
		precision ${s.precision} usamplerCube;
		precision ${s.precision} usampler2DArray;
		`),s.precision==="highp"?e+=`
#define HIGH_PRECISION`:s.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:s.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function _q(s){let e="SHADOWMAP_TYPE_BASIC";return s.shadowMapType===CP?e="SHADOWMAP_TYPE_PCF":s.shadowMapType===EP?e="SHADOWMAP_TYPE_PCF_SOFT":s.shadowMapType===sc&&(e="SHADOWMAP_TYPE_VSM"),e}function bq(s){let e="ENVMAP_TYPE_CUBE";if(s.envMap)switch(s.envMapMode){case uu:case Td:e="ENVMAP_TYPE_CUBE";break;case fv:e="ENVMAP_TYPE_CUBE_UV";break}return e}function xq(s){let e="ENVMAP_MODE_REFLECTION";if(s.envMap)switch(s.envMapMode){case Td:e="ENVMAP_MODE_REFRACTION";break}return e}function wq(s){let e="ENVMAP_BLENDING_NONE";if(s.envMap)switch(s.combine){case j0:e="ENVMAP_BLENDING_MULTIPLY";break;case gz:e="ENVMAP_BLENDING_MIX";break;case vz:e="ENVMAP_BLENDING_ADD";break}return e}function Sq(s){const e=s.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function Cq(s,e,t,i){const n=s.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=_q(t),c=bq(t),h=xq(t),d=wq(t),f=Sq(t),p=t.isWebGL2?"":uq(t),m=dq(t),v=fq(r),y=n.createProgram();let g,_,A=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(rg).join(`
`),g.length>0&&(g+=`
`),_=[p,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(rg).join(`
`),_.length>0&&(_+=`
`)):(g=[cL(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(rg).join(`
`),_=[p,cL(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+d:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==_o?"#define TONE_MAPPING":"",t.toneMapping!==_o?Dt.tonemapping_pars_fragment:"",t.toneMapping!==_o?hq("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Dt.colorspace_pars_fragment,cq("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(rg).join(`
`)),o=BI(o),o=oL(o,t),o=aL(o,t),a=BI(a),a=oL(a,t),a=aL(a,t),o=lL(o),a=lL(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(A=`#version 300 es
`,g=[m,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,_=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===jw?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===jw?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_);const b=A+g+o,E=A+_+a,C=sL(n,n.VERTEX_SHADER,b),T=sL(n,n.FRAGMENT_SHADER,E);n.attachShader(y,C),n.attachShader(y,T),t.index0AttributeName!==void 0?n.bindAttribLocation(y,0,t.index0AttributeName):t.morphTargets===!0&&n.bindAttribLocation(y,0,"position"),n.linkProgram(y);function M(L){if(s.debug.checkShaderErrors){const U=n.getProgramInfoLog(y).trim(),D=n.getShaderInfoLog(C).trim(),V=n.getShaderInfoLog(T).trim();let O=!0,F=!0;if(n.getProgramParameter(y,n.LINK_STATUS)===!1)if(O=!1,typeof s.debug.onShaderError=="function")s.debug.onShaderError(n,y,C,T);else{const N=rL(n,C,"vertex"),q=rL(n,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(y,n.VALIDATE_STATUS)+`

Material Name: `+L.name+`
Material Type: `+L.type+`

Program Info Log: `+U+`
`+N+`
`+q)}else U!==""?console.warn("THREE.WebGLProgram: Program Info Log:",U):(D===""||V==="")&&(F=!1);F&&(L.diagnostics={runnable:O,programLog:U,vertexShader:{log:D,prefix:g},fragmentShader:{log:V,prefix:_}})}n.deleteShader(C),n.deleteShader(T),R=new lw(n,y),S=pq(n,y)}let R;this.getUniforms=function(){return R===void 0&&M(this),R};let S;this.getAttributes=function(){return S===void 0&&M(this),S};let I=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return I===!1&&(I=n.getProgramParameter(y,rq)),I},this.destroy=function(){i.releaseStatesOfProgram(this),n.deleteProgram(y),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=oq++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=C,this.fragmentShader=T,this}let Eq=0;class Tq{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),r=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(n)===!1&&(o.add(n),n.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new Mq(e),t.set(e,i)),i}}class Mq{constructor(e){this.id=Eq++,this.code=e,this.usedTimes=0}}function Iq(s,e,t,i,n,r,o){const a=new Wr,l=new Tq,c=new Set,h=[],d=n.isWebGL2,f=n.logarithmicDepthBuffer,p=n.vertexTextures;let m=n.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function y(S){return c.add(S),S===0?"uv":`uv${S}`}function g(S,I,L,U,D){const V=U.fog,O=D.geometry,F=S.isMeshStandardMaterial?U.environment:null,N=(S.isMeshStandardMaterial?t:e).get(S.envMap||F),q=N&&N.mapping===fv?N.image.height:null,$=v[S.type];S.precision!==null&&(m=n.getMaxPrecision(S.precision),m!==S.precision&&console.warn("THREE.WebGLProgram.getParameters:",S.precision,"not supported, using",m,"instead."));const oe=O.morphAttributes.position||O.morphAttributes.normal||O.morphAttributes.color,ae=oe!==void 0?oe.length:0;let Re=0;O.morphAttributes.position!==void 0&&(Re=1),O.morphAttributes.normal!==void 0&&(Re=2),O.morphAttributes.color!==void 0&&(Re=3);let se,ye,Ae,je;if($){const zi=_r[$];se=zi.vertexShader,ye=zi.fragmentShader}else se=S.vertexShader,ye=S.fragmentShader,l.update(S),Ae=l.getVertexShaderID(S),je=l.getFragmentShaderID(S);const Be=s.getRenderTarget(),We=D.isInstancedMesh===!0,lt=D.isBatchedMesh===!0,rt=!!S.map,W=!!S.matcap,Ge=!!N,we=!!S.aoMap,Ne=!!S.lightMap,Ee=!!S.bumpMap,st=!!S.normalMap,tt=!!S.displacementMap,ct=!!S.emissiveMap,jt=!!S.metalnessMap,H=!!S.roughnessMap,k=S.anisotropy>0,ve=S.clearcoat>0,_e=S.iridescence>0,Pe=S.sheen>0,Me=S.transmission>0,Ct=k&&!!S.anisotropyMap,mt=ve&&!!S.clearcoatMap,ke=ve&&!!S.clearcoatNormalMap,Ve=ve&&!!S.clearcoatRoughnessMap,Tt=_e&&!!S.iridescenceMap,Fe=_e&&!!S.iridescenceThicknessMap,ci=Pe&&!!S.sheenColorMap,gt=Pe&&!!S.sheenRoughnessMap,Ye=!!S.specularMap,vt=!!S.specularColorMap,at=!!S.specularIntensityMap,Gt=Me&&!!S.transmissionMap,j=Me&&!!S.thicknessMap,ce=!!S.gradientMap,ee=!!S.alphaMap,Oe=S.alphaTest>0,he=!!S.alphaHash,He=!!S.extensions;let Ke=_o;S.toneMapped&&(Be===null||Be.isXRRenderTarget===!0)&&(Ke=s.toneMapping);const hi={isWebGL2:d,shaderID:$,shaderType:S.type,shaderName:S.name,vertexShader:se,fragmentShader:ye,defines:S.defines,customVertexShaderID:Ae,customFragmentShaderID:je,isRawShaderMaterial:S.isRawShaderMaterial===!0,glslVersion:S.glslVersion,precision:m,batching:lt,instancing:We,instancingColor:We&&D.instanceColor!==null,instancingMorph:We&&D.morphTexture!==null,supportsVertexTextures:p,outputColorSpace:Be===null?s.outputColorSpace:Be.isXRRenderTarget===!0?Be.texture.colorSpace:Ui,alphaToCoverage:!!S.alphaToCoverage,map:rt,matcap:W,envMap:Ge,envMapMode:Ge&&N.mapping,envMapCubeUVHeight:q,aoMap:we,lightMap:Ne,bumpMap:Ee,normalMap:st,displacementMap:p&&tt,emissiveMap:ct,normalMapObjectSpace:st&&S.normalMapType===Iz,normalMapTangentSpace:st&&S.normalMapType===kd,metalnessMap:jt,roughnessMap:H,anisotropy:k,anisotropyMap:Ct,clearcoat:ve,clearcoatMap:mt,clearcoatNormalMap:ke,clearcoatRoughnessMap:Ve,iridescence:_e,iridescenceMap:Tt,iridescenceThicknessMap:Fe,sheen:Pe,sheenColorMap:ci,sheenRoughnessMap:gt,specularMap:Ye,specularColorMap:vt,specularIntensityMap:at,transmission:Me,transmissionMap:Gt,thicknessMap:j,gradientMap:ce,opaque:S.transparent===!1&&S.blending===pd&&S.alphaToCoverage===!1,alphaMap:ee,alphaTest:Oe,alphaHash:he,combine:S.combine,mapUv:rt&&y(S.map.channel),aoMapUv:we&&y(S.aoMap.channel),lightMapUv:Ne&&y(S.lightMap.channel),bumpMapUv:Ee&&y(S.bumpMap.channel),normalMapUv:st&&y(S.normalMap.channel),displacementMapUv:tt&&y(S.displacementMap.channel),emissiveMapUv:ct&&y(S.emissiveMap.channel),metalnessMapUv:jt&&y(S.metalnessMap.channel),roughnessMapUv:H&&y(S.roughnessMap.channel),anisotropyMapUv:Ct&&y(S.anisotropyMap.channel),clearcoatMapUv:mt&&y(S.clearcoatMap.channel),clearcoatNormalMapUv:ke&&y(S.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ve&&y(S.clearcoatRoughnessMap.channel),iridescenceMapUv:Tt&&y(S.iridescenceMap.channel),iridescenceThicknessMapUv:Fe&&y(S.iridescenceThicknessMap.channel),sheenColorMapUv:ci&&y(S.sheenColorMap.channel),sheenRoughnessMapUv:gt&&y(S.sheenRoughnessMap.channel),specularMapUv:Ye&&y(S.specularMap.channel),specularColorMapUv:vt&&y(S.specularColorMap.channel),specularIntensityMapUv:at&&y(S.specularIntensityMap.channel),transmissionMapUv:Gt&&y(S.transmissionMap.channel),thicknessMapUv:j&&y(S.thicknessMap.channel),alphaMapUv:ee&&y(S.alphaMap.channel),vertexTangents:!!O.attributes.tangent&&(st||k),vertexColors:S.vertexColors,vertexAlphas:S.vertexColors===!0&&!!O.attributes.color&&O.attributes.color.itemSize===4,pointsUvs:D.isPoints===!0&&!!O.attributes.uv&&(rt||ee),fog:!!V,useFog:S.fog===!0,fogExp2:!!V&&V.isFogExp2,flatShading:S.flatShading===!0,sizeAttenuation:S.sizeAttenuation===!0,logarithmicDepthBuffer:f,skinning:D.isSkinnedMesh===!0,morphTargets:O.morphAttributes.position!==void 0,morphNormals:O.morphAttributes.normal!==void 0,morphColors:O.morphAttributes.color!==void 0,morphTargetsCount:ae,morphTextureStride:Re,numDirLights:I.directional.length,numPointLights:I.point.length,numSpotLights:I.spot.length,numSpotLightMaps:I.spotLightMap.length,numRectAreaLights:I.rectArea.length,numHemiLights:I.hemi.length,numDirLightShadows:I.directionalShadowMap.length,numPointLightShadows:I.pointShadowMap.length,numSpotLightShadows:I.spotShadowMap.length,numSpotLightShadowsWithMaps:I.numSpotLightShadowsWithMaps,numLightProbes:I.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:S.dithering,shadowMapEnabled:s.shadowMap.enabled&&L.length>0,shadowMapType:s.shadowMap.type,toneMapping:Ke,useLegacyLights:s._useLegacyLights,decodeVideoTexture:rt&&S.map.isVideoTexture===!0&&ki.getTransfer(S.map.colorSpace)===on,premultipliedAlpha:S.premultipliedAlpha,doubleSided:S.side===Pi,flipSided:S.side===Gn,useDepthPacking:S.depthPacking>=0,depthPacking:S.depthPacking||0,index0AttributeName:S.index0AttributeName,extensionDerivatives:He&&S.extensions.derivatives===!0,extensionFragDepth:He&&S.extensions.fragDepth===!0,extensionDrawBuffers:He&&S.extensions.drawBuffers===!0,extensionShaderTextureLOD:He&&S.extensions.shaderTextureLOD===!0,extensionClipCullDistance:He&&S.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:He&&S.extensions.multiDraw===!0&&i.has("WEBGL_multi_draw"),rendererExtensionFragDepth:d||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:d||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:d||i.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:S.customProgramCacheKey()};return hi.vertexUv1s=c.has(1),hi.vertexUv2s=c.has(2),hi.vertexUv3s=c.has(3),c.clear(),hi}function _(S){const I=[];if(S.shaderID?I.push(S.shaderID):(I.push(S.customVertexShaderID),I.push(S.customFragmentShaderID)),S.defines!==void 0)for(const L in S.defines)I.push(L),I.push(S.defines[L]);return S.isRawShaderMaterial===!1&&(A(I,S),b(I,S),I.push(s.outputColorSpace)),I.push(S.customProgramCacheKey),I.join()}function A(S,I){S.push(I.precision),S.push(I.outputColorSpace),S.push(I.envMapMode),S.push(I.envMapCubeUVHeight),S.push(I.mapUv),S.push(I.alphaMapUv),S.push(I.lightMapUv),S.push(I.aoMapUv),S.push(I.bumpMapUv),S.push(I.normalMapUv),S.push(I.displacementMapUv),S.push(I.emissiveMapUv),S.push(I.metalnessMapUv),S.push(I.roughnessMapUv),S.push(I.anisotropyMapUv),S.push(I.clearcoatMapUv),S.push(I.clearcoatNormalMapUv),S.push(I.clearcoatRoughnessMapUv),S.push(I.iridescenceMapUv),S.push(I.iridescenceThicknessMapUv),S.push(I.sheenColorMapUv),S.push(I.sheenRoughnessMapUv),S.push(I.specularMapUv),S.push(I.specularColorMapUv),S.push(I.specularIntensityMapUv),S.push(I.transmissionMapUv),S.push(I.thicknessMapUv),S.push(I.combine),S.push(I.fogExp2),S.push(I.sizeAttenuation),S.push(I.morphTargetsCount),S.push(I.morphAttributeCount),S.push(I.numDirLights),S.push(I.numPointLights),S.push(I.numSpotLights),S.push(I.numSpotLightMaps),S.push(I.numHemiLights),S.push(I.numRectAreaLights),S.push(I.numDirLightShadows),S.push(I.numPointLightShadows),S.push(I.numSpotLightShadows),S.push(I.numSpotLightShadowsWithMaps),S.push(I.numLightProbes),S.push(I.shadowMapType),S.push(I.toneMapping),S.push(I.numClippingPlanes),S.push(I.numClipIntersection),S.push(I.depthPacking)}function b(S,I){a.disableAll(),I.isWebGL2&&a.enable(0),I.supportsVertexTextures&&a.enable(1),I.instancing&&a.enable(2),I.instancingColor&&a.enable(3),I.instancingMorph&&a.enable(4),I.matcap&&a.enable(5),I.envMap&&a.enable(6),I.normalMapObjectSpace&&a.enable(7),I.normalMapTangentSpace&&a.enable(8),I.clearcoat&&a.enable(9),I.iridescence&&a.enable(10),I.alphaTest&&a.enable(11),I.vertexColors&&a.enable(12),I.vertexAlphas&&a.enable(13),I.vertexUv1s&&a.enable(14),I.vertexUv2s&&a.enable(15),I.vertexUv3s&&a.enable(16),I.vertexTangents&&a.enable(17),I.anisotropy&&a.enable(18),I.alphaHash&&a.enable(19),I.batching&&a.enable(20),S.push(a.mask),a.disableAll(),I.fog&&a.enable(0),I.useFog&&a.enable(1),I.flatShading&&a.enable(2),I.logarithmicDepthBuffer&&a.enable(3),I.skinning&&a.enable(4),I.morphTargets&&a.enable(5),I.morphNormals&&a.enable(6),I.morphColors&&a.enable(7),I.premultipliedAlpha&&a.enable(8),I.shadowMapEnabled&&a.enable(9),I.useLegacyLights&&a.enable(10),I.doubleSided&&a.enable(11),I.flipSided&&a.enable(12),I.useDepthPacking&&a.enable(13),I.dithering&&a.enable(14),I.transmission&&a.enable(15),I.sheen&&a.enable(16),I.opaque&&a.enable(17),I.pointsUvs&&a.enable(18),I.decodeVideoTexture&&a.enable(19),I.alphaToCoverage&&a.enable(20),S.push(a.mask)}function E(S){const I=v[S.type];let L;if(I){const U=_r[I];L=fu.clone(U.uniforms)}else L=S.uniforms;return L}function C(S,I){let L;for(let U=0,D=h.length;U<D;U++){const V=h[U];if(V.cacheKey===I){L=V,++L.usedTimes;break}}return L===void 0&&(L=new Cq(s,I,S,r),h.push(L)),L}function T(S){if(--S.usedTimes===0){const I=h.indexOf(S);h[I]=h[h.length-1],h.pop(),S.destroy()}}function M(S){l.remove(S)}function R(){l.dispose()}return{getParameters:g,getProgramCacheKey:_,getUniforms:E,acquireProgram:C,releaseProgram:T,releaseShaderCache:M,programs:h,dispose:R}}function Rq(){let s=new WeakMap;function e(r){let o=s.get(r);return o===void 0&&(o={},s.set(r,o)),o}function t(r){s.delete(r)}function i(r,o,a){s.get(r)[o]=a}function n(){s=new WeakMap}return{get:e,remove:t,update:i,dispose:n}}function Pq(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.material.id!==e.material.id?s.material.id-e.material.id:s.z!==e.z?s.z-e.z:s.id-e.id}function hL(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.z!==e.z?e.z-s.z:s.id-e.id}function uL(){const s=[];let e=0;const t=[],i=[],n=[];function r(){e=0,t.length=0,i.length=0,n.length=0}function o(d,f,p,m,v,y){let g=s[e];return g===void 0?(g={id:d.id,object:d,geometry:f,material:p,groupOrder:m,renderOrder:d.renderOrder,z:v,group:y},s[e]=g):(g.id=d.id,g.object=d,g.geometry=f,g.material=p,g.groupOrder=m,g.renderOrder=d.renderOrder,g.z=v,g.group=y),e++,g}function a(d,f,p,m,v,y){const g=o(d,f,p,m,v,y);p.transmission>0?i.push(g):p.transparent===!0?n.push(g):t.push(g)}function l(d,f,p,m,v,y){const g=o(d,f,p,m,v,y);p.transmission>0?i.unshift(g):p.transparent===!0?n.unshift(g):t.unshift(g)}function c(d,f){t.length>1&&t.sort(d||Pq),i.length>1&&i.sort(f||hL),n.length>1&&n.sort(f||hL)}function h(){for(let d=e,f=s.length;d<f;d++){const p=s[d];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:i,transparent:n,init:r,push:a,unshift:l,finish:h,sort:c}}function Bq(){let s=new WeakMap;function e(i,n){const r=s.get(i);let o;return r===void 0?(o=new uL,s.set(i,[o])):n>=r.length?(o=new uL,r.push(o)):o=r[n],o}function t(){s=new WeakMap}return{get:e,dispose:t}}function Dq(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new w,color:new me};break;case"SpotLight":t={position:new w,direction:new w,color:new me,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new w,color:new me,distance:0,decay:0};break;case"HemisphereLight":t={direction:new w,skyColor:new me,groundColor:new me};break;case"RectAreaLight":t={color:new me,position:new w,halfWidth:new w,halfHeight:new w};break}return s[e.id]=t,t}}}function Oq(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Z};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Z};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Z,shadowCameraNear:1,shadowCameraFar:1e3};break}return s[e.id]=t,t}}}let Lq=0;function kq(s,e){return(e.castShadow?2:0)-(s.castShadow?2:0)+(e.map?1:0)-(s.map?1:0)}function Fq(s,e){const t=new Dq,i=Oq(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let h=0;h<9;h++)n.probe.push(new w);const r=new w,o=new fe,a=new fe;function l(h,d){let f=0,p=0,m=0;for(let L=0;L<9;L++)n.probe[L].set(0,0,0);let v=0,y=0,g=0,_=0,A=0,b=0,E=0,C=0,T=0,M=0,R=0;h.sort(kq);const S=d===!0?Math.PI:1;for(let L=0,U=h.length;L<U;L++){const D=h[L],V=D.color,O=D.intensity,F=D.distance,N=D.shadow&&D.shadow.map?D.shadow.map.texture:null;if(D.isAmbientLight)f+=V.r*O*S,p+=V.g*O*S,m+=V.b*O*S;else if(D.isLightProbe){for(let q=0;q<9;q++)n.probe[q].addScaledVector(D.sh.coefficients[q],O);R++}else if(D.isDirectionalLight){const q=t.get(D);if(q.color.copy(D.color).multiplyScalar(D.intensity*S),D.castShadow){const $=D.shadow,oe=i.get(D);oe.shadowBias=$.bias,oe.shadowNormalBias=$.normalBias,oe.shadowRadius=$.radius,oe.shadowMapSize=$.mapSize,n.directionalShadow[v]=oe,n.directionalShadowMap[v]=N,n.directionalShadowMatrix[v]=D.shadow.matrix,b++}n.directional[v]=q,v++}else if(D.isSpotLight){const q=t.get(D);q.position.setFromMatrixPosition(D.matrixWorld),q.color.copy(V).multiplyScalar(O*S),q.distance=F,q.coneCos=Math.cos(D.angle),q.penumbraCos=Math.cos(D.angle*(1-D.penumbra)),q.decay=D.decay,n.spot[g]=q;const $=D.shadow;if(D.map&&(n.spotLightMap[T]=D.map,T++,$.updateMatrices(D),D.castShadow&&M++),n.spotLightMatrix[g]=$.matrix,D.castShadow){const oe=i.get(D);oe.shadowBias=$.bias,oe.shadowNormalBias=$.normalBias,oe.shadowRadius=$.radius,oe.shadowMapSize=$.mapSize,n.spotShadow[g]=oe,n.spotShadowMap[g]=N,C++}g++}else if(D.isRectAreaLight){const q=t.get(D);q.color.copy(V).multiplyScalar(O),q.halfWidth.set(D.width*.5,0,0),q.halfHeight.set(0,D.height*.5,0),n.rectArea[_]=q,_++}else if(D.isPointLight){const q=t.get(D);if(q.color.copy(D.color).multiplyScalar(D.intensity*S),q.distance=D.distance,q.decay=D.decay,D.castShadow){const $=D.shadow,oe=i.get(D);oe.shadowBias=$.bias,oe.shadowNormalBias=$.normalBias,oe.shadowRadius=$.radius,oe.shadowMapSize=$.mapSize,oe.shadowCameraNear=$.camera.near,oe.shadowCameraFar=$.camera.far,n.pointShadow[y]=oe,n.pointShadowMap[y]=N,n.pointShadowMatrix[y]=D.shadow.matrix,E++}n.point[y]=q,y++}else if(D.isHemisphereLight){const q=t.get(D);q.skyColor.copy(D.color).multiplyScalar(O*S),q.groundColor.copy(D.groundColor).multiplyScalar(O*S),n.hemi[A]=q,A++}}_>0&&(e.isWebGL2?s.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=ze.LTC_FLOAT_1,n.rectAreaLTC2=ze.LTC_FLOAT_2):(n.rectAreaLTC1=ze.LTC_HALF_1,n.rectAreaLTC2=ze.LTC_HALF_2):s.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=ze.LTC_FLOAT_1,n.rectAreaLTC2=ze.LTC_FLOAT_2):s.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=ze.LTC_HALF_1,n.rectAreaLTC2=ze.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=f,n.ambient[1]=p,n.ambient[2]=m;const I=n.hash;(I.directionalLength!==v||I.pointLength!==y||I.spotLength!==g||I.rectAreaLength!==_||I.hemiLength!==A||I.numDirectionalShadows!==b||I.numPointShadows!==E||I.numSpotShadows!==C||I.numSpotMaps!==T||I.numLightProbes!==R)&&(n.directional.length=v,n.spot.length=g,n.rectArea.length=_,n.point.length=y,n.hemi.length=A,n.directionalShadow.length=b,n.directionalShadowMap.length=b,n.pointShadow.length=E,n.pointShadowMap.length=E,n.spotShadow.length=C,n.spotShadowMap.length=C,n.directionalShadowMatrix.length=b,n.pointShadowMatrix.length=E,n.spotLightMatrix.length=C+T-M,n.spotLightMap.length=T,n.numSpotLightShadowsWithMaps=M,n.numLightProbes=R,I.directionalLength=v,I.pointLength=y,I.spotLength=g,I.rectAreaLength=_,I.hemiLength=A,I.numDirectionalShadows=b,I.numPointShadows=E,I.numSpotShadows=C,I.numSpotMaps=T,I.numLightProbes=R,n.version=Lq++)}function c(h,d){let f=0,p=0,m=0,v=0,y=0;const g=d.matrixWorldInverse;for(let _=0,A=h.length;_<A;_++){const b=h[_];if(b.isDirectionalLight){const E=n.directional[f];E.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),E.direction.sub(r),E.direction.transformDirection(g),f++}else if(b.isSpotLight){const E=n.spot[m];E.position.setFromMatrixPosition(b.matrixWorld),E.position.applyMatrix4(g),E.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),E.direction.sub(r),E.direction.transformDirection(g),m++}else if(b.isRectAreaLight){const E=n.rectArea[v];E.position.setFromMatrixPosition(b.matrixWorld),E.position.applyMatrix4(g),a.identity(),o.copy(b.matrixWorld),o.premultiply(g),a.extractRotation(o),E.halfWidth.set(b.width*.5,0,0),E.halfHeight.set(0,b.height*.5,0),E.halfWidth.applyMatrix4(a),E.halfHeight.applyMatrix4(a),v++}else if(b.isPointLight){const E=n.point[p];E.position.setFromMatrixPosition(b.matrixWorld),E.position.applyMatrix4(g),p++}else if(b.isHemisphereLight){const E=n.hemi[y];E.direction.setFromMatrixPosition(b.matrixWorld),E.direction.transformDirection(g),y++}}}return{setup:l,setupView:c,state:n}}function dL(s,e){const t=new Fq(s,e),i=[],n=[];function r(){i.length=0,n.length=0}function o(d){i.push(d)}function a(d){n.push(d)}function l(d){t.setup(i,d)}function c(d){t.setupView(i,d)}return{init:r,state:{lightsArray:i,shadowsArray:n,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function Uq(s,e){let t=new WeakMap;function i(r,o=0){const a=t.get(r);let l;return a===void 0?(l=new dL(s,e),t.set(r,[l])):o>=a.length?(l=new dL(s,e),a.push(l)):l=a[o],l}function n(){t=new WeakMap}return{get:i,dispose:n}}class J0 extends Vt{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Sr,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class jP extends Vt{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Nq=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,zq=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Gq(s,e,t){let i=new Rp;const n=new Z,r=new Z,o=new Je,a=new J0({depthPacking:yC}),l=new jP,c={},h=t.maxTextureSize,d={[As]:Gn,[Gn]:As,[Pi]:Pi},f=new Rt({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Z},radius:{value:4}},vertexShader:Nq,fragmentShader:zq}),p=f.clone();p.defines.HORIZONTAL_PASS=1;const m=new pt;m.setAttribute("position",new ot(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new le(m,f),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=CP;let g=this.type;this.render=function(C,T,M){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||C.length===0)return;const R=s.getRenderTarget(),S=s.getActiveCubeFace(),I=s.getActiveMipmapLevel(),L=s.state;L.setBlending(An),L.buffers.color.setClear(1,1,1,1),L.buffers.depth.setTest(!0),L.setScissorTest(!1);const U=g!==sc&&this.type===sc,D=g===sc&&this.type!==sc;for(let V=0,O=C.length;V<O;V++){const F=C[V],N=F.shadow;if(N===void 0){console.warn("THREE.WebGLShadowMap:",F,"has no shadow.");continue}if(N.autoUpdate===!1&&N.needsUpdate===!1)continue;n.copy(N.mapSize);const q=N.getFrameExtents();if(n.multiply(q),r.copy(N.mapSize),(n.x>h||n.y>h)&&(n.x>h&&(r.x=Math.floor(h/q.x),n.x=r.x*q.x,N.mapSize.x=r.x),n.y>h&&(r.y=Math.floor(h/q.y),n.y=r.y*q.y,N.mapSize.y=r.y)),N.map===null||U===!0||D===!0){const oe=this.type!==sc?{minFilter:ei,magFilter:ei}:{};N.map!==null&&N.map.dispose(),N.map=new Yt(n.x,n.y,oe),N.map.texture.name=F.name+".shadowMap",N.camera.updateProjectionMatrix()}s.setRenderTarget(N.map),s.clear();const $=N.getViewportCount();for(let oe=0;oe<$;oe++){const ae=N.getViewport(oe);o.set(r.x*ae.x,r.y*ae.y,r.x*ae.z,r.y*ae.w),L.viewport(o),N.updateMatrices(F,oe),i=N.getFrustum(),b(T,M,N.camera,F,this.type)}N.isPointLightShadow!==!0&&this.type===sc&&_(N,M),N.needsUpdate=!1}g=this.type,y.needsUpdate=!1,s.setRenderTarget(R,S,I)};function _(C,T){const M=e.update(v);f.defines.VSM_SAMPLES!==C.blurSamples&&(f.defines.VSM_SAMPLES=C.blurSamples,p.defines.VSM_SAMPLES=C.blurSamples,f.needsUpdate=!0,p.needsUpdate=!0),C.mapPass===null&&(C.mapPass=new Yt(n.x,n.y)),f.uniforms.shadow_pass.value=C.map.texture,f.uniforms.resolution.value=C.mapSize,f.uniforms.radius.value=C.radius,s.setRenderTarget(C.mapPass),s.clear(),s.renderBufferDirect(T,null,M,f,v,null),p.uniforms.shadow_pass.value=C.mapPass.texture,p.uniforms.resolution.value=C.mapSize,p.uniforms.radius.value=C.radius,s.setRenderTarget(C.map),s.clear(),s.renderBufferDirect(T,null,M,p,v,null)}function A(C,T,M,R){let S=null;const I=M.isPointLight===!0?C.customDistanceMaterial:C.customDepthMaterial;if(I!==void 0)S=I;else if(S=M.isPointLight===!0?l:a,s.localClippingEnabled&&T.clipShadows===!0&&Array.isArray(T.clippingPlanes)&&T.clippingPlanes.length!==0||T.displacementMap&&T.displacementScale!==0||T.alphaMap&&T.alphaTest>0||T.map&&T.alphaTest>0){const L=S.uuid,U=T.uuid;let D=c[L];D===void 0&&(D={},c[L]=D);let V=D[U];V===void 0&&(V=S.clone(),D[U]=V,T.addEventListener("dispose",E)),S=V}if(S.visible=T.visible,S.wireframe=T.wireframe,R===sc?S.side=T.shadowSide!==null?T.shadowSide:T.side:S.side=T.shadowSide!==null?T.shadowSide:d[T.side],S.alphaMap=T.alphaMap,S.alphaTest=T.alphaTest,S.map=T.map,S.clipShadows=T.clipShadows,S.clippingPlanes=T.clippingPlanes,S.clipIntersection=T.clipIntersection,S.displacementMap=T.displacementMap,S.displacementScale=T.displacementScale,S.displacementBias=T.displacementBias,S.wireframeLinewidth=T.wireframeLinewidth,S.linewidth=T.linewidth,M.isPointLight===!0&&S.isMeshDistanceMaterial===!0){const L=s.properties.get(S);L.light=M}return S}function b(C,T,M,R,S){if(C.visible===!1)return;if(C.layers.test(T.layers)&&(C.isMesh||C.isLine||C.isPoints)&&(C.castShadow||C.receiveShadow&&S===sc)&&(!C.frustumCulled||i.intersectsObject(C))){C.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,C.matrixWorld);const U=e.update(C),D=C.material;if(Array.isArray(D)){const V=U.groups;for(let O=0,F=V.length;O<F;O++){const N=V[O],q=D[N.materialIndex];if(q&&q.visible){const $=A(C,q,R,S);C.onBeforeShadow(s,C,T,M,U,$,N),s.renderBufferDirect(M,null,U,$,C,N),C.onAfterShadow(s,C,T,M,U,$,N)}}}else if(D.visible){const V=A(C,D,R,S);C.onBeforeShadow(s,C,T,M,U,V,null),s.renderBufferDirect(M,null,U,V,C,null),C.onAfterShadow(s,C,T,M,U,V,null)}}const L=C.children;for(let U=0,D=L.length;U<D;U++)b(L[U],T,M,R,S)}function E(C){C.target.removeEventListener("dispose",E);for(const M in c){const R=c[M],S=C.target.uuid;S in R&&(R[S].dispose(),delete R[S])}}}function Hq(s,e,t){const i=t.isWebGL2;function n(){let ee=!1;const Oe=new Je;let he=null;const He=new Je(0,0,0,0);return{setMask:function(Ke){he!==Ke&&!ee&&(s.colorMask(Ke,Ke,Ke,Ke),he=Ke)},setLocked:function(Ke){ee=Ke},setClear:function(Ke,hi,zi,xn,wn){wn===!0&&(Ke*=xn,hi*=xn,zi*=xn),Oe.set(Ke,hi,zi,xn),He.equals(Oe)===!1&&(s.clearColor(Ke,hi,zi,xn),He.copy(Oe))},reset:function(){ee=!1,he=null,He.set(-1,0,0,0)}}}function r(){let ee=!1,Oe=null,he=null,He=null;return{setTest:function(Ke){Ke?We(s.DEPTH_TEST):lt(s.DEPTH_TEST)},setMask:function(Ke){Oe!==Ke&&!ee&&(s.depthMask(Ke),Oe=Ke)},setFunc:function(Ke){if(he!==Ke){switch(Ke){case MP:s.depthFunc(s.NEVER);break;case hC:s.depthFunc(s.ALWAYS);break;case qA:s.depthFunc(s.LESS);break;case Tp:s.depthFunc(s.LEQUAL);break;case Hg:s.depthFunc(s.EQUAL);break;case uC:s.depthFunc(s.GEQUAL);break;case dC:s.depthFunc(s.GREATER);break;case Q0:s.depthFunc(s.NOTEQUAL);break;default:s.depthFunc(s.LEQUAL)}he=Ke}},setLocked:function(Ke){ee=Ke},setClear:function(Ke){He!==Ke&&(s.clearDepth(Ke),He=Ke)},reset:function(){ee=!1,Oe=null,he=null,He=null}}}function o(){let ee=!1,Oe=null,he=null,He=null,Ke=null,hi=null,zi=null,xn=null,wn=null;return{setTest:function(pi){ee||(pi?We(s.STENCIL_TEST):lt(s.STENCIL_TEST))},setMask:function(pi){Oe!==pi&&!ee&&(s.stencilMask(pi),Oe=pi)},setFunc:function(pi,kn,qn){(he!==pi||He!==kn||Ke!==qn)&&(s.stencilFunc(pi,kn,qn),he=pi,He=kn,Ke=qn)},setOp:function(pi,kn,qn){(hi!==pi||zi!==kn||xn!==qn)&&(s.stencilOp(pi,kn,qn),hi=pi,zi=kn,xn=qn)},setLocked:function(pi){ee=pi},setClear:function(pi){wn!==pi&&(s.clearStencil(pi),wn=pi)},reset:function(){ee=!1,Oe=null,he=null,He=null,Ke=null,hi=null,zi=null,xn=null,wn=null}}}const a=new n,l=new r,c=new o,h=new WeakMap,d=new WeakMap;let f={},p={},m=new WeakMap,v=[],y=null,g=!1,_=null,A=null,b=null,E=null,C=null,T=null,M=null,R=new me(0,0,0),S=0,I=!1,L=null,U=null,D=null,V=null,O=null;const F=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let N=!1,q=0;const $=s.getParameter(s.VERSION);$.indexOf("WebGL")!==-1?(q=parseFloat(/^WebGL (\d)/.exec($)[1]),N=q>=1):$.indexOf("OpenGL ES")!==-1&&(q=parseFloat(/^OpenGL ES (\d)/.exec($)[1]),N=q>=2);let oe=null,ae={};const Re=s.getParameter(s.SCISSOR_BOX),se=s.getParameter(s.VIEWPORT),ye=new Je().fromArray(Re),Ae=new Je().fromArray(se);function je(ee,Oe,he,He){const Ke=new Uint8Array(4),hi=s.createTexture();s.bindTexture(ee,hi),s.texParameteri(ee,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(ee,s.TEXTURE_MAG_FILTER,s.NEAREST);for(let zi=0;zi<he;zi++)i&&(ee===s.TEXTURE_3D||ee===s.TEXTURE_2D_ARRAY)?s.texImage3D(Oe,0,s.RGBA,1,1,He,0,s.RGBA,s.UNSIGNED_BYTE,Ke):s.texImage2D(Oe+zi,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,Ke);return hi}const Be={};Be[s.TEXTURE_2D]=je(s.TEXTURE_2D,s.TEXTURE_2D,1),Be[s.TEXTURE_CUBE_MAP]=je(s.TEXTURE_CUBE_MAP,s.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(Be[s.TEXTURE_2D_ARRAY]=je(s.TEXTURE_2D_ARRAY,s.TEXTURE_2D_ARRAY,1,1),Be[s.TEXTURE_3D]=je(s.TEXTURE_3D,s.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),We(s.DEPTH_TEST),l.setFunc(Tp),tt(!1),ct(sI),We(s.CULL_FACE),Ee(An);function We(ee){f[ee]!==!0&&(s.enable(ee),f[ee]=!0)}function lt(ee){f[ee]!==!1&&(s.disable(ee),f[ee]=!1)}function rt(ee,Oe){return p[ee]!==Oe?(s.bindFramebuffer(ee,Oe),p[ee]=Oe,i&&(ee===s.DRAW_FRAMEBUFFER&&(p[s.FRAMEBUFFER]=Oe),ee===s.FRAMEBUFFER&&(p[s.DRAW_FRAMEBUFFER]=Oe)),!0):!1}function W(ee,Oe){let he=v,He=!1;if(ee){he=m.get(Oe),he===void 0&&(he=[],m.set(Oe,he));const Ke=ee.textures;if(he.length!==Ke.length||he[0]!==s.COLOR_ATTACHMENT0){for(let hi=0,zi=Ke.length;hi<zi;hi++)he[hi]=s.COLOR_ATTACHMENT0+hi;he.length=Ke.length,He=!0}}else he[0]!==s.BACK&&(he[0]=s.BACK,He=!0);if(He)if(t.isWebGL2)s.drawBuffers(he);else if(e.has("WEBGL_draw_buffers")===!0)e.get("WEBGL_draw_buffers").drawBuffersWEBGL(he);else throw new Error("THREE.WebGLState: Usage of gl.drawBuffers() require WebGL2 or WEBGL_draw_buffers extension")}function Ge(ee){return y!==ee?(s.useProgram(ee),y=ee,!0):!1}const we={[sd]:s.FUNC_ADD,[tz]:s.FUNC_SUBTRACT,[iz]:s.FUNC_REVERSE_SUBTRACT};if(i)we[aI]=s.MIN,we[Lw]=s.MAX;else{const ee=e.get("EXT_blend_minmax");ee!==null&&(we[aI]=ee.MIN_EXT,we[Lw]=ee.MAX_EXT)}const Ne={[nz]:s.ZERO,[sz]:s.ONE,[rz]:s.SRC_COLOR,[kw]:s.SRC_ALPHA,[uz]:s.SRC_ALPHA_SATURATE,[cz]:s.DST_COLOR,[az]:s.DST_ALPHA,[oz]:s.ONE_MINUS_SRC_COLOR,[Fw]:s.ONE_MINUS_SRC_ALPHA,[hz]:s.ONE_MINUS_DST_COLOR,[lz]:s.ONE_MINUS_DST_ALPHA,[dz]:s.CONSTANT_COLOR,[fz]:s.ONE_MINUS_CONSTANT_COLOR,[pz]:s.CONSTANT_ALPHA,[mz]:s.ONE_MINUS_CONSTANT_ALPHA};function Ee(ee,Oe,he,He,Ke,hi,zi,xn,wn,pi){if(ee===An){g===!0&&(lt(s.BLEND),g=!1);return}if(g===!1&&(We(s.BLEND),g=!0),ee!==TP){if(ee!==_||pi!==I){if((A!==sd||C!==sd)&&(s.blendEquation(s.FUNC_ADD),A=sd,C=sd),pi)switch(ee){case pd:s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case Ed:s.blendFunc(s.ONE,s.ONE);break;case rI:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case oI:s.blendFuncSeparate(s.ZERO,s.SRC_COLOR,s.ZERO,s.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}else switch(ee){case pd:s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case Ed:s.blendFunc(s.SRC_ALPHA,s.ONE);break;case rI:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case oI:s.blendFunc(s.ZERO,s.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}b=null,E=null,T=null,M=null,R.set(0,0,0),S=0,_=ee,I=pi}return}Ke=Ke||Oe,hi=hi||he,zi=zi||He,(Oe!==A||Ke!==C)&&(s.blendEquationSeparate(we[Oe],we[Ke]),A=Oe,C=Ke),(he!==b||He!==E||hi!==T||zi!==M)&&(s.blendFuncSeparate(Ne[he],Ne[He],Ne[hi],Ne[zi]),b=he,E=He,T=hi,M=zi),(xn.equals(R)===!1||wn!==S)&&(s.blendColor(xn.r,xn.g,xn.b,wn),R.copy(xn),S=wn),_=ee,I=!1}function st(ee,Oe){ee.side===Pi?lt(s.CULL_FACE):We(s.CULL_FACE);let he=ee.side===Gn;Oe&&(he=!he),tt(he),ee.blending===pd&&ee.transparent===!1?Ee(An):Ee(ee.blending,ee.blendEquation,ee.blendSrc,ee.blendDst,ee.blendEquationAlpha,ee.blendSrcAlpha,ee.blendDstAlpha,ee.blendColor,ee.blendAlpha,ee.premultipliedAlpha),l.setFunc(ee.depthFunc),l.setTest(ee.depthTest),l.setMask(ee.depthWrite),a.setMask(ee.colorWrite);const He=ee.stencilWrite;c.setTest(He),He&&(c.setMask(ee.stencilWriteMask),c.setFunc(ee.stencilFunc,ee.stencilRef,ee.stencilFuncMask),c.setOp(ee.stencilFail,ee.stencilZFail,ee.stencilZPass)),H(ee.polygonOffset,ee.polygonOffsetFactor,ee.polygonOffsetUnits),ee.alphaToCoverage===!0?We(s.SAMPLE_ALPHA_TO_COVERAGE):lt(s.SAMPLE_ALPHA_TO_COVERAGE)}function tt(ee){L!==ee&&(ee?s.frontFace(s.CW):s.frontFace(s.CCW),L=ee)}function ct(ee){ee!==$N?(We(s.CULL_FACE),ee!==U&&(ee===sI?s.cullFace(s.BACK):ee===ez?s.cullFace(s.FRONT):s.cullFace(s.FRONT_AND_BACK))):lt(s.CULL_FACE),U=ee}function jt(ee){ee!==D&&(N&&s.lineWidth(ee),D=ee)}function H(ee,Oe,he){ee?(We(s.POLYGON_OFFSET_FILL),(V!==Oe||O!==he)&&(s.polygonOffset(Oe,he),V=Oe,O=he)):lt(s.POLYGON_OFFSET_FILL)}function k(ee){ee?We(s.SCISSOR_TEST):lt(s.SCISSOR_TEST)}function ve(ee){ee===void 0&&(ee=s.TEXTURE0+F-1),oe!==ee&&(s.activeTexture(ee),oe=ee)}function _e(ee,Oe,he){he===void 0&&(oe===null?he=s.TEXTURE0+F-1:he=oe);let He=ae[he];He===void 0&&(He={type:void 0,texture:void 0},ae[he]=He),(He.type!==ee||He.texture!==Oe)&&(oe!==he&&(s.activeTexture(he),oe=he),s.bindTexture(ee,Oe||Be[ee]),He.type=ee,He.texture=Oe)}function Pe(){const ee=ae[oe];ee!==void 0&&ee.type!==void 0&&(s.bindTexture(ee.type,null),ee.type=void 0,ee.texture=void 0)}function Me(){try{s.compressedTexImage2D.apply(s,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ct(){try{s.compressedTexImage3D.apply(s,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function mt(){try{s.texSubImage2D.apply(s,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function ke(){try{s.texSubImage3D.apply(s,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ve(){try{s.compressedTexSubImage2D.apply(s,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Tt(){try{s.compressedTexSubImage3D.apply(s,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Fe(){try{s.texStorage2D.apply(s,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function ci(){try{s.texStorage3D.apply(s,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function gt(){try{s.texImage2D.apply(s,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ye(){try{s.texImage3D.apply(s,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function vt(ee){ye.equals(ee)===!1&&(s.scissor(ee.x,ee.y,ee.z,ee.w),ye.copy(ee))}function at(ee){Ae.equals(ee)===!1&&(s.viewport(ee.x,ee.y,ee.z,ee.w),Ae.copy(ee))}function Gt(ee,Oe){let he=d.get(Oe);he===void 0&&(he=new WeakMap,d.set(Oe,he));let He=he.get(ee);He===void 0&&(He=s.getUniformBlockIndex(Oe,ee.name),he.set(ee,He))}function j(ee,Oe){const He=d.get(Oe).get(ee);h.get(Oe)!==He&&(s.uniformBlockBinding(Oe,He,ee.__bindingPointIndex),h.set(Oe,He))}function ce(){s.disable(s.BLEND),s.disable(s.CULL_FACE),s.disable(s.DEPTH_TEST),s.disable(s.POLYGON_OFFSET_FILL),s.disable(s.SCISSOR_TEST),s.disable(s.STENCIL_TEST),s.disable(s.SAMPLE_ALPHA_TO_COVERAGE),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ONE,s.ZERO),s.blendFuncSeparate(s.ONE,s.ZERO,s.ONE,s.ZERO),s.blendColor(0,0,0,0),s.colorMask(!0,!0,!0,!0),s.clearColor(0,0,0,0),s.depthMask(!0),s.depthFunc(s.LESS),s.clearDepth(1),s.stencilMask(4294967295),s.stencilFunc(s.ALWAYS,0,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),s.clearStencil(0),s.cullFace(s.BACK),s.frontFace(s.CCW),s.polygonOffset(0,0),s.activeTexture(s.TEXTURE0),s.bindFramebuffer(s.FRAMEBUFFER,null),i===!0&&(s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),s.bindFramebuffer(s.READ_FRAMEBUFFER,null)),s.useProgram(null),s.lineWidth(1),s.scissor(0,0,s.canvas.width,s.canvas.height),s.viewport(0,0,s.canvas.width,s.canvas.height),f={},oe=null,ae={},p={},m=new WeakMap,v=[],y=null,g=!1,_=null,A=null,b=null,E=null,C=null,T=null,M=null,R=new me(0,0,0),S=0,I=!1,L=null,U=null,D=null,V=null,O=null,ye.set(0,0,s.canvas.width,s.canvas.height),Ae.set(0,0,s.canvas.width,s.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:We,disable:lt,bindFramebuffer:rt,drawBuffers:W,useProgram:Ge,setBlending:Ee,setMaterial:st,setFlipSided:tt,setCullFace:ct,setLineWidth:jt,setPolygonOffset:H,setScissorTest:k,activeTexture:ve,bindTexture:_e,unbindTexture:Pe,compressedTexImage2D:Me,compressedTexImage3D:Ct,texImage2D:gt,texImage3D:Ye,updateUBOMapping:Gt,uniformBlockBinding:j,texStorage2D:Fe,texStorage3D:ci,texSubImage2D:mt,texSubImage3D:ke,compressedTexSubImage2D:Ve,compressedTexSubImage3D:Tt,scissor:vt,viewport:at,reset:ce}}function Vq(s,e,t,i,n,r,o){const a=n.isWebGL2,l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),h=new Z,d=new WeakMap;let f;const p=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(H,k){return m?new OffscreenCanvas(H,k):i0("canvas")}function y(H,k,ve,_e){let Pe=1;const Me=jt(H);if((Me.width>_e||Me.height>_e)&&(Pe=_e/Math.max(Me.width,Me.height)),Pe<1||k===!0)if(typeof HTMLImageElement<"u"&&H instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&H instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&H instanceof ImageBitmap||typeof VideoFrame<"u"&&H instanceof VideoFrame){const Ct=k?qw:Math.floor,mt=Ct(Pe*Me.width),ke=Ct(Pe*Me.height);f===void 0&&(f=v(mt,ke));const Ve=ve?v(mt,ke):f;return Ve.width=mt,Ve.height=ke,Ve.getContext("2d").drawImage(H,0,0,mt,ke),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Me.width+"x"+Me.height+") to ("+mt+"x"+ke+")."),Ve}else return"data"in H&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Me.width+"x"+Me.height+")."),H;return H}function g(H){const k=jt(H);return RI(k.width)&&RI(k.height)}function _(H){return a?!1:H.wrapS!==ps||H.wrapT!==ps||H.minFilter!==ei&&H.minFilter!==Nt}function A(H,k){return H.generateMipmaps&&k&&H.minFilter!==ei&&H.minFilter!==Nt}function b(H){s.generateMipmap(H)}function E(H,k,ve,_e,Pe=!1){if(a===!1)return k;if(H!==null){if(s[H]!==void 0)return s[H];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+H+"'")}let Me=k;if(k===s.RED&&(ve===s.FLOAT&&(Me=s.R32F),ve===s.HALF_FLOAT&&(Me=s.R16F),ve===s.UNSIGNED_BYTE&&(Me=s.R8)),k===s.RED_INTEGER&&(ve===s.UNSIGNED_BYTE&&(Me=s.R8UI),ve===s.UNSIGNED_SHORT&&(Me=s.R16UI),ve===s.UNSIGNED_INT&&(Me=s.R32UI),ve===s.BYTE&&(Me=s.R8I),ve===s.SHORT&&(Me=s.R16I),ve===s.INT&&(Me=s.R32I)),k===s.RG&&(ve===s.FLOAT&&(Me=s.RG32F),ve===s.HALF_FLOAT&&(Me=s.RG16F),ve===s.UNSIGNED_BYTE&&(Me=s.RG8)),k===s.RG_INTEGER&&(ve===s.UNSIGNED_BYTE&&(Me=s.RG8UI),ve===s.UNSIGNED_SHORT&&(Me=s.RG16UI),ve===s.UNSIGNED_INT&&(Me=s.RG32UI),ve===s.BYTE&&(Me=s.RG8I),ve===s.SHORT&&(Me=s.RG16I),ve===s.INT&&(Me=s.RG32I)),k===s.RGBA){const Ct=Pe?JA:ki.getTransfer(_e);ve===s.FLOAT&&(Me=s.RGBA32F),ve===s.HALF_FLOAT&&(Me=s.RGBA16F),ve===s.UNSIGNED_BYTE&&(Me=Ct===on?s.SRGB8_ALPHA8:s.RGBA8),ve===s.UNSIGNED_SHORT_4_4_4_4&&(Me=s.RGBA4),ve===s.UNSIGNED_SHORT_5_5_5_1&&(Me=s.RGB5_A1)}return(Me===s.R16F||Me===s.R32F||Me===s.RG16F||Me===s.RG32F||Me===s.RGBA16F||Me===s.RGBA32F)&&e.get("EXT_color_buffer_float"),Me}function C(H,k,ve){return A(H,ve)===!0||H.isFramebufferTexture&&H.minFilter!==ei&&H.minFilter!==Nt?Math.log2(Math.max(k.width,k.height))+1:H.mipmaps!==void 0&&H.mipmaps.length>0?H.mipmaps.length:H.isCompressedTexture&&Array.isArray(H.image)?k.mipmaps.length:1}function T(H){return H===ei||H===Qg||H===zh?s.NEAREST:s.LINEAR}function M(H){const k=H.target;k.removeEventListener("dispose",M),S(k),k.isVideoTexture&&d.delete(k)}function R(H){const k=H.target;k.removeEventListener("dispose",R),L(k)}function S(H){const k=i.get(H);if(k.__webglInit===void 0)return;const ve=H.source,_e=p.get(ve);if(_e){const Pe=_e[k.__cacheKey];Pe.usedTimes--,Pe.usedTimes===0&&I(H),Object.keys(_e).length===0&&p.delete(ve)}i.remove(H)}function I(H){const k=i.get(H);s.deleteTexture(k.__webglTexture);const ve=H.source,_e=p.get(ve);delete _e[k.__cacheKey],o.memory.textures--}function L(H){const k=i.get(H);if(H.depthTexture&&H.depthTexture.dispose(),H.isWebGLCubeRenderTarget)for(let _e=0;_e<6;_e++){if(Array.isArray(k.__webglFramebuffer[_e]))for(let Pe=0;Pe<k.__webglFramebuffer[_e].length;Pe++)s.deleteFramebuffer(k.__webglFramebuffer[_e][Pe]);else s.deleteFramebuffer(k.__webglFramebuffer[_e]);k.__webglDepthbuffer&&s.deleteRenderbuffer(k.__webglDepthbuffer[_e])}else{if(Array.isArray(k.__webglFramebuffer))for(let _e=0;_e<k.__webglFramebuffer.length;_e++)s.deleteFramebuffer(k.__webglFramebuffer[_e]);else s.deleteFramebuffer(k.__webglFramebuffer);if(k.__webglDepthbuffer&&s.deleteRenderbuffer(k.__webglDepthbuffer),k.__webglMultisampledFramebuffer&&s.deleteFramebuffer(k.__webglMultisampledFramebuffer),k.__webglColorRenderbuffer)for(let _e=0;_e<k.__webglColorRenderbuffer.length;_e++)k.__webglColorRenderbuffer[_e]&&s.deleteRenderbuffer(k.__webglColorRenderbuffer[_e]);k.__webglDepthRenderbuffer&&s.deleteRenderbuffer(k.__webglDepthRenderbuffer)}const ve=H.textures;for(let _e=0,Pe=ve.length;_e<Pe;_e++){const Me=i.get(ve[_e]);Me.__webglTexture&&(s.deleteTexture(Me.__webglTexture),o.memory.textures--),i.remove(ve[_e])}i.remove(H)}let U=0;function D(){U=0}function V(){const H=U;return H>=n.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+H+" texture units while this GPU supports only "+n.maxTextures),U+=1,H}function O(H){const k=[];return k.push(H.wrapS),k.push(H.wrapT),k.push(H.wrapR||0),k.push(H.magFilter),k.push(H.minFilter),k.push(H.anisotropy),k.push(H.internalFormat),k.push(H.format),k.push(H.type),k.push(H.generateMipmaps),k.push(H.premultiplyAlpha),k.push(H.flipY),k.push(H.unpackAlignment),k.push(H.colorSpace),k.join()}function F(H,k){const ve=i.get(H);if(H.isVideoTexture&&tt(H),H.isRenderTargetTexture===!1&&H.version>0&&ve.__version!==H.version){const _e=H.image;if(_e===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(_e.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Ae(ve,H,k);return}}t.bindTexture(s.TEXTURE_2D,ve.__webglTexture,s.TEXTURE0+k)}function N(H,k){const ve=i.get(H);if(H.version>0&&ve.__version!==H.version){Ae(ve,H,k);return}t.bindTexture(s.TEXTURE_2D_ARRAY,ve.__webglTexture,s.TEXTURE0+k)}function q(H,k){const ve=i.get(H);if(H.version>0&&ve.__version!==H.version){Ae(ve,H,k);return}t.bindTexture(s.TEXTURE_3D,ve.__webglTexture,s.TEXTURE0+k)}function $(H,k){const ve=i.get(H);if(H.version>0&&ve.__version!==H.version){je(ve,H,k);return}t.bindTexture(s.TEXTURE_CUBE_MAP,ve.__webglTexture,s.TEXTURE0+k)}const oe={[wo]:s.REPEAT,[ps]:s.CLAMP_TO_EDGE,[du]:s.MIRRORED_REPEAT},ae={[ei]:s.NEAREST,[Qg]:s.NEAREST_MIPMAP_NEAREST,[zh]:s.NEAREST_MIPMAP_LINEAR,[Nt]:s.LINEAR,[cp]:s.LINEAR_MIPMAP_NEAREST,[go]:s.LINEAR_MIPMAP_LINEAR},Re={[Vz]:s.NEVER,[Yz]:s.ALWAYS,[Qz]:s.LESS,[UP]:s.LEQUAL,[jz]:s.EQUAL,[Xz]:s.GEQUAL,[Wz]:s.GREATER,[qz]:s.NOTEQUAL};function se(H,k,ve){if(k.type===vn&&e.has("OES_texture_float_linear")===!1&&(k.magFilter===Nt||k.magFilter===cp||k.magFilter===zh||k.magFilter===go||k.minFilter===Nt||k.minFilter===cp||k.minFilter===zh||k.minFilter===go)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),ve?(s.texParameteri(H,s.TEXTURE_WRAP_S,oe[k.wrapS]),s.texParameteri(H,s.TEXTURE_WRAP_T,oe[k.wrapT]),(H===s.TEXTURE_3D||H===s.TEXTURE_2D_ARRAY)&&s.texParameteri(H,s.TEXTURE_WRAP_R,oe[k.wrapR]),s.texParameteri(H,s.TEXTURE_MAG_FILTER,ae[k.magFilter]),s.texParameteri(H,s.TEXTURE_MIN_FILTER,ae[k.minFilter])):(s.texParameteri(H,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(H,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),(H===s.TEXTURE_3D||H===s.TEXTURE_2D_ARRAY)&&s.texParameteri(H,s.TEXTURE_WRAP_R,s.CLAMP_TO_EDGE),(k.wrapS!==ps||k.wrapT!==ps)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),s.texParameteri(H,s.TEXTURE_MAG_FILTER,T(k.magFilter)),s.texParameteri(H,s.TEXTURE_MIN_FILTER,T(k.minFilter)),k.minFilter!==ei&&k.minFilter!==Nt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),k.compareFunction&&(s.texParameteri(H,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(H,s.TEXTURE_COMPARE_FUNC,Re[k.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(k.magFilter===ei||k.minFilter!==zh&&k.minFilter!==go||k.type===vn&&e.has("OES_texture_float_linear")===!1||a===!1&&k.type===$i&&e.has("OES_texture_half_float_linear")===!1)return;if(k.anisotropy>1||i.get(k).__currentAnisotropy){const _e=e.get("EXT_texture_filter_anisotropic");s.texParameterf(H,_e.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(k.anisotropy,n.getMaxAnisotropy())),i.get(k).__currentAnisotropy=k.anisotropy}}}function ye(H,k){let ve=!1;H.__webglInit===void 0&&(H.__webglInit=!0,k.addEventListener("dispose",M));const _e=k.source;let Pe=p.get(_e);Pe===void 0&&(Pe={},p.set(_e,Pe));const Me=O(k);if(Me!==H.__cacheKey){Pe[Me]===void 0&&(Pe[Me]={texture:s.createTexture(),usedTimes:0},o.memory.textures++,ve=!0),Pe[Me].usedTimes++;const Ct=Pe[H.__cacheKey];Ct!==void 0&&(Pe[H.__cacheKey].usedTimes--,Ct.usedTimes===0&&I(k)),H.__cacheKey=Me,H.__webglTexture=Pe[Me].texture}return ve}function Ae(H,k,ve){let _e=s.TEXTURE_2D;(k.isDataArrayTexture||k.isCompressedArrayTexture)&&(_e=s.TEXTURE_2D_ARRAY),k.isData3DTexture&&(_e=s.TEXTURE_3D);const Pe=ye(H,k),Me=k.source;t.bindTexture(_e,H.__webglTexture,s.TEXTURE0+ve);const Ct=i.get(Me);if(Me.version!==Ct.__version||Pe===!0){t.activeTexture(s.TEXTURE0+ve);const mt=ki.getPrimaries(ki.workingColorSpace),ke=k.colorSpace===jr?null:ki.getPrimaries(k.colorSpace),Ve=k.colorSpace===jr||mt===ke?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,k.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,k.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ve);const Tt=_(k)&&g(k.image)===!1;let Fe=y(k.image,Tt,!1,n.maxTextureSize);Fe=ct(k,Fe);const ci=g(Fe)||a,gt=r.convert(k.format,k.colorSpace);let Ye=r.convert(k.type),vt=E(k.internalFormat,gt,Ye,k.colorSpace,k.isVideoTexture);se(_e,k,ci);let at;const Gt=k.mipmaps,j=a&&k.isVideoTexture!==!0&&vt!==gC,ce=Ct.__version===void 0||Pe===!0,ee=Me.dataReady,Oe=C(k,Fe,ci);if(k.isDepthTexture)vt=s.DEPTH_COMPONENT,a?k.type===vn?vt=s.DEPTH_COMPONENT32F:k.type===El?vt=s.DEPTH_COMPONENT24:k.type===tu?vt=s.DEPTH24_STENCIL8:vt=s.DEPTH_COMPONENT16:k.type===vn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),k.format===md&&vt===s.DEPTH_COMPONENT&&k.type!==pC&&k.type!==El&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),k.type=El,Ye=r.convert(k.type)),k.format===Md&&vt===s.DEPTH_COMPONENT&&(vt=s.DEPTH_STENCIL,k.type!==tu&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),k.type=tu,Ye=r.convert(k.type))),ce&&(j?t.texStorage2D(s.TEXTURE_2D,1,vt,Fe.width,Fe.height):t.texImage2D(s.TEXTURE_2D,0,vt,Fe.width,Fe.height,0,gt,Ye,null));else if(k.isDataTexture)if(Gt.length>0&&ci){j&&ce&&t.texStorage2D(s.TEXTURE_2D,Oe,vt,Gt[0].width,Gt[0].height);for(let he=0,He=Gt.length;he<He;he++)at=Gt[he],j?ee&&t.texSubImage2D(s.TEXTURE_2D,he,0,0,at.width,at.height,gt,Ye,at.data):t.texImage2D(s.TEXTURE_2D,he,vt,at.width,at.height,0,gt,Ye,at.data);k.generateMipmaps=!1}else j?(ce&&t.texStorage2D(s.TEXTURE_2D,Oe,vt,Fe.width,Fe.height),ee&&t.texSubImage2D(s.TEXTURE_2D,0,0,0,Fe.width,Fe.height,gt,Ye,Fe.data)):t.texImage2D(s.TEXTURE_2D,0,vt,Fe.width,Fe.height,0,gt,Ye,Fe.data);else if(k.isCompressedTexture)if(k.isCompressedArrayTexture){j&&ce&&t.texStorage3D(s.TEXTURE_2D_ARRAY,Oe,vt,Gt[0].width,Gt[0].height,Fe.depth);for(let he=0,He=Gt.length;he<He;he++)at=Gt[he],k.format!==Ti?gt!==null?j?ee&&t.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,he,0,0,0,at.width,at.height,Fe.depth,gt,at.data,0,0):t.compressedTexImage3D(s.TEXTURE_2D_ARRAY,he,vt,at.width,at.height,Fe.depth,0,at.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):j?ee&&t.texSubImage3D(s.TEXTURE_2D_ARRAY,he,0,0,0,at.width,at.height,Fe.depth,gt,Ye,at.data):t.texImage3D(s.TEXTURE_2D_ARRAY,he,vt,at.width,at.height,Fe.depth,0,gt,Ye,at.data)}else{j&&ce&&t.texStorage2D(s.TEXTURE_2D,Oe,vt,Gt[0].width,Gt[0].height);for(let he=0,He=Gt.length;he<He;he++)at=Gt[he],k.format!==Ti?gt!==null?j?ee&&t.compressedTexSubImage2D(s.TEXTURE_2D,he,0,0,at.width,at.height,gt,at.data):t.compressedTexImage2D(s.TEXTURE_2D,he,vt,at.width,at.height,0,at.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):j?ee&&t.texSubImage2D(s.TEXTURE_2D,he,0,0,at.width,at.height,gt,Ye,at.data):t.texImage2D(s.TEXTURE_2D,he,vt,at.width,at.height,0,gt,Ye,at.data)}else if(k.isDataArrayTexture)j?(ce&&t.texStorage3D(s.TEXTURE_2D_ARRAY,Oe,vt,Fe.width,Fe.height,Fe.depth),ee&&t.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,0,Fe.width,Fe.height,Fe.depth,gt,Ye,Fe.data)):t.texImage3D(s.TEXTURE_2D_ARRAY,0,vt,Fe.width,Fe.height,Fe.depth,0,gt,Ye,Fe.data);else if(k.isData3DTexture)j?(ce&&t.texStorage3D(s.TEXTURE_3D,Oe,vt,Fe.width,Fe.height,Fe.depth),ee&&t.texSubImage3D(s.TEXTURE_3D,0,0,0,0,Fe.width,Fe.height,Fe.depth,gt,Ye,Fe.data)):t.texImage3D(s.TEXTURE_3D,0,vt,Fe.width,Fe.height,Fe.depth,0,gt,Ye,Fe.data);else if(k.isFramebufferTexture){if(ce)if(j)t.texStorage2D(s.TEXTURE_2D,Oe,vt,Fe.width,Fe.height);else{let he=Fe.width,He=Fe.height;for(let Ke=0;Ke<Oe;Ke++)t.texImage2D(s.TEXTURE_2D,Ke,vt,he,He,0,gt,Ye,null),he>>=1,He>>=1}}else if(Gt.length>0&&ci){if(j&&ce){const he=jt(Gt[0]);t.texStorage2D(s.TEXTURE_2D,Oe,vt,he.width,he.height)}for(let he=0,He=Gt.length;he<He;he++)at=Gt[he],j?ee&&t.texSubImage2D(s.TEXTURE_2D,he,0,0,gt,Ye,at):t.texImage2D(s.TEXTURE_2D,he,vt,gt,Ye,at);k.generateMipmaps=!1}else if(j){if(ce){const he=jt(Fe);t.texStorage2D(s.TEXTURE_2D,Oe,vt,he.width,he.height)}ee&&t.texSubImage2D(s.TEXTURE_2D,0,0,0,gt,Ye,Fe)}else t.texImage2D(s.TEXTURE_2D,0,vt,gt,Ye,Fe);A(k,ci)&&b(_e),Ct.__version=Me.version,k.onUpdate&&k.onUpdate(k)}H.__version=k.version}function je(H,k,ve){if(k.image.length!==6)return;const _e=ye(H,k),Pe=k.source;t.bindTexture(s.TEXTURE_CUBE_MAP,H.__webglTexture,s.TEXTURE0+ve);const Me=i.get(Pe);if(Pe.version!==Me.__version||_e===!0){t.activeTexture(s.TEXTURE0+ve);const Ct=ki.getPrimaries(ki.workingColorSpace),mt=k.colorSpace===jr?null:ki.getPrimaries(k.colorSpace),ke=k.colorSpace===jr||Ct===mt?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,k.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,k.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,ke);const Ve=k.isCompressedTexture||k.image[0].isCompressedTexture,Tt=k.image[0]&&k.image[0].isDataTexture,Fe=[];for(let he=0;he<6;he++)!Ve&&!Tt?Fe[he]=y(k.image[he],!1,!0,n.maxCubemapSize):Fe[he]=Tt?k.image[he].image:k.image[he],Fe[he]=ct(k,Fe[he]);const ci=Fe[0],gt=g(ci)||a,Ye=r.convert(k.format,k.colorSpace),vt=r.convert(k.type),at=E(k.internalFormat,Ye,vt,k.colorSpace),Gt=a&&k.isVideoTexture!==!0,j=Me.__version===void 0||_e===!0,ce=Pe.dataReady;let ee=C(k,ci,gt);se(s.TEXTURE_CUBE_MAP,k,gt);let Oe;if(Ve){Gt&&j&&t.texStorage2D(s.TEXTURE_CUBE_MAP,ee,at,ci.width,ci.height);for(let he=0;he<6;he++){Oe=Fe[he].mipmaps;for(let He=0;He<Oe.length;He++){const Ke=Oe[He];k.format!==Ti?Ye!==null?Gt?ce&&t.compressedTexSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,He,0,0,Ke.width,Ke.height,Ye,Ke.data):t.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,He,at,Ke.width,Ke.height,0,Ke.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Gt?ce&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,He,0,0,Ke.width,Ke.height,Ye,vt,Ke.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,He,at,Ke.width,Ke.height,0,Ye,vt,Ke.data)}}}else{if(Oe=k.mipmaps,Gt&&j){Oe.length>0&&ee++;const he=jt(Fe[0]);t.texStorage2D(s.TEXTURE_CUBE_MAP,ee,at,he.width,he.height)}for(let he=0;he<6;he++)if(Tt){Gt?ce&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,0,0,Fe[he].width,Fe[he].height,Ye,vt,Fe[he].data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,at,Fe[he].width,Fe[he].height,0,Ye,vt,Fe[he].data);for(let He=0;He<Oe.length;He++){const hi=Oe[He].image[he].image;Gt?ce&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,He+1,0,0,hi.width,hi.height,Ye,vt,hi.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,He+1,at,hi.width,hi.height,0,Ye,vt,hi.data)}}else{Gt?ce&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,0,0,Ye,vt,Fe[he]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,at,Ye,vt,Fe[he]);for(let He=0;He<Oe.length;He++){const Ke=Oe[He];Gt?ce&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,He+1,0,0,Ye,vt,Ke.image[he]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,He+1,at,Ye,vt,Ke.image[he])}}}A(k,gt)&&b(s.TEXTURE_CUBE_MAP),Me.__version=Pe.version,k.onUpdate&&k.onUpdate(k)}H.__version=k.version}function Be(H,k,ve,_e,Pe,Me){const Ct=r.convert(ve.format,ve.colorSpace),mt=r.convert(ve.type),ke=E(ve.internalFormat,Ct,mt,ve.colorSpace);if(!i.get(k).__hasExternalTextures){const Tt=Math.max(1,k.width>>Me),Fe=Math.max(1,k.height>>Me);Pe===s.TEXTURE_3D||Pe===s.TEXTURE_2D_ARRAY?t.texImage3D(Pe,Me,ke,Tt,Fe,k.depth,0,Ct,mt,null):t.texImage2D(Pe,Me,ke,Tt,Fe,0,Ct,mt,null)}t.bindFramebuffer(s.FRAMEBUFFER,H),st(k)?l.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,_e,Pe,i.get(ve).__webglTexture,0,Ee(k)):(Pe===s.TEXTURE_2D||Pe>=s.TEXTURE_CUBE_MAP_POSITIVE_X&&Pe<=s.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&s.framebufferTexture2D(s.FRAMEBUFFER,_e,Pe,i.get(ve).__webglTexture,Me),t.bindFramebuffer(s.FRAMEBUFFER,null)}function We(H,k,ve){if(s.bindRenderbuffer(s.RENDERBUFFER,H),k.depthBuffer&&!k.stencilBuffer){let _e=a===!0?s.DEPTH_COMPONENT24:s.DEPTH_COMPONENT16;if(ve||st(k)){const Pe=k.depthTexture;Pe&&Pe.isDepthTexture&&(Pe.type===vn?_e=s.DEPTH_COMPONENT32F:Pe.type===El&&(_e=s.DEPTH_COMPONENT24));const Me=Ee(k);st(k)?l.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,Me,_e,k.width,k.height):s.renderbufferStorageMultisample(s.RENDERBUFFER,Me,_e,k.width,k.height)}else s.renderbufferStorage(s.RENDERBUFFER,_e,k.width,k.height);s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,H)}else if(k.depthBuffer&&k.stencilBuffer){const _e=Ee(k);ve&&st(k)===!1?s.renderbufferStorageMultisample(s.RENDERBUFFER,_e,s.DEPTH24_STENCIL8,k.width,k.height):st(k)?l.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,_e,s.DEPTH24_STENCIL8,k.width,k.height):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,k.width,k.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,H)}else{const _e=k.textures;for(let Pe=0;Pe<_e.length;Pe++){const Me=_e[Pe],Ct=r.convert(Me.format,Me.colorSpace),mt=r.convert(Me.type),ke=E(Me.internalFormat,Ct,mt,Me.colorSpace),Ve=Ee(k);ve&&st(k)===!1?s.renderbufferStorageMultisample(s.RENDERBUFFER,Ve,ke,k.width,k.height):st(k)?l.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,Ve,ke,k.width,k.height):s.renderbufferStorage(s.RENDERBUFFER,ke,k.width,k.height)}}s.bindRenderbuffer(s.RENDERBUFFER,null)}function lt(H,k){if(k&&k.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(s.FRAMEBUFFER,H),!(k.depthTexture&&k.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(k.depthTexture).__webglTexture||k.depthTexture.image.width!==k.width||k.depthTexture.image.height!==k.height)&&(k.depthTexture.image.width=k.width,k.depthTexture.image.height=k.height,k.depthTexture.needsUpdate=!0),F(k.depthTexture,0);const _e=i.get(k.depthTexture).__webglTexture,Pe=Ee(k);if(k.depthTexture.format===md)st(k)?l.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,_e,0,Pe):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,_e,0);else if(k.depthTexture.format===Md)st(k)?l.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,_e,0,Pe):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,_e,0);else throw new Error("Unknown depthTexture format")}function rt(H){const k=i.get(H),ve=H.isWebGLCubeRenderTarget===!0;if(H.depthTexture&&!k.__autoAllocateDepthBuffer){if(ve)throw new Error("target.depthTexture not supported in Cube render targets");lt(k.__webglFramebuffer,H)}else if(ve){k.__webglDepthbuffer=[];for(let _e=0;_e<6;_e++)t.bindFramebuffer(s.FRAMEBUFFER,k.__webglFramebuffer[_e]),k.__webglDepthbuffer[_e]=s.createRenderbuffer(),We(k.__webglDepthbuffer[_e],H,!1)}else t.bindFramebuffer(s.FRAMEBUFFER,k.__webglFramebuffer),k.__webglDepthbuffer=s.createRenderbuffer(),We(k.__webglDepthbuffer,H,!1);t.bindFramebuffer(s.FRAMEBUFFER,null)}function W(H,k,ve){const _e=i.get(H);k!==void 0&&Be(_e.__webglFramebuffer,H,H.texture,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,0),ve!==void 0&&rt(H)}function Ge(H){const k=H.texture,ve=i.get(H),_e=i.get(k);H.addEventListener("dispose",R);const Pe=H.textures,Me=H.isWebGLCubeRenderTarget===!0,Ct=Pe.length>1,mt=g(H)||a;if(Ct||(_e.__webglTexture===void 0&&(_e.__webglTexture=s.createTexture()),_e.__version=k.version,o.memory.textures++),Me){ve.__webglFramebuffer=[];for(let ke=0;ke<6;ke++)if(a&&k.mipmaps&&k.mipmaps.length>0){ve.__webglFramebuffer[ke]=[];for(let Ve=0;Ve<k.mipmaps.length;Ve++)ve.__webglFramebuffer[ke][Ve]=s.createFramebuffer()}else ve.__webglFramebuffer[ke]=s.createFramebuffer()}else{if(a&&k.mipmaps&&k.mipmaps.length>0){ve.__webglFramebuffer=[];for(let ke=0;ke<k.mipmaps.length;ke++)ve.__webglFramebuffer[ke]=s.createFramebuffer()}else ve.__webglFramebuffer=s.createFramebuffer();if(Ct)if(n.drawBuffers)for(let ke=0,Ve=Pe.length;ke<Ve;ke++){const Tt=i.get(Pe[ke]);Tt.__webglTexture===void 0&&(Tt.__webglTexture=s.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&H.samples>0&&st(H)===!1){ve.__webglMultisampledFramebuffer=s.createFramebuffer(),ve.__webglColorRenderbuffer=[],t.bindFramebuffer(s.FRAMEBUFFER,ve.__webglMultisampledFramebuffer);for(let ke=0;ke<Pe.length;ke++){const Ve=Pe[ke];ve.__webglColorRenderbuffer[ke]=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,ve.__webglColorRenderbuffer[ke]);const Tt=r.convert(Ve.format,Ve.colorSpace),Fe=r.convert(Ve.type),ci=E(Ve.internalFormat,Tt,Fe,Ve.colorSpace,H.isXRRenderTarget===!0),gt=Ee(H);s.renderbufferStorageMultisample(s.RENDERBUFFER,gt,ci,H.width,H.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+ke,s.RENDERBUFFER,ve.__webglColorRenderbuffer[ke])}s.bindRenderbuffer(s.RENDERBUFFER,null),H.depthBuffer&&(ve.__webglDepthRenderbuffer=s.createRenderbuffer(),We(ve.__webglDepthRenderbuffer,H,!0)),t.bindFramebuffer(s.FRAMEBUFFER,null)}}if(Me){t.bindTexture(s.TEXTURE_CUBE_MAP,_e.__webglTexture),se(s.TEXTURE_CUBE_MAP,k,mt);for(let ke=0;ke<6;ke++)if(a&&k.mipmaps&&k.mipmaps.length>0)for(let Ve=0;Ve<k.mipmaps.length;Ve++)Be(ve.__webglFramebuffer[ke][Ve],H,k,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+ke,Ve);else Be(ve.__webglFramebuffer[ke],H,k,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0);A(k,mt)&&b(s.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Ct){for(let ke=0,Ve=Pe.length;ke<Ve;ke++){const Tt=Pe[ke],Fe=i.get(Tt);t.bindTexture(s.TEXTURE_2D,Fe.__webglTexture),se(s.TEXTURE_2D,Tt,mt),Be(ve.__webglFramebuffer,H,Tt,s.COLOR_ATTACHMENT0+ke,s.TEXTURE_2D,0),A(Tt,mt)&&b(s.TEXTURE_2D)}t.unbindTexture()}else{let ke=s.TEXTURE_2D;if((H.isWebGL3DRenderTarget||H.isWebGLArrayRenderTarget)&&(a?ke=H.isWebGL3DRenderTarget?s.TEXTURE_3D:s.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(ke,_e.__webglTexture),se(ke,k,mt),a&&k.mipmaps&&k.mipmaps.length>0)for(let Ve=0;Ve<k.mipmaps.length;Ve++)Be(ve.__webglFramebuffer[Ve],H,k,s.COLOR_ATTACHMENT0,ke,Ve);else Be(ve.__webglFramebuffer,H,k,s.COLOR_ATTACHMENT0,ke,0);A(k,mt)&&b(ke),t.unbindTexture()}H.depthBuffer&&rt(H)}function we(H){const k=g(H)||a,ve=H.textures;for(let _e=0,Pe=ve.length;_e<Pe;_e++){const Me=ve[_e];if(A(Me,k)){const Ct=H.isWebGLCubeRenderTarget?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D,mt=i.get(Me).__webglTexture;t.bindTexture(Ct,mt),b(Ct),t.unbindTexture()}}}function Ne(H){if(a&&H.samples>0&&st(H)===!1){const k=H.textures,ve=H.width,_e=H.height;let Pe=s.COLOR_BUFFER_BIT;const Me=[],Ct=H.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,mt=i.get(H),ke=k.length>1;if(ke)for(let Ve=0;Ve<k.length;Ve++)t.bindFramebuffer(s.FRAMEBUFFER,mt.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Ve,s.RENDERBUFFER,null),t.bindFramebuffer(s.FRAMEBUFFER,mt.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+Ve,s.TEXTURE_2D,null,0);t.bindFramebuffer(s.READ_FRAMEBUFFER,mt.__webglMultisampledFramebuffer),t.bindFramebuffer(s.DRAW_FRAMEBUFFER,mt.__webglFramebuffer);for(let Ve=0;Ve<k.length;Ve++){Me.push(s.COLOR_ATTACHMENT0+Ve),H.depthBuffer&&Me.push(Ct);const Tt=mt.__ignoreDepthValues!==void 0?mt.__ignoreDepthValues:!1;if(Tt===!1&&(H.depthBuffer&&(Pe|=s.DEPTH_BUFFER_BIT),H.stencilBuffer&&(Pe|=s.STENCIL_BUFFER_BIT)),ke&&s.framebufferRenderbuffer(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,mt.__webglColorRenderbuffer[Ve]),Tt===!0&&(s.invalidateFramebuffer(s.READ_FRAMEBUFFER,[Ct]),s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,[Ct])),ke){const Fe=i.get(k[Ve]).__webglTexture;s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,Fe,0)}s.blitFramebuffer(0,0,ve,_e,0,0,ve,_e,Pe,s.NEAREST),c&&s.invalidateFramebuffer(s.READ_FRAMEBUFFER,Me)}if(t.bindFramebuffer(s.READ_FRAMEBUFFER,null),t.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),ke)for(let Ve=0;Ve<k.length;Ve++){t.bindFramebuffer(s.FRAMEBUFFER,mt.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Ve,s.RENDERBUFFER,mt.__webglColorRenderbuffer[Ve]);const Tt=i.get(k[Ve]).__webglTexture;t.bindFramebuffer(s.FRAMEBUFFER,mt.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+Ve,s.TEXTURE_2D,Tt,0)}t.bindFramebuffer(s.DRAW_FRAMEBUFFER,mt.__webglMultisampledFramebuffer)}}function Ee(H){return Math.min(n.maxSamples,H.samples)}function st(H){const k=i.get(H);return a&&H.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&k.__useRenderToTexture!==!1}function tt(H){const k=o.render.frame;d.get(H)!==k&&(d.set(H,k),H.update())}function ct(H,k){const ve=H.colorSpace,_e=H.format,Pe=H.type;return H.isCompressedTexture===!0||H.isVideoTexture===!0||H.format===Ww||ve!==Ui&&ve!==jr&&(ki.getTransfer(ve)===on?a===!1?e.has("EXT_sRGB")===!0&&_e===Ti?(H.format=Ww,H.minFilter=Nt,H.generateMipmaps=!1):k=zP.sRGBToLinear(k):(_e!==Ti||Pe!==Ri)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ve)),k}function jt(H){return typeof HTMLImageElement<"u"&&H instanceof HTMLImageElement?(h.width=H.naturalWidth||H.width,h.height=H.naturalHeight||H.height):typeof VideoFrame<"u"&&H instanceof VideoFrame?(h.width=H.displayWidth,h.height=H.displayHeight):(h.width=H.width,h.height=H.height),h}this.allocateTextureUnit=V,this.resetTextureUnits=D,this.setTexture2D=F,this.setTexture2DArray=N,this.setTexture3D=q,this.setTextureCube=$,this.rebindTextures=W,this.setupRenderTarget=Ge,this.updateRenderTargetMipmap=we,this.updateMultisampleRenderTarget=Ne,this.setupDepthRenderbuffer=rt,this.setupFrameBufferTexture=Be,this.useMultisampledRTT=st}function l4(s,e,t){const i=t.isWebGL2;function n(r,o=jr){let a;const l=ki.getTransfer(o);if(r===Ri)return s.UNSIGNED_BYTE;if(r===RP)return s.UNSIGNED_SHORT_4_4_4_4;if(r===PP)return s.UNSIGNED_SHORT_5_5_5_1;if(r===bz)return s.BYTE;if(r===xz)return s.SHORT;if(r===pC)return s.UNSIGNED_SHORT;if(r===IP)return s.INT;if(r===El)return s.UNSIGNED_INT;if(r===vn)return s.FLOAT;if(r===$i)return i?s.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(r===wz)return s.ALPHA;if(r===Ti)return s.RGBA;if(r===mC)return s.LUMINANCE;if(r===Sz)return s.LUMINANCE_ALPHA;if(r===md)return s.DEPTH_COMPONENT;if(r===Md)return s.DEPTH_STENCIL;if(r===Ww)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(r===Tl)return s.RED;if(r===BP)return s.RED_INTEGER;if(r===ld)return s.RG;if(r===DP)return s.RG_INTEGER;if(r===OP)return s.RGBA_INTEGER;if(r===iA||r===rw||r===ow||r===nA)if(l===on)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(r===iA)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===rw)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===ow)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===nA)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===iA)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===rw)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===ow)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===nA)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===Uw||r===cI||r===Nw||r===hI)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===Uw)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===cI)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Nw)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===hI)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===gC)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===zw||r===Gw)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(r===zw)return l===on?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===Gw)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===Hw||r===uI||r===dI||r===fI||r===XA||r===pI||r===mI||r===gI||r===vI||r===yI||r===AI||r===_I||r===bI||r===xI)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(r===Hw)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===uI)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===dI)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===fI)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===XA)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===pI)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===mI)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===gI)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===vI)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===yI)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===AI)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===_I)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===bI)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===xI)return l===on?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===sA||r===wI||r===SI)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(r===sA)return l===on?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===wI)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===SI)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===Cz||r===CI||r===EI||r===TI)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(r===sA)return a.COMPRESSED_RED_RGTC1_EXT;if(r===CI)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===EI)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===TI)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===tu?i?s.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):s[r]!==void 0?s[r]:null}return{convert:n}}class WP extends zt{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class vs extends ge{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Qq={type:"move"};class k1{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new vs,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new vs,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new w,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new w),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new vs,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new w,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new w),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const v of e.hand.values()){const y=t.getJointPose(v,i),g=this._getHandJoint(c,v);y!==null&&(g.matrix.fromArray(y.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=y.radius),g.visible=y!==null}const h=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],f=h.position.distanceTo(d.position),p=.02,m=.005;c.inputState.pinching&&f>p+m?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&f<=p-m&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(n=t.getPose(e.targetRaySpace,i),n===null&&r!==null&&(n=r),n!==null&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Qq)))}return a!==null&&(a.visible=n!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new vs;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const jq=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Wq=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class qq{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const n=new Pt,r=e.properties.get(n);r.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=n}}render(e,t){if(this.texture!==null){if(this.mesh===null){const i=t.cameras[0].viewport,n=new Rt({extensions:{fragDepth:!0},vertexShader:jq,fragmentShader:Wq,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new le(new _s(20,20),n)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}}class Xq extends Zs{constructor(e,t){super();const i=this;let n=null,r=1,o=null,a="local-floor",l=1,c=null,h=null,d=null,f=null,p=null,m=null;const v=new qq,y=t.getContextAttributes();let g=null,_=null;const A=[],b=[],E=new Z;let C=null;const T=new zt;T.layers.enable(1),T.viewport=new Je;const M=new zt;M.layers.enable(2),M.viewport=new Je;const R=[T,M],S=new WP;S.layers.enable(1),S.layers.enable(2);let I=null,L=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.controllerAutoUpdate=!0,this.getController=function(se){let ye=A[se];return ye===void 0&&(ye=new k1,A[se]=ye),ye.getTargetRaySpace()},this.getControllerGrip=function(se){let ye=A[se];return ye===void 0&&(ye=new k1,A[se]=ye),ye.getGripSpace()},this.getHand=function(se){let ye=A[se];return ye===void 0&&(ye=new k1,A[se]=ye),ye.getHandSpace()};function U(se){const ye=b.indexOf(se.inputSource);if(ye===-1)return;const Ae=A[ye];Ae!==void 0&&(Ae.update(se.inputSource,se.frame,c||o),Ae.dispatchEvent({type:se.type,data:se.inputSource}))}function D(){var se;n.removeEventListener("select",U),n.removeEventListener("selectstart",U),n.removeEventListener("selectend",U),n.removeEventListener("squeeze",U),n.removeEventListener("squeezestart",U),n.removeEventListener("squeezeend",U),n.removeEventListener("end",D),n.removeEventListener("inputsourceschange",V);for(let ye=0;ye<A.length;ye++){const Ae=b[ye];Ae!==null&&(b[ye]=null,(se=A[ye])==null||se.disconnect(Ae))}I=null,L=null,v.reset(),e.setRenderTarget(g),p=null,f=null,d=null,n=null,_=null,Re.stop(),i.isPresenting=!1,e.setPixelRatio(C),e.setSize(E.width,E.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(se){r=se,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(se){a=se,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(se){c=se},this.getBaseLayer=function(){return f!==null?f:p},this.getBinding=function(){return d},this.getFrame=function(){return m},this.getSession=function(){return n},this.setSession=async function(se){if(n=se,n!==null){if(g=e.getRenderTarget(),n.addEventListener("select",U),n.addEventListener("selectstart",U),n.addEventListener("selectend",U),n.addEventListener("squeeze",U),n.addEventListener("squeezestart",U),n.addEventListener("squeezeend",U),n.addEventListener("end",D),n.addEventListener("inputsourceschange",V),y.xrCompatible!==!0&&await t.makeXRCompatible(),C=e.getPixelRatio(),e.getSize(E),n.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const ye={antialias:n.renderState.layers===void 0?y.antialias:!0,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:r};p=new XRWebGLLayer(n,t,ye),n.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),_=new Yt(p.framebufferWidth,p.framebufferHeight,{format:Ti,type:Ri,colorSpace:e.outputColorSpace,stencilBuffer:y.stencil})}else{let ye=null,Ae=null,je=null;y.depth&&(je=y.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ye=y.stencil?Md:md,Ae=y.stencil?tu:El);const Be={colorFormat:t.RGBA8,depthFormat:je,scaleFactor:r};d=new XRWebGLBinding(n,t),f=d.createProjectionLayer(Be),n.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),_=new Yt(f.textureWidth,f.textureHeight,{format:Ti,type:Ri,depthTexture:new mv(f.textureWidth,f.textureHeight,Ae,void 0,void 0,void 0,void 0,void 0,void 0,ye),stencilBuffer:y.stencil,colorSpace:e.outputColorSpace,samples:y.antialias?4:0});const We=e.properties.get(_);We.__ignoreDepthValues=f.ignoreDepthValues}_.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await n.requestReferenceSpace(a),Re.setContext(n),Re.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(n!==null)return n.environmentBlendMode};function V(se){var ye;for(let Ae=0;Ae<se.removed.length;Ae++){const je=se.removed[Ae],Be=b.indexOf(je);Be>=0&&(b[Be]=null,(ye=A[Be])==null||ye.disconnect(je))}for(let Ae=0;Ae<se.added.length;Ae++){const je=se.added[Ae];let Be=b.indexOf(je);if(Be===-1){for(let lt=0;lt<A.length;lt++)if(lt>=b.length){b.push(je),Be=lt;break}else if(b[lt]===null){b[lt]=je,Be=lt;break}if(Be===-1)break}const We=A[Be];We&&We.connect(je)}}const O=new w,F=new w;function N(se,ye,Ae){O.setFromMatrixPosition(ye.matrixWorld),F.setFromMatrixPosition(Ae.matrixWorld);const je=O.distanceTo(F),Be=ye.projectionMatrix.elements,We=Ae.projectionMatrix.elements,lt=Be[14]/(Be[10]-1),rt=Be[14]/(Be[10]+1),W=(Be[9]+1)/Be[5],Ge=(Be[9]-1)/Be[5],we=(Be[8]-1)/Be[0],Ne=(We[8]+1)/We[0],Ee=lt*we,st=lt*Ne,tt=je/(-we+Ne),ct=tt*-we;ye.matrixWorld.decompose(se.position,se.quaternion,se.scale),se.translateX(ct),se.translateZ(tt),se.matrixWorld.compose(se.position,se.quaternion,se.scale),se.matrixWorldInverse.copy(se.matrixWorld).invert();const jt=lt+tt,H=rt+tt,k=Ee-ct,ve=st+(je-ct),_e=W*rt/H*jt,Pe=Ge*rt/H*jt;se.projectionMatrix.makePerspective(k,ve,_e,Pe,jt,H),se.projectionMatrixInverse.copy(se.projectionMatrix).invert()}function q(se,ye){ye===null?se.matrixWorld.copy(se.matrix):se.matrixWorld.multiplyMatrices(ye.matrixWorld,se.matrix),se.matrixWorldInverse.copy(se.matrixWorld).invert()}this.updateCamera=function(se){if(n===null)return;v.texture!==null&&(v.depthNear>0&&(se.near=v.depthNear),v.depthFar>0&&(se.far=v.depthFar)),S.near=M.near=T.near=se.near,S.far=M.far=T.far=se.far,(I!==S.near||L!==S.far)&&(n.updateRenderState({depthNear:S.near,depthFar:S.far}),I=S.near,L=S.far,T.near=I,T.far=L,M.near=I,M.far=L,T.updateProjectionMatrix(),M.updateProjectionMatrix(),se.updateProjectionMatrix());const ye=se.parent,Ae=S.cameras;q(S,ye);for(let je=0;je<Ae.length;je++)q(Ae[je],ye);Ae.length===2?N(S,T,M):S.projectionMatrix.copy(T.projectionMatrix),$(se,S,ye)};function $(se,ye,Ae){Ae===null?se.matrix.copy(ye.matrixWorld):(se.matrix.copy(Ae.matrixWorld),se.matrix.invert(),se.matrix.multiply(ye.matrixWorld)),se.matrix.decompose(se.position,se.quaternion,se.scale),se.updateMatrixWorld(!0),se.projectionMatrix.copy(ye.projectionMatrix),se.projectionMatrixInverse.copy(ye.projectionMatrixInverse),se.isPerspectiveCamera&&(se.fov=jg*2*Math.atan(1/se.projectionMatrix.elements[5]),se.zoom=1)}this.getCamera=function(){return S},this.getFoveation=function(){if(!(f===null&&p===null))return l},this.setFoveation=function(se){l=se,f!==null&&(f.fixedFoveation=se),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=se)},this.hasDepthSensing=function(){return v.texture!==null};let oe=null;function ae(se,ye){if(h=ye.getViewerPose(c||o),m=ye,h!==null){const Ae=h.views;p!==null&&(e.setRenderTargetFramebuffer(_,p.framebuffer),e.setRenderTarget(_));let je=!1;Ae.length!==S.cameras.length&&(S.cameras.length=0,je=!0);for(let We=0;We<Ae.length;We++){const lt=Ae[We];let rt=null;if(p!==null)rt=p.getViewport(lt);else{const Ge=d.getViewSubImage(f,lt);rt=Ge.viewport,We===0&&(e.setRenderTargetTextures(_,Ge.colorTexture,f.ignoreDepthValues?void 0:Ge.depthStencilTexture),e.setRenderTarget(_))}let W=R[We];W===void 0&&(W=new zt,W.layers.enable(We),W.viewport=new Je,R[We]=W),W.matrix.fromArray(lt.transform.matrix),W.matrix.decompose(W.position,W.quaternion,W.scale),W.projectionMatrix.fromArray(lt.projectionMatrix),W.projectionMatrixInverse.copy(W.projectionMatrix).invert(),W.viewport.set(rt.x,rt.y,rt.width,rt.height),We===0&&(S.matrix.copy(W.matrix),S.matrix.decompose(S.position,S.quaternion,S.scale)),je===!0&&S.cameras.push(W)}const Be=n.enabledFeatures;if(Be&&Be.includes("depth-sensing")){const We=d.getDepthInformation(Ae[0]);We&&We.isValid&&We.texture&&v.init(e,We,n.renderState)}}if(i.controllerAutoUpdate)for(let Ae=0;Ae<A.length;Ae++){const je=b[Ae],Be=A[Ae];je!==null&&Be!==void 0&&Be.update(je,ye,c||o)}v.render(e,S),oe&&oe(se,ye),ye.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:ye}),m=null}const Re=new i4;Re.setAnimationLoop(ae),this.setAnimationLoop=function(se){oe=se},this.dispose=function(){}}}const pf=new oi,Yq=new fe;function Kq(s,e){function t(y,g){y.matrixAutoUpdate===!0&&y.updateMatrix(),g.value.copy(y.matrix)}function i(y,g){g.color.getRGB(y.fogColor.value,t4(s)),g.isFog?(y.fogNear.value=g.near,y.fogFar.value=g.far):g.isFogExp2&&(y.fogDensity.value=g.density)}function n(y,g,_,A,b){g.isMeshBasicMaterial||g.isMeshLambertMaterial?r(y,g):g.isMeshToonMaterial?(r(y,g),d(y,g)):g.isMeshPhongMaterial?(r(y,g),h(y,g)):g.isMeshStandardMaterial?(r(y,g),f(y,g),g.isMeshPhysicalMaterial&&p(y,g,b)):g.isMeshMatcapMaterial?(r(y,g),m(y,g)):g.isMeshDepthMaterial?r(y,g):g.isMeshDistanceMaterial?(r(y,g),v(y,g)):g.isMeshNormalMaterial?r(y,g):g.isLineBasicMaterial?(o(y,g),g.isLineDashedMaterial&&a(y,g)):g.isPointsMaterial?l(y,g,_,A):g.isSpriteMaterial?c(y,g):g.isShadowMaterial?(y.color.value.copy(g.color),y.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function r(y,g){y.opacity.value=g.opacity,g.color&&y.diffuse.value.copy(g.color),g.emissive&&y.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(y.map.value=g.map,t(g.map,y.mapTransform)),g.alphaMap&&(y.alphaMap.value=g.alphaMap,t(g.alphaMap,y.alphaMapTransform)),g.bumpMap&&(y.bumpMap.value=g.bumpMap,t(g.bumpMap,y.bumpMapTransform),y.bumpScale.value=g.bumpScale,g.side===Gn&&(y.bumpScale.value*=-1)),g.normalMap&&(y.normalMap.value=g.normalMap,t(g.normalMap,y.normalMapTransform),y.normalScale.value.copy(g.normalScale),g.side===Gn&&y.normalScale.value.negate()),g.displacementMap&&(y.displacementMap.value=g.displacementMap,t(g.displacementMap,y.displacementMapTransform),y.displacementScale.value=g.displacementScale,y.displacementBias.value=g.displacementBias),g.emissiveMap&&(y.emissiveMap.value=g.emissiveMap,t(g.emissiveMap,y.emissiveMapTransform)),g.specularMap&&(y.specularMap.value=g.specularMap,t(g.specularMap,y.specularMapTransform)),g.alphaTest>0&&(y.alphaTest.value=g.alphaTest);const _=e.get(g),A=_.envMap,b=_.envMapRotation;if(A&&(y.envMap.value=A,pf.copy(b),pf.x*=-1,pf.y*=-1,pf.z*=-1,A.isCubeTexture&&A.isRenderTargetTexture===!1&&(pf.y*=-1,pf.z*=-1),y.envMapRotation.value.setFromMatrix4(Yq.makeRotationFromEuler(pf)),y.flipEnvMap.value=A.isCubeTexture&&A.isRenderTargetTexture===!1?-1:1,y.reflectivity.value=g.reflectivity,y.ior.value=g.ior,y.refractionRatio.value=g.refractionRatio),g.lightMap){y.lightMap.value=g.lightMap;const E=s._useLegacyLights===!0?Math.PI:1;y.lightMapIntensity.value=g.lightMapIntensity*E,t(g.lightMap,y.lightMapTransform)}g.aoMap&&(y.aoMap.value=g.aoMap,y.aoMapIntensity.value=g.aoMapIntensity,t(g.aoMap,y.aoMapTransform))}function o(y,g){y.diffuse.value.copy(g.color),y.opacity.value=g.opacity,g.map&&(y.map.value=g.map,t(g.map,y.mapTransform))}function a(y,g){y.dashSize.value=g.dashSize,y.totalSize.value=g.dashSize+g.gapSize,y.scale.value=g.scale}function l(y,g,_,A){y.diffuse.value.copy(g.color),y.opacity.value=g.opacity,y.size.value=g.size*_,y.scale.value=A*.5,g.map&&(y.map.value=g.map,t(g.map,y.uvTransform)),g.alphaMap&&(y.alphaMap.value=g.alphaMap,t(g.alphaMap,y.alphaMapTransform)),g.alphaTest>0&&(y.alphaTest.value=g.alphaTest)}function c(y,g){y.diffuse.value.copy(g.color),y.opacity.value=g.opacity,y.rotation.value=g.rotation,g.map&&(y.map.value=g.map,t(g.map,y.mapTransform)),g.alphaMap&&(y.alphaMap.value=g.alphaMap,t(g.alphaMap,y.alphaMapTransform)),g.alphaTest>0&&(y.alphaTest.value=g.alphaTest)}function h(y,g){y.specular.value.copy(g.specular),y.shininess.value=Math.max(g.shininess,1e-4)}function d(y,g){g.gradientMap&&(y.gradientMap.value=g.gradientMap)}function f(y,g){y.metalness.value=g.metalness,g.metalnessMap&&(y.metalnessMap.value=g.metalnessMap,t(g.metalnessMap,y.metalnessMapTransform)),y.roughness.value=g.roughness,g.roughnessMap&&(y.roughnessMap.value=g.roughnessMap,t(g.roughnessMap,y.roughnessMapTransform)),e.get(g).envMap&&(y.envMapIntensity.value=g.envMapIntensity)}function p(y,g,_){y.ior.value=g.ior,g.sheen>0&&(y.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),y.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(y.sheenColorMap.value=g.sheenColorMap,t(g.sheenColorMap,y.sheenColorMapTransform)),g.sheenRoughnessMap&&(y.sheenRoughnessMap.value=g.sheenRoughnessMap,t(g.sheenRoughnessMap,y.sheenRoughnessMapTransform))),g.clearcoat>0&&(y.clearcoat.value=g.clearcoat,y.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(y.clearcoatMap.value=g.clearcoatMap,t(g.clearcoatMap,y.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,t(g.clearcoatRoughnessMap,y.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(y.clearcoatNormalMap.value=g.clearcoatNormalMap,t(g.clearcoatNormalMap,y.clearcoatNormalMapTransform),y.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),g.side===Gn&&y.clearcoatNormalScale.value.negate())),g.iridescence>0&&(y.iridescence.value=g.iridescence,y.iridescenceIOR.value=g.iridescenceIOR,y.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],y.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(y.iridescenceMap.value=g.iridescenceMap,t(g.iridescenceMap,y.iridescenceMapTransform)),g.iridescenceThicknessMap&&(y.iridescenceThicknessMap.value=g.iridescenceThicknessMap,t(g.iridescenceThicknessMap,y.iridescenceThicknessMapTransform))),g.transmission>0&&(y.transmission.value=g.transmission,y.transmissionSamplerMap.value=_.texture,y.transmissionSamplerSize.value.set(_.width,_.height),g.transmissionMap&&(y.transmissionMap.value=g.transmissionMap,t(g.transmissionMap,y.transmissionMapTransform)),y.thickness.value=g.thickness,g.thicknessMap&&(y.thicknessMap.value=g.thicknessMap,t(g.thicknessMap,y.thicknessMapTransform)),y.attenuationDistance.value=g.attenuationDistance,y.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(y.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(y.anisotropyMap.value=g.anisotropyMap,t(g.anisotropyMap,y.anisotropyMapTransform))),y.specularIntensity.value=g.specularIntensity,y.specularColor.value.copy(g.specularColor),g.specularColorMap&&(y.specularColorMap.value=g.specularColorMap,t(g.specularColorMap,y.specularColorMapTransform)),g.specularIntensityMap&&(y.specularIntensityMap.value=g.specularIntensityMap,t(g.specularIntensityMap,y.specularIntensityMapTransform))}function m(y,g){g.matcap&&(y.matcap.value=g.matcap)}function v(y,g){const _=e.get(g).light;y.referencePosition.value.setFromMatrixPosition(_.matrixWorld),y.nearDistance.value=_.shadow.camera.near,y.farDistance.value=_.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:n}}function Jq(s,e,t,i){let n={},r={},o=[];const a=t.isWebGL2?s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(_,A){const b=A.program;i.uniformBlockBinding(_,b)}function c(_,A){let b=n[_.id];b===void 0&&(m(_),b=h(_),n[_.id]=b,_.addEventListener("dispose",y));const E=A.program;i.updateUBOMapping(_,E);const C=e.render.frame;r[_.id]!==C&&(f(_),r[_.id]=C)}function h(_){const A=d();_.__bindingPointIndex=A;const b=s.createBuffer(),E=_.__size,C=_.usage;return s.bindBuffer(s.UNIFORM_BUFFER,b),s.bufferData(s.UNIFORM_BUFFER,E,C),s.bindBuffer(s.UNIFORM_BUFFER,null),s.bindBufferBase(s.UNIFORM_BUFFER,A,b),b}function d(){for(let _=0;_<a;_++)if(o.indexOf(_)===-1)return o.push(_),_;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(_){const A=n[_.id],b=_.uniforms,E=_.__cache;s.bindBuffer(s.UNIFORM_BUFFER,A);for(let C=0,T=b.length;C<T;C++){const M=Array.isArray(b[C])?b[C]:[b[C]];for(let R=0,S=M.length;R<S;R++){const I=M[R];if(p(I,C,R,E)===!0){const L=I.__offset,U=Array.isArray(I.value)?I.value:[I.value];let D=0;for(let V=0;V<U.length;V++){const O=U[V],F=v(O);typeof O=="number"||typeof O=="boolean"?(I.__data[0]=O,s.bufferSubData(s.UNIFORM_BUFFER,L+D,I.__data)):O.isMatrix3?(I.__data[0]=O.elements[0],I.__data[1]=O.elements[1],I.__data[2]=O.elements[2],I.__data[3]=0,I.__data[4]=O.elements[3],I.__data[5]=O.elements[4],I.__data[6]=O.elements[5],I.__data[7]=0,I.__data[8]=O.elements[6],I.__data[9]=O.elements[7],I.__data[10]=O.elements[8],I.__data[11]=0):(O.toArray(I.__data,D),D+=F.storage/Float32Array.BYTES_PER_ELEMENT)}s.bufferSubData(s.UNIFORM_BUFFER,L,I.__data)}}}s.bindBuffer(s.UNIFORM_BUFFER,null)}function p(_,A,b,E){const C=_.value,T=A+"_"+b;if(E[T]===void 0)return typeof C=="number"||typeof C=="boolean"?E[T]=C:E[T]=C.clone(),!0;{const M=E[T];if(typeof C=="number"||typeof C=="boolean"){if(M!==C)return E[T]=C,!0}else if(M.equals(C)===!1)return M.copy(C),!0}return!1}function m(_){const A=_.uniforms;let b=0;const E=16;for(let T=0,M=A.length;T<M;T++){const R=Array.isArray(A[T])?A[T]:[A[T]];for(let S=0,I=R.length;S<I;S++){const L=R[S],U=Array.isArray(L.value)?L.value:[L.value];for(let D=0,V=U.length;D<V;D++){const O=U[D],F=v(O),N=b%E;N!==0&&E-N<F.boundary&&(b+=E-N),L.__data=new Float32Array(F.storage/Float32Array.BYTES_PER_ELEMENT),L.__offset=b,b+=F.storage}}}const C=b%E;return C>0&&(b+=E-C),_.__size=b,_.__cache={},this}function v(_){const A={boundary:0,storage:0};return typeof _=="number"||typeof _=="boolean"?(A.boundary=4,A.storage=4):_.isVector2?(A.boundary=8,A.storage=8):_.isVector3||_.isColor?(A.boundary=16,A.storage=12):_.isVector4?(A.boundary=16,A.storage=16):_.isMatrix3?(A.boundary=48,A.storage=48):_.isMatrix4?(A.boundary=64,A.storage=64):_.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",_),A}function y(_){const A=_.target;A.removeEventListener("dispose",y);const b=o.indexOf(A.__bindingPointIndex);o.splice(b,1),s.deleteBuffer(n[A.id]),delete n[A.id],delete r[A.id]}function g(){for(const _ in n)s.deleteBuffer(n[_]);o=[],n={},r={}}return{bind:l,update:c,dispose:g}}class eh{constructor(e={}){const{canvas:t=Jz(),context:i=null,depth:n=!0,stencil:r=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:d=!1}=e;this.isWebGLRenderer=!0;let f;i!==null?f=i.getContextAttributes().alpha:f=o;const p=new Uint32Array(4),m=new Int32Array(4);let v=null,y=null;const g=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=_t,this._useLegacyLights=!1,this.toneMapping=_o,this.toneMappingExposure=1;const A=this;let b=!1,E=0,C=0,T=null,M=-1,R=null;const S=new Je,I=new Je;let L=null;const U=new me(0);let D=0,V=t.width,O=t.height,F=1,N=null,q=null;const $=new Je(0,0,V,O),oe=new Je(0,0,V,O);let ae=!1;const Re=new Rp;let se=!1,ye=!1,Ae=null;const je=new fe,Be=new Z,We=new w,lt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function rt(){return T===null?F:1}let W=i;function Ge(P,G){for(let Q=0;Q<P.length;Q++){const Y=P[Q],K=t.getContext(Y,G);if(K!==null)return K}return null}try{const P={alpha:!0,depth:n,stencil:r,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Wc}`),t.addEventListener("webglcontextlost",ce,!1),t.addEventListener("webglcontextrestored",ee,!1),t.addEventListener("webglcontextcreationerror",Oe,!1),W===null){const G=["webgl2","webgl","experimental-webgl"];if(A.isWebGL1Renderer===!0&&G.shift(),W=Ge(G,P),W===null)throw Ge(G)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&W instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),W.getShaderPrecisionFormat===void 0&&(W.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(P){throw console.error("THREE.WebGLRenderer: "+P.message),P}let we,Ne,Ee,st,tt,ct,jt,H,k,ve,_e,Pe,Me,Ct,mt,ke,Ve,Tt,Fe,ci,gt,Ye,vt,at;function Gt(){we=new a7(W),Ne=new i7(W,we,e),we.init(Ne),Ye=new l4(W,we,Ne),Ee=new Hq(W,we,Ne),st=new h7(W),tt=new Rq,ct=new Vq(W,we,Ee,tt,Ne,Ye,st),jt=new s7(A),H=new o7(A),k=new vj(W,Ne),vt=new e7(W,we,k,Ne),ve=new l7(W,k,st,vt),_e=new p7(W,ve,k,st),Fe=new f7(W,Ne,ct),ke=new n7(tt),Pe=new Iq(A,jt,H,we,Ne,vt,ke),Me=new Kq(A,tt),Ct=new Bq,mt=new Uq(we,Ne),Tt=new $9(A,jt,H,Ee,_e,f,l),Ve=new Gq(A,_e,Ne),at=new Jq(W,st,Ne,Ee),ci=new t7(W,we,st,Ne),gt=new c7(W,we,st,Ne),st.programs=Pe.programs,A.capabilities=Ne,A.extensions=we,A.properties=tt,A.renderLists=Ct,A.shadowMap=Ve,A.state=Ee,A.info=st}Gt();const j=new Xq(A,W);this.xr=j,this.getContext=function(){return W},this.getContextAttributes=function(){return W.getContextAttributes()},this.forceContextLoss=function(){const P=we.get("WEBGL_lose_context");P&&P.loseContext()},this.forceContextRestore=function(){const P=we.get("WEBGL_lose_context");P&&P.restoreContext()},this.getPixelRatio=function(){return F},this.setPixelRatio=function(P){P!==void 0&&(F=P,this.setSize(V,O,!1))},this.getSize=function(P){return P.set(V,O)},this.setSize=function(P,G,Q=!0){if(j.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}V=P,O=G,t.width=Math.floor(P*F),t.height=Math.floor(G*F),Q===!0&&(t.style.width=P+"px",t.style.height=G+"px"),this.setViewport(0,0,P,G)},this.getDrawingBufferSize=function(P){return P.set(V*F,O*F).floor()},this.setDrawingBufferSize=function(P,G,Q){V=P,O=G,F=Q,t.width=Math.floor(P*Q),t.height=Math.floor(G*Q),this.setViewport(0,0,P,G)},this.getCurrentViewport=function(P){return P.copy(S)},this.getViewport=function(P){return P.copy($)},this.setViewport=function(P,G,Q,Y){P.isVector4?$.set(P.x,P.y,P.z,P.w):$.set(P,G,Q,Y),Ee.viewport(S.copy($).multiplyScalar(F).round())},this.getScissor=function(P){return P.copy(oe)},this.setScissor=function(P,G,Q,Y){P.isVector4?oe.set(P.x,P.y,P.z,P.w):oe.set(P,G,Q,Y),Ee.scissor(I.copy(oe).multiplyScalar(F).round())},this.getScissorTest=function(){return ae},this.setScissorTest=function(P){Ee.setScissorTest(ae=P)},this.setOpaqueSort=function(P){N=P},this.setTransparentSort=function(P){q=P},this.getClearColor=function(P){return P.copy(Tt.getClearColor())},this.setClearColor=function(){Tt.setClearColor.apply(Tt,arguments)},this.getClearAlpha=function(){return Tt.getClearAlpha()},this.setClearAlpha=function(){Tt.setClearAlpha.apply(Tt,arguments)},this.clear=function(P=!0,G=!0,Q=!0){let Y=0;if(P){let K=!1;if(T!==null){const pe=T.texture.format;K=pe===OP||pe===DP||pe===BP}if(K){const pe=T.texture.type,ue=pe===Ri||pe===El||pe===pC||pe===tu||pe===RP||pe===PP,be=Tt.getClearColor(),De=Tt.getClearAlpha(),Le=be.r,Qe=be.g,$e=be.b;ue?(p[0]=Le,p[1]=Qe,p[2]=$e,p[3]=De,W.clearBufferuiv(W.COLOR,0,p)):(m[0]=Le,m[1]=Qe,m[2]=$e,m[3]=De,W.clearBufferiv(W.COLOR,0,m))}else Y|=W.COLOR_BUFFER_BIT}G&&(Y|=W.DEPTH_BUFFER_BIT),Q&&(Y|=W.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),W.clear(Y)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ce,!1),t.removeEventListener("webglcontextrestored",ee,!1),t.removeEventListener("webglcontextcreationerror",Oe,!1),Ct.dispose(),mt.dispose(),tt.dispose(),jt.dispose(),H.dispose(),_e.dispose(),vt.dispose(),at.dispose(),Pe.dispose(),j.dispose(),j.removeEventListener("sessionstart",wn),j.removeEventListener("sessionend",pi),Ae&&(Ae.dispose(),Ae=null),kn.stop()};function ce(P){P.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function ee(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const P=st.autoReset,G=Ve.enabled,Q=Ve.autoUpdate,Y=Ve.needsUpdate,K=Ve.type;Gt(),st.autoReset=P,Ve.enabled=G,Ve.autoUpdate=Q,Ve.needsUpdate=Y,Ve.type=K}function Oe(P){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",P.statusMessage)}function he(P){const G=P.target;G.removeEventListener("dispose",he),He(G)}function He(P){Ke(P),tt.remove(P)}function Ke(P){const G=tt.get(P).programs;G!==void 0&&(G.forEach(function(Q){Pe.releaseProgram(Q)}),P.isShaderMaterial&&Pe.releaseShaderCache(P))}this.renderBufferDirect=function(P,G,Q,Y,K,pe){G===null&&(G=lt);const ue=K.isMesh&&K.matrixWorld.determinant()<0,be=B(P,G,Q,Y,K);Ee.setMaterial(Y,ue);let De=Q.index,Le=1;if(Y.wireframe===!0){if(De=ve.getWireframeAttribute(Q),De===void 0)return;Le=2}const Qe=Q.drawRange,$e=Q.attributes.position;let it=Qe.start*Le,dt=(Qe.start+Qe.count)*Le;pe!==null&&(it=Math.max(it,pe.start*Le),dt=Math.min(dt,(pe.start+pe.count)*Le)),De!==null?(it=Math.max(it,0),dt=Math.min(dt,De.count)):$e!=null&&(it=Math.max(it,0),dt=Math.min(dt,$e.count));const Bt=dt-it;if(Bt<0||Bt===1/0)return;vt.setup(K,Y,be,Q,De);let Bi,Zt=ci;if(De!==null&&(Bi=k.get(De),Zt=gt,Zt.setIndex(Bi)),K.isMesh)Y.wireframe===!0?(Ee.setLineWidth(Y.wireframeLinewidth*rt()),Zt.setMode(W.LINES)):Zt.setMode(W.TRIANGLES);else if(K.isLine){let Ft=Y.linewidth;Ft===void 0&&(Ft=1),Ee.setLineWidth(Ft*rt()),K.isLineSegments?Zt.setMode(W.LINES):K.isLineLoop?Zt.setMode(W.LINE_LOOP):Zt.setMode(W.LINE_STRIP)}else K.isPoints?Zt.setMode(W.POINTS):K.isSprite&&Zt.setMode(W.TRIANGLES);if(K.isBatchedMesh)Zt.renderMultiDraw(K._multiDrawStarts,K._multiDrawCounts,K._multiDrawCount);else if(K.isInstancedMesh)Zt.renderInstances(it,Bt,K.count);else if(Q.isInstancedBufferGeometry){const Ft=Q._maxInstanceCount!==void 0?Q._maxInstanceCount:1/0,Wi=Math.min(Q.instanceCount,Ft);Zt.renderInstances(it,Bt,Wi)}else Zt.render(it,Bt)};function hi(P,G,Q){P.transparent===!0&&P.side===Pi&&P.forceSinglePass===!1?(P.side=Gn,P.needsUpdate=!0,ai(P,G,Q),P.side=As,P.needsUpdate=!0,ai(P,G,Q),P.side=Pi):ai(P,G,Q)}this.compile=function(P,G,Q=null){Q===null&&(Q=P),y=mt.get(Q),y.init(),_.push(y),Q.traverseVisible(function(K){K.isLight&&K.layers.test(G.layers)&&(y.pushLight(K),K.castShadow&&y.pushShadow(K))}),P!==Q&&P.traverseVisible(function(K){K.isLight&&K.layers.test(G.layers)&&(y.pushLight(K),K.castShadow&&y.pushShadow(K))}),y.setupLights(A._useLegacyLights);const Y=new Set;return P.traverse(function(K){const pe=K.material;if(pe)if(Array.isArray(pe))for(let ue=0;ue<pe.length;ue++){const be=pe[ue];hi(be,Q,K),Y.add(be)}else hi(pe,Q,K),Y.add(pe)}),_.pop(),y=null,Y},this.compileAsync=function(P,G,Q=null){const Y=this.compile(P,G,Q);return new Promise(K=>{function pe(){if(Y.forEach(function(ue){tt.get(ue).currentProgram.isReady()&&Y.delete(ue)}),Y.size===0){K(P);return}setTimeout(pe,10)}we.get("KHR_parallel_shader_compile")!==null?pe():setTimeout(pe,10)})};let zi=null;function xn(P){zi&&zi(P)}function wn(){kn.stop()}function pi(){kn.start()}const kn=new i4;kn.setAnimationLoop(xn),typeof self<"u"&&kn.setContext(self),this.setAnimationLoop=function(P){zi=P,j.setAnimationLoop(P),P===null?kn.stop():kn.start()},j.addEventListener("sessionstart",wn),j.addEventListener("sessionend",pi),this.render=function(P,G){if(G!==void 0&&G.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(b===!0)return;P.matrixWorldAutoUpdate===!0&&P.updateMatrixWorld(),G.parent===null&&G.matrixWorldAutoUpdate===!0&&G.updateMatrixWorld(),j.enabled===!0&&j.isPresenting===!0&&(j.cameraAutoUpdate===!0&&j.updateCamera(G),G=j.getCamera()),P.isScene===!0&&P.onBeforeRender(A,P,G,T),y=mt.get(P,_.length),y.init(),_.push(y),je.multiplyMatrices(G.projectionMatrix,G.matrixWorldInverse),Re.setFromProjectionMatrix(je),ye=this.localClippingEnabled,se=ke.init(this.clippingPlanes,ye),v=Ct.get(P,g.length),v.init(),g.push(v),qn(P,G,0,A.sortObjects),v.finish(),A.sortObjects===!0&&v.sort(N,q),this.info.render.frame++,se===!0&&ke.beginShadows();const Q=y.state.shadowsArray;if(Ve.render(Q,P,G),se===!0&&ke.endShadows(),this.info.autoReset===!0&&this.info.reset(),(j.enabled===!1||j.isPresenting===!1||j.hasDepthSensing()===!1)&&Tt.render(v,P),y.setupLights(A._useLegacyLights),G.isArrayCamera){const Y=G.cameras;for(let K=0,pe=Y.length;K<pe;K++){const ue=Y[K];Jo(v,P,ue,ue.viewport)}}else Jo(v,P,G);T!==null&&(ct.updateMultisampleRenderTarget(T),ct.updateRenderTargetMipmap(T)),P.isScene===!0&&P.onAfterRender(A,P,G),vt.resetDefaultState(),M=-1,R=null,_.pop(),_.length>0?y=_[_.length-1]:y=null,g.pop(),g.length>0?v=g[g.length-1]:v=null};function qn(P,G,Q,Y){if(P.visible===!1)return;if(P.layers.test(G.layers)){if(P.isGroup)Q=P.renderOrder;else if(P.isLOD)P.autoUpdate===!0&&P.update(G);else if(P.isLight)y.pushLight(P),P.castShadow&&y.pushShadow(P);else if(P.isSprite){if(!P.frustumCulled||Re.intersectsSprite(P)){Y&&We.setFromMatrixPosition(P.matrixWorld).applyMatrix4(je);const ue=_e.update(P),be=P.material;be.visible&&v.push(P,ue,be,Q,We.z,null)}}else if((P.isMesh||P.isLine||P.isPoints)&&(!P.frustumCulled||Re.intersectsObject(P))){const ue=_e.update(P),be=P.material;if(Y&&(P.boundingSphere!==void 0?(P.boundingSphere===null&&P.computeBoundingSphere(),We.copy(P.boundingSphere.center)):(ue.boundingSphere===null&&ue.computeBoundingSphere(),We.copy(ue.boundingSphere.center)),We.applyMatrix4(P.matrixWorld).applyMatrix4(je)),Array.isArray(be)){const De=ue.groups;for(let Le=0,Qe=De.length;Le<Qe;Le++){const $e=De[Le],it=be[$e.materialIndex];it&&it.visible&&v.push(P,ue,it,Q,We.z,$e)}}else be.visible&&v.push(P,ue,be,Q,We.z,null)}}const pe=P.children;for(let ue=0,be=pe.length;ue<be;ue++)qn(pe[ue],G,Q,Y)}function Jo(P,G,Q,Y){const K=P.opaque,pe=P.transmissive,ue=P.transparent;y.setupLightsView(Q),se===!0&&ke.setGlobalState(A.clippingPlanes,Q),pe.length>0&&Mu(K,pe,G,Q),Y&&Ee.viewport(S.copy(Y)),K.length>0&&Zo(K,G,Q),pe.length>0&&Zo(pe,G,Q),ue.length>0&&Zo(ue,G,Q),Ee.buffers.depth.setTest(!0),Ee.buffers.depth.setMask(!0),Ee.buffers.color.setMask(!0),Ee.setPolygonOffset(!1)}function Mu(P,G,Q,Y){if((Q.isScene===!0?Q.overrideMaterial:null)!==null)return;const pe=Ne.isWebGL2;Ae===null&&(Ae=new Yt(1,1,{generateMipmaps:!0,type:we.has("EXT_color_buffer_half_float")?$i:Ri,minFilter:go,samples:pe?4:0})),A.getDrawingBufferSize(Be),pe?Ae.setSize(Be.x,Be.y):Ae.setSize(qw(Be.x),qw(Be.y));const ue=A.getRenderTarget();A.setRenderTarget(Ae),A.getClearColor(U),D=A.getClearAlpha(),D<1&&A.setClearColor(16777215,.5),A.clear();const be=A.toneMapping;A.toneMapping=_o,Zo(P,Q,Y),ct.updateMultisampleRenderTarget(Ae),ct.updateRenderTargetMipmap(Ae);let De=!1;for(let Le=0,Qe=G.length;Le<Qe;Le++){const $e=G[Le],it=$e.object,dt=$e.geometry,Bt=$e.material,Bi=$e.group;if(Bt.side===Pi&&it.layers.test(Y.layers)){const Zt=Bt.side;Bt.side=Gn,Bt.needsUpdate=!0,Iu(it,Q,Y,dt,Bt,Bi),Bt.side=Zt,Bt.needsUpdate=!0,De=!0}}De===!0&&(ct.updateMultisampleRenderTarget(Ae),ct.updateRenderTargetMipmap(Ae)),A.setRenderTarget(ue),A.setClearColor(U,D),A.toneMapping=be}function Zo(P,G,Q){const Y=G.isScene===!0?G.overrideMaterial:null;for(let K=0,pe=P.length;K<pe;K++){const ue=P[K],be=ue.object,De=ue.geometry,Le=Y===null?ue.material:Y,Qe=ue.group;be.layers.test(Q.layers)&&Iu(be,G,Q,De,Le,Qe)}}function Iu(P,G,Q,Y,K,pe){P.onBeforeRender(A,G,Q,Y,K,pe),P.modelViewMatrix.multiplyMatrices(Q.matrixWorldInverse,P.matrixWorld),P.normalMatrix.getNormalMatrix(P.modelViewMatrix),K.onBeforeRender(A,G,Q,Y,P,pe),K.transparent===!0&&K.side===Pi&&K.forceSinglePass===!1?(K.side=Gn,K.needsUpdate=!0,A.renderBufferDirect(Q,G,Y,K,P,pe),K.side=As,K.needsUpdate=!0,A.renderBufferDirect(Q,G,Y,K,P,pe),K.side=Pi):A.renderBufferDirect(Q,G,Y,K,P,pe),P.onAfterRender(A,G,Q,Y,K,pe)}function ai(P,G,Q){G.isScene!==!0&&(G=lt);const Y=tt.get(P),K=y.state.lights,pe=y.state.shadowsArray,ue=K.state.version,be=Pe.getParameters(P,K.state,pe,G,Q),De=Pe.getProgramCacheKey(be);let Le=Y.programs;Y.environment=P.isMeshStandardMaterial?G.environment:null,Y.fog=G.fog,Y.envMap=(P.isMeshStandardMaterial?H:jt).get(P.envMap||Y.environment),Y.envMapRotation=Y.environment!==null&&P.envMap===null?G.environmentRotation:P.envMapRotation,Le===void 0&&(P.addEventListener("dispose",he),Le=new Map,Y.programs=Le);let Qe=Le.get(De);if(Qe!==void 0){if(Y.currentProgram===Qe&&Y.lightsStateVersion===ue)return rb(P,be),Qe}else be.uniforms=Pe.getUniforms(P),P.onBuild(Q,be,A),P.onBeforeCompile(be,A),Qe=Pe.acquireProgram(be,De),Le.set(De,Qe),Y.uniforms=be.uniforms;const $e=Y.uniforms;return(!P.isShaderMaterial&&!P.isRawShaderMaterial||P.clipping===!0)&&($e.clippingPlanes=ke.uniform),rb(P,be),Y.needsLights=J(P),Y.lightsStateVersion=ue,Y.needsLights&&($e.ambientLightColor.value=K.state.ambient,$e.lightProbe.value=K.state.probe,$e.directionalLights.value=K.state.directional,$e.directionalLightShadows.value=K.state.directionalShadow,$e.spotLights.value=K.state.spot,$e.spotLightShadows.value=K.state.spotShadow,$e.rectAreaLights.value=K.state.rectArea,$e.ltc_1.value=K.state.rectAreaLTC1,$e.ltc_2.value=K.state.rectAreaLTC2,$e.pointLights.value=K.state.point,$e.pointLightShadows.value=K.state.pointShadow,$e.hemisphereLights.value=K.state.hemi,$e.directionalShadowMap.value=K.state.directionalShadowMap,$e.directionalShadowMatrix.value=K.state.directionalShadowMatrix,$e.spotShadowMap.value=K.state.spotShadowMap,$e.spotLightMatrix.value=K.state.spotLightMatrix,$e.spotLightMap.value=K.state.spotLightMap,$e.pointShadowMap.value=K.state.pointShadowMap,$e.pointShadowMatrix.value=K.state.pointShadowMatrix),Y.currentProgram=Qe,Y.uniformsList=null,Qe}function Qv(P){if(P.uniformsList===null){const G=P.currentProgram.getUniforms();P.uniformsList=lw.seqWithValue(G.seq,P.uniforms)}return P.uniformsList}function rb(P,G){const Q=tt.get(P);Q.outputColorSpace=G.outputColorSpace,Q.batching=G.batching,Q.instancing=G.instancing,Q.instancingColor=G.instancingColor,Q.instancingMorph=G.instancingMorph,Q.skinning=G.skinning,Q.morphTargets=G.morphTargets,Q.morphNormals=G.morphNormals,Q.morphColors=G.morphColors,Q.morphTargetsCount=G.morphTargetsCount,Q.numClippingPlanes=G.numClippingPlanes,Q.numIntersection=G.numClipIntersection,Q.vertexAlphas=G.vertexAlphas,Q.vertexTangents=G.vertexTangents,Q.toneMapping=G.toneMapping}function B(P,G,Q,Y,K){G.isScene!==!0&&(G=lt),ct.resetTextureUnits();const pe=G.fog,ue=Y.isMeshStandardMaterial?G.environment:null,be=T===null?A.outputColorSpace:T.isXRRenderTarget===!0?T.texture.colorSpace:Ui,De=(Y.isMeshStandardMaterial?H:jt).get(Y.envMap||ue),Le=Y.vertexColors===!0&&!!Q.attributes.color&&Q.attributes.color.itemSize===4,Qe=!!Q.attributes.tangent&&(!!Y.normalMap||Y.anisotropy>0),$e=!!Q.morphAttributes.position,it=!!Q.morphAttributes.normal,dt=!!Q.morphAttributes.color;let Bt=_o;Y.toneMapped&&(T===null||T.isXRRenderTarget===!0)&&(Bt=A.toneMapping);const Bi=Q.morphAttributes.position||Q.morphAttributes.normal||Q.morphAttributes.color,Zt=Bi!==void 0?Bi.length:0,Ft=tt.get(Y),Wi=y.state.lights;if(se===!0&&(ye===!0||P!==R)){const Fn=P===R&&Y.id===M;ke.setState(Y,P,Fn)}let Mt=!1;Y.version===Ft.__version?(Ft.needsLights&&Ft.lightsStateVersion!==Wi.state.version||Ft.outputColorSpace!==be||K.isBatchedMesh&&Ft.batching===!1||!K.isBatchedMesh&&Ft.batching===!0||K.isInstancedMesh&&Ft.instancing===!1||!K.isInstancedMesh&&Ft.instancing===!0||K.isSkinnedMesh&&Ft.skinning===!1||!K.isSkinnedMesh&&Ft.skinning===!0||K.isInstancedMesh&&Ft.instancingColor===!0&&K.instanceColor===null||K.isInstancedMesh&&Ft.instancingColor===!1&&K.instanceColor!==null||K.isInstancedMesh&&Ft.instancingMorph===!0&&K.morphTexture===null||K.isInstancedMesh&&Ft.instancingMorph===!1&&K.morphTexture!==null||Ft.envMap!==De||Y.fog===!0&&Ft.fog!==pe||Ft.numClippingPlanes!==void 0&&(Ft.numClippingPlanes!==ke.numPlanes||Ft.numIntersection!==ke.numIntersection)||Ft.vertexAlphas!==Le||Ft.vertexTangents!==Qe||Ft.morphTargets!==$e||Ft.morphNormals!==it||Ft.morphColors!==dt||Ft.toneMapping!==Bt||Ne.isWebGL2===!0&&Ft.morphTargetsCount!==Zt)&&(Mt=!0):(Mt=!0,Ft.__version=Y.version);let Ki=Ft.currentProgram;Mt===!0&&(Ki=ai(Y,G,K));let Zr=!1,Sn=!1,Ii=!1;const ti=Ki.getUniforms(),sr=Ft.uniforms;if(Ee.useProgram(Ki.program)&&(Zr=!0,Sn=!0,Ii=!0),Y.id!==M&&(M=Y.id,Sn=!0),Zr||R!==P){ti.setValue(W,"projectionMatrix",P.projectionMatrix),ti.setValue(W,"viewMatrix",P.matrixWorldInverse);const Fn=ti.map.cameraPosition;Fn!==void 0&&Fn.setValue(W,We.setFromMatrixPosition(P.matrixWorld)),Ne.logarithmicDepthBuffer&&ti.setValue(W,"logDepthBufFC",2/(Math.log(P.far+1)/Math.LN2)),(Y.isMeshPhongMaterial||Y.isMeshToonMaterial||Y.isMeshLambertMaterial||Y.isMeshBasicMaterial||Y.isMeshStandardMaterial||Y.isShaderMaterial)&&ti.setValue(W,"isOrthographic",P.isOrthographicCamera===!0),R!==P&&(R=P,Sn=!0,Ii=!0)}if(K.isSkinnedMesh){ti.setOptional(W,K,"bindMatrix"),ti.setOptional(W,K,"bindMatrixInverse");const Fn=K.skeleton;Fn&&(Ne.floatVertexTextures?(Fn.boneTexture===null&&Fn.computeBoneTexture(),ti.setValue(W,"boneTexture",Fn.boneTexture,ct)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}K.isBatchedMesh&&(ti.setOptional(W,K,"batchingTexture"),ti.setValue(W,"batchingTexture",K._matricesTexture,ct));const uh=Q.morphAttributes;if((uh.position!==void 0||uh.normal!==void 0||uh.color!==void 0&&Ne.isWebGL2===!0)&&Fe.update(K,Q,Ki),(Sn||Ft.receiveShadow!==K.receiveShadow)&&(Ft.receiveShadow=K.receiveShadow,ti.setValue(W,"receiveShadow",K.receiveShadow)),Y.isMeshGouraudMaterial&&Y.envMap!==null&&(sr.envMap.value=De,sr.flipEnvMap.value=De.isCubeTexture&&De.isRenderTargetTexture===!1?-1:1),Sn&&(ti.setValue(W,"toneMappingExposure",A.toneMappingExposure),Ft.needsLights&&z(sr,Ii),pe&&Y.fog===!0&&Me.refreshFogUniforms(sr,pe),Me.refreshMaterialUniforms(sr,Y,F,O,Ae),lw.upload(W,Qv(Ft),sr,ct)),Y.isShaderMaterial&&Y.uniformsNeedUpdate===!0&&(lw.upload(W,Qv(Ft),sr,ct),Y.uniformsNeedUpdate=!1),Y.isSpriteMaterial&&ti.setValue(W,"center",K.center),ti.setValue(W,"modelViewMatrix",K.modelViewMatrix),ti.setValue(W,"normalMatrix",K.normalMatrix),ti.setValue(W,"modelMatrix",K.matrixWorld),Y.isShaderMaterial||Y.isRawShaderMaterial){const Fn=Y.uniformsGroups;for(let Ru=0,c6=Fn.length;Ru<c6;Ru++)if(Ne.isWebGL2){const S2=Fn[Ru];at.update(S2,Ki),at.bind(S2,Ki)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Ki}function z(P,G){P.ambientLightColor.needsUpdate=G,P.lightProbe.needsUpdate=G,P.directionalLights.needsUpdate=G,P.directionalLightShadows.needsUpdate=G,P.pointLights.needsUpdate=G,P.pointLightShadows.needsUpdate=G,P.spotLights.needsUpdate=G,P.spotLightShadows.needsUpdate=G,P.rectAreaLights.needsUpdate=G,P.hemisphereLights.needsUpdate=G}function J(P){return P.isMeshLambertMaterial||P.isMeshToonMaterial||P.isMeshPhongMaterial||P.isMeshStandardMaterial||P.isShadowMaterial||P.isShaderMaterial&&P.lights===!0}this.getActiveCubeFace=function(){return E},this.getActiveMipmapLevel=function(){return C},this.getRenderTarget=function(){return T},this.setRenderTargetTextures=function(P,G,Q){tt.get(P.texture).__webglTexture=G,tt.get(P.depthTexture).__webglTexture=Q;const Y=tt.get(P);Y.__hasExternalTextures=!0,Y.__autoAllocateDepthBuffer=Q===void 0,Y.__autoAllocateDepthBuffer||we.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Y.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(P,G){const Q=tt.get(P);Q.__webglFramebuffer=G,Q.__useDefaultFramebuffer=G===void 0},this.setRenderTarget=function(P,G=0,Q=0){T=P,E=G,C=Q;let Y=!0,K=null,pe=!1,ue=!1;if(P){const De=tt.get(P);De.__useDefaultFramebuffer!==void 0?(Ee.bindFramebuffer(W.FRAMEBUFFER,null),Y=!1):De.__webglFramebuffer===void 0?ct.setupRenderTarget(P):De.__hasExternalTextures&&ct.rebindTextures(P,tt.get(P.texture).__webglTexture,tt.get(P.depthTexture).__webglTexture);const Le=P.texture;(Le.isData3DTexture||Le.isDataArrayTexture||Le.isCompressedArrayTexture)&&(ue=!0);const Qe=tt.get(P).__webglFramebuffer;P.isWebGLCubeRenderTarget?(Array.isArray(Qe[G])?K=Qe[G][Q]:K=Qe[G],pe=!0):Ne.isWebGL2&&P.samples>0&&ct.useMultisampledRTT(P)===!1?K=tt.get(P).__webglMultisampledFramebuffer:Array.isArray(Qe)?K=Qe[Q]:K=Qe,S.copy(P.viewport),I.copy(P.scissor),L=P.scissorTest}else S.copy($).multiplyScalar(F).floor(),I.copy(oe).multiplyScalar(F).floor(),L=ae;if(Ee.bindFramebuffer(W.FRAMEBUFFER,K)&&Ne.drawBuffers&&Y&&Ee.drawBuffers(P,K),Ee.viewport(S),Ee.scissor(I),Ee.setScissorTest(L),pe){const De=tt.get(P.texture);W.framebufferTexture2D(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,W.TEXTURE_CUBE_MAP_POSITIVE_X+G,De.__webglTexture,Q)}else if(ue){const De=tt.get(P.texture),Le=G||0;W.framebufferTextureLayer(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,De.__webglTexture,Q||0,Le)}M=-1},this.readRenderTargetPixels=function(P,G,Q,Y,K,pe,ue){if(!(P&&P.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let be=tt.get(P).__webglFramebuffer;if(P.isWebGLCubeRenderTarget&&ue!==void 0&&(be=be[ue]),be){Ee.bindFramebuffer(W.FRAMEBUFFER,be);try{const De=P.texture,Le=De.format,Qe=De.type;if(Le!==Ti&&Ye.convert(Le)!==W.getParameter(W.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const $e=Qe===$i&&(we.has("EXT_color_buffer_half_float")||Ne.isWebGL2&&we.has("EXT_color_buffer_float"));if(Qe!==Ri&&Ye.convert(Qe)!==W.getParameter(W.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Qe===vn&&(Ne.isWebGL2||we.has("OES_texture_float")||we.has("WEBGL_color_buffer_float")))&&!$e){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}G>=0&&G<=P.width-Y&&Q>=0&&Q<=P.height-K&&W.readPixels(G,Q,Y,K,Ye.convert(Le),Ye.convert(Qe),pe)}finally{const De=T!==null?tt.get(T).__webglFramebuffer:null;Ee.bindFramebuffer(W.FRAMEBUFFER,De)}}},this.copyFramebufferToTexture=function(P,G,Q=0){const Y=Math.pow(2,-Q),K=Math.floor(G.image.width*Y),pe=Math.floor(G.image.height*Y);ct.setTexture2D(G,0),W.copyTexSubImage2D(W.TEXTURE_2D,Q,0,0,P.x,P.y,K,pe),Ee.unbindTexture()},this.copyTextureToTexture=function(P,G,Q,Y=0){const K=G.image.width,pe=G.image.height,ue=Ye.convert(Q.format),be=Ye.convert(Q.type);ct.setTexture2D(Q,0),W.pixelStorei(W.UNPACK_FLIP_Y_WEBGL,Q.flipY),W.pixelStorei(W.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Q.premultiplyAlpha),W.pixelStorei(W.UNPACK_ALIGNMENT,Q.unpackAlignment),G.isDataTexture?W.texSubImage2D(W.TEXTURE_2D,Y,P.x,P.y,K,pe,ue,be,G.image.data):G.isCompressedTexture?W.compressedTexSubImage2D(W.TEXTURE_2D,Y,P.x,P.y,G.mipmaps[0].width,G.mipmaps[0].height,ue,G.mipmaps[0].data):W.texSubImage2D(W.TEXTURE_2D,Y,P.x,P.y,ue,be,G.image),Y===0&&Q.generateMipmaps&&W.generateMipmap(W.TEXTURE_2D),Ee.unbindTexture()},this.copyTextureToTexture3D=function(P,G,Q,Y,K=0){if(A.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const pe=Math.round(P.max.x-P.min.x),ue=Math.round(P.max.y-P.min.y),be=P.max.z-P.min.z+1,De=Ye.convert(Y.format),Le=Ye.convert(Y.type);let Qe;if(Y.isData3DTexture)ct.setTexture3D(Y,0),Qe=W.TEXTURE_3D;else if(Y.isDataArrayTexture||Y.isCompressedArrayTexture)ct.setTexture2DArray(Y,0),Qe=W.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}W.pixelStorei(W.UNPACK_FLIP_Y_WEBGL,Y.flipY),W.pixelStorei(W.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Y.premultiplyAlpha),W.pixelStorei(W.UNPACK_ALIGNMENT,Y.unpackAlignment);const $e=W.getParameter(W.UNPACK_ROW_LENGTH),it=W.getParameter(W.UNPACK_IMAGE_HEIGHT),dt=W.getParameter(W.UNPACK_SKIP_PIXELS),Bt=W.getParameter(W.UNPACK_SKIP_ROWS),Bi=W.getParameter(W.UNPACK_SKIP_IMAGES),Zt=Q.isCompressedTexture?Q.mipmaps[K]:Q.image;W.pixelStorei(W.UNPACK_ROW_LENGTH,Zt.width),W.pixelStorei(W.UNPACK_IMAGE_HEIGHT,Zt.height),W.pixelStorei(W.UNPACK_SKIP_PIXELS,P.min.x),W.pixelStorei(W.UNPACK_SKIP_ROWS,P.min.y),W.pixelStorei(W.UNPACK_SKIP_IMAGES,P.min.z),Q.isDataTexture||Q.isData3DTexture?W.texSubImage3D(Qe,K,G.x,G.y,G.z,pe,ue,be,De,Le,Zt.data):Y.isCompressedArrayTexture?W.compressedTexSubImage3D(Qe,K,G.x,G.y,G.z,pe,ue,be,De,Zt.data):W.texSubImage3D(Qe,K,G.x,G.y,G.z,pe,ue,be,De,Le,Zt),W.pixelStorei(W.UNPACK_ROW_LENGTH,$e),W.pixelStorei(W.UNPACK_IMAGE_HEIGHT,it),W.pixelStorei(W.UNPACK_SKIP_PIXELS,dt),W.pixelStorei(W.UNPACK_SKIP_ROWS,Bt),W.pixelStorei(W.UNPACK_SKIP_IMAGES,Bi),K===0&&Y.generateMipmaps&&W.generateMipmap(Qe),Ee.unbindTexture()},this.initTexture=function(P){P.isCubeTexture?ct.setTextureCube(P,0):P.isData3DTexture?ct.setTexture3D(P,0):P.isDataArrayTexture||P.isCompressedArrayTexture?ct.setTexture2DArray(P,0):ct.setTexture2D(P,0),Ee.unbindTexture()},this.resetState=function(){E=0,C=0,T=null,Ee.reset(),vt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Cc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===X0?"display-p3":"srgb",t.unpackColorSpace=ki.workingColorSpace===pv?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===_t?MI:Mz}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===MI?_t:Ui}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class c4 extends eh{}c4.prototype.isWebGL1Renderer=!0;class wC{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new me(e),this.density=t}clone(){return new wC(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}let SC=class h4{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new me(e),this.near=t,this.far=i}clone(){return new h4(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}};class Ks extends ge{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new oi,this.environmentRotation=new oi,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Z0{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=e0,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=ma()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Zz("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ma()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ma()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const $r=new w;class vo{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)$r.fromBufferAttribute(this,t),$r.applyMatrix4(e),this.setXYZ(t,$r.x,$r.y,$r.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)$r.fromBufferAttribute(this,t),$r.applyNormalMatrix(e),this.setXYZ(t,$r.x,$r.y,$r.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)$r.fromBufferAttribute(this,t),$r.transformDirection(e),this.setXYZ(t,$r.x,$r.y,$r.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=po(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=ni(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=ni(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=ni(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=ni(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=ni(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=po(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=po(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=po(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=po(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array),n=ni(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array),n=ni(n,this.array),r=ni(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return new ot(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new vo(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class CC extends Vt{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new me(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Mm;const Yv=new w,Im=new w,Rm=new w,Pm=new Z,Kv=new Z,u4=new fe,Tb=new w,Jv=new w,Mb=new w,fL=new Z,F1=new Z,pL=new Z;let qP=class extends ge{constructor(e=new CC){if(super(),this.isSprite=!0,this.type="Sprite",Mm===void 0){Mm=new pt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Z0(t,5);Mm.setIndex([0,1,2,0,2,3]),Mm.setAttribute("position",new vo(i,3,0,!1)),Mm.setAttribute("uv",new vo(i,2,3,!1))}this.geometry=Mm,this.material=e,this.center=new Z(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Im.setFromMatrixScale(this.matrixWorld),u4.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Rm.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Im.multiplyScalar(-Rm.z);const i=this.material.rotation;let n,r;i!==0&&(r=Math.cos(i),n=Math.sin(i));const o=this.center;Ib(Tb.set(-.5,-.5,0),Rm,o,Im,n,r),Ib(Jv.set(.5,-.5,0),Rm,o,Im,n,r),Ib(Mb.set(.5,.5,0),Rm,o,Im,n,r),fL.set(0,0),F1.set(1,0),pL.set(1,1);let a=e.ray.intersectTriangle(Tb,Jv,Mb,!1,Yv);if(a===null&&(Ib(Jv.set(-.5,.5,0),Rm,o,Im,n,r),F1.set(0,1),a=e.ray.intersectTriangle(Tb,Mb,Jv,!1,Yv),a===null))return;const l=e.ray.origin.distanceTo(Yv);l<e.near||l>e.far||t.push({distance:l,point:Yv.clone(),uv:mo.getInterpolation(Yv,Tb,Jv,Mb,fL,F1,pL,new Z),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}};function Ib(s,e,t,i,n,r){Pm.subVectors(s,t).addScalar(.5).multiply(i),n!==void 0?(Kv.x=r*Pm.x-n*Pm.y,Kv.y=n*Pm.x+r*Pm.y):Kv.copy(Pm),s.copy(e),s.x+=Kv.x,s.y+=Kv.y,s.applyMatrix4(u4)}const Rb=new w,mL=new w;let XP=class extends ge{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,n=t.length;i<n;i++){const r=t[i];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const n=this.levels;let r;for(r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,n;for(i=1,n=t.length;i<n;i++){let r=t[i].distance;if(t[i].object.visible&&(r-=r*t[i].hysteresis),e<r)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){Rb.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Rb);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Rb.setFromMatrixPosition(e.matrixWorld),mL.setFromMatrixPosition(this.matrixWorld);const i=Rb.distanceTo(mL)/e.zoom;t[0].object.visible=!0;let n,r;for(n=1,r=t.length;n<r;n++){let o=t[n].distance;if(t[n].object.visible&&(o-=o*t[n].hysteresis),i>=o)t[n-1].object.visible=!1,t[n].object.visible=!0;else break}for(this._currentLevel=n-1;n<r;n++)t[n].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let n=0,r=i.length;n<r;n++){const o=i[n];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}};const gL=new w,vL=new Je,yL=new Je,Zq=new w,AL=new fe,Pb=new w,U1=new _n,_L=new fe,N1=new jo;class ga extends le{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=lI,this.bindMatrix=new fe,this.bindMatrixInverse=new fe,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Si),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,Pb),this.boundingBox.expandByPoint(Pb)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new _n),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,Pb),this.boundingSphere.expandByPoint(Pb)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,n=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),U1.copy(this.boundingSphere),U1.applyMatrix4(n),e.ray.intersectsSphere(U1)!==!1&&(_L.copy(n).invert(),N1.copy(e.ray).applyMatrix4(_L),!(this.boundingBox!==null&&N1.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,N1)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Je,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.fromBufferAttribute(t,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===lI?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===_z?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,n=this.geometry;vL.fromBufferAttribute(n.attributes.skinIndex,e),yL.fromBufferAttribute(n.attributes.skinWeight,e),gL.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=yL.getComponent(r);if(o!==0){const a=vL.getComponent(r);AL.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(Zq.copy(gL).applyMatrix4(AL),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Pp extends ge{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Go extends Pt{constructor(e=null,t=1,i=1,n,r,o,a,l,c=ei,h=ei,d,f){super(null,o,a,l,c,h,n,r,d,f),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const bL=new fe,$q=new fe;class Gp{constructor(e=[],t=[]){this.uuid=ma(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new fe)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new fe;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:$q;bL.multiplyMatrices(a,t[r]),bL.toArray(i,r*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new Gp(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Go(t,e,e,Ti,vn);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){const r=e.bones[i];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new Pp),this.bones.push(o),this.boneInverses.push(new fe().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){const o=t[n];e.bones.push(o.uuid);const a=i[n];e.boneInverses.push(a.toArray())}return e}}class Fo extends ot{constructor(e,t,i,n=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Bm=new fe,xL=new fe,Bb=[],wL=new Si,eX=new fe,Zv=new le,$v=new _n;class YP extends le{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Fo(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<i;n++)this.setMatrixAt(n,eX)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Si),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Bm),wL.copy(e.boundingBox).applyMatrix4(Bm),this.boundingBox.union(wL)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new _n),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Bm),$v.copy(e.boundingSphere).applyMatrix4(Bm),this.boundingSphere.union($v)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,n=this.morphTexture.source.data.data,r=i.length+1,o=e*r+1;for(let a=0;a<i.length;a++)i[a]=n[o+a]}raycast(e,t){const i=this.matrixWorld,n=this.count;if(Zv.geometry=this.geometry,Zv.material=this.material,Zv.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),$v.copy(this.boundingSphere),$v.applyMatrix4(i),e.ray.intersectsSphere($v)!==!1))for(let r=0;r<n;r++){this.getMatrixAt(r,Bm),xL.multiplyMatrices(i,Bm),Zv.matrixWorld=xL,Zv.raycast(e,Bb);for(let o=0,a=Bb.length;o<a;o++){const l=Bb[o];l.instanceId=r,l.object=this,t.push(l)}Bb.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Fo(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,n=i.length+1;this.morphTexture===null&&(this.morphTexture=new Go(new Float32Array(n*this.count),n,this.count,Tl,vn));const r=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=n*e;r[l]=a,r.set(i,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function tX(s,e){return s.z-e.z}function iX(s,e){return e.z-s.z}class nX{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const i=this.pool,n=this.list;this.index>=i.length&&i.push({start:-1,count:-1,z:-1});const r=i[this.index];n.push(r),this.index++,r.start=e.start,r.count=e.count,r.z=t}reset(){this.list.length=0,this.index=0}}const Dm="batchId",Fu=new fe,SL=new fe,sX=new fe,CL=new fe,z1=new Rp,Db=new Si,mf=new _n,ey=new w,G1=new nX,Or=new le,Ob=[];function rX(s,e,t=0){const i=e.itemSize;if(s.isInterleavedBufferAttribute||s.array.constructor!==e.array.constructor){const n=s.count;for(let r=0;r<n;r++)for(let o=0;o<i;o++)e.setComponent(r+t,o,s.getComponent(r,o))}else e.array.set(s.array,t*i);e.needsUpdate=!0}class Xw extends le{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,i=t*2,n){super(new pt,n),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=i,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxGeometryCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),i=new Go(t,e,e,Ti,vn);this._matricesTexture=i}_initializeGeometry(e){const t=this.geometry,i=this._maxVertexCount,n=this._maxGeometryCount,r=this._maxIndexCount;if(this._geometryInitialized===!1){for(const a in e.attributes){const l=e.getAttribute(a),{array:c,itemSize:h,normalized:d}=l,f=new c.constructor(i*h),p=new ot(f,h,d);t.setAttribute(a,p)}if(e.getIndex()!==null){const a=i>65536?new Uint32Array(r):new Uint16Array(r);t.setIndex(new ot(a,1))}const o=n>65536?new Uint32Array(i):new Uint16Array(i);t.setAttribute(Dm,new ot(o,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(Dm))throw new Error(`BatchedMesh: Geometry cannot use attribute "${Dm}"`);const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const i in t.attributes){if(i===Dm)continue;if(!e.hasAttribute(i))throw new Error(`BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const n=e.getAttribute(i),r=t.getAttribute(i);if(n.itemSize!==r.itemSize||n.normalized!==r.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Si);const e=this._geometryCount,t=this.boundingBox,i=this._active;t.makeEmpty();for(let n=0;n<e;n++)i[n]!==!1&&(this.getMatrixAt(n,Fu),this.getBoundingBoxAt(n,Db).applyMatrix4(Fu),t.union(Db))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new _n);const e=this._geometryCount,t=this.boundingSphere,i=this._active;t.makeEmpty();for(let n=0;n<e;n++)i[n]!==!1&&(this.getMatrixAt(n,Fu),this.getBoundingSphereAt(n,mf).applyMatrix4(Fu),t.union(mf))}addGeometry(e,t=-1,i=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const n={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let r=null;const o=this._reservedRanges,a=this._drawRanges,l=this._bounds;this._geometryCount!==0&&(r=o[o.length-1]),t===-1?n.vertexCount=e.getAttribute("position").count:n.vertexCount=t,r===null?n.vertexStart=0:n.vertexStart=r.vertexStart+r.vertexCount;const c=e.getIndex(),h=c!==null;if(h&&(i===-1?n.indexCount=c.count:n.indexCount=i,r===null?n.indexStart=0:n.indexStart=r.indexStart+r.indexCount),n.indexStart!==-1&&n.indexStart+n.indexCount>this._maxIndexCount||n.vertexStart+n.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const d=this._visibility,f=this._active,p=this._matricesTexture,m=this._matricesTexture.image.data;d.push(!0),f.push(!0);const v=this._geometryCount;this._geometryCount++,sX.toArray(m,v*16),p.needsUpdate=!0,o.push(n),a.push({start:h?n.indexStart:n.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new Si,sphereInitialized:!1,sphere:new _n});const y=this.geometry.getAttribute(Dm);for(let g=0;g<n.vertexCount;g++)y.setX(n.vertexStart+g,v);return y.needsUpdate=!0,this.setGeometryAt(v,e),v}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const i=this.geometry,n=i.getIndex()!==null,r=i.getIndex(),o=t.getIndex(),a=this._reservedRanges[e];if(n&&o.count>a.indexCount||t.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=a.vertexStart,c=a.vertexCount;for(const p in i.attributes){if(p===Dm)continue;const m=t.getAttribute(p),v=i.getAttribute(p);rX(m,v,l);const y=m.itemSize;for(let g=m.count,_=c;g<_;g++){const A=l+g;for(let b=0;b<y;b++)v.setComponent(A,b,0)}v.needsUpdate=!0,v.addUpdateRange(l*y,c*y)}if(n){const p=a.indexStart;for(let m=0;m<o.count;m++)r.setX(p+m,l+o.getX(m));for(let m=o.count,v=a.indexCount;m<v;m++)r.setX(p+m,l);r.needsUpdate=!0,r.addUpdateRange(p,a.indexCount)}const h=this._bounds[e];t.boundingBox!==null?(h.box.copy(t.boundingBox),h.boxInitialized=!0):h.boxInitialized=!1,t.boundingSphere!==null?(h.sphere.copy(t.boundingSphere),h.sphereInitialized=!0):h.sphereInitialized=!1;const d=this._drawRanges[e],f=t.getAttribute("position");return d.count=n?o.count:f.count,this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._active;return e>=t.length||t[e]===!1?this:(t[e]=!1,this._visibilityChanged=!0,this)}getBoundingBoxAt(e,t){if(this._active[e]===!1)return null;const n=this._bounds[e],r=n.box,o=this.geometry;if(n.boxInitialized===!1){r.makeEmpty();const a=o.index,l=o.attributes.position,c=this._drawRanges[e];for(let h=c.start,d=c.start+c.count;h<d;h++){let f=h;a&&(f=a.getX(f)),r.expandByPoint(ey.fromBufferAttribute(l,f))}n.boxInitialized=!0}return t.copy(r),t}getBoundingSphereAt(e,t){if(this._active[e]===!1)return null;const n=this._bounds[e],r=n.sphere,o=this.geometry;if(n.sphereInitialized===!1){r.makeEmpty(),this.getBoundingBoxAt(e,Db),Db.getCenter(r.center);const a=o.index,l=o.attributes.position,c=this._drawRanges[e];let h=0;for(let d=c.start,f=c.start+c.count;d<f;d++){let p=d;a&&(p=a.getX(p)),ey.fromBufferAttribute(l,p),h=Math.max(h,r.center.distanceToSquared(ey))}r.radius=Math.sqrt(h),n.sphereInitialized=!0}return t.copy(r),t}setMatrixAt(e,t){const i=this._active,n=this._matricesTexture,r=this._matricesTexture.image.data,o=this._geometryCount;return e>=o||i[e]===!1?this:(t.toArray(r,e*16),n.needsUpdate=!0,this)}getMatrixAt(e,t){const i=this._active,n=this._matricesTexture.image.data,r=this._geometryCount;return e>=r||i[e]===!1?null:t.fromArray(n,e*16)}setVisibleAt(e,t){const i=this._visibility,n=this._active,r=this._geometryCount;return e>=r||n[e]===!1||i[e]===t?this:(i[e]=t,this._visibilityChanged=!0,this)}getVisibleAt(e){const t=this._visibility,i=this._active,n=this._geometryCount;return e>=n||i[e]===!1?!1:t[e]}raycast(e,t){const i=this._visibility,n=this._active,r=this._drawRanges,o=this._geometryCount,a=this.matrixWorld,l=this.geometry;Or.material=this.material,Or.geometry.index=l.index,Or.geometry.attributes=l.attributes,Or.geometry.boundingBox===null&&(Or.geometry.boundingBox=new Si),Or.geometry.boundingSphere===null&&(Or.geometry.boundingSphere=new _n);for(let c=0;c<o;c++){if(!i[c]||!n[c])continue;const h=r[c];Or.geometry.setDrawRange(h.start,h.count),this.getMatrixAt(c,Or.matrixWorld).premultiply(a),this.getBoundingBoxAt(c,Or.geometry.boundingBox),this.getBoundingSphereAt(c,Or.geometry.boundingSphere),Or.raycast(e,Ob);for(let d=0,f=Ob.length;d<f;d++){const p=Ob[d];p.object=this,p.batchId=c,t.push(p)}Ob.length=0}Or.material=null,Or.geometry.index=null,Or.geometry.attributes={},Or.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>({...t})),this._reservedRanges=e._reservedRanges.map(t=>({...t})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,t,i,n,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=n.getIndex(),a=o===null?1:o.array.BYTES_PER_ELEMENT,l=this._active,c=this._visibility,h=this._multiDrawStarts,d=this._multiDrawCounts,f=this._drawRanges,p=this.perObjectFrustumCulled;p&&(CL.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),z1.setFromProjectionMatrix(CL,e.coordinateSystem));let m=0;if(this.sortObjects){SL.copy(this.matrixWorld).invert(),ey.setFromMatrixPosition(i.matrixWorld).applyMatrix4(SL);for(let g=0,_=c.length;g<_;g++)if(c[g]&&l[g]){this.getMatrixAt(g,Fu),this.getBoundingSphereAt(g,mf).applyMatrix4(Fu);let A=!1;if(p&&(A=!z1.intersectsSphere(mf)),!A){const b=ey.distanceTo(mf.center);G1.push(f[g],b)}}const v=G1.list,y=this.customSort;y===null?v.sort(r.transparent?iX:tX):y.call(this,v,i);for(let g=0,_=v.length;g<_;g++){const A=v[g];h[m]=A.start*a,d[m]=A.count,m++}G1.reset()}else for(let v=0,y=c.length;v<y;v++)if(c[v]&&l[v]){let g=!1;if(p&&(this.getMatrixAt(v,Fu),this.getBoundingSphereAt(v,mf).applyMatrix4(Fu),g=!z1.intersectsSphere(mf)),!g){const _=f[v];h[m]=_.start*a,d[m]=_.count,m++}}this._multiDrawCount=m,this._visibilityChanged=!1}onBeforeShadow(e,t,i,n,r,o){this.onBeforeRender(e,null,n,r,o)}}class hn extends Vt{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new me(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const EL=new w,TL=new w,ML=new fe,H1=new jo,Lb=new _n;let Rn=class extends ge{constructor(e=new pt,t=new hn){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let n=1,r=t.count;n<r;n++)EL.fromBufferAttribute(t,n-1),TL.fromBufferAttribute(t,n),i[n]=i[n-1],i[n]+=EL.distanceTo(TL);e.setAttribute("lineDistance",new nt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Lb.copy(i.boundingSphere),Lb.applyMatrix4(n),Lb.radius+=r,e.ray.intersectsSphere(Lb)===!1)return;ML.copy(n).invert(),H1.copy(e.ray).applyMatrix4(ML);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new w,h=new w,d=new w,f=new w,p=this.isLineSegments?2:1,m=i.index,y=i.attributes.position;if(m!==null){const g=Math.max(0,o.start),_=Math.min(m.count,o.start+o.count);for(let A=g,b=_-1;A<b;A+=p){const E=m.getX(A),C=m.getX(A+1);if(c.fromBufferAttribute(y,E),h.fromBufferAttribute(y,C),H1.distanceSqToSegment(c,h,f,d)>l)continue;f.applyMatrix4(this.matrixWorld);const M=e.ray.origin.distanceTo(f);M<e.near||M>e.far||t.push({distance:M,point:d.clone().applyMatrix4(this.matrixWorld),index:A,face:null,faceIndex:null,object:this})}}else{const g=Math.max(0,o.start),_=Math.min(y.count,o.start+o.count);for(let A=g,b=_-1;A<b;A+=p){if(c.fromBufferAttribute(y,A),h.fromBufferAttribute(y,A+1),H1.distanceSqToSegment(c,h,f,d)>l)continue;f.applyMatrix4(this.matrixWorld);const C=e.ray.origin.distanceTo(f);C<e.near||C>e.far||t.push({distance:C,point:d.clone().applyMatrix4(this.matrixWorld),index:A,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}};const IL=new w,RL=new w;class Xr extends Rn{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let n=0,r=t.count;n<r;n+=2)IL.fromBufferAttribute(t,n),RL.fromBufferAttribute(t,n+1),i[n]=n===0?0:i[n-1],i[n+1]=i[n]+IL.distanceTo(RL);e.setAttribute("lineDistance",new nt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class KP extends Rn{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class cd extends Vt{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new me(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const PL=new fe,DI=new jo,kb=new _n,Fb=new w;class Mg extends ge{constructor(e=new pt,t=new cd){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),kb.copy(i.boundingSphere),kb.applyMatrix4(n),kb.radius+=r,e.ray.intersectsSphere(kb)===!1)return;PL.copy(n).invert(),DI.copy(e.ray).applyMatrix4(PL);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,d=i.attributes.position;if(c!==null){const f=Math.max(0,o.start),p=Math.min(c.count,o.start+o.count);for(let m=f,v=p;m<v;m++){const y=c.getX(m);Fb.fromBufferAttribute(d,y),BL(Fb,y,l,n,e,t,this)}}else{const f=Math.max(0,o.start),p=Math.min(d.count,o.start+o.count);for(let m=f,v=p;m<v;m++)Fb.fromBufferAttribute(d,m),BL(Fb,m,l,n,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function BL(s,e,t,i,n,r,o){const a=DI.distanceSqToPoint(s);if(a<t){const l=new w;DI.closestPointToPoint(s,l),l.applyMatrix4(i);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class d4 extends Pt{constructor(e,t,i,n,r,o,a,l,c){super(e,t,i,n,r,o,a,l,c),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:Nt,this.magFilter=r!==void 0?r:Nt,this.generateMipmaps=!1;const h=this;function d(){h.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class oX extends Pt{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=ei,this.minFilter=ei,this.generateMipmaps=!1,this.needsUpdate=!0}}class Oc extends Pt{constructor(e,t,i,n,r,o,a,l,c,h,d,f){super(null,o,a,l,c,h,n,r,d,f),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class f4 extends Oc{constructor(e,t,i,n,r,o){super(e,t,i,r,o),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=ps}}class p4 extends Oc{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,uu),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class JP extends Pt{constructor(e,t,i,n,r,o,a,l,c){super(e,t,i,n,r,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class el{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),r+=i.distanceTo(n),t.push(r),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let n=0;const r=i.length;let o;t?o=t:o=e*i[r-1];let a=0,l=r-1,c;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),c=i[n]-o,c<0)a=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,i[n]===o)return n/(r-1);const h=i[n],f=i[n+1]-h,p=(o-h)/f;return(n+p)/(r-1)}getTangent(e,t){let n=e-1e-4,r=e+1e-4;n<0&&(n=0),r>1&&(r=1);const o=this.getPoint(n),a=this.getPoint(r),l=t||(o.isVector2?new Z:new w);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new w,n=[],r=[],o=[],a=new w,l=new fe;for(let p=0;p<=e;p++){const m=p/e;n[p]=this.getTangentAt(m,new w)}r[0]=new w,o[0]=new w;let c=Number.MAX_VALUE;const h=Math.abs(n[0].x),d=Math.abs(n[0].y),f=Math.abs(n[0].z);h<=c&&(c=h,i.set(1,0,0)),d<=c&&(c=d,i.set(0,1,0)),f<=c&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),o[0].crossVectors(n[0],r[0]);for(let p=1;p<=e;p++){if(r[p]=r[p-1].clone(),o[p]=o[p-1].clone(),a.crossVectors(n[p-1],n[p]),a.length()>Number.EPSILON){a.normalize();const m=Math.acos(Zn(n[p-1].dot(n[p]),-1,1));r[p].applyMatrix4(l.makeRotationAxis(a,m))}o[p].crossVectors(n[p],r[p])}if(t===!0){let p=Math.acos(Zn(r[0].dot(r[e]),-1,1));p/=e,n[0].dot(a.crossVectors(r[0],r[e]))>0&&(p=-p);for(let m=1;m<=e;m++)r[m].applyMatrix4(l.makeRotationAxis(n[m],p*m)),o[m].crossVectors(n[m],r[m])}return{tangents:n,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class EC extends el{constructor(e=0,t=0,i=1,n=1,r=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t=new Z){const i=t,n=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(o?r=0:r=n),this.aClockwise===!0&&!o&&(r===n?r=-n:r=r-n);const a=this.aStartAngle+e*r;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const h=Math.cos(this.aRotation),d=Math.sin(this.aRotation),f=l-this.aX,p=c-this.aY;l=f*h-p*d+this.aX,c=f*d+p*h+this.aY}return i.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class m4 extends EC{constructor(e,t,i,n,r,o){super(e,t,i,i,n,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function ZP(){let s=0,e=0,t=0,i=0;function n(r,o,a,l){s=r,e=a,t=-3*r+3*o-2*a-l,i=2*r-2*o+a+l}return{initCatmullRom:function(r,o,a,l,c){n(o,a,c*(a-r),c*(l-o))},initNonuniformCatmullRom:function(r,o,a,l,c,h,d){let f=(o-r)/c-(a-r)/(c+h)+(a-o)/h,p=(a-o)/h-(l-o)/(h+d)+(l-a)/d;f*=h,p*=h,n(o,a,f,p)},calc:function(r){const o=r*r,a=o*r;return s+e*r+t*o+i*a}}}const Ub=new w,V1=new ZP,Q1=new ZP,j1=new ZP;class g4 extends el{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new w){const i=t,n=this.points,r=n.length,o=(r-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:l===0&&a===r-1&&(a=r-2,l=1);let c,h;this.closed||a>0?c=n[(a-1)%r]:(Ub.subVectors(n[0],n[1]).add(n[0]),c=Ub);const d=n[a%r],f=n[(a+1)%r];if(this.closed||a+2<r?h=n[(a+2)%r]:(Ub.subVectors(n[r-1],n[r-2]).add(n[r-1]),h=Ub),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let m=Math.pow(c.distanceToSquared(d),p),v=Math.pow(d.distanceToSquared(f),p),y=Math.pow(f.distanceToSquared(h),p);v<1e-4&&(v=1),m<1e-4&&(m=v),y<1e-4&&(y=v),V1.initNonuniformCatmullRom(c.x,d.x,f.x,h.x,m,v,y),Q1.initNonuniformCatmullRom(c.y,d.y,f.y,h.y,m,v,y),j1.initNonuniformCatmullRom(c.z,d.z,f.z,h.z,m,v,y)}else this.curveType==="catmullrom"&&(V1.initCatmullRom(c.x,d.x,f.x,h.x,this.tension),Q1.initCatmullRom(c.y,d.y,f.y,h.y,this.tension),j1.initCatmullRom(c.z,d.z,f.z,h.z,this.tension));return i.set(V1.calc(l),Q1.calc(l),j1.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(new w().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function DL(s,e,t,i,n){const r=(i-e)*.5,o=(n-t)*.5,a=s*s,l=s*a;return(2*t-2*i+r+o)*l+(-3*t+3*i-2*r-o)*a+r*s+t}function aX(s,e){const t=1-s;return t*t*e}function lX(s,e){return 2*(1-s)*s*e}function cX(s,e){return s*s*e}function oA(s,e,t,i){return aX(s,e)+lX(s,t)+cX(s,i)}function hX(s,e){const t=1-s;return t*t*t*e}function uX(s,e){const t=1-s;return 3*t*t*s*e}function dX(s,e){return 3*(1-s)*s*s*e}function fX(s,e){return s*s*s*e}function aA(s,e,t,i,n){return hX(s,e)+uX(s,t)+dX(s,i)+fX(s,n)}class $P extends el{constructor(e=new Z,t=new Z,i=new Z,n=new Z){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new Z){const i=t,n=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(aA(e,n.x,r.x,o.x,a.x),aA(e,n.y,r.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class v4 extends el{constructor(e=new w,t=new w,i=new w,n=new w){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new w){const i=t,n=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(aA(e,n.x,r.x,o.x,a.x),aA(e,n.y,r.y,o.y,a.y),aA(e,n.z,r.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class eB extends el{constructor(e=new Z,t=new Z){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Z){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Z){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class y4 extends el{constructor(e=new w,t=new w){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new w){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new w){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class tB extends el{constructor(e=new Z,t=new Z,i=new Z){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Z){const i=t,n=this.v0,r=this.v1,o=this.v2;return i.set(oA(e,n.x,r.x,o.x),oA(e,n.y,r.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class iB extends el{constructor(e=new w,t=new w,i=new w){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new w){const i=t,n=this.v0,r=this.v1,o=this.v2;return i.set(oA(e,n.x,r.x,o.x),oA(e,n.y,r.y,o.y),oA(e,n.z,r.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class nB extends el{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Z){const i=t,n=this.points,r=(n.length-1)*e,o=Math.floor(r),a=r-o,l=n[o===0?o:o-1],c=n[o],h=n[o>n.length-2?n.length-1:o+1],d=n[o>n.length-3?n.length-1:o+2];return i.set(DL(a,l.x,c.x,h.x,d.x),DL(a,l.y,c.y,h.y,d.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(new Z().fromArray(n))}return this}}var Yw=Object.freeze({__proto__:null,ArcCurve:m4,CatmullRomCurve3:g4,CubicBezierCurve:$P,CubicBezierCurve3:v4,EllipseCurve:EC,LineCurve:eB,LineCurve3:y4,QuadraticBezierCurve:tB,QuadraticBezierCurve3:iB,SplineCurve:nB});class A4 extends el{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Yw[i](t,e))}return this}getPoint(e,t){const i=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const o=n[r]-i,a=this.curves[r],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const o=r[n],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const h=l[c];i&&i.equals(h)||(t.push(h),i=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const n=e.curves[t];this.curves.push(new Yw[n.type]().fromJSON(n))}return this}}class n0 extends A4{constructor(e){super(),this.type="Path",this.currentPoint=new Z,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new eB(this.currentPoint.clone(),new Z(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){const r=new tB(this.currentPoint.clone(),new Z(e,t),new Z(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,o){const a=new $P(this.currentPoint.clone(),new Z(e,t),new Z(i,n),new Z(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new nB(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,i,n,r,o),this}absarc(e,t,i,n,r,o){return this.absellipse(e,t,i,i,n,r,o),this}ellipse(e,t,i,n,r,o,a,l){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,t+h,i,n,r,o,a,l),this}absellipse(e,t,i,n,r,o,a,l){const c=new EC(e,t,i,n,r,o,a,l);if(this.curves.length>0){const d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class $0 extends pt{constructor(e=[new Z(0,-.5),new Z(.5,0),new Z(0,.5)],t=12,i=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=Zn(n,0,Math.PI*2);const r=[],o=[],a=[],l=[],c=[],h=1/t,d=new w,f=new Z,p=new w,m=new w,v=new w;let y=0,g=0;for(let _=0;_<=e.length-1;_++)switch(_){case 0:y=e[_+1].x-e[_].x,g=e[_+1].y-e[_].y,p.x=g*1,p.y=-y,p.z=g*0,v.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case e.length-1:l.push(v.x,v.y,v.z);break;default:y=e[_+1].x-e[_].x,g=e[_+1].y-e[_].y,p.x=g*1,p.y=-y,p.z=g*0,m.copy(p),p.x+=v.x,p.y+=v.y,p.z+=v.z,p.normalize(),l.push(p.x,p.y,p.z),v.copy(m)}for(let _=0;_<=t;_++){const A=i+_*h*n,b=Math.sin(A),E=Math.cos(A);for(let C=0;C<=e.length-1;C++){d.x=e[C].x*b,d.y=e[C].y,d.z=e[C].x*E,o.push(d.x,d.y,d.z),f.x=_/t,f.y=C/(e.length-1),a.push(f.x,f.y);const T=l[3*C+0]*b,M=l[3*C+1],R=l[3*C+0]*E;c.push(T,M,R)}}for(let _=0;_<t;_++)for(let A=0;A<e.length-1;A++){const b=A+_*e.length,E=b,C=b+e.length,T=b+e.length+1,M=b+1;r.push(E,C,M),r.push(T,M,C)}this.setIndex(r),this.setAttribute("position",new nt(o,3)),this.setAttribute("uv",new nt(a,2)),this.setAttribute("normal",new nt(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new $0(e.points,e.segments,e.phiStart,e.phiLength)}}class TC extends $0{constructor(e=1,t=1,i=4,n=8){const r=new n0;r.absarc(0,-t/2,e,Math.PI*1.5,0),r.absarc(0,t/2,e,0,Math.PI*.5),super(r.getPoints(i),n),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:i,radialSegments:n}}static fromJSON(e){return new TC(e.radius,e.length,e.capSegments,e.radialSegments)}}class MC extends pt{constructor(e=1,t=32,i=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},t=Math.max(3,t);const r=[],o=[],a=[],l=[],c=new w,h=new Z;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let d=0,f=3;d<=t;d++,f+=3){const p=i+d/t*n;c.x=e*Math.cos(p),c.y=e*Math.sin(p),o.push(c.x,c.y,c.z),a.push(0,0,1),h.x=(o[f]/e+1)/2,h.y=(o[f+1]/e+1)/2,l.push(h.x,h.y)}for(let d=1;d<=t;d++)r.push(d,d+1,0);this.setIndex(r),this.setAttribute("position",new nt(o,3)),this.setAttribute("normal",new nt(a,3)),this.setAttribute("uv",new nt(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new MC(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class ts extends pt{constructor(e=1,t=1,i=1,n=32,r=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l};const c=this;n=Math.floor(n),r=Math.floor(r);const h=[],d=[],f=[],p=[];let m=0;const v=[],y=i/2;let g=0;_(),o===!1&&(e>0&&A(!0),t>0&&A(!1)),this.setIndex(h),this.setAttribute("position",new nt(d,3)),this.setAttribute("normal",new nt(f,3)),this.setAttribute("uv",new nt(p,2));function _(){const b=new w,E=new w;let C=0;const T=(t-e)/i;for(let M=0;M<=r;M++){const R=[],S=M/r,I=S*(t-e)+e;for(let L=0;L<=n;L++){const U=L/n,D=U*l+a,V=Math.sin(D),O=Math.cos(D);E.x=I*V,E.y=-S*i+y,E.z=I*O,d.push(E.x,E.y,E.z),b.set(V,T,O).normalize(),f.push(b.x,b.y,b.z),p.push(U,1-S),R.push(m++)}v.push(R)}for(let M=0;M<n;M++)for(let R=0;R<r;R++){const S=v[R][M],I=v[R+1][M],L=v[R+1][M+1],U=v[R][M+1];h.push(S,I,U),h.push(I,L,U),C+=6}c.addGroup(g,C,0),g+=C}function A(b){const E=m,C=new Z,T=new w;let M=0;const R=b===!0?e:t,S=b===!0?1:-1;for(let L=1;L<=n;L++)d.push(0,y*S,0),f.push(0,S,0),p.push(.5,.5),m++;const I=m;for(let L=0;L<=n;L++){const D=L/n*l+a,V=Math.cos(D),O=Math.sin(D);T.x=R*O,T.y=y*S,T.z=R*V,d.push(T.x,T.y,T.z),f.push(0,S,0),C.x=V*.5+.5,C.y=O*.5*S+.5,p.push(C.x,C.y),m++}for(let L=0;L<n;L++){const U=E+L,D=I+L;b===!0?h.push(D,D+1,U):h.push(D+1,D,U),M+=3}c.addGroup(g,M,b===!0?1:2),g+=M}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ts(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class IC extends ts{constructor(e=1,t=1,i=32,n=1,r=!1,o=0,a=Math.PI*2){super(0,e,t,i,n,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:a}}static fromJSON(e){return new IC(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Fd extends pt{constructor(e=[],t=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};const r=[],o=[];a(n),c(i),h(),this.setAttribute("position",new nt(r,3)),this.setAttribute("normal",new nt(r.slice(),3)),this.setAttribute("uv",new nt(o,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function a(_){const A=new w,b=new w,E=new w;for(let C=0;C<t.length;C+=3)p(t[C+0],A),p(t[C+1],b),p(t[C+2],E),l(A,b,E,_)}function l(_,A,b,E){const C=E+1,T=[];for(let M=0;M<=C;M++){T[M]=[];const R=_.clone().lerp(b,M/C),S=A.clone().lerp(b,M/C),I=C-M;for(let L=0;L<=I;L++)L===0&&M===C?T[M][L]=R:T[M][L]=R.clone().lerp(S,L/I)}for(let M=0;M<C;M++)for(let R=0;R<2*(C-M)-1;R++){const S=Math.floor(R/2);R%2===0?(f(T[M][S+1]),f(T[M+1][S]),f(T[M][S])):(f(T[M][S+1]),f(T[M+1][S+1]),f(T[M+1][S]))}}function c(_){const A=new w;for(let b=0;b<r.length;b+=3)A.x=r[b+0],A.y=r[b+1],A.z=r[b+2],A.normalize().multiplyScalar(_),r[b+0]=A.x,r[b+1]=A.y,r[b+2]=A.z}function h(){const _=new w;for(let A=0;A<r.length;A+=3){_.x=r[A+0],_.y=r[A+1],_.z=r[A+2];const b=y(_)/2/Math.PI+.5,E=g(_)/Math.PI+.5;o.push(b,1-E)}m(),d()}function d(){for(let _=0;_<o.length;_+=6){const A=o[_+0],b=o[_+2],E=o[_+4],C=Math.max(A,b,E),T=Math.min(A,b,E);C>.9&&T<.1&&(A<.2&&(o[_+0]+=1),b<.2&&(o[_+2]+=1),E<.2&&(o[_+4]+=1))}}function f(_){r.push(_.x,_.y,_.z)}function p(_,A){const b=_*3;A.x=e[b+0],A.y=e[b+1],A.z=e[b+2]}function m(){const _=new w,A=new w,b=new w,E=new w,C=new Z,T=new Z,M=new Z;for(let R=0,S=0;R<r.length;R+=9,S+=6){_.set(r[R+0],r[R+1],r[R+2]),A.set(r[R+3],r[R+4],r[R+5]),b.set(r[R+6],r[R+7],r[R+8]),C.set(o[S+0],o[S+1]),T.set(o[S+2],o[S+3]),M.set(o[S+4],o[S+5]),E.copy(_).add(A).add(b).divideScalar(3);const I=y(E);v(C,S+0,_,I),v(T,S+2,A,I),v(M,S+4,b,I)}}function v(_,A,b,E){E<0&&_.x===1&&(o[A]=_.x-1),b.x===0&&b.z===0&&(o[A]=E/2/Math.PI+.5)}function y(_){return Math.atan2(_.z,-_.x)}function g(_){return Math.atan2(-_.y,Math.sqrt(_.x*_.x+_.z*_.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Fd(e.vertices,e.indices,e.radius,e.details)}}class RC extends Fd{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,n=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new RC(e.radius,e.detail)}}const Nb=new w,zb=new w,W1=new w,Gb=new mo;class sB extends pt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const n=Math.pow(10,4),r=Math.cos(hp*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],h=["a","b","c"],d=new Array(3),f={},p=[];for(let m=0;m<l;m+=3){o?(c[0]=o.getX(m),c[1]=o.getX(m+1),c[2]=o.getX(m+2)):(c[0]=m,c[1]=m+1,c[2]=m+2);const{a:v,b:y,c:g}=Gb;if(v.fromBufferAttribute(a,c[0]),y.fromBufferAttribute(a,c[1]),g.fromBufferAttribute(a,c[2]),Gb.getNormal(W1),d[0]=`${Math.round(v.x*n)},${Math.round(v.y*n)},${Math.round(v.z*n)}`,d[1]=`${Math.round(y.x*n)},${Math.round(y.y*n)},${Math.round(y.z*n)}`,d[2]=`${Math.round(g.x*n)},${Math.round(g.y*n)},${Math.round(g.z*n)}`,!(d[0]===d[1]||d[1]===d[2]||d[2]===d[0]))for(let _=0;_<3;_++){const A=(_+1)%3,b=d[_],E=d[A],C=Gb[h[_]],T=Gb[h[A]],M=`${b}_${E}`,R=`${E}_${b}`;R in f&&f[R]?(W1.dot(f[R].normal)<=r&&(p.push(C.x,C.y,C.z),p.push(T.x,T.y,T.z)),f[R]=null):M in f||(f[M]={index0:c[_],index1:c[A],normal:W1.clone()})}}for(const m in f)if(f[m]){const{index0:v,index1:y}=f[m];Nb.fromBufferAttribute(a,v),zb.fromBufferAttribute(a,y),p.push(Nb.x,Nb.y,Nb.z),p.push(zb.x,zb.y,zb.z)}this.setAttribute("position",new nt(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class gd extends n0{constructor(e){super(e),this.uuid=ma(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const n=e.holes[t];this.holes.push(new n0().fromJSON(n))}return this}}const pX={triangulate:function(s,e,t=2){const i=e&&e.length,n=i?e[0]*t:s.length;let r=_4(s,0,n,t,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c,h,d,f,p;if(i&&(r=AX(s,e,r,t)),s.length>80*t){a=c=s[0],l=h=s[1];for(let m=t;m<n;m+=t)d=s[m],f=s[m+1],d<a&&(a=d),f<l&&(l=f),d>c&&(c=d),f>h&&(h=f);p=Math.max(c-a,h-l),p=p!==0?32767/p:0}return s0(r,o,t,a,l,p,0),o}};function _4(s,e,t,i,n){let r,o;if(n===RX(s,e,t,i)>0)for(r=e;r<t;r+=i)o=OL(r,s[r],s[r+1],o);else for(r=t-i;r>=e;r-=i)o=OL(r,s[r],s[r+1],o);return o&&PC(o,o.next)&&(o0(o),o=o.next),o}function Bp(s,e){if(!s)return s;e||(e=s);let t=s,i;do if(i=!1,!t.steiner&&(PC(t,t.next)||zn(t.prev,t,t.next)===0)){if(o0(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function s0(s,e,t,i,n,r,o){if(!s)return;!o&&r&&SX(s,i,n,r);let a=s,l,c;for(;s.prev!==s.next;){if(l=s.prev,c=s.next,r?gX(s,i,n,r):mX(s)){e.push(l.i/t|0),e.push(s.i/t|0),e.push(c.i/t|0),o0(s),s=c.next,a=c.next;continue}if(s=c,s===a){o?o===1?(s=vX(Bp(s),e,t),s0(s,e,t,i,n,r,2)):o===2&&yX(s,e,t,i,n,r):s0(Bp(s),e,t,i,n,r,1);break}}}function mX(s){const e=s.prev,t=s,i=s.next;if(zn(e,t,i)>=0)return!1;const n=e.x,r=t.x,o=i.x,a=e.y,l=t.y,c=i.y,h=n<r?n<o?n:o:r<o?r:o,d=a<l?a<c?a:c:l<c?l:c,f=n>r?n>o?n:o:r>o?r:o,p=a>l?a>c?a:c:l>c?l:c;let m=i.next;for(;m!==e;){if(m.x>=h&&m.x<=f&&m.y>=d&&m.y<=p&&og(n,a,r,l,o,c,m.x,m.y)&&zn(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function gX(s,e,t,i){const n=s.prev,r=s,o=s.next;if(zn(n,r,o)>=0)return!1;const a=n.x,l=r.x,c=o.x,h=n.y,d=r.y,f=o.y,p=a<l?a<c?a:c:l<c?l:c,m=h<d?h<f?h:f:d<f?d:f,v=a>l?a>c?a:c:l>c?l:c,y=h>d?h>f?h:f:d>f?d:f,g=OI(p,m,e,t,i),_=OI(v,y,e,t,i);let A=s.prevZ,b=s.nextZ;for(;A&&A.z>=g&&b&&b.z<=_;){if(A.x>=p&&A.x<=v&&A.y>=m&&A.y<=y&&A!==n&&A!==o&&og(a,h,l,d,c,f,A.x,A.y)&&zn(A.prev,A,A.next)>=0||(A=A.prevZ,b.x>=p&&b.x<=v&&b.y>=m&&b.y<=y&&b!==n&&b!==o&&og(a,h,l,d,c,f,b.x,b.y)&&zn(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;A&&A.z>=g;){if(A.x>=p&&A.x<=v&&A.y>=m&&A.y<=y&&A!==n&&A!==o&&og(a,h,l,d,c,f,A.x,A.y)&&zn(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;b&&b.z<=_;){if(b.x>=p&&b.x<=v&&b.y>=m&&b.y<=y&&b!==n&&b!==o&&og(a,h,l,d,c,f,b.x,b.y)&&zn(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function vX(s,e,t){let i=s;do{const n=i.prev,r=i.next.next;!PC(n,r)&&b4(n,i,i.next,r)&&r0(n,r)&&r0(r,n)&&(e.push(n.i/t|0),e.push(i.i/t|0),e.push(r.i/t|0),o0(i),o0(i.next),i=s=r),i=i.next}while(i!==s);return Bp(i)}function yX(s,e,t,i,n,r){let o=s;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&TX(o,a)){let l=x4(o,a);o=Bp(o,o.next),l=Bp(l,l.next),s0(o,e,t,i,n,r,0),s0(l,e,t,i,n,r,0);return}a=a.next}o=o.next}while(o!==s)}function AX(s,e,t,i){const n=[];let r,o,a,l,c;for(r=0,o=e.length;r<o;r++)a=e[r]*i,l=r<o-1?e[r+1]*i:s.length,c=_4(s,a,l,i,!1),c===c.next&&(c.steiner=!0),n.push(EX(c));for(n.sort(_X),r=0;r<n.length;r++)t=bX(n[r],t);return t}function _X(s,e){return s.x-e.x}function bX(s,e){const t=xX(s,e);if(!t)return e;const i=x4(t,s);return Bp(i,i.next),Bp(t,t.next)}function xX(s,e){let t=e,i=-1/0,n;const r=s.x,o=s.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const f=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(f<=r&&f>i&&(i=f,n=t.x<t.next.x?t:t.next,f===r))return n}t=t.next}while(t!==e);if(!n)return null;const a=n,l=n.x,c=n.y;let h=1/0,d;t=n;do r>=t.x&&t.x>=l&&r!==t.x&&og(o<c?r:i,o,l,c,o<c?i:r,o,t.x,t.y)&&(d=Math.abs(o-t.y)/(r-t.x),r0(t,s)&&(d<h||d===h&&(t.x>n.x||t.x===n.x&&wX(n,t)))&&(n=t,h=d)),t=t.next;while(t!==a);return n}function wX(s,e){return zn(s.prev,s,e.prev)<0&&zn(e.next,s,s.next)<0}function SX(s,e,t,i){let n=s;do n.z===0&&(n.z=OI(n.x,n.y,e,t,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==s);n.prevZ.nextZ=null,n.prevZ=null,CX(n)}function CX(s){let e,t,i,n,r,o,a,l,c=1;do{for(t=s,s=null,r=null,o=0;t;){for(o++,i=t,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||t.z<=i.z)?(n=t,t=t.nextZ,a--):(n=i,i=i.nextZ,l--),r?r.nextZ=n:s=n,n.prevZ=r,r=n;t=i}r.nextZ=null,c*=2}while(o>1);return s}function OI(s,e,t,i,n){return s=(s-t)*n|0,e=(e-i)*n|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function EX(s){let e=s,t=s;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==s);return t}function og(s,e,t,i,n,r,o,a){return(n-o)*(e-a)>=(s-o)*(r-a)&&(s-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(r-a)>=(n-o)*(i-a)}function TX(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!MX(s,e)&&(r0(s,e)&&r0(e,s)&&IX(s,e)&&(zn(s.prev,s,e.prev)||zn(s,e.prev,e))||PC(s,e)&&zn(s.prev,s,s.next)>0&&zn(e.prev,e,e.next)>0)}function zn(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function PC(s,e){return s.x===e.x&&s.y===e.y}function b4(s,e,t,i){const n=Vb(zn(s,e,t)),r=Vb(zn(s,e,i)),o=Vb(zn(t,i,s)),a=Vb(zn(t,i,e));return!!(n!==r&&o!==a||n===0&&Hb(s,t,e)||r===0&&Hb(s,i,e)||o===0&&Hb(t,s,i)||a===0&&Hb(t,e,i))}function Hb(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function Vb(s){return s>0?1:s<0?-1:0}function MX(s,e){let t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&b4(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}function r0(s,e){return zn(s.prev,s,s.next)<0?zn(s,e,s.next)>=0&&zn(s,s.prev,e)>=0:zn(s,e,s.prev)<0||zn(s,s.next,e)<0}function IX(s,e){let t=s,i=!1;const n=(s.x+e.x)/2,r=(s.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&n<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==s);return i}function x4(s,e){const t=new LI(s.i,s.x,s.y),i=new LI(e.i,e.x,e.y),n=s.next,r=e.prev;return s.next=e,e.prev=s,t.next=n,n.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i}function OL(s,e,t,i){const n=new LI(s,e,t);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function o0(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function LI(s,e,t){this.i=s,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function RX(s,e,t,i){let n=0;for(let r=e,o=t-i;r<t;r+=i)n+=(s[o]-s[r])*(s[r+1]+s[o+1]),o=r;return n}class Rl{static area(e){const t=e.length;let i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return i*.5}static isClockWise(e){return Rl.area(e)<0}static triangulateShape(e,t){const i=[],n=[],r=[];LL(e),kL(i,e);let o=e.length;t.forEach(LL);for(let l=0;l<t.length;l++)n.push(o),o+=t[l].length,kL(i,t[l]);const a=pX.triangulate(i,n);for(let l=0;l<a.length;l+=3)r.push(a.slice(l,l+3));return r}}function LL(s){const e=s.length;e>2&&s[e-1].equals(s[0])&&s.pop()}function kL(s,e){for(let t=0;t<e.length;t++)s.push(e[t].x),s.push(e[t].y)}class vv extends pt{constructor(e=new gd([new Z(.5,.5),new Z(-.5,.5),new Z(-.5,-.5),new Z(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,n=[],r=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new nt(n,3)),this.setAttribute("uv",new nt(r,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,d=t.depth!==void 0?t.depth:1;let f=t.bevelEnabled!==void 0?t.bevelEnabled:!0,p=t.bevelThickness!==void 0?t.bevelThickness:.2,m=t.bevelSize!==void 0?t.bevelSize:p-.1,v=t.bevelOffset!==void 0?t.bevelOffset:0,y=t.bevelSegments!==void 0?t.bevelSegments:3;const g=t.extrudePath,_=t.UVGenerator!==void 0?t.UVGenerator:PX;let A,b=!1,E,C,T,M;g&&(A=g.getSpacedPoints(h),b=!0,f=!1,E=g.computeFrenetFrames(h,!1),C=new w,T=new w,M=new w),f||(y=0,p=0,m=0,v=0);const R=a.extractPoints(c);let S=R.shape;const I=R.holes;if(!Rl.isClockWise(S)){S=S.reverse();for(let W=0,Ge=I.length;W<Ge;W++){const we=I[W];Rl.isClockWise(we)&&(I[W]=we.reverse())}}const U=Rl.triangulateShape(S,I),D=S;for(let W=0,Ge=I.length;W<Ge;W++){const we=I[W];S=S.concat(we)}function V(W,Ge,we){return Ge||console.error("THREE.ExtrudeGeometry: vec does not exist"),W.clone().addScaledVector(Ge,we)}const O=S.length,F=U.length;function N(W,Ge,we){let Ne,Ee,st;const tt=W.x-Ge.x,ct=W.y-Ge.y,jt=we.x-W.x,H=we.y-W.y,k=tt*tt+ct*ct,ve=tt*H-ct*jt;if(Math.abs(ve)>Number.EPSILON){const _e=Math.sqrt(k),Pe=Math.sqrt(jt*jt+H*H),Me=Ge.x-ct/_e,Ct=Ge.y+tt/_e,mt=we.x-H/Pe,ke=we.y+jt/Pe,Ve=((mt-Me)*H-(ke-Ct)*jt)/(tt*H-ct*jt);Ne=Me+tt*Ve-W.x,Ee=Ct+ct*Ve-W.y;const Tt=Ne*Ne+Ee*Ee;if(Tt<=2)return new Z(Ne,Ee);st=Math.sqrt(Tt/2)}else{let _e=!1;tt>Number.EPSILON?jt>Number.EPSILON&&(_e=!0):tt<-Number.EPSILON?jt<-Number.EPSILON&&(_e=!0):Math.sign(ct)===Math.sign(H)&&(_e=!0),_e?(Ne=-ct,Ee=tt,st=Math.sqrt(k)):(Ne=tt,Ee=ct,st=Math.sqrt(k/2))}return new Z(Ne/st,Ee/st)}const q=[];for(let W=0,Ge=D.length,we=Ge-1,Ne=W+1;W<Ge;W++,we++,Ne++)we===Ge&&(we=0),Ne===Ge&&(Ne=0),q[W]=N(D[W],D[we],D[Ne]);const $=[];let oe,ae=q.concat();for(let W=0,Ge=I.length;W<Ge;W++){const we=I[W];oe=[];for(let Ne=0,Ee=we.length,st=Ee-1,tt=Ne+1;Ne<Ee;Ne++,st++,tt++)st===Ee&&(st=0),tt===Ee&&(tt=0),oe[Ne]=N(we[Ne],we[st],we[tt]);$.push(oe),ae=ae.concat(oe)}for(let W=0;W<y;W++){const Ge=W/y,we=p*Math.cos(Ge*Math.PI/2),Ne=m*Math.sin(Ge*Math.PI/2)+v;for(let Ee=0,st=D.length;Ee<st;Ee++){const tt=V(D[Ee],q[Ee],Ne);je(tt.x,tt.y,-we)}for(let Ee=0,st=I.length;Ee<st;Ee++){const tt=I[Ee];oe=$[Ee];for(let ct=0,jt=tt.length;ct<jt;ct++){const H=V(tt[ct],oe[ct],Ne);je(H.x,H.y,-we)}}}const Re=m+v;for(let W=0;W<O;W++){const Ge=f?V(S[W],ae[W],Re):S[W];b?(T.copy(E.normals[0]).multiplyScalar(Ge.x),C.copy(E.binormals[0]).multiplyScalar(Ge.y),M.copy(A[0]).add(T).add(C),je(M.x,M.y,M.z)):je(Ge.x,Ge.y,0)}for(let W=1;W<=h;W++)for(let Ge=0;Ge<O;Ge++){const we=f?V(S[Ge],ae[Ge],Re):S[Ge];b?(T.copy(E.normals[W]).multiplyScalar(we.x),C.copy(E.binormals[W]).multiplyScalar(we.y),M.copy(A[W]).add(T).add(C),je(M.x,M.y,M.z)):je(we.x,we.y,d/h*W)}for(let W=y-1;W>=0;W--){const Ge=W/y,we=p*Math.cos(Ge*Math.PI/2),Ne=m*Math.sin(Ge*Math.PI/2)+v;for(let Ee=0,st=D.length;Ee<st;Ee++){const tt=V(D[Ee],q[Ee],Ne);je(tt.x,tt.y,d+we)}for(let Ee=0,st=I.length;Ee<st;Ee++){const tt=I[Ee];oe=$[Ee];for(let ct=0,jt=tt.length;ct<jt;ct++){const H=V(tt[ct],oe[ct],Ne);b?je(H.x,H.y+A[h-1].y,A[h-1].x+we):je(H.x,H.y,d+we)}}}se(),ye();function se(){const W=n.length/3;if(f){let Ge=0,we=O*Ge;for(let Ne=0;Ne<F;Ne++){const Ee=U[Ne];Be(Ee[2]+we,Ee[1]+we,Ee[0]+we)}Ge=h+y*2,we=O*Ge;for(let Ne=0;Ne<F;Ne++){const Ee=U[Ne];Be(Ee[0]+we,Ee[1]+we,Ee[2]+we)}}else{for(let Ge=0;Ge<F;Ge++){const we=U[Ge];Be(we[2],we[1],we[0])}for(let Ge=0;Ge<F;Ge++){const we=U[Ge];Be(we[0]+O*h,we[1]+O*h,we[2]+O*h)}}i.addGroup(W,n.length/3-W,0)}function ye(){const W=n.length/3;let Ge=0;Ae(D,Ge),Ge+=D.length;for(let we=0,Ne=I.length;we<Ne;we++){const Ee=I[we];Ae(Ee,Ge),Ge+=Ee.length}i.addGroup(W,n.length/3-W,1)}function Ae(W,Ge){let we=W.length;for(;--we>=0;){const Ne=we;let Ee=we-1;Ee<0&&(Ee=W.length-1);for(let st=0,tt=h+y*2;st<tt;st++){const ct=O*st,jt=O*(st+1),H=Ge+Ne+ct,k=Ge+Ee+ct,ve=Ge+Ee+jt,_e=Ge+Ne+jt;We(H,k,ve,_e)}}}function je(W,Ge,we){l.push(W),l.push(Ge),l.push(we)}function Be(W,Ge,we){lt(W),lt(Ge),lt(we);const Ne=n.length/3,Ee=_.generateTopUV(i,n,Ne-3,Ne-2,Ne-1);rt(Ee[0]),rt(Ee[1]),rt(Ee[2])}function We(W,Ge,we,Ne){lt(W),lt(Ge),lt(Ne),lt(Ge),lt(we),lt(Ne);const Ee=n.length/3,st=_.generateSideWallUV(i,n,Ee-6,Ee-3,Ee-2,Ee-1);rt(st[0]),rt(st[1]),rt(st[3]),rt(st[1]),rt(st[2]),rt(st[3])}function lt(W){n.push(l[W*3+0]),n.push(l[W*3+1]),n.push(l[W*3+2])}function rt(W){r.push(W.x),r.push(W.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return BX(t,i,e)}static fromJSON(e,t){const i=[];for(let r=0,o=e.shapes.length;r<o;r++){const a=t[e.shapes[r]];i.push(a)}const n=e.options.extrudePath;return n!==void 0&&(e.options.extrudePath=new Yw[n.type]().fromJSON(n)),new vv(i,e.options)}}const PX={generateTopUV:function(s,e,t,i,n){const r=e[t*3],o=e[t*3+1],a=e[i*3],l=e[i*3+1],c=e[n*3],h=e[n*3+1];return[new Z(r,o),new Z(a,l),new Z(c,h)]},generateSideWallUV:function(s,e,t,i,n,r){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[i*3],h=e[i*3+1],d=e[i*3+2],f=e[n*3],p=e[n*3+1],m=e[n*3+2],v=e[r*3],y=e[r*3+1],g=e[r*3+2];return Math.abs(a-h)<Math.abs(o-c)?[new Z(o,1-l),new Z(c,1-d),new Z(f,1-m),new Z(v,1-g)]:[new Z(a,1-l),new Z(h,1-d),new Z(p,1-m),new Z(y,1-g)]}};function BX(s,e,t){if(t.shapes=[],Array.isArray(s))for(let i=0,n=s.length;i<n;i++){const r=s[i];t.shapes.push(r.uuid)}else t.shapes.push(s.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class BC extends Fd{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,n=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(n,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new BC(e.radius,e.detail)}}class Xh extends Fd{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,n,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Xh(e.radius,e.detail)}}class e_ extends pt{constructor(e=.5,t=1,i=32,n=1,r=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},i=Math.max(3,i),n=Math.max(1,n);const a=[],l=[],c=[],h=[];let d=e;const f=(t-e)/n,p=new w,m=new Z;for(let v=0;v<=n;v++){for(let y=0;y<=i;y++){const g=r+y/i*o;p.x=d*Math.cos(g),p.y=d*Math.sin(g),l.push(p.x,p.y,p.z),c.push(0,0,1),m.x=(p.x/t+1)/2,m.y=(p.y/t+1)/2,h.push(m.x,m.y)}d+=f}for(let v=0;v<n;v++){const y=v*(i+1);for(let g=0;g<i;g++){const _=g+y,A=_,b=_+i+1,E=_+i+2,C=_+1;a.push(A,b,C),a.push(b,E,C)}}this.setIndex(a),this.setAttribute("position",new nt(l,3)),this.setAttribute("normal",new nt(c,3)),this.setAttribute("uv",new nt(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new e_(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class DC extends pt{constructor(e=new gd([new Z(0,.5),new Z(-.5,-.5),new Z(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],n=[],r=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let h=0;h<e.length;h++)c(e[h]),this.addGroup(a,l,h),a+=l,l=0;this.setIndex(i),this.setAttribute("position",new nt(n,3)),this.setAttribute("normal",new nt(r,3)),this.setAttribute("uv",new nt(o,2));function c(h){const d=n.length/3,f=h.extractPoints(t);let p=f.shape;const m=f.holes;Rl.isClockWise(p)===!1&&(p=p.reverse());for(let y=0,g=m.length;y<g;y++){const _=m[y];Rl.isClockWise(_)===!0&&(m[y]=_.reverse())}const v=Rl.triangulateShape(p,m);for(let y=0,g=m.length;y<g;y++){const _=m[y];p=p.concat(_)}for(let y=0,g=p.length;y<g;y++){const _=p[y];n.push(_.x,_.y,0),r.push(0,0,1),o.push(_.x,_.y)}for(let y=0,g=v.length;y<g;y++){const _=v[y],A=_[0]+d,b=_[1]+d,E=_[2]+d;i.push(A,b,E),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return DX(t,e)}static fromJSON(e,t){const i=[];for(let n=0,r=e.shapes.length;n<r;n++){const o=t[e.shapes[n]];i.push(o)}return new DC(i,e.curveSegments)}}function DX(s,e){if(e.shapes=[],Array.isArray(s))for(let t=0,i=s.length;t<i;t++){const n=s[t];e.shapes.push(n.uuid)}else e.shapes.push(s.uuid);return e}class Wo extends pt{constructor(e=1,t=32,i=16,n=0,r=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let c=0;const h=[],d=new w,f=new w,p=[],m=[],v=[],y=[];for(let g=0;g<=i;g++){const _=[],A=g/i;let b=0;g===0&&o===0?b=.5/t:g===i&&l===Math.PI&&(b=-.5/t);for(let E=0;E<=t;E++){const C=E/t;d.x=-e*Math.cos(n+C*r)*Math.sin(o+A*a),d.y=e*Math.cos(o+A*a),d.z=e*Math.sin(n+C*r)*Math.sin(o+A*a),m.push(d.x,d.y,d.z),f.copy(d).normalize(),v.push(f.x,f.y,f.z),y.push(C+b,1-A),_.push(c++)}h.push(_)}for(let g=0;g<i;g++)for(let _=0;_<t;_++){const A=h[g][_+1],b=h[g][_],E=h[g+1][_],C=h[g+1][_+1];(g!==0||o>0)&&p.push(A,b,C),(g!==i-1||l<Math.PI)&&p.push(b,E,C)}this.setIndex(p),this.setAttribute("position",new nt(m,3)),this.setAttribute("normal",new nt(v,3)),this.setAttribute("uv",new nt(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wo(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class OC extends Fd{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,n,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new OC(e.radius,e.detail)}}class Hh extends pt{constructor(e=1,t=.4,i=12,n=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);const o=[],a=[],l=[],c=[],h=new w,d=new w,f=new w;for(let p=0;p<=i;p++)for(let m=0;m<=n;m++){const v=m/n*r,y=p/i*Math.PI*2;d.x=(e+t*Math.cos(y))*Math.cos(v),d.y=(e+t*Math.cos(y))*Math.sin(v),d.z=t*Math.sin(y),a.push(d.x,d.y,d.z),h.x=e*Math.cos(v),h.y=e*Math.sin(v),f.subVectors(d,h).normalize(),l.push(f.x,f.y,f.z),c.push(m/n),c.push(p/i)}for(let p=1;p<=i;p++)for(let m=1;m<=n;m++){const v=(n+1)*p+m-1,y=(n+1)*(p-1)+m-1,g=(n+1)*(p-1)+m,_=(n+1)*p+m;o.push(v,y,_),o.push(y,g,_)}this.setIndex(o),this.setAttribute("position",new nt(a,3)),this.setAttribute("normal",new nt(l,3)),this.setAttribute("uv",new nt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hh(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class LC extends pt{constructor(e=1,t=.4,i=64,n=8,r=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:o},i=Math.floor(i),n=Math.floor(n);const a=[],l=[],c=[],h=[],d=new w,f=new w,p=new w,m=new w,v=new w,y=new w,g=new w;for(let A=0;A<=i;++A){const b=A/i*r*Math.PI*2;_(b,r,o,e,p),_(b+.01,r,o,e,m),y.subVectors(m,p),g.addVectors(m,p),v.crossVectors(y,g),g.crossVectors(v,y),v.normalize(),g.normalize();for(let E=0;E<=n;++E){const C=E/n*Math.PI*2,T=-t*Math.cos(C),M=t*Math.sin(C);d.x=p.x+(T*g.x+M*v.x),d.y=p.y+(T*g.y+M*v.y),d.z=p.z+(T*g.z+M*v.z),l.push(d.x,d.y,d.z),f.subVectors(d,p).normalize(),c.push(f.x,f.y,f.z),h.push(A/i),h.push(E/n)}}for(let A=1;A<=i;A++)for(let b=1;b<=n;b++){const E=(n+1)*(A-1)+(b-1),C=(n+1)*A+(b-1),T=(n+1)*A+b,M=(n+1)*(A-1)+b;a.push(E,C,M),a.push(C,T,M)}this.setIndex(a),this.setAttribute("position",new nt(l,3)),this.setAttribute("normal",new nt(c,3)),this.setAttribute("uv",new nt(h,2));function _(A,b,E,C,T){const M=Math.cos(A),R=Math.sin(A),S=E/b*A,I=Math.cos(S);T.x=C*(2+I)*.5*M,T.y=C*(2+I)*R*.5,T.z=C*Math.sin(S)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new LC(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class kC extends pt{constructor(e=new iB(new w(-1,-1,0),new w(-1,1,0),new w(1,1,0)),t=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new w,l=new w,c=new Z;let h=new w;const d=[],f=[],p=[],m=[];v(),this.setIndex(m),this.setAttribute("position",new nt(d,3)),this.setAttribute("normal",new nt(f,3)),this.setAttribute("uv",new nt(p,2));function v(){for(let A=0;A<t;A++)y(A);y(r===!1?t:0),_(),g()}function y(A){h=e.getPointAt(A/t,h);const b=o.normals[A],E=o.binormals[A];for(let C=0;C<=n;C++){const T=C/n*Math.PI*2,M=Math.sin(T),R=-Math.cos(T);l.x=R*b.x+M*E.x,l.y=R*b.y+M*E.y,l.z=R*b.z+M*E.z,l.normalize(),f.push(l.x,l.y,l.z),a.x=h.x+i*l.x,a.y=h.y+i*l.y,a.z=h.z+i*l.z,d.push(a.x,a.y,a.z)}}function g(){for(let A=1;A<=t;A++)for(let b=1;b<=n;b++){const E=(n+1)*(A-1)+(b-1),C=(n+1)*A+(b-1),T=(n+1)*A+b,M=(n+1)*(A-1)+b;m.push(E,C,M),m.push(C,T,M)}}function _(){for(let A=0;A<=t;A++)for(let b=0;b<=n;b++)c.x=A/t,c.y=b/n,p.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new kC(new Yw[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class rB extends pt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,n=new w,r=new w;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,h=l.length;c<h;++c){const d=l[c],f=d.start,p=d.count;for(let m=f,v=f+p;m<v;m+=3)for(let y=0;y<3;y++){const g=a.getX(m+y),_=a.getX(m+(y+1)%3);n.fromBufferAttribute(o,g),r.fromBufferAttribute(o,_),FL(n,r,i)===!0&&(t.push(n.x,n.y,n.z),t.push(r.x,r.y,r.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let c=0;c<3;c++){const h=3*a+c,d=3*a+(c+1)%3;n.fromBufferAttribute(o,h),r.fromBufferAttribute(o,d),FL(n,r,i)===!0&&(t.push(n.x,n.y,n.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new nt(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function FL(s,e,t){const i=`${s.x},${s.y},${s.z}-${e.x},${e.y},${e.z}`,n=`${e.x},${e.y},${e.z}-${s.x},${s.y},${s.z}`;return t.has(i)===!0||t.has(n)===!0?!1:(t.add(i),t.add(n),!0)}var UL=Object.freeze({__proto__:null,BoxGeometry:Xi,CapsuleGeometry:TC,CircleGeometry:MC,ConeGeometry:IC,CylinderGeometry:ts,DodecahedronGeometry:RC,EdgesGeometry:sB,ExtrudeGeometry:vv,IcosahedronGeometry:BC,LatheGeometry:$0,OctahedronGeometry:Xh,PlaneGeometry:_s,PolyhedronGeometry:Fd,RingGeometry:e_,ShapeGeometry:DC,SphereGeometry:Wo,TetrahedronGeometry:OC,TorusGeometry:Hh,TorusKnotGeometry:LC,TubeGeometry:kC,WireframeGeometry:rB});class FC extends Vt{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new me(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class UC extends Rt{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class ms extends Vt{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new me(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new me(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kd,this.normalScale=new Z(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new oi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Qo extends ms{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Z(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Zn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new me(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new me(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new me(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class up extends Vt{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new me(16777215),this.specular=new me(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new me(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kd,this.normalScale=new Z(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new oi,this.combine=j0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class w4 extends Vt{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new me(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new me(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kd,this.normalScale=new Z(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class NC extends Vt{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kd,this.normalScale=new Z(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class oB extends Vt{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new me(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new me(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kd,this.normalScale=new Z(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new oi,this.combine=j0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class S4 extends Vt{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new me(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kd,this.normalScale=new Z(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class C4 extends hn{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function tp(s,e,t){return!s||!t&&s.constructor===e?s:typeof e.BYTES_PER_ELEMENT=="number"?new e(s):Array.prototype.slice.call(s)}function E4(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function T4(s){function e(n,r){return s[n]-s[r]}const t=s.length,i=new Array(t);for(let n=0;n!==t;++n)i[n]=n;return i.sort(e),i}function kI(s,e,t){const i=s.length,n=new s.constructor(i);for(let r=0,o=0;o!==i;++r){const a=t[r]*e;for(let l=0;l!==e;++l)n[o++]=s[a+l]}return n}function aB(s,e,t,i){let n=1,r=s[0];for(;r!==void 0&&r[i]===void 0;)r=s[n++];if(r===void 0)return;let o=r[i];if(o!==void 0)if(Array.isArray(o))do o=r[i],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=s[n++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[i],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=s[n++];while(r!==void 0);else do o=r[i],o!==void 0&&(e.push(r.time),t.push(o)),r=s[n++];while(r!==void 0)}function OX(s,e,t,i,n=30){const r=s.clone();r.name=e;const o=[];for(let l=0;l<r.tracks.length;++l){const c=r.tracks[l],h=c.getValueSize(),d=[],f=[];for(let p=0;p<c.times.length;++p){const m=c.times[p]*n;if(!(m<t||m>=i)){d.push(c.times[p]);for(let v=0;v<h;++v)f.push(c.values[p*h+v])}}d.length!==0&&(c.times=tp(d,c.times.constructor),c.values=tp(f,c.values.constructor),o.push(c))}r.tracks=o;let a=1/0;for(let l=0;l<r.tracks.length;++l)a>r.tracks[l].times[0]&&(a=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*a);return r.resetDuration(),r}function LX(s,e=0,t=s,i=30){i<=0&&(i=30);const n=t.tracks.length,r=e/i;for(let o=0;o<n;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=s.tracks.find(function(g){return g.name===a.name&&g.ValueTypeName===l});if(c===void 0)continue;let h=0;const d=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=d/3);let f=0;const p=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=p/3);const m=a.times.length-1;let v;if(r<=a.times[0]){const g=h,_=d-h;v=a.values.slice(g,_)}else if(r>=a.times[m]){const g=m*d+h,_=g+d-h;v=a.values.slice(g,_)}else{const g=a.createInterpolant(),_=h,A=d-h;g.evaluate(r),v=g.resultBuffer.slice(_,A)}l==="quaternion"&&new xe().fromArray(v).normalize().conjugate().toArray(v);const y=c.times.length;for(let g=0;g<y;++g){const _=g*p+f;if(l==="quaternion")xe.multiplyQuaternionsFlat(c.values,_,v,0,c.values,_);else{const A=p-f*2;for(let b=0;b<A;++b)c.values[_+b]-=v[b]}}}return s.blendMode=kP,s}const kX={convertArray:tp,isTypedArray:E4,getKeyframeOrder:T4,sortedArray:kI,flattenJSON:aB,subclip:OX,makeClipAdditive:LX};class yv{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let o;i:{n:if(!(e<n)){for(let a=i+2;;){if(n===void 0){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=n,n=t[++i],e<n)break t}o=t.length;break i}if(!(e>=r)){const a=t[1];e<a&&(i=2,r=a);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(n=r,r=t[--i-1],e>=r)break t}o=i,i=0;break i}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(n=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let o=0;o!==n;++o)t[o]=i[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class M4 extends yv{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Zf,endingEnd:Zf}}intervalChanged_(e,t,i){const n=this.parameterPositions;let r=e-2,o=e+1,a=n[r],l=n[o];if(a===void 0)switch(this.getSettings_().endingStart){case $f:r=e,a=2*t-i;break;case KA:r=n.length-2,a=t+n[r]-n[r+1];break;default:r=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case $f:o=e,l=2*i-t;break;case KA:o=1,l=i+n[1]-n[0];break;default:o=e-1,l=t}const c=(i-t)*.5,h=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,p=this._weightNext,m=(i-t)/(n-t),v=m*m,y=v*m,g=-f*y+2*f*v-f*m,_=(1+f)*y+(-1.5-2*f)*v+(-.5+f)*m+1,A=(-1-p)*y+(1.5+p)*v+.5*m,b=p*y-p*v;for(let E=0;E!==a;++E)r[E]=g*o[h+E]+_*o[c+E]+A*o[l+E]+b*o[d+E];return r}}class lB extends yv{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=(i-t)/(n-t),d=1-h;for(let f=0;f!==a;++f)r[f]=o[c+f]*d+o[l+f]*h;return r}}class I4 extends yv{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class zl{constructor(e,t,i,n){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=tp(t,this.TimeBufferType),this.values=tp(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:tp(e.times,Array),values:tp(e.values,Array)};const n=e.getInterpolation();n!==e.DefaultInterpolation&&(i.interpolation=n)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new I4(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new lB(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new M4(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ip:t=this.InterpolantFactoryMethodDiscrete;break;case Id:t=this.InterpolantFactoryMethodLinear;break;case aw:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ip;case this.InterpolantFactoryMethodLinear:return Id;case this.InterpolantFactoryMethodSmooth:return aw}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let r=0,o=n-1;for(;r!==n&&i[r]<e;)++r;for(;o!==-1&&i[o]>t;)--o;if(++o,r!==0||o!==n){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=i.slice(r,o),this.values=this.values.slice(r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(n!==void 0&&E4(n))for(let a=0,l=n.length;a!==l;++a){const c=n[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),n=this.getInterpolation()===aw,r=e.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=e[a],h=e[a+1];if(c!==h&&(a!==1||c!==e[0]))if(n)l=!0;else{const d=a*i,f=d-i,p=d+i;for(let m=0;m!==i;++m){const v=t[d+m];if(v!==t[f+m]||v!==t[p+m]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*i,f=o*i;for(let p=0;p!==i;++p)t[f+p]=t[d+p]}++o}}if(r>0){e[o]=e[r];for(let a=r*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,n=new i(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}zl.prototype.TimeBufferType=Float32Array;zl.prototype.ValueBufferType=Float32Array;zl.prototype.DefaultInterpolation=Id;class Hp extends zl{}Hp.prototype.ValueTypeName="bool";Hp.prototype.ValueBufferType=Array;Hp.prototype.DefaultInterpolation=Ip;Hp.prototype.InterpolantFactoryMethodLinear=void 0;Hp.prototype.InterpolantFactoryMethodSmooth=void 0;class cB extends zl{}cB.prototype.ValueTypeName="color";class Rd extends zl{}Rd.prototype.ValueTypeName="number";class R4 extends yv{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(n-t);let c=e*a;for(let h=c+a;c!==h;c+=4)xe.slerpFlat(r,0,o,c-a,o,c,l);return r}}class qc extends zl{InterpolantFactoryMethodLinear(e){return new R4(this.times,this.values,this.getValueSize(),e)}}qc.prototype.ValueTypeName="quaternion";qc.prototype.DefaultInterpolation=Id;qc.prototype.InterpolantFactoryMethodSmooth=void 0;class Vp extends zl{}Vp.prototype.ValueTypeName="string";Vp.prototype.ValueBufferType=Array;Vp.prototype.DefaultInterpolation=Ip;Vp.prototype.InterpolantFactoryMethodLinear=void 0;Vp.prototype.InterpolantFactoryMethodSmooth=void 0;class pu extends zl{}pu.prototype.ValueTypeName="vector";class Ho{constructor(e,t=-1,i,n=vC){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=ma(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(UX(i[o]).scale(n));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=i.length;r!==o;++r)t.push(zl.toJSON(i[r]));return n}static CreateFromMorphTargetSequence(e,t,i,n){const r=t.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=T4(l);l=kI(l,1,h),c=kI(c,1,h),!n&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new Rd(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const n=e;i=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],h=c.name.match(r);if(h&&h.length>1){const d=h[1];let f=n[d];f||(n[d]=f=[]),f.push(c)}}const o=[];for(const a in n)o.push(this.CreateFromMorphTargetSequence(a,n[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(d,f,p,m,v){if(p.length!==0){const y=[],g=[];aB(p,y,g,m),y.length!==0&&v.push(new d(f,y,g))}},n=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const f=c[d].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const p={};let m;for(m=0;m<f.length;m++)if(f[m].morphTargets)for(let v=0;v<f[m].morphTargets.length;v++)p[f[m].morphTargets[v]]=-1;for(const v in p){const y=[],g=[];for(let _=0;_!==f[m].morphTargets.length;++_){const A=f[m];y.push(A.time),g.push(A.morphTarget===v?1:0)}n.push(new Rd(".morphTargetInfluence["+v+"]",y,g))}l=p.length*o}else{const p=".bones["+t[d].name+"]";i(pu,p+".position",f,"pos",n),i(qc,p+".quaternion",f,"rot",n),i(pu,p+".scale",f,"scl",n)}}return n.length===0?null:new this(r,l,n,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,n=e.length;i!==n;++i){const r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function FX(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Rd;case"vector":case"vector2":case"vector3":case"vector4":return pu;case"color":return cB;case"quaternion":return qc;case"bool":case"boolean":return Hp;case"string":return Vp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+s)}function UX(s){if(s.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=FX(s.type);if(s.times===void 0){const t=[],i=[];aB(s.keys,t,i,"value"),s.times=t,s.values=i}return e.parse!==void 0?e.parse(s):new e(s.name,s.times,s.values,s.interpolation)}const Yh={enabled:!1,files:{},add:function(s,e){this.enabled!==!1&&(this.files[s]=e)},get:function(s){if(this.enabled!==!1)return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};class zC{constructor(e,t,i){const n=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){a++,r===!1&&n.onStart!==void 0&&n.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,n.onProgress!==void 0&&n.onProgress(h,o,a),o===a&&(r=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(h){n.onError!==void 0&&n.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,d){return c.push(h,d),this},this.removeHandler=function(h){const d=c.indexOf(h);return d!==-1&&c.splice(d,2),this},this.getHandler=function(h){for(let d=0,f=c.length;d<f;d+=2){const p=c[d],m=c[d+1];if(p.global&&(p.lastIndex=0),p.test(h))return m}return null}}}const hB=new zC;class Vn{constructor(e){this.manager=e!==void 0?e:hB,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(n,r){i.load(e,n,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Vn.DEFAULT_MATERIAL_NAME="__DEFAULT";const vh={};class NX extends Error{constructor(e,t){super(e),this.response=t}}class Hn extends Vn{constructor(e){super(e)}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Yh.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(vh[e]!==void 0){vh[e].push({onLoad:t,onProgress:i,onError:n});return}vh[e]=[],vh[e].push({onLoad:t,onProgress:i,onError:n});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=vh[e],d=c.body.getReader(),f=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),p=f?parseInt(f):0,m=p!==0;let v=0;const y=new ReadableStream({start(g){_();function _(){d.read().then(({done:A,value:b})=>{if(A)g.close();else{v+=b.byteLength;const E=new ProgressEvent("progress",{lengthComputable:m,loaded:v,total:p});for(let C=0,T=h.length;C<T;C++){const M=h[C];M.onProgress&&M.onProgress(E)}g.enqueue(b),_()}})}}});return new Response(y)}else throw new NX(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a===void 0)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),f=d&&d[1]?d[1].toLowerCase():void 0,p=new TextDecoder(f);return c.arrayBuffer().then(m=>p.decode(m))}}}).then(c=>{Yh.add(e,c);const h=vh[e];delete vh[e];for(let d=0,f=h.length;d<f;d++){const p=h[d];p.onLoad&&p.onLoad(c)}}).catch(c=>{const h=vh[e];if(h===void 0)throw this.manager.itemError(e),c;delete vh[e];for(let d=0,f=h.length;d<f;d++){const p=h[d];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class zX extends Vn{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new Hn(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){n?n(l):console.error(l),r.manager.itemError(e)}},i,n)}parse(e){const t=[];for(let i=0;i<e.length;i++){const n=Ho.parse(e[i]);t.push(n)}return t}}class GX extends Vn{constructor(e){super(e)}load(e,t,i,n){const r=this,o=[],a=new Oc,l=new Hn(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(r.withCredentials);let c=0;function h(d){l.load(e[d],function(f){const p=r.parse(f,!0);o[d]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},c+=1,c===6&&(p.mipmapCount===1&&(a.minFilter=Nt),a.image=o,a.format=p.format,a.needsUpdate=!0,t&&t(a))},i,n)}if(Array.isArray(e))for(let d=0,f=e.length;d<f;++d)h(d);else l.load(e,function(d){const f=r.parse(d,!0);if(f.isCubemap){const p=f.mipmaps.length/f.mipmapCount;for(let m=0;m<p;m++){o[m]={mipmaps:[]};for(let v=0;v<f.mipmapCount;v++)o[m].mipmaps.push(f.mipmaps[m*f.mipmapCount+v]),o[m].format=f.format,o[m].width=f.width,o[m].height=f.height}a.image=o}else a.image.width=f.width,a.image.height=f.height,a.mipmaps=f.mipmaps;f.mipmapCount===1&&(a.minFilter=Nt),a.format=f.format,a.needsUpdate=!0,t&&t(a)},i,n);return a}}class a0 extends Vn{constructor(e){super(e)}load(e,t,i,n){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Yh.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=i0("img");function l(){h(),Yh.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(d){h(),n&&n(d),r.manager.itemError(e),r.manager.itemEnd(e)}function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class HX extends Vn{constructor(e){super(e)}load(e,t,i,n){const r=new K0;r.colorSpace=_t;const o=new a0(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(h){r.images[c]=h,a++,a===6&&(r.needsUpdate=!0,t&&t(r))},void 0,n)}for(let c=0;c<e.length;++c)l(c);return r}}class uB extends Vn{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new Go,a=new Hn(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,function(l){let c;try{c=r.parse(l)}catch(h){if(n!==void 0)n(h);else{console.error(h);return}}c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:ps,o.wrapT=c.wrapT!==void 0?c.wrapT:ps,o.magFilter=c.magFilter!==void 0?c.magFilter:Nt,o.minFilter=c.minFilter!==void 0?c.minFilter:Nt,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(o.colorSpace=c.colorSpace),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=go),c.mipmapCount===1&&(o.minFilter=Nt),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,t&&t(o,c)},i,n),o}}class Xa extends Vn{constructor(e){super(e)}load(e,t,i,n){const r=new Pt,o=new a0(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},i,n),r}}let Ud=class extends ge{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new me(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};class dB extends Ud{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ge.DEFAULT_UP),this.updateMatrix(),this.groundColor=new me(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const q1=new fe,NL=new w,zL=new w;class fB{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Z(512,512),this.map=null,this.mapPass=null,this.matrix=new fe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Rp,this._frameExtents=new Z(1,1),this._viewportCount=1,this._viewports=[new Je(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;NL.setFromMatrixPosition(e.matrixWorld),t.position.copy(NL),zL.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(zL),t.updateMatrixWorld(),q1.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(q1),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(q1)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class VX extends fB{constructor(){super(new zt(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=jg*2*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||n!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class t_ extends Ud{constructor(e,t,i=0,n=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ge.DEFAULT_UP),this.updateMatrix(),this.target=new ge,this.distance=i,this.angle=n,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new VX}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const GL=new fe,ty=new w,X1=new w;class QX extends fB{constructor(){super(new zt(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Z(4,2),this._viewportCount=6,this._viewports=[new Je(2,1,1,1),new Je(0,1,1,1),new Je(3,1,1,1),new Je(1,1,1,1),new Je(3,0,1,1),new Je(1,0,1,1)],this._cubeDirections=[new w(1,0,0),new w(-1,0,0),new w(0,0,1),new w(0,0,-1),new w(0,1,0),new w(0,-1,0)],this._cubeUps=[new w(0,1,0),new w(0,1,0),new w(0,1,0),new w(0,1,0),new w(0,0,1),new w(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),ty.setFromMatrixPosition(e.matrixWorld),i.position.copy(ty),X1.copy(i.position),X1.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(X1),i.updateMatrixWorld(),n.makeTranslation(-ty.x,-ty.y,-ty.z),GL.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(GL)}}class Dp extends Ud{constructor(e,t,i=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new QX}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class jX extends fB{constructor(){super(new Nl(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Op extends Ud{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ge.DEFAULT_UP),this.updateMatrix(),this.target=new ge,this.shadow=new jX}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class GC extends Ud{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class P4 extends Ud{constructor(e,t,i=10,n=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class B4{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new w)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,n=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*n),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],1.092548*(i*n)),t.addScaledVector(o[5],1.092548*(n*r)),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],1.092548*(i*r)),t.addScaledVector(o[8],.546274*(i*i-n*n)),t}getIrradianceAt(e,t){const i=e.x,n=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*n),t.addScaledVector(o[2],2*.511664*r),t.addScaledVector(o[3],2*.511664*i),t.addScaledVector(o[4],2*.429043*i*n),t.addScaledVector(o[5],2*.429043*n*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],2*.429043*i*r),t.addScaledVector(o[8],.429043*(i*i-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(e,t+n*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(e,t+n*3);return e}static getBasisAt(e,t){const i=e.x,n=e.y,r=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-n*n)}}class D4 extends Ud{constructor(e=new B4,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class HC extends Vn{constructor(e){super(e),this.textures={}}load(e,t,i,n){const r=this,o=new Hn(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){n?n(l):console.error(l),r.manager.itemError(e)}},i,n)}parse(e){const t=this.textures;function i(r){return t[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),t[r]}const n=HC.createMaterialFromType(e.type);if(e.uuid!==void 0&&(n.uuid=e.uuid),e.name!==void 0&&(n.name=e.name),e.color!==void 0&&n.color!==void 0&&n.color.setHex(e.color),e.roughness!==void 0&&(n.roughness=e.roughness),e.metalness!==void 0&&(n.metalness=e.metalness),e.sheen!==void 0&&(n.sheen=e.sheen),e.sheenColor!==void 0&&(n.sheenColor=new me().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(n.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&n.emissive!==void 0&&n.emissive.setHex(e.emissive),e.specular!==void 0&&n.specular!==void 0&&n.specular.setHex(e.specular),e.specularIntensity!==void 0&&(n.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&n.specularColor!==void 0&&n.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(n.shininess=e.shininess),e.clearcoat!==void 0&&(n.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(n.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(n.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(n.transmission=e.transmission),e.thickness!==void 0&&(n.thickness=e.thickness),e.attenuationDistance!==void 0&&(n.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&n.attenuationColor!==void 0&&n.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(n.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(n.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(n.fog=e.fog),e.flatShading!==void 0&&(n.flatShading=e.flatShading),e.blending!==void 0&&(n.blending=e.blending),e.combine!==void 0&&(n.combine=e.combine),e.side!==void 0&&(n.side=e.side),e.shadowSide!==void 0&&(n.shadowSide=e.shadowSide),e.opacity!==void 0&&(n.opacity=e.opacity),e.transparent!==void 0&&(n.transparent=e.transparent),e.alphaTest!==void 0&&(n.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(n.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(n.depthFunc=e.depthFunc),e.depthTest!==void 0&&(n.depthTest=e.depthTest),e.depthWrite!==void 0&&(n.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(n.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(n.blendSrc=e.blendSrc),e.blendDst!==void 0&&(n.blendDst=e.blendDst),e.blendEquation!==void 0&&(n.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(n.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(n.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(n.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&n.blendColor!==void 0&&n.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(n.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(n.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(n.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(n.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(n.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(n.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(n.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(n.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(n.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(n.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(n.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(n.rotation=e.rotation),e.linewidth!==void 0&&(n.linewidth=e.linewidth),e.dashSize!==void 0&&(n.dashSize=e.dashSize),e.gapSize!==void 0&&(n.gapSize=e.gapSize),e.scale!==void 0&&(n.scale=e.scale),e.polygonOffset!==void 0&&(n.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(n.dithering=e.dithering),e.alphaToCoverage!==void 0&&(n.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(n.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(n.visible=e.visible),e.toneMapped!==void 0&&(n.toneMapped=e.toneMapped),e.userData!==void 0&&(n.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const o=e.uniforms[r];switch(n.uniforms[r]={},o.type){case"t":n.uniforms[r].value=i(o.value);break;case"c":n.uniforms[r].value=new me().setHex(o.value);break;case"v2":n.uniforms[r].value=new Z().fromArray(o.value);break;case"v3":n.uniforms[r].value=new w().fromArray(o.value);break;case"v4":n.uniforms[r].value=new Je().fromArray(o.value);break;case"m3":n.uniforms[r].value=new Ht().fromArray(o.value);break;case"m4":n.uniforms[r].value=new fe().fromArray(o.value);break;default:n.uniforms[r].value=o.value}}if(e.defines!==void 0&&(n.defines=e.defines),e.vertexShader!==void 0&&(n.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(n.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(n.glslVersion=e.glslVersion),e.extensions!==void 0)for(const r in e.extensions)n.extensions[r]=e.extensions[r];if(e.lights!==void 0&&(n.lights=e.lights),e.clipping!==void 0&&(n.clipping=e.clipping),e.size!==void 0&&(n.size=e.size),e.sizeAttenuation!==void 0&&(n.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(n.map=i(e.map)),e.matcap!==void 0&&(n.matcap=i(e.matcap)),e.alphaMap!==void 0&&(n.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(n.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(n.bumpScale=e.bumpScale),e.normalMap!==void 0&&(n.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(n.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),n.normalScale=new Z().fromArray(r)}return e.displacementMap!==void 0&&(n.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(n.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(n.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(n.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(n.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(n.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(n.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(n.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(n.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(n.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(n.envMap=i(e.envMap)),e.envMapRotation!==void 0&&n.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(n.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(n.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(n.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(n.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(n.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(n.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(n.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(n.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(n.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new Z().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(n.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(n.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(n.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(n.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(n.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(n.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(n.sheenRoughnessMap=i(e.sheenRoughnessMap)),n}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:FC,SpriteMaterial:CC,RawShaderMaterial:UC,ShaderMaterial:Rt,PointsMaterial:cd,MeshPhysicalMaterial:Qo,MeshStandardMaterial:ms,MeshPhongMaterial:up,MeshToonMaterial:w4,MeshNormalMaterial:NC,MeshLambertMaterial:oB,MeshDepthMaterial:J0,MeshDistanceMaterial:jP,MeshBasicMaterial:Kt,MeshMatcapMaterial:S4,LineDashedMaterial:C4,LineBasicMaterial:hn,Material:Vt};return new t[e]}}class Lc{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class VC extends pt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class O4 extends Vn{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new Hn(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){n?n(l):console.error(l),r.manager.itemError(e)}},i,n)}parse(e){const t={},i={};function n(p,m){if(t[m]!==void 0)return t[m];const y=p.interleavedBuffers[m],g=r(p,y.buffer),_=ng(y.type,g),A=new Z0(_,y.stride);return A.uuid=y.uuid,t[m]=A,A}function r(p,m){if(i[m]!==void 0)return i[m];const y=p.arrayBuffers[m],g=new Uint32Array(y).buffer;return i[m]=g,g}const o=e.isInstancedBufferGeometry?new VC:new pt,a=e.data.index;if(a!==void 0){const p=ng(a.type,a.array);o.setIndex(new ot(p,1))}const l=e.data.attributes;for(const p in l){const m=l[p];let v;if(m.isInterleavedBufferAttribute){const y=n(e.data,m.data);v=new vo(y,m.itemSize,m.offset,m.normalized)}else{const y=ng(m.type,m.array),g=m.isInstancedBufferAttribute?Fo:ot;v=new g(y,m.itemSize,m.normalized)}m.name!==void 0&&(v.name=m.name),m.usage!==void 0&&v.setUsage(m.usage),o.setAttribute(p,v)}const c=e.data.morphAttributes;if(c)for(const p in c){const m=c[p],v=[];for(let y=0,g=m.length;y<g;y++){const _=m[y];let A;if(_.isInterleavedBufferAttribute){const b=n(e.data,_.data);A=new vo(b,_.itemSize,_.offset,_.normalized)}else{const b=ng(_.type,_.array);A=new ot(b,_.itemSize,_.normalized)}_.name!==void 0&&(A.name=_.name),v.push(A)}o.morphAttributes[p]=v}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const d=e.data.groups||e.data.drawcalls||e.data.offsets;if(d!==void 0)for(let p=0,m=d.length;p!==m;++p){const v=d[p];o.addGroup(v.start,v.count,v.materialIndex)}const f=e.data.boundingSphere;if(f!==void 0){const p=new w;f.center!==void 0&&p.fromArray(f.center),o.boundingSphere=new _n(p,f.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class WX extends Vn{constructor(e){super(e)}load(e,t,i,n){const r=this,o=this.path===""?Lc.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new Hn(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(d){n!==void 0&&n(d),console.error("THREE:ObjectLoader: Can't parse "+e+".",d.message);return}const h=c.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry"){n!==void 0&&n(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(c,t)},i,n)}async loadAsync(e,t){const i=this,n=this.path===""?Lc.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new Hn(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const o=await r.loadAsync(e,t),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(a)}parse(e,t){const i=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),o=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,r,l,a,i),h=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,h),t!==void 0){let d=!1;for(const f in o)if(o[f].data instanceof HTMLImageElement){d=!0;break}d===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,i),r=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,n,a,o,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(e){const t={};if(e!==void 0)for(let i=0,n=e.length;i<n;i++){const r=new gd().fromJSON(e[i]);t[r.uuid]=r}return t}parseSkeletons(e,t){const i={},n={};if(t.traverse(function(r){r.isBone&&(n[r.uuid]=r)}),e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=new Gp().fromJSON(e[r],n);i[a.uuid]=a}return i}parseGeometries(e,t){const i={};if(e!==void 0){const n=new O4;for(let r=0,o=e.length;r<o;r++){let a;const l=e[r];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=n.parse(l);break;default:l.type in UL?a=UL[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),i[l.uuid]=a}}return i}parseMaterials(e,t){const i={},n={};if(e!==void 0){const r=new HC;r.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];i[l.uuid]===void 0&&(i[l.uuid]=r.parse(l)),n[l.uuid]=i[l.uuid]}}return n}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const n=e[i],r=Ho.parse(n);t[r.uuid]=r}return t}parseImages(e,t){const i=this,n={};let r;function o(l){return i.manager.itemStart(l),r.load(l,function(){i.manager.itemEnd(l)},void 0,function(){i.manager.itemError(l),i.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:i.resourcePath+c;return o(h)}else return l.data?{data:ng(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new zC(t);r=new a0(l),r.setCrossOrigin(this.crossOrigin);for(let c=0,h=e.length;c<h;c++){const d=e[c],f=d.url;if(Array.isArray(f)){const p=[];for(let m=0,v=f.length;m<v;m++){const y=f[m],g=a(y);g!==null&&(g instanceof HTMLImageElement?p.push(g):p.push(new Go(g.data,g.width,g.height)))}n[d.uuid]=new qh(p)}else{const p=a(d.url);n[d.uuid]=new qh(p)}}}return n}async parseImagesAsync(e){const t=this,i={};let n;async function r(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await n.loadAsync(l)}else return o.data?{data:ng(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){n=new a0(this.manager),n.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],c=l.url;if(Array.isArray(c)){const h=[];for(let d=0,f=c.length;d<f;d++){const p=c[d],m=await r(p);m!==null&&(m instanceof HTMLImageElement?h.push(m):h.push(new Go(m.data,m.width,m.height)))}i[l.uuid]=new qh(h)}else{const h=await r(l.url);i[l.uuid]=new qh(h)}}}return i}parseTextures(e,t){function i(r,o){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),o[r])}const n={};if(e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=e[r];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=t[a.image],c=l.data;let h;Array.isArray(c)?(h=new K0,c.length===6&&(h.needsUpdate=!0)):(c&&c.data?h=new Go:h=new Pt,c&&(h.needsUpdate=!0)),h.source=l,h.uuid=a.uuid,a.name!==void 0&&(h.name=a.name),a.mapping!==void 0&&(h.mapping=i(a.mapping,qX)),a.channel!==void 0&&(h.channel=a.channel),a.offset!==void 0&&h.offset.fromArray(a.offset),a.repeat!==void 0&&h.repeat.fromArray(a.repeat),a.center!==void 0&&h.center.fromArray(a.center),a.rotation!==void 0&&(h.rotation=a.rotation),a.wrap!==void 0&&(h.wrapS=i(a.wrap[0],HL),h.wrapT=i(a.wrap[1],HL)),a.format!==void 0&&(h.format=a.format),a.internalFormat!==void 0&&(h.internalFormat=a.internalFormat),a.type!==void 0&&(h.type=a.type),a.colorSpace!==void 0&&(h.colorSpace=a.colorSpace),a.minFilter!==void 0&&(h.minFilter=i(a.minFilter,VL)),a.magFilter!==void 0&&(h.magFilter=i(a.magFilter,VL)),a.anisotropy!==void 0&&(h.anisotropy=a.anisotropy),a.flipY!==void 0&&(h.flipY=a.flipY),a.generateMipmaps!==void 0&&(h.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(h.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(h.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(h.compareFunction=a.compareFunction),a.userData!==void 0&&(h.userData=a.userData),n[a.uuid]=h}return n}parseObject(e,t,i,n,r){let o;function a(f){return t[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",f),t[f]}function l(f){if(f!==void 0){if(Array.isArray(f)){const p=[];for(let m=0,v=f.length;m<v;m++){const y=f[m];i[y]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",y),p.push(i[y])}return p}return i[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",f),i[f]}}function c(f){return n[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",f),n[f]}let h,d;switch(e.type){case"Scene":o=new Ks,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new me(e.background):o.background=c(e.background)),e.environment!==void 0&&(o.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new SC(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new wC(e.fog.color,e.fog.density)),e.fog.name!==""&&(o.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&o.backgroundRotation.fromArray(e.backgroundRotation),e.environmentRotation!==void 0&&o.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":o=new zt(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new Nl(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new GC(e.color,e.intensity);break;case"DirectionalLight":o=new Op(e.color,e.intensity);break;case"PointLight":o=new Dp(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new P4(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new t_(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new dB(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new D4().fromJSON(e);break;case"SkinnedMesh":h=a(e.geometry),d=l(e.material),o=new ga(h,d),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":h=a(e.geometry),d=l(e.material),o=new le(h,d);break;case"InstancedMesh":h=a(e.geometry),d=l(e.material);const f=e.count,p=e.instanceMatrix,m=e.instanceColor;o=new YP(h,d,f),o.instanceMatrix=new Fo(new Float32Array(p.array),16),m!==void 0&&(o.instanceColor=new Fo(new Float32Array(m.array),m.itemSize));break;case"BatchedMesh":h=a(e.geometry),d=l(e.material),o=new Xw(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,d),o.geometry=h,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map(v=>{const y=new Si;y.min.fromArray(v.boxMin),y.max.fromArray(v.boxMax);const g=new _n;return g.radius=v.sphereRadius,g.center.fromArray(v.sphereCenter),{boxInitialized:v.boxInitialized,box:y,sphereInitialized:v.sphereInitialized,sphere:g}}),o._maxGeometryCount=e.maxGeometryCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=c(e.matricesTexture.uuid);break;case"LOD":o=new XP;break;case"Line":o=new Rn(a(e.geometry),l(e.material));break;case"LineLoop":o=new KP(a(e.geometry),l(e.material));break;case"LineSegments":o=new Xr(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new Mg(a(e.geometry),l(e.material));break;case"Sprite":o=new qP(l(e.material));break;case"Group":o=new vs;break;case"Bone":o=new Pp;break;default:o=new ge}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const f=e.children;for(let p=0;p<f.length;p++)o.add(this.parseObject(f[p],t,i,n,r))}if(e.animations!==void 0){const f=e.animations;for(let p=0;p<f.length;p++){const m=f[p];o.animations.push(r[m])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const f=e.levels;for(let p=0;p<f.length;p++){const m=f[p],v=o.getObjectByProperty("uuid",m.object);v!==void 0&&o.addLevel(v,m.distance,m.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const n=t[i.skeleton];n===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(n,i.bindMatrix)}})}}const qX={UVMapping:fC,CubeReflectionMapping:uu,CubeRefractionMapping:Td,EquirectangularReflectionMapping:bo,EquirectangularRefractionMapping:Vg,CubeUVReflectionMapping:fv},HL={RepeatWrapping:wo,ClampToEdgeWrapping:ps,MirroredRepeatWrapping:du},VL={NearestFilter:ei,NearestMipmapNearestFilter:Qg,NearestMipmapLinearFilter:zh,LinearFilter:Nt,LinearMipmapNearestFilter:cp,LinearMipmapLinearFilter:go};class L4 extends Vn{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Yh.get(e);if(o!==void 0){if(r.manager.itemStart(e),o.then){o.then(c=>{t&&t(c),r.manager.itemEnd(e)}).catch(c=>{n&&n(c)});return}return setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){return Yh.add(e,c),t&&t(c),r.manager.itemEnd(e),c}).catch(function(c){n&&n(c),Yh.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});Yh.add(e,l),r.manager.itemStart(e)}}let Qb;class QC{static getContext(){return Qb===void 0&&(Qb=new(window.AudioContext||window.webkitAudioContext)),Qb}static setContext(e){Qb=e}}class Kw extends Vn{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new Hn(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const c=l.slice(0);QC.getContext().decodeAudioData(c,function(d){t(d)}).catch(a)}catch(c){a(c)}},i,n);function a(l){n?n(l):console.error(l),r.manager.itemError(e)}}}const QL=new fe,jL=new fe,gf=new fe;class XX{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new zt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new zt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,gf.copy(e.projectionMatrix);const n=t.eyeSep/2,r=n*t.near/t.focus,o=t.near*Math.tan(hp*t.fov*.5)/t.zoom;let a,l;jL.elements[12]=-n,QL.elements[12]=n,a=-o*t.aspect+r,l=o*t.aspect+r,gf.elements[0]=2*t.near/(l-a),gf.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(gf),a=-o*t.aspect-r,l=o*t.aspect-r,gf.elements[0]=2*t.near/(l-a),gf.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(gf)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(jL),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(QL)}}class i_{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=WL(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=WL();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function WL(){return(typeof performance>"u"?Date:performance).now()}const Wl=new w,qL=new xe,YX=new w,vf=new w;let k4=class extends ge{constructor(){super(),this.type="AudioListener",this.context=QC.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new i_}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Wl,qL,YX),!(!Number.isFinite(Wl.x)||!Number.isFinite(Wl.y)||!Number.isFinite(Wl.z)))if(vf.set(0,0,-1).applyQuaternion(qL),t.positionX){const n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Wl.x,n),t.positionY.linearRampToValueAtTime(Wl.y,n),t.positionZ.linearRampToValueAtTime(Wl.z,n),t.forwardX.linearRampToValueAtTime(vf.x,n),t.forwardY.linearRampToValueAtTime(vf.y,n),t.forwardZ.linearRampToValueAtTime(vf.z,n),t.upX.linearRampToValueAtTime(i.x,n),t.upY.linearRampToValueAtTime(i.y,n),t.upZ.linearRampToValueAtTime(i.z,n)}else t.setPosition(Wl.x,Wl.y,Wl.z),t.setOrientation(vf.x,vf.y,vf.z,i.x,i.y,i.z)}},pB=class extends ge{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||(this.buffer?this.buffer.duration:Number.MAX_VALUE))),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}};const yf=new w,XL=new xe,KX=new w,Af=new w;class F4 extends pB{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(yf,XL,KX),Af.set(0,0,1).applyQuaternion(XL);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(yf.x,i),t.positionY.linearRampToValueAtTime(yf.y,i),t.positionZ.linearRampToValueAtTime(yf.z,i),t.orientationX.linearRampToValueAtTime(Af.x,i),t.orientationY.linearRampToValueAtTime(Af.y,i),t.orientationZ.linearRampToValueAtTime(Af.z,i)}else t.setPosition(yf.x,yf.y,yf.z),t.setOrientation(Af.x,Af.y,Af.z)}}class JX{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class U4{constructor(e,t,i){this.binding=e,this.valueSize=i;let n,r,o;switch(t){case"quaternion":n=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:n=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,n=this.valueSize,r=e*n+n;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==n;++a)i[r+a]=i[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(i,r,0,a,n)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,n=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const l=t*this._origIndex;this._mixBufferRegion(i,n,l,1-r,t)}o>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(i[l]!==i[l+t]){a.setValue(i,n);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let r=i,o=n;r!==o;++r)t[r]=t[n+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,r){if(n>=.5)for(let o=0;o!==r;++o)e[t+o]=e[i+o]}_slerp(e,t,i,n){xe.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,r){const o=this._workIndex*r;xe.multiplyQuaternionsFlat(e,o,e,t,e,i),xe.slerpFlat(e,t,e,t,e,o,n)}_lerp(e,t,i,n,r){const o=1-n;for(let a=0;a!==r;++a){const l=t+a;e[l]=e[l]*o+e[i+a]*n}}_lerpAdditive(e,t,i,n,r){for(let o=0;o!==r;++o){const a=t+o;e[a]=e[a]+e[i+o]*n}}}const mB="\\[\\]\\.:\\/",ZX=new RegExp("["+mB+"]","g"),gB="[^"+mB+"]",$X="[^"+mB.replace("\\.","")+"]",eY=/((?:WC+[\/:])*)/.source.replace("WC",gB),tY=/(WCOD+)?/.source.replace("WCOD",$X),iY=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",gB),nY=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",gB),sY=new RegExp("^"+eY+tY+iY+nY+"$"),rY=["material","materials","bones","map"];class oY{constructor(e,t,i){const n=i||Xt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];n!==void 0&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class Xt{constructor(e,t,i){this.path=t,this.parsedPath=i||Xt.parseTrackName(t),this.node=Xt.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Xt.Composite(e,t,i):new Xt(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(ZX,"")}static parseTrackName(e){const t=sY.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const r=i.nodeName.substring(n+1);rY.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(r,o){for(let a=0;a<r.length;a++){const l=r[a];if(!o&&(l.name===t||l.uuid===t))return l;if(o&&l.userData&&l.userData.name===t)return l;const c=i(l.children,o);if(c)return c}return null},n=i(e.children);if(n)return n;{const r=i(e.children,!0);if(r)return r}}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let r=t.propertyIndex;if(e||(e=Xt.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[n];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(n==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Xt.Composite=oY;Xt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Xt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Xt.prototype.GetterByBindingType=[Xt.prototype._getValue_direct,Xt.prototype._getValue_array,Xt.prototype._getValue_arrayElement,Xt.prototype._getValue_toArray];Xt.prototype.SetterByBindingTypeAndVersioning=[[Xt.prototype._setValue_direct,Xt.prototype._setValue_direct_setNeedsUpdate,Xt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Xt.prototype._setValue_array,Xt.prototype._setValue_array_setNeedsUpdate,Xt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Xt.prototype._setValue_arrayElement,Xt.prototype._setValue_arrayElement_setNeedsUpdate,Xt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Xt.prototype._setValue_fromArray,Xt.prototype._setValue_fromArray_setNeedsUpdate,Xt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class aY{constructor(){this.isAnimationObjectGroup=!0,this.uuid=ma(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,n=arguments.length;i!==n;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,o=r.length;let a,l=e.length,c=this.nCachedObjects_;for(let h=0,d=arguments.length;h!==d;++h){const f=arguments[h],p=f.uuid;let m=t[p];if(m===void 0){m=l++,t[p]=m,e.push(f);for(let v=0,y=o;v!==y;++v)r[v].push(new Xt(f,i[v],n[v]))}else if(m<c){a=e[m];const v=--c,y=e[v];t[y.uuid]=m,e[m]=y,t[p]=v,e[v]=f;for(let g=0,_=o;g!==_;++g){const A=r[g],b=A[v];let E=A[m];A[m]=b,E===void 0&&(E=new Xt(f,i[g],n[g])),A[v]=E}}else e[m]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,h=t[c];if(h!==void 0&&h>=r){const d=r++,f=e[d];t[f.uuid]=h,e[h]=f,t[c]=d,e[d]=l;for(let p=0,m=n;p!==m;++p){const v=i[p],y=v[d],g=v[h];v[h]=y,v[d]=g}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],h=c.uuid,d=t[h];if(d!==void 0)if(delete t[h],d<r){const f=--r,p=e[f],m=--o,v=e[m];t[p.uuid]=d,e[d]=p,t[v.uuid]=f,e[f]=v,e.pop();for(let y=0,g=n;y!==g;++y){const _=i[y],A=_[f],b=_[m];_[d]=A,_[f]=b,_.pop()}}else{const f=--o,p=e[f];f>0&&(t[p.uuid]=d),e[d]=p,e.pop();for(let m=0,v=n;m!==v;++m){const y=i[m];y[d]=y[f],y.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const i=this._bindingsIndicesByPath;let n=i[e];const r=this._bindings;if(n!==void 0)return r[n];const o=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,h=this.nCachedObjects_,d=new Array(c);n=r.length,i[e]=n,o.push(e),a.push(t),r.push(d);for(let f=h,p=l.length;f!==p;++f){const m=l[f];d[f]=new Xt(m,e,t)}return d}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const n=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],c=e[a];t[c]=i,o[i]=l,o.pop(),r[i]=r[a],r.pop(),n[i]=n[a],n.pop()}}}class N4{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;const r=t.tracks,o=r.length,a=new Array(o),l={endingStart:Zf,endingEnd:Zf};for(let c=0;c!==o;++c){const h=r[c].createInterpolant(null);a[c]=h,h.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LP,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const n=this._clip.duration,r=e._clip.duration,o=r/n,a=n/r;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const n=this._mixer,r=n.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=r,l[1]=r+i,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const l=(e-r)*i;l<0||i===0?t=0:(this._startTime=null,t=i*l)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case kP:for(let h=0,d=l.length;h!==d;++h)l[h].evaluate(o),c[h].accumulateAdditive(a);break;case vC:default:for(let h=0,d=l.length;h!==d;++h)l[h].evaluate(o),c[h].accumulate(n,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let n=this.time+e,r=this._loopCount;const o=i===Ez;if(e===0)return r===-1?n:o&&(r&1)===1?t-n:n;if(i===YA){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),n>=t||n<0){const a=Math.floor(n/t);n-=t*a,r+=Math.abs(a);const l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=n;if(o&&(r&1)===1)return t-n}return n}_setEndings(e,t,i){const n=this._interpolantSettings;i?(n.endingStart=$f,n.endingEnd=$f):(e?n.endingStart=this.zeroSlopeAtStart?$f:Zf:n.endingStart=KA,t?n.endingEnd=this.zeroSlopeAtEnd?$f:Zf:n.endingEnd=KA)}_scheduleFading(e,t,i){const n=this._mixer,r=n.time;let o=this._weightInterpolant;o===null&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,l[0]=t,a[1]=r+e,l[1]=i,this}}const lY=new Float32Array(1);class jC extends Zs{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,o=e._propertyBindings,a=e._interpolants,l=i.uuid,c=this._bindingsByRootAndName;let h=c[l];h===void 0&&(h={},c[l]=h);for(let d=0;d!==r;++d){const f=n[d],p=f.name;let m=h[p];if(m!==void 0)++m.referenceCount,o[d]=m;else{if(m=o[d],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,l,p));continue}const v=t&&t._propertyBindings[d].binding.parsedPath;m=new U4(Xt.create(i,p,v),f.ValueTypeName,f.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,l,p),o[d]=m}a[d].resultBuffer=m.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,i)}const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const r=t[i];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const r=t[i];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const n=this._actions,r=this._actionsByClip;let o=r[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=n.length,n.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,a=o[r],l=a.knownActions,c=l[l.length-1],h=e._byClipCacheIndex;c._byClipCacheIndex=h,l[h]=c,l.pop(),e._byClipCacheIndex=null;const d=a.actionByRoot,f=(e._localRoot||this._root).uuid;delete d[f],l.length===0&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const r=t[i];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){const n=this._bindingsByRootAndName,r=this._bindings;let o=n[t];o===void 0&&(o={},n[t]=o),o[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,a=o[n],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[r],Object.keys(a).length===0&&delete o[n]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new lB(new Float32Array(2),new Float32Array(2),1,lY),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){const n=t||this._root,r=n.uuid;let o=typeof e=="string"?Ho.findByName(n,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(i===void 0&&(o!==null?i=o.blendMode:i=vC),l!==void 0){const d=l.actionByRoot[r];if(d!==void 0&&d.blendMode===i)return d;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const h=new N4(this,o,t,i);return this._bindAction(h,c),this._addInactiveAction(h,a,r),h}existingAction(e,t){const i=t||this._root,n=i.uuid,r=typeof e=="string"?Ho.findByName(i,e):e,o=r?r.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[n]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==i;++c)t[c]._update(n,e,r,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(r!==void 0){const o=r.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const h=c._cacheIndex,d=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=h,t[h]=d,t.pop(),this._removeInactiveBindingsForAction(c)}delete n[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const o in i){const a=i[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,r=n[t];if(r!==void 0)for(const o in r){const a=r[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class Se{constructor(e){this.value=e}clone(){return new Se(this.value.clone===void 0?this.value:this.value.clone())}}let cY=0;class hY extends Zs{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:cY++}),this.name="",this.usage=e0,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,n=t.length;i<n;i++){const r=Array.isArray(t[i])?t[i]:[t[i]];for(let o=0;o<r.length;o++)this.uniforms.push(r[o].clone())}return this}clone(){return new this.constructor().copy(this)}}class Jw extends Z0{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class uY{constructor(e,t,i,n,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const YL=new fe;let Nd=class{constructor(e,t,i=0,n=1/0){this.ray=new jo(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new Wr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return YL.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(YL),this}intersectObject(e,t=!0,i=[]){return FI(e,this,i,t),i.sort(KL),i}intersectObjects(e,t=!0,i=[]){for(let n=0,r=e.length;n<r;n++)FI(e[n],this,i,t);return i.sort(KL),i}};function KL(s,e){return s.distance-e.distance}function FI(s,e,t,i){if(s.layers.test(e.layers)&&s.raycast(e,t),i===!0){const n=s.children;for(let r=0,o=n.length;r<o;r++)FI(n[r],e,t,!0)}}class UI{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Zn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class dY{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}const JL=new Z;class fY{constructor(e=new Z(1/0,1/0),t=new Z(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=JL.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,JL).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const ZL=new w,jb=new w;class WC{constructor(e=new w,t=new w){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){ZL.subVectors(e,this.start),jb.subVectors(this.end,this.start);const i=jb.dot(jb);let r=jb.dot(ZL)/i;return t&&(r=Zn(r,0,1)),r}closestPointToPoint(e,t,i){const n=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const $L=new w;class pY extends ge{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new pt,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,h=a/l*Math.PI*2;n.push(Math.cos(c),Math.sin(c),1,Math.cos(h),Math.sin(h),1)}i.setAttribute("position",new nt(n,3));const r=new hn({fog:!1,toneMapped:!1});this.cone=new Xr(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),$L.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt($L),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Uu=new w,Wb=new fe,Y1=new fe;class mY extends Xr{constructor(e){const t=z4(e),i=new pt,n=[],r=[],o=new me(0,0,1),a=new me(0,1,0);for(let c=0;c<t.length;c++){const h=t[c];h.parent&&h.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new nt(n,3)),i.setAttribute("color",new nt(r,3));const l=new hn({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,n=i.getAttribute("position");Y1.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<t.length;r++){const a=t[r];a.parent&&a.parent.isBone&&(Wb.multiplyMatrices(Y1,a.matrixWorld),Uu.setFromMatrixPosition(Wb),n.setXYZ(o,Uu.x,Uu.y,Uu.z),Wb.multiplyMatrices(Y1,a.parent.matrixWorld),Uu.setFromMatrixPosition(Wb),n.setXYZ(o+1,Uu.x,Uu.y,Uu.z),o+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function z4(s){const e=[];s.isBone===!0&&e.push(s);for(let t=0;t<s.children.length;t++)e.push.apply(e,z4(s.children[t]));return e}class gY extends le{constructor(e,t,i){const n=new Wo(t,4,2),r=new Kt({wireframe:!0,fog:!1,toneMapped:!1});super(n,r),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const vY=new w,ek=new me,tk=new me;class yY extends ge{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const n=new Xh(t);n.rotateY(Math.PI*.5),this.material=new Kt({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=n.getAttribute("position"),o=new Float32Array(r.count*3);n.setAttribute("color",new ot(o,3)),this.add(new le(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");ek.copy(this.light.color),tk.copy(this.light.groundColor);for(let i=0,n=t.count;i<n;i++){const r=i<n/2?ek:tk;t.setXYZ(i,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(vY.setFromMatrixPosition(this.light.matrixWorld).negate())}}let Av=class extends Xr{constructor(e=10,t=10,i=4473924,n=8947848){i=new me(i),n=new me(n);const r=t/2,o=e/t,a=e/2,l=[],c=[];for(let f=0,p=0,m=-a;f<=t;f++,m+=o){l.push(-a,0,m,a,0,m),l.push(m,0,-a,m,0,a);const v=f===r?i:n;v.toArray(c,p),p+=3,v.toArray(c,p),p+=3,v.toArray(c,p),p+=3,v.toArray(c,p),p+=3}const h=new pt;h.setAttribute("position",new nt(l,3)),h.setAttribute("color",new nt(c,3));const d=new hn({vertexColors:!0,toneMapped:!1});super(h,d),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}};class AY extends Xr{constructor(e=10,t=16,i=8,n=64,r=4473924,o=8947848){r=new me(r),o=new me(o);const a=[],l=[];if(t>1)for(let d=0;d<t;d++){const f=d/t*(Math.PI*2),p=Math.sin(f)*e,m=Math.cos(f)*e;a.push(0,0,0),a.push(p,0,m);const v=d&1?r:o;l.push(v.r,v.g,v.b),l.push(v.r,v.g,v.b)}for(let d=0;d<i;d++){const f=d&1?r:o,p=e-e/i*d;for(let m=0;m<n;m++){let v=m/n*(Math.PI*2),y=Math.sin(v)*p,g=Math.cos(v)*p;a.push(y,0,g),l.push(f.r,f.g,f.b),v=(m+1)/n*(Math.PI*2),y=Math.sin(v)*p,g=Math.cos(v)*p,a.push(y,0,g),l.push(f.r,f.g,f.b)}}const c=new pt;c.setAttribute("position",new nt(a,3)),c.setAttribute("color",new nt(l,3));const h=new hn({vertexColors:!0,toneMapped:!1});super(c,h),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const ik=new w,qb=new w,nk=new w;class G4 extends ge{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let n=new pt;n.setAttribute("position",new nt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new hn({fog:!1,toneMapped:!1});this.lightPlane=new Rn(n,r),this.add(this.lightPlane),n=new pt,n.setAttribute("position",new nt([0,0,0,0,0,1],3)),this.targetLine=new Rn(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),ik.setFromMatrixPosition(this.light.matrixWorld),qb.setFromMatrixPosition(this.light.target.matrixWorld),nk.subVectors(qb,ik),this.lightPlane.lookAt(qb),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(qb),this.targetLine.scale.z=nk.length()}}const Xb=new w,Xn=new Y0;class H4 extends Xr{constructor(e){const t=new pt,i=new hn({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(m,v){l(m),l(v)}function l(m){n.push(0,0,0),r.push(0,0,0),o[m]===void 0&&(o[m]=[]),o[m].push(n.length/3-1)}t.setAttribute("position",new nt(n,3)),t.setAttribute("color",new nt(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new me(16755200),h=new me(16711680),d=new me(43775),f=new me(16777215),p=new me(3355443);this.setColors(c,h,d,f,p)}setColors(e,t,i,n,r){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,n.r,n.g,n.b),a.setXYZ(39,n.r,n.g,n.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,i=1,n=1;Xn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),$n("c",t,e,Xn,0,0,-1),$n("t",t,e,Xn,0,0,1),$n("n1",t,e,Xn,-i,-n,-1),$n("n2",t,e,Xn,i,-n,-1),$n("n3",t,e,Xn,-i,n,-1),$n("n4",t,e,Xn,i,n,-1),$n("f1",t,e,Xn,-i,-n,1),$n("f2",t,e,Xn,i,-n,1),$n("f3",t,e,Xn,-i,n,1),$n("f4",t,e,Xn,i,n,1),$n("u1",t,e,Xn,i*.7,n*1.1,-1),$n("u2",t,e,Xn,-i*.7,n*1.1,-1),$n("u3",t,e,Xn,0,n*2,-1),$n("cf1",t,e,Xn,-i,0,1),$n("cf2",t,e,Xn,i,0,1),$n("cf3",t,e,Xn,0,-n,1),$n("cf4",t,e,Xn,0,n,1),$n("cn1",t,e,Xn,-i,0,-1),$n("cn2",t,e,Xn,i,0,-1),$n("cn3",t,e,Xn,0,-n,-1),$n("cn4",t,e,Xn,0,n,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function $n(s,e,t,i,n,r,o){Xb.set(n,r,o).unproject(i);const a=e[s];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],Xb.x,Xb.y,Xb.z)}}const Yb=new Si;class vB extends Xr{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(8*3),r=new pt;r.setIndex(new ot(i,1)),r.setAttribute("position",new ot(n,3)),super(r,new hn({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Yb.setFromObject(this.object),Yb.isEmpty())return;const t=Yb.min,i=Yb.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=t.x,r[4]=i.y,r[5]=i.z,r[6]=t.x,r[7]=t.y,r[8]=i.z,r[9]=i.x,r[10]=t.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=t.z,r[15]=t.x,r[16]=i.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=i.x,r[22]=t.y,r[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class yB extends Xr{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new pt;r.setIndex(new ot(i,1)),r.setAttribute("position",new nt(n,3)),super(r,new hn({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class _Y extends Rn{constructor(e,t=1,i=16776960){const n=i,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new pt;o.setAttribute("position",new nt(r,3)),o.computeBoundingSphere(),super(o,new hn({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new pt;l.setAttribute("position",new nt(a,3)),l.computeBoundingSphere(),this.add(new le(l,new Kt({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const sk=new w;let Kb,K1;class bY extends ge{constructor(e=new w(0,0,1),t=new w(0,0,0),i=1,n=16776960,r=i*.2,o=r*.2){super(),this.type="ArrowHelper",Kb===void 0&&(Kb=new pt,Kb.setAttribute("position",new nt([0,0,0,0,1,0],3)),K1=new ts(0,.5,1,5,1),K1.translate(0,-.5,0)),this.position.copy(t),this.line=new Rn(Kb,new hn({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new le(K1,new Kt({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{sk.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(sk,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}let xo=class extends Xr{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new pt;n.setAttribute("position",new nt(t,3)),n.setAttribute("color",new nt(i,3));const r=new hn({vertexColors:!0,toneMapped:!1});super(n,r),this.type="AxesHelper"}setColors(e,t,i){const n=new me,r=this.geometry.attributes.color.array;return n.set(e),n.toArray(r,0),n.toArray(r,3),n.set(t),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};class V4{constructor(){this.type="ShapePath",this.color=new me,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new n0,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,n){return this.currentPath.quadraticCurveTo(e,t,i,n),this}bezierCurveTo(e,t,i,n,r,o){return this.currentPath.bezierCurveTo(e,t,i,n,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(g){const _=[];for(let A=0,b=g.length;A<b;A++){const E=g[A],C=new gd;C.curves=E.curves,_.push(C)}return _}function i(g,_){const A=_.length;let b=!1;for(let E=A-1,C=0;C<A;E=C++){let T=_[E],M=_[C],R=M.x-T.x,S=M.y-T.y;if(Math.abs(S)>Number.EPSILON){if(S<0&&(T=_[C],R=-R,M=_[E],S=-S),g.y<T.y||g.y>M.y)continue;if(g.y===T.y){if(g.x===T.x)return!0}else{const I=S*(g.x-T.x)-R*(g.y-T.y);if(I===0)return!0;if(I<0)continue;b=!b}}else{if(g.y!==T.y)continue;if(M.x<=g.x&&g.x<=T.x||T.x<=g.x&&g.x<=M.x)return!0}}return b}const n=Rl.isClockWise,r=this.subPaths;if(r.length===0)return[];let o,a,l;const c=[];if(r.length===1)return a=r[0],l=new gd,l.curves=a.curves,c.push(l),c;let h=!n(r[0].getPoints());h=e?!h:h;const d=[],f=[];let p=[],m=0,v;f[m]=void 0,p[m]=[];for(let g=0,_=r.length;g<_;g++)a=r[g],v=a.getPoints(),o=n(v),o=e?!o:o,o?(!h&&f[m]&&m++,f[m]={s:new gd,p:v},f[m].s.curves=a.curves,h&&m++,p[m]=[]):p[m].push({h:a,p:v[0]});if(!f[0])return t(r);if(f.length>1){let g=!1,_=0;for(let A=0,b=f.length;A<b;A++)d[A]=[];for(let A=0,b=f.length;A<b;A++){const E=p[A];for(let C=0;C<E.length;C++){const T=E[C];let M=!0;for(let R=0;R<f.length;R++)i(T.p,f[R].p)&&(A!==R&&_++,M?(M=!1,d[R].push(T)):g=!0);M&&d[A].push(T)}}_>0&&g===!1&&(p=d)}let y;for(let g=0,_=f.length;g<_;g++){l=f[g].s,c.push(l),y=p[g];for(let A=0,b=y.length;A<b;A++)l.holes.push(y[A].h)}return c}}class xY extends Yt{constructor(e=1,t=1,i=1,n={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,t,{...n,count:i}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Wc}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported. Existing: "+window.__THREE__+", new: "+Wc):window.__THREE__=Wc);const AB=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:q0,AddEquation:sd,AddOperation:vz,AdditiveAnimationBlendMode:kP,AdditiveBlending:Ed,AgXToneMapping:dv,AlphaFormat:wz,AlwaysCompare:Yz,AlwaysDepth:hC,AlwaysStencilFunc:Qw,AmbientLight:GC,AnimationAction:N4,AnimationClip:Ho,AnimationLoader:zX,AnimationMixer:jC,AnimationObjectGroup:aY,AnimationUtils:kX,ArcCurve:m4,ArrayCamera:WP,ArrowHelper:bY,AttachedBindMode:lI,Audio:pB,AudioAnalyser:JX,AudioContext:QC,AudioListener:k4,AudioLoader:Kw,AxesHelper:xo,BackSide:Gn,BasicDepthPacking:Sr,BasicShadowMap:m6,BatchedMesh:Xw,Bone:Pp,BooleanKeyframeTrack:Hp,Box2:fY,Box3:Si,Box3Helper:yB,BoxGeometry:Xi,BoxHelper:vB,BufferAttribute:ot,BufferGeometry:pt,BufferGeometryLoader:O4,ByteType:bz,Cache:Yh,Camera:Y0,CameraHelper:H4,CanvasTexture:JP,CapsuleGeometry:TC,CatmullRomCurve3:g4,CineonToneMapping:yz,CircleGeometry:MC,ClampToEdgeWrapping:ps,Clock:i_,Color:me,ColorKeyframeTrack:cB,ColorManagement:ki,CompressedArrayTexture:f4,CompressedCubeTexture:p4,CompressedTexture:Oc,CompressedTextureLoader:GX,ConeGeometry:IC,ConstantAlphaFactor:pz,ConstantColorFactor:dz,CubeCamera:HP,CubeReflectionMapping:uu,CubeRefractionMapping:Td,CubeTexture:K0,CubeTextureLoader:HX,CubeUVReflectionMapping:fv,CubicBezierCurve:$P,CubicBezierCurve3:v4,CubicInterpolant:M4,CullFaceBack:sI,CullFaceFront:ez,CullFaceFrontBack:p6,CullFaceNone:$N,Curve:el,CurvePath:A4,CustomBlending:TP,CustomToneMapping:Az,CylinderGeometry:ts,Cylindrical:dY,Data3DTexture:_C,DataArrayTexture:AC,DataTexture:Go,DataTextureLoader:uB,DataUtils:ep,DecrementStencilOp:Dz,DecrementWrapStencilOp:Lz,DefaultLoadingManager:hB,DepthFormat:md,DepthStencilFormat:Md,DepthTexture:mv,DetachedBindMode:_z,DirectionalLight:Op,DirectionalLightHelper:G4,DiscreteInterpolant:I4,DisplayP3ColorSpace:X0,DodecahedronGeometry:RC,DoubleSide:Pi,DstAlphaFactor:az,DstColorFactor:cz,DynamicCopyUsage:C6,DynamicDrawUsage:Hr,DynamicReadUsage:x6,EdgesGeometry:sB,EllipseCurve:EC,EqualCompare:jz,EqualDepth:Hg,EqualStencilFunc:Uz,EquirectangularReflectionMapping:bo,EquirectangularRefractionMapping:Vg,Euler:oi,EventDispatcher:Zs,ExtrudeGeometry:vv,FileLoader:Hn,Float16BufferAttribute:cj,Float32BufferAttribute:nt,FloatType:vn,Fog:SC,FogExp2:wC,FramebufferTexture:oX,FrontSide:As,Frustum:Rp,GLBufferAttribute:uY,GLSL1:T6,GLSL3:jw,GreaterCompare:Wz,GreaterDepth:dC,GreaterEqualCompare:Xz,GreaterEqualDepth:uC,GreaterEqualStencilFunc:Hz,GreaterStencilFunc:zz,GridHelper:Av,Group:vs,HalfFloatType:$i,HemisphereLight:dB,HemisphereLightHelper:yY,IcosahedronGeometry:BC,ImageBitmapLoader:L4,ImageLoader:a0,ImageUtils:zP,IncrementStencilOp:Bz,IncrementWrapStencilOp:Oz,InstancedBufferAttribute:Fo,InstancedBufferGeometry:VC,InstancedInterleavedBuffer:Jw,InstancedMesh:YP,Int16BufferAttribute:aj,Int32BufferAttribute:lj,Int8BufferAttribute:sj,IntType:IP,InterleavedBuffer:Z0,InterleavedBufferAttribute:vo,Interpolant:yv,InterpolateDiscrete:Ip,InterpolateLinear:Id,InterpolateSmooth:aw,InvertStencilOp:kz,KeepStencilOp:$u,KeyframeTrack:zl,LOD:XP,LatheGeometry:$0,Layers:Wr,LessCompare:Qz,LessDepth:qA,LessEqualCompare:UP,LessEqualDepth:Tp,LessEqualStencilFunc:Nz,LessStencilFunc:Fz,Light:Ud,LightProbe:D4,Line:Rn,Line3:WC,LineBasicMaterial:hn,LineCurve:eB,LineCurve3:y4,LineDashedMaterial:C4,LineLoop:KP,LineSegments:Xr,LinearDisplayP3ColorSpace:pv,LinearEncoding:Mz,LinearFilter:Nt,LinearInterpolant:lB,LinearMipMapLinearFilter:A6,LinearMipMapNearestFilter:y6,LinearMipmapLinearFilter:go,LinearMipmapNearestFilter:cp,LinearSRGBColorSpace:Ui,LinearToneMapping:uv,LinearTransfer:JA,Loader:Vn,LoaderUtils:Lc,LoadingManager:zC,LoopOnce:YA,LoopPingPong:Ez,LoopRepeat:LP,LuminanceAlphaFormat:Sz,LuminanceFormat:mC,MOUSE:Lf,Material:Vt,MaterialLoader:HC,MathUtils:li,Matrix3:Ht,Matrix4:fe,MaxEquation:Lw,Mesh:le,MeshBasicMaterial:Kt,MeshDepthMaterial:J0,MeshDistanceMaterial:jP,MeshLambertMaterial:oB,MeshMatcapMaterial:S4,MeshNormalMaterial:NC,MeshPhongMaterial:up,MeshPhysicalMaterial:Qo,MeshStandardMaterial:ms,MeshToonMaterial:w4,MinEquation:aI,MirroredRepeatWrapping:du,MixOperation:gz,MultiplyBlending:oI,MultiplyOperation:j0,NearestFilter:ei,NearestMipMapLinearFilter:v6,NearestMipMapNearestFilter:g6,NearestMipmapLinearFilter:zh,NearestMipmapNearestFilter:Qg,NeutralToneMapping:Mp,NeverCompare:Vz,NeverDepth:MP,NeverStencilFunc:II,NoBlending:An,NoColorSpace:jr,NoToneMapping:_o,NormalAnimationBlendMode:vC,NormalBlending:pd,NotEqualCompare:qz,NotEqualDepth:Q0,NotEqualStencilFunc:Gz,NumberKeyframeTrack:Rd,Object3D:ge,ObjectLoader:WX,ObjectSpaceNormalMap:Iz,OctahedronGeometry:Xh,OneFactor:sz,OneMinusConstantAlphaFactor:mz,OneMinusConstantColorFactor:fz,OneMinusDstAlphaFactor:lz,OneMinusDstColorFactor:hz,OneMinusSrcAlphaFactor:Fw,OneMinusSrcColorFactor:oz,OrthographicCamera:Nl,P3Primaries:$A,PCFShadowMap:CP,PCFSoftShadowMap:EP,PMREMGenerator:PI,Path:n0,PerspectiveCamera:zt,Plane:Ar,PlaneGeometry:_s,PlaneHelper:_Y,PointLight:Dp,PointLightHelper:gY,Points:Mg,PointsMaterial:cd,PolarGridHelper:AY,PolyhedronGeometry:Fd,PositionalAudio:F4,PropertyBinding:Xt,PropertyMixer:U4,QuadraticBezierCurve:tB,QuadraticBezierCurve3:iB,Quaternion:xe,QuaternionKeyframeTrack:qc,QuaternionLinearInterpolant:R4,RED_GREEN_RGTC2_Format:EI,RED_RGTC1_Format:Cz,REVISION:Wc,RGBADepthPacking:yC,RGBAFormat:Ti,RGBAIntegerFormat:OP,RGBA_ASTC_10x10_Format:_I,RGBA_ASTC_10x5_Format:vI,RGBA_ASTC_10x6_Format:yI,RGBA_ASTC_10x8_Format:AI,RGBA_ASTC_12x10_Format:bI,RGBA_ASTC_12x12_Format:xI,RGBA_ASTC_4x4_Format:Hw,RGBA_ASTC_5x4_Format:uI,RGBA_ASTC_5x5_Format:dI,RGBA_ASTC_6x5_Format:fI,RGBA_ASTC_6x6_Format:XA,RGBA_ASTC_8x5_Format:pI,RGBA_ASTC_8x6_Format:mI,RGBA_ASTC_8x8_Format:gI,RGBA_BPTC_Format:sA,RGBA_ETC2_EAC_Format:Gw,RGBA_PVRTC_2BPPV1_Format:hI,RGBA_PVRTC_4BPPV1_Format:Nw,RGBA_S3TC_DXT1_Format:rw,RGBA_S3TC_DXT3_Format:ow,RGBA_S3TC_DXT5_Format:nA,RGB_BPTC_SIGNED_Format:wI,RGB_BPTC_UNSIGNED_Format:SI,RGB_ETC1_Format:gC,RGB_ETC2_Format:zw,RGB_PVRTC_2BPPV1_Format:cI,RGB_PVRTC_4BPPV1_Format:Uw,RGB_S3TC_DXT1_Format:iA,RGFormat:ld,RGIntegerFormat:DP,RawShaderMaterial:UC,Ray:jo,Raycaster:Nd,Rec709Primaries:ZA,RectAreaLight:P4,RedFormat:Tl,RedIntegerFormat:BP,ReinhardToneMapping:W0,RenderTarget:$z,RepeatWrapping:wo,ReplaceStencilOp:Pz,ReverseSubtractEquation:iz,RingGeometry:e_,SIGNED_RED_GREEN_RGTC2_Format:TI,SIGNED_RED_RGTC1_Format:CI,SRGBColorSpace:_t,SRGBTransfer:on,Scene:Ks,ShaderChunk:Dt,ShaderLib:_r,ShaderMaterial:Rt,ShadowMaterial:FC,Shape:gd,ShapeGeometry:DC,ShapePath:V4,ShapeUtils:Rl,ShortType:xz,Skeleton:Gp,SkeletonHelper:mY,SkinnedMesh:ga,Source:qh,Sphere:_n,SphereGeometry:Wo,Spherical:UI,SphericalHarmonics3:B4,SplineCurve:nB,SpotLight:t_,SpotLightHelper:pY,Sprite:qP,SpriteMaterial:CC,SrcAlphaFactor:kw,SrcAlphaSaturateFactor:uz,SrcColorFactor:rz,StaticCopyUsage:S6,StaticDrawUsage:e0,StaticReadUsage:b6,StereoCamera:XX,StreamCopyUsage:E6,StreamDrawUsage:_6,StreamReadUsage:w6,StringKeyframeTrack:Vp,SubtractEquation:tz,SubtractiveBlending:rI,TOUCH:kf,TangentSpaceNormalMap:kd,TetrahedronGeometry:OC,Texture:Pt,TextureLoader:Xa,TorusGeometry:Hh,TorusKnotGeometry:LC,Triangle:mo,TriangleFanDrawMode:Vw,TriangleStripDrawMode:FP,TrianglesDrawMode:Tz,TubeGeometry:kC,UVMapping:fC,Uint16BufferAttribute:bC,Uint32BufferAttribute:GP,Uint8BufferAttribute:rj,Uint8ClampedBufferAttribute:oj,Uniform:Se,UniformsGroup:hY,UniformsLib:ze,UniformsUtils:fu,UnsignedByteType:Ri,UnsignedInt248Type:tu,UnsignedIntType:El,UnsignedShort4444Type:RP,UnsignedShort5551Type:PP,UnsignedShortType:pC,VSMShadowMap:sc,Vector2:Z,Vector3:w,Vector4:Je,VectorKeyframeTrack:pu,VideoTexture:d4,WebGL1Renderer:c4,WebGL3DRenderTarget:q6,WebGLArrayRenderTarget:W6,WebGLCoordinateSystem:Cc,WebGLCubeRenderTarget:VP,WebGLMultipleRenderTargets:xY,WebGLRenderTarget:Yt,WebGLRenderer:eh,WebGLUtils:l4,WebGPUCoordinateSystem:t0,WireframeGeometry:rB,WrapAroundEnding:KA,ZeroCurvatureEnding:Zf,ZeroFactor:nz,ZeroSlopeEnding:$f,ZeroStencilOp:Rz,_SRGBAFormat:Ww,createCanvasElement:Jz,sRGBEncoding:MI},Symbol.toStringTag,{value:"Module"}));let Q4,rk=null;function Fl(){return Q4}function _B(s){if(s==null){console.warn("Oh no: someone tried registering a non-existend gltf-loader. When you see this log it might mean that needle-engine is being imported multiple times. Please check your project setup.");return}rk!==s&&(rk=s,Q4=new s)}const J1=new Map;function So(s=(e=>(e=globalThis.location)==null?void 0:e.hostname)()){if(J1.has(s))return J1.get(s);const t=/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|localhost/.test(s);return J1.set(s,t),t===!0}function j4(){return window.location.hostname.includes("glitch.me")}var yi;(function(s){s.ContextRegistered="ContextRegistered",s.ContextCreationStart="ContextCreationStart",s.ContextCreated="ContextCreated",s.ContextFirstFrameRendered="ContextFirstFrameRendered",s.ContextDestroying="ContextDestroying",s.ContextDestroyed="ContextDestroyed",s.MissingCamera="MissingCamera",s.ContextClearing="ContextClearing",s.ContextCleared="ContextCleared"})(yi||(yi={}));class xi{static get Current(){return globalThis["NeedleEngine.Context.Current"]}static set Current(e){globalThis["NeedleEngine.Context.Current"]=e}static get All(){return this.Registered}static register(e){this.Registered.push(e),this.dispatchCallback(yi.ContextRegistered,e)}static unregister(e){const t=this.Registered.indexOf(e);t!==-1&&this.Registered.splice(t,1)}static registerCallback(e,t){this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t)}static unregisterCallback(e,t){if(!this._callbacks[e])return;const i=this._callbacks[e].indexOf(t);i!==-1&&this._callbacks[e].splice(i,1)}static dispatchCallback(e,t,i){if(!this._callbacks[e])return!0;const n={event:e,context:t};if(i)for(const o in i)n[o]=i[o];const r=new Array;return this._callbacks[e].forEach(o=>{const a=o(n);a instanceof Promise&&r.push(a)}),Promise.all(r)}static addContextCreatedCallback(e){this.registerCallback(yi.ContextCreated,e)}static addContextDestroyedCallback(e){this.registerCallback(yi.ContextDestroyed,e)}}u(xi,"Registered",[]),u(xi,"_callbacks",{});const W4=()=>s=>s;function wY(s){return W4()(s)}function SY(){return!!ie("debug")}class _a{constructor(e,t){u(this,"_factory");u(this,"_cache",[]);u(this,"_maxSize");u(this,"_index",0);this._factory=e,this._maxSize=t}get(){const e=this._index%this._maxSize;return this._index++,this._cache.length<=e&&(this._cache[e]=this._factory()),this._cache[e]}}let Gf=!1;const NI=new Array;typeof window<"u"&&setTimeout(()=>{if(Gf){const s={},e=new URL(window.location.href),t=new URL(e);t.searchParams.append("console","");const i=t.toString().replace(/=$|=(?=&)/g,"");for(const r of NI){const o=new URL(e);o.searchParams.append(r,""),s[r]=o.toString().replace(/=$|=(?=&)/g,"")}console.log(`🌵 ?help: Debug Options for Needle Engine.
Append any of these parameters to the URL to enable specific debug options.
Example: ${i} will show an onscreen console window.`);const n=Gf===!0?"":` (containing "${Gf}")`;console.group("Available URL parameters:"+n);for(const r of Object.keys(s).sort())typeof Gf=="string"&&!r.toLowerCase().includes(Gf.toLowerCase())||(console.groupCollapsed(r),console.log("Reload with this flag enabled:"),console.log(s[r]),console.groupEnd());console.groupEnd()}},100);function n_(){var s;return new URLSearchParams((s=globalThis.location)==null?void 0:s.search)}function ie(s){Gf&&!NI.includes(s)&&NI.push(s);const e=n_();if(e.has(s)){const t=e.get(s);if(t){const i=Number(t);return isNaN(i)?t:i}else return!0}return!1}Gf=ie("help");function CY(s,e){const t=n_();t.has(s)?t.set(s,e):t.append(s,e),document.location.search=t.toString()}function Zw(s,e,t=!0){const i=n_();i.has(s)?e===null?i.delete(s):i.set(s,e):e!==null&&i.append(s,e),t?q4(s,i):bB(s,i)}function zI(s,e,t){s.has(e)?s.set(e,t.toString()):s.append(e,t.toString())}function q4(s,e,t){window.history.pushState(t,s,"?"+e.toString())}function bB(s,e,t){window.history.replaceState(t,s,"?"+e.toString())}function EY(s){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=t.length,n=0;n<s;n++)e+=t.charAt(Math.floor(Math.random()*i));return e}function TY(s,e){return Math.floor(Math.random()*(e-s+1))+s}const ok=["smol","tiny","giant","interesting","smart","bright","dull","extreme","beautiful","pretty","dark","epic","salty","silly","funny","lame","lazy","loud","lucky","mad","mean","mighty","mysterious","nasty","odd","old","powerful","quiet","rapid","scary","shiny","shy","silly","smooth","sour","spicy","stupid","sweet","tasty","terrible","ugly","unusual","vast","wet","wild","witty","wrong","zany","zealous","zippy","zombie","zorro"],ak=["cat","dog","mouse","pig","cow","horse","sheep","chicken","duck","goat","panda","tiger","lion","elephant","monkey","bird","fish","snake","frog","turtle","hamster","penguin","kangaroo","whale","dolphin","crocodile","snail","ant","bee","beetle","butterfly","dragon","eagle","fish","giraffe","lizard","panda","penguin","rabbit","snake","spider","tiger","zebra"];function X4(){const s=ok[Math.floor(Math.random()*ok.length)],e=ak[Math.floor(Math.random()*ak.length)];return s+"_"+e}function Y4(s){return s=s.replace(/[^a-z0-9áéíóúñü \.,_-]/gim,""),s.trim()}function qg(s,e,t=!0,i=!1){var n;if(e==null)return null;if(e.userData&&e.userData.guid===s)return e;if(e.guid==s)return e;if(i&&(n=e.userData)!=null&&n.components){for(const r of e.userData.components)if(r.guid===s)return r}if(t){if(e.scenes)for(const r in e.scenes){const o=e.scenes[r],a=qg(s,o,t,i);if(a)return a}if(e.children)for(const r in e.children){const o=e.children[r],a=qg(s,o,t,i);if(a)return a}}}function s_(s,e){if(s!=null&&typeof s=="object"){let t;Array.isArray(s)?t=[]:(t=Object.create(s),Object.assign(t,s));for(const i of Object.keys(s)){const n=s[i];e&&!e(s,i,n)?t[i]=n:(n==null?void 0:n.clone)!==void 0&&typeof n.clone=="function"?t[i]=n.clone():t[i]=s_(n,e)}return t}return s}function Xc(s){return new Promise((e,t)=>{setTimeout(e,s)})}function qC(s,e){if(s<=0)return Promise.resolve();if(e||(e=xi.Current),!e)return Promise.reject("No context");const t=e.time.frameCount+s;return new Promise((i,n)=>{if(!e)return n("No context");const r=()=>{e.time.frameCount>=t&&(e.pre_update_callbacks.splice(e.pre_update_callbacks.indexOf(r),1),i())};e.pre_update_callbacks.push(r)})}const Jb=ie("debugresolveurl"),K4="rel:";function MY(s,e){return zd(s,e)}function zd(s,e){if(e===void 0)return Jb&&console.warn("getPath: uri is undefined, returning uri",e),e;if(e.startsWith("./"))return e;if(e.startsWith("http"))return Jb&&console.warn("getPath: uri is absolute, returning uri",e),e;if(s===void 0)return Jb&&console.warn("getPath: source is undefined, returning uri",e),e;e.startsWith(K4)&&(e=e.substring(4));const t=s.lastIndexOf("/");if(t>=0){const i=s.substring(0,t+1);for(;i.endsWith("/")&&e.startsWith("/");)e=e.substring(1);const n=i+e;return Jb&&console.log("source:",s,`changed uri 
from`,e,`
to `,n,`
basePath: `+i),n}return e}class IY{constructor(e,t){u(this,"writeCallbacks",[]);u(this,"_applied",!1);u(this,"_object");u(this,"_prop");u(this,"_wrapperProp");this._object=e,this._prop=t,this._wrapperProp=Symbol("$"+t),this.apply()}subscribeWrite(e){this.writeCallbacks.push(e)}unsubscribeWrite(e){const t=this.writeCallbacks.indexOf(e);t!==-1&&this.writeCallbacks.splice(t,1)}apply(){if(this._applied||!this._object)return;const e=this._object,t=this._prop;if(e[t]===void 0)return;this._applied=!0,e[this._wrapperProp]!==void 0&&console.warn("Watcher is being applied to an object that already has a wrapper property. This is not (yet) supported");const i=e[t];e[this._wrapperProp]=i,Object.defineProperty(e,t,{get:()=>e[this._wrapperProp],set:o=>{e[this._wrapperProp]=o;for(const a of this.writeCallbacks)a(o,this._prop)}})}revoke(){if(!this._applied||!this._object)return;this._applied=!1;const e=this._object,t=this._prop;Reflect.deleteProperty(e,t);const i=e[this._wrapperProp];e[t]=i,Reflect.deleteProperty(e,this._wrapperProp)}dispose(){this.revoke(),this.writeCallbacks.length=0,this._object=null}}class iu{constructor(e,t){u(this,"_watches",[]);if(Array.isArray(t))for(const i of t)this._watches.push(new iu(e,i));else this._watches.push(new IY(e,t))}subscribeWrite(e){for(const t of this._watches)t.subscribeWrite(e)}unsubscribeWrite(e){for(const t of this._watches)t.unsubscribeWrite(e)}apply(){for(const e of this._watches)e.apply()}revoke(){for(const e of this._watches)e.revoke()}dispose(){for(const e of this._watches)e.dispose();this._watches.length=0}}const Km=Symbol("needle:watches");function XC(s,e){if(!s[Km])if(s instanceof Z)s[Km]=new iu(s,["x","y"]);else if(s instanceof w)s[Km]=new iu(s,["x","y","z"]);else if(s instanceof Je||s instanceof xe)s[Km]=new iu(s,["x","y","z","w"]);else return!1;return s[Km].subscribeWrite(e),!0}function xB(s,e){if(!s)return;const t=s[Km];t&&t.unsubscribeWrite(e)}var St;(function(s){let e;function t(){if(e!==void 0)return e;const L=window.navigator.userAgent,U=/Windows|MacOS|Mac OS/.test(L),D=/Windows NT/.test(L)&&/Edg/.test(L)&&!/Win64/.test(L);return e=U&&!D&&!y()}s.isDesktop=t;let i;function n(){return i!==void 0?i:typeof window.orientation<"u"||navigator.userAgent.indexOf("IEMobile")!==-1?i=!0:i=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent)}s.isMobileDevice=n;function r(){return a()}s.isIPad=r;let o;function a(){return o!==void 0?o:o=/iPad/.test(navigator.userAgent)}s.isiPad=a;let l;function c(){return l!==void 0?l:l=/Android/.test(navigator.userAgent)}s.isAndroidDevice=c;let h;function d(){return h!==void 0?h:h=/WebXRViewer\//i.test(navigator.userAgent)}s.isMozillaXR=d;let f;function p(){if(f!==void 0)return f;if(navigator.userAgentData)return f=navigator.userAgentData.platform==="macOS";{const L=navigator.userAgent.toLowerCase();return f=L.includes("mac os x")||L.includes("macintosh")}}s.isMacOS=p;let m;const v=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];function y(){return m!==void 0?m:m=v.includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}s.isiOS=y;let g;function _(){return g!==void 0||(g=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),g}s.isSafari=_;let A;function b(){return A!==void 0?A:A=navigator.userAgent.includes("OculusBrowser")}s.isQuest=b;let E;function C(){return E!==void 0||(E=document.createElement("a").relList.supports("ar")),E}s.supportsQuickLookAR=C;async function T(){try{return(await navigator.permissions.query({name:"microphone"})).state!=="denied"}catch(L){return console.error("Error querying `microphone` permissions.",L),!1}}s.microphonePermissionsGranted=T;let M;function R(){if(M!==void 0)return M;const L=navigator.userAgent.match(/iPhone OS (\d+_\d+)/);if(L&&(M=L[1].replace("_",".")),!M){const U=navigator.userAgent.match(/(?:\(Macintosh;|iPhone;|iPad;).*Version\/(\d+\.\d+)/);U&&(M=U[1])}return M||(M=null),M}s.getiOSVersion=R;let S;function I(){if(S!==void 0)return S;const L=navigator.userAgent.match(/(?:CriOS|Chrome)\/(\d+\.\d+\.\d+\.\d+)/);return L?S=L[1].replace("_","."):S=null,S}s.getChromeVersion=I})(St||(St={}));function RY(){return St.isDesktop()}function PY(){return St.isMobileDevice()}function BY(){return St.isiPad()}function DY(){return St.isiPad()}function OY(){return St.isAndroidDevice()}function LY(){return St.isMozillaXR()}function kY(){return St.isMacOS()}function FY(){return St.isiOS()}function UY(){return St.isSafari()}function NY(){return St.isQuest()}async function zY(){return St.microphonePermissionsGranted()}const GY=/ip=(?<ip>.+?)\n/s;async function HY(){const e=await(await fetch("https://www.cloudflare.com/cdn-cgi/trace")).text(),t=GY.exec(e);return t?t[1]:null}async function VY(){const s=await fetch("https://api.db-ip.com/v2/free/self").catch(()=>null);return s?(await s.json()).ipAddress:void 0}async function QY(){const s=await fetch("https://api.db-ip.com/v2/free/self").catch(()=>null);return s?await s.json():void 0}const hd=new WeakMap;function J4(s,e,t){if(!hd.get(s)){const n=new MutationObserver(r=>{jY(s,r)});hd.set(s,{observer:n,attributeChangedListeners:new Map}),n.observe(s,{attributes:!0})}const i=hd.get(s).attributeChangedListeners;i.has(e)||i.set(e,[]),i.get(e).push(t)}function Z4(s,e,t){if(!hd.get(s))return;const i=hd.get(s).attributeChangedListeners;if(!i.has(e))return;const n=i.get(e),r=n.indexOf(t);if(r!==-1&&(n.splice(r,1),n.length<=0)){i.delete(e);const o=hd.get(s);o==null||o.observer.disconnect(),hd.delete(s)}}function jY(s,e){const t=hd.get(s).attributeChangedListeners;for(const i of e)if(i.type==="attributes"){const n=i.attributeName,r=s.getAttribute(n);if(t.has(n))for(const o of t.get(n))o(r)}}class GI{constructor(e){u(this,"reason");this.reason=e}}async function YC(s){const e=await Promise.allSettled(s).catch(n=>[new GI(n.message)]);let t=!1;const i=e.map(n=>"value"in n?n.value:(t=!0,new GI(n.reason)));return{anyFailed:t,results:i}}async function $4(s){if(!globalThis.QRCode){const i="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js";let n=document.head.querySelector(`script[src="${i}"]`);n||(n=document.createElement("script"),n.src=i,document.head.appendChild(n)),await new Promise((r,o)=>{n.addEventListener("load",()=>{r(!0)})})}const e=globalThis.QRCode,t=s.domElement??document.createElement("div");return new e(t,{width:s.width??256,height:s.height??256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:e.CorrectLevel.M,...s}),t}const eG=ie("debugdebug");let l0=!1;(ie("noerrors")||ie("nooverlaymessages"))&&(l0=!0);const Z1="needle_engine_global_error_container";var os;(function(s){s[s.Log=0]="Log",s[s.Warn=1]="Warn",s[s.Error=2]="Error"})(os||(os={}));function wB(){return sG}const HI=new Array;function WY(s){HI.push(s)}let $1=!1;function qY(...s){if(!$1){$1=!0;try{for(let e=0;e<HI.length;e++)HI[e](...s)}catch(e){console.error(e)}$1=!1}}const tG=console.error,iG=function(...s){tG.apply(console,s),KY(s),Ec(os.Error,s),VI(...s)};function nG(s){l0=!s,s?console.error=iG:console.error=tG}function XY(s){return nG(s)}function YY(){l0||(eG&&console.warn("Patch console",window.location.hostname),console.error=iG,window.addEventListener("error",s=>{if(!s)return;const e=s.error;if(e===void 0){So()&&console.warn("Received unknown error",s,s.target);return}Ec(os.Error,e,s.filename,s.lineno),VI(s)},!0),window.addEventListener("unhandledrejection",s=>{l0||s&&(s.reason?Ec(os.Error,s.reason.message,s.reason.stack):Ec(os.Error,"unhandled rejection"),VI(s))}))}let sG=0;function VI(...s){sG+=1,qY(...s)}function KY(s){if(Array.isArray(s))for(let e=0;e<s.length;e++){const t=s[e];typeof t=="string"&&t.startsWith("THREE.PropertyBinding: Trying to update node for track:")&&(s[e]="Some animated objects couldn't be found: see console for details")}}function Ec(s,e,t,i){if(l0)return;const n=xi.Current,r=(n==null?void 0:n.domElement)??document.querySelector("needle-engine");if(r){if(Array.isArray(e)){let o="";for(let a=0;a<e.length;a++){let l=e[a];l instanceof Error&&(l=l.message),typeof l!="object"&&(a>0&&(o+=" "),o+=l)}e=o}!e||e.length<=0||JY(s,r,e)}}const lA=new Map;function JY(s,e,t){if(t==null)return;const i=$Y(e);if(i.childElementCount>=20){const a=i.lastElementChild;ck(a)}t.length>400&&(t=t.substring(0,400)+"...");const n=t;if(lA.has(n))return;const r=eK(s,t);i.prepend(r);const o=()=>{lA.delete(n),ck(r)};lA.set(n,o),setTimeout(o,1e4)}function lk(){eG&&console.log("Clearing messages");for(const s of lA.values())s==null||s.call(s);lA.clear()}const ZY=`

@import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

div[data-needle_engine_debug_overlay] {
    font-family: 'Roboto Flex', sans-serif;
    font-weight: 400;
    font-size: 16px;
}

div[data-needle_engine_debug_overlay] strong {
    font-weight: 700;
}

div[data-needle_engine_debug_overlay] a {
    color: white;
    text-decoration: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
}

div[data-needle_engine_debug_overlay] a:hover {
    text-decoration: none;
    border: none;
}

div[data-needle_engine_debug_overlay] .log strong {
    color: rgba(200,200,200,.9);
}

div[data-needle_engine_debug_overlay] .warn strong {
    color: rgba(255,255,230, 1);
}

div[data-needle_engine_debug_overlay] .error strong {
    color: rgba(255,100,120, 1);
}
`;function $Y(s){globalThis[Z1]||(globalThis[Z1]=new Map);const e=globalThis[Z1];if(e.has(s))return e.get(s);{const t=document.createElement("div");e.set(s,t),t.setAttribute("data-needle_engine_debug_overlay",""),t.classList.add("debug-container"),t.style.cssText=`
            position: absolute;
            top: 0;
            right: 5px;
            padding-top: 0px;
            max-width: 70%;
            max-height: calc(100% - 5px);
            z-index: 9999999999;
            pointer-events: scroll;
            display: flex;
            align-items: end;
            flex-direction: column;
            color: white;
            overflow: auto;
            word-break: break-word;
        `,s.shadowRoot?s.shadowRoot.appendChild(t):s.appendChild(t);const i=document.createElement("style");return i.innerHTML=ZY,t.appendChild(i),t}}const rG=Symbol("logtype"),$w=new Map;function ck(s){s.remove();const e=s[rG],t=$w.get(e)??[];t.push(s),$w.set(e,t)}function eK(s,e){if($w.has(s)){const i=$w.get(s);if(i.length>0){const n=i.pop();return n.innerHTML=e,n}}const t=document.createElement("div");switch(t.setAttribute("data-id","__needle_engine_debug_overlay"),t.style.marginRight="5px",t.style.padding=".5em",t.style.backgroundColor="rgba(0,0,0,.9)",t.style.marginTop="5px",t.style.marginBottom="3px",t.style.borderRadius="8px",t.style.pointerEvents="all",t.style.userSelect="text",t.style.maxWidth="250px",t.style.whiteSpace="pre-wrap",t.style["backdrop-filter"]="blur(10px)",t.style["-webkit-backdrop-filter"]="blur(10px)",t.style.backgroundColor="rgba(20,20,20,.8)",t.style.boxShadow="inset 0 0 80px rgba(0,0,0,.2), 0 0 5px rgba(0,0,0,.2)",t.style.border="1px solid rgba(160,160,160,.2)",t[rG]=s,s){case os.Log:t.classList.add("log"),t.style.color="rgba(200,200,200,.7)",t.style.backgroundColor="rgba(40,40,40,.7)";break;case os.Warn:t.classList.add("warn"),t.style.color="rgb(255, 255, 150)",t.style.backgroundColor="rgba(50,50,20,.8)";break;case os.Error:t.classList.add("error"),t.style.color="rgb(255, 50, 50",t.style.backgroundColor="rgba(50,20,20,.8)";break}return t.title="Open the browser console (F12) for more information",t.innerHTML=e,t}var Pl={};Pl.d=(s,e)=>{for(var t in e)Pl.o(e,t)&&!Pl.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:e[t]})};Pl.o=(s,e)=>Object.prototype.hasOwnProperty.call(s,e);Pl.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})};var bs={};Pl.d(bs,{ti:()=>Qi,nS:()=>QG,eB:()=>u0,Yp:()=>SB,VB:()=>Lp,BC:()=>r_,zN:()=>Qp,cV:()=>Yg,hW:()=>f0,k2:()=>cG,K6:()=>Na,M7:()=>CB,ls:()=>o_,Hi:()=>EG,EY:()=>d0,MR:()=>yG,zf:()=>lG,Ay:()=>m$,yo:()=>jG});var SB={};Pl.r(SB);Pl.d(SB,{get:()=>oG,set:()=>tK});var CB={};Pl.r(CB);Pl.d(CB,{alphaTestTransformer:()=>JC,asPreprocessorValueTransformer:()=>AG,toPreprocessorTriggerTransformer:()=>kB,toUserDataTransformer:()=>dJ,uniformOrUserDataTransformer:()=>ka});const QI={fontFamily:null,fontSize:.05,fontKerning:"auto",fontStyle:"normal",fontWeight:"normal",offset:.005,lineHeight:1.2,lineBreak:`- ,.:?!
`,whiteSpace:"pre-line",flexDirection:"column",justifyContent:"start",alignItems:"start",backgroundImage:null,textAlign:"left",boxSizing:"content-box",position:"static",color:16777215,fontColor:16777215,fontOpacity:1,opacity:1,fontPXRange:4,fontSupersampling:!0,fontSmooth:"antialiased",borderRadius:0,borderWidth:0,borderColor:"black",borderOpacity:1,backgroundSize:"cover",backgroundColor:0,backgroundOpacity:0,overflow:"visible",letterSpacing:0,invertAlpha:!1,segments:1},tK=function(s){for(const e in s)QI[e]=s[e]},oG=function(s){return Object.prototype.hasOwnProperty.call(QI,s)||console.warn(`ThreeMeshUI::DefaultValues is trying to retrieve non-existing property '${s}'`),QI[s]};class Qi{constructor(e,t=null,i=!0){this._id=e,this._value=t,this._needsUpdate=!0,this._needsProcess=!1,this._needsRender=!1,this._isPrimitive=i}get id(){return this._id}get value(){return this._value}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,t){this.output(t)}output(e){}_outputValue(e){e[this._id]=this._value}process(e){}render(e){}getInheritedInput(e){if(this._value!=="inherit")return this._value;const t=e._parent._value;return t&&t[`_${this._id}`]?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}getDefaultValue(){return oG(this._id)}isValid(e){return!0}emptyStrategyLogic(){throw new Error(`ThreeMeshUI::${this.constructor.name} has empty strategy. Update has not been processed.`)}requestUpdate(){this._needsUpdate=!0}requestProcess(){this._needsProcess=!1}requestRender(){this._needsRender=!1}}class iK extends Qi{constructor(){super("renderOrder","auto",!0),this.output=this._outputValue,this._actualValue=0}set value(e){this.isValid(e)&&(this._value=e,this._needsUpdate=!0)}update(e,t){if(this._value!=="auto")this._actualValue=this._value;else{const i=e._parent._value;if(i!==null){const n=i._renderOrder._actualValue,r=1+i._children._uis.indexOf(e);this._actualValue=n+r}}for(const i of e._children._uis)i._renderOrder._value==="auto"&&(i._renderOrder._needsUpdate=!0);this._outputValue(t)}_outputValue(e){e[this._id]=this._actualValue}get value(){return this._value}}class Qp extends Qi{constructor(e,t=null,i=!0){super(e,t,i),this.output=this._outputValue,this._notInheritedValue=null}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),this.propagate(e),this._outputValue(t)}propagate(e){for(const t of e._children._uis){const i=t[`_${this._id}`];i!==void 0&&i._value==="inherit"&&(t[`_${this._id}`]._needsUpdate=!0)}}_outputValue(e){e[this._id]=this._notInheritedValue}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class nK extends Qp{constructor(){super("offset","inherit",!1)}update(e,t){super.update(e,t),e._parent._value!==null&&(e.position.z=this._notInheritedValue)}}class sK extends Qp{constructor(){super("fontSmooth","inherit",!0),this._needsUpdate=!1,this.isValid=oK,this.output=this._outputValue}}const rK=["inherit","none","antialiased"];function oK(s){return rK.indexOf(s)===-1?(console.warn(`.fontSmoothing value '${s}' is not valid. Aborted`),!1):!0}var aK=s=>{var e={};return Pl.d(e,s),e};const qe=aK({BackSide:()=>Gn,BufferAttribute:()=>ot,BufferGeometry:()=>pt,Color:()=>me,DoubleSide:()=>Pi,EventDispatcher:()=>Zs,FileLoader:()=>Hn,FrontSide:()=>As,LinearFilter:()=>Nt,Mesh:()=>le,MeshBasicMaterial:()=>Kt,Object3D:()=>ge,Plane:()=>Ar,PlaneGeometry:()=>_s,ShaderMaterial:()=>Rt,Texture:()=>Pt,TextureLoader:()=>Xa,Vector2:()=>Z,Vector3:()=>w,Vector4:()=>Je});class Dn extends Qi{constructor(e,t,i=!0){super(e,"unset",i),this._input="inherit",this._allowsInherit=!0,this._inheritedInput=void 0,this._inline=void 0}update(e,t){this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis){const n=i[`_${this._id}`];(n._input?n._input:n._value)==="inherit"&&(i[`_${this._id}`]._needsUpdate=!0)}this.output(t)}computeOutputValue(e){this._value=this._input}_computeFromInherited(e){this._value=this._inheritedInput}set value(e){console.warn(".(style) sub-property cannot be directly set. It must comes from inline or computed setter.")}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._input=this._inline=e,this._needsUpdate=!0)}get inline(){return this._inline}isValidValue(e){return!0}getInheritedInput(e){if(this._input!=="inherit")return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}}class KC extends Dn{constructor(e,t){super(e,t,!1),this._input=new qe.Vector4(0,0,0,0),this._inline=null,this._value=new qe.Vector4(0,0,0,0)}get value(){return this._value}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input)}set inline(e){this._vector4ValueSetter(this._input,e),!this._input.equals(this._value)&&(this._needsUpdate=!0)}set top(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get top(){return this._input.x}set right(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get right(){return this._input.y}set bottom(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottom(){return this._input.z}set left(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get left(){return this._input.w}dispose(){this._computed=null,this._inline=null,this._input=null,this._output=null}_vector4ValueSetter(e,t){if(t instanceof qe.Vector4){e.copy(t);return}if((typeof t=="string"||t instanceof String)&&(t=t.split(" ")),Array.isArray(t))switch(t=t.map(i=>parseFloat(i)),t.length){case 1:e.setScalar(t[0]);return;case 2:e.x=e.z=t[0],e.y=e.w=t[1];return;case 3:e.x=t[0],e.y=t[1],e.z=t[2];return;case 4:e.x=t[0],e.y=t[1],e.z=t[2],e.w=t[3];return;default:console.error("StyleVector4Property::set() Four Dimension property had more than four values");return}isNaN(t)||e.setScalar(t)}}class lK extends KC{constructor(){super("padding",new qe.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._bounds._needsUpdate=!0,e._bounds._needsRender=!0,e._layouter._needsProcess=!0,e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}class cK extends KC{constructor(){super("margin",new qe.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._flexDirection._needsProcess=!0)}}const hk=function(s,e,t){s[e]=t},hK=function(s,e,t){t!==null&&(s[e]=t)};class Zb{constructor(e){this._definition=e}set definition(e){this._definition=e}mediate(e,t,i,n=null){for(const r in this._definition){const o=this._definition[r];if(i[r]!==void 0){const a=o.t?o.t:hk;a(t,o.m,i[r]),n&&a(n,o.m,i[r])}}}static mediate(e,t,i,n,r=null){if(t)for(const o in n){const a=n[o];if(i[o]!==void 0){const l=a.t?a.t:hk;l(t,a.m,i[o]),r&&l(r,a.m,i[o])}}}}class uK extends Qi{constructor(){super("parent",null,!1)}update(e,t){e.parent&&e.parent.isUI?this._value=e.parent:this._value=null}set value(e){console.warn("ParentProperty is readonly")}get value(){return this._value}find(e){return this._value?e(this._value)?this._value:this._value._parent.find(e):null}dispose(){this._value=null}}const jI=function(s,e,t=6){return s.toFixed(t)===e.toFixed(t)};class uk extends Qi{constructor(e,t){super(e,t,!0),this.output=this._outputValue}set value(e){this.isValid(e)&&(jI(this._value,e)||(this._value=e,this._needsUpdate=!0))}get value(){return this._value}}class dk extends Qp{constructor(e){super(e,"inherit",!0),this.isValid=fK}}const dK=[qe.FrontSide,qe.BackSide,qe.DoubleSide];function fK(s){return dK.indexOf(s)===-1?(console.warn(`SideProperty value '${s}' is not valid. Abort`),!1):!0}class aG{constructor(){this._offsetX=0,this._offsetY=0,this._lineBreak=null,this._kerning=0,this._fontFactor=1,this._fontSize=0,this._cumulativeWidth=0,this._paddingLeft=0,this._paddingRight=0,this._marginLeft=0,this._marginRight=0}resetOffsets(){this._offsetX=this._offsetY=0,this._cumulativeWidth=0}get xadvance(){return 0}get xoffset(){return 0}get yoffset(){return 0}get width(){return 0}get height(){return 0}set lineBreak(e){this._lineBreak=e}get lineBreak(){return this._lineBreak}get anchor(){return 0}get kerning(){return this._kerning*this._fontFactor}set kerning(e){this._kerning=e}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e}get lineHeight(){return 0}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e}get cumulativeWidth(){return this._cumulativeWidth}set cumulativeWidth(e){this._cumulativeWidth=e}get marginLeft(){return this._marginLeft}set marginLeft(e){this._marginLeft=e}get marginRight(){return this._marginRight}set marginRight(e){this._marginRight=e}get paddingLeft(){return this._paddingLeft}set paddingLeft(e){this._paddingLeft=e}get paddingRight(){return this._paddingRight}set paddingRight(e){this._paddingRight=e}get lineBase(){return 0}set fontFactor(e){this._fontFactor=e}get fontFactor(){return this._fontFactor}}class lG{constructor(e){this._char="",this._width=1,this._heigth=1,this._xadvance=1,this._xoffset=0,this._yoffset=0,this._font=e}get font(){return this._font}get char(){return this._char}get width(){return this._width}get height(){return this._heigth}get xadvance(){return this._xadvance}get xoffset(){return this._xoffset}get yoffset(){return this._yoffset}set yoffset(e){this._yoffset=e}clone(e){throw new Error("Abstract... Need to be implemented")}asInlineGlyph(){throw new Error("Abstract... Need to be implemented")}}class cG extends aG{constructor(e){super(),this._typographic=e}get typographic(){return this._typographic}get xadvance(){return this._typographic.xadvance*this._fontFactor}get xoffset(){return this._typographic.xoffset*this._fontFactor}get yoffset(){return this._typographic.yoffset*this._fontFactor}get width(){return this._typographic.width*this._fontFactor}get height(){return this._typographic.height*this._fontFactor}get char(){return this._typographic.char}get anchor(){return this.yoffset}get lineHeight(){return this._typographic.font.lineHeight*this._fontFactor}get lineBase(){return this._typographic.font.lineBase*this._fontFactor}}const pK={light:"100",normal:"400",bold:"700",bolder:"900"};function EB(s){if(!isNaN(s))return s.toString();const e=pK[s];return e||s}class mK extends qe.EventDispatcher{constructor(e,t){super(),this._isReady=!1,this._weight=EB(e),this._style=t,this._size=42,this._lineHeight=42,this._lineBase=42,this._font=null}get typographic(){return this._font}get isReady(){return this._isReady}get weight(){return this._weight}get style(){return this._style}get texture(){return this._texture}set fontMaterial(e){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get fontMaterial(){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get id(){return`${this._name}(w:${this.weight},s:${this.style})`}getTypographicGlyph(e){let t=this._chars[e];if(t)return t;if(e.match(/\s/))return this._chars[" "];const i=this._getFallbackCharacter(e);if(i&&(t=this._chars[i],t))return t;throw Error(`FontVariant('${this.id}')::getTypographicGlyph() - character('${e}') and/or fallback character were not found in provided msdf charset.`)}_getFallbackCharacter(e){throw new Error(`FontVariant(${typeof this})::_getFallbackCharacter() is abstract and should therefore be overridden.`)}getGeometricGlyph(e,t){throw new Error(`FontVariant(${typeof this})::getGeometryCharacter() is abstract and should therefore be overridden.`)}getKerningAmount(e){return this._kernings[e]?this._kernings[e]:0}adjustTypographicGlyphs(e){for(const t in e){const i=this.getTypographicGlyph(t),n=e[t];for(const r in n)i["_"+r]=e[t][r]}}_checkReadiness(){this._readyCondition()&&vK(this)}_alterElementProperties(e){throw new Error(`FontVariant(${typeof this})::_alterElementProperties() is abstract and should therefore be overridden.`)}_readyCondition(){throw new Error(`FontVariant(${typeof this})::_readyCondition() is abstract and should therefore be overridden.`)}}const gK={type:"ready"};function vK(s){s._isReady=!0,s.dispatchEvent(gK)}const r_=mK;class yK extends Qi{constructor(e=null){super("font",e,!1),this._needsUpdate=!1,this._fontVariant=null,this._handleFontReadyClosure=null,this.isValid=AK}output(e){e[this._id]=this._fontVariant}update(e,t){if(this._fontVariant&&!this._fontVariant.isReady&&this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._value&&this._value instanceof r_)this._fontVariant=this._value;else{const i=e._fontFamily._value;i&&(this._fontVariant=i.getVariant(e._fontWeight._value,e._fontStyle._value))}this._fontVariant&&(this._fontVariant._alterElementProperties(e),this._handleFontReadyClosure=_K(e,this),this._fontVariant.isReady?this._handleFontReadyClosure():this._fontVariant.addEventListener("ready",this._handleFontReadyClosure),(!e._fontMaterial._defaultMaterial||!(e._fontMaterial._defaultMaterial instanceof this._fontVariant.fontMaterial))&&(e._fontMaterial._defaultMaterial=new this._fontVariant.fontMaterial,e._fontMaterial._needsUpdate=!0))}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}get fontVariant(){return this._fontVariant}dispose(){this._handleFontReadyClosure&&(this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._handleFontReadyClosure=null),this._value=null,this._fontVariant=null}}function AK(s){return s instanceof r_?!0:(console.warn(`.font value '${s}' is not valid. It requires a FontVariant instance. Aborted`),!1)}function _K(s,e){return function(){e._needsUpdate=!0,s._glyphs._needsProcess=!0,e._fontVariant.removeEventListener("ready",e._handleFontReadyClosure),e._handleFontReadyClosure=null}}class bK extends Dn{constructor(e){super("display",e),this._value="flex",this._allowsInherit=!1,this._needsUpdate=!1,this.isValidValue=wK}computeOutputValue(e){e._visible._value=this._output!=="none"}}const xK=["none","flex"];function wK(s){return xK.indexOf(s)===-1?(console.warn(`(.style) display value '${s}' is not valid. Aborted`),!1):!0}class SK extends Dn{constructor(e){super("boxSizing",e),this._allowsInherit=!1,this.isValidValue=EK}computeOutputValue(e){this._value=this._inheritedInput,e._bounds._needsUpdate=!0}}const CK=["border-box","content-box"];function EK(s){return CK.indexOf(s)===-1?(console.warn(`(.style) boxSizing value '${s}' is not valid. Aborted`),!1):!0}class c0 extends Dn{constructor(e,t){super(e,t,!1),this._value=new qe.Color,this.output=this._outputValue}computeOutputValue(e){this._input!=="inherit"&&this._value.set(this._input)}set inline(e){this._input=this._inline=e,this._needsUpdate=!0}}class eT extends Dn{constructor(e,t){super(e,t,!0),this.isValidValue=TK,this._allowsInherit=!1,this._input=t,this._value=t,this.output=this._outputValue,this.computeOutputValue=this._computeFromInherited}_outputValue(e){e[this._id]=this._inheritedInput}}function TK(s){return s<0&&s>1?(console.warn(`(.style) styleFactorProperty('${this.id}') value '${s}' is not valid)`),!1):!0}class MK extends Dn{constructor(e){super("backgroundImage",e,!0),this._input=null,this._allowsInherit=!1,this._textureSize=new qe.Vector2(1,1),this.isValidValue=IK}get value(){return this._value}output(e){e[this._id]=this._value,e.tSize=this._textureSize}computeOutputValue(e){if(this._value=this._inheritedInput,this._value instanceof qe.Texture&&!this._value.image){console.warn("ThreeMeshUI - .backgroundImage :: Please provide preloaded texture in order to have accurate sizing.");return}this._needsProcess=!0}process(e){this._value?this._textureSize.set(this._value.image.width,this._value.image.height):this._textureSize.set(1,1)}}function IK(s){return!0}class RK extends Dn{constructor(e){super("backgroundSize",e,!0),this.isValidValue=BK,this.output=this._outputValue}}const PK=["cover","contain","stretch"];function BK(s){return PK.indexOf(s)===-1?(console.warn(`(.style) backgroundSize value '${s}' is not valid. Aborted`),!1):!0}class DK extends Dn{constructor(e){super("overflow",e,!0),this.isValidValue=LK,this._clippingPlanes=null,this._renderStrategy=this._emptyRender}update(e,t){this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0&&(this._input=this._computed),this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis)i._overflow._needsUpdate=!0;this.output(t)}output(e){e.clippingPlanes=this._clippingPlanes}computeOutputValue(e){super.computeOutputValue(e),this._value==="hidden"?this._renderStrategy=this._propagateRender:(this._renderStrategy=this._emptyRender,this._clippingPlanes=null);const t=e._parent._value;if(t!==null){const i=t._overflow;if((i._value==="hidden"||i._clippingPlanes!==null)&&!this._clippingPlanes){this._clippingPlanes=[new qe.Plane(new qe.Vector3(0,-1,0),1),new qe.Plane(new qe.Vector3(-1,0,0),1),new qe.Plane(new qe.Vector3(0,1,0),1),new qe.Plane(new qe.Vector3(1,0,0),1)];for(let n=0;n<this._clippingPlanes.length;n++)this._clippingPlanes[n].parent=t;i._clippingPlanes!==null&&this._clippingPlanes.push(...i._clippingPlanes),this._renderStrategy=this._hiddenRender,this._needsRender=!0}else(i._value==="visible"||i._clippingPlanes===null)&&this._clippingPlanes!==null&&(this._clippingPlanes=null,this._renderStrategy=this._emptyRender,this._needsRender=!0)}}render(e){this._renderStrategy(e)}_emptyRender(e){}_hiddenRender(e){const t=e._parent._value,i=t._bounds._offsetHeight,n=t._bounds._offsetWidth,r=t._padding._value,o=t._borderWidth._value;for(let a=0;a<4&&a<this._clippingPlanes.length;a++){const l=this._clippingPlanes[a];switch(a%4){case 0:l.constant=i/2-(r.x+o.x);break;case 1:l.constant=n/2-(r.y+o.y);break;case 2:l.constant=i/2-(r.z+o.z);break;case 3:l.constant=n/2-(r.w+o.w);break}l.applyMatrix4(t.matrixWorld)}for(let a=0;a<e._children._uis.length;a++){const l=e._children._uis[a];l._overflow._needsRender=!0}}_propagateRender(e){for(let t=0;t<e._children._uis.length;t++){const i=e._children._uis[t];i._overflow._needsRender=!0}}}const OK=["visible","hidden"];function LK(s){return OK.indexOf(s)===-1?(console.warn(`(.style) overflow value '${s}' is not valid. Aborted`),!1):!0}const Xg="rem",hG="em",eS="%",kK=[Xg,hG,eS],uG=function(s){return kK.indexOf(s)===-1?Xg:s};class FK extends KC{constructor(e){super("borderRadius",e),this._valueUV=this._value.clone(),this._input=new qe.Vector4(0,0,0,0),this._mediation=!0,this._cornerTL=new qe.Vector2(0,1),this._cornerTR=new qe.Vector2(1,1),this._cornerBR=new qe.Vector2(1,0),this._cornerBL=new qe.Vector2(0,0);const t=new $b(this._valueUV,["x","y"]),i=new $b(this._valueUV,["z","w"]),n=new $b(this._valueUV,["x","w"]),r=new $b(this._valueUV,["y","z"]);t.complementaryMediation=i,i.complementaryMediation=t,n.complementaryMediation=r,r.complementaryMediation=n,this._sideMediators=[t,i,n,r],this._units=Xg}set units(e){this._units=uG(e),this._needsProcess=!0}get units(){return this._units}set mediation(e){e!==this._mediation&&(this._mediation=e,this._needsUpdate=!0)}get mediation(){return this._mediation}output(e){e.cornerTL=this._cornerTL,e.cornerTR=this._cornerTR,e.cornerBR=this._cornerBR,e.cornerBL=this._cornerBL}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0}process(e){this._needsRender=!0}render(e){this._valueUV.copy(this._value);const t=e._bounds._offsetWidth,i=e._bounds._offsetHeight;if(this._units===eS&&this._valueUV.divideScalar(100),this._units===Xg&&this._valueUV.divideScalar(Math.min(t,i)),this._mediation)do this._sideMediators.forEach(o=>o.computeValue()),this._sideMediators.sort((o,a)=>o.value<a.value?1:-1),this._sideMediators[0].value>1&&this._sideMediators[0].mediate();while(this._sideMediators[0].value>1);let n=t>i?i/t:1,r=t<i?t/i:1;this._units===eS&&(n=r=1),this._cornerTL.x=this._valueUV.x*n,this._cornerTL.y=1-this._valueUV.x*r,this._cornerTR.x=1-this._valueUV.y*n,this._cornerTR.y=1-this._valueUV.y*r,this._cornerBR.x=1-this._valueUV.z*n,this._cornerBR.y=this._valueUV.z*r,this._cornerBL.x=this._valueUV.w*n,this._cornerBL.y=this._valueUV.w*r}dispose(){for(const e of this._sideMediators)e.dispose();this._sideMediators=null,this._cornerTL=null,this._cornerTR=null,this._cornerBR=null,this._cornerBL=null,super.dispose()}set topLeft(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get topLeft(){return this._input.x}set topRight(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get topRight(){return this._input.y}set bottomRight(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottomRight(){return this._input.z}set bottomLeft(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get bottomLeft(){return this._input.w}set top(e){this._input.x===e&&this._input.y===e||(this._input.x=this._input.y=e,this._needsUpdate=!0)}get top(){return(this._input.x+this._input.y)/2}set right(e){this._input.y===e&&this._input.z===e||(this._input.y=this._input.z=e,this._needsUpdate=!0)}get right(){return(this._input.y+this._input.z)/2}set bottom(e){this._input.z===e&&this._input.w===e||(this._input.z=this._input.w=e,this._needsUpdate=!0)}get bottom(){return(this._input.z+this._input.w)/2}set left(e){this._input.w===e&&this._input.x===e||(this._input.w=this._input.x=e,this._needsUpdate=!0)}get left(){return(this._input.w+this._input.x)/2}}class $b{constructor(e,t){this._borderRadiuses=e,this._sideProperties=t,this._complementaryMediation=null,this._value=0}get value(){return this._value}set complementaryMediation(e){this._complementaryMediation=e}computeValue(){let e=0;for(const t of this._sideProperties)e+=this._borderRadiuses[t];this._value=e}mediate(e=!0){if(!(this._value<1)){for(const t of this._sideProperties)this._borderRadiuses[t]/=this._value;e&&this._complementaryMediation.mediate(!1)}}dispose(){this._complementaryMediation=null,this._borderRadiuses=null}}class UK extends KC{constructor(e){super("borderWidth",e,!1),this._valueUV=this._value.clone(),this.output=this._outputValue,this._units=Xg}set units(e){this._units=uG(e),this._needsUpdate=!0}get units(){return this._units}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0,e._bounds._needsUpdate=!0,e._layouter._needsUpdate=!0}_outputValue(e){e[this._id]=this._valueUV}process(e){this._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._valueUV.copy(this._value);const t=e._bounds._offsetWidth,i=e._bounds._offsetHeight;if(this._units===eS&&(console.log("Percent"),console.log(this._valueUV)),this._units===Xg)t!==0&&(this._valueUV.w/=t,this._valueUV.y/=t),i!==0&&(this._valueUV.x/=i,this._valueUV.z/=i);else if(this._units===hG){if(t!==0){const n=t>i?i/t:1;this._valueUV.y*=n,this._valueUV.w*=n}if(i!==0){const n=t<i?t/i:1;this._valueUV.x*=n,this._valueUV.z*=n}}}}class NK extends Qi{constructor(e,t=!0){super("visible",t,!0),this._needsUpdate=!1}update(e,t){e.visible=this._value,e._parent._value&&(e._parent._value._children._needsUpdate=!0)}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}}class dG extends c0{constructor(e){super("backgroundColor",e,!1),this._input="transparent",this._allowsInherit=!1}computeOutputValue(e){e._backgroundMesh.visible=!(this._input==="none"||this._input==="transparent"),this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._input==="transparent"||this._input==="none"||this._value.set(this._input)}}class Sh extends Qi{constructor(e="untitled"){super(e,void 0,!1)}update(e,t){}output(e){}}class zK extends Qi{constructor(){super("inlineJustificator",null,!1),this._value=null}update(e,t){}process(e){const t=e._bounds._innerHeight,i=e._layouter._value,n=Math.abs(i.height);let r=(()=>{switch(e._alignItems._value){case"inherit":case"start":return t/2;case"end":return n-t/2;case"stretch":case"center":return n/2}})();const o=e._padding._value,a=e._borderWidth._value;r+=(-o.x+o.z)/2+(-a.x+a.z)/2,i.forEach(l=>{l.y+=r,l.forEach(c=>{c.offsetY+=r})})}}const GK=["start","center","end","stretch"],HK=function(s){return GK.indexOf(s)===-1?(console.warn(`(.style) alignItems value '${s}' is not valid. Aborted`),!1):!0};class TB extends Dn{constructor(){super("alignItems","inherit",!0),this.isValidValue=HK}}class MB extends Dn{constructor(){super("textAlign","inherit",!0),this.isValidValue=QK}}const VK=["left","right","center","justify","justify-left","justify-right","justify-center"],QK=function(s){return VK.indexOf(s)===-1?(console.warn(`(.style) textAlign value '${s}' is not valid. Aborted`),!1):!0};class IB extends Dn{constructor(){super("flexDirection","inherit",!0),this.isValid=WK}}const jK=["row","row-reverse","column","column-reverse"];function WK(s){return jK.indexOf(s)===-1?(console.warn(`(.style) flexDirection value '${s}' is not valid. Aborted`),!1):!0}class RB extends Dn{constructor(){super("justifyContent","inherit",!0),this.isValidValue=XK}}const qK=["start","center","end","space-between","space-around","space-evenly"];function XK(s){return qK.indexOf(s)===-1?(console.warn(`(.style) justifyContent value '${s}' is not valid. Aborted`),!1):!0}class YK extends Dn{constructor(){super("order",0,!0),this._value=0,this._input=0,this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._parent._value&&(e._parent._value._children._needsProcess=!0)}}class fG extends Dn{constructor(){super("position","static",!0),this._allowsInherit=!1,this._value="static",this._needsUpdate=!1,this.computeOutputValue=this._computeFromInherited,this.isValidValue=JK}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value&&(e._parent._value._children._needsProcess=!0)}}const KK=["static","absolute"];function JK(s){return KK.indexOf(s)===-1?(console.warn(`(.style) position value '${s}' is not valid. Aborted`),!1):!0}class pG extends Dn{constructor(e,t=null){super(e,t,!0),this._input="auto",this._auto=!0,this._relative=!1,this._updateRequired=!0}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._inline=e,this._input!==this._inline&&this._parseInput())}get inline(){return this._inline}_parseInput(){let e=!0;if(this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0?(this._computed===this._input&&(e=!1),this._input=this._computed):e=this._input==="inherit",e){if(this._auto=!this._input||this._input==="auto",this._auto)this._relative=!1;else if((typeof this._input=="string"||this._input instanceof String)&&this._input.endsWith("%")){this._relative=!0,this._value=0;const t=parseFloat(this._input.replace("%","").trim());isNaN(t)||(this._value=t/100)}else this._relative=!1,this._value=this._input;this._needsUpdate=this._updateRequired=e}}update(e,t){if(this._updateRequired){this._updateRequired=!1,this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis)i[`_${this._id}`]._needsUpdate=!0;this.output(t),e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}computeOutputValue(e){e._bounds._needsUpdate=!0,e._renderer._needsRender=!0}getInheritedInput(e){if(this._input!=="inherit"&&!this._auto)return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}getDefaultValue(){return 0}get value(){return this._value}}class ZK extends pG{constructor(){super("width")}}class $K extends pG{constructor(){super("height")}computeOutputValue(e){super.computeOutputValue(e)}}class mG extends Sh{constructor(){super("textContent"),this._needsUpdate=!1}set value(e){}process(e){let t="";for(let i=0;i<e.children.length;i++){const n=e.children[i];n.isUI&&(t+=n.textContent)}this._value=t}}class gG extends Dn{constructor(e){super("fontStyle",e,!0),this.isValidValue=tJ}}const eJ=["normal","italic"];function tJ(s){return eJ.indexOf(s)===-1?(console.warn(`(.style) fontStyle value '${s}' is not valid. Aborted`),!1):!0}class vG extends Dn{constructor(){super("fontWeight","inherit",!0),this.isValid=nJ}}const iJ=["100","200","300","400","500","600","700","800","900","light","normal","bold","bolder"];function nJ(s){return iJ.indexOf(s.toString())===-1?(console.warn(`(.style) fontWeight value '${s}' is not valid. Aborted`),!1):!0}class yG{constructor(){this._size=42,this._lineHeight=42,this._lineBase=38,this._name="-",this._charset=""}get size(){return this._size}get lineHeight(){return this._lineHeight}get lineBase(){return this._lineBase}get name(){return this._name}get charset(){return this._charset}}class sJ extends yG{constructor(e){super(),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._name=e.info.face,this._textureWidth=e.common.scaleW,this._textureHeight=e.common.scaleH,this._charset=e.chars.map(t=>t.char).join("")}get textureWidth(){return this._textureWidth}get textureHeight(){return this._textureHeight}}class rJ extends cG{constructor(e){super(e)}get uv(){return this.typographic.uv}}class tS extends lG{constructor(e,t){super(e),this._char=t.char,this._width=t.width,this._heigth=t.height,this._xadvance=t.xadvance?t.xadvance:this._width,this._xoffset=t.xoffset?t.xoffset:0,this._yoffset=t.yoffset?t.yoffset:0,this._uv=t.uv?t.uv:null,isNaN(t.x)||(this._uv={left:t.x/e.textureWidth,right:(t.x+t.width)/e.textureWidth,top:1-(t.y+t.height)/e.textureHeight,bottom:1-t.y/e.textureHeight})}get uv(){return this._uv}clone(e){return new tS(this._font,{char:e,width:this._width,height:this._heigth,xadvance:this._xadvance,xoffset:this._xoffset,yoffset:this._yoffset,uv:null})}asInlineGlyph(){return new rJ(this)}}class oJ extends qe.PlaneGeometry{constructor(e,t){let i=1,n=1;const r=e.typographic.font.size,o=t._segments.value;i=Math.ceil(e.typographic.width/r*o),n=Math.ceil(e.typographic.height/r*o),super(e.width,e.height,i,n),e.uv?(this._mapUVs(e),this._transformGeometry(e)):(this._nullifyUVs(),this.scale(0,0,1),this.translate(0,e.fontSize/2,0)),this.name="GlyphGeometry"}_mapUVs(e){const t=e.uv.right-e.uv.left,i=e.uv.bottom-e.uv.top,n=this.getAttribute("uv").array.slice(),r=[];for(let o=0;o<n.length;o+=2){const a=n[o],l=n[o+1];r.push(e.uv.left+t*a),r.push(e.uv.top+i*l)}this.setAttribute("uvG",new qe.BufferAttribute(new Float32Array(r),2))}_nullifyUVs(){const e=[],t=this.getAttribute("uv").array.length;for(let i=0;i<t;i++)e.push(0);this.setAttribute("uvG",new qe.BufferAttribute(new Float32Array(e),2))}_transformGeometry(e){this.translate(e.width/2,-e.height/2,0)}}const aJ=`
attribute vec2 uvG;
varying vec2 vUvG;
`,PB=aJ,lJ=`
vUvG = uvG;
`,BB=lJ,cJ=`
gl_Position.z -= 0.00001;
`,DB=cJ,hJ=`
varying vec2 vUvG;
uniform sampler2D glyphMap;
uniform vec2 unitRange;
// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field
float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}
float screenPxRange() {

	// precomputed unitRange as recommended by Chlumsky
	// vec2 unitRange = vec2(pxRange)/vec2(textureSize(glyphMap, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUvG);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}
float tap(vec2 offsetUV) {
	vec3 msd = texture( glyphMap, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}
`,OB=hJ,uJ=`
	float alpha;
#ifdef NO_RGSS

	alpha = tap( vUvG );

#else

	// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
	// per pixel partial derivatives
	vec2 dx = dFdx(vUvG);
	vec2 dy = dFdy(vUvG);
	// rotated grid uv offsets
	vec2 uvOffsets = vec2(0.125, 0.375);
	vec2 offsetUV = vec2(0.0, 0.0);
	// supersampled using 2x2 rotated grid
	alpha = 0.0;
	offsetUV.xy = vUvG + uvOffsets.x * dx + uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.x * dx - uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG + uvOffsets.y * dx - uvOffsets.x * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.y * dx + uvOffsets.x * dy;
	alpha += tap(offsetUV);
	alpha *= 0.25;

#endif

	alpha = clamp( alpha, 0.0, 1.0 );

#ifdef INVERT_ALPHA

	alpha = 1.0 - alpha;

#endif

	diffuseColor.a *= alpha;
`,LB=uJ,JC=function(s,e,t){s.alphaTest=t,kB(s,"USE_ALPHATEST",t>0)},kB=function(s,e,t){s.defines&&(t?s.defines[e]===void 0&&(s.defines[e]="",s.needsUpdate=!0):s.defines[e]!==void 0&&(delete s.defines[e],s.needsUpdate=!0))},AG=function(s,e,t){s.defines[e]&&s.defines[e]===t||(s.defines[e]=t,s.needsUpdate=!0)},ka=function(s,e,t){s.userData[e]?s.userData[e].value=t:s.uniforms[e].value=t},dJ=function(s,e,t){s.userData[e].value=t};class Na{static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,t){e.userData.glyphMap={value:t.glyphMap},e.userData.unitRange={value:new qe.Vector2}}static bindUniformsWithUserData(e,t){e.uniforms.glyphMap=t.userData.glyphMap,e.uniforms.unitRange=t.userData.unitRange}static injectShaderChunks(e){Na.injectVertexShaderChunks(e),Na.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+PB),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+BB),e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
`+DB)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <uv_pars_fragment>",`#include <uv_pars_fragment>
`+OB),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
`+LB)}static from(e){return class extends e{constructor(i={}){Na.ensureMaterialOptions(i);super(i);u(this,"_cumulativeOnBeforeCompile",i=>{Na.bindUniformsWithUserData(i,this),Na.injectShaderChunks(i),this._userDefinedOnBeforeCompile(i)});Na.ensureDefines(this),Na.ensureUserData(this,i),this._userDefinedOnBeforeCompile=n=>{},this._onBeforeCompile=this._cumulativeOnBeforeCompile}static get fontMaterialProperties(){return Na.mediation}set onBeforeCompile(i){this._userDefinedOnBeforeCompile=i}get onBeforeCompile(){return this._onBeforeCompile}}}static get mediation(){return mJ}}const fJ=function(s,e,t){const i=t?t.texture:null,n=t?t.unitRange:new qe.Vector2;if(s[e]!==void 0){s.glyphMap=i,s.unitRange=n;return}s.userData&&s.userData.glyphMap&&(s.userData.glyphMap.value=i,s.userData.unitRange.value=n)},pJ=function(s,e,t){t&&t!=="antialiased"?s.defines.NO_RGSS="":delete s.defines.NO_RGSS,s.needsUpdate=!0},mJ={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:JC},fontSide:{m:"side"},font:{m:"glyphMap",t:fJ},color:{m:"color"},fontOpacity:{m:"opacity"},fontSmooth:{m:"NO_RGSS",t:pJ},invertAlpha:{m:"INVERT_ALPHA",t:kB}},gJ=`
${PB}
#include <clipping_planes_pars_vertex>
void main() {
	${BB}
	#include <begin_vertex>
	#include <project_vertex>
	${DB}
	#include <clipping_planes_vertex>
}
`,vJ=`
uniform vec3 diffuse;
uniform float opacity;
${OB}
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	// instead of <color_fragment> : vec4 diffuseColor
	vec4 diffuseColor = vec4( diffuse, opacity );
	${LB}
	#include <alphatest_fragment>
	// instead of <output_fragment>
	gl_FragColor = diffuseColor;
	#include <clipping_planes_fragment>
}
`,yJ=.02;class FB extends qe.ShaderMaterial{static get mediation(){return Na.mediation}constructor(e={}){super({uniforms:{glyphMap:{value:null},diffuse:{value:null},opacity:{value:1},unitRange:{value:new qe.Vector2(0,0)},alphaTest:{value:yJ}},transparent:!0,clipping:!0,vertexShader:gJ,fragmentShader:vJ,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0,this.noRGSS=e.noRGSS||!1}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get unitRange(){return this.uniforms.unitRange.value}set unitRange(e){this.uniforms.unitRange.value.copy(e)}get glyphMap(){return this.uniforms.glyphMap.value}set glyphMap(e){this.uniforms.glyphMap.value=e}get isDefault(){return this.constructor===FB}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}}class AJ extends r_{constructor(e,t,i,n){if(super(e,t),this._unitRange=new qe.Vector2(1,1),i.pages?this._buildData(i):_J(this,i),n instanceof qe.Texture)this._texture=n,this._buildTexture(n);else if(typeof n=="string"||n instanceof String)bJ(this,n);else throw new Error(`ThreeMeshUI::MSDFVariant provided 'texture' parameter is '${typeof n}'. Only Texture and String allowed.`);this._defaultMaterialClass=FB,this._checkReadiness()}get texture(){return this._texture}get unitRange(){return this._unitRange}set fontMaterial(e){this._defaultMaterialClass=e}get fontMaterial(){return this._defaultMaterialClass}_buildData(e){this._font=new sJ(e),this._kernings=this._buildKerningPairs(e),this._chars=this._buildCharacters(e),this._chars[" "]=this._buildCharacterWhite(e),this._chars[`
`]=this._buildCharacterWhite(e,`
`,.001,1),this._chars["	"]=this._buildCharacterWhite(e,"	",4,1),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._distanceRange=e.distanceField.distanceRange,this._unitRange=new qe.Vector2(this._distanceRange,this._distanceRange).divide(new qe.Vector2(e.common.scaleW,e.common.scaleH))}_buildTexture(e){e.generateMipmaps=!1,e.minFilter=qe.LinearFilter,e.magFilter=qe.LinearFilter,e.needsUpdate=!0}_getFallbackCharacter(e){return Lp.missingCharacter(this,e)}getGeometricGlyph(e,t){return new oJ(e,t)}_readyCondition(){return this._chars&&this._texture&&this._texture.image}_buildKerningPairs(e){const t={};for(let i=0;i<e.kernings.length;i++){const n=e.kernings[i];if(n.amount===0)continue;const r=String.fromCharCode(n.first,n.second);t[r]=n.amount}return t}_buildCharacters(e){const t={};for(let i=0;i<e.chars.length;i++){const n=e.chars[i];t[n.char]=new tS(this._font,n)}return t}_buildCharacterWhite(e,t=" ",i=1,n=1){return new tS(this._font,{char:t,width:e.info.size/3*i,height:e.info.size*.7*n})}_alterElementProperties(e){}}function _J(s,e){new qe.FileLoader().setResponseType("json").load(e,t=>{s._buildData(t),s._checkReadiness()})}function bJ(s,e){s._texture=new qe.TextureLoader().load(e,t=>{s._buildTexture(t),s._checkReadiness()})}class ZC extends qe.EventDispatcher{constructor(t){super();u(this,"_checkReadiness",()=>{this._variants.every(t=>t.isReady)&&wJ(this)});this._name=t,this._variants=[],this._isReady=!1}get isReady(){return this._isReady}addVariant(t,i,n,r,o=!1){if(o||!this.getVariant(t,i)){this._isReady=!1;const a=new AJ(t,i,n,r);this._variants.push(a),a.isReady?this._checkReadiness():a.addEventListener("ready",this._checkReadiness)}else console.warn(`FontFamily('${this._name}')::addVariant() - Variant(${t}, ${i}) already exists.`);return this}addCustomImplementationVariant(t,i=!1){return i||!this.getVariant(t.weight,t.style)?(this._isReady=!1,this._variants.push(t),t.isReady?this._checkReadiness():t.addEventListener("ready",this._checkReadiness)):console.warn(`FontFamily('${this._name}')::addCustomImplementationVariant() - Variant(${t.weight}, ${t.style}) already exists.`),this}getVariant(t,i){return t=EB(t),this._variants.find(n=>n.weight===t&&n.style===i)}get name(){return this._name}}const xJ={type:"ready"};function wJ(s){s._isReady=!0,s.dispatchEvent(xJ)}const cw={},SJ=function(s){const e=[...arguments];e.forEach(i=>{if(!(i instanceof ZC))throw new Error(`FontLibrary::prepare() - One of the provided parameter is not a FontFamily. Instead ${typeof i} given.`)});const t=function(){return e.every(i=>i.isReady)};return new Promise((i,n)=>{if(t())i();else for(let r=0;r<e.length;r++){const o=e[r];o.isReady||o.addEventListener("ready",()=>{t()&&i()})}})},CJ=function(s){return cw[s]&&console.error(`FontLibrary::addFontFamily - Font('${s}') is already registered`),cw[s]=new ZC(s),cw[s]},EJ=function(s){return cw[s]},TJ=function(s){_G=s};let _G=function(s,e){return console.error(`The character '${e}' is not included in the font characters set.`)," "};function MJ(s,e){return _G(s,e)}const IJ={addFontFamily:CJ,getFontFamily:EJ,prepare:SJ,setMissingCharacterHandler:TJ,missingCharacter:MJ},Lp=IJ;class bG extends Dn{constructor(){super("fontFamily","inherit",!0)}computeOutputValue(e){if(this._input instanceof ZC)this._value=this._input;else if(this._input!=="inherit")if(typeof this._input=="string"){const t=Lp.getFontFamily(this._input);t?this._value=t:console.warn(`(.style) fontFamily, the font '${this._input}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}getInheritedInput(e){if(this._input!=="inherit")return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}}class xG extends Dn{constructor(){super("lineHeight","inherit",!0)}update(e,t){super.update(e,t),e._layouter._needsProcess=!0}}class wG extends Dn{constructor(){super("whiteSpace","inherit"),this.isValidValue=PJ}}const RJ=["normal","nowrap","pre","pre-line","pre-wrap"];function PJ(s){return RJ.indexOf(s)===-1?(console.warn(`(.style) whiteSpace value '${s}' is not valid. Aborted`),!1):!0}class SG extends Dn{constructor(){super("letterSpacing","inherit",!0)}}class BJ extends Dn{constructor(){super("fontSize","inherit",!0)}}class CG extends Qi{constructor(){super("segments",1,!1)}}class DJ extends Qp{constructor(){super("invertAlpha","inherit")}}class $C extends Dn{constructor(){super("fontKerning","inherit"),this.isValidValue=LJ}}const OJ=["normal","none","inherit"];function LJ(s){return OJ.indexOf(s)===-1?(console.warn(`(.style) fontKerning value '${s}' is not valid. Aborted`),!1):!0}class ex extends Qp{constructor(e){super(e,"inherit",!0)}}class fk extends Qp{constructor(e){super(e,"inherit",!1),this._mediation={},this._defaultMaterial=null}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"?this._notInheritedValue=this.getInheritedInput(e):this.propagate(e),this._notInheritedValue?this._notInheritedValue.constructor.mediation?this._mediation={...this._notInheritedValue.constructor.mediation}:this._mediation={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:JC},fontSide:{m:"side"},color:{m:"color"},fontOpacity:{m:"opacity"}}:this._mediation={},e._transferToFontMaterial(),this._outputValue(t)}getInheritedInput(e){if(this._value!=="inherit")return this._value;let t=e,i=null;for(;t._parent._value;)if(t=t._parent._value,t[`_${this._id}`]._value!=="inherit"){i=t[`_${this._id}`]._value;break}return i!==null?i:this.getDefaultValue()}getDefaultValue(){return this._defaultMaterial}}const kJ=function(s,e,t){s.traverse(i=>{i.renderOrder=t})};class o_ extends qe.Object3D{constructor(t,i){super();u(this,"_rebuildParentUI",()=>{this._parent._needsUpdate=!0,this.parent&&!this.parent.isUI?(iS.register(this),this.activatePseudoState("root")):(iS.remove(this),this.deactivatePseudoState("root"))});Object.defineProperties(this,{isUI:{configurable:!1,enumerable:!0,value:!0}}),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundCustomDepthMaterial=null,this._backgroundMaterialMediation={},this._backgroundMeshMediation={backgroundCastShadow:{m:"castShadow"},backgroundReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder",t:kJ}},this._fontMesh=null,this._fontMaterial=new fk("fontMaterial"),this._fontCustomDepthMaterial=new fk("fontCustomDepthMaterial"),this._fontMeshMediation={fontMaterial:{m:"material"},fontCustomDepthMaterial:{m:"customDepthMaterial",t:hK},fontCastShadow:{m:"castShadow"},fontReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder"}},this._children=t.children?new t.children:new Sh("children"),this._parent=new uK,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI),this._backgroundSide=new dk("backgroundSide"),this._fontSide=new dk("fontSide"),this._backgroundAlphaTest=new uk("backgroundAlphaTest",.02),this._fontAlphaTest=new uk("fontAlphaTest",.02),this._visible=new NK("visible",!0),this._backgroundCastShadow=new ex("backgroundCastShadow"),this._fontCastShadow=new ex("fontCastShadow"),this._backgroundReceiveShadow=new ex("backgroundReceiveShadow"),this._fontReceiveShadow=new ex("fontReceiveShadow"),this._renderOrder=new iK,this._segments=t.segments?new t.segments:new CG,this._bounds=t.bounds?new t.bounds:new Sh("bounds"),this._order=new YK,this._padding=new lK,this._margin=new cK,this._position=new fG,this._flexDirection=t.flexDirection?new t.flexDirection:new IB,this._justifyContent=t.justifyContent?new t.justifyContent:new RB,this._alignItems=t.alignItems?new t.alignItems:new TB,this._display=new bK("flex"),this._boxSizing=new SK("border-box"),this._width=new ZK,this._height=new $K,this._backgroundColor=t.backgroundColor?new t.backgroundColor:new dG,this._backgroundOpacity=new eT("backgroundOpacity",.5),this._backgroundImage=new MK,this._backgroundSize=new RK("cover"),this._color=t.color?new t.color:new c0("color","inherit"),this._fontOpacity=new eT("fontOpacity","inherit"),this._whiteSpace=t.whiteSpace?new t.whiteSpace:new wG,this._fontFamily=t.fontFamily?new t.fontFamily:new bG,this._fontStyle=t.fontStyle?new t.fontStyle:new gG("normal"),this._fontWeight=t.fontWeight?new t.fontWeight:new vG,this._fontSize=t.fontSize?new t.fontSize:new BJ,this._lineHeight=t.lineHeight?new t.lineHeight:new xG,this._fontKerning=t.fontKerning?new t.fontKerning:new $C,this._letterSpacing=t.letterSpacing?new t.letterSpacing:new SG,this._overflow=new DK("visible"),this._borderRadius=new FK(0),this._borderWidth=new UK(0),this._borderColor=new c0("borderColor",16711935),this._borderOpacity=new eT("borderOpacity",1),this._font=new yK,this._lineBreak=t.lineBreak?new t.lineBreak:new Sh("lineBreak"),this._textContent=t.textContent?new t.textContent:new mG,this._glyphs=t.glyphs?new t.glyphs:new Sh("glyphs"),this._inlines=t.inlines?new t.inlines:new Sh("inlines"),this._layouter=t.layouter?new t.layouter:new Sh("layouter"),this._inlineJustificator=new zK,this._textAlign=t.textAlign?new t.textAlign:new MB,this._autoSize=t.autoSize?new t.autoSize:new Sh("autoSize"),this._renderer=t.renderer?new t.renderer:new Sh("renderer"),this._offset=new nK,this._invertAlpha=new DJ,this._fontSmooth=t.fontSmooth?new t.fontSmooth:new sK,this._components=[this._textContent,this._children,this._parent,this._autoSize,this._fontFamily,this._fontStyle,this._fontWeight,this._font,this._whiteSpace,this._glyphs,this._inlines,this._visible,this._backgroundSide,this._fontSide,this._backgroundAlphaTest,this._fontAlphaTest,this._backgroundCastShadow,this._fontCastShadow,this._backgroundReceiveShadow,this._fontReceiveShadow,this._renderOrder,this._segments,this._padding,this._margin,this._width,this._height,this._borderWidth,this._boxSizing,this._bounds,this._position,this._flexDirection,this._justifyContent,this._alignItems,this._order,this._display,this._backgroundColor,this._backgroundOpacity,this._backgroundImage,this._backgroundSize,this._fontOpacity,this._color,this._fontSize,this._lineHeight,this._fontKerning,this._letterSpacing,this._borderRadius,this._borderColor,this._borderOpacity,this._lineBreak,this._offset,this._layouter,this._inlineJustificator,this._textAlign,this._invertAlpha,this._fontSmooth,this._fontMaterial,this._fontCustomDepthMaterial,this._overflow,this._renderer],this._onAfterUpdates=[],i.backgroundSide||(i.backgroundSide=0),i&&this.set(i)}update(){const t={};for(const i of this._components)i._needsUpdate&&(i.update(this,t),i._needsUpdate=!1);this._transferToBackgroundMesh(t),this._transferToFontMesh(t),this._transferToBackgroundMaterial(t),this._transferToFontMaterial(t);for(const i of this._children._uis)i.update()}process(){for(const t of this._children._uis)t.process();for(const t of this._components)t._needsProcess&&(t.process(this),t._needsProcess=!1)}render(){for(let t=0;t<this._components.length;t++){const i=this._components[t];i._needsRender&&(i.render(this),i._needsRender=!1)}for(const t of this._children._uis)t.render()}set(t){if(t.fontTexture&&(console.warn("ThreeMeshUI::set( {fontTexture} ) is deprecated. Please use fontLibrary to register font families and variants."),t.fontFamily)){const i=t.fontFamily.pages?t.fontFamily.info.face:t.fontFamily;let n=Lp.getFontFamily(i);if(!n){const r=t.fontStyle?t.fontStyle:"normal",o=t.fontWeight?t.fontWeight:"400";n=Lp.addFontFamily(i).addVariant(o,r,t.fontFamily,t.fontTexture)}t.fontFamily=n,delete t.fontTexture}for(let i of Object.keys(t)){const n=t[i];switch(i){case"contentDirection":console.warn("ThreeMeshUI v7xx: property `contentDirection` is deprecated and has been renamed as `flexDirection`"),i="flexDirection";break;case"interLine":console.warn("ThreeMeshUI v7xx: property `interLine` is deprecated and has been renamed as `lineHeight`"),i="lineHeight";break;case"content":console.warn("ThreeMeshUI v7xx: property `content` is deprecated and has been renamed as `textContent`"),i="textContent";break;case"fontColor":console.warn("ThreeMeshUI v7xx: property `fontColor` is deprecated and has been renamed as `color`"),i="color";break;case"hiddenOverflow":console.warn("ThreeMeshUI v7xx: property `hiddenOverflow` is deprecated and has been renamed as `overflow`"),i="overflow";break;case"backgroundTexture":console.warn("ThreeMeshUI v7xx: property `backgroundTexture` is deprecated and has been renamed as `backgroundImage`"),i="backgroundImage";break;case"alignContent":console.warn("ThreeMeshUI v7xx: property `alignContent` is deprecated and has been renamed as `alignItems`"),i="alignItems";break;case"borderTopColor":case"borderBottomColor":case"borderLeftColor":case"borderRightColor":i="borderColor";break}switch(i){case"fontSmooth":case"renderOrder":case"segments":case"visible":case"offset":this[`_${i}`].value=n;break;case"flexDirection":case"justifyContent":case"alignItems":case"color":case"fontFamily":case"fontOpacity":case"fontKerning":case"fontSize":case"fontStyle":case"fontWeight":case"textAlign":case"letterSpacing":case"lineHeight":case"whiteSpace":case"breakOn":case"width":case"height":case"padding":case"margin":case"backgroundColor":case"backgroundOpacity":case"backgroundImage":case"backgroundSize":case"borderColor":case"borderOpacity":case"borderRadius":case"borderWidth":case"overflow":case"order":case"boxSizing":this[`_${i}`]&&(this[`_${i}`].inline=n);break;case"paddingTop":this._padding.top=n;break;case"paddingRight":this._padding.right=n;break;case"paddingBottom":this._padding.bottom=n;break;case"paddingLeft":this._padding.left=n;break;case"marginTop":this._margin.top=n;break;case"marginRight":this._margin.right=n;break;case"marginBottom":this._margin.bottom=n;break;case"marginLeft":this._margin.left=n;break;case"borderTopWidth":this._borderWidth.top=n;break;case"borderRightWidth":this._borderWidth.right=n;break;case"borderBottomWidth":this._borderWidth.bottom=n;break;case"borderLeftWidth":this._borderWidth.left=n;break;case"borderTopLeftRadius":this._borderRadius.topLeft=n;break;case"borderTopRightRadius":this._borderRadius.topRight=n;break;case"borderBottomRightRadius":this._borderRadius.bottomRight=n;break;case"borderBottomLeftRadius":this._borderRadius.bottomLeft=n;break;case"side":case"castShadow":case"receiveShadow":const r=i.charAt(0).toUpperCase()+i.substr(1);this[`_background${r}`].value=n,this[`_font${r}`].value=n;break;case"fontSide":case"backgroundSide":case"fontCastShadow":case"backgroundCastShadow":case"fontReceiveShadow":case"backgroundReceiveShadow":case"fontMaterial":case"fontCustomDepthMaterial":this[`_${i}`].value=n;break;default:this[`_${i}`]!==void 0?this[`_${i}`].value=n:this[i]=n}}}get(t){switch(t){case"overflow":case"width":case"height":return this[`_${t}`].inline}}_rebuildChildrenLists(){this._children._needsUpdate=!0}add(t){let i=!1;for(let n=0;n<arguments.length;n++)super.add(arguments[n]),arguments[n].isUI&&(i=!0);return i&&this._rebuildChildrenLists(),this}remove(t){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);return super.remove(...arguments),this._rebuildChildrenLists(),this}clear(){return this.removeFromParent(),this.traverse(t=>{t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose()}),super.clear(),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundMaterialMediation=null,this._backgroundMeshMediation=null,this._children.dispose(),this._children=null,this._parent.dispose(),this._parent=null,this._backgroundSide=null,this._backgroundAlphaTest=null,this._visible=null,this._backgroundCastShadow=null,this._backgroundReceiveShadow=null,this._renderOrder=null,this._segments=null,this._bounds=null,this._boxSizing=null,this._padding=null,this._margin=null,this._position=null,this._flexDirection=null,this._justifyContent=null,this._alignItems=null,this._display=null,this._backgroundColor=null,this._backgroundOpacity=null,this._backgroundSize=null,this._fontOpacity=null,this._color=null,this._whiteSpace=null,this._fontFamily=null,this._fontStyle=null,this._fontWeight=null,this._lineHeight=null,this._fontKerning=null,this._letterSpacing=null,this._overflow=null,this._textAlign=null,this._font=null,this._lineBreak=null,this._layouter=null,this}get textContent(){return this._textContent.process(this),this._textContent._value}get backgroundMaterial(){return this._backgroundMaterial}set backgroundMaterial(t){this._backgroundMaterial=t,this._backgroundMaterialMediation={...t.constructor.mediation},this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.material=this._backgroundMaterial,ka(t,"frameSize",this._backgroundMesh.scale))}set backgroundCustomDepthMaterial(t){this._backgroundCustomDepthMaterial=t,this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial)}get backgroundCustomDepthMaterial(){return this._backgroundCustomDepthMaterial}_transferToBackgroundMaterial(t=null){if(!t){t={};for(const i of this._components)i.output(t)}Zb.mediate(this,this._backgroundMaterial,t,this._backgroundMaterialMediation,this._backgroundCustomDepthMaterial)}set backgroundSide(t){this._backgroundSide.value=t,this._backgroundMaterial&&(this._backgroundMaterial.side=t)}get backgroundSide(){return this._backgroundSide.value}set backgroundAlphaTest(t){this._backgroundAlphaTest.value=t,this._backgroundMaterial&&(this._backgroundMaterial.alphaTest=t)}get backgroundAlphaTest(){return this._backgroundAlphaTest.value}get fontMaterial(){return this._fontMaterial.value}set fontMaterial(t){this._fontMaterial.value=t}set fontCustomDepthMaterial(t){this._fontCustomDepthMaterial.value=t}get fontCustomDepthMaterial(){return this._fontCustomDepthMaterial.value}_transferToFontMaterial(t=null){const i=this._fontMaterial.value;if(i){if(!t){t={};for(const n of this._components)n.output(t)}Zb.mediate(this,i,t,this._fontMaterial._mediation,this._fontCustomDepthMaterial.value)}}set fontSide(t){this._fontSide.value=t}get fontSide(){return this._fontSide.value}set fontAlphaTest(t){this._fontAlphaTest.value=t}get fontAlphaTest(){return this._fontAlphaTest.value}_transferToBackgroundMesh(t=null){if(!t){t={};for(const i of this._components)i.output(t)}Zb.mediate(this,this._backgroundMesh,t,this._backgroundMeshMediation)}setBackgroundMesh(t){this._backgroundMesh&&(this.remove(this._backgroundMesh),this.unbindBackgroundMeshProperties()),this._backgroundMesh=t,this._backgroundMesh&&(this.bindBackgroundMeshProperties(),this._backgroundCustomDepthMaterial&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial),this._backgroundMaterial&&ka(this._backgroundMaterial,"frameSize",this._backgroundMesh.scale),this._transferToBackgroundMesh(),this.add(this._backgroundMesh))}bindBackgroundMeshProperties(){}unbindBackgroundMeshProperties(){}activatePseudoState(t){}deactivatePseudoState(t){}togglePseudoState(t){}hasPseudoState(t){return!1}set borderRadiusMediation(t){this._borderRadius.mediation=t}set backgroundCastShadow(t){this._backgroundCastShadow&&(this._backgroundCastShadow.value=t)}get backgroundCastShadow(){return this._backgroundCastShadow}set backgroundReceiveShadow(t){this._backgroundReceiveShadow&&(this._backgroundReceiveShadow.value=t)}get backgroundReceiveShadow(){return this._backgroundReceiveShadow}set renderOrder(t){this._renderOrder&&(this._renderOrder.value=t)}get renderOrder(){return this._renderOrder.value}_transferToFontMesh(t=null){if(this._fontMesh){if(!t){t={};for(const i of this._components)i.output(t)}Zb.mediate(this,this._fontMesh,t,this._fontMeshMediation)}}setFontMesh(t){this._fontMesh&&(this.remove(this._fontMesh),this._fontMesh.material&&this._fontMesh.material.dispose(),this._fontMesh.geometry&&this._fontMesh.geometry.dispose(),this._fontMesh=null,this.unbindFontMeshProperties()),this._fontMesh=t,this._fontMesh&&(this._fontMesh.raycast=()=>{},this.bindFontMeshProperties(),this._transferToFontMaterial(),this._transferToFontMesh(),this.add(this._fontMesh))}bindFontMeshProperties(){}unbindFontMeshProperties(){}set fontCastShadow(t){this._fontCastShadow&&(this._fontCastShadow.value=t)}get fontCastShadow(){return this._fontCastShadow}set fontReceiveShadow(t){this._fontReceiveShadow&&(this._fontReceiveShadow.value=t)}get fontReceiveShadow(){return this._fontReceiveShadow}set segments(t){this._segments.value=t}get segments(){return this._segments.value}set onAfterUpdate(t){console.warn("ThreeMeshUI v7xx : `onAfterUpdate()` property has been deprecated, please rely on `addAfterUpdate` instead."),this.addAfterUpdate(t)}addAfterUpdate(t){this._onAfterUpdates.push(t)}removeAfterUpdate(t){const i=this._onAfterUpdates.indexOf(t);i!==-1&&this._onAfterUpdates.splice(i,1)}performAfterUpdate(){for(let t=0;t<this._onAfterUpdates.length;t++)this._onAfterUpdates[t]()}getProperty(t){return this[`_${t}`]?this[`_${t}`]:null}appendProperty(t,i){this[`_${t}`]=i,this._components.push(i)}replaceProperty(t,i){const n=this[`_${t}`],r=this._components.indexOf(n);return this._components[r]=this[`_${t}`]=i,i.needsUpdate=!0,n}}class iS{static register(e){this.elements.includes(e)||this.elements.push(e)}static remove(e){const t=this.elements.indexOf(e);t!==-1&&this.elements.splice(t,1)}static update(){for(const e of this.elements)e.update(),e.process(),e.process(),e.render()}}iS.elements=[];const FJ=`

// FrameBorder vertex pars
attribute vec2 uvB;
varying vec2 vUvB;

`,UB=FJ,UJ=`

	// FrameBorder vertex shader
	vUvB = uvB;

`,NB=UJ,NJ=`

// borders sequences are : x:TOP, y:RIGHT, z:BOTTOM, w:LEFT
uniform vec4 borderWidth;
uniform vec3 borderColor;
uniform float borderOpacity;
uniform vec4 borderRadius;

uniform vec2 cornerTL;
uniform vec2 cornerTR;
uniform vec2 cornerBR;
uniform vec2 cornerBL;

varying vec2 vUvB;

float getEllipticFactor( vec2 uv, vec2 center, float radiusX, float radiusY )
{

		float edx = uv.x - center.x;
		float edy = uv.y - center.y;

		float ddx = (edx * edx) / (radiusX * radiusX);
		float ddy = (edy * edy) / (radiusY * radiusY);

		return ddx + ddy;

}

`,zB=NJ,zJ=`

vec4 borderColor = vec4( borderColor, borderOpacity );

// This could be tweak to produce more smoothing
float mult = 1.0;

// Step 1 ----------------------------------------------
// Draw the four borders ( top - right - bottom - left )
// Without worrying about radiuses ( Straight boorders )

// Top
float topBorderUVy = 1.0 - borderWidth.x;
if( borderWidth.x > 0.0 && vUvB.y > topBorderUVy )
{

	float w = fwidth( 1.0 - vUvB.y ) * mult;
	float step = smoothstep( topBorderUVy , topBorderUVy + w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Left
float leftBorderUVx = borderWidth.w;
if( borderWidth.w > 0.0 && vUvB.x < leftBorderUVx )
{

	float w = fwidth( vUvB.x ) * mult ;
	float step = smoothstep( leftBorderUVx , leftBorderUVx - w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Bottom
float bottomBorderUVy = borderWidth.z;
if( borderWidth.z > 0.0 && vUvB.y < bottomBorderUVy )
{
	float w = fwidth( vUvB.y ) * mult;
	float step = smoothstep( bottomBorderUVy , bottomBorderUVy - w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );
}

// Right
float rightBorderUVx = 1.0 - borderWidth.y;
if( borderWidth.y > 0.0 && vUvB.x > rightBorderUVx )
{
	float w = fwidth( 1.0 - vUvB.x ) * mult;
	float step = smoothstep( rightBorderUVx , rightBorderUVx + w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );
}


// Step 2 ----------------------------------------------
// Process each corners ( topLeft, topRight, bottomRight, bottomLeft )
// To transparentize outside radiuses
// To draw ellipse border on the corner


// Top Left corner
if( vUvB.x < cornerTL.x && vUvB.y > cornerTL.y ) {

		// Only draw border if width is set
		if( borderWidth.w + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x - borderWidth.w,  ( 1.0 - cornerTL.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		// Then then radius
		float radiusFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x, 1.0 - cornerTL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Left
if( vUvB.x < cornerBL.x && vUvB.y < cornerBL.y ) {

		if( borderWidth.w + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x - borderWidth.w,  cornerBL.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}


		float radiusFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x, cornerBL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Top Right
if( vUvB.x > cornerTR.x && vUvB.y > cornerTR.y ) {

		if( borderWidth.y + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTR, ( 1.0 - cornerTR.x ) - borderWidth.y,  ( 1.0 - cornerTR.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerTR, 1.0 - cornerTR.x, 1.0 - cornerTR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Right
if( vUvB.x > cornerBR.x && vUvB.y < cornerBR.y ) {

		if( borderWidth.y + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBR, ( 1.0 - cornerBR.x ) - borderWidth.y,  cornerBR.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerBR, 1.0 - cornerBR.x, cornerBR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}

`,GB=zJ,GJ=`

// To be removed - required for both border and background
uniform vec3 frameSize;
uniform vec2 textureSize;

`,HB=GJ,HJ=`

#ifdef USE_MAP

vec4 sampleTexture() {

	vec2 uv = vUv;

	// default stretch
	#if BACKGROUND_MAPPING != 0

	float textureRatio = textureSize.x / textureSize.y;
	float panelRatio = frameSize.x / frameSize.y;
	float ratio = panelRatio / textureRatio;
	float ratio2 = textureRatio / panelRatio;

		// contain
		#if BACKGROUND_MAPPING == 1
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		}
		#else
		// cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		}

		#endif

	#endif

	return texture2D( map, uv );

}
#endif
`,VB=HJ,VJ=`
#ifdef USE_MAP

	vec4 textureSample = sampleTexture();
	diffuseColor *= textureSample;

#endif
`,QB=VJ,EG={msdfAlphaglyphParsVertexGlsl:PB,msdfAlphaglyphVertexGlsl:BB,msdfOffsetglyphVertexGlsl:DB,msdfAlphaglyphParsFragmentGlsl:OB,msdfAlphaglyphFragmentGlsl:LB,frameBorderParsVertexGlsl:UB,frameBorderVertexGlsl:NB,frameCommonParsFragmentGlsl:HB,frameBorderParsFragmentGlsl:zB,frameBorderFragmentGlsl:GB,frameBackgroundParsFragmentGlsl:VB,frameBackgroundFragmentGlsl:QB},QJ=`
// Would be automatic on three materials and from USE_UV
#ifdef USE_MAP
varying vec2 vUv;
#endif

${UB}

#include <clipping_planes_pars_vertex>

void main() {

	#ifdef USE_MAP
	vUv = uv;
	#endif

	${NB}

	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,jJ=`

// Basic
uniform vec3 diffuse;
uniform float opacity;

#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

${HB}

${zB}


#ifdef USE_MAP
varying vec2 vUv;
uniform sampler2D map;
#endif

${VB}

#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );

	// map
	${QB}

	${GB}

	#ifdef USE_ALPHATEST

	if ( diffuseColor.a < alphaTest ) discard;

	#endif

	// output
	gl_FragColor = diffuseColor;


	#include <clipping_planes_fragment>
}
`;class nS{static get mediation(){return qJ}static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,t){e.userData.borderColor={value:null},e.userData.borderRadius={value:new qe.Vector4(0,0,0,0)},e.userData.cornerTL={value:new qe.Vector2(0,1)},e.userData.cornerTR={value:new qe.Vector2(1,1)},e.userData.cornerBR={value:new qe.Vector2(1,0)},e.userData.cornerBL={value:new qe.Vector2(0,0)},e.userData.borderWidth={value:new qe.Vector4(0,0,0,0)},e.userData.borderOpacity={value:null},e.userData.frameSize={value:new qe.Vector3(1,1,1)},e.userData.textureSize={value:new qe.Vector2(1,1)}}static bindUniformsWithUserData(e,t){e.uniforms.borderColor=t.userData.borderColor,e.uniforms.borderRadius=t.userData.borderRadius,e.uniforms.cornerTL=t.userData.cornerTL,e.uniforms.cornerTR=t.userData.cornerTR,e.uniforms.cornerBR=t.userData.cornerBR,e.uniforms.cornerBL=t.userData.cornerBL,e.uniforms.borderWidth=t.userData.borderWidth,e.uniforms.borderOpacity=t.userData.borderOpacity,e.uniforms.frameSize=t.userData.frameSize,e.uniforms.textureSize=t.userData.textureSize}static injectShaderChunks(e){nS.injectVertexShaderChunks(e),nS.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+UB),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+NB)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+VB),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+zB),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+HB),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",QB),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",GB+`
#include <alphamap_fragment>`)}}const WJ=function(s,e,t){t=["stretch","contain","cover"].indexOf(t),AG(s,"BACKGROUND_MAPPING",t)},qJ={clippingPlanes:{m:"clippingPlanes"},backgroundAlphaTest:{m:"alphaTest",t:JC},backgroundSide:{m:"side"},backgroundImage:{m:"map"},backgroundColor:{m:"color"},backgroundOpacity:{m:"opacity"},backgroundSize:{m:"computedBackgroundSize",t:WJ},borderWidth:{m:"borderWidth",t:ka},borderColor:{m:"borderColor",t:ka},cornerTL:{m:"cornerTL",t:ka},cornerTR:{m:"cornerTR",t:ka},cornerBR:{m:"cornerBR",t:ka},cornerBL:{m:"cornerBL",t:ka},borderOpacity:{m:"borderOpacity",t:ka},size:{m:"frameSize",t:ka},tSize:{m:"textureSize",t:ka}};class TG extends qe.ShaderMaterial{static get mediation(){return nS.mediation}constructor(){super({uniforms:{alphaTest:{value:.02},map:{value:null},diffuse:{value:new qe.Color(16777215)},opacity:{value:1},borderColor:{value:new qe.Color(0)},borderOpacity:{value:0},borderRadius:{value:new qe.Vector4(0,0,0,0)},cornerTL:{value:new qe.Vector2(0,1)},cornerTR:{value:new qe.Vector2(1,1)},cornerBR:{value:new qe.Vector2(1,0)},cornerBL:{value:new qe.Vector2(0,0)},borderWidth:{value:new qe.Vector4(0,0,0,0)},frameSize:{value:new qe.Vector3(1,1,1)},textureSize:{value:new qe.Vector2(1,1)}},side:qe.FrontSide,transparent:!0,clipping:!0,vertexShader:QJ,fragmentShader:jJ,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0}set map(e){this.uniforms.map.value=e,e?this.defines.USE_UV===void 0&&(this.defines.USE_UV="",this.needsUpdate=!0):this.defines.USE_UV!==void 0&&(delete this.defines.USE_UV,this.needsUpdate=!0),this.needsUpdate=!0}get map(){return this.uniforms.map.value}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}}class XJ extends Qi{constructor(){super("children",null,!1);u(this,"_sortOrder",(t,i)=>t._order._value<i._order._value?-1:t._order._value>i._order._value?1:this._uis.indexOf(t)<this._uis.indexOf(i)?-1:1);this._uis=[],this._boxes=[]}update(t,i){this._compute(t),t._layouter._needsUpdate=!0,t._renderOrder._needsUpdate=!0}process(t){this._compute(t),t._flexDirection._needsProcess=!0,t._layouter._needsProcess=!0,t._overflow._needsRender=!0}_compute(t){this._uis=t.children.filter(i=>i.visible&&i.isUI),this._boxes=this._uis.filter(i=>i.isBox).sort(this._sortOrder)}dispose(){this._uis=null,this._boxes=null}}class MG extends Qi{constructor(){super("bounds",null,!1),this._size=new qe.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0,this._centerX=.5,this._centerY=.5,this._needsProcess=!0}setReferenceWidth(e,t){const i=e._width,n=e._padding._value,r=e._borderWidth._value,o=e._margin._value,a=i._auto?1:i._value,l=t*a-(o.y+o.w);jI(l,this._offsetWidth)||(this._offsetWidth=l,this._innerWidth=this._offsetWidth-(n.y+n.w+r.y+r.w),this._centerX=tT(e),this._propagateWidth(e),this._triggerCascadingDependencies(e))}setReferenceHeight(e,t){const i=e._height,n=e._padding._value,r=e._borderWidth._value,o=e._margin._value,a=i._auto?1:i._value,l=t*a-(o.x+o.z);jI(l,this._offsetHeight)||(this._offsetHeight=l,this._innerHeight=this._offsetHeight-(n.x+n.z+r.x+r.z),this._centerY=iT(e),this._propagateHeight(e),this._triggerCascadingDependencies(e))}setChildrenWidth(e,t){const i=e._padding._value,n=e._borderWidth._value;this._innerWidth=t,this._offsetWidth=this._innerWidth+(i.y+i.w+n.y+n.w),this._centerX=tT(e),this._propagateWidth(e),this._triggerCascadingDependencies(e)}setChildrenHeight(e,t){const i=e._padding._value,n=e._borderWidth._value;this._innerHeight=t,this._offsetHeight=this._innerHeight+(i.x+i.z+n.x+n.z),this._centerY=iT(e),this._propagateHeight(e),this._triggerCascadingDependencies(e)}update(e,t){const i=e._padding._value,n=e._borderWidth._value,r=e._width;!r._auto&&!r._relative&&(e._boxSizing._value==="content-box"?(this._innerWidth=r._value,this._offsetWidth=this._innerWidth+i.y+i.w+n.y+n.w):(this._offsetWidth=r._value,this._innerWidth=this._offsetWidth-(i.y+i.w+n.y+n.w)),this._centerX=tT(e),this._needsProcess=!0,this._propagateWidth(e),this._triggerCascadingDependencies(e));const o=e._height;!o._auto&&!o._relative&&(e._boxSizing._value==="content-box"?(this._innerHeight=o._value,this._offsetHeight=this._innerHeight+i.x+i.z+n.x+n.z):(this._offsetHeight=o._value,this._innerHeight=this._offsetHeight-(i.x+i.z+n.x+n.z)),this._centerY=iT(e),this._needsProcess=!0,this._propagateHeight(e),this._triggerCascadingDependencies(e))}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight,e._backgroundMesh&&e._backgroundMesh.updateScale(),e._renderer._needsRender=!0}output(e){e.size=this._size}process(e){e._overflow._needsRender=!0}_computeChildrenSideWidth(e){return YJ(e)}_computeChildrenSideHeight(e){return KJ(e)}_propagateWidth(e){for(let t=0;t<e._children._boxes.length;t++){const i=e._children._boxes[t];i._width._relative&&i._bounds.setReferenceWidth(i,this._innerWidth)}}_propagateHeight(e){for(let t=0;t<e._children._boxes.length;t++){const i=e._children._boxes[t];i._height._relative&&i._bounds.setReferenceHeight(i,this._innerHeight)}}_triggerCascadingDependencies(e){e._parent._value&&(e._parent._value._autoSize._needsProcess=!0),e._flexDirection._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0,e._overflow._needsRender=!0}}function tT(s){const e=s._padding._value,t=s._borderWidth._value,i=e.w+t.w,n=e.y+t.y;return(i-n)/2}function iT(s){const e=s._padding._value,t=s._borderWidth._value,i=e.x+t.x;return(e.z+t.z-i)/2}function YJ(s){return s._children._boxes.reduce((e,t)=>{const i=t._margin._value,n=t._bounds._offsetWidth+i.y+i.w;return e+n},0)}function KJ(s){return s._children._boxes.reduce((e,t)=>{const i=t._margin._value,n=t._bounds._offsetHeight+i.x+i.z;return e+n},0)}class JJ extends TB{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._process=this.emptyStrategyLogic,this._childAlign=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"row":case"row-reverse":switch(this._process=nZ,this._value){case"start":this._childAlign=$J;break;case"end":this._childAlign=ZJ;break;default:this._childAlign=pk}break;case"column":case"column-reverse":switch(this._process=iZ,this._value){case"start":this._childAlign=tZ;break;case"end":this._childAlign=eZ;break;default:this._childAlign=pk}break}this._needsProcess=!0,e._autoSize._needsProcess=!0,e._flexDirection._needsProcess=!0,e._justifyContent._needsProcess=!0,this._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}process(e){this._process(e,this._childAlign);let t="center",i="center",n="center";const r=e._padding._value,o=e._borderWidth._value;e._flexDirection._value.indexOf("column")!==-1?this._value==="start"?t=i="left":this._value==="end"?t=i="right":t="centerX":this._value==="start"?t=n="top":this._value==="end"?t=n="bottom":t="centerY";let a=-(r.x-r.z)/2-(o.x-o.z)/2,l=-(r.y-r.w)/2-(o.y-o.w)/2;i==="left"?l=(r.w-r.y)/2+(o.w-o.y)/2:i==="right"&&(l=-(r.y-r.w)/2-(o.y-o.w)/2),n==="top"?a=-(r.x-r.z)/2-(o.x-o.z)/2:n==="bottom"&&(a=(r.z-r.x)/2+(o.z-o.x)/2),e._children._boxes.forEach(c=>{let h=0,d=0;t==="top"?d=-c._margin._value.x:t==="bottom"?d=c._margin._value.z:t==="left"?h=c._margin._value.w:t==="right"?h=-c._margin._value.y:t==="centerX"?h=(c._margin._value.w-c._margin._value.y)/2:t==="centerY"&&(d=(-c._margin._value.x+c._margin._value.z)/2),e._layouter._childrenPos[c.id].x+=l+h,e._layouter._childrenPos[c.id].y+=a+d})}}function pk(){return 0}function ZJ(s,e){return-e+s._bounds._offsetHeight/2}function $J(s,e){return e-s._bounds._offsetHeight/2}function eZ(s,e){return e-s._bounds._offsetWidth/2}function tZ(s,e){return-e+s._bounds._offsetWidth/2}function iZ(s,e){const t=s._bounds._innerWidth/2;s._children._boxes.forEach(i=>{s._layouter._childrenPos[i.id].x=e(i,t)})}function nZ(s,e){const t=s._bounds._innerHeight/2;s._children._boxes.forEach(i=>{s._layouter._childrenPos[i.id].y=e(i,t)})}class sZ extends IB{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._offset=0,this._reverse=1,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,this._value){case"row":this._process=rZ;break;case"row-reverse":this._process=oZ;break;case"column":this._process=aZ;break;case"column-reverse":this._process=lZ;break}e._justifyContent._needsUpdate||e._justifyContent.computeOutputValue(e),e._alignItems._needsUpdate||e._alignItems.computeOutputValue(e),this._needsProcess=!0}process(e){switch(this._value){case"row":this._offset=-e._bounds._innerWidth/2;break;case"row-reverse":this._offset=e._bounds._innerWidth/2;break;case"column":this._offset=e._bounds._innerHeight/2;break;case"column-reverse":this._offset=-e._bounds._innerHeight/2;break}this._reverse=-Math.sign(this._offset),this._reverse===0&&(this._reverse=1),this._process(e),e._justifyContent._needsProcess=!0,e._layouter._needsProcess=!0}}function rZ(s){let e=s._flexDirection._offset;const t=s._flexDirection._reverse,i=s._children._boxes;for(let n=0;n<i.length;n++){const r=i[n],o=r.id,a=r._bounds._offsetWidth;e+=r._margin._value.w*t;const l=s._layouter._childrenPos[o];l.x=e+a/2*t,l.y=0,e+=t*(a+r._margin._value.y)}}function oZ(s){let e=s._flexDirection._offset;const t=s._flexDirection._reverse,i=s._children._boxes;for(let n=0;n<i.length;n++){const r=i[n],o=r.id,a=r._bounds._offsetWidth;e+=r._margin._value.y*t;const l=s._layouter._childrenPos[o];l.x=e+a/2*t,l.y=0,e+=(a+r._margin._value.w)*t}}function aZ(s){let e=s._flexDirection._offset;const t=s._flexDirection._reverse,i=s._children._boxes;for(let n=0;n<i.length;n++){const r=i[n],o=r.id,a=r._bounds._offsetHeight;e+=r._margin._value.x*t;const l=s._layouter._childrenPos[o];l.x=0,l.y=e+a/2*t,e+=(a+r._margin._value.z)*t}}function lZ(s){let e=s._flexDirection._offset;const t=s._flexDirection._reverse,i=s._children._boxes;for(let n=0;n<i.length;n++){const r=i[n],o=r.id,a=r._bounds._offsetHeight;e+=r._margin._value.z*t;const l=s._layouter._childrenPos[o];l.x=0,l.y=e+a/2*t,e+=(a+r._margin._value.x)*t}}class cZ extends RB{constructor(e){super("justifyContent",e,!0),this._allowsInherit=!1,this._needsUpdate=!0,this._computeOffset=this.emptyStrategyLogic,this._computeMargin=this.emptyStrategyLogic,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"column-reverse":case"column":this._process=uZ.bind(this);break;case"row-reverse":case"row":this._process=hZ.bind(this);break}switch(this._value){case"end":this._computeOffset=pZ,this._computeMargin=nT;break;case"center":this._computeOffset=mZ,this._computeMargin=nT;break;case"start":this._computeOffset=tx,this._computeMargin=nT;break;case"space-between":this._computeOffset=tx,this._computeMargin=gZ;break;case"space-around":this._computeOffset=tx,this._computeMargin=yZ;break;case"space-evenly":this._computeOffset=tx,this._computeMargin=vZ;break}e._flexDirection._needsProcess=!0}process(e){this._process(e),e._alignItems._needsProcess=!0}}function hZ(s){const e=s._flexDirection._offset,{usedDirectionSpace:t,remainingSpace:i}=dZ(s),n=e*2-t*Math.sign(e),r=this._computeOffset(n),o=this._computeMargin(s,i,s._flexDirection._reverse);s._children._boxes.forEach((a,l)=>{s._layouter._childrenPos[a.id].x-=r-o[l]})}function uZ(s){const e=s._flexDirection._offset,{usedDirectionSpace:t,remainingSpace:i}=fZ(s),n=e*2-t*Math.sign(e),r=this._computeOffset(n),o=this._computeMargin(s,i,s._flexDirection._reverse);s._children._boxes.forEach((a,l)=>{s._layouter._childrenPos[a.id].y-=r-o[l]})}function dZ(s){const e=s._bounds._computeChildrenSideWidth(s);return{usedDirectionSpace:e,remainingSpace:s._bounds._innerWidth-e}}function fZ(s){const e=s._bounds._computeChildrenSideHeight(s);return{usedDirectionSpace:e,remainingSpace:s._bounds._innerHeight-e}}function tx(s){return 0}function pZ(s){return s}function mZ(s){return s/2}function nT(s,e=0,t=1){return Array(s._children._boxes.length).fill(0)}function gZ(s,e=0,t=1){const n=s._children._boxes.length,r=Array(n).fill(0);if(e>0&&n>1){const o=e/(n-1)*t;r[0]=0;for(let a=1;a<n;a++)r[a]=o*a}return r}function vZ(s,e=0,t=1){const n=s._children._boxes.length,r=Array(n).fill(0);if(e>0){const o=e/(n+1)*t;for(let a=0;a<n;a++)r[a]=o*(a+1)}return r}function yZ(s,e=0,t=1){const n=s._children._boxes.length,r=Array(n).fill(0);if(e>0){const o=e/n*t,a=o/2;r[0]=a;for(let l=1;l<n;l++)r[l]=a+o*l}return r}let sT;class IG extends qe.Mesh{constructor(e){const t=e.slice,i={};let n=1,r=1;if(t){if(n=t.width?t.width:1,r=t.height?t.height:1,t.top){if(t.left){const f=new qe.PlaneGeometry(t.left*n,t.top*r,1,1);yh(f,0,t.left,1-t.top,1),f.translate(t.left*n/2,-t.top*r/2,0),i.topLeft=f}const d=new qe.PlaneGeometry(1,t.top*r,1,1);if(yh(d,t.left,1-t.right,1-t.top,1),d.translate(0,-t.top*r/2,0),i.top=d,t.right){const f=new qe.PlaneGeometry(t.right*n,t.top*r,1,1);yh(f,1-t.right,1,1-t.top,1),f.translate(-t.right*n/2,-t.top*r/2,0),i.topRight=f}}if(t.left){const d=new qe.PlaneGeometry(t.left*n,1,1,1);yh(d,0,t.left,t.bottom,1-t.top),d.translate(t.left*n/2,0,0),i.left=d}const h=new qe.PlaneGeometry(1,1,1,1);if(yh(h,t.left,1-t.right,t.bottom,1-t.top),i.middle=h,t.right){const d=new qe.PlaneGeometry(t.right*n,1,1,1);yh(d,1-t.right,1,t.bottom,1-t.top),d.translate(-t.right*n/2,0,0),i.right=d}if(t.bottom){if(t.left){const f=new qe.PlaneGeometry(t.left*n,t.bottom*r,1,1);yh(f,0,t.left,0,t.bottom),f.translate(t.left*n/2,t.bottom*r/2,0),i.bottomLeft=f}const d=new qe.PlaneGeometry(1,t.bottom*r,1,1);if(yh(d,t.left,1-t.right,0,t.bottom),d.translate(0,t.bottom*r/2,0),i.bottom=d,t.right){const f=new qe.PlaneGeometry(t.right*n,t.bottom*r,1,1);yh(f,1-t.right,1,0,t.bottom),f.translate(-t.right*n/2,t.bottom*r/2,0),i.bottomRight=f}}}let o=e.backgroundMaterial;t&&(sT||(sT=new qe.MeshBasicMaterial({alphaTest:1.1})),o=sT);const a=new qe.PlaneGeometry(1,1,e._segments.value,e._segments.value),l=new qe.BufferAttribute(new Float32Array(a.getAttribute("uv").array),2);if(a.setAttribute("uvB",l).name="uvB",super(a,o),this.name="UIBackgroundBox",t){this.slice=t,this.sliceSize=new qe.Vector3(1-(t.left+t.right),1-(t.bottom+t.top),1),this.sliceScale=new qe.Vector3(n,r,1);for(const c in i){const h=new qe.Mesh(i[c],e.backgroundMaterial);this.add(h),i[c]=h}this.updateScale=this.updateScaleSlice,this.slices=i}}updateScale(){}updateScaleSlice(){const e=new qe.Vector3(1,1,1);this.scale.x<(this.slice.left+this.slice.right)*this.sliceScale.x&&(e.x=this.scale.x/((this.slice.left+this.slice.right)*this.sliceScale.x)),this.scale.y<(this.slice.bottom+this.slice.top)*this.sliceScale.y&&(e.y=this.scale.y/((this.slice.bottom+this.slice.top)*this.sliceScale.y));for(const t in this.slices){const i=this.slices[t];i.scale.set(1/this.scale.x,1/this.scale.y,this.scale.y);const n=AZ[t];for(const o in n)i.position[o]=this.scale[o]*n[o]*i.scale[o];const r=_Z[t];if(r){r.x&&(i.position.x=this.sliceScale.x*.5*(this.slice.left-this.slice.right)*(1/this.scale.x)),r.y&&(i.position.y=this.sliceScale.y*.5*(this.slice.bottom-this.slice.top)*(1/this.scale.y));for(const o in r){const a=this.scale[o]-(1-this.sliceSize[o])*this.sliceScale[o];i.scale[o]=Math.max(0,a*(1/this.scale[o]))}}}e.x!==1&&(this.slices.left.scale.x*=e.x,this.slices.topLeft.scale.x*=e.x,this.slices.bottomLeft.scale.x*=e.x,this.slices.right.scale.x*=e.x,this.slices.topRight.scale.x*=e.x,this.slices.bottomRight.scale.x*=e.x),e.y!==1&&(this.slices.top.scale.y*=e.y,this.slices.topLeft.scale.y*=e.y,this.slices.topRight.scale.y*=e.y,this.slices.bottom.scale.y*=e.y,this.slices.bottomLeft.scale.y*=e.y,this.slices.bottomRight.scale.y*=e.y)}}const AZ={topLeft:{x:-.5,y:.5},top:{y:.5},topRight:{x:.5,y:.5},left:{x:-.5},right:{x:.5},bottomLeft:{x:-.5,y:-.5},bottom:{y:-.5},bottomRight:{x:.5,y:-.5}},_Z={top:{x:1},left:{y:1},right:{y:1},bottom:{x:1},middle:{x:1,y:1}};function yh(s,e,t,i,n){const r=t-e,o=n-i,a=s.attributes.uv;for(let c=0;c<a.count;c++){const h=a.getX(c),d=a.getY(c);a.setXY(c,e+h*r,i+d*o)}const l=new qe.BufferAttribute(new Float32Array(s.getAttribute("uv").array),2);s.setAttribute("uvB",l).name="uvB"}class RG extends Qi{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new IG(e)),e.performAfterUpdate()}}class bZ extends fG{constructor(){super("position")}update(e,t){super.update(e,t),this._needsProcess=!0}}class xZ extends Qi{constructor(){super("autosize"),this._needsProcess=!0}process(e){e._width._auto&&wZ(e),e._height._auto&&SZ(e);const t=e._alignItems._value==="stretch",i=t&&e._flexDirection._value.indexOf("column")!==-1,n=t&&!i;for(const r of e._children._boxes)(r._width._auto&&i||r._width._relative)&&r._bounds.setReferenceWidth(r,e._bounds._innerWidth),(r._height._auto&&n||r._height._relative)&&r._bounds.setReferenceHeight(r,e._bounds._innerHeight)}}function wZ(s){s._bounds.setChildrenWidth(s,EZ(s))}function SZ(s){s._bounds.setChildrenHeight(s,CZ(s))}function CZ(s){switch(s._flexDirection._value){case"row":case"row-reverse":return RZ(s);case"column":case"column-reverse":return MZ(s)}}function EZ(s){switch(s._flexDirection._value){case"row":case"row-reverse":return TZ(s);case"column":case"column-reverse":return IZ(s)}}function TZ(s){let e=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,n=t._bounds._offsetWidth+i.y+i.w;e+=n}return e}function MZ(s){let e=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,n=t._bounds._offsetHeight+i.x+i.z;e+=n}return e}function IZ(s){let e=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,n=t._bounds._offsetWidth+i.y+i.w;n>e&&(e=n)}return e}function RZ(s){let e=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,n=t._bounds._offsetHeight+i.x+i.z;n>e&&(e=n)}return e}class h0 extends o_{constructor(e,t){h0.definePropertiesValues(e,t),super(e,t),h0.init(this)}bindBackgroundMeshProperties(){this._bounds._size=this._backgroundMesh.scale,this._bounds._needsProcess=!0}unbindBackgroundMeshProperties(){this._bounds._size=new qe.Vector3(1,1,1),this._bounds._needsProcess=!0}static definePropertiesValues(e,t){e.children||(e.children=XJ),e.bounds||(e.bounds=MG),e.flexDirection||(e.flexDirection=sZ),e.justifyContent||(e.justifyContent=cZ),e.alignItems||(e.alignItems=JJ),e.position||(e.position=bZ),e.autoSize||(e.autoSize=xZ),e.renderer||(e.renderer=RG),t.fontSide||(t.fontSide=0),t.invertAlpha||(t.invertAlpha=!1),t.fontCastShadow||(t.fontCastShadow=!1),t.fontReceiveShadow||(t.fontReceiveShadow=!1),t.backgroundCastShadow||(t.backgroundCastShadow=!1),t.backgroundReceiveShadow||(t.backgroundReceiveShadow=!1)}static init(e){Object.defineProperties(e,{isBox:{configurable:!1,enumerable:!0,value:!0}}),e.backgroundMaterial=new TG,e._renderer.render(e),e._backgroundMesh.visible=!1}}class mk extends Array{constructor(...e){super(...e),this.width=0,this.lineBase=0,this.lineHeight=0,this.y=0}}class PZ extends Qi{constructor(){super("layouter",null,!1),this._needsUpdate=!0,this._childrenPos={}}update(e,t){this._childrenPos={};for(const i of e._children._boxes)i._position._value==="static"&&(this._childrenPos[i.id]=i.position)}process(e){}}class u0 extends h0{constructor(e={}){const t={};u0.definePropertiesValues(t,e),super(t,e),u0.init(this)}add(e){const t=[];for(let i=0;i<arguments.length;i++){const n=arguments[i];!n.isUI||n.isBox?t.push(n):console.warn("Block element can only contain Box elements.",n)}return super.add(...t)}static definePropertiesValues(e,t){e.layouter=PZ}static init(e){Object.defineProperties(e,{isBlock:{configurable:!1,enumerable:!0,value:!0}})}}class BZ extends Qi{constructor(){super("textContent",null,!1)}update(e,t){e._glyphs._needsUpdate=!0,e._whiteSpace._needsProcess=!0}}class DZ extends Qi{constructor(){super("inlines",null,!1),this._value=null}process(e){if(this._value=e._glyphs._value.map(t=>t.asInlineGlyph()),this._value.length){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const t=this._value.length-1;this._value[t].paddingRight=e._padding._value.y,this._value[t].marginRight=e._margin._value.y}e._fontSize._needsProcess=!0,e._lineBreak._needsProcess=!0,e._fontKerning._needsProcess=!0,e._layouter._needsProcess=!0}get value(){return this._value}}class OZ extends Qi{constructor(){super("glyphs",null,!1),this._needsUpdate=!1,this._value=null}process(e){e._font._fontVariant&&e._font._fontVariant.isReady&&(this._value=e._whiteSpace._whiteSpacedContent.split("").map(t=>e._font._fontVariant.getTypographicGlyph(t)),this._value&&(e._inlines._needsProcess=!0))}get value(){return this._value}}class LZ extends c0{constructor(){super("color","inherit",!1),this.output=this._outputValue}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class PG extends Qi{constructor(e=`- ,.:?!
`){super("lineBreak",e,!0),this._newLineBreakability=null}update(e,t){this._needsProcess=!0}process(e){const t=e._whiteSpace._newLineBreakability;if(e._inlines._value)for(let i=0;i<e._inlines._value.length;i++){const n=e._inlines._value[i],r=n.char;let o=null;r!==void 0&&(t!=="nowrap"&&(this._value.includes(r)||r.match(/\s/g))&&(o="possible"),r.match(/\n/g)&&(o=t)),n.lineBreak=o}}get value(){return this._value}}class BG extends Qi{constructor(){super("layouter",null,!1),this._value=null}update(e,t){this._value=e._parent.find(i=>i.isUI&&i.isText),this._needsProcess=!0}process(e){this._value&&(this._value._layouter._needsProcess=!0)}}class kZ extends c0{constructor(e){super("backgroundColor",e,!1),this._allowsInherit=!1,this._input=0}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class DG extends gG{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class OG extends vG{constructor(){super()}computeOutputValue(e){this._value=EB(this.getInheritedInput(e))}}class LG extends bG{constructor(){super("fontFamily","inherit",!0),this._input="inherit",this._needsUpdate=!0,this._allowsInherit=!1}computeOutputValue(e){let t=this._inheritedInput;if(t==="inherit"&&(t=this.getInheritedInput(e)),t instanceof ZC)this._value=t,e._font._needsUpdate=!0;else if(typeof t=="string"){const i=Lp.getFontFamily(t);i?(this._value=i,e._font._needsUpdate=!0):console.warn(`(.style) fontFamily, the font '${t}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}}class jB extends wG{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited,this._whiteSpacedContent="",this._stringCollapser=this.emptyStrategyLogic,this._inlineCollapser=this.emptyStrategyLogic,this._inlineWrapper=this.emptyStrategyLogic}_computeFromInherited(e){switch(super._computeFromInherited(e),this._newLineBreakability=FZ(this._value),this._value){case"nowrap":case"normal":this._stringCollapser=UZ;break;case"pre-line":this._stringCollapser=kG;break;default:this._stringCollapser=NZ}switch(this._value){case"pre-line":case"nowrap":case"normal":this._inlineCollapser=QZ;break;case"pre-wrap":this._inlineCollapser=VZ;break;default:this._inlineCollapser=jZ}switch(this._value){case"pre-line":case"pre-wrap":case"normal":this._inlineWrapper=zZ;break;case"pre":this._inlineWrapper=GZ;break;default:this._inlineWrapper=HZ}this._needsProcess=!0}process(e){e.isInline&&!e.isInlineBlock&&(this._whiteSpacedContent=this._stringCollapser(e._textContent._value),e._glyphs._needsProcess=!0)}}const gk={"	":"	","\n":`
`,"\r":"\r"," ":" "},FZ=function(s){switch(s){case"pre":case"pre-wrap":case"pre-line":return"mandatory"}return null};function UZ(s){return kG(s.replace(/\n/g," "))}function kG(s){return s.replace(/[ ]{2,}/g," ")}function NZ(s){return s}function zZ(s,e,t,i){const n=s[e];if(n.lineBreak==="mandatory"||t+n.xadvance+n.xoffset+n.kerning>i.INNER_WIDTH)return!0;const r=NG(s,e,i);return WZ(s[e-1],t,r,i)}function GZ(s,e,t,i){return s[e].lineBreak==="mandatory"}function HZ(){return!1}function VZ(s){if(!s[0])return 0;const e=s[0],t=s[s.length-1];return e.char&&e.char===`
`&&s.length>1&&UG([e],s[1]),t.char&&t.char===`
`&&s.length>1&&FG([t],s[s.length-2]),e.offsetX}function QZ(s){if(!s[0])return 0;let e=[],t;for(let i=0;i<s.length;i++){const n=s[i];if(n.char&&gk[n.char]&&s.length>i){e.push(n),t=s[i+1];continue}break}UG(e,t),e=[],t=null;for(let i=s.length-1;i>0;i--){const n=s[i];if(n.char&&gk[n.char]&&i>0){e.push(n),t=s[i-1];continue}break}return FG(e,t),s[0].offsetX}function jZ(s){return s[0]?s[0].offsetX:0}function FG(s,e){if(e)for(let t=0;t<s.length;t++){const i=s[t];i.fontFactor=0,i.offsetX=e.offsetX+e.cumulativeWidth,i.cumulativeWidth=0}}function UG(s,e){if(e)for(let t=0;t<s.length;t++){const i=s[t];i.fontFactor=0,i.offsetX=e.offsetX,i.cumulativeWidth=0}}function NG(s,e,t,i){if(i=i||0,!s[e])return i;const n=s[e];return n.lineBreak?i+n.xadvance:NG(s,e+1,t,i+n.xadvance+n.xoffset+n.kerning+t.LETTERSPACING)}function WZ(s,e,t,i){return!s||!s.char||e+t<i.INNER_WIDTH?!1:i.BREAKON.indexOf(s.char)>-1}class zG extends SG{constructor(){super(),this._input="inherit",this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}}class GG extends Dn{constructor(){super("fontSize","inherit",!0),this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._font._fontVariant&&(e._bounds._needsProcess=!0,e._layouter._needsProcess=!0)}process(e){if(!e._font._fontVariant||!e._font._fontVariant.isReady)return;const t=this._value/e._font._fontVariant.typographic.size,i=e._inlines._value;for(let n=0;n<i.length;n++){const r=i[n];r.resetOffsets(),r.fontSize=this._value,r.fontFactor=t}}get value(){return this._value}}class HG extends CG{constructor(){super("segments",1,!1),this._notInheritedValue=void 0}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),e._layouter._needsUpdate=!0}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class qZ extends HG{constructor(){super(),this._value="inherit"}}class XZ extends $C{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value._layouter._needsProcess=!1}process(e){if(this._value!=="none"){const t=e._whiteSpace._whiteSpacedContent,i=e._inlines._value;for(let n=1;n<i.length;n++){const r=t[n-1]+t[n];i[n].kerning=e._font._fontVariant.getKerningAmount(r)}}}}class VG extends Qi{constructor(){super("children",null,!1),this._uis=[]}update(e,t){}process(e){}_compute(e){}dispose(){}}function YZ(s,e=!1){const t=s[0].index!==null,i=new Set(Object.keys(s[0].attributes)),n=new Set(Object.keys(s[0].morphAttributes)),r={},o={},a=s[0].morphTargetsRelative,l=new qe.BufferGeometry;let c=0;for(let h=0;h<s.length;++h){const d=s[h];let f=0;if(t!==(d.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const p in d.attributes){if(!i.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;r[p]===void 0&&(r[p]=[]),r[p].push(d.attributes[p]),f++}if(f!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(a!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const p in d.morphAttributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;o[p]===void 0&&(o[p]=[]),o[p].push(d.morphAttributes[p])}if(e){let p;if(t)p=d.index.count;else if(d.attributes.position!==void 0)p=d.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,p,h),c+=p}}if(t){let h=0;const d=[];for(let f=0;f<s.length;++f){const p=s[f].index;for(let m=0;m<p.count;++m)d.push(p.getX(m)+h);h+=s[f].attributes.position.count}l.setIndex(d)}for(const h in r){const d=vk(r[h]);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+h+" attribute."),null;l.setAttribute(h,d)}for(const h in o){const d=o[h][0].length;if(d===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[h]=[];for(let f=0;f<d;++f){const p=[];for(let v=0;v<o[h].length;++v)p.push(o[h][v][f]);const m=vk(p);if(!m)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+h+" morphAttribute."),null;l.morphAttributes[h].push(m)}}return l}function vk(s){let e,t,i,n=-1,r=0;for(let c=0;c<s.length;++c){const h=s[c];if(e===void 0&&(e=h.array.constructor),e!==h.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=h.itemSize),t!==h.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=h.normalized),i!==h.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(n===-1&&(n=h.gpuType),n!==h.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;r+=h.count*t}const o=new e(r),a=new qe.BufferAttribute(o,t,i);let l=0;for(let c=0;c<s.length;++c){const h=s[c];if(h.isInterleavedBufferAttribute){const d=l/t;for(let f=0,p=h.count;f<p;f++)for(let m=0;m<t;m++){const v=h.getComponent(f,m);a.setComponent(f+d,m,v)}}else o.set(h.array,l);l+=h.count*t}return n!==void 0&&(a.gpuType=n),a}class KZ extends Qi{constructor(){super("renderer")}render(e){if(!e._inlines._value||!e._inlines._value.length)return;const t=e._inlines._value.map(n=>e._font._fontVariant.getGeometricGlyph(n,e).translate(n.offsetX,n.offsetY,0)),i=YZ(t);e.setFontMesh(new qe.Mesh(i,e.fontMaterial)),e._fontMesh.renderOrder=1/0}}class JZ extends MB{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!1}computeOutputValue(e){this._value=this._inheritedInput,e._layouter._needsProcess=!0}}class Yg extends o_{constructor(t={}){const i={};Yg.definePropertiesValues(i,t);super(i,t);u(this,"_rebuildParentUI",()=>{super._rebuildParentUI(),this._layouter._needsUpdate=!0});Yg.init(this)}add(t){const i=[];for(let n=0;n<arguments.length;n++){const r=arguments[n];!r.isUI||r.isInline?(i.push(r),r.position.z=.005):console.warn("Block element can only contain Box elements.",r)}return super.add(...i)}set textContent(t){this._textContent.value=t}get textContent(){return this._textContent._value}set invertAlpha(t){this._invertAlpha.value=t}get invertAlpha(){return this._invertAlpha._value}static definePropertiesValues(t,i){t.children||(t.children=VG),t.textContent||(t.textContent=BZ),t.glyphs||(t.glyphs=OZ),t.inlines||(t.inlines=DZ),t.layouter||(t.layouter=BG),t.renderer||(t.renderer=KZ),t.fontFamily||(t.fontFamily=LG),t.fontWeight||(t.fontWeight=OG),t.fontStyle||(t.fontStyle=DG),t.fontSize||(t.fontSize=GG),t.color||(t.color=LZ),t.backgroundColor||(t.backgroundColor=kZ),t.lineBreak||(t.lineBreak=PG),t.letterSpacing||(t.letterSpacing=zG),t.whiteSpace||(t.whiteSpace=jB),t.segments||(t.segments=qZ),t.textAlign||(t.textAlign=JZ),t.fontKerning||(t.fontKerning=XZ)}static init(t){Object.defineProperties(t,{isInline:{configurable:!1,enumerable:!0,value:!0}})}}class ZZ extends mG{constructor(){super("textContent",null,!1),this._needsUpdate=!1}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,t){this._needsUpdate=!1;for(let i=e.children.length-1;i>=0;i--){const n=e.children[i];n.isUI&&(e.remove(n),n.clear())}e._children._uis=[],this._value&&e.add(new Yg({name:"anonymousInline",textContent:this._value}))}}class $Z extends Array{constructor(...e){super(...e),this.width=0,this.height=0}}class e$ extends Qi{constructor(){super("layouter",null,!1),this._value=null}update(e,t){}process(e){let t=e._width._value;e._width._auto?t=1/0:t=e._bounds._innerWidth;const i=e._lineHeight._value,n=new $Z(new mk);let r=0;e._children._inlines.forEach(d=>{if(!d._inlines.value)return;this._resetInlines(d);const f=d._fontSize._value,p=d._letterSpacing._value*f,m=d._whiteSpace._value,v=d._lineBreak._value,y={WHITESPACE:m,LETTERSPACING:p,BREAKON:v,INNER_WIDTH:t},g=d._whiteSpace._inlineWrapper;r+=d._margin._value.w+d._padding._value.w,d._inlines.value.forEach((_,A,b)=>{const E=n[n.length-1];if(g(b,A,r,y)){if(n.push(new mk(_)),_.offsetX=_.xoffset,_.width===0){r=0;return}_.cumulativeWidth=_.xadvance+p,r=_.cumulativeWidth;return}n[n.length-1].push(_),_.offsetX=r+_.xoffset+_.kerning,_.cumulativeWidth=_.xadvance+_.kerning+p,r+=_.cumulativeWidth,E.length-1===1&&E[E.length-2].width===0&&(_.offsetX-=_.xoffset,r-=_.xoffset)}),r+=d._margin._value.y+d._padding._value.y});const o=e._whiteSpace._inlineCollapser;let a=0,l=0,c=0;n.forEach((d,f)=>{const p=o(d);let m=0,v=0;if(d.forEach(y=>{m=Math.max(m,y.lineHeight),v=Math.max(v,y.lineBase),y.offsetX-=p}),d.lineHeight=m,d.lineBase=v,f===0?c=-(m*i-m)*.5:c-=n[f-1].lineHeight*i,d.y=c,d.x=0,d.forEach(y=>{y.offsetY=c-y.anchor,y.lineHeight<d.lineHeight&&(y.offsetY-=d.lineBase-y.lineBase)}),l+=d.lineHeight*i,d.width=0,d[0]){const y=d[d.length-1];d.width=y.offsetX+y.cumulativeWidth+y.paddingRight+y.marginRight+d[0].offsetX,a=Math.max(a,d.width)}}),n.height=l,n.width=a,this._value=n,t===1/0&&e._bounds.setChildrenWidth(e,n.width),e._height._auto&&e._bounds.setChildrenHeight(e,n.height);const h=e._parent._value;h&&(h._autoSize._needsProcess=!0,h._flexDirection._needsProcess=!0),e._inlineJustificator._needsProcess=!0,e._textAlign._needsProcess=!0,e._overflow._needsUpdate=!0}_resetInlines(e){e._fontSize.process(e)}}class t$ extends MB{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput,this._needsProcess=!0}process(e){i$(e),e._renderer._needsRender=!0}}function i$(s){const e=s._layouter._value,t=s._textAlign._value,i=s._bounds._innerWidth;for(let n=0;n<e.length;n++){const r=e[n],o=n$(s,r,n===e.length-1),a=s._padding._value,l=s._borderWidth._value,c=(-a.w+a.y)/2+(-l.w+l.y)/2;r.x+=o;for(let h=0;h<r.length;h++)r[h].offsetX+=o-c}if(t.indexOf("justify")===0)for(let n=0;n<e.length;n++){const r=e[n];if(t.indexOf("-")!==-1&&n===e.length-1)return;const o=i-r.width;if(o<=0)return;let a=0;for(let d=1;d<r.length-1;d++)a+=r[d].char===" "?1:0;const l=o/a;let c=1;t==="justify-right"&&(r.reverse(),c=-1);let h=0;for(let d=1;d<=r.length-1;d++){const f=r[d];f.offsetX+=h*c,h+=f.char===" "?l:0}t==="justify-right"&&r.reverse()}}function n$(s,e,t){switch(s._textAlign._value){case"justify-left":case"justify":case"left":return-s._bounds._innerWidth/2;case"justify-right":case"right":return-e.width+s._bounds._innerWidth/2;case"center":return-e.width/2;case"justify-center":return t?-e.width/2:-s._bounds._innerWidth/2;default:console.warn(`textAlign: '${s._textAlign._value}' is not valid`)}}class s$ extends IB{constructor(){super(),this._value=this._input="column",this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput}}class r$ extends xG{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class o$ extends $C{constructor(){super(),this._value=this._input=this.getDefaultValue(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e)}}class a$ extends MG{constructor(){super(),this._innerWidth=1/0,this._innerHeight=0}}class l$ extends Qi{constructor(){super("children",null,!1);u(this,"_sortOrder",(t,i)=>t._order._value<i._order._value?-1:t._order._value>i._order._value?1:this._uis.indexOf(t)<this._uis.indexOf(i)?-1:1);this._uis=[],this._inlines=[],this._boxes=[]}update(t,i){this._compute(t),this._needsProcess=!0}process(t){this._compute(t),t._overflow._needsRender=!0}_compute(t){this._uis=t.children.filter(i=>i.visible&&i.isUI),this._inlines=this._uis.filter(i=>i.isInline).sort(this._sortOrder)}dispose(){this._inlines=null}}class c$ extends Qi{constructor(){super("autosize")}process(e){if(e._layouter._value&&e._layouter._value.length){const t=e._layouter._value,i=e._padding._value,n=e._borderWidth._value;e._width._auto&&e._bounds.setOffsetWidth(e,t.width+i.w+i.y+n.w+n.y),e._height._auto&&e._bounds.setOffsetHeight(e,t.height+i.x+i.z+n.x+n.z)}}}class h$ extends RG{constructor(){super("renderer"),this._needsUpdate=!1}render(e){super.render(e);for(const t of e._children._inlines)t._renderer.render(t);e.performAfterUpdate()}}class d0 extends h0{constructor(e={},t={}){d0.definePropertiesValues(t,e),super(t,e),d0.init(this)}add(e){const t=[];let i=!1;for(let n=0;n<arguments.length;n++){const r=arguments[n];!r.isUI||r.isInline?(r.isInline&&(i=!0),t.push(r)):console.warn("Block element can only contain Box elements.",r)}return t.length>0&&super.add(...t),i&&(this._children._needsUpdate=!0,this._layouter._needsProcess=!0),this}set textContent(e){this._textContent.value=e}get textContent(){return super.textContent}set invertAlpha(e){this._invertAlpha.value=e}get invertAlpha(){return this._invertAlpha._value}get lines(){return this._layouter._value}static definePropertiesValues(e,t){e.flexDirection=s$,e.justifyContent=RB,e.alignItems=TB,e.bounds=a$,e.autoSize=c$,e.renderer=h$,e.children||(e.children=l$),e.textContent||(e.textContent=ZZ),e.layouter||(e.layouter=e$),e.lineHeight||(e.lineHeight=r$),e.textAlign||(e.textAlign=t$),e.whiteSpace||(e.whiteSpace=jB),e.fontKerning||(e.fontKerning=o$),e.segments||(e.segments=HG),t.width||(t.width="100%"),t.fontSide||(t.fontSide=0)}static init(e){Object.defineProperties(e,{isText:{configurable:!1,enumerable:!0,value:!0}})}}class u$ extends Qi{constructor(){super("inlines",null,!1),this._value=[]}process(e){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const t=this._value.length-1;this._value[t].paddingRight=e._padding._value.y,this._value[t].marginRight=e._margin._value.y}}class d$ extends Qi{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new IG(e)),e._backgroundMesh.position.x=e._inlines._value[0].offsetX+e._inlines._value[0].width/2,e._backgroundMesh.position.y=e._inlines._value[0].offsetY+e._inlines._value[0].lineBase/2,e._bounds.render(e)}}class f$ extends Qi{constructor(){super("bounds",null,!1),this._size=new qe.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0}update(e,t){this.output(t),this._needsProcess=!0}process(e){this._offsetWidth=this._innerWidth=e._inlines._value[0].width,this._offsetHeight=this._innerHeight=e._inlines._value[0].height,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight}output(e){e.size=this._size}}class f0 extends o_{constructor(e={}){const t={};f0.definePropertiesValues(t,e),super(t,e),f0.init(this)}clear(){for(const e of this._inlines._value)e.clear();return super.clear()}bindBackgroundMeshProperties(){this._backgroundMesh.raycast=()=>{},this._bounds._size=this._backgroundMesh.scale,this._bounds._needsUpdate=!0}unbindBackgroundMeshProperties(){this._bounds._size=new qe.Vector3(1,1,1),this._bounds._needsUpdate=!0}add(e){const t=[];for(let i=0;i<arguments.length;i++){const n=arguments[i];n.isUI?console.warn("ThreeMeshUI::InlineBlockElement cannot contains UI Elements.",n):(t.push(n),n.position.z=.005)}return super.add(...t)}static definePropertiesValues(e,t){e.children||(e.children=VG),e.bounds||(e.bounds=f$),e.inlines||(e.inlines=u$),e.layouter||(e.layouter=BG),e.renderer||(e.renderer=d$),e.fontFamily||(e.fontFamily=LG),e.fontWeight||(e.fontWeight=OG),e.fontStyle||(e.fontStyle=DG),e.fontSize||(e.fontSize=GG),e.backgroundColor||(e.backgroundColor=dG),e.lineBreak||(e.lineBreak=PG),e.letterSpacing||(e.letterSpacing=zG),e.whiteSpace||(e.whiteSpace=jB),e.fontKerning||(e.fontKerning=$C),t.backgroundSize||(t.backgroundSize="cover"),t.width||(t.width="100%"),t.height||(t.height="100%"),t.boxSizing||(t.boxSizing="border-box")}static init(e){Object.defineProperties(e,{isInline:{configurable:!1,enumerable:!0,value:!0},isInlineBlock:{configurable:!1,enumerable:!0,value:!0}}),e._inlines._value=[new p$(e)],e.backgroundMaterial=new TG,e._renderer.render(e)}}class p$ extends aG{constructor(e){super(),this._uiElement=e}get xadvance(){const e=this._uiElement._padding._value,t=this._uiElement._width;return t._relative?t._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.w+e.y+t.value}get width(){const e=this._uiElement._width;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get height(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get anchor(){return this.height}get lineHeight(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get lineBase(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}clear(){this._uiElement=null}}class QG{constructor(e){this._subject=e}attach(){console.error(`Behavior::attach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}act(){throw new Error(`Behavior::act() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}detach(){console.error(`Behavior::detach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}clear(){}}const jG=()=>iS.update(),WG={BaseProperty:Qi,Block:u0,Text:d0,Inline:Yg,InlineBlock:f0,MeshUIBaseElement:o_,FontLibrary:Lp,update:jG,MSDFFontMaterialUtils:Na,ShaderChunkUI:EG,Behavior:QG,FontVariant:r_};typeof global<"u"&&(global.ThreeMeshUI=WG);const m$=WG;var g$=bs.ti,qG=bs.nS,WB=bs.eB,v$=bs.Yp,WI=bs.VB,y$=bs.BC,A$=bs.zN,hw=bs.cV,_$=bs.hW,b$=bs.k2,x$=bs.K6,w$=bs.M7,S$=bs.ls,C$=bs.Hi,qB=bs.EY,E$=bs.MR,T$=bs.zf,Zi=bs.Ay,XG=bs.yo;const yk=Object.freeze(Object.defineProperty({__proto__:null,BaseProperty:g$,Behavior:qG,Block:WB,DefaultValues:v$,FontLibrary:WI,FontVariant:y$,InheritableProperty:A$,Inline:hw,InlineBlock:_$,InlineGlyph:b$,MSDFFontMaterialUtils:x$,MaterialTransformers:w$,MeshUIBaseElement:S$,ShaderChunkUI:C$,Text:qB,TypographicFont:E$,TypographicGlyph:T$,default:Zi,update:XG},Symbol.toStringTag,{value:"Module"}));class M${constructor(){u(this,"Rad2Deg",180/Math.PI);u(this,"Deg2Rad",Math.PI/180);u(this,"Epsilon",1e-5)}random(e,t){return Array.isArray(e)?e.length<=0?null:e[Math.floor(Math.random()*e.length)]:e!==void 0&&t!==void 0?Math.random()*(t-e)+e:Math.random()}randomVector3(e,t=0,i=1){e.x=this.random(t,i),e.y=this.random(t,i),e.z=this.random(t,i)}clamp(e,t,i){return e<t?t:e>i?i:e}clamp01(e){return this.clamp(e,0,1)}lerp(e,t,i){return i=i<0?0:i,i=i>1?1:i,e+(t-e)*i}inverseLerp(e,t,i){return(i-e)/(t-e)}remap(e,t,i,n,r){return n+(r-n)*(e-t)/(i-t)}moveTowards(e,t,i){return e+=i,(i<0&&e<t||i>0&&e>t)&&(e=t),e}toDegrees(e){return e*180/Math.PI}toRadians(e){return e*Math.PI/180}tan(e){return Math.tan(e)}gammaToLinear(e){return Math.pow(e,2.2)}linearToGamma(e){return Math.pow(e,1/2.2)}approximately(e,t,i=Number.EPSILON){for(const n of I$){const r=e[n],o=t[n];if(r===void 0||o===void 0)break;if(Math.abs(r-o)>i)return!1}return!0}easeInOutCubic(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}}const I$=["x","y","z","w"],et=new M$;class Ak{constructor(e){u(this,"y");u(this,"s");u(this,"alpha",0);this.setAlpha(e),this.y=null,this.s=null}setAlpha(e){if(e<=0||e>1)throw new Error;this.alpha=e}filter(e,t){t&&this.setAlpha(t);let i;return this.y?i=this.alpha*e+(1-this.alpha)*this.s:i=e,this.y=e,this.s=i,i}lastValue(){return this.y}reset(e){this.y=e,this.s=e}}class uw{constructor(e,t=1,i=0,n=1){u(this,"freq");u(this,"minCutOff");u(this,"beta");u(this,"dCutOff");u(this,"x");u(this,"dx");u(this,"lasttime");if(e<=0||t<=0||n<=0)throw new Error;this.freq=e,this.minCutOff=t,this.beta=i,this.dCutOff=n,this.x=new Ak(this.alpha(this.minCutOff)),this.dx=new Ak(this.alpha(this.dCutOff)),this.lasttime=null}alpha(e){const t=1/this.freq;return 1/(1+1/(2*Math.PI*e)/t)}filter(e,t=null){this.lasttime&&t&&(this.freq=1/(t-this.lasttime)),this.lasttime=t;const i=this.x.lastValue(),n=i?(e-i)*this.freq:0,r=this.dx.filter(n,this.alpha(this.dCutOff)),o=this.minCutOff+this.beta*Math.abs(r);return this.x.filter(e,this.alpha(o))}reset(e){e!=null&&this.x.reset(e),this.x.alpha=this.alpha(this.minCutOff),this.dx.alpha=this.alpha(this.dCutOff),this.lasttime=null}}class XB{constructor(e,t=1,i=0,n=1){u(this,"x");u(this,"y");u(this,"z");this.x=new uw(e,t,i,n),this.y=new uw(e,t,i,n),this.z=new uw(e,t,i,n)}filter(e,t,i=null){t.x=this.x.filter(e.x,i),t.y=this.y.filter(e.y,i),t.z=this.z.filter(e.z,i)}reset(e){this.x.reset(e==null?void 0:e.x),this.y.reset(e==null?void 0:e.y),this.z.reset(e==null?void 0:e.z)}}class Kg extends le{constructor(e,t,i,n=128){if(t<=0||i<=0||n<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const r=new Wo(i,2*n,n);r.scale(1,1,-1);const o=r.getAttribute("position"),a=new w;for(let l=0;l<o.count;++l)if(a.fromBufferAttribute(o,l),a.y<0){const c=-t*3/2,h=a.y<c?-t/a.y:1-a.y*a.y/(3*c*c);a.multiplyScalar(h),a.toArray(o.array,3*l)}o.needsUpdate=!0,super(r,new Kt({map:e,depthWrite:!1}))}}const dw="needle:cameraController";function YG(s){return s[dw]}function qI(s,e,t){t?s[dw]=e:s[dw]===e&&(s[dw]=null)}const XI="needle:autofit";function KG(s){return s[XI]===void 0?!0:s[XI]!==!1}function YI(s,e){s[XI]=e}function R$(s,e,t){const i=s.length(),n=e.length(),r=et.lerp(i,n,t);return s.lerp(e,t).normalize().multiplyScalar(r)}const rT=new xe,JG=new xe().setFromAxisAngle(new w(0,1,0),Math.PI);function P$(s,e){s.lookAt(e),s.quaternion.multiply(JG)}function a_(s,e,t=!0,i=!1){if(s===e)return;rT.copy(s.quaternion);const n=Qt(e),r=Qt(s);if(i){if(Ka(s,qi(e)),t){const o=r.y,a=r.sub(JB(s));a.y=o,s.lookAt(a),s.quaternion.multiply(JG)}Number.isNaN(s.quaternion.x)&&s.quaternion.copy(rT);return}t&&(n.y=r.y),s.lookAt(n),Number.isNaN(s.quaternion.x)&&s.quaternion.copy(rT)}const B$=new _a(()=>new w,100);function yt(s,e,t){const i=B$.get();return i.set(0,0,0),s instanceof w?i.copy(s):Array.isArray(s)?i.set(s[0],s[1],s[2]):s instanceof DOMPointReadOnly?i.set(s.x,s.y,s.z):typeof s=="number"?(i.x=s,i.y=e!==void 0?e:i.x,i.z=t!==void 0?t:i.x):typeof s=="object"&&(i.x=s.x,i.y=s.y,i.z=s.z),i}const D$=new _a(()=>new me,30);function ZG(s){const e=D$.get();return s?e.copy(s):e.set(0,0,0),e}const O$=new _a(()=>new xe,100);function bl(s){const e=O$.get();return e.identity(),s instanceof xe?e.copy(s):s instanceof DOMPointReadOnly&&e.set(s.x,s.y,s.z,s.w),e}const YB=new _a(()=>new w,100),_k=Symbol("lastMatrixWorldUpdateKey");function Qt(s,e=null,t=!0){const i=e??YB.get();return s?s.parent?(t&&s.updateWorldMatrix(!0,!1),s.matrixWorldNeedsUpdate&&s[_k]!==Date.now()&&(s[_k]=Date.now(),s.updateMatrixWorld()),i.setFromMatrixPosition(s.matrixWorld),i):i.copy(s.position):i.set(0,0,0)}function Os(s,e){if(!s)return s;const t=YB.get();return e!==t&&t.copy(e),((s==null?void 0:s.parent)??s).worldToLocal(t),s.position.set(t.x,t.y,t.z),s}function kp(s,e,t,i){const n=YB.get();return n.set(e,t,i),Os(s,n),s}const sS=new _a(()=>new xe,100),dp=new xe,oT=new xe;function qi(s,e=null){if(!s)return sS.get().identity();const t=e??sS.get();return s.parent?(s.getWorldQuaternion(t),t):t.copy(s.quaternion)}function Ka(s,e){if(!s)return;e!==dp&&dp.copy(e);const t=dp,i=s==null?void 0:s.parent;i==null||i.getWorldQuaternion(oT),oT.invert();const n=oT.multiply(t);s.quaternion.set(n.x,n.y,n.z,n.w)}function KB(s,e,t,i,n){dp.set(e,t,i,n),Ka(s,dp)}const L$=new _a(()=>new w,100),k$=new w;function ln(s,e=null){return e||(e=L$.get()),s?s.parent?(s.getWorldScale(e),e):e.copy(s.scale):e.set(0,0,0)}function Jg(s,e){if(!s)return;if(!s.parent){s.scale.copy(e);return}const t=k$;s.parent.getWorldScale(t),s.scale.copy(e),s.scale.divide(t)}const F$=new w,bk=new xe;function U$(s){return qi(s,bk),F$.set(0,0,1).applyQuaternion(bk)}const N$=new _a(()=>new w,100),xk=new xe;function JB(s,e){return e||(e=N$.get().set(0,0,1)),qi(s,xk),e.applyQuaternion(xk)}const wk=new oi,Sk=new oi,z$=new w;function ZB(s){const e=sS.get();return s.getWorldQuaternion(e),Sk.setFromQuaternion(e),Sk}function $B(s,e){const t=sS.get();Ka(s,t.setFromEuler(e))}function l_(s){const e=ZB(s),t=z$;return t.set(e.x,e.y,e.z),t.x=et.toDegrees(t.x),t.y=et.toDegrees(t.y),t.z=et.toDegrees(t.z),t}function eD(s,e){c_(s,e.x,e.y,e.z,!0)}function c_(s,e,t,i,n=!0){n&&(e=et.toRadians(e),t=et.toRadians(t),i=et.toRadians(i)),wk.set(e,t,i),dp.setFromEuler(wk),Ka(s,dp)}function rS(s,e=!0){s&&(e?function t(i){console.groupCollapsed((i.name?i.name:"(no name : "+i.type+")")+" %o",i),i.children.forEach(t),console.groupEnd()}(s):s.traverse(function(t){for(var i="|___",n=t;n.parent!==null;)i="	"+i,n=n.parent;console.log(i+t.name+" <"+t.type+">")}))}function G$(s){let e=(s==null?void 0:s.name)||"";if(!s)return e;let t=s.parent;for(;t;)e=t.name+"/"+e,t=t.parent;return e}function $G(s){if(s){const e=s;return e.blendMode!==void 0&&e.clampWhenFinished!==void 0&&e.enabled!==void 0&&e.fadeIn!==void 0&&e.getClip!==void 0}return!1}class za{static createBlitMaterial(e){return new Rt({uniforms:{map:new Se(null)},vertexShader:this.vertex,fragmentShader:e})}static copyTexture(e,t){const i=t??this.blipMaterial;i.uniforms.map.value=e,i.needsUpdate=!0,i.uniformsNeedUpdate=!0,this.blipMaterial||(this.blipMaterial=new Rt({uniforms:{map:new Se(null)},vertexShader:this.vertex,fragmentShader:this.fragment}));const n=i.vertexShader;i.vertexShader=this.vertex,this.mesh||(this.mesh=new le(this.planeGeometry,this.blipMaterial));const r=this.mesh;r.material=i,r.frustumCulled=!1,this.scene.children.length=0,this.scene.add(r),this.renderer||(this.renderer=new eh({antialias:!1})),this.renderer.setSize(e.image.width,e.image.height),this.renderer.clear(),this.renderer.render(this.scene,this.perspectiveCam);const o=new Pt(this.renderer.domElement);return o.name="Copy",o.needsUpdate=!0,i.vertexShader=n,o}static textureToCanvas(e,t){if(!e)return null;(t===!0||e.isCompressedTexture===!0)&&(e=eH(e));const i=e.image;if(V$(i)){const n=document.createElement("canvas");n.width=i.width,n.height=i.height;const r=n.getContext("2d");return r?(r.drawImage(i,0,0,i.width,i.height,0,0,n.width,n.height),n):(console.error("Failed getting canvas 2d context"),null)}return null}}u(za,"planeGeometry",new _s(2,2,1,1)),u(za,"renderer"),u(za,"perspectiveCam",new zt),u(za,"scene",new Ks),u(za,"vertex",`
    varying vec2 vUv;
    void main(){
        vUv = uv;
        gl_Position = vec4(position.xy * 1.0,0.,.999999);
    }`),u(za,"fragment",`
    uniform sampler2D map; 
    varying vec2 vUv;
    void main(){ 
        vec2 uv = vUv;
        uv.y = 1.0 - uv.y;
        gl_FragColor = texture2D( map, uv);
        // gl_FragColor = vec4(uv.xy, 0, 1);
    }`),u(za,"blipMaterial"),u(za,"mesh");function eH(s){return za.copyTexture(s)}function H$(s,e=!1){return za.textureToCanvas(s,e)}function V$(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&s instanceof ImageBitmap}function Q$(s){const e=s.type;return e==="Mesh"||e==="SkinnedMesh"}function tD(s,e){e?s["needle:rendercustomshadow"]=!0:s["needle:rendercustomshadow"]=!1}function tH(s){if(s){if(s["needle:rendercustomshadow"]===!0)return!0;if(s["needle:rendercustomshadow"]==null)return!0}return!1}function Ja(s,e=void 0,t=void 0,i=void 0){const n=i||new Si;n.makeEmpty();const r=[];function o(l){let c=!0;if(l.visible&&KG(l)!==!1&&!(l.type==="TransformControlsGizmo"||l.type==="TransformControlsPlane")){if(l instanceof yB&&(c=!1),l instanceof Av&&(c=!1),l instanceof Kg&&(c=!1),l.isGizmo===!0&&(c=!1),l.material instanceof FC&&(c=!1),Q$(l)||(c=!1),t&&l.layers.test(t)===!1&&(c=!1),c){if(e&&Array.isArray(e)&&(e!=null&&e.includes(l)))return;if(typeof e=="function"&&e(l)===!0)return}if(l.isUI!==!0){if(c){const h=l.children;l.children=r;const d=l.position,f=l.scale;if(Number.isNaN(d.x)||Number.isNaN(d.y)||Number.isNaN(d.z)){console.warn(`Object "${l.name}" has NaN values in position or scale.... will ignore it`,d,f);return}n.expandByObject(l,!0),l.children=h}for(const h of l.children)o(h)}}}let a=!1;for(const l of s)l&&(a=!0,l.updateMatrixWorld(),o(l));return a||console.warn("No objects to fit camera to..."),n}function iH(s,e,t){const i=Ja([s],t==null?void 0:t.ignore),n=new w;i.getSize(n);const r=new w;i.getCenter(r);const o=new w;e.getSize(o);const a=new w;e.getCenter(a);const l=new w;l.set(o.x/n.x,o.y/n.y,o.z/n.z);const c=Math.min(l.x,l.y,l.z),h=(t==null?void 0:t.scale)!==!1;if(h&&Jg(s,ln(s).multiplyScalar(c)),(t==null?void 0:t.position)!==!1){const d=new w;i.getCenter(d),d.y=i.min.y;const f=new w;e.getCenter(f),f.y=e.min.y;const p=f.clone().sub(d);h&&p.multiplyScalar(c),Os(s,Qt(s).add(p))}return{boundsBefore:i,scale:l}}function nH(s,e){const t=Ja([s]),i=new w;t.getCenter(i),i.y=t.min.y;const n=e.clone().sub(i),r=Qt(s);return Os(s,r.add(n)),{offset:n,bounds:t}}function iD(s,e,t,i){if(Array.isArray(e)){let o=!0;for(let a=0;a<e.length;a++)iD(s,e[a],a,e)||(o=!1);return o}if(e.type==="MeshStandardMaterial")return!1;if(e["material:fbx"]!=null)return!0;const n=new ms;n["material:fbx"]=e;const r=e;return r&&(r.map?n.color.set(1,1,1):n.color.copyLinearToSRGB(r.color),n.emissive.copyLinearToSRGB(r.emissive),n.emissiveIntensity=r.emissiveIntensity,n.opacity=r.opacity,n.displacementScale=r.displacementScale,n.transparent=r.transparent,n.bumpMap=r.bumpMap,n.aoMap=r.aoMap,n.map=r.map,n.displacementMap=r.displacementMap,n.emissiveMap=r.emissiveMap,n.normalMap=r.normalMap,n.envMap=r.envMap,n.alphaMap=r.alphaMap,n.metalness=r.reflectivity,r.shininess&&(n.roughness=1-Math.sqrt(r.shininess)/10),n.needsUpdate=!0),t===void 0?s.material=n:i[t]=n,!0}let ix=!1;WY((...s)=>{var e;Xe()&&((e=xi.Current)!=null&&e.isInXR)&&(fp(!0),sH("error",...s))});function fp(s){if(s){if(ix)return;ix=!0,W$()}else{if(!ix)return;ix=!1,q$()}}const cA={log:void 0,warn:void 0,error:void 0};class j${constructor(){u(this,"familyName","needle-xr");u(this,"root",null);u(this,"context",null);u(this,"defaultFontSize",.06);u(this,"targetObject",new ge);u(this,"userForwardViewPoint",new w);u(this,"oneEuroFilter",new XB(90,.8));u(this,"_lastElementRemoveTime",0);u(this,"onBeforeRender",()=>{var t,i;const e=(t=this.context)==null?void 0:t.mainCamera;if(this.context&&e instanceof zt){const n=this.getRoot();Number.isNaN(n.position.x)&&n.position.set(0,0,0),Number.isNaN(n.quaternion.x)&&n.quaternion.set(0,0,0,1),this.context.scene.add(this.targetObject);const r=((i=this.context.xr)==null?void 0:i.rigScale)??1,o=3.5*r,a=e.worldForward;a.y=0,a.normalize().multiplyScalar(o),this.userForwardViewPoint.copy(e.worldPosition).sub(a),this.targetObject.position.distanceTo(this.userForwardViewPoint)>2*r&&(this.targetObject.position.copy(this.userForwardViewPoint),a_(this.targetObject,e,!0,!0),this.targetObject.rotateY(Math.PI)),this.oneEuroFilter.filter(this.targetObject.position,n.position,this.context.time.time);const c=this.context.time.deltaTime;if(n.quaternion.slerp(this.targetObject.quaternion,c*5),n.scale.setScalar(r),this.targetObject.removeFromParent(),this.context.scene.add(n),this.context.time.time-this._lastElementRemoveTime>.1){this._lastElementRemoveTime=this.context.time.time;const h=Date.now();for(let d=0;d<this._activeTexts.length;d++){const f=this._activeTexts[d];if(f instanceof Zi.Text&&h-f._activatedTime>2e4){f.removeFromParent(),this._textBuffer.push(f),this._activeTexts.splice(d,1);break}}}}});u(this,"textOptions",{fontSize:this.defaultFontSize,fontFamily:this.familyName,padding:.03,margin:.005,color:0,backgroundColor:16777215,backgroundOpacity:.4,borderRadius:.03,offset:.025});u(this,"_textBuffer",[]);u(this,"_activeTexts",[]);this.ensureFont()}onEnable(){this.context=xi.Current||xi.All[0],this.context.pre_render_callbacks.push(this.onBeforeRender)}onDisable(){var e,t,i;(t=this.context)==null||t.pre_render_callbacks.splice((e=this.context)==null?void 0:e.pre_render_callbacks.indexOf(this.onBeforeRender),1),(i=this.root)==null||i.removeFromParent()}addLog(e,t){const i=this.getRoot(),n=this.getText();let r=16777215,o=0;switch(e){case"log":r=16777215,o=0;break;case"warn":r=16772761,o=4465152;break;case"error":r=16755370,o=7798784;break}t.length>1e3&&(t=t.substring(0,1e3)+"...");const a=new Date().toISOString().split("T")[1].split(".")[0];n.textContent="["+a+"] "+t,n.visible=!0,n._activatedTime=Date.now(),i.add(n),this._activeTexts.push(n),this.context&&this.context.scene.add(i),n.set({backgroundColor:r,color:o}),Zi.update()}ensureFont(){let e=Zi.FontLibrary.getFontFamily(this.familyName);if(!e){e=Zi.FontLibrary.addFontFamily(this.familyName);const t=e.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");t==null||t.addEventListener("ready",()=>{Zi.update()})}}getText(){const e=this.getRoot();if(this._textBuffer.length>0){const i=this._textBuffer.pop();return i.visible=!0,setTimeout(()=>this.disableDepthTestRecursive(i),100),i}if(e.children.length>20&&this._activeTexts.length>0)return this._activeTexts.shift();const t=new Zi.Text(this.textOptions);return setTimeout(()=>this.disableDepthTestRecursive(t),500),setTimeout(()=>this.disableDepthTestRecursive(t),1500),t}disableDepthTestRecursive(e,t=0){for(let n=0;n<e.children.length;n++){const r=e.children[n];r instanceof ge&&this.disableDepthTestRecursive(r,t+1)}e.renderOrder=10*t,e.layers.set(2);const i=e.material;i&&(i.depthWrite=!1,i.depthTest=!1,i.transparent=!0),t===0&&Zi.update()}getRoot(){if(this.root)return this.root;const e=this.defaultFontSize,t={boxSizing:"border-box",fontFamily:this.familyName,width:"2.6",fontSize:e,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:0,whiteSpace:"pre-wrap",flexDirection:"column-reverse"};return this.root=new Zi.Block(t),this.root}}let co=null;function W$(){co||(co=new j$),co.onEnable();for(const s in cA){cA[s]=console[s];let e=!1;console[s]=function(){var t;if((t=cA[s])==null||t.apply(console,arguments),!e)try{e=!0,sH(s,...arguments)}finally{e=!1}}}}function q$(){co==null||co.onDisable();for(const s in cA)console[s]=cA[s]}const iy=new Map;function sH(s,...e){try{switch(iy.clear(),s){case"log":co==null||co.addLog("log",t());break;case"warn":co==null||co.addLog("warn",t());break;case"error":co==null||co.addLog("error",t());break}}catch(r){console.error("Error in spatial console",r)}finally{iy.clear()}function t(){let r="";for(let o=0;o<e.length;o++){const a=e[o];r+=i(a),o<e.length-1&&(r+=", ")}return r}function i(r,o=0){if(typeof r=="string")return'"'+r+'"';if(typeof r=="number"){if(r%1!==0){const l=r.toFixed(5),c=l.indexOf(".");let h=l.length-1;for(;h>c&&l[h]==="0";)h--;return l.substring(0,h+1)}return r.toString()}else if(Array.isArray(r)){let a="[";for(let l=0;l<r.length;l++){const c=r[l];a+=i(c,o+1),l<r.length-1&&(a+=", ")}return a+="]",a}else{if(r===null)return"null";if(r===void 0)return"undefined";if(typeof r=="function")return r.name+"()"}if(r instanceof Z)return`(${i(r.x)}, ${i(r.y)})`;if(r instanceof w)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)})`;if(r instanceof Je)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)}, ${i(r.w)})`;if(r instanceof xe)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)}, ${i(r.w)})`;if(r instanceof Vt||r instanceof Pt)return r.name;if(r instanceof Ht)return`[${r.elements.join(", ")}]`;if(r instanceof fe)return`[${r.elements.join(", ")}]`;if(r instanceof Wr)return r.mask.toString();if(typeof r=="object"){if(iy.has(r))return"*";let a=`{
`;a+=n(o);const l=Object.keys(r);let c="";for(let h=0;h<l.length;h++){const d=l[h],f=r[d];if(iy.has(f)){c+="";continue}iy.set(f,!0),c+=d+":"+i(f,o+1),h<l.length-1&&(c+=", "),c.length>=60&&(c+=`
`,c+=n(o),a+=c,c="")}return a+=c,a+=`
}`,a}return r}function n(r){let o="";for(let a=0;a<r;a++)o+=" ";return o}}const X$=ie("nodevlogs");function Pn(s,e=os.Log){Ec(e,s)}function Yi(s){Pn(s,os.Warn)}function eE(s){Pn(s,os.Error)}let KI,aT;function Xe(){if(X$)return!1;if(KI!==void 0)return KI;if(aT!==void 0)return aT;let s=So();return s||(s=window.location.hostname.endsWith(".local-credentialless.webcontainer.io")),aT=s,s}function Y$(s){KI=s}let fo,ca=null,Tc=null,ny=!1,Ck=null;const rH="terminal",Uy=ie("console"),K$=ie("noerrors")||ie("noconsole")||window.crossOriginIsolated;Uy&&nD();if(!K$&&(Uy||So())){if(So()&&!Uy){const e=new URL(window.location.href);e.searchParams.set("console","1"),console.log('🌵 Tip: You can add the "?console" query parameter to the url to show the debug console (on mobile it will automatically open in the bottom right corner when your get errors during development. In VR a spatial console will appear.)',`
Open this page to get the console: `+e.toString())}const s=St.isMobileDevice()||St.isQuest()&&Xe();if((s||Uy)&&(YY(),aH(),lH(!0),s)){const e=document.querySelector("needle-engine");e==null||e.addEventListener("enter-ar",()=>{(Uy||fo||wB()>0)&&ie("noerrors")}),e==null||e.addEventListener("exit-ar",()=>{eee()})}}const JI=Symbol("consoleParent");function nD(){if(fo){fo.showSwitch();return}lH()}function oH(){fo&&(fo.hide(),fo.hideSwitch())}function aH(){Ck||(Ck=setInterval(J$,500))}let Ek=0;function J$(){const s=wB(),e=s!==Ek;Ek=s,e&&Z$()}function Z$(){nD(),Tc&&(Tc.setAttribute("error","true"),Tc.innerText="🤬")}function $$(){Tc&&(Tc.removeAttribute("error"),Tc.innerText=rH)}function eee(){ca&&ca[JI]&&ca[JI].appendChild(ca)}function lH(s=!1){if(fo!==void 0||ny)return;ny=!0;const e=document.createElement("script");e.onload=()=>{if(!globalThis.VConsole){console.warn("🌵 Debug console failed to load."),ny=!1,fo=null;return}ny=!1,aH(),fo=new VConsole({pluginOrder:["default","needle-console"]});const t=globalThis["needle:codegen_files"];if(t&&t.length>0&&fo.addPlugin(tee()),ca=nee(),ca&&(ca[JI]=ca.parentElement,ca.style.position="absolute",ca.style.zIndex=Number.MAX_SAFE_INTEGER.toString()),fo.setSwitchPosition(20,30),Tc=iee(),Tc){Tc.innerText=rH,Tc.addEventListener("click",$$);const i=document.createElement("style"),n=40;i.innerHTML=`
                #__vconsole .vc-switch {
                    border: 1px solid rgba(255, 255, 255, .1);
                    border-radius: 50%;
                    width: ${n}px;
                    height: ${n}px;
                    padding: 0;
                    line-height: ${n}px;
                    font-size: ${n*.4}px;
                    text-align: center;
                    background: #ffffff5c;
                    backdrop-filter: blur(16px);
                    -webkit-backdrop-filter: blur(16px);
                    user-select: none;
                    pointer-events: auto;
                    transition: transform .2s ease-in-out;
                    box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);

                    font-family: 'Material Symbols Outlined';
                    color: black;
                    font-size: 2.3em;
                    font-weight: 100;
                }
                #__vconsole .vc-switch:hover {
                    cursor: pointer;
                    transform: scale(1.1);
                    transition: transform .1s ease-in-out, background .1s linear;
                    background: rgba(245, 245, 245, .8);
                    outline: rgba(0, 0, 0, .05) 1px solid;
                }
                #__vconsole .vc-switch[error] {
                    background: rgba(255,0,0,.2);
                    animation: vconsole-notify 1s ease-in-out;
                    line-height: 35px;
                }
                @keyframes vconsole-notify {
                    from {
                        transform: scale(1, 1);
                    }
                    10% {
                        transform: scale(1.3, 1.3);
                    }
                    70% {
                        transform: scale(1.4, 1.4);
                    }
                    to {
                        transform: scale(1, 1);
                    }
                }
                #__vconsole .vc-panel {
                    font-family: monospace;
                    font-size: 11px;
                }
                #__vconsole .vc-plugin-box.vc-actived {
                    height: 100%;
                }
                #__vconsole .vc-mask {
                    overflow: hidden;
                }
            `,ca==null||ca.prepend(i),s===!0&&wB()<=0&&oH(),console.log("🌵 Debug console has loaded")}},e.onerror=()=>{console.warn("🌵 Debug console failed to load."+(window.crossOriginIsolated?"This page is using cross-origin isolation, so external scripts can't be loaded.":"")),ny=!1,fo=null},e.src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js",document.body.appendChild(e)}function tee(){if(!globalThis.VConsole)return;const s=new VConsole.VConsolePlugin("needle-console","🌵 Inspect glTF"),e=()=>document.querySelector("#__vc_plug_"+s._id+" iframe");return s.on("renderTab",function(t){const i=globalThis["needle:codegen_files"];if(!i||i.length===0)return;let n=globalThis["needle:codegen_files"][0];const r=n.indexOf("?");r>-1&&(n=n.substring(0,r));const a=location.protocol+"//"+location.host+location.pathname+"/"+n,l=encodeURIComponent(a);s.fullUrl="https://viewer.needle.tools?inspect&file="+l;var c='<iframe src="" style="width: 100%; height: 99%; border: none;"></iframe>';t(c)}),s.on("show",function(){const t=e();t&&t.src!==s.fullUrl&&(t.src=s.fullUrl)}),s.on("hide",function(){const t=e();t&&(t.src="")}),s.on("addTopBar",function(t){var i=new Array;i.push({name:"Open in new window ↗",onClick:function(n){window.open(s.fullUrl,"_blank"),fo==null||fo.hide()}}),i.push({name:"Reload",onClick:function(n){const r=e();r&&(r.src=s.fullUrl)}}),i.push({name:"Fullscreen",onClick:function(n){const r=e();r.requestFullscreen?r.requestFullscreen():r.webkitRequestFullscreen instanceof Function&&r.webkitRequestFullscreen()}}),t(i)}),s}function iee(){const s=document.querySelector("#__vconsole .vc-switch");return s||null}function nee(){const s=document.querySelector("#__vconsole");return s||null}const cH=ie("debugdefines");_v('if(!globalThis[""3.51.3""]) globalThis[""3.51.3""] = "0.0.0";');_v('if(!globalThis[""Needle Engine for Blender 0.52.4""]) globalThis[""Needle Engine for Blender 0.52.4""] = "unknown";');_v('if(!globalThis[""Wed Jan 29 2025 23:02:55 GMT-0800 (Pacific Standard Time)""]) globalThis[""Wed Jan 29 2025 23:02:55 GMT-0800 (Pacific Standard Time)""] = "unknown";');_v('globalThis["__NEEDLE_ENGINE_VERSION__"] = "3.51.3";');_v('globalThis["__NEEDLE_ENGINE_GENERATOR__"] = "Needle Engine for Blender 0.52.4";');_v('globalThis["__NEEDLE_PROJECT_BUILD_TIME__"] = "Wed Jan 29 2025 23:02:55 GMT-0800 (Pacific Standard Time)";');const ja="3.51.3",tE="Needle Engine for Blender 0.52.4",sD="Wed Jan 29 2025 23:02:55 GMT-0800 (Pacific Standard Time)";cH&&console.log(`Engine version: ${ja} (generator: ${tE})
Project built at ${sD}`);const nu="needle_isActiveInHierarchy",Hf="builtin_components",hA="needle_editor_guid";function _v(s){try{(0,eval)(s)}catch(e){cH&&console.error(e)}}const see='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 160 187.74"><defs><linearGradient id="a" x1="89.64" y1="184.81" x2="90.48" y2="21.85" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#62d399"/><stop offset=".51" stop-color="#acd842"/><stop offset=".9" stop-color="#d7db0a"/></linearGradient><linearGradient id="b" x1="69.68" y1="178.9" x2="68.08" y2="16.77" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0ba398"/><stop offset=".5" stop-color="#4ca352"/><stop offset="1" stop-color="#76a30a"/></linearGradient><linearGradient id="c" x1="36.6" y1="152.17" x2="34.7" y2="84.19" gradientUnits="userSpaceOnUse"><stop offset=".19" stop-color="#36a382"/><stop offset=".54" stop-color="#49a459"/><stop offset="1" stop-color="#76a30b"/></linearGradient><linearGradient id="d" x1="15.82" y1="153.24" x2="18" y2="90.86" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#267880"/><stop offset=".51" stop-color="#457a5c"/><stop offset="1" stop-color="#717516"/></linearGradient><linearGradient id="e" x1="135.08" y1="135.43" x2="148.93" y2="63.47" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b0d939"/><stop offset="1" stop-color="#eadb04"/></linearGradient><linearGradient id="f" x1="-4163.25" y1="2285.12" x2="-4160.81" y2="2215.34" gradientTransform="rotate(20 4088.49 13316.712)" gradientUnits="userSpaceOnUse"><stop offset=".17" stop-color="#74af52"/><stop offset=".48" stop-color="#99be32"/><stop offset="1" stop-color="#c0c40a"/></linearGradient><symbol id="g" viewBox="0 0 160 187.74"><path style="fill:url(#a)" d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75z"/><path style="fill:url(#b)" d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98z"/><path style="fill:url(#c)" d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z"/><path style="fill:url(#d)" d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04z"/><path style="fill:#9c3" d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5z"/><path style="fill:url(#e)" d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59z"/><path style="fill:url(#f)" d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z"/><path style="fill:#ffe113" d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1z"/><path style="fill:#f3e600" d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75z"/></symbol></defs><use width="160" height="187.74" xlink:href="#g"/></svg>',ree=btoa(see),oee="data:image/svg+xml;base64,"+ree,aee=oee,lee=`<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'> <svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" version="1.1" viewBox="0 0 1014 282" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m665.95 132.73v44.88l-10.56-8.4c-0.8-0.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18 0.4-6.06 1.2s-3.54 1.8-4.98 3-2.56 2.5-3.36 3.9-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c0.32 0.24 0.56 0.44 0.72 0.6s0.36 0.32 0.6 0.48c0.96-1.2 2.14-2.28 3.54-3.24s2.92-1.76 4.56-2.4 3.34-1.14 5.1-1.5 3.44-0.54 5.04-0.54c1.44 0 2.92 0.04 4.44 0.12s2.84 0.28 3.96 0.6c4.56 1.12 7.8 3.12 9.72 6s2.88 6.56 2.88 11.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m732.38 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m795.93 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m858.57 97.21c0.64 0.48 0.96 1.16 0.96 2.04v74.88c-0.08 1.04-0.12 2.12-0.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18s-2.06-1.66-2.46-1.98c-1.76 2.48-4.26 4.44-7.5 5.88s-7.02 2.16-11.34 2.16c-3.84 0-7.4-0.7-10.68-2.1s-6.14-3.44-8.58-6.12-4.34-5.94-5.7-9.78-2.04-8.16-2.04-12.96c0-4.32 0.78-8.34 2.34-12.06s3.6-6.92 6.12-9.6 5.38-4.78 8.58-6.3 6.48-2.28 9.84-2.28c2.56 0 4.82 0.22 6.78 0.66s3.68 1.06 5.16 1.86 2.78 1.74 3.9 2.82 2.16 2.22 3.12 3.42v-35.04l10.68 8.64zm-27.96 67.92c3.6 0 6.52-0.68 8.76-2.04s3.98-3.06 5.22-5.1 2.1-4.22 2.58-6.54 0.72-4.44 0.72-6.36v-1.2c0-1.12-0.22-2.7-0.66-4.74s-1.28-4.06-2.52-6.06-3-3.7-5.28-5.1-5.22-2.02-8.82-1.86c-3.44 0-6.26 0.74-8.46 2.22s-3.96 3.26-5.28 5.34-2.24 4.2-2.76 6.36-0.78 3.92-0.78 5.28c0 1.84 0.24 3.92 0.72 6.24s1.36 4.48 2.64 6.48 3.04 3.68 5.28 5.04 5.12 2.04 8.64 2.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m882.81 97.09c0.64 0.48 0.96 1.12 0.96 1.92l-0.12 41.04v37.08l-10.56-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-77.88l10.8 8.64z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m950.36 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.8559 0 0 .7642 45.348 36.475)"> <g transform="translate(2.7114)"> <path d="m3.935 173.02c-0.331 0-0.497-0.402-0.497-1.207v-51.002c0-0.738 0.138-1.107 0.414-1.107h1.781c0.277 0 0.415 0.335 0.415 1.006v5.935c0 0.336 0.027 0.553 0.083 0.654 0.055 0.101 0.151-0.017 0.289-0.352 0.912-1.744 1.754-3.236 2.527-4.477 0.773-1.24 1.554-2.179 2.341-2.816s1.65-0.956 2.588-0.956c1.685 0 3.011 0.922 3.977 2.766 0.967 1.845 1.602 3.84 1.905 5.986 0.056 0.268 0.139 0.369 0.249 0.302s0.221-0.235 0.331-0.503c0.939-1.811 1.802-3.353 2.589-4.628 0.787-1.274 1.581-2.246 2.382-2.917s1.671-1.006 2.61-1.006c2.016 0 3.569 1.392 4.66 4.175 1.09 2.783 1.636 6.421 1.636 10.915v37.925c0 0.871-0.18 1.307-0.539 1.307h-1.739c-0.138 0-0.249-0.1-0.332-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.338-6.321-1.015-8.3-0.676-1.978-1.76-2.967-3.251-2.967-0.884 0-1.726 0.386-2.527 1.157s-1.519 1.727-2.154 2.867-1.201 2.213-1.699 3.219c-0.248 0.469-0.421 0.905-0.517 1.308-0.097 0.402-0.145 0.972-0.145 1.71v37.221c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.166 0-0.29-0.1-0.373-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.332-6.321-0.994-8.3-0.663-1.978-1.754-2.967-3.273-2.967-1.242 0-2.375 0.704-3.396 2.112-1.022 1.409-2.223 3.555-3.604 6.439v39.031c0 0.805-0.18 1.207-0.539 1.207h-1.698z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m53.642 166.28c-1.077 2.549-2.237 4.477-3.479 5.785-1.243 1.307-2.61 1.961-4.101 1.961-2.154 0-3.853-1.324-5.095-3.973-1.243-2.649-1.864-6.187-1.864-10.613 0-3.488 0.4-6.489 1.201-9.004s1.988-4.51 3.562-5.985c1.574-1.476 3.521-2.414 5.841-2.817l3.686-0.704c0.221-0.067 0.394-0.218 0.518-0.453 0.124-0.234 0.187-0.587 0.187-1.056v-2.917c0-3.89-0.504-6.975-1.512-9.255s-2.354-3.42-4.039-3.42c-1.298 0-2.472 0.72-3.521 2.162s-2.002 3.572-2.858 6.388c-0.083 0.268-0.159 0.453-0.228 0.554-0.069 0.1-0.172 0.083-0.311-0.051l-1.698-1.71c-0.083-0.134-0.138-0.285-0.166-0.453-0.027-0.167 0.014-0.452 0.125-0.855 0.856-3.353 2.009-6.052 3.459-8.098 1.449-2.045 3.224-3.068 5.322-3.068 1.74 0 3.211 0.687 4.412 2.062s2.112 3.37 2.734 5.986c0.621 2.615 0.932 5.7 0.932 9.255v35.712c0 0.536-0.035 0.888-0.104 1.056s-0.2 0.251-0.393 0.251h-1.533c-0.166 0-0.29-0.117-0.373-0.352-0.083-0.234-0.124-0.553-0.124-0.955l-0.083-5.231c-0.055-0.939-0.221-1.006-0.497-0.202zm0.456-19.314c0-1.14-0.194-1.643-0.58-1.509l-3.107 0.603c-1.436 0.202-2.686 0.638-3.749 1.308-1.063 0.671-1.953 1.543-2.671 2.616s-1.257 2.33-1.616 3.772-0.538 3.102-0.538 4.98c0 3.152 0.455 5.616 1.367 7.393 0.911 1.778 2.14 2.666 3.686 2.666 0.939 0 1.85-0.419 2.734-1.257s1.671-1.895 2.361-3.169c0.663-1.408 1.181-2.85 1.553-4.326 0.373-1.475 0.56-2.883 0.56-4.225v-8.852z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m79.034 173.02c-0.166 0-0.297-0.117-0.394-0.352-0.096-0.234-0.145-0.553-0.145-0.955v-4.628c0-0.536-0.041-0.838-0.124-0.905s-0.207 0.1-0.373 0.503c-0.276 0.67-0.69 1.593-1.242 2.766-0.553 1.174-1.271 2.23-2.154 3.169-0.884 0.939-1.961 1.408-3.231 1.408-1.74 0-3.314-0.989-4.722-2.967-1.409-1.979-2.534-4.963-3.376-8.953-0.843-3.991-1.264-8.937-1.264-14.838 0-5.701 0.415-10.68 1.243-14.939s1.988-7.595 3.479-10.009c1.492-2.415 3.204-3.622 5.137-3.622 1.436 0 2.616 0.57 3.541 1.71 0.926 1.14 1.719 2.381 2.382 3.722 0.249 0.47 0.414 0.637 0.497 0.503s0.125-0.536 0.125-1.207v-23.841c0-0.805 0.151-1.208 0.455-1.208h1.864c0.276 0 0.414 0.369 0.414 1.107v72.128c0 0.537-0.041 0.905-0.124 1.107-0.083 0.201-0.235 0.301-0.455 0.301h-1.533zm-0.621-42.049c-0.939-2.213-1.885-3.94-2.838-5.181s-2.009-1.861-3.169-1.861c-1.463 0-2.768 0.889-3.914 2.666s-2.044 4.376-2.693 7.796-0.973 7.578-0.973 12.474c0 5.097 0.338 9.272 1.015 12.524 0.676 3.253 1.567 5.651 2.672 7.193 1.104 1.543 2.305 2.314 3.603 2.314 1.188 0 2.258-0.704 3.211-2.113 0.952-1.408 1.705-3.118 2.257-5.13s0.829-3.957 0.829-5.835v-24.847z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m89.514 149.38c0 3.42 0.345 6.606 1.035 9.557 0.691 2.951 1.609 5.315 2.755 7.092s2.437 2.666 3.873 2.666c1.519 0 2.837-0.738 3.956-2.213 1.118-1.476 2.064-3.655 2.837-6.539 0.083-0.336 0.166-0.52 0.249-0.554 0.083-0.033 0.179 0.017 0.29 0.151l1.408 1.912c0.221 0.268 0.235 0.67 0.041 1.207-0.69 2.548-1.47 4.661-2.34 6.337-0.87 1.677-1.857 2.935-2.962 3.773-1.104 0.838-2.319 1.257-3.645 1.257-2.043 0-3.838-1.14-5.385-3.42-1.546-2.28-2.761-5.482-3.645-9.607-0.884-4.124-1.325-8.836-1.325-14.134 0-5.901 0.455-10.931 1.367-15.089 0.911-4.158 2.14-7.377 3.686-9.658 1.547-2.28 3.3-3.42 5.261-3.42 1.988 0 3.714 1.073 5.178 3.219 1.463 2.146 2.595 5.231 3.396 9.255s1.201 8.886 1.201 14.587c0 0.469-0.02 0.939-0.062 1.408-0.041 0.469-0.214 0.704-0.517 0.704h-16.362c-0.083 0-0.152 0.151-0.207 0.453-0.056 0.302-0.083 0.654-0.083 1.056zm13.752-6.237c0.304 0 0.497-0.1 0.58-0.302 0.083-0.201 0.124-0.57 0.124-1.106 0-3.219-0.283-6.187-0.849-8.903s-1.367-4.896-2.402-6.539c-1.036-1.643-2.272-2.464-3.708-2.464-1.629 0-2.996 0.955-4.101 2.867-1.104 1.911-1.94 4.342-2.506 7.293s-0.849 6.002-0.849 9.154h13.711z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m148.54 119.7c0.165 0 0.283 0.117 0.352 0.352s0.076 0.52 0.02 0.855l-6.254 50.902c-0.028 0.47-0.104 0.788-0.228 0.956s-0.297 0.251-0.518 0.251h-1.615c-0.442 0-0.718-0.402-0.829-1.207l-5.26-40.138c-0.111-0.604-0.201-0.905-0.27-0.905s-0.131 0.301-0.186 0.905l-5.012 40.138c-0.028 0.47-0.097 0.788-0.207 0.956-0.111 0.168-0.277 0.251-0.497 0.251h-1.74c-0.442 0-0.718-0.402-0.829-1.207l-6.503-50.801c-0.055-0.403-0.048-0.721 0.021-0.956s0.2-0.352 0.393-0.352h1.823c0.166 0 0.297 0.067 0.393 0.201 0.097 0.134 0.159 0.403 0.187 0.805l5.302 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.219-41.949c0.055-0.268 0.124-0.47 0.207-0.604s0.193-0.201 0.331-0.201h1.533c0.138 0 0.262 0.067 0.373 0.201 0.11 0.134 0.179 0.403 0.207 0.805l5.468 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.053-41.849c0.055-0.335 0.138-0.57 0.249-0.704 0.11-0.134 0.234-0.201 0.373-0.201h1.284z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m156.49 171.51c0 0.604-0.042 1.006-0.125 1.208-0.082 0.201-0.262 0.301-0.538 0.301h-1.533c-0.221 0-0.366-0.083-0.435-0.251s-0.103-0.486-0.103-0.956v-50.902c0-0.805 0.152-1.207 0.456-1.207h1.822c0.304 0 0.456 0.402 0.456 1.207v50.6zm0.165-63.979c0 1.207-0.207 1.811-0.621 1.811h-1.905c-0.221 0-0.366-0.135-0.435-0.403s-0.104-0.67-0.104-1.207v-7.847c0-1.006 0.18-1.509 0.539-1.509h1.988c0.359 0 0.538 0.47 0.538 1.409v7.746z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m168.3 124.83c-0.221 0-0.331 0.269-0.331 0.805v33.801c0 3.42 0.221 5.667 0.663 6.74 0.441 1.073 1.09 1.609 1.946 1.609h3.024c0.138 0 0.242 0.084 0.311 0.252 0.069 0.167 0.103 0.419 0.103 0.754v2.716c0 0.537-0.138 0.906-0.414 1.107-0.248 0.067-0.614 0.134-1.098 0.201-0.483 0.067-0.959 0.118-1.429 0.151-0.469 0.034-0.828 0.05-1.077 0.05-1.712 0-2.934-0.955-3.665-2.867-0.732-1.911-1.098-5.013-1.098-9.305v-35.108c0-0.604-0.124-0.906-0.373-0.906h-3.521c-0.248 0-0.373-0.268-0.373-0.804v-3.521c0-0.537 0.111-0.805 0.332-0.805h3.686c0.166 0 0.263-0.268 0.29-0.805l0.415-16.095c0-0.805 0.124-1.207 0.372-1.207h1.492c0.303 0 0.455 0.436 0.455 1.307v15.995c0 0.537 0.097 0.805 0.29 0.805h5.468c0.221 0 0.331 0.268 0.331 0.805v3.521c0 0.536-0.124 0.804-0.373 0.804h-5.426z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m179.4 173.02c-0.331 0-0.497-0.402-0.497-1.207v-72.329c0-0.738 0.138-1.107 0.414-1.107h1.782c0.276 0 0.414 0.336 0.414 1.006v27.162c0 0.335 0.034 0.536 0.103 0.603s0.159-0.033 0.27-0.302c0.994-1.81 1.898-3.319 2.713-4.526 0.814-1.208 1.629-2.113 2.444-2.717 0.814-0.603 1.691-0.905 2.63-0.905 2.182 0 3.839 1.375 4.971 4.125 1.132 2.749 1.698 6.404 1.698 10.965v37.925c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.165 0-0.29-0.1-0.373-0.301-0.082-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.366-6.321-1.097-8.3-0.732-1.978-1.899-2.967-3.501-2.967-0.883 0-1.705 0.318-2.464 0.956-0.76 0.637-1.526 1.576-2.299 2.816-0.773 1.241-1.643 2.834-2.61 4.779v39.031c0 0.805-0.179 1.207-0.538 1.207h-1.699z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> </g> <g transform="matrix(.80638 0 0 .80638 452.53 65.421)" fill-rule="nonzero"> <path d="m79.32 36.98v150.76l15.68-13.2 6.59-156.31-22.27 18.75z" fill="url(#f)"/> <path d="m79.32 36.98-22.27-18.75 6.59 156.31 15.68 13.2v-150.76z" fill="url(#e)"/> <path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z" fill="url(#d)"/> <path d="m25.19 104.83-25.19-14.59 16.97 53.86 16.85 9.77-8.63-49.04z" fill="url(#c)"/> <path d="M43.86,82.5L18.69,67.98L0,90.24L25.18,104.83L43.86,82.5Z" fill="#9c3"/> <path d="m134.82 78.69-9.97 56.5 15.58-9.04 19.57-62.05-25.18 14.59z" fill="url(#b)"/> <path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z" fill="url(#a)"/> <path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33 25.19-14.59z" fill="#ffe113"/> <path d="M101.59,18.23L79.32,0L57.05,18.23L79.32,36.98L101.59,18.23Z" fill="#f3e600"/> </g> <defs> <linearGradient id="f" x2="1" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)" gradientUnits="userSpaceOnUse"><stop stop-color="#62d399" offset="0"/><stop stop-color="#acd842" offset=".51"/><stop stop-color="#d7db0a" offset=".9"/><stop stop-color="#d7db0a" offset="1"/></linearGradient> <linearGradient id="e" x2="1" gradientTransform="matrix(-1.6,-162.13,162.13,-1.6,69.68,178.9)" gradientUnits="userSpaceOnUse"><stop stop-color="#0ba398" offset="0"/><stop stop-color="#4ca352" offset=".5"/><stop stop-color="#76a30a" offset="1"/></linearGradient> <linearGradient id="d" x2="1" gradientTransform="matrix(-1.9,-67.98,67.98,-1.9,36.6,152.17)" gradientUnits="userSpaceOnUse"><stop stop-color="#36a382" offset="0"/><stop stop-color="#36a382" offset=".19"/><stop stop-color="#49a459" offset=".54"/><stop stop-color="#76a30b" offset="1"/></linearGradient> <linearGradient id="c" x2="1" gradientTransform="matrix(2.18,-62.38,62.38,2.18,15.82,153.24)" gradientUnits="userSpaceOnUse"><stop stop-color="#267880" offset="0"/><stop stop-color="#457a5c" offset=".51"/><stop stop-color="#717516" offset="1"/></linearGradient> <linearGradient id="b" x2="1" gradientTransform="matrix(13.85,-71.96,71.96,13.85,135.08,135.43)" gradientUnits="userSpaceOnUse"><stop stop-color="#b0d939" offset="0"/><stop stop-color="#eadb04" offset="1"/></linearGradient> <linearGradient id="a" x2="1" gradientTransform="matrix(26.159 -64.737 64.737 26.159 107.42 128.14)" gradientUnits="userSpaceOnUse"><stop stop-color="#74af52" offset="0"/><stop stop-color="#74af52" offset=".17"/><stop stop-color="#99be32" offset=".48"/><stop stop-color="#c0c40a" offset="1"/></linearGradient> </defs> </svg>`;btoa(lee);const cee='<svg viewBox="0 0 509 154" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="M665.95 132.73v44.88l-10.56-8.4c-.8-.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18.4-6.06 1.2-1.88.8-3.54 1.8-4.98 3-1.44 1.2-2.56 2.5-3.36 3.9-.8 1.4-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-.72-.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c.32.24.56.44.72.6.16.16.36.32.6.48.96-1.2 2.14-2.28 3.54-3.24 1.4-.96 2.92-1.76 4.56-2.4 1.64-.64 3.34-1.14 5.1-1.5 1.76-.36 3.44-.54 5.04-.54 1.44 0 2.92.04 4.44.12 1.52.08 2.84.28 3.96.6 4.56 1.12 7.8 3.12 9.72 6 1.92 2.88 2.88 6.56 2.88 11.04ZM732.38 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM795.93 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM858.57 97.21c.64.48.96 1.16.96 2.04v74.88c-.08 1.04-.12 2.12-.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18-1.24-1-2.06-1.66-2.46-1.98-1.76 2.48-4.26 4.44-7.5 5.88-3.24 1.44-7.02 2.16-11.34 2.16-3.84 0-7.4-.7-10.68-2.1-3.28-1.4-6.14-3.44-8.58-6.12-2.44-2.68-4.34-5.94-5.7-9.78-1.36-3.84-2.04-8.16-2.04-12.96 0-4.32.78-8.34 2.34-12.06 1.56-3.72 3.6-6.92 6.12-9.6 2.52-2.68 5.38-4.78 8.58-6.3 3.2-1.52 6.48-2.28 9.84-2.28 2.56 0 4.82.22 6.78.66 1.96.44 3.68 1.06 5.16 1.86s2.78 1.74 3.9 2.82a35.92 35.92 0 0 1 3.12 3.42V88.57l10.68 8.64Zm-27.96 67.92c3.6 0 6.52-.68 8.76-2.04 2.24-1.36 3.98-3.06 5.22-5.1a20.5 20.5 0 0 0 2.58-6.54c.48-2.32.72-4.44.72-6.36v-1.2c0-1.12-.22-2.7-.66-4.74-.44-2.04-1.28-4.06-2.52-6.06s-3-3.7-5.28-5.1c-2.28-1.4-5.22-2.02-8.82-1.86-3.44 0-6.26.74-8.46 2.22-2.2 1.48-3.96 3.26-5.28 5.34-1.32 2.08-2.24 4.2-2.76 6.36-.52 2.16-.78 3.92-.78 5.28 0 1.84.24 3.92.72 6.24.48 2.32 1.36 4.48 2.64 6.48s3.04 3.68 5.28 5.04c2.24 1.36 5.12 2.04 8.64 2.04ZM882.81 97.09c.64.48.96 1.12.96 1.92l-.12 41.04v37.08l-10.56-8.4c-.72-.64-1.08-1.44-1.08-2.4V88.45l10.8 8.64ZM950.36 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14Z" style="fill-rule:nonzero" transform="translate(-452.406 -63.709) scale(1.00797)"/><path d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75Z" style="fill:url(#a);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98Z" style="fill:url(#b);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33Z" style="fill:url(#c);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04Z" style="fill:url(#d);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5Z" style="fill:#9c3;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59Z" style="fill:url(#e);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5Z" style="fill:url(#f);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1Z" style="fill:#ffe113;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75Z" style="fill:#f3e600;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><defs><linearGradient id="a" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)"><stop offset="0" style="stop-color:#62d399;stop-opacity:1"/><stop offset=".51" style="stop-color:#acd842;stop-opacity:1"/><stop offset=".9" style="stop-color:#d7db0a;stop-opacity:1"/><stop offset="1" style="stop-color:#d7db0a;stop-opacity:1"/></linearGradient><linearGradient id="b" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-90.565 123.412 54.953) scale(162.14)"><stop offset="0" style="stop-color:#0ba398;stop-opacity:1"/><stop offset=".5" style="stop-color:#4ca352;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30a;stop-opacity:1"/></linearGradient><linearGradient id="c" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="scale(-68) rotate(88.4 .881 -1.396)"><stop offset="0" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".19" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".54" style="stop-color:#49a459;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30b;stop-opacity:1"/></linearGradient><linearGradient id="d" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-88 87.255 68.431) scale(62.42)"><stop offset="0" style="stop-color:#267880;stop-opacity:1"/><stop offset=".51" style="stop-color:#457a5c;stop-opacity:1"/><stop offset="1" style="stop-color:#717516;stop-opacity:1"/></linearGradient><linearGradient id="e" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-79.1 149.53 -14.065) scale(73.28)"><stop offset="0" style="stop-color:#b0d939;stop-opacity:1"/><stop offset="1" style="stop-color:#eadb04;stop-opacity:1"/></linearGradient><linearGradient id="f" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-67.997 148.705 -15.558) scale(69.8226)"><stop offset="0" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".17" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".48" style="stop-color:#99be32;stop-opacity:1"/><stop offset="1" style="stop-color:#c0c40a;stop-opacity:1"/></linearGradient></defs></svg>',hee=btoa(cee),uee="data:image/svg+xml;charset=utf-8;base64,"+hee,dee=uee;/**
 * postprocessing v6.36.6 build Tue Dec 31 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rüschen
 * @license Zlib
 */var lT=1/1e3,fee=1e3,pee=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(s){typeof document<"u"&&document.hidden!==void 0&&(s?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=s)}get delta(){return this._delta*lT}get fixedDelta(){return this._fixedDelta*lT}set fixedDelta(s){this._fixedDelta=s*fee}get elapsed(){return this._elapsed*lT}update(s){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(s!==void 0?s:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(s){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},mee=(()=>{const s=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),t=new pt;return t.setAttribute("position",new ot(s,3)),t.setAttribute("uv",new ot(e,2)),t})(),$s=class ZI{static get fullscreenGeometry(){return mee}constructor(e="Pass",t=new Ks,i=new Y0){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new le(ZI.fullscreenGeometry,e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Ks),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Sr){}render(e,t,i,n,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Yt||t instanceof Vt||t instanceof Pt||t instanceof ZI)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},gee=class extends $s{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,n,r){const o=e.state.buffers.stencil;o.setLocked(!1),o.setTest(!1)}},vee=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,jp="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",hH=class extends Rt{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Se(null),opacity:new Se(1)},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:vee,vertexShader:jp})}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}getOpacity(s){return this.uniforms.opacity.value}setOpacity(s){this.uniforms.opacity.value=s}},uH=class extends $s{constructor(s,e=!0){super("CopyPass"),this.fullscreenMaterial=new hH,this.needsSwap=!1,this.renderTarget=s,s===void 0&&(this.renderTarget=new Yt(1,1,{minFilter:Nt,magFilter:Nt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(s){this.autoResize=s}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(s){this.autoResize=s}render(s,e,t,i,n){this.fullscreenMaterial.inputBuffer=e.texture,s.setRenderTarget(this.renderToScreen?null:this.renderTarget),s.render(this.scene,this.camera)}setSize(s,e){this.autoResize&&this.renderTarget.setSize(s,e)}initialize(s,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==Ri?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":s!==null&&s.outputColorSpace===_t&&(this.renderTarget.texture.colorSpace=_t))}},Tk=new me,iE=class extends $s{constructor(s=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=s,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(s,e,t){this.color=s,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(s){this.overrideClearColor=s}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(s){this.overrideClearAlpha=s}render(s,e,t,i,n){const r=this.overrideClearColor,o=this.overrideClearAlpha,a=s.getClearAlpha(),l=r!==null,c=o>=0;l?(s.getClearColor(Tk),s.setClearColor(r,c?o:a)):c&&s.setClearAlpha(o),s.setRenderTarget(this.renderToScreen?null:e),s.clear(this.color,this.depth,this.stencil),l?s.setClearColor(Tk,a):c&&s.setClearAlpha(a)}},yee=class extends $s{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new iE(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,n,r){const o=e.getContext(),a=e.state.buffers,l=this.scene,c=this.camera,h=this.clearPass,d=this.inverted?0:1,f=1-d;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.stencil.setFunc(o.ALWAYS,d,4294967295),a.stencil.setClear(f),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(e,null):(h.render(e,t),h.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(l,c)):(e.setRenderTarget(t),e.render(l,c),e.setRenderTarget(i),e.render(l,c)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(o.EQUAL,1,4294967295),a.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),a.stencil.setLocked(!0)}},rD=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:n=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,i,r,n),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new uH,this.depthTexture=null,this.passes=[],this.timer=new pee,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const t=e.getSize(new Z),i=e.getContext().getContextAttributes().alpha,n=this.inputBuffer.texture.type;n===Ri&&e.outputColorSpace===_t&&(this.inputBuffer.texture.colorSpace=_t,this.outputBuffer.texture.colorSpace=_t,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const r of this.passes)r.initialize(e,i,n)}}replaceRenderer(e,t=!0){const i=this.renderer,n=i.domElement.parentNode;return this.setRenderer(e),t&&n!==null&&(n.removeChild(i.domElement),n.appendChild(e.domElement)),i}createDepthTexture(){const e=this.depthTexture=new mv;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=Md,e.type=tu):e.type=El,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,n){const r=this.renderer,o=r===null?new Z:r.getDrawingBufferSize(new Z),a={minFilter:Nt,magFilter:Nt,stencilBuffer:t,depthBuffer:e,type:i},l=new Yt(o.width,o.height,a);return n>0&&(l.ignoreDepthForMultisampleCopy=!1,l.samples=n),i===Ri&&r!==null&&r.outputColorSpace===_t&&(l.texture.colorSpace=_t),l.texture.name="EffectComposer.Buffer",l.texture.generateMipmaps=!1,l}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const i=this.passes,n=this.renderer,r=n.getDrawingBufferSize(new Z),o=n.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(n),e.setSize(r.width,r.height),e.initialize(n,o,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const l=this.createDepthTexture();for(e of i)e.setDepthTexture(l)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,i=t.indexOf(e);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){const o=(l,c)=>l||c.needsDepthTexture;t.reduce(o,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,i=this.copyPass;let n=this.inputBuffer,r=this.outputBuffer,o=!1,a,l,c;e===void 0&&(this.timer.update(),e=this.timer.getDelta());for(const h of this.passes)h.enabled&&(h.render(t,n,r,e,o),h.needsSwap&&(o&&(i.renderToScreen=h.renderToScreen,a=t.getContext(),l=t.state.buffers.stencil,l.setFunc(a.NOTEQUAL,1,4294967295),i.render(t,n,r,e,o),l.setFunc(a.EQUAL,1,4294967295)),c=n,n=r,r=c),h instanceof yee?o=!0:h instanceof gee&&(o=!1))}setSize(e,t,i){const n=this.renderer,r=n.getSize(new Z);(e===void 0||t===void 0)&&(e=r.width,t=r.height),(r.width!==e||r.height!==t)&&n.setSize(e,t,i);const o=n.getDrawingBufferSize(new Z);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),$s.fullscreenGeometry.dispose()}},va={NONE:0,DEPTH:1,CONVOLUTION:2},Oi={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Aee=class{constructor(){this.shaderParts=new Map([[Oi.FRAGMENT_HEAD,null],[Oi.FRAGMENT_MAIN_UV,null],[Oi.FRAGMENT_MAIN_IMAGE,null],[Oi.VERTEX_HEAD,null],[Oi.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=va.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Ui}},cT=!1,Mk=class{constructor(s=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(s),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Pi:t=this.materialsFlatShadedDoubleSide;break;case Gn:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Pi:t=this.materialsDoubleSide;break;case Gn:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(s){if(!(s instanceof Rt))return s.clone();const e=s.uniforms,t=new Map;for(const n in e){const r=e[n].value;r.isRenderTargetTexture&&(e[n].value=null,t.set(n,r))}const i=s.clone();for(const n of t)e[n[0]].value=n[1],i.uniforms[n[0]].value=n[1];return i}setMaterial(s){if(this.disposeMaterials(),this.material=s,s!==null){const e=this.materials=[this.cloneMaterial(s),this.cloneMaterial(s),this.cloneMaterial(s)];for(const t of e)t.uniforms=Object.assign({},s.uniforms),t.side=As;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.side=Gn,i}),this.materialsDoubleSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.side=Pi,i}),this.materialsFlatShaded=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.flatShading=!0,i.side=Gn,i}),this.materialsFlatShadedDoubleSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.flatShading=!0,i.side=Pi,i})}}render(s,e,t){const i=s.shadowMap.enabled;if(s.shadowMap.enabled=!1,cT){const n=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),s.render(e,t);for(const r of n)r[0].material=r[1];this.meshCount!==n.size&&n.clear()}else{const n=e.overrideMaterial;e.overrideMaterial=this.material,s.render(e,t),e.overrideMaterial=n}s.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){const s=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of s)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return cT}static set workaroundEnabled(s){cT=s}},Nu=-1,Hi=class extends Zs{constructor(s,e=Nu,t=Nu,i=1){super(),this.resizable=s,this.baseSize=new Z(1,1),this.preferredSize=new Z(e,t),this.target=this.preferredSize,this.s=i,this.effectiveSize=new Z,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const s=this.baseSize,e=this.preferredSize,t=this.effectiveSize,i=this.scale;e.width!==Nu?t.width=e.width:e.height!==Nu?t.width=Math.round(e.height*(s.width/Math.max(s.height,1))):t.width=Math.round(s.width*i),e.height!==Nu?t.height=e.height:e.width!==Nu?t.height=Math.round(e.width/Math.max(s.width/Math.max(s.height,1),1)):t.height=Math.round(s.height*i)}get width(){return this.effectiveSize.width}set width(s){this.preferredWidth=s}get height(){return this.effectiveSize.height}set height(s){this.preferredHeight=s}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(s){this.s!==s&&(this.s=s,this.preferredSize.setScalar(Nu),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(s){this.scale=s}get baseWidth(){return this.baseSize.width}set baseWidth(s){this.baseSize.width!==s&&(this.baseSize.width=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(s){this.baseWidth=s}get baseHeight(){return this.baseSize.height}set baseHeight(s){this.baseSize.height!==s&&(this.baseSize.height=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(s){this.baseHeight=s}setBaseSize(s,e){(this.baseSize.width!==s||this.baseSize.height!==e)&&(this.baseSize.set(s,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(s){this.preferredSize.width!==s&&(this.preferredSize.width=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(s){this.preferredWidth=s}get preferredHeight(){return this.preferredSize.height}set preferredHeight(s){this.preferredSize.height!==s&&(this.preferredSize.height=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(s){this.preferredHeight=s}setPreferredSize(s,e){(this.preferredSize.width!==s||this.preferredSize.height!==e)&&(this.preferredSize.set(s,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(s){this.s=s.scale,this.baseSize.set(s.baseWidth,s.baseHeight),this.preferredSize.set(s.preferredWidth,s.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Nu}},_ee=class{constructor(s=0){this.nextId=s}getNextId(){return this.nextId++}reset(s=0){return this.nextId=s,this}},hT=new _ee(2),bee=class extends Set{constructor(s,e=hT.getNextId()){super(),this.exclusive=!1,this._layer=e,(this._layer<1||this._layer>31)&&(console.warn("Layer out of range, resetting to 2"),hT.reset(2),this._layer=hT.getNextId()),s!==void 0&&this.set(s)}get layer(){return this._layer}set layer(s){const e=this._layer;for(const t of this)t.layers.disable(e),t.layers.enable(s);this._layer=s}getLayer(){return this.layer}setLayer(s){this.layer=s}isExclusive(){return this.exclusive}setExclusive(s){this.exclusive=s}clear(){const s=this.layer;for(const e of this)e.layers.disable(s);return super.clear()}set(s){this.clear();for(const e of s)this.add(e);return this}indexOf(s){return this.has(s)?0:-1}add(s){return this.exclusive?s.layers.set(this.layer):s.layers.enable(this.layer),super.add(s)}delete(s){return this.has(s)&&s.layers.disable(this.layer),super.delete(s)}toggle(s){let e;return this.has(s)?(this.delete(s),e=!1):(this.add(s),e=!0),e}setVisible(s){for(const e of this)s?e.layers.enable(0):e.layers.disable(0);return this}},$t={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},xee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",wee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",See="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",Cee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Eee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",Tee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",Mee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",Iee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",Ree="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",Pee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",Bee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",Dee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",Oee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",Lee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",kee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",Fee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",Uee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",Nee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",zee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",Gee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Hee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",Vee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",Qee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",jee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",Wee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",qee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",Xee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Yee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",Kee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",Jee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",Zee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",$ee="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",ete=new Map([[$t.ADD,xee],[$t.ALPHA,wee],[$t.AVERAGE,See],[$t.COLOR,Cee],[$t.COLOR_BURN,Eee],[$t.COLOR_DODGE,Tee],[$t.DARKEN,Mee],[$t.DIFFERENCE,Iee],[$t.DIVIDE,Ree],[$t.DST,null],[$t.EXCLUSION,Pee],[$t.HARD_LIGHT,Bee],[$t.HARD_MIX,Dee],[$t.HUE,Oee],[$t.INVERT,Lee],[$t.INVERT_RGB,kee],[$t.LIGHTEN,Fee],[$t.LINEAR_BURN,Uee],[$t.LINEAR_DODGE,Nee],[$t.LINEAR_LIGHT,zee],[$t.LUMINOSITY,Gee],[$t.MULTIPLY,Hee],[$t.NEGATION,Vee],[$t.NORMAL,Qee],[$t.OVERLAY,jee],[$t.PIN_LIGHT,Wee],[$t.REFLECT,qee],[$t.SATURATION,Xee],[$t.SCREEN,Yee],[$t.SOFT_LIGHT,Kee],[$t.SRC,Jee],[$t.SUBTRACT,Zee],[$t.VIVID_LIGHT,$ee]]),tte=class extends Zs{constructor(s,e=1){super(),this._blendFunction=s,this.opacity=new Se(e)}getOpacity(){return this.opacity.value}setOpacity(s){this.opacity.value=s}get blendFunction(){return this._blendFunction}set blendFunction(s){this._blendFunction=s,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(s){this.blendFunction=s}getShaderCode(){return ete.get(this.blendFunction)}},kc={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},ite=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,nte="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",ste=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],dH=class extends Rt{constructor(s=new Je){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Se(null),texelSize:new Se(new Je),scale:new Se(1),kernel:new Se(0)},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ite,vertexShader:nte}),this.setTexelSize(s.x,s.y),this.kernelSize=kc.MEDIUM}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.inputBuffer=s}get kernelSequence(){return ste[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(s){this.uniforms.scale.value=s}getScale(){return this.uniforms.scale.value}setScale(s){this.uniforms.scale.value=s}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(s){this.uniforms.kernel.value=s}setKernel(s){this.kernel=s}setTexelSize(s,e){this.uniforms.texelSize.value.set(s,e,s*.5,e*.5)}setSize(s,e){const t=1/s,i=1/e;this.uniforms.texelSize.value.set(t,i,t*.5,i*.5)}},oD=class extends $s{constructor({kernelSize:s=kc.MEDIUM,resolutionScale:e=.5,width:t=Hi.AUTO_SIZE,height:i=Hi.AUTO_SIZE,resolutionX:n=t,resolutionY:r=i}={}){super("KawaseBlurPass"),this.renderTargetA=new Yt(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new Hi(this,n,r,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new dH,this._blurMaterial.kernelSize=s,this.copyMaterial=new hH}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(s){this._blurMaterial=s}get dithering(){return this.copyMaterial.dithering}set dithering(s){this.copyMaterial.dithering=s}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(s){this.blurMaterial.kernelSize=s}get width(){return this.resolution.width}set width(s){this.resolution.preferredWidth=s}get height(){return this.resolution.height}set height(s){this.resolution.preferredHeight=s}get scale(){return this.blurMaterial.scale}set scale(s){this.blurMaterial.scale=s}getScale(){return this.blurMaterial.scale}setScale(s){this.blurMaterial.scale=s}getKernelSize(){return this.kernelSize}setKernelSize(s){this.kernelSize=s}getResolutionScale(){return this.resolution.scale}setResolutionScale(s){this.resolution.scale=s}render(s,e,t,i,n){const r=this.scene,o=this.camera,a=this.renderTargetA,l=this.renderTargetB,c=this.blurMaterial,h=c.kernelSequence;let d=e;this.fullscreenMaterial=c;for(let f=0,p=h.length;f<p;++f){const m=f&1?l:a;c.kernel=h[f],c.inputBuffer=d.texture,s.setRenderTarget(m),s.render(r,o),d=m}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=d.texture,s.setRenderTarget(this.renderToScreen?null:t),s.render(r,o)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e);const i=t.width,n=t.height;this.renderTargetA.setSize(i,n),this.renderTargetB.setSize(i,n),this.blurMaterial.setSize(s,e)}initialize(s,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==Ri?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):s!==null&&s.outputColorSpace===_t&&(this.renderTargetA.texture.colorSpace=_t,this.renderTargetB.texture.colorSpace=_t))}static get AUTO_SIZE(){return Hi.AUTO_SIZE}},rte=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,ote=class extends Rt{constructor(s=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Wc.replace(/\D+/g,"")},uniforms:{inputBuffer:new Se(null),threshold:new Se(0),smoothing:new Se(1),range:new Se(null)},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:rte,vertexShader:jp}),this.colorOutput=s,this.luminanceRange=e}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}get threshold(){return this.uniforms.threshold.value}set threshold(s){this.smoothing>0||s>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=s}getThreshold(){return this.threshold}setThreshold(s){this.threshold=s}get smoothing(){return this.uniforms.smoothing.value}set smoothing(s){this.threshold>0||s>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=s}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(s){this.smoothing=s}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(s){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(s){s?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(s){return this.colorOutput}setColorOutputEnabled(s){this.colorOutput=s}get useRange(){return this.luminanceRange!==null}set useRange(s){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(s){s!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=s,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(s){this.luminanceRange=s}},fH=class extends $s{constructor({renderTarget:s,luminanceRange:e,colorOutput:t,resolutionScale:i=1,width:n=Hi.AUTO_SIZE,height:r=Hi.AUTO_SIZE,resolutionX:o=n,resolutionY:a=r}={}){super("LuminancePass"),this.fullscreenMaterial=new ote(t,e),this.needsSwap=!1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new Yt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const l=this.resolution=new Hi(this,o,a,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(s,e,t,i,n){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,s.setRenderTarget(this.renderToScreen?null:this.renderTarget),s.render(this.scene,this.camera)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e),this.renderTarget.setSize(t.width,t.height)}initialize(s,e,t){t!==void 0&&t!==Ri&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},ate=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,lte="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",cte=class extends Rt{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new Se(null),texelSize:new Se(new Z)},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ate,vertexShader:lte})}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}},hte=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,ute="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",dte=class extends Rt{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new Se(null),supportBuffer:new Se(null),texelSize:new Se(new Z),radius:new Se(.85)},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:hte,vertexShader:ute})}set inputBuffer(s){this.uniforms.inputBuffer.value=s}set supportBuffer(s){this.uniforms.supportBuffer.value=s}get radius(){return this.uniforms.radius.value}set radius(s){this.uniforms.radius.value=s}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}},fte=class extends $s{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Yt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new cte,this.upsamplingMaterial=new dte,this.resolution=new Z}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(s){if(this.levels!==s){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<s;++t){const i=e.clone();i.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(i)}this.upsamplingMipmaps.push(e);for(let t=1,i=s-1;t<i;++t){const n=e.clone();n.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(n)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(s){this.upsamplingMaterial.radius=s}render(s,e,t,i,n){const{scene:r,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:l}=this,{downsamplingMipmaps:c,upsamplingMipmaps:h}=this;let d=e;this.fullscreenMaterial=a;for(let f=0,p=c.length;f<p;++f){const m=c[f];a.setSize(d.width,d.height),a.inputBuffer=d.texture,s.setRenderTarget(m),s.render(r,o),d=m}this.fullscreenMaterial=l;for(let f=h.length-1;f>=0;--f){const p=h[f];l.setSize(d.width,d.height),l.inputBuffer=d.texture,l.supportBuffer=c[f].texture,s.setRenderTarget(p),s.render(r,o),d=p}}setSize(s,e){const t=this.resolution;t.set(s,e);let i=t.width,n=t.height;for(let r=0,o=this.downsamplingMipmaps.length;r<o;++r)i=Math.round(i*.5),n=Math.round(n*.5),this.downsamplingMipmaps[r].setSize(i,n),r<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[r].setSize(i,n)}initialize(s,e,t){if(t!==void 0){const i=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const n of i)n.texture.type=t;if(t!==Ri)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(s!==null&&s.outputColorSpace===_t)for(const n of i)n.texture.colorSpace=_t}}dispose(){super.dispose();for(const s of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))s.dispose()}},Co=class extends Zs{constructor(s,e,{attributes:t=va.NONE,blendFunction:i=$t.NORMAL,defines:n=new Map,uniforms:r=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=s,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=a,this.defines=n,this.uniforms=r,this.extensions=o,this.blendMode=new tte(i),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=Ui,this._outputColorSpace=jr}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(s){this._inputColorSpace=s,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(s){this._outputColorSpace=s,this.setChanged()}set mainScene(s){}set mainCamera(s){}getName(){return this.name}setRenderer(s){this.renderer=s}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(s){this.attributes=s,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(s){this.fragmentShader=s,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(s){this.vertexShader=s,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(s,e=Sr){}update(s,e,t){}setSize(s,e){}initialize(s,e,t){}dispose(){for(const s of Object.keys(this)){const e=this[s];(e instanceof Yt||e instanceof Vt||e instanceof Pt||e instanceof $s)&&this[s].dispose()}}},pte=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,aD=class extends Co{constructor({blendFunction:e=$t.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,mipmapBlur:n=!1,intensity:r=1,radius:o=.85,levels:a=8,kernelSize:l=kc.LARGE,resolutionScale:c=.5,width:h=Hi.AUTO_SIZE,height:d=Hi.AUTO_SIZE,resolutionX:f=h,resolutionY:p=d}={}){super("BloomEffect",pte,{blendFunction:e,uniforms:new Map([["map",new Se(null)],["intensity",new Se(r)]])}),this.renderTarget=new Yt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new oD({kernelSize:l}),this.luminancePass=new fH({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=i,this.mipmapBlurPass=new fte,this.mipmapBlurPass.enabled=n,this.mipmapBlurPass.radius=o,this.mipmapBlurPass.levels=a,this.uniforms.get("map").value=n?this.mipmapBlurPass.texture:this.renderTarget.texture;const m=this.resolution=new Hi(this,f,p,c);m.addEventListener("change",v=>this.setSize(m.baseWidth,m.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){const n=this.renderTarget,r=this.luminancePass;r.enabled?(r.render(e,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,r.renderTarget):this.blurPass.render(e,r.renderTarget,n)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,t):this.blurPass.render(e,t,n)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i),this.luminancePass.setSize(e,t),this.mipmapBlurPass.setSize(e,t)}initialize(e,t,i){this.blurPass.initialize(e,t,i),this.luminancePass.initialize(e,t,i),this.mipmapBlurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e!==null&&e.outputColorSpace===_t&&(this.renderTarget.texture.colorSpace=_t))}},mte="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(color+vec3(0.5),inputColor.a);}",pH=class extends Co{constructor({blendFunction:s=$t.SRC,brightness:e=0,contrast:t=0}={}){super("BrightnessContrastEffect",mte,{blendFunction:s,uniforms:new Map([["brightness",new Se(e)],["contrast",new Se(t)]])}),this.inputColorSpace=_t}get brightness(){return this.uniforms.get("brightness").value}set brightness(s){this.uniforms.get("brightness").value=s}getBrightness(){return this.brightness}setBrightness(s){this.brightness=s}get contrast(){return this.uniforms.get("contrast").value}set contrast(s){this.uniforms.get("contrast").value=s}getContrast(){return this.contrast}setContrast(s){this.contrast=s}},gte=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,vte="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",mH=class extends Co{constructor({offset:s=new Z(.001,5e-4),radialModulation:e=!1,modulationOffset:t=.15}={}){super("ChromaticAberrationEffect",gte,{vertexShader:vte,attributes:va.CONVOLUTION,uniforms:new Map([["offset",new Se(s)],["modulationOffset",new Se(t)]])}),this.radialModulation=e}get offset(){return this.uniforms.get("offset").value}set offset(s){this.uniforms.get("offset").value=s}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(s){s?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(s){this.uniforms.get("modulationOffset").value=s}getOffset(){return this.offset}setOffset(s){this.offset=s}},gH={RED:0,GREEN:1,BLUE:2,ALPHA:3},vH={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},yte=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,nx=class extends Rt{constructor(s=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:s?"2":"1"},uniforms:{inputBuffer:new Se(null),cocBuffer:new Se(null),texelSize:new Se(new Z),kernel64:new Se(null),kernel16:new Se(null),scale:new Se(1)},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:yte,vertexShader:jp}),e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}set cocBuffer(s){this.uniforms.cocBuffer.value=s}setCoCBuffer(s){this.uniforms.cocBuffer.value=s}get scale(){return this.uniforms.scale.value}set scale(s){this.uniforms.scale.value=s}getScale(s){return this.scale}setScale(s){this.scale=s}generateKernel(){const s=2.39996323,e=new Float64Array(128),t=new Float64Array(32);let i=0,n=0;for(let r=0,o=Math.sqrt(80);r<80;++r){const a=r*s,l=Math.sqrt(r)/o,c=l*Math.cos(a),h=l*Math.sin(a);r%5===0?(t[n++]=c,t[n++]=h):(e[i++]=c,e[i++]=h)}this.uniforms.kernel64.value=e,this.uniforms.kernel16.value=t}setTexelSize(s,e){this.uniforms.texelSize.value.set(s,e)}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}};function ag(s,e,t){return s*(e-t)-e}function ip(s,e,t){return Math.min(Math.max((s+e)/(e-t),0),1)}var Ate=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,_te=class extends Rt{constructor(s){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Se(null),focusDistance:new Se(0),focusRange:new Se(0),cameraNear:new Se(.3),cameraFar:new Se(1e3)},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ate,vertexShader:jp}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(s)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=Sr){this.depthBuffer=s,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(s){this.uniforms.focusDistance.value=s}get worldFocusDistance(){return-ag(this.focusDistance,this.near,this.far)}set worldFocusDistance(s){this.focusDistance=ip(-s,this.near,this.far)}getFocusDistance(s){this.uniforms.focusDistance.value=s}setFocusDistance(s){this.uniforms.focusDistance.value=s}get focalLength(){return this.focusRange}set focalLength(s){this.focusRange=s}get focusRange(){return this.uniforms.focusRange.value}set focusRange(s){this.uniforms.focusRange.value=s}get worldFocusRange(){return-ag(this.focusRange,this.near,this.far)}set worldFocusRange(s){this.focusRange=ip(-s,this.near,this.far)}getFocalLength(s){return this.focusRange}setFocalLength(s){this.focusRange=s}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNear.value=s.near,this.uniforms.cameraFar.value=s.far,s instanceof zt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},bte=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,xte=class extends Rt{constructor(s=null){super({name:"MaskMaterial",uniforms:{maskTexture:new Se(s),inputBuffer:new Se(null),strength:new Se(1)},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:bte,vertexShader:jp}),this.colorChannel=gH.RED,this.maskFunction=vH.DISCARD}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}set maskTexture(s){this.uniforms.maskTexture.value=s,delete this.defines.MASK_PRECISION_HIGH,s.type!==Ri&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(s){this.maskTexture=s}set colorChannel(s){this.defines.COLOR_CHANNEL=s.toFixed(0),this.needsUpdate=!0}setColorChannel(s){this.colorChannel=s}set maskFunction(s){this.defines.MASK_FUNCTION=s.toFixed(0),this.needsUpdate=!0}setMaskFunction(s){this.maskFunction=s}get inverted(){return this.defines.INVERTED!==void 0}set inverted(s){this.inverted&&!s?delete this.defines.INVERTED:s&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(s){this.inverted=s}get strength(){return this.uniforms.strength.value}set strength(s){this.uniforms.strength.value=s}getStrength(){return this.strength}setStrength(s){this.strength=s}},pc=class extends $s{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.input=t}setInput(e){this.input=e}render(e,t,i,n,r){const o=this.fullscreenMaterial.uniforms;t!==null&&o!==void 0&&o[this.input]!==void 0&&(o[this.input].value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){i!==void 0&&i!==Ri&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},wte=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,yH=class extends Co{constructor(s,{blendFunction:e,worldFocusDistance:t,worldFocusRange:i,focusDistance:n=0,focalLength:r=.1,focusRange:o=r,bokehScale:a=1,resolutionScale:l=1,width:c=Hi.AUTO_SIZE,height:h=Hi.AUTO_SIZE,resolutionX:d=c,resolutionY:f=h}={}){super("DepthOfFieldEffect",wte,{blendFunction:e,attributes:va.DEPTH,uniforms:new Map([["nearColorBuffer",new Se(null)],["farColorBuffer",new Se(null)],["nearCoCBuffer",new Se(null)],["farCoCBuffer",new Se(null)],["scale",new Se(1)]])}),this.camera=s,this.renderTarget=new Yt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new pc(new _te(s));const p=this.cocMaterial;p.focusDistance=n,p.focusRange=o,t!==void 0&&(p.worldFocusDistance=t),i!==void 0&&(p.worldFocusRange=i),this.blurPass=new oD({resolutionScale:l,resolutionX:d,resolutionY:f,kernelSize:kc.MEDIUM}),this.maskPass=new pc(new xte(this.renderTargetCoC.texture));const m=this.maskPass.fullscreenMaterial;m.colorChannel=gH.GREEN,this.maskFunction=vH.MULTIPLY_RGB,this.bokehNearBasePass=new pc(new nx(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new pc(new nx(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new pc(new nx(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new pc(new nx(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const v=this.resolution=new Hi(this,d,f,l);v.addEventListener("change",y=>this.setSize(v.baseWidth,v.baseHeight)),this.bokehScale=a}set mainCamera(s){this.camera=s,this.cocMaterial.copyCameraSettings(s)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(s){this.maskFunction!==s&&(this.defines.set("MASK_FUNCTION",s.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=s,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(s){this.bokehNearBasePass.fullscreenMaterial.scale=s,this.bokehNearFillPass.fullscreenMaterial.scale=s,this.bokehFarBasePass.fullscreenMaterial.scale=s,this.bokehFarFillPass.fullscreenMaterial.scale=s,this.maskPass.fullscreenMaterial.strength=s,this.uniforms.get("scale").value=s}getBokehScale(){return this.bokehScale}setBokehScale(s){this.bokehScale=s}getTarget(){return this.target}setTarget(s){this.target=s}calculateFocusDistance(s){const e=this.camera,t=e.position.distanceTo(s);return ip(-t,e.near,e.far)}setDepthTexture(s,e=Sr){this.cocMaterial.depthBuffer=s,this.cocMaterial.depthPacking=e}update(s,e,t){const i=this.renderTarget,n=this.renderTargetCoC,r=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(this.target!==null){const a=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=a}this.cocPass.render(s,null,n),this.blurPass.render(s,n,r),this.maskPass.render(s,e,o),this.bokehFarBasePass.render(s,o,i),this.bokehFarFillPass.render(s,i,this.renderTargetFar),this.bokehNearBasePass.render(s,e,i),this.bokehNearFillPass.render(s,i,this.renderTargetNear)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e);const i=t.width,n=t.height;this.cocPass.setSize(s,e),this.blurPass.setSize(s,e),this.maskPass.setSize(s,e),this.renderTargetFar.setSize(s,e),this.renderTargetCoC.setSize(s,e),this.renderTargetMasked.setSize(s,e),this.renderTarget.setSize(i,n),this.renderTargetNear.setSize(i,n),this.renderTargetCoCBlurred.setSize(i,n),this.bokehNearBasePass.fullscreenMaterial.setSize(s,e),this.bokehNearFillPass.fullscreenMaterial.setSize(s,e),this.bokehFarBasePass.fullscreenMaterial.setSize(s,e),this.bokehFarFillPass.fullscreenMaterial.setSize(s,e)}initialize(s,e,t){this.cocPass.initialize(s,e,t),this.maskPass.initialize(s,e,t),this.bokehNearBasePass.initialize(s,e,t),this.bokehNearFillPass.initialize(s,e,t),this.bokehFarBasePass.initialize(s,e,t),this.bokehFarFillPass.initialize(s,e,t),this.blurPass.initialize(s,e,Ri),s.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),t!==void 0&&(this.renderTarget.texture.type=t,this.renderTargetNear.texture.type=t,this.renderTargetFar.texture.type=t,this.renderTargetMasked.texture.type=t,s!==null&&s.outputColorSpace===_t&&(this.renderTarget.texture.colorSpace=_t,this.renderTargetNear.texture.colorSpace=_t,this.renderTargetFar.texture.colorSpace=_t,this.renderTargetMasked.texture.colorSpace=_t))}};function Ste(s,e,t){const i=new Map([[mC,1],[Tl,1],[ld,2],[Ti,4]]);let n;if(i.has(e)||console.error("Invalid noise texture format"),t===Ri){n=new Uint8Array(s*i.get(e));for(let r=0,o=n.length;r<o;++r)n[r]=Math.random()*255+.5}else{n=new Float32Array(s*i.get(e));for(let r=0,o=n.length;r<o;++r)n[r]=Math.random()}return n}var Cte=class extends Go{constructor(s,e,t=mC,i=Ri){super(Ste(s*e,t,i),s,e,t,i),this.needsUpdate=!0}},uA={DEFAULT:0,KEEP_MAX_DEPTH:1,DISCARD_MAX_DEPTH:2},Ete=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;
#else
uniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;
#endif
uniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}varying vec2 vUv;void main(){vec2 depth;
#if DEPTH_PACKING_0 == 3201
depth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));
#else
depth.x=texture2D(depthBuffer0,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;
#endif
#endif
#if DEPTH_PACKING_1 == 3201
depth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));
#else
depth.y=texture2D(depthBuffer1,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;
#endif
#endif
bool isMaxDepth=(depth.x==1.0);
#ifdef PERSPECTIVE_CAMERA
depth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);
#endif
#if DEPTH_TEST_STRATEGY == 0
bool keep=depthTest(depth.x,depth.y);
#elif DEPTH_TEST_STRATEGY == 1
bool keep=isMaxDepth||depthTest(depth.x,depth.y);
#else
bool keep=!isMaxDepth&&depthTest(depth.x,depth.y);
#endif
if(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}`,Tte=class extends Rt{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:uA.KEEP_MAX_DEPTH},uniforms:{inputBuffer:new Se(null),depthBuffer0:new Se(null),depthBuffer1:new Se(null),cameraNearFar:new Se(new Z(1,1))},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ete,vertexShader:jp}),this.depthMode=qA}set depthBuffer0(s){this.uniforms.depthBuffer0.value=s}set depthPacking0(s){this.defines.DEPTH_PACKING_0=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(s,e=Sr){this.depthBuffer0=s,this.depthPacking0=e}set depthBuffer1(s){this.uniforms.depthBuffer1.value=s}set depthPacking1(s){this.defines.DEPTH_PACKING_1=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(s,e=Sr){this.depthBuffer1=s,this.depthPacking1=e}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(s){this.defines.DEPTH_TEST_STRATEGY=s.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(s){this.maxDepthStrategy=s?uA.KEEP_MAX_DEPTH:uA.DISCARD_MAX_DEPTH}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(s){this.maxDepthStrategy=s}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(s){this.defines.DEPTH_EPSILON=s.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(s){this.epsilon=s}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(s){let e;switch(s){case MP:e="false";break;case hC:e="true";break;case Hg:e="abs(d1 - d0) <= DEPTH_EPSILON";break;case Q0:e="abs(d1 - d0) > DEPTH_EPSILON";break;case qA:e="d0 > d1";break;case Tp:e="d0 >= d1";break;case uC:e="d0 <= d1";break;case dC:default:e="d0 < d1";break}this.defines.DEPTH_MODE=s.toFixed(0),this.defines["depthTest(d0, d1)"]=e,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(s){this.depthMode=s}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNearFar.value.set(s.near,s.far),s instanceof zt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},nE=class extends $s{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new iE,this.overrideMaterialManager=i===null?null:new Mk(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new Mk(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,n,r){const o=this.scene,a=this.camera,l=this.selection,c=a.layers.mask,h=o.background,d=e.shadowMap.autoUpdate,f=this.renderToScreen?null:t;l!==null&&a.layers.set(l.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(o.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(f),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,o,a):e.render(o,a),a.layers.mask=c,o.background=h,e.shadowMap.autoUpdate=d}},Mte="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",AH=class extends Co{constructor({blendFunction:s=$t.SRC,hue:e=0,saturation:t=0}={}){super("HueSaturationEffect",Mte,{blendFunction:s,uniforms:new Map([["hue",new Se(new w)],["saturation",new Se(t)]])}),this.hue=e}get saturation(){return this.uniforms.get("saturation").value}set saturation(s){this.uniforms.get("saturation").value=s}getSaturation(){return this.saturation}setSaturation(s){this.saturation=s}get hue(){const s=this.uniforms.get("hue").value;return Math.acos((s.x*3-1)/2)}set hue(s){const e=Math.sin(s),t=Math.cos(s);this.uniforms.get("hue").value.set((2*t+1)/3,(-Math.sqrt(3)*e-t+1)/3,(Math.sqrt(3)*e-t+1)/3)}getHue(){return this.hue}setHue(s){this.hue=s}},lD={DEPTH:0,LUMA:1,COLOR:2},Ite={DISABLED:0,DEPTH:1,CUSTOM:2},Vf={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},Rs={LINEAR:0,REINHARD:1,REINHARD2:2,REINHARD2_ADAPTIVE:3,UNCHARTED2:4,OPTIMIZED_CINEON:5,CINEON:5,ACES_FILMIC:6,AGX:7,NEUTRAL:8},sy={DEFAULT:0,ESKIL:1},Rte=class extends $s{constructor(s,e,{renderTarget:t,resolutionScale:i=1,width:n=Hi.AUTO_SIZE,height:r=Hi.AUTO_SIZE,resolutionX:o=n,resolutionY:a=r}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new nE(s,e,new J0({depthPacking:yC}));const l=this.renderPass;l.skipShadowMapUpdate=!0,l.ignoreBackground=!0;const c=l.clearPass;c.overrideClearColor=new me(16777215),c.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Yt(1,1,{minFilter:ei,magFilter:ei}),this.renderTarget.texture.name="DepthPass.Target");const h=this.resolution=new Hi(this,o,a,i);h.addEventListener("change",d=>this.setSize(h.baseWidth,h.baseHeight))}set mainScene(s){this.renderPass.mainScene=s}set mainCamera(s){this.renderPass.mainCamera=s}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(s){this.resolution.scale=s}render(s,e,t,i,n){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(s,r)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e),this.renderTarget.setSize(t.width,t.height)}},Pte="uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",_H=class extends Co{constructor(e=30){super("PixelationEffect",Pte,{uniforms:new Map([["active",new Se(!1)],["d",new Se(new Je)]])}),this.resolution=new Z,this._granularity=0,this.granularity=e}get granularity(){return this._granularity}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this._granularity=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){const i=this.resolution;i.set(e,t);const n=this.granularity,r=n/i.x,o=n/i.y;this.uniforms.get("d").value.set(r,o,1/r,1/o)}},bH=class extends aD{constructor(s,e,t){super(t),this.setAttributes(this.getAttributes()|va.DEPTH),this.camera=e,this.depthPass=new Rte(s,e),this.clearPass=new iE(!0,!1,!1),this.clearPass.overrideClearColor=new me(0),this.depthMaskPass=new pc(new Tte);const i=this.depthMaskMaterial;i.copyCameraSettings(e),i.depthBuffer1=this.depthPass.texture,i.depthPacking1=yC,i.depthMode=Hg,this.renderTargetMasked=new Yt(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new bee,this._inverted=!1,this._ignoreBackground=!1}set mainScene(s){this.depthPass.mainScene=s}set mainCamera(s){this.camera=s,this.depthPass.mainCamera=s,this.depthMaskMaterial.copyCameraSettings(s)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(s){this._inverted=s,this.depthMaskMaterial.depthMode=s?Q0:Hg}isInverted(){return this.inverted}setInverted(s){this.inverted=s}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(s){this._ignoreBackground=s,this.depthMaskMaterial.maxDepthStrategy=s?uA.DISCARD_MAX_DEPTH:uA.KEEP_MAX_DEPTH}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(s){this.ignoreBackground=s}setDepthTexture(s,e=Sr){this.depthMaskMaterial.depthBuffer0=s,this.depthMaskMaterial.depthPacking0=e}update(s,e,t){const i=this.camera,n=this.selection,r=this.inverted;let o=e;if(this.ignoreBackground||!r||n.size>0){const a=i.layers.mask;i.layers.set(n.layer),this.depthPass.render(s),i.layers.mask=a,o=this.renderTargetMasked,this.clearPass.render(s,o),this.depthMaskPass.render(s,e,o)}super.update(s,o,t)}setSize(s,e){super.setSize(s,e),this.renderTargetMasked.setSize(s,e),this.depthPass.setSize(s,e)}initialize(s,e,t){super.initialize(s,e,t),this.clearPass.initialize(s,e,t),this.depthPass.initialize(s,e,t),this.depthMaskPass.initialize(s,e,t),s!==null&&s.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),t!==void 0&&(this.renderTargetMasked.texture.type=t,s!==null&&s.outputColorSpace===_t&&(this.renderTargetMasked.texture.colorSpace=_t))}},Bte=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,Dte=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,Ote=class extends Rt{constructor(s=new Z,e=lD.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:Wc.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Se(null),depthBuffer:new Se(null),predicationBuffer:new Se(null),texelSize:new Se(s)},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Bte,vertexShader:Dte}),this.edgeDetectionMode=e}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=Sr){this.depthBuffer=s,this.depthPacking=e}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(s){this.defines.EDGE_DETECTION_MODE=s.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(s){this.edgeDetectionMode=s}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(s){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=s.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(s){this.localContrastAdaptationFactor=s}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(s){this.defines.EDGE_THRESHOLD=s.toFixed("6"),this.defines.DEPTH_THRESHOLD=(s*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(s){this.edgeDetectionThreshold=s}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(s){this.defines.PREDICATION_MODE=s.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(s){this.predicationMode=s}set predicationBuffer(s){this.uniforms.predicationBuffer.value=s}setPredicationBuffer(s){this.uniforms.predicationBuffer.value=s}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(s){this.defines.PREDICATION_THRESHOLD=s.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(s){this.predicationThreshold=s}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(s){this.defines.PREDICATION_SCALE=s.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(s){this.predicationScale=s}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(s){this.defines.PREDICATION_STRENGTH=s.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(s){this.predicationStrength=s}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}},Lte=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,kte="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",Fte=class extends Rt{constructor(s=new Z,e=new Z){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Se(null),searchTexture:new Se(null),areaTexture:new Se(null),resolution:new Se(e),texelSize:new Se(s)},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Lte,vertexShader:kte})}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(s){this.uniforms.searchTexture.value=s}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(s){this.uniforms.areaTexture.value=s}setLookupTextures(s,e){this.searchTexture=s,this.areaTexture=e}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(s){const e=Math.min(Math.max(s,0),112);this.defines.MAX_SEARCH_STEPS_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(s){this.orthogonalSearchSteps=s}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(s){const e=Math.min(Math.max(s,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(s){this.diagonalSearchSteps=s}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(s){s?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(s){this.diagonalDetection=s}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(s){const e=Math.min(Math.max(s,0),100);this.defines.CORNER_ROUNDING=e.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(e/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(s){this.cornerRounding=s}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(s){s?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(s){this.cornerDetection=s}setSize(s,e){const t=this.uniforms;t.texelSize.value.set(1/s,1/e),t.resolution.value.set(s,e)}},Ik="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",Rk="data:image/png;base64,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",Ute="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",Nte="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",xH=class extends Co{constructor({blendFunction:s=$t.SRC,preset:e=Vf.MEDIUM,edgeDetectionMode:t=lD.COLOR,predicationMode:i=Ite.DISABLED}={}){super("SMAAEffect",Ute,{vertexShader:Nte,blendFunction:s,attributes:va.CONVOLUTION|va.DEPTH,uniforms:new Map([["weightMap",new Se(null)]])});let n,r;arguments.length>1&&(n=arguments[0],r=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new Yt(1,1,{depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new iE(!0,!1,!1),this.clearPass.overrideClearColor=new me(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new pc(new Ote),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new pc(new Fte);const o=new zC;o.onLoad=()=>{const a=new Pt(n);a.name="SMAA.Search",a.magFilter=ei,a.minFilter=ei,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;const l=new Pt(r);l.name="SMAA.Area",l.magFilter=Nt,l.minFilter=Nt,l.generateMipmaps=!1,l.needsUpdate=!0,l.flipY=!1,this.weightsMaterial.areaTexture=l,this.dispatchEvent({type:"load"})},o.itemStart("search"),o.itemStart("area"),n!==void 0&&r!==void 0?(o.itemEnd("search"),o.itemEnd("area")):typeof Image<"u"&&(n=new Image,r=new Image,n.addEventListener("load",()=>o.itemEnd("search")),r.addEventListener("load",()=>o.itemEnd("area")),n.src=Ik,r.src=Rk),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(s){this.edgeDetectionMaterial.edgeDetectionThreshold=s}setOrthogonalSearchSteps(s){this.weightsMaterial.orthogonalSearchSteps=s}applyPreset(s){const e=this.edgeDetectionMaterial,t=this.weightsMaterial;switch(s){case Vf.LOW:e.edgeDetectionThreshold=.15,t.orthogonalSearchSteps=4,t.diagonalDetection=!1,t.cornerDetection=!1;break;case Vf.MEDIUM:e.edgeDetectionThreshold=.1,t.orthogonalSearchSteps=8,t.diagonalDetection=!1,t.cornerDetection=!1;break;case Vf.HIGH:e.edgeDetectionThreshold=.1,t.orthogonalSearchSteps=16,t.diagonalSearchSteps=8,t.cornerRounding=25,t.diagonalDetection=!0,t.cornerDetection=!0;break;case Vf.ULTRA:e.edgeDetectionThreshold=.05,t.orthogonalSearchSteps=32,t.diagonalSearchSteps=16,t.cornerRounding=25,t.diagonalDetection=!0,t.cornerDetection=!0;break}}setDepthTexture(s,e=Sr){this.edgeDetectionMaterial.depthBuffer=s,this.edgeDetectionMaterial.depthPacking=e}update(s,e,t){this.clearPass.render(s,this.renderTargetEdges),this.edgeDetectionPass.render(s,e,this.renderTargetEdges),this.weightsPass.render(s,this.renderTargetEdges,this.renderTargetWeights)}setSize(s,e){this.edgeDetectionMaterial.setSize(s,e),this.weightsMaterial.setSize(s,e),this.renderTargetEdges.setSize(s,e),this.renderTargetWeights.setSize(s,e)}dispose(){const{searchTexture:s,areaTexture:e}=this.weightsMaterial;s!==null&&e!==null&&(s.dispose(),e.dispose()),super.dispose()}static get searchImageDataURL(){return Ik}static get areaImageDataURL(){return Rk}},zte=`#include <common>
#include <packing>
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
uniform lowp sampler2D normalBuffer;
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
uniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform vec2 cameraNearFar;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);
#ifdef PERSPECTIVE_CAMERA
float linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearSampleDepth=sampleDepth;
#endif
float proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){
#ifdef NORMAL_DEPTH
vec4 normalDepth=texture2D(normalDepthBuffer,vUv);
#else
vec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));
#endif
float ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);
#ifdef PERSPECTIVE_CAMERA
float linearDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearDepth=depth;
#endif
if(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);
#ifdef LEGACY_INTENSITY
ao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);
#endif
}gl_FragColor.r=ao;}`,Gte="uniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}",Hte=class extends Rt{constructor(s){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Se(null),normalBuffer:new Se(null),normalDepthBuffer:new Se(null),noiseTexture:new Se(null),inverseProjectionMatrix:new Se(new fe),projectionMatrix:new Se(new fe),texelSize:new Se(new Z),cameraNearFar:new Se(new Z),distanceCutoff:new Se(new Z),proximityCutoff:new Se(new Z),noiseScale:new Se(new Z),minRadiusScale:new Se(.33),intensity:new Se(1),fade:new Se(.01),bias:new Se(0)},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:zte,vertexShader:Gte}),this.copyCameraSettings(s),this.resolution=new Z,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(s){this.uniforms.normalDepthBuffer.value=s,s!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(s){this.normalDepthBuffer=s}set normalBuffer(s){this.uniforms.normalBuffer.value=s}setNormalBuffer(s){this.uniforms.normalBuffer.value=s}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=Sr){this.depthBuffer=s,this.depthPacking=e}set noiseTexture(s){this.uniforms.noiseTexture.value=s}setNoiseTexture(s){this.uniforms.noiseTexture.value=s}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(s){this.defines.SAMPLES_INT=s.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/s).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(s){this.samples=s}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(s){this.defines.SPIRAL_TURNS=s.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(s){this.rings=s}get intensity(){return this.uniforms.intensity.value}set intensity(s){this.uniforms.intensity.value=s,this.defines.LEGACY_INTENSITY===void 0&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(s){this.uniforms.intensity.value=s}get fade(){return this.uniforms.fade.value}set fade(s){this.uniforms.fade.value=s}getFade(){return this.uniforms.fade.value}setFade(s){this.uniforms.fade.value=s}get bias(){return this.uniforms.bias.value}set bias(s){this.uniforms.bias.value=s}getBias(){return this.uniforms.bias.value}setBias(s){this.uniforms.bias.value=s}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(s){this.uniforms.minRadiusScale.value=s}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(s){this.uniforms.minRadiusScale.value=s}updateRadius(){const s=this.r*this.resolution.height;this.defines.RADIUS=s.toFixed(11),this.defines.RADIUS_SQ=(s*s).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(s){this.r=Math.min(Math.max(s,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(s){this.radius=s}get distanceScaling(){return!0}set distanceScaling(s){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(s){this.distanceScaling=s}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(s){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-ag(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(s){this.distanceThreshold=ip(-s,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(s){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+s,0),1)}get worldDistanceFalloff(){return-ag(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(s){this.distanceFalloff=ip(-s,this.near,this.far)}setDistanceCutoff(s,e){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+e,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(s){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-ag(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(s){this.proximityThreshold=ip(-s,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(s){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+s,0),1)}get worldProximityFalloff(){return-ag(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(s){this.proximityFalloff=ip(-s,this.near,this.far)}setProximityCutoff(s,e){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+e,0),1))}setTexelSize(s,e){this.uniforms.texelSize.value.set(s,e)}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNearFar.value.set(s.near,s.far),this.uniforms.projectionMatrix.value.copy(s.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(s.projectionMatrix).invert(),s instanceof zt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(s,e){const t=this.uniforms,i=t.noiseTexture.value;i!==null&&t.noiseScale.value.set(s/i.image.width,e/i.image.height),t.texelSize.value.set(1/s,1/e),this.resolution.set(s,e),this.updateRadius()}},Vte=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,Qte="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",jte=class extends Rt{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Se(null),normalBuffer:new Se(null),texelSize:new Se(new Z)},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Vte,vertexShader:Qte})}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=Sr){this.depthBuffer=s,this.depthPacking=e}set normalBuffer(s){this.uniforms.normalBuffer.value=s,s!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(s){this.normalBuffer=s}setTexelSize(s,e){this.uniforms.texelSize.value.set(s,e)}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}},cD=class extends $s{constructor({normalBuffer:s=null,resolutionScale:e=.5,width:t=Hi.AUTO_SIZE,height:i=Hi.AUTO_SIZE,resolutionX:n=t,resolutionY:r=i}={}){super("DepthDownsamplingPass");const o=new jte;o.normalBuffer=s,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Yt(1,1,{minFilter:ei,magFilter:ei,depthBuffer:!1,type:vn}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new Hi(this,n,r,e);a.addEventListener("change",l=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(s,e=Sr){this.fullscreenMaterial.depthBuffer=s,this.fullscreenMaterial.depthPacking=e}render(s,e,t,i,n){s.setRenderTarget(this.renderToScreen?null:this.renderTarget),s.render(this.scene,this.camera)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e),this.renderTarget.setSize(t.width,t.height),this.fullscreenMaterial.setSize(s,e)}initialize(s,e,t){const i=s.getContext();if(!(i.getExtension("EXT_color_buffer_float")||i.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},Wte=`uniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
#endif
#ifdef COLORIZE
uniform vec3 color;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300
vec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);
#else
float ao=aoLinear;
#endif
float l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);
#ifdef COLORIZE
outputColor=vec4(1.0-ao*(1.0-color),inputColor.a);
#else
outputColor=vec4(vec3(1.0-ao),inputColor.a);
#endif
}`,Pk=64,wH=class extends Co{constructor(s,e,{blendFunction:t=$t.MULTIPLY,samples:i=9,rings:n=7,normalDepthBuffer:r=null,depthAwareUpsampling:o=!0,worldDistanceThreshold:a,worldDistanceFalloff:l,worldProximityThreshold:c,worldProximityFalloff:h,distanceThreshold:d=.97,distanceFalloff:f=.03,rangeThreshold:p=5e-4,rangeFalloff:m=.001,minRadiusScale:v=.1,luminanceInfluence:y=.7,radius:g=.1825,intensity:_=1,bias:A=.025,fade:b=.01,color:E=null,resolutionScale:C=1,width:T=Hi.AUTO_SIZE,height:M=Hi.AUTO_SIZE,resolutionX:R=T,resolutionY:S=M}={}){super("SSAOEffect",Wte,{blendFunction:t,attributes:va.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new Se(null)],["normalDepthBuffer",new Se(r)],["luminanceInfluence",new Se(y)],["color",new Se(null)],["intensity",new Se(_)],["scale",new Se(0)]])}),this.renderTarget=new Yt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const I=this.resolution=new Hi(this,R,S,C);I.addEventListener("change",D=>this.setSize(I.baseWidth,I.baseHeight)),this.camera=s,this.depthDownsamplingPass=new cD({normalBuffer:e,resolutionScale:C}),this.depthDownsamplingPass.enabled=r===null,this.ssaoPass=new pc(new Hte(s));const L=new Cte(Pk,Pk,Ti);L.wrapS=L.wrapT=wo;const U=this.ssaoMaterial;U.normalBuffer=e,U.noiseTexture=L,U.minRadiusScale=v,U.samples=i,U.radius=g,U.rings=n,U.fade=b,U.bias=A,U.distanceThreshold=d,U.distanceFalloff=f,U.proximityThreshold=p,U.proximityFalloff=m,a!==void 0&&(U.worldDistanceThreshold=a),l!==void 0&&(U.worldDistanceFalloff=l),c!==void 0&&(U.worldProximityThreshold=c),h!==void 0&&(U.worldProximityFalloff=h),r!==null&&(this.ssaoMaterial.normalDepthBuffer=r,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=o,this.color=E}set mainCamera(s){this.camera=s,this.ssaoMaterial.copyCameraSettings(s)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(s){this.ssaoMaterial.normalBuffer=s,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=s}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(s){this.ssaoMaterial.samples=s}get rings(){return this.ssaoMaterial.rings}set rings(s){this.ssaoMaterial.rings=s}get radius(){return this.ssaoMaterial.radius}set radius(s){this.ssaoMaterial.radius=s}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(s){this.depthAwareUpsampling!==s&&(s?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(s){this.depthAwareUpsampling=s}get distanceScaling(){return!0}set distanceScaling(s){}get color(){return this.uniforms.get("color").value}set color(s){const e=this.uniforms,t=this.defines;s!==null?t.has("COLORIZE")?e.get("color").value.set(s):(t.set("COLORIZE","1"),e.get("color").value=new me(s),this.setChanged()):t.has("COLORIZE")&&(t.delete("COLORIZE"),e.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(s){this.uniforms.get("luminanceInfluence").value=s}get intensity(){return this.uniforms.get("intensity").value}set intensity(s){this.uniforms.get("intensity").value=s}getColor(){return this.color}setColor(s){this.color=s}setDistanceCutoff(s,e){this.ssaoMaterial.distanceThreshold=s,this.ssaoMaterial.distanceFalloff=e}setProximityCutoff(s,e){this.ssaoMaterial.proximityThreshold=s,this.ssaoMaterial.proximityFalloff=e}setDepthTexture(s,e=Sr){this.depthDownsamplingPass.setDepthTexture(s,e),this.ssaoMaterial.depthBuffer=s,this.ssaoMaterial.depthPacking=e}update(s,e,t){const i=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(s),this.ssaoPass.render(s,null,i)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e);const i=t.width,n=t.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(i,n),this.renderTarget.setSize(i,n),this.depthDownsamplingPass.resolution.scale=t.scale,this.depthDownsamplingPass.setSize(s,e)}initialize(s,e,t){try{let i=this.uniforms.get("normalDepthBuffer").value;i===null&&(this.depthDownsamplingPass.initialize(s,e,t),i=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=i,this.ssaoMaterial.normalDepthBuffer=i,this.defines.set("NORMAL_DEPTH","1"))}catch{this.depthDownsamplingPass.enabled=!1}}},qte=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Xte="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",Yte=class extends dH{constructor({kernelSize:s=kc.MEDIUM,offset:e=0,rotation:t=0,focusArea:i=.4,feather:n=.3}={}){super(),this.fragmentShader=qte,this.vertexShader=Xte,this.kernelSize=s,this.uniforms.aspect=new Se(1),this.uniforms.rotation=new Se(new Z),this.uniforms.maskParams=new Se(new Je),this._offset=e,this._focusArea=i,this._feather=n,this.rotation=t,this.updateParams()}updateParams(){const s=this.uniforms.maskParams.value,e=Math.max(this.focusArea,0),t=Math.max(e-this.feather,0);s.set(this.offset-e,this.offset-t,this.offset+e,this.offset+t)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(s){this.uniforms.rotation.value.set(Math.cos(s),Math.sin(s))}get offset(){return this._offset}set offset(s){this._offset=s,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(s){this._focusArea=s,this.updateParams()}get feather(){return this._feather}set feather(s){this._feather=s,this.updateParams()}setSize(s,e){super.setSize(s,e),this.uniforms.aspect.value=s/e}},Kte=class extends oD{constructor({offset:s=0,rotation:e=0,focusArea:t=.4,feather:i=.3,kernelSize:n=kc.MEDIUM,resolutionScale:r=.5,resolutionX:o=Hi.AUTO_SIZE,resolutionY:a=Hi.AUTO_SIZE}={}){super({kernelSize:n,resolutionScale:r,resolutionX:o,resolutionY:a}),this.blurMaterial=new Yte({kernelSize:n,offset:s,rotation:e,focusArea:t,feather:i})}},Jte=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}`,Zte="uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",SH=class extends Co{constructor({blendFunction:e,offset:t=0,rotation:i=0,focusArea:n=.4,feather:r=.3,kernelSize:o=kc.MEDIUM,resolutionScale:a=.5,resolutionX:l=Hi.AUTO_SIZE,resolutionY:c=Hi.AUTO_SIZE}={}){super("TiltShiftEffect",Jte,{vertexShader:Zte,blendFunction:e,uniforms:new Map([["rotation",new Se(new Z)],["maskParams",new Se(new Z)],["map",new Se(null)]])}),this._offset=t,this._focusArea=n,this._feather=r,this.renderTarget=new Yt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new Kte({kernelSize:o,resolutionScale:a,resolutionX:l,resolutionY:c,offset:t,rotation:i,focusArea:n,feather:r});const h=this.resolution=new Hi(this,l,c,a);h.addEventListener("change",d=>this.setSize(h.baseWidth,h.baseHeight)),this.rotation=i,this.updateParams()}updateParams(){const e=this.uniforms.get("maskParams").value,t=Math.max(this.focusArea-this.feather,0);e.set(this.offset-t,this.offset+t)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(e){this.uniforms.get("rotation").value.set(Math.cos(e),Math.sin(e)),this.blurPass.blurMaterial.rotation=e}get offset(){return this._offset}set offset(e){this._offset=e,this.blurPass.blurMaterial.offset=e,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(e){this._focusArea=e,this.blurPass.blurMaterial.focusArea=e,this.updateParams()}get feather(){return this._feather}set feather(e){this._feather=e,this.blurPass.blurMaterial.feather=e,this.updateParams()}get bias(){return 0}set bias(e){}update(e,t,i){this.blurPass.render(e,t,this.renderTarget)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e!==null&&e.outputColorSpace===_t&&(this.renderTarget.texture.colorSpace=_t))}},$te=`#include <packing>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
uniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));
#if __VERSION__ < 300
float l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#else
float l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#endif
l0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}`,eie=class extends Rt{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new Se(null),luminanceBuffer1:new Se(null),minLuminance:new Se(.01),deltaTime:new Se(0),tau:new Se(1)},extensions:{shaderTextureLOD:!0},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:$te,vertexShader:jp})}set luminanceBuffer0(s){this.uniforms.luminanceBuffer0.value=s}setLuminanceBuffer0(s){this.uniforms.luminanceBuffer0.value=s}set luminanceBuffer1(s){this.uniforms.luminanceBuffer1.value=s}setLuminanceBuffer1(s){this.uniforms.luminanceBuffer1.value=s}set mipLevel1x1(s){this.defines.MIP_LEVEL_1X1=s.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(s){this.mipLevel1x1=s}set deltaTime(s){this.uniforms.deltaTime.value=s}setDeltaTime(s){this.uniforms.deltaTime.value=s}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(s){this.uniforms.minLuminance.value=s}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(s){this.uniforms.minLuminance.value=s}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(s){this.uniforms.tau.value=s}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(s){this.uniforms.tau.value=s}},tie=class extends $s{constructor(s,{minLuminance:e=.01,adaptationRate:t=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new eie,this.needsSwap=!1,this.renderTargetPrevious=new Yt(1,1,{minFilter:ei,magFilter:ei,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const i=this.fullscreenMaterial;i.luminanceBuffer0=this.renderTargetPrevious.texture,i.luminanceBuffer1=s,i.minLuminance=e,i.adaptationRate=t,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new uH(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(s){this.fullscreenMaterial.mipLevel1x1=s}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(s){this.fullscreenMaterial.adaptationRate=s}render(s,e,t,i,n){this.fullscreenMaterial.deltaTime=i,s.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),s.render(this.scene,this.camera),this.copyPass.render(s,this.renderTargetAdapted)}},iie=`#include <tonemapping_pars_fragment>
uniform float whitePoint;
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
uniform float middleGrey;
#if TONE_MAPPING_MODE == 3
uniform lowp sampler2D luminanceBuffer;
#else
uniform float averageLuminance;
#endif
vec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);
#if TONE_MAPPING_MODE == 3
float lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));
#else
float lumAvg=averageLuminance;
#endif
float lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}
#elif TONE_MAPPING_MODE == 4
#define A 0.15
#define B 0.50
#define C 0.10
#define D 0.20
#define E 0.02
#define F 0.30
vec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
outputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);
#elif TONE_MAPPING_MODE == 4
outputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);
#else
outputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);
#endif
}`,oS=class extends Co{constructor({blendFunction:e=$t.SRC,adaptive:t=!1,mode:i=t?Rs.REINHARD2_ADAPTIVE:Rs.AGX,resolution:n=256,maxLuminance:r=4,whitePoint:o=r,middleGrey:a=.6,minLuminance:l=.01,averageLuminance:c=1,adaptationRate:h=1}={}){super("ToneMappingEffect",iie,{blendFunction:e,uniforms:new Map([["luminanceBuffer",new Se(null)],["maxLuminance",new Se(r)],["whitePoint",new Se(o)],["middleGrey",new Se(a)],["averageLuminance",new Se(c)]])}),this.renderTargetLuminance=new Yt(1,1,{minFilter:go,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new fH({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new tie(this.luminancePass.texture,{minLuminance:l,adaptationRate:h}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=n,this.mode=i}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(e){if(this.mode===e)return;const i=Wc.replace(/\D+/g,"")>=168?"CineonToneMapping(texel)":"OptimizedCineonToneMapping(texel)";switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",e.toFixed(0)),e){case Rs.LINEAR:this.defines.set("toneMapping(texel)","LinearToneMapping(texel)");break;case Rs.REINHARD:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case Rs.CINEON:case Rs.OPTIMIZED_CINEON:this.defines.set("toneMapping(texel)",i);break;case Rs.ACES_FILMIC:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;case Rs.AGX:this.defines.set("toneMapping(texel)","AgXToneMapping(texel)");break;case Rs.NEUTRAL:this.defines.set("toneMapping(texel)","NeutralToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel");break}this.adaptiveLuminancePass.enabled=e===Rs.REINHARD2_ADAPTIVE,this.setChanged()}getMode(){return this.mode}setMode(e){this.mode=e}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(e){this.uniforms.get("whitePoint").value=e}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(e){this.uniforms.get("middleGrey").value=e}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(e){this.uniforms.get("averageLuminance").value=e}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(e){const t=Math.max(0,Math.ceil(Math.log2(e))),i=Math.pow(2,t);this.luminancePass.resolution.setPreferredSize(i,i),this.adaptiveLuminanceMaterial.mipLevel1x1=t}getResolution(){return this.resolution}setResolution(e){this.resolution=e}get adaptive(){return this.mode===Rs.REINHARD2_ADAPTIVE}set adaptive(e){this.mode=e?Rs.REINHARD2_ADAPTIVE:Rs.REINHARD2}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(e){this.adaptiveLuminanceMaterial.adaptationRate=e}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(e){console.warn(this.name,"distinction was removed.")}update(e,t,i){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(e,t),this.adaptiveLuminancePass.render(e,null,null,i))}initialize(e,t,i){this.adaptiveLuminancePass.initialize(e,t,i)}},nie=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,CH=class extends Co{constructor({blendFunction:s,eskil:e=!1,technique:t=e?sy.ESKIL:sy.DEFAULT,offset:i=.5,darkness:n=.5}={}){super("VignetteEffect",nie,{blendFunction:s,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new Se(i)],["darkness",new Se(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(s){this.technique!==s&&(this.defines.set("VIGNETTE_TECHNIQUE",s.toFixed(0)),this.setChanged())}get eskil(){return this.technique===sy.ESKIL}set eskil(s){this.technique=s?sy.ESKIL:sy.DEFAULT}getTechnique(){return this.technique}setTechnique(s){this.technique=s}get offset(){return this.uniforms.get("offset").value}set offset(s){this.uniforms.get("offset").value=s}getOffset(){return this.offset}setOffset(s){this.offset=s}get darkness(){return this.uniforms.get("darkness").value}set darkness(s){this.uniforms.get("darkness").value=s}getDarkness(){return this.darkness}setDarkness(s){this.darkness=s}},sie=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,rie="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",oie=class extends Rt{constructor(s,e,t,i,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Wc.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Se(null),depthBuffer:new Se(null),resolution:new Se(new Z),texelSize:new Se(new Z),cameraNear:new Se(.3),cameraFar:new Se(1e3),aspect:new Se(1),time:new Se(0)},blending:An,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:n}),s&&this.setShaderParts(s),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(i)}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(s){this.uniforms.depthBuffer.value=s}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=Sr){this.depthBuffer=s,this.depthPacking=e}setShaderData(s){this.setShaderParts(s.shaderParts),this.setDefines(s.defines),this.setUniforms(s.uniforms),this.setExtensions(s.extensions)}setShaderParts(s){return this.fragmentShader=sie.replace(Oi.FRAGMENT_HEAD,s.get(Oi.FRAGMENT_HEAD)||"").replace(Oi.FRAGMENT_MAIN_UV,s.get(Oi.FRAGMENT_MAIN_UV)||"").replace(Oi.FRAGMENT_MAIN_IMAGE,s.get(Oi.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=rie.replace(Oi.VERTEX_HEAD,s.get(Oi.VERTEX_HEAD)||"").replace(Oi.VERTEX_MAIN_SUPPORT,s.get(Oi.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(s){for(const e of s.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(s){for(const e of s.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(s){this.extensions={};for(const e of s)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(s){this.encodeOutput!==s&&(s?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(s){return this.encodeOutput}setOutputEncodingEnabled(s){this.encodeOutput=s}get time(){return this.uniforms.time.value}set time(s){this.uniforms.time.value=s}setDeltaTime(s){this.uniforms.time.value+=s}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNear.value=s.near,this.uniforms.cameraFar.value=s.far,s instanceof zt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(s,e){const t=this.uniforms;t.resolution.value.set(s,e),t.texelSize.value.set(1/s,1/e),t.aspect.value=s/e}static get Section(){return Oi}};function Bk(s,e,t){for(const i of e){const n="$1"+s+i.charAt(0).toUpperCase()+i.slice(1),r=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(r,n))}}function aie(s,e,t){let i=e.getFragmentShader(),n=e.getVertexShader();const r=i!==void 0&&/mainImage/.test(i),o=i!==void 0&&/mainUv/.test(i);if(t.attributes|=e.getAttributes(),i===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&t.attributes&va.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!r&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=t.shaderParts;let c=l.get(Oi.FRAGMENT_HEAD)||"",h=l.get(Oi.FRAGMENT_MAIN_UV)||"",d=l.get(Oi.FRAGMENT_MAIN_IMAGE)||"",f=l.get(Oi.VERTEX_HEAD)||"",p=l.get(Oi.VERTEX_MAIN_SUPPORT)||"";const m=new Set,v=new Set;if(o&&(h+=`	${s}MainUv(UV);
`,t.uvTransformation=!0),n!==null&&/mainSupport/.test(n)){const _=/mainSupport *\([\w\s]*?uv\s*?\)/.test(n);p+=`	${s}MainSupport(`,p+=_?`vUv);
`:`);
`;for(const A of n.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const b of A[1].split(/\s*,\s*/))t.varyings.add(b),m.add(b),v.add(b);for(const A of n.matchAll(a))v.add(A[1])}for(const _ of i.matchAll(a))v.add(_[1]);for(const _ of e.defines.keys())v.add(_.replace(/\([\w\s,]*\)/g,""));for(const _ of e.uniforms.keys())v.add(_);v.delete("while"),v.delete("for"),v.delete("if"),e.uniforms.forEach((_,A)=>t.uniforms.set(s+A.charAt(0).toUpperCase()+A.slice(1),_)),e.defines.forEach((_,A)=>t.defines.set(s+A.charAt(0).toUpperCase()+A.slice(1),_));const y=new Map([["fragment",i],["vertex",n]]);Bk(s,v,t.defines),Bk(s,v,y),i=y.get("fragment"),n=y.get("vertex");const g=e.blendMode;if(t.blendModes.set(g.blendFunction,g),r){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(d+=e.inputColorSpace===_t?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==jr?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const _=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;d+=`${s}MainImage(color0, UV, `,t.attributes&va.DEPTH&&_.test(i)&&(d+="depth, ",t.readDepth=!0),d+=`color1);
	`;const A=s+"BlendOpacity";t.uniforms.set(A,g.opacity),d+=`color0 = blend${g.blendFunction}(color0, color1, ${A});

	`,c+=`uniform float ${A};

`}if(c+=i+`
`,n!==null&&(f+=n+`
`),l.set(Oi.FRAGMENT_HEAD,c),l.set(Oi.FRAGMENT_MAIN_UV,h),l.set(Oi.FRAGMENT_MAIN_IMAGE,d),l.set(Oi.VERTEX_HEAD,f),l.set(Oi.VERTEX_MAIN_SUPPORT,p),e.extensions!==null)for(const _ of e.extensions)t.extensions.add(_)}}var Dk=class extends $s{constructor(s,...e){super("EffectPass"),this.fullscreenMaterial=new oie(null,null,null,s),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(s){for(const e of this.effects)e.mainScene=s}set mainCamera(s){this.fullscreenMaterial.copyCameraSettings(s);for(const e of this.effects)e.mainCamera=s}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(s){this.fullscreenMaterial.encodeOutput=s}get dithering(){return this.fullscreenMaterial.dithering}set dithering(s){const e=this.fullscreenMaterial;e.dithering=s,e.needsUpdate=!0}setEffects(s){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=s.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const s=new Aee;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===$t.DST)s.attributes|=o.getAttributes()&va.DEPTH;else{if(s.attributes&o.getAttributes()&va.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);aie("e"+e++,o,s)}let t=s.shaderParts.get(Oi.FRAGMENT_HEAD),i=s.shaderParts.get(Oi.FRAGMENT_MAIN_IMAGE),n=s.shaderParts.get(Oi.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const o of s.blendModes.values())t+=o.getShaderCode().replace(r,`blend${o.blendFunction}`)+`
`;s.attributes&va.DEPTH?(s.readDepth&&(i=`float depth = readDepth(UV);

	`+i),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,s.colorSpace===_t&&(i+=`color0 = sRGBToLinear(color0);
	`),s.uvTransformation?(n=`vec2 transformedUv = vUv;
`+n,s.defines.set("UV","transformedUv")):s.defines.set("UV","vUv"),s.shaderParts.set(Oi.FRAGMENT_HEAD,t),s.shaderParts.set(Oi.FRAGMENT_MAIN_IMAGE,i),s.shaderParts.set(Oi.FRAGMENT_MAIN_UV,n);for(const[o,a]of s.shaderParts)a!==null&&s.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(s)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(s,e=Sr){this.fullscreenMaterial.depthBuffer=s,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(s,e)}render(s,e,t,i,n){for(const r of this.effects)r.update(s,e,i);if(!this.skipRendering||this.renderToScreen){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,r.time+=i*this.timeScale,s.setRenderTarget(this.renderToScreen?null:t),s.render(this.scene,this.camera)}}setSize(s,e){this.fullscreenMaterial.setSize(s,e);for(const t of this.effects)t.setSize(s,e)}initialize(s,e,t){this.renderer=s;for(const i of this.effects)i.initialize(s,e,t);this.updateMaterial(),t!==void 0&&t!==Ri&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const s of this.effects)s.removeEventListener("change",this.listener),s.dispose()}handleEvent(s){switch(s.type){case"change":this.recompile();break}}},EH=class extends $s{constructor(s,e,{renderTarget:t,resolutionScale:i=1,width:n=Hi.AUTO_SIZE,height:r=Hi.AUTO_SIZE,resolutionX:o=n,resolutionY:a=r}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new nE(s,e,new NC);const l=this.renderPass;l.ignoreBackground=!0,l.skipShadowMapUpdate=!0;const c=l.getClearPass();c.overrideClearColor=new me(7829503),c.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Yt(1,1,{minFilter:ei,magFilter:ei}),this.renderTarget.texture.name="NormalPass.Target");const h=this.resolution=new Hi(this,o,a,i);h.addEventListener("change",d=>this.setSize(h.baseWidth,h.baseHeight))}set mainScene(s){this.renderPass.mainScene=s}set mainCamera(s){this.renderPass.mainCamera=s}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(s){this.resolution.scale=s}render(s,e,t,i,n){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(s,r,r)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e),this.renderTarget.setSize(t.width,t.height)}},dA=function(){var s=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(h){h.preventDefault(),i(++s%e.children.length)},!1);function t(h){return e.appendChild(h.dom),h}function i(h){for(var d=0;d<e.children.length;d++)e.children[d].style.display=d===h?"block":"none";s=h}var n=(performance||Date).now(),r=n,o=0,a=t(new dA.Panel("FPS","#0ff","#002")),l=t(new dA.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new dA.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:e,addPanel:t,showPanel:i,begin:function(){n=(performance||Date).now()},end:function(){o++;var h=(performance||Date).now();if(l.update(h-n,200),h>=r+1e3&&(a.update(o*1e3/(h-r),100),r=h,o=0,c)){var d=performance.memory;c.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return h},update:function(){n=this.end()},domElement:e,setMode:i}};dA.Panel=function(s,e,t){var i=1/0,n=0,r=Math.round,o=r(window.devicePixelRatio||1),a=80*o,l=48*o,c=3*o,h=2*o,d=3*o,f=15*o,p=74*o,m=30*o,v=document.createElement("canvas");v.width=a,v.height=l,v.style.cssText="width:80px;height:48px";var y=v.getContext("2d");return y.font="bold "+9*o+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=t,y.fillRect(0,0,a,l),y.fillStyle=e,y.fillText(s,c,h),y.fillRect(d,f,p,m),y.fillStyle=t,y.globalAlpha=.9,y.fillRect(d,f,p,m),{dom:v,update:function(g,_){i=Math.min(i,g),n=Math.max(n,g),y.fillStyle=t,y.globalAlpha=1,y.fillRect(0,0,a,f),y.fillStyle=e,y.fillText(r(g)+" "+s+" ("+r(i)+"-"+r(n)+")",c,h),y.drawImage(v,d+o,f,p-o,m,d,f,p-o,m),y.fillRect(d+p-o,f,o,m),y.fillStyle=t,y.globalAlpha=.9,y.fillRect(d+p-o,f,o,r((1-g/_)*m))}}};const lie=ie("debugpatch");function sE(s,e,t,i){const n=lie===e;if(!t&&!i)return;const r=e+"___needle";hie(s,e,t,i);const o=Object.getOwnPropertyDescriptor(s,e),a=s[e];n&&console.log("Patch",s.constructor.name,e,o,a),o?(n&&console.log("Apply patch with existing descriptor",s.constructor.name,e,o),typeof o.value=="function"&&(s[e]=Lk(o.value,s,e))):(n&&console.log("Create patch with new property",s.constructor.name,e,o),Object.defineProperty(s,e,{set:function(l){if(typeof l=="function")this[r]=Lk(l,s,e);else{const c=this[r];TH(s,e,this,c,l),this[r]=l,MH(s,e,this,c,l)}},get:function(){const l=this[r];return typeof l=="function"&&l[r]?l[r]:l}}))}function cie(s,e,t){const i=hD(s,e);if(i)for(let n=i.length-1;n>=0;n--){const r=i[n];r.prefix===t&&(r.prefix=null),r.postfix===t&&(r.postfix=null),!r.prefix&&!r.postfix&&i.splice(n,1)}}const Ok=Symbol("Needle:Patches:WrappedFunction");function Lk(s,e,t){if(s[Ok])return s;const i=function(...n){TH(e,t,this,...n);const r=s.apply(this,n);return MH(e,t,this,r,...n),r};return i[Ok]=!0,i}const fw="Needle:Patches";function $I(){return globalThis[fw]||(globalThis[fw]=new WeakMap),globalThis[fw]}function hD(s,e){const t=$I().get(s);return t?t.get(e):null}function hie(s,e,t,i){let n=$I().get(s);n||(n=new Map,$I().set(s,n));let r=n.get(e);r||(r=[],n.set(e,r)),r.push({prefix:t,postfix:i})}function TH(s,e,t,...i){var r;if(!t)return;const n=hD(s,e);if(n)for(const o of n)(r=o.prefix)==null||r.call(t,...i)}function MH(s,e,t,i,...n){var o;if(!t)return;const r=hD(s,e);if(r)for(const a of r)(o=a.postfix)==null||o.call(t,i,...n)}const IH="2.1.0-alpha.3";globalThis.GLTF_PROGRESSIVE_VERSION=IH;console.debug(`[gltf-progressive] version ${IH}`);function uie(s,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},i=s.getIndex(),n=s.getAttribute("position"),r=i?i.count:n.count;let o=0;const a=Object.keys(s.attributes),l={},c={},h=[],d=["getX","getY","getZ","getW"],f=["setX","setY","setZ","setW"];for(let _=0,A=a.length;_<A;_++){const b=a[_],E=s.attributes[b];l[b]=new ot(new E.array.constructor(E.count*E.itemSize),E.itemSize,E.normalized);const C=s.morphAttributes[b];C&&(c[b]=new ot(new C.array.constructor(C.count*C.itemSize),C.itemSize,C.normalized))}const p=e*.5,m=Math.log10(1/e),v=Math.pow(10,m),y=p*v;for(let _=0;_<r;_++){const A=i?i.getX(_):_;let b="";for(let E=0,C=a.length;E<C;E++){const T=a[E],M=s.getAttribute(T),R=M.itemSize;for(let S=0;S<R;S++)b+=`${~~(M[d[S]](A)*v+y)},`}if(b in t)h.push(t[b]);else{for(let E=0,C=a.length;E<C;E++){const T=a[E],M=s.getAttribute(T),R=s.morphAttributes[T],S=M.itemSize,I=l[T],L=c[T];for(let U=0;U<S;U++){const D=d[U],V=f[U];if(I[V](o,M[D](A)),R)for(let O=0,F=R.length;O<F;O++)L[O][V](o,R[O][D](A))}}t[b]=o,h.push(o),o++}}const g=s.clone();for(const _ in s.attributes){const A=l[_];if(g.setAttribute(_,new ot(A.array.slice(0,o*A.itemSize),A.itemSize,A.normalized)),_ in c)for(let b=0;b<c[_].length;b++){const E=c[_][b];g.morphAttributes[_][b]=new ot(E.array.slice(0,o*E.itemSize),E.itemSize,E.normalized)}}return g.setIndex(h),g}function kk(s,e){if(e===Tz)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),s;if(e===Vw||e===FP){let t=s.getIndex();if(t===null){const o=[],a=s.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);s.setIndex(o),t=s.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),s}const i=t.count-2,n=[];if(e===Vw)for(let o=1;o<=i;o++)n.push(t.getX(0)),n.push(t.getX(o)),n.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(n.push(t.getX(o)),n.push(t.getX(o+1)),n.push(t.getX(o+2))):(n.push(t.getX(o+2)),n.push(t.getX(o+1)),n.push(t.getX(o)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=s.clone();return r.setIndex(n),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),s}class Za extends Vn{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new gie(t)}),this.register(function(t){return new Cie(t)}),this.register(function(t){return new Eie(t)}),this.register(function(t){return new Tie(t)}),this.register(function(t){return new yie(t)}),this.register(function(t){return new Aie(t)}),this.register(function(t){return new _ie(t)}),this.register(function(t){return new bie(t)}),this.register(function(t){return new mie(t)}),this.register(function(t){return new xie(t)}),this.register(function(t){return new vie(t)}),this.register(function(t){return new Sie(t)}),this.register(function(t){return new wie(t)}),this.register(function(t){return new fie(t)}),this.register(function(t){return new Mie(t)}),this.register(function(t){return new Iie(t)})}load(e,t,i,n){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=Lc.extractUrlBase(e);o=Lc.resolveURL(c,this.path)}else o=Lc.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){n?n(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new Hn(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,o,function(h){t(h),r.manager.itemEnd(e)},a)}catch(h){a(h)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let r;const o={},a={},l=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===RH){try{o[bi.KHR_BINARY_GLTF]=new Rie(e)}catch(d){n&&n(d);return}r=JSON.parse(o[bi.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Vie(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const d=this.pluginCallbacks[h](c);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[d.name]=d,o[d.name]=!0}if(r.extensionsUsed)for(let h=0;h<r.extensionsUsed.length;++h){const d=r.extensionsUsed[h],f=r.extensionsRequired||[];switch(d){case bi.KHR_MATERIALS_UNLIT:o[d]=new pie;break;case bi.KHR_DRACO_MESH_COMPRESSION:o[d]=new Pie(r,this.dracoLoader);break;case bi.KHR_TEXTURE_TRANSFORM:o[d]=new Bie;break;case bi.KHR_MESH_QUANTIZATION:o[d]=new Die;break;default:f.indexOf(d)>=0&&a[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,n)}parseAsync(e,t){const i=this;return new Promise(function(n,r){i.parse(e,t,n,r)})}}function die(){let s={};return{get:function(e){return s[e]},add:function(e,t){s[e]=t},remove:function(e){delete s[e]},removeAll:function(){s={}}}}const bi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class fie{constructor(e){this.parser=e,this.name=bi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const h=new me(16777215);l.color!==void 0&&h.setRGB(l.color[0],l.color[1],l.color[2],Ui);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new Op(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Dp(h),c.distance=d;break;case"spot":c=new t_(h),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,ed(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),n=Promise.resolve(c),t.cache.add(i,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}}let pie=class{constructor(){this.name=bi.KHR_MATERIALS_UNLIT}getMaterialType(){return Kt}extendParams(e,t,i){const n=[];e.color=new me(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],Ui),e.opacity=o[3]}r.baseColorTexture!==void 0&&n.push(i.assignTexture(e,"map",r.baseColorTexture,_t))}return Promise.all(n)}},mie=class{constructor(e){this.parser=e,this.name=bi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}},gie=class{constructor(e){this.parser=e,this.name=bi.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Qo}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Z(a,a)}return Promise.all(r)}},vie=class{constructor(e){this.parser=e,this.name=bi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Qo}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}},yie=class{constructor(e){this.parser=e,this.name=bi.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Qo}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new me(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=n.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],Ui)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,_t)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}},Aie=class{constructor(e){this.parser=e,this.name=bi.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Qo}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}},_ie=class{constructor(e){this.parser=e,this.name=bi.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Qo}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new me().setRGB(a[0],a[1],a[2],Ui),Promise.all(r)}},bie=class{constructor(e){this.parser=e,this.name=bi.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Qo}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},xie=class{constructor(e){this.parser=e,this.name=bi.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Qo}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new me().setRGB(a[0],a[1],a[2],Ui),o.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,_t)),Promise.all(r)}},wie=class{constructor(e){this.parser=e,this.name=bi.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Qo}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(r)}},Sie=class{constructor(e){this.parser=e,this.name=bi.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Qo}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}};class Cie{constructor(e){this.parser=e,this.name=bi.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const r=n.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class Eie{constructor(e){this.parser=e,this.name=bi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=n.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Tie{constructor(e){this.parser=e,this.name=bi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=n.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Mie{constructor(e){this.name=bi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const n=i.extensions[this.name],r=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=n.byteOffset||0,c=n.byteLength||0,h=n.count,d=n.byteStride,f=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,d,f,n.mode,n.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(h*d);return o.decodeGltfBuffer(new Uint8Array(p),h,d,f,n.mode,n.filter),p})})}else return null}}let Iie=class{constructor(e){this.name=bi.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const n=t.meshes[i.mesh];for(const c of n.primitives)if(c.mode!==Fa.TRIANGLES&&c.mode!==Fa.TRIANGLE_STRIP&&c.mode!==Fa.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(h=>(l[c]=h,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const h=c.pop(),d=h.isGroup?h.children:[h],f=c[0].count,p=[];for(const m of d){const v=new fe,y=new w,g=new xe,_=new w(1,1,1),A=new YP(m.geometry,m.material,f);for(let b=0;b<f;b++)l.TRANSLATION&&y.fromBufferAttribute(l.TRANSLATION,b),l.ROTATION&&g.fromBufferAttribute(l.ROTATION,b),l.SCALE&&_.fromBufferAttribute(l.SCALE,b),A.setMatrixAt(b,v.compose(y,g,_));for(const b in l)if(b==="_COLOR_0"){const E=l[b];A.instanceColor=new Fo(E.array,E.itemSize,E.normalized)}else b!=="TRANSLATION"&&b!=="ROTATION"&&b!=="SCALE"&&m.geometry.setAttribute(b,l[b]);ge.prototype.copy.call(A,m),this.parser.assignFinalMaterial(A),p.push(A)}return h.isGroup?(h.clear(),h.add(...p),h):p[0]}))}};const RH="glTF",ry=12,Fk={JSON:1313821514,BIN:5130562};class Rie{constructor(e){this.name=bi.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,ry),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==RH)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-ry,r=new DataView(e,ry);let o=0;for(;o<n;){const a=r.getUint32(o,!0);o+=4;const l=r.getUint32(o,!0);if(o+=4,l===Fk.JSON){const c=new Uint8Array(e,ry+o,a);this.content=i.decode(c)}else if(l===Fk.BIN){const c=ry+o;this.body=e.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Pie{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=bi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const h in o){const d=eR[h]||h.toLowerCase();a[d]=o[h]}for(const h in e.attributes){const d=eR[h]||h.toLowerCase();if(o[h]!==void 0){const f=i.accessors[e.attributes[h]],p=Ig[f.componentType];c[d]=p.name,l[d]=f.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(d,f){n.decodeDracoFile(h,function(p){for(const m in p.attributes){const v=p.attributes[m],y=l[m];y!==void 0&&(v.normalized=y)}d(p)},a,c,Ui,f)})})}}class Bie{constructor(){this.name=bi.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Die{constructor(){this.name=bi.KHR_MESH_QUANTIZATION}}class PH extends yv{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n*3+n;for(let o=0;o!==n;o++)t[o]=i[r+o];return t}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,h=n-t,d=(i-t)/h,f=d*d,p=f*d,m=e*c,v=m-c,y=-2*p+3*f,g=p-f,_=1-y,A=g-f+d;for(let b=0;b!==a;b++){const E=o[v+b+a],C=o[v+b+l]*h,T=o[m+b+a],M=o[m+b]*h;r[b]=_*E+A*C+y*T+g*M}return r}}const Oie=new xe;class Lie extends PH{interpolate_(e,t,i,n){const r=super.interpolate_(e,t,i,n);return Oie.fromArray(r).normalize().toArray(r),r}}const Fa={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ig={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Uk={9728:ei,9729:Nt,9984:Qg,9985:cp,9986:zh,9987:go},Nk={33071:ps,33648:du,10497:wo},uT={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},eR={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},zu={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},kie={CUBICSPLINE:void 0,LINEAR:Id,STEP:Ip},dT={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Fie(s){return s.DefaultMaterial===void 0&&(s.DefaultMaterial=new ms({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:As})),s.DefaultMaterial}function _f(s,e,t){for(const i in t.extensions)s[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function ed(s,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(s.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Uie(s,e,t){let i=!1,n=!1,r=!1;for(let c=0,h=e.length;c<h;c++){const d=e[c];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(n=!0),d.COLOR_0!==void 0&&(r=!0),i&&n&&r)break}if(!i&&!n&&!r)return Promise.resolve(s);const o=[],a=[],l=[];for(let c=0,h=e.length;c<h;c++){const d=e[c];if(i){const f=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):s.attributes.position;o.push(f)}if(n){const f=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):s.attributes.normal;a.push(f)}if(r){const f=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):s.attributes.color;l.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const h=c[0],d=c[1],f=c[2];return i&&(s.morphAttributes.position=h),n&&(s.morphAttributes.normal=d),r&&(s.morphAttributes.color=f),s.morphTargetsRelative=!0,s})}function Nie(s,e){if(s.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)s.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(s.morphTargetInfluences.length===t.length){s.morphTargetDictionary={};for(let i=0,n=t.length;i<n;i++)s.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function zie(s){let e;const t=s.extensions&&s.extensions[bi.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+fT(t.attributes):e=s.indices+":"+fT(s.attributes)+":"+s.mode,s.targets!==void 0)for(let i=0,n=s.targets.length;i<n;i++)e+=":"+fT(s.targets[i]);return e}function fT(s){let e="";const t=Object.keys(s).sort();for(let i=0,n=t.length;i<n;i++)e+=t[i]+":"+s[t[i]]+";";return e}function tR(s){switch(s){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Gie(s){return s.search(/\.jpe?g($|\?)/i)>0||s.search(/^data\:image\/jpeg/)===0?"image/jpeg":s.search(/\.webp($|\?)/i)>0||s.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Hie=new fe;class Vie{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new die,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=!1,r=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,r=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||n&&r<98?this.textureLoader=new Xa(this.options.manager):this.textureLoader=new L4(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Hn(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][n.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:n.asset,parser:i,userData:{}};return _f(r,a,n),ed(a,n),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const o=t[n].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let n=0,r=e.length;n<r;n++){const o=e[n];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),r=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,h]of o.children.entries())r(h,a.children[c])};return r(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const r=e(t[n]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":n=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(r,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[bi.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(r,o){i.load(Lc.resolveURL(t.uri,n.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const n=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+n)})}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const o=uT[n.type],a=Ig[n.componentType],l=n.normalized===!0,c=new a(n.count*o);return Promise.resolve(new ot(c,o,l))}const r=[];return n.bufferView!==void 0?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),n.sparse!==void 0&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=uT[n.type],c=Ig[n.componentType],h=c.BYTES_PER_ELEMENT,d=h*l,f=n.byteOffset||0,p=n.bufferView!==void 0?i.bufferViews[n.bufferView].byteStride:void 0,m=n.normalized===!0;let v,y;if(p&&p!==d){const g=Math.floor(f/p),_="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+g+":"+n.count;let A=t.cache.get(_);A||(v=new c(a,g*p,n.count*p/h),A=new Z0(v,p/h),t.cache.add(_,A)),y=new vo(A,l,f%p/h,m)}else a===null?v=new c(n.count*l):v=new c(a,f,n.count*l),y=new ot(v,l,m);if(n.sparse!==void 0){const g=uT.SCALAR,_=Ig[n.sparse.indices.componentType],A=n.sparse.indices.byteOffset||0,b=n.sparse.values.byteOffset||0,E=new _(o[1],A,n.sparse.count*g),C=new c(o[2],b,n.sparse.count*l);a!==null&&(y=new ot(y.array.slice(),y.itemSize,y.normalized));for(let T=0,M=E.length;T<M;T++){const R=E[T];if(y.setX(R,C[T*l]),l>=2&&y.setY(R,C[T*l+1]),l>=3&&y.setZ(R,C[T*l+2]),l>=4&&y.setW(R,C[T*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return y})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,o=t.images[r];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,i){const n=this,r=this.json,o=r.textures[e],a=r.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(h){h.flipY=!1,h.name=o.name||a.name||"",h.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(h.name=a.uri);const f=(r.samplers||{})[o.sampler]||{};return h.magFilter=Uk[f.magFilter]||Nt,h.minFilter=Uk[f.minFilter]||go,h.wrapS=Nk[f.wrapS]||wo,h.wrapT=Nk[f.wrapT]||wo,h.anisotropy=4,n.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const i=this,n=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const o=n.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(d){c=!0;const f=new Blob([d],{type:o.mimeType});return l=a.createObjectURL(f),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(d){return new Promise(function(f,p){let m=f;t.isImageBitmapLoader===!0&&(m=function(v){const y=new Pt(v);y.needsUpdate=!0,f(y)}),t.load(Lc.resolveURL(d,r.path),m,void 0,p)})}).then(function(d){return c===!0&&a.revokeObjectURL(l),d.userData.mimeType=o.mimeType||Gie(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=h,h}assignTexture(e,t,i,n){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[bi.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[bi.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[bi.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return n!==void 0&&(o.colorSpace=n),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new cd,Vt.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new hn,Vt.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(n||r||o){let a="ClonedMaterial:"+i.uuid+":";n&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),n&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return ms}loadMaterial(e){const t=this,i=this.json,n=this.extensions,r=i.materials[e];let o;const a={},l=r.extensions||{},c=[];if(l[bi.KHR_MATERIALS_UNLIT]){const d=n[bi.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),c.push(d.extendParams(a,r,t))}else{const d=r.pbrMetallicRoughness||{};if(a.color=new me(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;a.color.setRGB(f[0],f[1],f[2],Ui),a.opacity=f[3]}d.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",d.baseColorTexture,_t)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=Pi);const h=r.alphaMode||dT.OPAQUE;if(h===dT.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===dT.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==Kt&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new Z(1,1),r.normalTexture.scale!==void 0)){const d=r.normalTexture.scale;a.normalScale.set(d,d)}if(r.occlusionTexture!==void 0&&o!==Kt&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==Kt){const d=r.emissiveFactor;a.emissive=new me().setRGB(d[0],d[1],d[2],Ui)}return r.emissiveTexture!==void 0&&o!==Kt&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,_t)),Promise.all(c).then(function(){const d=new o(a);return r.name&&(d.name=r.name),ed(d,r),t.associations.set(d,{materials:e}),r.extensions&&_f(n,d,r),d})}createUniqueName(e){const t=Xt.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function r(a){return i[bi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return zk(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],h=zie(c),d=n[h];if(d)o.push(d.promise);else{let f;c.extensions&&c.extensions[bi.KHR_DRACO_MESH_COMPRESSION]?f=r(c):f=zk(new pt,c,t),n[h]={primitive:c,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,n=this.extensions,r=i.meshes[e],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const h=o[l].material===void 0?Fie(this.cache):this.getDependency("material",o[l].material);a.push(h)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],d=[];for(let p=0,m=h.length;p<m;p++){const v=h[p],y=o[p];let g;const _=c[p];if(y.mode===Fa.TRIANGLES||y.mode===Fa.TRIANGLE_STRIP||y.mode===Fa.TRIANGLE_FAN||y.mode===void 0)g=r.isSkinnedMesh===!0?new ga(v,_):new le(v,_),g.isSkinnedMesh===!0&&g.normalizeSkinWeights(),y.mode===Fa.TRIANGLE_STRIP?g.geometry=kk(g.geometry,FP):y.mode===Fa.TRIANGLE_FAN&&(g.geometry=kk(g.geometry,Vw));else if(y.mode===Fa.LINES)g=new Xr(v,_);else if(y.mode===Fa.LINE_STRIP)g=new Rn(v,_);else if(y.mode===Fa.LINE_LOOP)g=new KP(v,_);else if(y.mode===Fa.POINTS)g=new Mg(v,_);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(g.geometry.morphAttributes).length>0&&Nie(g,r),g.name=t.createUniqueName(r.name||"mesh_"+e),ed(g,r),y.extensions&&_f(n,g,y),t.assignFinalMaterial(g),d.push(g)}for(let p=0,m=d.length;p<m;p++)t.associations.set(d[p],{meshes:e,primitives:p});if(d.length===1)return r.extensions&&_f(n,d[0],r),d[0];const f=new vs;r.extensions&&_f(n,f,r),t.associations.set(f,{meshes:e});for(let p=0,m=d.length;p<m;p++)f.add(d[p]);return f})}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new zt(li.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):i.type==="orthographic"&&(t=new Nl(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),ed(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,r=t.joints.length;n<r;n++)i.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(n){const r=n.pop(),o=n,a=[],l=[];for(let c=0,h=o.length;c<h;c++){const d=o[c];if(d){a.push(d);const f=new fe;r!==null&&f.fromArray(r.array,c*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new Gp(a,l)})}loadAnimation(e){const t=this.json,i=this,n=t.animations[e],r=n.name?n.name:"animation_"+e,o=[],a=[],l=[],c=[],h=[];let d=0,f=n.channels.length;for(d=0,f=n.channels.length;d<f;d++){const p=n.channels[d],m=n.samplers[p.sampler],v=p.target,y=v.node,g=n.parameters!==void 0?n.parameters[m.input]:m.input,_=n.parameters!==void 0?n.parameters[m.output]:m.output;v.node!==void 0&&(o.push(this.getDependency("node",y)),a.push(this.getDependency("accessor",g)),l.push(this.getDependency("accessor",_)),c.push(m),h.push(v))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(p){const m=p[0],v=p[1],y=p[2],g=p[3],_=p[4],A=[];for(d=0,f=m.length;d<f;d++){const b=m[d],E=v[d],C=y[d],T=g[d],M=_[d];if(b===void 0)continue;b.updateMatrix&&b.updateMatrix();const R=i._createAnimationTracks(b,E,C,T,M);if(R)for(let S=0;S<R.length;S++)A.push(R[S])}return new Ho(r,void 0,A)})}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return n.mesh===void 0?null:i.getDependency("mesh",n.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,n.mesh,r);return n.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=n.weights.length;l<c;l++)a.morphTargetInfluences[l]=n.weights[l]}),o})}loadNode(e){const t=this.json,i=this,n=t.nodes[e],r=i._loadNodeShallow(e),o=[],a=n.children||[];for(let c=0,h=a.length;c<h;c++)o.push(i.getDependency("node",a[c]));const l=n.skin===void 0?Promise.resolve(null):i.getDependency("skin",n.skin);return Promise.all([r,Promise.all(o),l]).then(function(c){const h=c[0],d=c[1],f=c[2];f!==null&&h.traverse(function(p){p.isSkinnedMesh&&p.bind(f,Hie)});for(let p=0,m=d.length;p<m;p++)h.add(d[p]);return h})}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],o=r.name?n.createUniqueName(r.name):"",a=[],l=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),r.camera!==void 0&&a.push(n.getDependency("camera",r.camera).then(function(c){return n._getNodeRef(n.cameraCache,r.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let h;if(r.isBone===!0?h=new Pp:c.length>1?h=new vs:c.length===1?h=c[0]:h=new ge,h!==c[0])for(let d=0,f=c.length;d<f;d++)h.add(c[d]);if(r.name&&(h.userData.name=r.name,h.name=o),ed(h,r),r.extensions&&_f(i,h,r),r.matrix!==void 0){const d=new fe;d.fromArray(r.matrix),h.applyMatrix4(d)}else r.translation!==void 0&&h.position.fromArray(r.translation),r.rotation!==void 0&&h.quaternion.fromArray(r.rotation),r.scale!==void 0&&h.scale.fromArray(r.scale);return n.associations.has(h)||n.associations.set(h,{}),n.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,r=new vs;i.name&&(r.name=n.createUniqueName(i.name)),ed(r,i),i.extensions&&_f(t,r,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(n.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let h=0,d=l.length;h<d;h++)r.add(l[h]);const c=h=>{const d=new Map;for(const[f,p]of n.associations)(f instanceof Vt||f instanceof Pt)&&d.set(f,p);return h.traverse(f=>{const p=n.associations.get(f);p!=null&&d.set(f,p)}),d};return n.associations=c(r),r})}_createAnimationTracks(e,t,i,n,r){const o=[],a=e.name?e.name:e.uuid,l=[];zu[r.path]===zu.weights?e.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(a);let c;switch(zu[r.path]){case zu.weights:c=Rd;break;case zu.rotation:c=qc;break;case zu.position:case zu.scale:c=pu;break;default:switch(i.itemSize){case 1:c=Rd;break;case 2:case 3:default:c=pu;break}break}const h=n.interpolation!==void 0?kie[n.interpolation]:Id,d=this._getArrayFromAccessor(i);for(let f=0,p=l.length;f<p;f++){const m=new c(l[f]+"."+zu[r.path],t.array,d,h);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=tR(t.constructor),n=new Float32Array(t.length);for(let r=0,o=t.length;r<o;r++)n[r]=t[r]*i;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const n=this instanceof qc?Lie:PH;return new n(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Qie(s,e,t){const i=e.attributes,n=new Si;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(n.set(new w(l[0],l[1],l[2]),new w(c[0],c[1],c[2])),a.normalized){const h=tR(Ig[a.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new w,l=new w;for(let c=0,h=r.length;c<h;c++){const d=r[c];if(d.POSITION!==void 0){const f=t.json.accessors[d.POSITION],p=f.min,m=f.max;if(p!==void 0&&m!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(m[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(m[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(m[2]))),f.normalized){const v=tR(Ig[f.componentType]);l.multiplyScalar(v)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(a)}s.boundingBox=n;const o=new _n;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,s.boundingSphere=o}function zk(s,e,t){const i=e.attributes,n=[];function r(o,a){return t.getDependency("accessor",o).then(function(l){s.setAttribute(a,l)})}for(const o in i){const a=eR[o]||o.toLowerCase();a in s.attributes||n.push(r(i[o],a))}if(e.indices!==void 0&&!s.index){const o=t.getDependency("accessor",e.indices).then(function(a){s.setIndex(a)});n.push(o)}return ki.workingColorSpace!==Ui&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ki.workingColorSpace}" not supported.`),ed(s,e),Qie(s,e,t),Promise.all(n).then(function(){return e.targets!==void 0?Uie(s,e.targets,t):s})}var jie=function(){var s="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",e="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var n=WebAssembly.validate(t)?e:s,r,o=WebAssembly.instantiate(a(n),{}).then(function(g){r=g.instance,r.exports.__wasm_call_ctors()});function a(g){for(var _=new Uint8Array(g.length),A=0;A<g.length;++A){var b=g.charCodeAt(A);_[A]=b>96?b-97:b>64?b-39:b+4}for(var E=0,A=0;A<g.length;++A)_[E++]=_[A]<60?i[_[A]]:(_[A]-60)*64+_[++A];return _.buffer.slice(0,E)}function l(g,_,A,b,E,C){var T=r.exports.sbrk,M=A+3&-4,R=T(M*b),S=T(E.length),I=new Uint8Array(r.exports.memory.buffer);I.set(E,S);var L=g(R,A,b,S,E.length);if(L==0&&C&&C(R,M,b),_.set(I.subarray(R,R+A*b)),T(R-T(0)),L!=0)throw new Error("Malformed buffer data: "+L)}var c={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},d=[],f=0;function p(g){var _={object:new Worker(g),pending:0,requests:{}};return _.object.onmessage=function(A){var b=A.data;_.pending-=b.count,_.requests[b.id][b.action](b.value),delete _.requests[b.id]},_}function m(g){for(var _="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(n))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+l.toString()+y.toString(),A=new Blob([_],{type:"text/javascript"}),b=URL.createObjectURL(A),E=0;E<g;++E)d[E]=p(b);URL.revokeObjectURL(b)}function v(g,_,A,b,E){for(var C=d[0],T=1;T<d.length;++T)d[T].pending<C.pending&&(C=d[T]);return new Promise(function(M,R){var S=new Uint8Array(A),I=f++;C.pending+=g,C.requests[I]={resolve:M,reject:R},C.object.postMessage({id:I,count:g,size:_,source:S,mode:b,filter:E},[S.buffer])})}function y(g){o.then(function(){var _=g.data;try{var A=new Uint8Array(_.count*_.size);l(r.exports[_.mode],A,_.count,_.size,_.source,r.exports[_.filter]),self.postMessage({id:_.id,count:_.count,action:"resolve",value:A},[A.buffer])}catch(b){self.postMessage({id:_.id,count:_.count,action:"reject",value:b})}})}return{ready:o,supported:!0,useWorkers:function(g){m(g)},decodeVertexBuffer:function(g,_,A,b,E){l(r.exports.meshopt_decodeVertexBuffer,g,_,A,b,r.exports[c[E]])},decodeIndexBuffer:function(g,_,A,b){l(r.exports.meshopt_decodeIndexBuffer,g,_,A,b)},decodeIndexSequence:function(g,_,A,b){l(r.exports.meshopt_decodeIndexSequence,g,_,A,b)},decodeGltfBuffer:function(g,_,A,b,E,C){l(r.exports[h[E]],g,_,A,b,r.exports[c[C]])},decodeGltfBufferAsync:function(g,_,A,b,E){return d.length>0?v(g,_,A,h[b],c[E]):o.then(function(){var C=new Uint8Array(g*_);return l(r.exports[h[b]],C,g,_,A,r.exports[c[E]]),C})}}}();const pT=new WeakMap;class Wie extends Vn{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){const r=new Hn(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,o=>{this.parse(o,t,n)},i,n)}parse(e,t,i=()=>{}){this.decodeDracoFile(e,t,null,null,_t).catch(i)}decodeDracoFile(e,t,i,n,r=Ui,o=()=>{}){const a={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:r};return this.decodeGeometry(e,a).then(t).catch(o)}decodeGeometry(e,t){const i=JSON.stringify(t);if(pT.has(e)){const l=pT.get(e);if(l.key===i)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const r=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(r,o).then(l=>(n=l,new Promise((c,h)=>{n._callbacks[r]={resolve:c,reject:h},n.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{n&&r&&this._releaseTask(n,r)}),pT.set(e,{key:i,promise:a}),a}_createGeometry(e){const t=new pt;e.index&&t.setIndex(new ot(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const n=e.attributes[i],r=n.name,o=n.array,a=n.itemSize,l=new ot(o,a);r==="color"&&(this._assignVertexColorSpace(l,n.vertexColorSpace),l.normalized=!(o instanceof Float32Array)),t.setAttribute(r,l)}return t}_assignVertexColorSpace(e,t){if(t!==_t)return;const i=new me;for(let n=0,r=e.count;n<r;n++)i.fromBufferAttribute(e,n).convertSRGBToLinear(),e.setXYZ(n,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new Hn(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((n,r)=>{i.load(e,n,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const n=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const r=qie.toString(),o=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(r){const o=r.data;switch(o.type){case"decode":n._callbacks[o.id].resolve(o);break;case"error":n._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,r){return n._taskLoad>r._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function qie(){let s,e;onmessage=function(o){const a=o.data;switch(a.type){case"init":s=a.decoderConfig,e=new Promise(function(h){s.onModuleLoaded=function(d){h({draco:d})},DracoDecoderModule(s)});break;case"decode":const l=a.buffer,c=a.taskConfig;e.then(h=>{const d=h.draco,f=new d.Decoder;try{const p=t(d,f,new Int8Array(l),c),m=p.attributes.map(v=>v.array.buffer);p.index&&m.push(p.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:p},m)}catch(p){console.error(p),self.postMessage({type:"error",id:a.id,error:p.message})}finally{d.destroy(f)}});break}};function t(o,a,l,c){const h=c.attributeIDs,d=c.attributeTypes;let f,p;const m=a.GetEncodedGeometryType(l);if(m===o.TRIANGULAR_MESH)f=new o.Mesh,p=a.DecodeArrayToMesh(l,l.byteLength,f);else if(m===o.POINT_CLOUD)f=new o.PointCloud,p=a.DecodeArrayToPointCloud(l,l.byteLength,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const v={index:null,attributes:[]};for(const y in h){const g=self[d[y]];let _,A;if(c.useUniqueIDs)A=h[y],_=a.GetAttributeByUniqueId(f,A);else{if(A=a.GetAttributeId(f,o[h[y]]),A===-1)continue;_=a.GetAttribute(f,A)}const b=n(o,a,f,y,g,_);y==="color"&&(b.vertexColorSpace=c.vertexColorSpace),v.attributes.push(b)}return m===o.TRIANGULAR_MESH&&(v.index=i(o,a,f)),o.destroy(f),v}function i(o,a,l){const h=l.num_faces()*3,d=h*4,f=o._malloc(d);a.GetTrianglesUInt32Array(l,d,f);const p=new Uint32Array(o.HEAPF32.buffer,f,h).slice();return o._free(f),{array:p,itemSize:1}}function n(o,a,l,c,h,d){const f=d.num_components(),m=l.num_points()*f,v=m*h.BYTES_PER_ELEMENT,y=r(o,h),g=o._malloc(v);a.GetAttributeDataArrayForAllPoints(l,d,y,v,g);const _=new h(o.HEAPF32.buffer,g,m).slice();return o._free(g),{name:c,array:_,itemSize:f}}function r(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class Xie{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:n,msg:r,transfer:o}=this.queue.shift();this.workersResolve[e]=n,this.workers[e].postMessage(r,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(i=>{const n=this._getIdleWorker();n!==-1?(this._initWorker(n),this.workerStatus|=1<<n,this.workersResolve[n]=i,this.workers[n].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const Yie=0,Gk=2,Kie=1,Hk=2,Jie=0,Zie=1,$ie=10,ene=0,BH=9,DH=15,OH=16,LH=22,kH=37,FH=43,UH=76,NH=83,zH=97,GH=100,HH=103,VH=109,QH=165,jH=166;class tne{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class oy{constructor(e,t,i,n){this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const i=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,n)}}const eo=[171,75,84,88,32,50,48,187,13,10,26,10];function Vk(s){return typeof TextDecoder<"u"?new TextDecoder().decode(s):Buffer.from(s).toString("utf8")}function ine(s){const e=new Uint8Array(s.buffer,s.byteOffset,eo.length);if(e[0]!==eo[0]||e[1]!==eo[1]||e[2]!==eo[2]||e[3]!==eo[3]||e[4]!==eo[4]||e[5]!==eo[5]||e[6]!==eo[6]||e[7]!==eo[7]||e[8]!==eo[8]||e[9]!==eo[9]||e[10]!==eo[10]||e[11]!==eo[11])throw new Error("Missing KTX 2.0 identifier.");const t=new tne,i=17*Uint32Array.BYTES_PER_ELEMENT,n=new oy(s,eo.length,i,!0);t.vkFormat=n._nextUint32(),t.typeSize=n._nextUint32(),t.pixelWidth=n._nextUint32(),t.pixelHeight=n._nextUint32(),t.pixelDepth=n._nextUint32(),t.layerCount=n._nextUint32(),t.faceCount=n._nextUint32();const r=n._nextUint32();t.supercompressionScheme=n._nextUint32();const o=n._nextUint32(),a=n._nextUint32(),l=n._nextUint32(),c=n._nextUint32(),h=n._nextUint64(),d=n._nextUint64(),f=new oy(s,eo.length+i,3*r*8,!0);for(let F=0;F<r;F++)t.levels.push({levelData:new Uint8Array(s.buffer,s.byteOffset+f._nextUint64(),f._nextUint64()),uncompressedByteLength:f._nextUint64()});const p=new oy(s,o,a,!0),m={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},v=(m.descriptorBlockSize/4-6)/4;for(let F=0;F<v;F++){const N={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&N.channelType?(N.sampleLower=p._nextInt32(),N.sampleUpper=p._nextInt32()):(N.sampleLower=p._nextUint32(),N.sampleUpper=p._nextUint32()),m.samples[F]=N}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(m);const y=new oy(s,l,c,!0);for(;y._offset<c;){const F=y._nextUint32(),N=y._scan(F),q=Vk(N),$=y._scan(F-N.byteLength);t.keyValue[q]=q.match(/^ktx/i)?Vk($):$,y._offset%4&&y._skip(4-y._offset%4)}if(d<=0)return t;const g=new oy(s,h,d,!0),_=g._nextUint16(),A=g._nextUint16(),b=g._nextUint32(),E=g._nextUint32(),C=g._nextUint32(),T=g._nextUint32(),M=[];for(let F=0;F<r;F++)M.push({imageFlags:g._nextUint32(),rgbSliceByteOffset:g._nextUint32(),rgbSliceByteLength:g._nextUint32(),alphaSliceByteOffset:g._nextUint32(),alphaSliceByteLength:g._nextUint32()});const R=h+g._offset,S=R+b,I=S+E,L=I+C,U=new Uint8Array(s.buffer,s.byteOffset+R,b),D=new Uint8Array(s.buffer,s.byteOffset+S,E),V=new Uint8Array(s.buffer,s.byteOffset+I,C),O=new Uint8Array(s.buffer,s.byteOffset+L,T);return t.globalData={endpointCount:_,selectorCount:A,imageDescs:M,endpointsData:U,selectorsData:D,tablesData:V,extendedData:O},t}let mT,Ch,iR;const gT={env:{emscripten_notify_memory_growth:function(s){iR=new Uint8Array(Ch.exports.memory.buffer)}}};class nne{init(){return mT||(mT=typeof fetch<"u"?fetch("data:application/wasm;base64,"+Qk).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,gT)).then(this._init):WebAssembly.instantiate(Buffer.from(Qk,"base64"),gT).then(this._init),mT)}_init(e){Ch=e.instance,gT.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Ch)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,n=Ch.exports.malloc(i);iR.set(e,n),t=t||Number(Ch.exports.ZSTD_findDecompressedSize(n,i));const r=Ch.exports.malloc(t),o=Ch.exports.ZSTD_decompress(r,t,n,i),a=iR.slice(r,r+o);return Ch.exports.free(n),Ch.exports.free(r),a}}const Qk="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",vT=new WeakMap;let yT=0,AT;class Mc extends Vn{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Xie,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new Hn(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new Hn(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const n=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,n]).then(([r,o])=>{const a=Mc.BasisWorker.toString(),l=["/* constants */","let _EngineFormat = "+JSON.stringify(Mc.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Mc.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Mc.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const c=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return c.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),c})}),yT>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),yT++}return this.transcoderPending}load(e,t,i,n){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new Hn(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(e,o=>{if(vT.has(o))return vT.get(o).promise.then(t).catch(n);this._createTexture(o).then(a=>t?t(a):null).catch(n)},i,n)}_createTextureFrom(e,t){const{faces:i,width:n,height:r,format:o,type:a,error:l,dfdFlags:c}=e;if(a==="error")return Promise.reject(l);let h;if(t.faceCount===6)h=new p4(i,o,Ri);else{const d=i[0].mipmaps;h=t.layerCount>1?new f4(d,n,r,t.layerCount,o,Ri):new Oc(d,n,r,o,Ri)}return h.minFilter=i[0].mipmaps.length===1?Nt:go,h.magFilter=Nt,h.generateMipmaps=!1,h.needsUpdate=!0,h.colorSpace=WH(t),h.premultiplyAlpha=!!(c&Kie),h}async _createTexture(e,t={}){const i=ine(new Uint8Array(e));if(i.vkFormat!==ene)return rne(i);const n=t,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:n},[e])).then(o=>this._createTextureFrom(o.data,i));return vT.set(e,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),yT--,this}}Mc.BasisFormat={ETC1S:0,UASTC_4x4:1};Mc.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};Mc.EngineFormat={RGBAFormat:Ti,RGBA_ASTC_4x4_Format:Hw,RGBA_BPTC_Format:sA,RGBA_ETC2_EAC_Format:Gw,RGBA_PVRTC_4BPPV1_Format:Nw,RGBA_S3TC_DXT5_Format:nA,RGB_ETC1_Format:gC,RGB_ETC2_Format:zw,RGB_PVRTC_4BPPV1_Format:Uw,RGB_S3TC_DXT1_Format:iA};Mc.BasisWorker=function(){let s,e,t;const i=_EngineFormat,n=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(m){const v=m.data;switch(v.type){case"init":s=v.config,o(v.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:y,buffers:g,width:_,height:A,hasAlpha:b,format:E,dfdFlags:C}=a(v.buffer);self.postMessage({type:"transcode",id:v.id,faces:y,width:_,height:A,hasAlpha:b,format:E,dfdFlags:C},g)}catch(y){console.error(y),self.postMessage({type:"error",id:v.id,error:y.message})}});break}});function o(m){e=new Promise(v=>{t={wasmBinary:m,onRuntimeInitialized:v},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(m){const v=new t.KTX2File(new Uint8Array(m));function y(){v.close(),v.delete()}if(!v.isValid())throw y(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const g=v.isUASTC()?r.UASTC_4x4:r.ETC1S,_=v.getWidth(),A=v.getHeight(),b=v.getLayers()||1,E=v.getLevels(),C=v.getFaces(),T=v.getHasAlpha(),M=v.getDFDFlags(),{transcoderFormat:R,engineFormat:S}=d(g,_,A,T);if(!_||!A||!E)throw y(),new Error("THREE.KTX2Loader:	Invalid texture");if(!v.startTranscoding())throw y(),new Error("THREE.KTX2Loader: .startTranscoding failed");const I=[],L=[];for(let U=0;U<C;U++){const D=[];for(let V=0;V<E;V++){const O=[];let F,N;for(let $=0;$<b;$++){const oe=v.getImageLevelInfo(V,$,U);U===0&&V===0&&$===0&&(oe.origWidth%4!==0||oe.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),E>1?(F=oe.origWidth,N=oe.origHeight):(F=oe.width,N=oe.height);const ae=new Uint8Array(v.getImageTranscodedSizeInBytes(V,$,0,R));if(!v.transcodeImage(ae,V,$,U,R,0,-1,-1))throw y(),new Error("THREE.KTX2Loader: .transcodeImage failed.");O.push(ae)}const q=p(O);D.push({data:q,width:F,height:N}),L.push(q.buffer)}I.push({mipmaps:D,width:_,height:A,format:S})}return y(),{faces:I,buffers:L,width:_,height:A,hasAlpha:T,format:S,dfdFlags:M}}const l=[{if:"astcSupported",basisFormat:[r.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],c=l.sort(function(m,v){return m.priorityETC1S-v.priorityETC1S}),h=l.sort(function(m,v){return m.priorityUASTC-v.priorityUASTC});function d(m,v,y,g){let _,A;const b=m===r.ETC1S?c:h;for(let E=0;E<b.length;E++){const C=b[E];if(s[C.if]&&C.basisFormat.includes(m)&&!(g&&C.transcoderFormat.length<2)&&!(C.needsPowerOfTwo&&!(f(v)&&f(y))))return _=C.transcoderFormat[g?1:0],A=C.engineFormat[g?1:0],{transcoderFormat:_,engineFormat:A}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),_=n.RGBA32,A=i.RGBAFormat,{transcoderFormat:_,engineFormat:A}}function f(m){return m<=2?!0:(m&m-1)===0&&m!==0}function p(m){if(m.length===1)return m[0];let v=0;for(let _=0;_<m.length;_++){const A=m[_];v+=A.byteLength}const y=new Uint8Array(v);let g=0;for(let _=0;_<m.length;_++){const A=m[_];y.set(A,g),g+=A.byteLength}return y}};const sne=new Set([Ti,ld,Tl]),_T={[VH]:Ti,[zH]:Ti,[kH]:Ti,[FH]:Ti,[HH]:ld,[NH]:ld,[OH]:ld,[LH]:ld,[GH]:Tl,[UH]:Tl,[DH]:Tl,[BH]:Tl,[jH]:XA,[QH]:XA},bT={[VH]:vn,[zH]:$i,[kH]:Ri,[FH]:Ri,[HH]:vn,[NH]:$i,[OH]:Ri,[LH]:Ri,[GH]:vn,[UH]:$i,[DH]:Ri,[BH]:Ri,[jH]:Ri,[QH]:Ri};async function rne(s){const{vkFormat:e}=s;if(_T[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let t;s.supercompressionScheme===Gk&&(AT||(AT=new Promise(async r=>{const o=new nne;await o.init(),r(o)})),t=await AT);const i=[];for(let r=0;r<s.levels.length;r++){const o=Math.max(1,s.pixelWidth>>r),a=Math.max(1,s.pixelHeight>>r),l=s.pixelDepth?Math.max(1,s.pixelDepth>>r):0,c=s.levels[r];let h;if(s.supercompressionScheme===Yie)h=c.levelData;else if(s.supercompressionScheme===Gk)h=t.decode(c.levelData,c.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let d;bT[e]===vn?d=new Float32Array(h.buffer,h.byteOffset,h.byteLength/Float32Array.BYTES_PER_ELEMENT):bT[e]===$i?d=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):d=h,i.push({data:d,width:o,height:a,depth:l})}let n;if(sne.has(_T[e]))n=s.pixelDepth===0?new Go(i[0].data,s.pixelWidth,s.pixelHeight):new _C(i[0].data,s.pixelWidth,s.pixelHeight,s.pixelDepth);else{if(s.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");n=new Oc(i,s.pixelWidth,s.pixelHeight)}return n.mipmaps=i,n.type=bT[e],n.format=_T[e],n.colorSpace=WH(s),n.needsUpdate=!0,Promise.resolve(n)}function WH(s){const e=s.dataFormatDescriptor[0];return e.colorPrimaries===Zie?e.transferFunction===Hk?_t:Ui:e.colorPrimaries===$ie?e.transferFunction===Hk?X0:pv:(e.colorPrimaries===Jie||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),jr)}let Zg="https://www.gstatic.com/draco/versioned/decoders/1.5.7/",p0="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";const one=Zg,ane=p0,lne=new URL(Zg+"draco_decoder.js");fetch(lne,{method:"GET",headers:{Range:"bytes=0-1"}}).catch(s=>{Zg===one&&(Zg="./include/draco/"),p0===ane&&(p0="./include/ktx2/")}).finally(()=>{qH()});function cne(s){Zg=s}function hne(s){p0=s}let Qf,aS,np;function qH(){Qf||(Qf=new Wie,Qf.setDecoderPath(Zg),Qf.setDecoderConfig({type:"js"}),Qf.preload()),np||(np=new Mc,np.setTranscoderPath(p0),np.init()),aS||(aS=jie)}function rE(s){return qH(),s?np.detectSupport(s):s!==null&&console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures might fail"),{dracoLoader:Qf,ktx2Loader:np,meshoptDecoder:aS}}function XH(s){s.dracoLoader||s.setDRACOLoader(Qf),s.ktx2Loader||s.setKTX2Loader(np),s.meshoptDecoder||s.setMeshoptDecoder(aS)}const nR=new WeakMap;function YH(s,e){let t=nR.get(s);t?t=Object.assign(t,e):t=e,nR.set(s,t)}const xT=Za.prototype.load;function une(...s){const e=nR.get(this);let t=s[0];const i=new URL(t,window.location.href);if(i.hostname.endsWith("needle.tools")){const r=(e==null?void 0:e.progressive)!==void 0?e.progressive:!0,o=e!=null&&e.usecase?e.usecase:"default";r?this.requestHeader.Accept=`*/*;progressive=allowed;usecase=${o}`:this.requestHeader.Accept=`*/*;usecase=${o}`,t=i.toString()}return s[0]=t,xT==null?void 0:xT.call(this,...s)}Za.prototype.load=une;h_("debugprogressive");function h_(s){if(typeof window>"u")return!1;const t=new URL(window.location.href).searchParams.get(s);return t==null||t==="0"||t==="false"?!1:t===""?!0:t}function dne(s,e){if(e===void 0||e.startsWith("./")||e.startsWith("http")||s===void 0)return e;const t=s.lastIndexOf("/");if(t>=0){const i=s.substring(0,t+1);for(;i.endsWith("/")&&e.startsWith("/");)e=e.substring(1);return i+e}return e}let ay;function fne(){return ay!==void 0||(ay=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent),h_("debugprogressive")&&console.log("[glTF Progressive]: isMobileDevice",ay)),ay}const pne=typeof window>"u"&&typeof document>"u",sR=Symbol("needle:raycast-mesh");function Wp(s){return(s==null?void 0:s[sR])instanceof pt?s[sR]:null}function mne(s,e){if((s.type==="Mesh"||s.type==="SkinnedMesh")&&!Wp(s)){const i=vne(e);i.userData={isRaycastMesh:!0},s[sR]=i}}function gne(s=!0){if(s){if(ly)return;const e=ly=le.prototype.raycast;le.prototype.raycast=function(t,i){const n=this,r=Wp(n);let o;r&&n.isMesh&&(o=n.geometry,n.geometry=r),e.call(this,t,i),o&&(n.geometry=o)}}else{if(!ly)return;le.prototype.raycast=ly,ly=null}}let ly=null;function vne(s){const e=new pt;for(const t in s.attributes)e.setAttribute(t,s.getAttribute(t));return e.setIndex(s.getIndex()),e}const td=new Array,Lh="NEEDLE_progressive",fn=h_("debugprogressive"),wT=Symbol("needle-progressive-texture"),fA=new Map,rR=new Set;if(fn){let i=function(){s+=1,console.log("Toggle LOD level",s,fA),fA.forEach((n,r)=>{for(const o of n.keys){const a=r[o];if(a!=null){if(a.isBufferGeometry===!0){const l=fi.getMeshLODInformation(a),c=l?Math.min(s,l.lods.length):0;r["DEBUG:LOD"]=s,fi.assignMeshLOD(r,c),l&&(e=Math.max(e,l.lods.length-1))}else if(r.isMaterial===!0){r["DEBUG:LOD"]=s,fi.assignTextureLOD(r,s);break}}}}),s>=e&&(s=-1)},s=-1,e=2,t=!1;window.addEventListener("keyup",n=>{n.key==="p"&&i(),n.key==="w"&&(t=!t,rR&&rR.forEach(r=>{r.name!="BackgroundCubeMaterial"&&r.glyphMap==null&&"wireframe"in r&&(r.wireframe=t)}))})}function jk(s,e,t){var n;if(!fn)return;fA.has(s)||fA.set(s,{keys:[],sourceId:t});const i=fA.get(s);((n=i==null?void 0:i.keys)==null?void 0:n.includes(e))==!1&&i.keys.push(e)}const Ts=class{constructor(e,t){u(this,"parser");u(this,"url");u(this,"_isLoadingMesh");u(this,"loadMesh",e=>{var i,n;if(this._isLoadingMesh)return null;const t=(n=(i=this.parser.json.meshes[e])==null?void 0:i.extensions)==null?void 0:n[Lh];return t?(this._isLoadingMesh=!0,this.parser.getDependency("mesh",e).then(r=>{var o;return this._isLoadingMesh=!1,r&&Ts.registerMesh(this.url,t.guid,r,(o=t.lods)==null?void 0:o.length,void 0,t),r})):null});fn&&console.log("Progressive extension registered for",t),this.parser=e,this.url=t}get name(){return Lh}static getMeshLODInformation(e){const t=this.getAssignedLODInformation(e);return t!=null&&t.key?this.lodInfos.get(t.key):null}static getMaterialMinMaxLODsCount(e,t){const i=this,n="LODS:minmax",r=e[n];if(r!=null)return r;if(t||(t={min_count:1/0,max_count:0,lods:[]}),Array.isArray(e)){for(const a of e)this.getMaterialMinMaxLODsCount(a,t);return e[n]=t,t}if(fn==="verbose"&&console.log("getMaterialMinMaxLODsCount",e),e.type==="ShaderMaterial"||e.type==="RawShaderMaterial"){const a=e;for(const l of Object.keys(a.uniforms)){const c=a.uniforms[l].value;(c==null?void 0:c.isTexture)===!0&&o(c,t)}}else if(e.isMaterial)for(const a of Object.keys(e)){const l=e[a];(l==null?void 0:l.isTexture)===!0&&o(l,t)}return e[n]=t,t;function o(a,l){const c=i.getAssignedLODInformation(a);if(c){const h=i.lodInfos.get(c.key);if(h&&h.lods){l.min_count=Math.min(l.min_count,h.lods.length),l.max_count=Math.max(l.max_count,h.lods.length);for(let d=0;d<h.lods.length;d++){const f=h.lods[d];f.width&&(l.lods[d]=l.lods[d]||{min_height:1/0,max_height:0},l.lods[d].min_height=Math.min(l.lods[d].min_height,f.height),l.lods[d].max_height=Math.max(l.lods[d].max_height,f.height))}}}}}static hasLODLevelAvailable(e,t){var r;if(Array.isArray(e)){for(const o of e)if(this.hasLODLevelAvailable(o,t))return!0;return!1}if(e.isMaterial===!0){for(const o of Object.keys(e)){const a=e[o];if(a&&a.isTexture&&this.hasLODLevelAvailable(a,t))return!0}return!1}else if(e.isGroup===!0){for(const o of e.children)if(o.isMesh===!0&&this.hasLODLevelAvailable(o,t))return!0}let i,n;if(e.isMesh?i=e.geometry:(e.isBufferGeometry||e.isTexture)&&(i=e),i&&(r=i==null?void 0:i.userData)!=null&&r.LODS){const o=i.userData.LODS;if(n=this.lodInfos.get(o.key),t===void 0)return n!=null;if(n)return Array.isArray(n.lods)?t<n.lods.length:t===0}return!1}static assignMeshLOD(e,t){var i;if(!e)return Promise.resolve(null);if(e instanceof le||e.isMesh===!0){const n=e.geometry,r=this.getAssignedLODInformation(n);if(!r)return Promise.resolve(null);for(const o of td)(i=o.onBeforeGetLODMesh)==null||i.call(o,e,t);return e["LOD:requested level"]=t,Ts.getOrLoadLOD(n,t).then(o=>{if(Array.isArray(o)){const a=r.index||0;o=o[a]}return e["LOD:requested level"]===t&&(delete e["LOD:requested level"],o&&n!=o&&((o==null?void 0:o.isBufferGeometry)?(e.geometry=o,fn&&jk(e,"geometry",r.url)):fn&&console.error("Invalid LOD geometry",o))),o}).catch(o=>(console.error("Error loading mesh LOD",e,o),null))}else fn&&console.error("Invalid call to assignMeshLOD: Request mesh LOD but the object is not a mesh",e);return Promise.resolve(null)}static assignTextureLOD(e,t=0){if(!e)return Promise.resolve(null);if(e.isMesh===!0){const i=e;if(Array.isArray(i.material)){const n=new Array;for(const r of i.material){const o=this.assignTextureLOD(r,t);n.push(o)}return Promise.all(n).then(r=>{const o=new Array;for(const a of r)Array.isArray(a)&&o.push(...a);return o})}else return this.assignTextureLOD(i.material,t)}if(e instanceof Vt||e.isMaterial===!0){const i=e,n=[],r=new Array;if(fn&&rR.add(i),i.uniforms&&(i.isRawShaderMaterial||i.isShaderMaterial===!0)){const o=i;for(const a of Object.keys(o.uniforms)){const l=o.uniforms[a].value;if((l==null?void 0:l.isTexture)===!0){const c=this.assignTextureLODForSlot(l,t,i,a).then(h=>(h&&o.uniforms[a].value!=h&&(o.uniforms[a].value=h,o.uniformsNeedUpdate=!0),h));n.push(c),r.push(a)}}}else for(const o of Object.keys(i)){const a=i[o];if((a==null?void 0:a.isTexture)===!0){const l=this.assignTextureLODForSlot(a,t,i,o);n.push(l),r.push(o)}}return Promise.all(n).then(o=>{const a=new Array;for(let l=0;l<o.length;l++){const c=o[l],h=r[l];c&&c.isTexture===!0?a.push({material:i,slot:h,texture:c,level:t}):a.push({material:i,slot:h,texture:null,level:t})}return a})}if(e instanceof Pt||e.isTexture===!0){const i=e;return this.assignTextureLODForSlot(i,t,null,null)}return Promise.resolve(null)}static assignTextureLODForSlot(e,t,i,n){return(e==null?void 0:e.isTexture)!==!0?Promise.resolve(null):n==="glyphMap"?Promise.resolve(e):Ts.getOrLoadLOD(e,t).then(r=>{if(Array.isArray(r))return null;if((r==null?void 0:r.isTexture)===!0){if(r!=e){if(i&&n){const o=i[n];if(o){const a=this.getAssignedLODInformation(o);if(a&&(a==null?void 0:a.level)<t)return fn==="verbose"&&console.warn("Assigned texture level is already higher: ",a.level,t,i,o,r),null}i[n]=r}if(fn&&n&&i){const o=this.getAssignedLODInformation(e);o&&jk(i,n,o.url)}}return r}else fn=="verbose"&&console.warn("No LOD found for",e,t);return null}).catch(r=>(console.error("Error loading LOD",e,r),null))}afterRoot(e){var t,i;return fn&&console.log("AFTER",this.url,e),(t=this.parser.json.textures)==null||t.forEach((n,r)=>{var o;if(n!=null&&n.extensions){const a=n==null?void 0:n.extensions[Lh];if(a){if(!a.lods){fn&&console.warn("Texture has no LODs",a);return}let l=!1;for(const c of this.parser.associations.keys())if(c.isTexture===!0){const h=this.parser.associations.get(c);(h==null?void 0:h.textures)===r&&(l=!0,Ts.registerTexture(this.url,c,(o=a.lods)==null?void 0:o.length,r,a))}l||this.parser.getDependency("texture",r).then(c=>{var h;c&&Ts.registerTexture(this.url,c,(h=a.lods)==null?void 0:h.length,r,a)})}}}),(i=this.parser.json.meshes)==null||i.forEach((n,r)=>{if(n!=null&&n.extensions){const o=n==null?void 0:n.extensions[Lh];if(o&&o.lods){for(const a of this.parser.associations.keys())if(a.isMesh){const l=this.parser.associations.get(a);(l==null?void 0:l.meshes)===r&&Ts.registerMesh(this.url,o.guid,a,o.lods.length,l.primitives,o)}}}}),null}static async getOrLoadLOD(e,t){var a,l,c,h;const i=fn=="verbose",n=e.userData.LODS;if(!n)return null;const r=n==null?void 0:n.key;let o;if(e.isTexture===!0){const d=e;d.source&&d.source[wT]&&(o=d.source[wT])}if(o||(o=Ts.lodInfos.get(r)),o){if(t>0){let p=!1;const m=Array.isArray(o.lods);if(m&&t>=o.lods.length?p=!0:m||(p=!0),p)return this.lowresCache.get(r)}const d=Array.isArray(o.lods)?(a=o.lods[t])==null?void 0:a.path:o.lods;if(!d)return fn&&!o["missing:uri"]&&(o["missing:uri"]=!0,console.warn("Missing uri for progressive asset for LOD "+t,o)),null;const f=dne(n.url,d);if(f.endsWith(".glb")||f.endsWith(".gltf")){if(!o.guid)return console.warn("missing pointer for glb/gltf texture",o),null;const p=f+"_"+o.guid,m=this.previouslyLoaded.get(p);if(m!==void 0){i&&console.log(`LOD ${t} was already loading/loaded: ${p}`);let _=await m.catch(b=>(console.error(`Error loading LOD ${t} from ${f}
`,b),null)),A=!1;if(_==null||(_ instanceof Pt&&e instanceof Pt?(l=_.image)!=null&&l.data||(c=_.source)!=null&&c.data?_=this.copySettings(e,_):(A=!0,this.previouslyLoaded.delete(p)):_ instanceof pt&&e instanceof pt&&((h=_.attributes.position)!=null&&h.array||(A=!0,this.previouslyLoaded.delete(p)))),!A)return _}const v=o,y=new Promise(async(_,A)=>{const b=new Za;XH(b),fn&&(await new Promise(R=>setTimeout(R,1e3)),i&&console.warn("Start loading (delayed) "+f,v.guid));let E=f;if(v&&Array.isArray(v.lods)){const R=v.lods[t];R.hash&&(E+="?v="+R.hash)}const C=await b.loadAsync(E).catch(R=>(console.error(`Error loading LOD ${t} from ${f}
`,R),null));if(!C)return null;const T=C.parser;i&&console.log("Loading finished "+f,v.guid);let M=0;if(C.parser.json.textures){let R=!1;for(const S of C.parser.json.textures){if(S!=null&&S.extensions){const I=S==null?void 0:S.extensions[Lh];if(I!=null&&I.guid&&I.guid===v.guid){R=!0;break}}M++}if(R){let S=await T.getDependency("texture",M);return S&&Ts.assignLODInformation(n.url,S,r,t,void 0,void 0),i&&console.log('change "'+e.name+'" → "'+S.name+'"',f,M,S,p),e instanceof Pt&&(S=this.copySettings(e,S)),S&&(S.guid=v.guid),_(S)}else fn&&console.warn("Could not find texture with guid",v.guid,C.parser.json)}if(M=0,C.parser.json.meshes){let R=!1;for(const S of C.parser.json.meshes){if(S!=null&&S.extensions){const I=S==null?void 0:S.extensions[Lh];if(I!=null&&I.guid&&I.guid===v.guid){R=!0;break}}M++}if(R){const S=await T.getDependency("mesh",M),I=v;if(i&&console.log(`Loaded Mesh "${S.name}"`,f,M,S,p),S.isMesh===!0){const L=S.geometry;return Ts.assignLODInformation(n.url,L,r,t,void 0,I.density),_(L)}else{const L=new Array;for(let U=0;U<S.children.length;U++){const D=S.children[U];if(D.isMesh===!0){const V=D.geometry;Ts.assignLODInformation(n.url,V,r,t,U,I.density),L.push(V)}}return _(L)}}else fn&&console.warn("Could not find mesh with guid",v.guid,C.parser.json)}return _(null)});return this.previouslyLoaded.set(p,y),await y}else if(e instanceof Pt){i&&console.log("Load texture from uri: "+f);const m=await new Xa().loadAsync(f);return m?(m.guid=o.guid,m.flipY=!1,m.needsUpdate=!0,m.colorSpace=e.colorSpace,i&&console.log(o,m)):fn&&console.warn("failed loading",f),m}}else fn&&console.warn(`Can not load LOD ${t}: no LOD info found for "${r}" ${e.name}`,e.type);return null}static assignLODInformation(e,t,i,n,r,o){if(!t)return;t.userData||(t.userData={});const a=new yne(e,i,n,r,o);t.userData.LODS=a}static getAssignedLODInformation(e){var t;return((t=e==null?void 0:e.userData)==null?void 0:t.LODS)||null}static copySettings(e,t){return t=t.clone(),fn&&console.warn(`Copying texture settings
`,e.uuid,`
`,t.uuid),t.offset=e.offset,t.repeat=e.repeat,t.colorSpace=e.colorSpace,t.magFilter=e.magFilter,t.minFilter=e.minFilter,t.wrapS=e.wrapS,t.wrapT=e.wrapT,t.flipY=e.flipY,t.anisotropy=e.anisotropy,t.mipmaps||(t.generateMipmaps=e.generateMipmaps),t}};let fi=Ts;u(fi,"registerTexture",(e,t,i,n,r)=>{if(fn&&console.log("> Progressive: register texture",n,t.name,t.uuid,t,r),!t){fn&&console.error("gltf-progressive: Register texture without texture");return}t.source&&(t.source[wT]=r);const o=r.guid;Ts.assignLODInformation(e,t,o,i,n,void 0),Ts.lodInfos.set(o,r),Ts.lowresCache.set(o,t)}),u(fi,"registerMesh",(e,t,i,n,r,o)=>{var c;fn&&console.log("> Progressive: register mesh",r,i.name,o,i.uuid,i);const a=i.geometry;if(!a){fn&&console.warn("gltf-progressive: Register mesh without geometry");return}a.userData||(a.userData={}),Ts.assignLODInformation(e,a,t,n,r,o.density),Ts.lodInfos.set(t,o);let l=Ts.lowresCache.get(t);l?l.push(i.geometry):l=[i.geometry],Ts.lowresCache.set(t,l),n>0&&!Wp(i)&&mne(i,a);for(const h of td)(c=h.onRegisteredNewMesh)==null||c.call(h,i,o)}),u(fi,"lodInfos",new Map),u(fi,"previouslyLoaded",new Map),u(fi,"lowresCache",new Map);class yne{constructor(e,t,i,n,r){u(this,"url");u(this,"key");u(this,"level");u(this,"index");u(this,"density");this.url=e,this.key=t,this.level=i,n!=null&&(this.index=n),r!=null&&(this.density=r)}}const ll=h_("debugprogressive"),Ane=h_("noprogressive"),ST=Symbol("Needle:LODSManager"),CT=Symbol("Needle:LODState"),Om=Symbol("Needle:CurrentLOD"),cl={mesh_lod:-1,texture_lod:-1};var rs,la,Fh,YS,Ng,zg,KS,Uh;let Vh=(rs=class{constructor(e,t){u(this,"context");u(this,"renderer");u(this,"projectionScreenMatrix",new fe);u(this,"targetTriangleDensity",2e5);u(this,"updateInterval","auto");ls(this,la,1);u(this,"pause",!1);u(this,"manual",!1);u(this,"_lodchangedlisteners",[]);ls(this,Fh,void 0);ls(this,YS,new i_);ls(this,Ng,0);ls(this,zg,0);ls(this,KS,0);ls(this,Uh,0);u(this,"_fpsBuffer",[60,60,60,60,60]);u(this,"_sphere",new _n);u(this,"_tempBox",new Si);u(this,"_tempBox2",new Si);u(this,"tempMatrix",new fe);u(this,"_tempWorldPosition",new w);u(this,"_tempBoxSize",new w);u(this,"_tempBox2Size",new w);this.renderer=e,this.context={...t}}static getObjectLODState(e){return e[CT]}static addPlugin(e){td.push(e)}static removePlugin(e){const t=td.indexOf(e);t>=0&&td.splice(t,1)}static get(e,t){if(e[ST])return console.debug("[gltf-progressive] LODsManager already exists for this renderer"),e[ST];const i=new rs(e,{engine:"unknown",...t});return e[ST]=i,i}get plugins(){return td}addEventListener(e,t){e==="changed"&&this._lodchangedlisteners.push(t)}removeEventListener(e,t){if(e==="changed"){const i=this._lodchangedlisteners.indexOf(t);i>=0&&this._lodchangedlisteners.splice(i,1)}}enable(){if(wt(this,Fh))return;console.debug("[gltf-progressive] Enabling LODsManager for renderer");let e=0;cs(this,Fh,this.renderer.render);const t=this;rE(this.renderer),this.renderer.render=function(i,n){const r=t.renderer.getRenderTarget();(r==null||"isXRRenderTarget"in r&&r.isXRRenderTarget)&&(e=0,cs(t,Ng,wt(t,Ng)+1),cs(t,zg,wt(t,YS).getDelta()),cs(t,KS,wt(t,KS)+wt(t,zg)),t._fpsBuffer.shift(),t._fpsBuffer.push(1/wt(t,zg)),cs(t,Uh,t._fpsBuffer.reduce((a,l)=>a+l)/t._fpsBuffer.length),ll&&wt(t,Ng)%200===0&&console.log("FPS",Math.round(wt(t,Uh)),"Interval:",wt(t,la)));const o=e++;wt(t,Fh).call(this,i,n),t.onAfterRender(i,n,o)}}disable(){wt(this,Fh)&&(console.debug("[gltf-progressive] Disabling LODsManager for renderer"),this.renderer.render=wt(this,Fh),cs(this,Fh,void 0))}update(e,t){this.internalUpdate(e,t)}onAfterRender(e,t,i){if(this.pause)return;const r=this.renderer.renderLists.get(e,0).opaque;let o=!0;if(r.length===1){const a=r[0].material;(a.name==="EffectMaterial"||a.name==="CopyShader")&&(o=!1)}if((t.parent&&t.parent.type==="CubeCamera"||i>=1&&t.type==="OrthographicCamera")&&(o=!1),o){if(Ane||(this.updateInterval==="auto"?wt(this,Uh)<40&&wt(this,la)<10?(cs(this,la,wt(this,la)+1),ll&&console.warn("↓ Reducing LOD updates",wt(this,la),wt(this,Uh).toFixed(0))):wt(this,Uh)>=60&&wt(this,la)>1&&(cs(this,la,wt(this,la)-1),ll&&console.warn("↑ Increasing LOD updates",wt(this,la),wt(this,Uh).toFixed(0))):cs(this,la,this.updateInterval),wt(this,la)>0&&wt(this,Ng)%wt(this,la)!=0))return;this.internalUpdate(e,t)}}internalUpdate(e,t){var l,c;const i=this.renderer.renderLists.get(e,0),n=i.opaque;this.projectionScreenMatrix.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);const r=this.targetTriangleDensity;for(const h of n){if(h.material&&(((l=h.geometry)==null?void 0:l.type)==="BoxGeometry"||((c=h.geometry)==null?void 0:c.type)==="BufferGeometry")&&(h.material.name==="SphericalGaussianBlur"||h.material.name=="BackgroundCubeMaterial"||h.material.name==="CubemapFromEquirect"||h.material.name==="EquirectangularToCubeUV")){ll&&(h.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]||(h.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]=!0,console.warn("Ignoring skybox or BLIT object",h,h.material.name,h.material.type)));continue}switch(h.material.type){case"LineBasicMaterial":case"LineDashedMaterial":case"PointsMaterial":case"ShadowMaterial":case"MeshDistanceMaterial":case"MeshDepthMaterial":continue}if(ll==="color"&&h.material&&!h.object.progressive_debug_color){h.object.progressive_debug_color=!0;const f=Math.random()*16777215,p=new ms({color:f});h.object.material=p}const d=h.object;(d instanceof le||d.isMesh)&&this.updateLODs(e,t,d,r)}const o=i.transparent;for(const h of o){const d=h.object;(d instanceof le||d.isMesh)&&this.updateLODs(e,t,d,r)}const a=i.transmissive;for(const h of a){const d=h.object;(d instanceof le||d.isMesh)&&this.updateLODs(e,t,d,r)}}updateLODs(e,t,i,n){var a,l;i.userData||(i.userData={});let r=i[CT];if(r||(r=new _ne,i[CT]=r),r.frames++<2)return;for(const c of td)(a=c.onBeforeUpdateLOD)==null||a.call(c,this.renderer,e,t,i);this.calculateLodLevel(t,i,r,n,cl),cl.mesh_lod=Math.round(cl.mesh_lod),cl.texture_lod=Math.round(cl.texture_lod),cl.mesh_lod>=0&&this.loadProgressiveMeshes(i,cl.mesh_lod);let o=cl.texture_lod;if(i.material&&o>=0){const c=i["DEBUG:LOD"];c!=null&&(o=c),this.loadProgressiveTextures(i.material,o)}for(const c of td)(l=c.onAfterUpdatedLOD)==null||l.call(c,this.renderer,e,t,i,cl);r.lastLodLevel_Mesh=cl.mesh_lod,r.lastLodLevel_Texture=cl.texture_lod}loadProgressiveTextures(e,t){if(!e)return;if(Array.isArray(e)){for(const n of e)this.loadProgressiveTextures(n,t);return}let i=!1;(e[Om]===void 0||t<e[Om])&&(i=!0),i&&(e[Om]=t,fi.assignTextureLOD(e,t).then(n=>{this._lodchangedlisteners.forEach(r=>r({type:"texture",level:t,object:e}))}))}loadProgressiveMeshes(e,t){if(!e)return Promise.resolve(null);if(e[Om]!==t){e[Om]=t;const i=e.geometry;return fi.assignMeshLOD(e,t).then(n=>(n&&e[Om]==t&&i!=e.geometry&&this._lodchangedlisteners.forEach(r=>r({type:"mesh",level:t,object:e})),n))}return Promise.resolve(null)}static isInside(e,t){const i=e.min,n=e.max,r=(i.x+n.x)*.5,o=(i.y+n.y)*.5;return this._tempPtInside.set(r,o,i.z).applyMatrix4(t).z<0}calculateLodLevel(e,t,i,n,r){var y;if(!t){r.mesh_lod=-1,r.texture_lod=-1;return}if(!e){r.mesh_lod=-1,r.texture_lod=-1;return}let a=10+1,l=!1;if(ll&&t["DEBUG:LOD"]!=null)return t["DEBUG:LOD"];const c=fi.getMeshLODInformation(t.geometry),h=c==null?void 0:c.lods,d=h&&h.length>0,f=fi.getMaterialMinMaxLODsCount(t.material),p=(f==null?void 0:f.min_count)!=1/0&&f.min_count>0&&f.max_count>0;if(!d&&!p){r.mesh_lod=0,r.texture_lod=0;return}d||(l=!0,a=0);const m=this.renderer.domElement.clientHeight||this.renderer.domElement.height;let v=t.geometry.boundingBox;if(t.type==="SkinnedMesh"){const g=t;if(!g.boundingBox)g.computeBoundingBox();else if(i.frames%30===0){const _=Wp(g),A=g.geometry;_&&(g.geometry=_),g.computeBoundingBox(),g.geometry=A}v=g.boundingBox}if(v&&e.isPerspectiveCamera){const g=e;if(t.geometry.attributes.color&&t.geometry.attributes.color.count<100&&t.geometry.boundingSphere){this._sphere.copy(t.geometry.boundingSphere),this._sphere.applyMatrix4(t.matrixWorld);const S=e.getWorldPosition(this._tempWorldPosition);if(this._sphere.containsPoint(S)){r.mesh_lod=0,r.texture_lod=0;return}}if(this._tempBox.copy(v),this._tempBox.applyMatrix4(t.matrixWorld),rs.isInside(this._tempBox,this.projectionScreenMatrix)){r.mesh_lod=0,r.texture_lod=0;return}if(this._tempBox.applyMatrix4(this.projectionScreenMatrix),this.renderer.xr.enabled&&g.fov>70){const S=this._tempBox.min,I=this._tempBox.max;let L=S.x,U=S.y,D=I.x,V=I.y;const O=2,F=1.5,N=(S.x+I.x)*.5,q=(S.y+I.y)*.5;L=(L-N)*O+N,U=(U-q)*O+q,D=(D-N)*O+N,V=(V-q)*O+q;const $=L<0&&D>0?0:Math.min(Math.abs(S.x),Math.abs(I.x)),oe=U<0&&V>0?0:Math.min(Math.abs(S.y),Math.abs(I.y)),ae=Math.max($,oe);i.lastCentrality=(F-ae)*(F-ae)*(F-ae)}else i.lastCentrality=1;const _=this._tempBox.getSize(this._tempBoxSize);_.multiplyScalar(.5),screen.availHeight>0&&m>0&&_.multiplyScalar(m/screen.availHeight),_.x*=g.aspect;const A=e.matrixWorldInverse,b=this._tempBox2;b.copy(v),b.applyMatrix4(t.matrixWorld),b.applyMatrix4(A);const E=b.getSize(this._tempBox2Size),C=Math.max(E.x,E.y);if(Math.max(_.x,_.y)!=0&&C!=0&&(_.z=E.z/Math.max(E.x,E.y)*Math.max(_.x,_.y)),i.lastScreenCoverage=Math.max(_.x,_.y,_.z),i.lastScreenspaceVolume.copy(_),i.lastScreenCoverage*=i.lastCentrality,ll&&rs.debugDrawLine){const S=this.tempMatrix.copy(this.projectionScreenMatrix);S.invert();const I=rs.corner0,L=rs.corner1,U=rs.corner2,D=rs.corner3;I.copy(this._tempBox.min),L.copy(this._tempBox.max),L.x=I.x,U.copy(this._tempBox.max),U.y=I.y,D.copy(this._tempBox.max);const V=(I.z+D.z)*.5;I.z=L.z=U.z=D.z=V,I.applyMatrix4(S),L.applyMatrix4(S),U.applyMatrix4(S),D.applyMatrix4(S),rs.debugDrawLine(I,L,255),rs.debugDrawLine(I,U,255),rs.debugDrawLine(L,D,255),rs.debugDrawLine(U,D,255)}let M=999;if(h&&i.lastScreenCoverage>0){for(let S=0;S<h.length;S++)if(h[S].density/i.lastScreenCoverage<n){M=S;break}}M<a&&(a=M,l=!0)}if(l?r.mesh_lod=a:r.mesh_lod=i.lastLodLevel_Mesh,ll&&r.mesh_lod!=i.lastLodLevel_Mesh){const _=h==null?void 0:h[r.mesh_lod];_&&console.log(`Mesh LOD changed: ${i.lastLodLevel_Mesh} → ${r.mesh_lod} (${_.density.toFixed(0)}) - ${t.name}`)}if(p){const g="saveData"in globalThis.navigator&&globalThis.navigator.saveData===!0;if(i.lastLodLevel_Texture<0){if(r.texture_lod=f.max_count-1,ll){const _=f.lods[f.max_count-1];ll&&console.log(`First Texture LOD ${r.texture_lod} (${_.max_height}px) - ${t.name}`)}}else{const _=i.lastScreenspaceVolume.x+i.lastScreenspaceVolume.y+i.lastScreenspaceVolume.z;let A=i.lastScreenCoverage*4;((y=this.context)==null?void 0:y.engine)==="model-viewer"&&(A*=1.5);const E=m/window.devicePixelRatio*A;for(let C=f.lods.length-1;C>=0;C--){let T=f.lods[C];if(!(g&&T.max_height>=2048)&&!(fne()&&T.max_height>4096)&&T.max_height>E){if(r.texture_lod=C,r.texture_lod<i.lastLodLevel_Texture){const M=T.max_height;ll&&console.log(`Texture LOD changed: ${i.lastLodLevel_Texture} → ${r.texture_lod} = ${M}px 
Screensize: ${E.toFixed(0)}px, Coverage: ${(100*i.lastScreenCoverage).toFixed(2)}%, Volume ${_.toFixed(1)} 
${t.name}`)}break}}}}else r.texture_lod=0}},la=new WeakMap,Fh=new WeakMap,YS=new WeakMap,Ng=new WeakMap,zg=new WeakMap,KS=new WeakMap,Uh=new WeakMap,u(rs,"debugDrawLine"),u(rs,"corner0",new w),u(rs,"corner1",new w),u(rs,"corner2",new w),u(rs,"corner3",new w),u(rs,"_tempPtInside",new w),rs);class _ne{constructor(){u(this,"frames",0);u(this,"lastLodLevel_Mesh",-1);u(this,"lastLodLevel_Texture",-1);u(this,"lastScreenCoverage",0);u(this,"lastScreenspaceVolume",new w);u(this,"lastCentrality",0)}}const Wk=Symbol("NEEDLE_mesh_lod"),sx=Symbol("NEEDLE_texture_lod");let cy=null;function KH(){const s=bne();s&&(s.mapURLs(function(e){return qk(),e}),qk(),cy==null||cy.disconnect(),cy=new MutationObserver(e=>{e.forEach(t=>{t.addedNodes.forEach(i=>{i instanceof HTMLElement&&i.tagName.toLowerCase()==="model-viewer"&&JH(i)})})}),cy.observe(document,{childList:!0,subtree:!0}))}function bne(){if(typeof customElements>"u")return null;const s=customElements.get("model-viewer");return s||(customElements.whenDefined("model-viewer").then(()=>{console.debug("[gltf-progressive] model-viewer defined"),KH()}),null)}function qk(){if(typeof document>"u")return;document.querySelectorAll("model-viewer").forEach(e=>{JH(e)})}const Xk=new WeakSet;let xne=0;function JH(s){if(!s||Xk.has(s))return null;Xk.add(s),console.debug("[gltf-progressive] found new model-viewer..."+ ++xne+`
`,s.getAttribute("src"));let e=null,t=null,i=null;for(let n=s;n!=null;n=Object.getPrototypeOf(n)){const r=Object.getOwnPropertySymbols(n),o=r.find(c=>c.toString()=="Symbol(renderer)"),a=r.find(c=>c.toString()=="Symbol(scene)"),l=r.find(c=>c.toString()=="Symbol(needsRender)");!e&&o!=null&&(e=s[o].threeRenderer),!t&&a!=null&&(t=s[a]),!i&&l!=null&&(i=s[l])}if(e&&t){let r=function(){if(i){let o=0,a=setInterval(()=>{if(o++>5){clearInterval(a);return}i==null||i.call(s)},300)}};console.debug("[gltf-progressive] setup model-viewer");const n=Vh.get(e,{engine:"model-viewer"});return Vh.addPlugin(new wne),n.enable(),n.addEventListener("changed",()=>{i==null||i.call(s)}),s.addEventListener("model-visibility",o=>{o.detail.visible&&(i==null||i.call(s))}),s.addEventListener("load",()=>{r()}),()=>{n.disable()}}return null}class wne{constructor(){u(this,"_didWarnAboutMissingUrl",!1)}onBeforeUpdateLOD(e,t,i,n){this.tryParseMeshLOD(t,n),this.tryParseTextureLOD(t,n)}getUrl(e){if(!e)return null;let t=e.getAttribute("src");return t||(t=e.src),t||(this._didWarnAboutMissingUrl||console.warn("No url found in modelviewer",e),this._didWarnAboutMissingUrl=!0),t}tryGetCurrentGLTF(e){return e._currentGLTF}tryGetCurrentModelViewer(e){return e.element}tryParseTextureLOD(e,t){if(t[sx]==!0)return;t[sx]=!0;const i=this.tryGetCurrentGLTF(e),n=this.tryGetCurrentModelViewer(e),r=this.getUrl(n);if(r&&i&&t.material){let a=function(l){var h,d,f;if(l[sx]==!0)return;l[sx]=!0,l.userData&&(l.userData.LOD=-1);const c=Object.keys(l);for(let p=0;p<c.length;p++){const m=c[p],v=l[m];if((v==null?void 0:v.isTexture)===!0){const y=(d=(h=v.userData)==null?void 0:h.associations)==null?void 0:d.textures;if(y==null)continue;const g=i.parser.json.textures[y];if(!g){console.warn("Texture data not found for texture index "+y);continue}if((f=g==null?void 0:g.extensions)!=null&&f[Lh]){const _=g.extensions[Lh];_&&r&&fi.registerTexture(r,v,_.lods.length,y,_)}}}};const o=t.material;if(Array.isArray(o))for(const l of o)a(l);else a(o)}}tryParseMeshLOD(e,t){var o,a;if(t[Wk]==!0)return;t[Wk]=!0;const i=this.tryGetCurrentModelViewer(e),n=this.getUrl(i);if(!n)return;const r=(a=(o=t.userData)==null?void 0:o.gltfExtensions)==null?void 0:a[Lh];if(r&&n){const l=t.uuid;fi.registerMesh(n,l,t,0,r.lods.length,r)}}}function Sne(s,e,t,i){rE(e),XH(t),YH(t,{progressive:!0,...i==null?void 0:i.hints}),t.register(r=>new fi(r,s));const n=Vh.get(e);return(i==null?void 0:i.enableLODsManager)!==!1&&n.enable(),n}KH();if(!pne){const s={gltfProgressive:{useNeedleProgressive:Sne,LODsManager:Vh,configureLoader:YH,getRaycastMesh:Wp,useRaycastMeshes:gne}};if(!globalThis.Needle)globalThis.Needle=s;else for(const e in s)globalThis.Needle[e]=s[e]}const $g=[];function oE(s){$g.indexOf(s)===-1&&$g.push(s)}function Cne(s){const e=$g.indexOf(s);e!==-1&&$g.splice(e,1)}const ev=[];function uD(s){ev.indexOf(s)===-1&&ev.push(s)}function Ene(s){const e=ev.indexOf(s);e!==-1&&ev.splice(e,1)}function ZH(s){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-start",{detail:s}));for(let e=0;e<$g.length;e++)$g[e](s)}function $H(s){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-end",{detail:s}));for(let e=0;e<ev.length;e++)ev[e](s)}const js={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function eV(s){const e=await fetch(s);if(e.ok)return e.json();throw new Error(e.statusText)}async function Tne(s){if(!s)throw new Error("No basePath supplied");return await eV(`${s}/profilesList.json`)}async function Mne(s,e,t=null,i=!0){if(!s)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const n=await Tne(e);let r;if(s.profiles.some(l=>{const c=n[l];return c&&(r={profileId:l,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}),!!r}),!r){if(!t)throw new Error("No matching profile name found");const l=n[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);r={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}const o=await eV(r.profilePath);let a;if(i){let l;if(s.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[s.handedness],!l)throw new Error(`No matching handedness, ${s.handedness}, in profile ${r.profileId}`);l.assetPath&&(a=r.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const Ine={xAxis:0,yAxis:0,button:0,state:js.ComponentState.DEFAULT};function Rne(s=0,e=0){let t=s,i=e;if(Math.sqrt(s*s+e*e)>1){const o=Math.atan2(e,s);t=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:i*.5+.5}}let Pne=class{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===js.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(Ine)}updateFromComponent({xAxis:e,yAxis:t,button:i,state:n}){const{normalizedXAxis:r,normalizedYAxis:o}=Rne(e,t);switch(this.componentProperty){case js.ComponentProperty.X_AXIS:this.value=this.states.includes(n)?r:.5;break;case js.ComponentProperty.Y_AXIS:this.value=this.states.includes(n)?o:.5;break;case js.ComponentProperty.BUTTON:this.value=this.states.includes(n)?i:0;break;case js.ComponentProperty.STATE:this.valueNodeProperty===js.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(n):this.value=this.states.includes(n)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},Bne=class{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(i=>{const n=new Pne(t.visualResponses[i]);this.visualResponses[i]=n}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:js.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=js.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=js.ComponentState.PRESSED:(t.touched||this.values.button>js.ButtonTouchThreshold)&&(this.values.state=js.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===js.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>js.AxisTouchThreshold&&(this.values.state=js.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===js.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>js.AxisTouchThreshold&&(this.values.state=js.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}},Dne=class{constructor(e,t,i){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=i,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(n=>{const r=this.layoutDescription.components[n];this.components[n]=new Bne(n,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}};const Cs=ie("debuginput");var Kh;(function(s){s.Mouse="mouse",s.Touch="touch",s.Controller="controller",s.Hand="hand"})(Kh||(Kh={}));var Yk;(function(s){s.PointerDown="pointerdown",s.PointerUp="pointerup",s.PointerMove="pointermove"})(Yk||(Yk={}));var Kk;(function(s){s.KeyDown="keydown",s.KeyUp="keyup",s.KeyPressed="keypress"})(Kk||(Kk={}));var Ai;(function(s){s.PointerDown="pointerdown",s.PointerUp="pointerup",s.PointerMove="pointermove",s.KeyDown="keydown",s.KeyUp="keyup",s.KeyPressed="keypress"})(Ai||(Ai={}));class Th extends PointerEvent{constructor(t,i,n){super(t,n);u(this,"clientZ");u(this,"deviceIndex");u(this,"origin");u(this,"source");u(this,"mode");u(this,"_ray");u(this,"space");u(this,"isClick",!1);u(this,"isDoubleClick",!1);u(this,"_used",!1);u(this,"_pointerid");u(this,"_pointerType");u(this,"_type");u(this,"metadata",{});u(this,"intersections",new Array);u(this,"_immediatePropagationStopped",!1);u(this,"_propagationStopped",!1);this.clientZ=n.clientZ,this._pointerid=n.pointerId,this._pointerType=n.pointerType,this._type=t,this.deviceIndex=n.deviceIndex,this.origin=n.origin,this.source=i,this.mode=n.mode,this._ray=n.ray,this.space=n.device}get isSpatial(){return this.mode!="screen"}get ray(){return this._ray||(this._ray=new jo(this.space.worldPosition.clone(),this.space.worldForward.clone())),this._ray}set ray(t){this._ray=t}get hasRay(){return this._ray!==void 0}get used(){return this._used}use(){this._used=!0}get pointerId(){return this._pointerid}get pointerType(){return this._pointerType}get type(){return this._type}get immediatePropagationStopped(){return this._immediatePropagationStopped}get propagationStopped(){return this._immediatePropagationStopped||this._propagationStopped}stopImmediatePropagation(){var t;this._immediatePropagationStopped=!0,super.stopImmediatePropagation(),(t=this.source)==null||t.stopImmediatePropagation()}stopPropagation(){var t;this._propagationStopped=!0,super.stopPropagation(),(t=this.source)==null||t.stopPropagation(),Cs&&console.warn("Stop propagation...",this.pointerId,this.pointerType)}}class Ny extends KeyboardEvent{constructor(t,i,n){super(t,n);u(this,"source");this.source=i}stopImmediatePropagation(){var t;super.stopImmediatePropagation(),(t=this.source)==null||t.stopImmediatePropagation()}}class One{constructor(e){u(this,"key");u(this,"keyType");u(this,"source");this.key=e.key,this.keyType=e.type,this.source=e}}var Uo;(function(s){s[s.Early=-100]="Early",s[s.Default=0]="Default",s[s.Late=100]="Late"})(Uo||(Uo={}));class tV{constructor(e){u(this,"_eventListeners",{});u(this,"_doubleClickTimeThreshold",.2);u(this,"_longPressTimeThreshold",1);u(this,"_specialCursorTrigger",0);u(this,"context");u(this,"_pointerDown",[!1]);u(this,"_pointerUp",[!1]);u(this,"_pointerClick",[!1]);u(this,"_pointerDoubleClick",[!1]);u(this,"_pointerPressed",[!1]);u(this,"_pointerPositions",[new Z]);u(this,"_pointerPositionsLastFrame",[new Z]);u(this,"_pointerPositionsDelta",[new Z]);u(this,"_pointerPositionsRC",[new Z]);u(this,"_pointerPositionDown",[new w]);u(this,"_pointerDownTime",[]);u(this,"_pointerUpTime",[]);u(this,"_pointerUpTimestamp",[]);u(this,"_pointerIds",[]);u(this,"_pointerTypes",[""]);u(this,"_mouseWheelChanged",[!1]);u(this,"_mouseWheelDeltaY",[0]);u(this,"_pointerEvent",[]);u(this,"_pointerEventsPressed",[]);u(this,"_pointerSpace",[]);u(this,"_pressedStack",new Map);u(this,"_htmlEventSource");u(this,"onLostFocus",()=>{for(const e in this.keysPressed)this.keysPressed[e].pressed=!1});u(this,"onEndOfFrame",()=>{for(let e=0;e<this._pointerUp.length;e++)this._pointerUp[e]=!1;for(let e=0;e<this._pointerDown.length;e++)this._pointerDown[e]=!1;for(let e=0;e<this._pointerClick.length;e++)this._pointerClick[e]=!1;for(let e=0;e<this._pointerDoubleClick.length;e++)this._pointerDoubleClick[e]=!1;for(const e of this._pointerPositionsDelta)e.set(0,0);for(let e=0;e<this._mouseWheelChanged.length;e++)this._mouseWheelChanged[e]=!1;for(let e=0;e<this._mouseWheelDeltaY.length;e++)this._mouseWheelDeltaY[e]=0});u(this,"onContextMenu",e=>{this.canReceiveInput(e)!==!1&&e instanceof PointerEvent&&e.pointerType});u(this,"keysPressed",{});u(this,"onKeyDown",e=>{if(Cs&&console.log(`key down ${e.code}, ${this.context.application.hasFocus}`,e),!this.context.application.hasFocus)return;const t=this.keysPressed[e.code];if(t&&t.pressed)return;this.keysPressed[e.code]={pressed:!0,frame:this.context.time.frameCount+1,startFrame:this.context.time.frameCount+1,key:e.key,code:e.code};const i=new Ny(Ai.KeyDown,e,e);this.onDispatchEvent(i)});u(this,"onKeyPressed",e=>{if(!this.context.application.hasFocus)return;const t=this.keysPressed[e.code];if(!t)return;t.pressed=!0,t.frame=this.context.time.frameCount+1;const i=new Ny(Ai.KeyPressed,e,e);this.onDispatchEvent(i)});u(this,"onKeyUp",e=>{if(!this.context.application.hasFocus)return;const t=this.keysPressed[e.code];if(!t)return;t.pressed=!1,t.frame=this.context.time.frameCount+1;const i=new Ny(Ai.KeyUp,e,e);this.onDispatchEvent(i)});u(this,"onWheelWindow",e=>{document.pointerLockElement&&this.onMouseWheel(e)});u(this,"onMouseWheel",e=>{if(this.canReceiveInput(e)===!1)return;this._mouseWheelDeltaY.length<=0&&this._mouseWheelDeltaY.push(0),this._mouseWheelChanged.length<=0&&this._mouseWheelChanged.push(!1),this._mouseWheelChanged[0]=!0;const t=this._mouseWheelDeltaY[0];this._mouseWheelDeltaY[0]=t+e.deltaY});u(this,"onPointerDown",e=>{if(this.context.isInAR||this.canReceiveInput(e)===!1)return;e.target instanceof HTMLElement&&e.target.setPointerCapture(e.pointerId);const t=this.getPointerId(e);Cs&&Pn(`pointer down #${t}, identifier:${e.pointerId}`);const i=this.getAndUpdateSpatialObjectForScreenPosition(t,e.clientX,e.clientY),n=new Th(Ai.PointerDown,e,{origin:this,mode:"screen",deviceIndex:0,pointerId:t,button:e.button,clientX:e.clientX,clientY:e.clientY,pointerType:e.pointerType,buttonName:this.getButtonName(e),device:i,pressure:e.pressure});this.onDown(n)});u(this,"onPointerMove",e=>{if(this.context.isInAR)return;let t=e.button;e.pointerType==="mouse"&&(t=this.getFirstPressedButtonForPointer(0)??0);const i=this.getPointerId(e,t);t===-1&&(t=i);const n=this.getAndUpdateSpatialObjectForScreenPosition(i,e.clientX,e.clientY),r=new Th(Ai.PointerMove,e,{origin:this,mode:"screen",deviceIndex:0,pointerId:i,button:t,clientX:e.clientX,clientY:e.clientY,pointerType:e.pointerType,buttonName:this.getButtonName(e),device:n,pressure:e.pressure});this.onMove(r)});u(this,"onPointerCancel",e=>{this.context.isInAR||(Cs&&console.log("Pointer cancel",e),this.onPointerUp(e))});u(this,"onPointerUp",e=>{if(this.context.isInAR)return;e.target instanceof HTMLElement&&e.target.releasePointerCapture(e.pointerId);const t=this.getPointerId(e),i=new Th(Ai.PointerUp,e,{origin:this,mode:"screen",deviceIndex:0,pointerId:t,button:e.button,clientX:e.clientX,clientY:e.clientY,pointerType:e.pointerType,buttonName:this.getButtonName(e),device:this.getAndUpdateSpatialObjectForScreenPosition(t,e.clientX,e.clientY),pressure:e.pressure});this.onUp(i),this._pointerIds[t]=-1,Cs&&console.log("ID="+t,"PointerId="+e.pointerId,"ALL:",[...this._pointerIds])});u(this,"onTouchStart",e=>{if(this.context.isInAR)for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],n=this.getPointerIndex(i.identifier),r=this.getAndUpdateSpatialObjectForScreenPosition(n,i.clientX,i.clientY),o=new Th(Ai.PointerDown,e,{origin:this,mode:"screen",deviceIndex:0,pointerId:n,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:r,pressure:i.force});this.onDown(o)}});u(this,"onTouchMove",e=>{if(this.context.isInAR)for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],n=this.getPointerIndex(i.identifier),r=this.getAndUpdateSpatialObjectForScreenPosition(n,i.clientX,i.clientY),o=new Th(Ai.PointerMove,e,{origin:this,mode:"screen",deviceIndex:0,pointerId:n,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:r,pressure:i.force});this.onMove(o)}});u(this,"onTouchEnd",e=>{if(this.context.isInAR)for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],n=this.getPointerIndex(i.identifier),r=new Th(Ai.PointerUp,e,{origin:this,mode:"screen",deviceIndex:0,pointerId:n,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:this.getAndUpdateSpatialObjectForScreenPosition(n,i.clientX,i.clientY),pressure:i.force});this.onUp(r),this._pointerIds[n]=-1}});u(this,"tempNearPlaneVector",new w);u(this,"tempFarPlaneVector",new w);u(this,"tempLookMatrix",new fe);this.context=e,this.context.post_render_callbacks.push(this.onEndOfFrame)}addEventListener(e,t,i){if(this._eventListeners[e]||(this._eventListeners[e]=[]),!t||typeof t!="function"){console.error("Invalid call to addEventListener: callback is required and must be a function!");return}i?i={...i}:i={};let n=0;(i==null?void 0:i.queue)!=null&&(n=i.queue);const r=this._eventListeners[e],o=r.find(a=>a.priority===n);o?o.listeners.push({callback:t,options:i}):(r.push({priority:n,listeners:[{callback:t,options:i}]}),r.sort((a,l)=>a.priority-l.priority))}removeEventListener(e,t,i){if(!this._eventListeners[e]||!t)return;const n=this._eventListeners[e];if((i==null?void 0:i.queue)!=null){const r=n.find(a=>a.priority===i.queue);if(!r)return;const o=r.listeners.findIndex(a=>a.callback===t);o>=0&&r.listeners.splice(o,1)}else for(const r of n){const o=r.listeners.findIndex(a=>a.callback===t);o>=0&&r.listeners.splice(o,1)}}dispatchEvent(e){var i,n,r,o;let t=!1;if(e instanceof Ny){const a=this._eventListeners[e.type];if(a)for(const l of a)for(let c=0;c<l.listeners.length;c++){const h=l.listeners[c];if((n=(i=h.options)==null?void 0:i.signal)!=null&&n.aborted){l.listeners.splice(c,1),c--;continue}h.options.once&&(l.listeners.splice(c,1),c--),h.callback(e)}}if(e instanceof Th){const a=this._eventListeners[e.type];if(a)for(const l of a){if(t)break;for(let c=0;c<l.listeners.length;c++){const h=l.listeners[c];if((o=(r=h.options)==null?void 0:r.signal)!=null&&o.aborted){l.listeners.splice(c,1),c--;continue}if(e.immediatePropagationStopped){t=!0,Cs&&console.log("immediatePropagationStopped",e.type);break}else e.propagationStopped&&(t=!0,Cs&&console.log("propagationStopped",e.type));h.options.once&&(l.listeners.splice(c,1),c--),h.callback(e)}}}}get mousePosition(){return this._pointerPositions[0]}get mousePositionRC(){return this._pointerPositionsRC[0]}get mouseDown(){return this._pointerDown[0]}get mouseUp(){return this._pointerUp[0]}get mouseClick(){return this._pointerClick[0]}get mouseDoubleClick(){return this._pointerDoubleClick[0]}get mousePressed(){return this._pointerPressed[0]}get mouseWheelChanged(){return this.getMouseWheelChanged(0)}setCursorPointer(){this._specialCursorTrigger+=1,this.context.domElement.style.cursor="pointer"}setCursorNormal(){this._specialCursorTrigger-=1,this._specialCursorTrigger=Math.max(0,this._specialCursorTrigger),this._specialCursorTrigger===0&&(this.context.domElement.style.cursor="default")}getIsPointerIdInUse(e){for(const t of this._pointerEventsPressed)if(t.pointerId===e&&t.used)return!0;return!1}getPointerPressedCount(){let e=0;for(let t=0;t<this._pointerPressed.length;t++)this._pointerPressed[t]&&e++;return e}getPointerPosition(e){return e>=this._pointerPositions.length?null:this._pointerPositions[e]}getPointerPositionLastFrame(e){return e>=this._pointerPositionsLastFrame.length?null:this._pointerPositionsLastFrame[e]}getPointerPositionDelta(e){return e>=this._pointerPositionsDelta.length?null:this._pointerPositionsDelta[e]}getPointerPositionRC(e){return e>=this._pointerPositionsRC.length?null:this._pointerPositionsRC[e]}getPointerDown(e){return e>=this._pointerDown.length?!1:this._pointerDown[e]}getPointerUp(e){return e>=this._pointerUp.length?!1:this._pointerUp[e]}getPointerPressed(e){return e>=this._pointerPressed.length?!1:this._pointerPressed[e]}getPointerClicked(e){return e>=this._pointerClick.length?!1:this._pointerClick[e]}getPointerDoubleClicked(e){return e>=this._pointerDoubleClick.length?!1:this._pointerDoubleClick[e]}getPointerDownTime(e){return e>=this._pointerDownTime.length?-1:this._pointerDownTime[e]}getPointerUpTime(e){return e>=this._pointerUpTime.length?-1:this._pointerUpTime[e]}getPointerLongPress(e){return e>=this._pointerDownTime.length?!1:this.getPointerPressed(e)&&this.context.time.time-this._pointerDownTime[e]>this._longPressTimeThreshold}getIsMouse(e){return e<0||e>=this._pointerTypes.length?!1:this._pointerTypes[e]===Kh.Mouse}getIsTouch(e){return e<0||e>=this._pointerTypes.length?!1:this._pointerTypes[e]===Kh.Touch}getTouchesPressedCount(){let e=0;for(let t=0;t<this._pointerPressed.length;t++)this._pointerPressed[t]&&this.getIsTouch(t)&&e++;return e}getMouseWheelChanged(e=0){return e>=this._mouseWheelChanged.length?!1:this._mouseWheelChanged[e]}getMouseWheelDeltaY(e=0){return e>=this._mouseWheelDeltaY.length?0:this._mouseWheelDeltaY[e]}getPointerEvent(e){if(!(e>=this._pointerEvent.length))return this._pointerEvent[e]??void 0}*foreachPointerId(e){for(let t=0;t<this._pointerTypes.length;t++)if(this._pointerIsActive(t)){if(e!==void 0){const i=this._pointerTypes[t];if(Array.isArray(e)){let n=!1;for(const r of e)if(i===r){n=!0;break}if(!n)continue}else if(e!==i)continue}yield t}}*foreachTouchId(){for(let e=0;e<this._pointerTypes.length;e++)this._pointerTypes[e]===Kh.Touch&&this._pointerIsActive[e]&&(yield e)}_pointerIsActive(e){return e<0?!1:this._pointerPressed[e]||this._pointerDown[e]||this._pointerUp[e]}onDownButton(e,t){let i=this._pressedStack.get(e);i||(i=[],this._pressedStack.set(e,i)),i.push(t)}onReleaseButton(e,t){const i=this._pressedStack.get(e);if(!i)return;const n=i.indexOf(t);n>=0&&i.splice(n,1)}getFirstPressedButtonForPointer(e){const t=this._pressedStack.get(e);if(t)return t[0]}getLatestPressedButtonForPointer(e){const t=this._pressedStack.get(e);if(t)return t[t.length-1]}getKeyDown(){for(const e in this.keysPressed){const t=this.keysPressed[e];if(t.startFrame===this.context.time.frameCount)return t.key}return null}getKeyPressed(){for(const e in this.keysPressed){const t=this.keysPressed[e];if(t.pressed)return t.key}return null}isKeyDown(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(e);if(t!==null){for(const n of t)if(this.isKeyDown(n))return!0;return!1}return((i=this.keysPressed[e])==null?void 0:i.startFrame)===this.context.time.frameCount&&this.keysPressed[e].pressed}isKeyUp(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(e);if(t!==null){for(const n of t)if(this.isKeyUp(n))return!0;return!1}return((i=this.keysPressed[e])==null?void 0:i.frame)===this.context.time.frameCount&&!this.keysPressed[e].pressed}isKeyPressed(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(e);if(t!==null){for(const n of t)if(this.isKeyPressed(n))return!0;return!1}return(i=this.keysPressed[e])==null?void 0:i.pressed}getCodeForCommonKeyName(e){if(e.length===1){if(e>="0"&&e<="9")return["Digit"+e];if(e>="a"&&e<="z")return["Key"+e.toUpperCase()];if(e==" ")return["Space"]}switch(e){case"shift":case"Shift":return["ShiftLeft","ShiftRight"];case"control":case"Control":return["ControlLeft","ControlRight"];case"alt":case"Alt":return["AltLeft","AltRight"]}return null}createInputEvent(e){switch(e.type){case Ai.PointerDown:Cs&&Pn("Create Pointer down"),this.onDownButton(e.deviceIndex,e.button),this.onDown(e);break;case Ai.PointerMove:Cs&&Pn("Create Pointer move"),this.onMove(e);break;case Ai.PointerUp:Cs&&Pn("Create Pointer up"),this.onUp(e),this.onReleaseButton(e.deviceIndex,e.button);break}}convertScreenspaceToRaycastSpace(e){return e.x=(e.x-this.context.domX)/this.context.domWidth*2-1,e.y=-((e.y-this.context.domY)/this.context.domHeight)*2+1,e}bindEvents(){this.unbindEvents(),this._htmlEventSource=this.context.renderer.domElement,window.addEventListener("contextmenu",this.onContextMenu),this._htmlEventSource.addEventListener("pointerdown",this.onPointerDown,{passive:!0}),window.addEventListener("pointermove",this.onPointerMove,{passive:!0,capture:!0}),window.addEventListener("pointerup",this.onPointerUp,{passive:!0}),window.addEventListener("pointercancel",this.onPointerCancel,{passive:!0}),window.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),this._htmlEventSource.addEventListener("wheel",this.onMouseWheel,{passive:!0}),window.addEventListener("wheel",this.onWheelWindow,{passive:!0}),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keypress",this.onKeyPressed,!1),window.addEventListener("keyup",this.onKeyUp,!1),window.addEventListener("blur",this.onLostFocus)}unbindEvents(){var e,t;window.removeEventListener("contextmenu",this.onContextMenu),(e=this._htmlEventSource)==null||e.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("pointercancel",this.onPointerCancel),(t=this._htmlEventSource)==null||t.removeEventListener("wheel",this.onMouseWheel,!1),window.removeEventListener("wheel",this.onWheelWindow,!1),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keypress",this.onKeyPressed,!1),window.removeEventListener("keyup",this.onKeyUp,!1),window.removeEventListener("blur",this.onLostFocus)}dispose(){const e=this.context.post_render_callbacks.indexOf(this.onEndOfFrame);e>=0&&this.context.post_render_callbacks.splice(e,1),this.unbindEvents()}canReceiveInput(e){var t;return e.target===((t=this.context.renderer)==null?void 0:t.domElement)||e.target===this.context.domElement||this.context.isInAR||this.context.isInAR&&e.target===document.body&&St.isMozillaXR()?!0:(Cs&&console.warn("CanReceiveInput:False for",e.target),!1)}getPointerId(e,t){return e.pointerType==="mouse"?0+(t??e.button):this.getPointerIndex(e.pointerId)}getButtonName(e){const t=e.button;if(e.pointerType==="mouse")switch(t){case 0:return"left";case 1:return"middle";case 2:return"right"}return"unknown"}getAndUpdateSpatialObjectForScreenPosition(e,t,i){let n=this._pointerSpace[e];n||(n=new ge,this._pointerSpace[e]=n),this._pointerSpace[e]=n;const r=this.context.mainCamera;if(r){const o=this.tempNearPlaneVector.set(t,i,-1);this.convertScreenspaceToRaycastSpace(o);const a=this.tempFarPlaneVector.set(o.x,o.y,1);o.unproject(r),a.unproject(r);const l=r.worldUp||yt(0,1,0).applyQuaternion(qi(r));this.tempLookMatrix.lookAt(a,o,l),n.position.set(o.x,o.y,o.z),n.quaternion.setFromRotationMatrix(this.tempLookMatrix)}return n}isInRect(e){if(this.context.isInXR)return!0;const t=this.context.domElement.getBoundingClientRect(),i=e.clientX,n=e.clientY,r=i>=t.x&&i<=t.right&&n>=t.y&&n<=t.bottom;return Cs&&!r&&console.log("Not in rect",t,i,n),r}onDown(e){const t=e.pointerId;if(this.getPointerPressed(t)&&console.warn(`Received pointerDown for pointerId that is already pressed: ${t}`,Cs?e:""),Cs&&console.log(e.pointerType,"DOWN",t),!!this.isInRect(e)){for(this.setPointerState(t,this._pointerPressed,!0),this.setPointerState(t,this._pointerDown,!0),this.setPointerStateT(t,this._pointerEvent,e.source);t>=this._pointerTypes.length;)this._pointerTypes.push(e.pointerType);for(this._pointerTypes[t]=e.pointerType;t>=this._pointerPositionDown.length;)this._pointerPositionDown.push(new w);for(this._pointerPositionDown[t].set(e.clientX,e.clientY,e.clientZ??0);t>=this._pointerPositions.length;)this._pointerPositions.push(new Z);this._pointerPositions[t].set(e.clientX,e.clientY),t>=this._pointerDownTime.length&&this._pointerDownTime.push(0),this._pointerDownTime[t]=this.context.time.realtimeSinceStartup,this.updatePointerPosition(e),this._pointerEventsPressed.push(e),this.onDispatchEvent(e)}}onMove(e){const t=e.pointerId,i=this.getPointerPressed(t);i===!1&&!this.isInRect(e)||e.pointerType===Kh.Touch&&!i||(this.updatePointerPosition(e),this.setPointerStateT(t,this._pointerEvent,e.source),this.onDispatchEvent(e))}onUp(e){const t=e.pointerId;if(!this.getPointerPressed(t)){Cs&&console.log(e.pointerType,"UP",t,"was not down");return}Cs&&console.log(e.pointerType,"UP",t),this.setPointerState(t,this._pointerPressed,!1),this.setPointerStateT(t,this._pointerEvent,e.source),this.setPointerState(t,this._pointerUp,!0),this.updatePointerPosition(e);for(let l=this._pointerEventsPressed.length-1;l>=0;l--)if(this._pointerEventsPressed[l].pointerId===t){this._pointerEventsPressed.splice(l,1);break}if(!this._pointerPositionDown[t]){Cs&&Yi("Received pointer up event without matching down event for button: "+t),console.warn("Received pointer up event without matching down event for button: "+t);return}const n=this._pointerUpTime[t],r=this._pointerDownTime[t],o=this.context.time.realtimeSinceStartup,a=o-r;if(t>=this._pointerUpTime.length&&this._pointerUpTime.push(-99),this._pointerUpTime[t]=o,a<1){let l=e.clientX-this._pointerPositionDown[t].x,c=e.clientY-this._pointerPositionDown[t].y,h=0;if(e.isSpatial&&e.clientZ!=null&&(h=e.clientZ-this._pointerPositionDown[t].z,l*=200,c*=200,h*=200),Math.abs(l)<5&&Math.abs(c)<5&&Math.abs(h)<5){this.setPointerState(t,this._pointerClick,!0),e.isClick=!0;const d=o-n;Cs&&console.log("CLICK",t,l,c,h,d),d<this._doubleClickTimeThreshold&&d>0&&(this.setPointerState(t,this._pointerDoubleClick,!0),e.isDoubleClick=!0)}}this.onDispatchEvent(e)}updatePointerPosition(e){const t=e.pointerId;for(;t>=this._pointerPositions.length;)this._pointerPositions.push(new Z);for(;t>=this._pointerPositionsLastFrame.length;)this._pointerPositionsLastFrame.push(new Z);for(;t>=this._pointerPositionsDelta.length;)this._pointerPositionsDelta.push(new Z);const i=this._pointerPositionsLastFrame[t];i.copy(this._pointerPositions[t]);const n=this._pointerPositionsDelta[t];let r=e.clientX-i.x,o=e.clientY-i.y;if(e.source instanceof MouseEvent||e.source instanceof TouchEvent){const h=e.source;r===0&&h.movementX!==0&&(r=h.movementX||0),o===0&&h.movementY!==0&&(o=h.movementY||0)}n.x+=r,n.y+=o,this._pointerPositions[t].x=e.clientX,this._pointerPositions[t].y=e.clientY;const a=e.clientX,l=e.clientY;for(;t>=this._pointerPositionsRC.length;)this._pointerPositionsRC.push(new Z);const c=this._pointerPositionsRC[t];c.set(a,l),this.convertScreenspaceToRaycastSpace(c)}getPointerIndex(e){let t=-1;for(let i=0;i<this._pointerIds.length;i++){if(this._pointerIds[i]===e)return i;t===-1&&this._pointerIds[i]===-1&&(t=i)}return t!==-1?(this._pointerIds[t]=e,t):(Cs&&console.log("PUSH pointerId:",e),this._pointerIds.push(e),this._pointerIds.length-1)}setPointerState(e,t,i){t[e]=i}setPointerStateT(e,t,i){return t[e]=i,i}onDispatchEvent(e){const t=Ot.Current;try{Ot.Current=this.context,this.dispatchEvent(e)}finally{Ot.Current=t}}}const Rg=new fe().makeRotationY(Math.PI),Ua=new xe().setFromAxisAngle(new w(0,1,0),Math.PI),Lne=ie("debugwebxr");class kne{constructor(){u(this,"priority",-1e5);u(this,"gameObject");if(this.gameObject=new ge,this.gameObject.name="Implicit XR Rig",Lne){const e=wD(16733661);e.position.y+=.5,this.gameObject.add(e)}}isXRRig(){return!0}get isActive(){return this.gameObject.visible}}const ql=ie("debugwebxr"),rx=ie("debugcustomgesture"),Fne="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Une="generic-trigger",Nne=new xe().setFromEuler(new oi(li.degToRad(0),li.degToRad(-90),li.degToRad(-90))),zne=new w(.04,-.04,0);class dD{constructor(e,t,i){u(this,"xr");u(this,"inputSource");u(this,"index",0);u(this,"emitEvents",!0);u(this,"_connected",!0);u(this,"_isTracking",!1);u(this,"__gamepad");u(this,"__hand");u(this,"__side");u(this,"_hitTestSource");u(this,"_hasSelectEvent",!1);u(this,"_isMxInk",!1);u(this,"_isMxInkFallback",!1);u(this,"_isMetaQuestTouchController",!1);u(this,"_handJointPoses",new Map);u(this,"_gripMatrix",new fe);u(this,"_gripPosition",new w);u(this,"_gripQuaternion",new xe);u(this,"_linearVelocity",new w);u(this,"_rayPositionRaw",new w);u(this,"_rayRotationRaw",new xe);u(this,"_rayMatrix",new fe);u(this,"_rayPosition",new w);u(this,"_rayQuaternion",new xe);u(this,"_gripWorldPosition",new w);u(this,"_gripWorldQuaternion",new xe);u(this,"_rayWorldPosition",new w);u(this,"_rayWorldQuaternion",new xe);u(this,"_pinchPosition",new w);u(this,"_ray");u(this,"_hand_wristDotUp");u(this,"_object");u(this,"_gripSpaceObject");u(this,"_raySpaceObject");u(this,"model",null);u(this,"_debugAxesHelper",new xo(.15));u(this,"_debugGripAxesHelper",new xo(.07));u(this,"_debugRayAxesHelper",new xo(.07));u(this,"_hitTestSourcePromise",null);u(this,"onPointerHits",e=>{});u(this,"_needleGamepadButtons",{});u(this,"_buttonMap",new Map);u(this,"_motioncontroller");u(this,"_layout");u(this,"getMotionController");u(this,"emitPointerDownEvent",!0);u(this,"emitPointerUpEvent",!0);u(this,"emitPointerMoveEvent",!0);u(this,"pointerMoveDistanceThreshold",.03);u(this,"pointerMoveAngleThreshold",.05);u(this,"_selectButtonIndex");u(this,"_squeezeButtonIndex");u(this,"onSelectStart",e=>{var n,r,o,a;if(!this.emitPointerDownEvent||this.inputSource!==e.inputSource)return;this.onUpdateFrame(e.frame),this._hasSelectEvent=!0;const t=(n=this._layout)==null?void 0:n.selectComponentId,i=(a=(o=(r=this._layout)==null?void 0:r.components[t])==null?void 0:o.gamepadIndices)==null?void 0:a.button;i!==void 0&&(this._selectButtonIndex=i),!rx&&(ql&&At.DrawDirection(this.rayWorldPosition,yt(0,.01,1).applyQuaternion(this.rayWorldQuaternion),16711680,10),this.emitPointerEvent(Ai.PointerDown,this._selectButtonIndex||0,"xr-standard-trigger",!0,e))});u(this,"onSelectEnd",e=>{this.emitPointerUpEvent&&(rx||this.inputSource===e.inputSource&&this.emitPointerEvent(Ai.PointerUp,this._selectButtonIndex||0,"xr-standard-trigger",!0,e))});u(this,"onSequeezeStart",e=>{var t,i,n;this.emitPointerDownEvent&&this.inputSource===e.inputSource&&(this._squeezeButtonIndex=(n=(i=(t=this._layout)==null?void 0:t.components["xr-standard-squeeze"])==null?void 0:i.gamepadIndices)==null?void 0:n.button,this._squeezeButtonIndex!==void 0&&(ql&&At.DrawDirection(this.rayWorldPosition,yt(0,.01,1).applyQuaternion(this.rayWorldQuaternion),255,10),this.emitPointerEvent(Ai.PointerDown,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,e)))});u(this,"onSequeezeEnd",e=>{this.emitPointerUpEvent&&this.inputSource===e.inputSource&&this._squeezeButtonIndex!==void 0&&this.emitPointerEvent(Ai.PointerUp,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,e)});u(this,"states",{});u(this,"_didMoveLastFrame",!1);u(this,"_lastPointerMovePosition",new w);u(this,"_lastPointerMoveQuaternion",new xe);u(this,"pointerInit");this.xr=e,this.inputSource=t,this.index=i,this._object=new ge,this._object.name=`NeedleXRController_${i}`,ql&&(this._object.add(this._debugAxesHelper),this._gripSpaceObject=new ge,this._raySpaceObject=new ge,this._gripSpaceObject.name=`NeedleXRController_${i}_gripSpace`,this._raySpaceObject.name=`NeedleXRController_${i}_raySpace`,this._gripSpaceObject.add(this._debugGripAxesHelper),this._raySpaceObject.add(this._debugRayAxesHelper),this.xr.context.scene.add(this._gripSpaceObject),this.xr.context.scene.add(this._raySpaceObject)),this.xr.context.scene.add(this._object),this._ray=new jo,this.pointerInit={origin:this,pointerType:this.hand?"hand":"controller",deviceIndex:this.index,pointerId:-1,mode:this.inputSource.targetRayMode,ray:this._ray,device:this._object,buttonName:"none"},this.initialize(),this.subscribeEvents()}get context(){return this.xr.context}get connected(){return this._connected}get isTracking(){return this._isTracking}get gamepad(){return this.__gamepad??(this.__gamepad=this.inputSource.gamepad)}get isHand(){return this.hand!=null}get hand(){return this.__hand??(this.__hand=this.inputSource.hand)}get handObject(){return this.context.renderer.xr.getHand(this.index)}get profiles(){return this.inputSource.profiles}get layout(){return this._layout}get targetRayMode(){return this.inputSource.targetRayMode}get targetRaySpace(){return this.inputSource.targetRaySpace}get gripSpace(){return this.inputSource.gripSpace}get side(){return this.__side??(this.__side=this.inputSource.handedness)}get isRight(){return this.side==="right"}get isLeft(){return this.side==="left"}get isStylus(){return this._isMxInk}getHitTestSource(){return this._hitTestSource||this._requestHitTestSource(),this._hitTestSource}get hasHitTestSource(){return this._hitTestSource}cancelHitTestSource(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}get hasSelectEvent(){return this._hasSelectEvent}getHitTest(){return this.xr.getHitTest(this)}getHandJointPose(e,t){var n;if(t=t||this.xr.frame,!this.hand||!(t!=null&&t.getJointPose)||!this.xr.referenceSpace)return null;let i=(n=this._handJointPoses)==null?void 0:n.get(e);return i||(i=t.getJointPose(e,this.xr.referenceSpace),i&&this._handJointPoses.set(e,i),i)}get gripPosition(){return yt(this._gripPosition)}get gripQuaternion(){return bl(this._gripQuaternion)}get gripMatrix(){return this._gripMatrix}get gripLinearVelocity(){return yt(this._linearVelocity).applyQuaternion(Ua)}get rayPosition(){return yt(this._rayPosition)}get rayQuaternion(){return bl(this._rayQuaternion)}get gripWorldPosition(){return yt(this._gripWorldPosition)}get gripWorldQuaternion(){return bl(this._gripWorldQuaternion)}get rayWorldPosition(){return yt(this._rayWorldPosition)}updateRayWorldPosition(){var t;const e=(t=this.xr.context.mainCamera)==null?void 0:t.parent;this._rayWorldPosition.copy(this._rayPositionRaw),e&&this._rayWorldPosition.applyMatrix4(e.matrixWorld)}get rayWorldQuaternion(){return bl(this._rayWorldQuaternion)}get pinchPosition(){return yt(this._pinchPosition)}updateRayWorldQuaternion(){var i;const e=(i=this.xr.context.mainCamera)==null?void 0:i.parent,t=e?qi(e):void 0;this._rayWorldQuaternion.copy(this._rayRotationRaw).multiply(Ua),t&&this._rayWorldQuaternion.premultiply(t)}get ray(){return this._ray.origin.copy(this.rayWorldPosition),this._ray.direction.copy(yt(0,0,1).applyQuaternion(this.rayWorldQuaternion)),this._ray}get handWristDotUp(){var t;if(this._hand_wristDotUp!==void 0)return this._hand_wristDotUp;const e=(t=this.handObject)==null?void 0:t.joints.wrist;if(e){const i=yt(0,1,0).applyQuaternion(e.quaternion),n=yt(0,1,0).dot(i);return this._hand_wristDotUp=n}}get isHandUpsideDown(){return this.handWristDotUp!==void 0?this.handWristDotUp<-.7:!1}get isTeleportGesture(){var e;return this.isHandUpsideDown&&((e=this.getGesture("pinch"))==null?void 0:e.isDown)}get object(){return this._object}async getModelUrl(){var e;return(e=this.getMotionController)==null?void 0:e.then(t=>(t==null?void 0:t.assetUrl)||null)}_requestHitTestSource(){var e;return this._hitTestSourcePromise?this._hitTestSourcePromise:this.xr.mode==="immersive-ar"&&this.inputSource.targetRayMode==="tracked-pointer"&&this.xr.session.requestHitTestSourceForTransientInput?this._hitTestSourcePromise=((e=this.xr.session.requestHitTestSourceForTransientInput({profile:this.inputSource.profiles[0],offsetRay:new XRRay}))==null?void 0:e.then(t=>(this._hitTestSourcePromise=null,this.connected?this._hitTestSource=t:(t.cancel(),null))))??null:null}onUpdate(e){performance.mark("NeedleXRController onUpdate start"),this.onUpdateFrame(e),this.updateInputEvents(),this.onUpdateMove(),performance.mark("NeedleXRController onUpdate end"),performance.measure("NeedleXRController onUpdate","NeedleXRController onUpdate start","NeedleXRController onUpdate end")}onRenderDebug(){var r;At.DrawSphere(this.rayWorldPosition,.003),At.DrawDirection(this.rayWorldPosition,yt(0,0,10).applyQuaternion(this.rayWorldQuaternion));const t=(this.inputSource.gripSpace?this.gripWorldPosition:this.object.worldPosition).sub(this.object.worldForward.multiplyScalar(.1)),i=this.inputSource.profiles.join(`
`);let n=`Controller[${this.index}] (${this.inputSource.targetRayMode}, ${this.side})
C:${this.connected?"x":"-"} T:${this.isTracking?"x":"-"} Hand:${this.inputSource.hand?"x":"-"} Pen: ${this._isMxInk?"x":"-"}`;if(this.inputSource.hand&&(n+=`
Pinch: ${(r=this.getGesture("pinch"))==null?void 0:r.value.toFixed(3)}`),n+=`
`+i,n+=`
`+(this.inputSource.targetRaySpace?"Ray: x":"Ray: -")+(this.inputSource.gripSpace?" Grip: x":" Grip: -")+(this.inputSource.gamepad?` Gamepad: ${this.inputSource.gamepad.mapping}`:" Gamepad: -"),this.inputSource.gamepad){const o=this.inputSource.gamepad;let a="[btns "+o.buttons.length+"]: "+o.buttons.map(l=>l.value.toPrecision(1)).join(",");a+=`
[axes `+o.axes.length+"]: "+o.axes.map(l=>l.toPrecision(1)).join(","),n+=`
`+a}At.DrawLabel(t,n,.006)}onUpdateFrame(e){var h,d,f,p,m,v,y,g,_,A,b;if(this._handJointPoses.clear(),this._hand_wristDotUp=void 0,!this.xr.referenceSpace){this._isTracking=!1;return}const t=e.getPose(this.inputSource.targetRaySpace,this.xr.referenceSpace);this._isTracking=t!=null;let i=null,n=null,r=null,o=null;if(t){const E=t.transform;if(this._rayMatrix.fromArray(E.matrix).premultiply(Rg),this._rayMatrix.decompose(this._rayPosition,this._rayQuaternion,yt(1,1,1)),r=yt(E.position),o=bl(E.orientation),this._isMxInk&&!this._isMxInkFallback){const C=yt(.013,0,-.028).applyQuaternion(o);r.add(C),this._rayPosition.add(C)}this._rayPositionRaw.copy(r),this._rayRotationRaw.copy(o)}if(this.inputSource.gripSpace){const E=e.getPose(this.inputSource.gripSpace,this.xr.referenceSpace);if(E){const C=E.transform;if(i=yt(C.position),n=bl(C.orientation),this._gripMatrix.fromArray(C.matrix).premultiply(Rg),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,yt(1,1,1)),"linearVelocity"in E&&E.linearVelocity){const T=E.linearVelocity;this._linearVelocity.set(T.x,T.y,T.z)}}}(h=this.xr.context.mainCamera)!=null&&h.parent&&(this._object.parent!==((d=this.xr.context.mainCamera)==null?void 0:d.parent)&&this.xr.context.mainCamera.parent.add(this._object),this._gripSpaceObject!==void 0&&((f=this._gripSpaceObject)==null?void 0:f.parent)!==((p=this.xr.context.mainCamera)==null?void 0:p.parent)&&this.xr.context.mainCamera.parent.add(this._gripSpaceObject),this._raySpaceObject!==void 0&&((m=this._raySpaceObject)==null?void 0:m.parent)!==((v=this.xr.context.mainCamera)==null?void 0:v.parent)&&this.xr.context.mainCamera.parent.add(this._raySpaceObject));const a=this.hand;if(a){let E=!1;const C=a.get("wrist"),T=C&&this.getHandJointPose(C,e);if(T){E=!0;const S=T.transform.position,I=T.transform.orientation;this._object.position.set(S.x,S.y,S.z),this._object.quaternion.set(I.x,I.y,I.z,I.w).multiply(Ua)}E||(this._object.position.copy(this._rayPosition),this._object.quaternion.copy(this._rayQuaternion).multiply(Ua));const M=a.get("middle-finger-metacarpal"),R=M&&this.getHandJointPose(M,e);R&&(this._gripMatrix.fromArray(R.transform.matrix).premultiply(Rg),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,yt(1,1,1)),i=yt().copy(R.transform.position),n=bl().copy(R.transform.orientation),n.multiply(Nne),i.add(yt(zne).applyQuaternion(n)))}else this.inputSource.gripSpace&&this.targetRayMode==="transient-pointer"&&i&&n?(this._object.position.copy(i),this._object.quaternion.copy(n).multiply(Ua)):r&&o&&(this._object.position.copy(r),this._object.quaternion.copy(o).multiply(Ua));ql&&(r&&o&&((y=this._raySpaceObject)==null||y.position.copy(r),(g=this._raySpaceObject)==null||g.quaternion.copy(o).multiply(Ua)),i&&n&&((_=this._gripSpaceObject)==null||_.position.copy(i),(A=this._gripSpaceObject)==null||A.quaternion.copy(n).multiply(Ua)));const l=(b=this.xr.context.mainCamera)==null?void 0:b.parent,c=l?qi(l):void 0;i&&n&&(this._gripWorldPosition.copy(i),l&&this._gripWorldPosition.applyMatrix4(l.matrixWorld),this._gripWorldQuaternion.copy(n),this._gripWorldQuaternion.multiply(Ua),c&&this._gripWorldQuaternion.premultiply(c)),this.updateRayWorldPosition(),this.updateRayWorldQuaternion()}onDisconnected(){var e,t,i,n,r,o;this._connected=!1,ql&&console.warn("Controller disconnected",this.index);for(const a of this._object.children)this.xr.context.scene.attach(a);(e=this._object)==null||e.removeFromParent(),(t=this._debugAxesHelper)==null||t.removeFromParent(),(i=this._debugGripAxesHelper)==null||i.removeFromParent(),(n=this._debugRayAxesHelper)==null||n.removeFromParent(),(r=this._gripSpaceObject)==null||r.removeFromParent(),(o=this._raySpaceObject)==null||o.removeFromParent(),this.unsubscribeEvents(),this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}getButton(e){var i;if(!this._layout)return;switch(e){case"primary-button":if(this.isLeft)e="x-button";else if(this.isRight)e="a-button";else return;break;case"primary":return this.hand?this.getGesture("pinch"):this.toNeedleGamepadButton(0,e)}if(this._buttonMap.has(e))return this.toNeedleGamepadButton(this._buttonMap.get(e),e);const t=(i=this._layout)==null?void 0:i.components[e];if(t!=null&&t.gamepadIndices)switch(t.type){case"button":case"squeeze":if(this.inputSource.gamepad){const n=t.gamepadIndices.button;return this._buttonMap.set(e,n),this.toNeedleGamepadButton(n,e)}break;default:console.warn("Unsupported component type",t.type);break}this._buttonMap.set(e,void 0)}getGesture(e){const t=this.states[e];if(!t)return null;this.states[e]=t;const i=this._needleGamepadButtons[e]||new Zk(void 0,e);return i.pressed=t.pressed,i.value=t.value,i.isDown=t.isDown,i.isUp=t.isUp,this._needleGamepadButtons[e]=i,i}getPointerId(e){if((e==="primary"||e==="pinch")&&(e=0),typeof e!="number"){const t=this._buttonMap.get(e);if(t===void 0)return;e=t}return this.index*10+e}toNeedleGamepadButton(e,t){var o,a;if(!((o=this.inputSource.gamepad)!=null&&o.buttons))return;const i=(a=this.inputSource.gamepad)==null?void 0:a.buttons[e],n=this.states[e],r=this._needleGamepadButtons[e]||new Zk(e,t);return i&&(r.pressed=i.pressed,r.value=i.value,r.touched=i.touched),n&&(r.isDown=n.isDown,r.isUp=n.isUp),this._needleGamepadButtons[e]=r,r}getStick(e){var i,n,r,o,a,l,c,h,d;if(!this._layout)return{x:0,y:0,z:0};if(e==="primary"){const f=((i=this.inputSource.gamepad)==null?void 0:i.axes[0])||0,p=((n=this.inputSource.gamepad)==null?void 0:n.axes[1])||0,m=((o=(r=this.inputSource.gamepad)==null?void 0:r.buttons[3])==null?void 0:o.value)||0;return{x:f,y:p,z:m}}const t=(a=this._layout)==null?void 0:a.components[e];if(t!=null&&t.gamepadIndices)switch(t.type){case"thumbstick":if(this.inputSource.gamepad){const f=t.gamepadIndices.xAxis,p=t.gamepadIndices.yAxis;let m=(l=this.inputSource.gamepad)==null?void 0:l.axes[f],v=(c=this.inputSource.gamepad)==null?void 0:c.axes[p];m*=-1,v*=-1;const y=t.gamepadIndices.button,g=(d=(h=this.inputSource.gamepad)==null?void 0:h.buttons[y])==null?void 0:d.value;return{x:m,y:v,z:g}}}return{x:0,y:0,z:0}}initialize(){var e;if(this._hasSelectEvent=this.profiles.includes("generic-hand-select")||this.profiles.some(t=>t.startsWith("generic-trigger")),this._isMetaQuestTouchController=this.profiles.includes("meta-quest-touch-plus")||this.profiles.includes("oculus-touch-v3"),this._isMxInk=this.profiles.includes("logitech-mx-ink")||this.profiles.includes("meta-quest-touch-plus")&&((e=this.inputSource.gamepad)==null?void 0:e.buttons.length)===7,!this._layout){if(this.inputSource.targetRayMode==="transient-pointer")return;const t=Mne(this.inputSource,Fne,Une);this.getMotionController=t.then(i=>{var o;if(!this.connected)return null;this._isMxInk&&!i.assetPath&&(ql&&console.log("Falling back to custom MX Ink model",i.profile,i.assetPath),i.assetPath="https://cdn.needle.tools/static/models/controllers/logitech_vr_stylus_v1.3.1_grip_questos68.glb",this._isMxInkFallback=!0),this._motioncontroller=new Dne(this.inputSource,i.profile,i.assetPath||"");const r=i.profile.layouts[this.inputSource.handedness];if(this._layout=r,this._layout&&!((o=this._layout.gamepad)!=null&&o.length)){this._layout.gamepad=[];for(const a in this._layout.components){const l=this._layout.components[a];this._layout.gamepad[l.gamepadIndices.button]=a}}return this._motioncontroller}).catch(i=>(this.inputSource&&console.warn("Couldn't initialize motion controller profile for ",this.inputSource,i),null))}}subscribeEvents(){this.xr.session.addEventListener("selectstart",this.onSelectStart),this.xr.session.addEventListener("selectend",this.onSelectEnd),this.xr.session.addEventListener("squeezestart",this.onSequeezeStart),this.xr.session.addEventListener("squeezeend",this.onSequeezeEnd)}unsubscribeEvents(){this.xr.session.removeEventListener("selectstart",this.onSelectStart),this.xr.session.removeEventListener("selectend",this.onSelectEnd),this.xr.session.removeEventListener("squeezestart",this.onSequeezeStart),this.xr.session.removeEventListener("squeezeend",this.onSequeezeEnd)}updateInputEvents(){var e,t,i;if((e=this.gamepad)!=null&&e.buttons){for(let n=0;n<this.gamepad.buttons.length;n++){const r=this.gamepad.buttons[n],o=this.states[n]||new Jk;let a=null;this._isMxInk&&(n===4||n===5)?(r.value>0&&!o.pressed?(a="pointerdown",o.isDown=!0,o.isUp=!1):r.value===0&&o.pressed?(a="pointerup",o.isDown=!1,o.isUp=!0):o.pressed&&(a="pointermove",o.isDown=!1,o.isUp=!1),o.pressed=r.value>0,o.value=r.value):(r.pressed&&!o.pressed?(a="pointerdown",o.isDown=!0,o.isUp=!1):!r.pressed&&o.pressed?(a="pointerup",o.isDown=!1,o.isUp=!0):(o.isDown=!1,o.isUp=!1),o.pressed=r.pressed,o.value=r.value),this.states[n]=o;const l=n!==this._selectButtonIndex&&n!==this._squeezeButtonIndex;if(a!=null&&l){let c=(t=this._layout)==null?void 0:t.gamepad[n];this._isMxInk&&n===4&&(c="stylus-touch"),this._isMxInk&&n===5&&(c="stylus-tip"),(ql||rx)&&console.log("Emitting pointer event",a,n,c,r.value,this.gamepad,this._layout),this.emitPointerEvent(a,n,c??"none",!1,null,r.value)}}if(this._isMetaQuestTouchController){const n=this.gamepad.buttons.length-1,r=this.states[n];if(r&&r.isDown){const o=this.context.menu;o.spatialMenuIsVisible?o.setSpatialMenuVisible(!1):this.context.menu.setSpatialMenuVisible(!0)}}}if(this.hand){const n=this.handObject;if(n){const r=n.joints["index-finger-tip"],o=n.joints["thumb-tip"];if(r&&o){const a=r.position.distanceTo(o.position);this._pinchPosition.lerpVectors(r.position,o.position,.5);const l=(i=this.xr.context.mainCamera)==null?void 0:i.parent;if(l&&this._pinchPosition.applyMatrix4(l.matrixWorld),a!==0){const d=this.states.pinch||new Jk,f=(.02+.01)*1.5;d.value=1-(a-.02)/f;const p=a<.02-.01,m=a>.02+.01;p&&!d.pressed?(rx&&console.log("pinch start",a),d.isDown=!0,d.isUp=!1,d.pressed=!0):m&&d.pressed?(d.isDown=!1,d.isUp=!0,d.pressed=!1):(d.isDown=!1,d.isUp=!1),this.states.pinch=d}}}}}onUpdateMove(){var i,n;if(!this.emitPointerMoveEvent)return;let e=!1;if(this._lastPointerMovePosition.distanceTo(this.gripWorldPosition)>this.pointerMoveDistanceThreshold*this.xr.rigScale&&(e=!0),e||this._lastPointerMoveQuaternion.angleTo(this.gripWorldQuaternion)>this.pointerMoveAngleThreshold&&(e=!0),e){this._didMoveLastFrame=!0,this._lastPointerMovePosition.copy(this.gripWorldPosition),this._lastPointerMoveQuaternion.copy(this.gripWorldQuaternion),ql&&At.DrawLabel(this.rayWorldPosition.add(this.object.worldForward.multiplyScalar(.1)),"move",.01);let r=this.xr.context.input.getFirstPressedButtonForPointer(this.index);r===void 0&&(r=0);const o=(n=(i=this.gamepad)==null?void 0:i.buttons[r])==null?void 0:n.value;this.emitPointerEvent("pointermove",r,"none",!1,null,o)}else this._didMoveLastFrame=!1}emitPointerEvent(e,t,i,n,r=null,o){if(!this.emitEvents){ql&&e!==Ai.PointerMove&&console.warn("Pointer events are disabled for this controller",this.index,e,t);return}if(this.xr.mode==="immersive-vr"||this.xr.isPassThrough){this.pointerInit.origin=this,this.pointerInit.pointerId=this.getPointerId(t),this.pointerInit.pointerType=this.hand?"hand":"controller",this.pointerInit.button=t,this.pointerInit.buttonName=i,this.pointerInit.isPrimary=n,this.pointerInit.mode=this.inputSource.targetRayMode,this.pointerInit.ray=this.ray,this.pointerInit.device=this.object,this.pointerInit.pressure=o,this.pointerInit.clientX=this._rayPosition.x/this.xr.rigScale,this.pointerInit.clientY=this._rayPosition.y/this.xr.rigScale,this.pointerInit.clientZ=this._rayPosition.z/this.xr.rigScale;const a=Ot.Current;Ot.Current=this.xr.context,ql&&e!=="pointermove"&&console.warn("Pointer event",e,t,i,{...this.pointerInit}),this.xr.context.input.createInputEvent(new Th(e,r,this.pointerInit)),Ot.Current=a}}}class Jk{constructor(){u(this,"isDown",!1);u(this,"isUp",!1);u(this,"pressed",!1);u(this,"value",0)}}class Zk{constructor(e,t){u(this,"index");u(this,"name");u(this,"touched",!1);u(this,"pressed",!1);u(this,"value",0);u(this,"isDown",!1);u(this,"isUp",!1);this.index=e,this.name=t}}const Pg=new Map,lg=new Map;let $k=0;function Gd(s,e,t){if(Pg.has(e)||Pg.set(e,new Array),Pg.get(e).push({method:s,options:{once:!1,...t}}),$k<30){const i=lg.get(e);i&&(i==null?void 0:i.length)>100&&($k+=1,console.warn(`You have ${i.length} methods registered for Event ${e}.

This might be a performance issue!
Consider unregistering the methods when they are not needed anymore!

To unregister you can call the function returned by your event hook (e.g.const unregister = onStart(...)) 

or by using the once option like onStart(()=>{}, { once:true }).

See https://engine.needle.tools/docs/scripting.html#special-lifecycle-hooks for more information.`))}}function Hd(s,e){const t=lg.get(e);if(t){for(let n=0;n<t.length;n++)if(t[n].method===s){t.splice(n,1);return}}const i=Pg.get(e);if(i){for(let n=0;n<i.length;n++)if(i[n].method===s){i.splice(n,1);return}}}function Xl(s,e){e===yi.ContextCreated&&oR.delete(s),iV(s,e)}function iV(s,e){e===Wt.Start&&Pg.get(yi.ContextCreated)&&iV(s,yi.ContextCreated);const t=e===Wt.Start||e===yi.ContextCreated,i=lg.get(e);i&&i.length>0&&tF(s,i,t);const n=Pg.get(e);if(n&&n.length>0){const r=[...n];n.length=0,tF(s,r,t),r.length>0&&(lg.has(e)||lg.set(e,new Array),lg.get(e).push(...r))}}const ox=new Array,eF={context:null};function tF(s,e,t){var n,r;ox.length=0;for(let o=0;o<e.length;o++)ox.push(e[o]);let i=oR.get(s);for(let o=0;o<ox.length;o++){const a=ox[o];let l=!0;if(i&&i.has(a)&&(l=!1),l)try{eF.context=s,(n=a.method)==null||n.call(eF,s)}catch(c){console.error("Error in lifecycle method",c)}if((r=a.options)!=null&&r.once){for(let c=0;c<e.length;c++)if(e[c]===a){e.splice(c,1);break}}else t&&(i||(i=new Set,oR.set(s,i)),i.add(a))}}const oR=new WeakMap,ET=2,_c=4,Qh=4,fD=4,id=new Int32Array(2),iF=new Float32Array(id.buffer),nF=new Float64Array(id.buffer),ax=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;class su{constructor(e,t){this.low=e|0,this.high=t|0}static create(e,t){return e==0&&t==0?su.ZERO:new su(e,t)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(e){return this.low==e.low&&this.high==e.high}}su.ZERO=new su(0,0);var aR;(function(s){s[s.UTF8_BYTES=1]="UTF8_BYTES",s[s.UTF16_STRING=2]="UTF16_STRING"})(aR||(aR={}));class m0{constructor(e){this.bytes_=e,this.position_=0}static allocate(e){return new m0(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return new su(this.readInt32(e),this.readInt32(e+4))}readUint64(e){return new su(this.readUint32(e),this.readUint32(e+4))}readFloat32(e){return id[0]=this.readInt32(e),iF[0]}readFloat64(e){return id[ax?0:1]=this.readInt32(e),id[ax?1:0]=this.readInt32(e+4),nF[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,t.low),this.writeInt32(e+4,t.high)}writeUint64(e,t){this.writeUint32(e,t.low),this.writeUint32(e+4,t.high)}writeFloat32(e,t){iF[0]=t,this.writeInt32(e,id[0])}writeFloat64(e,t){nF[0]=t,this.writeInt32(e,id[ax?0:1]),this.writeInt32(e+4,id[ax?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+_c+Qh)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<Qh;t++)e+=String.fromCharCode(this.readInt8(this.position_+_c+t));return e}__offset(e,t){const i=e-this.readInt32(e);return t<this.readInt16(i)?this.readInt16(i+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const i=this.readInt32(e);let n="",r=0;if(e+=_c,t===aR.UTF8_BYTES)return this.bytes_.subarray(e,e+i);for(;r<i;){let o;const a=this.readUint8(e+r++);if(a<192)o=a;else{const l=this.readUint8(e+r++);if(a<224)o=(a&31)<<6|l&63;else{const c=this.readUint8(e+r++);if(a<240)o=(a&15)<<12|(l&63)<<6|c&63;else{const h=this.readUint8(e+r++);o=(a&7)<<18|(l&63)<<12|(c&63)<<6|h&63}}}o<65536?n+=String.fromCharCode(o):(o-=65536,n+=String.fromCharCode((o>>10)+55296,(o&1024-1)+56320))}return n}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+_c}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Qh)throw new Error("FlatBuffers: file identifier must be length "+Qh);for(let t=0;t<Qh;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+_c+t))return!1;return!0}createLong(e,t){return su.create(e,t)}createScalarList(e,t){const i=[];for(let n=0;n<t;++n)e(n)!==null&&i.push(e(n));return i}createObjList(e,t){const i=[];for(let n=0;n<t;++n){const r=e(n);r!==null&&i.push(r.unpack())}return i}}class u_{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let t;e?t=e:t=1024,this.bb=m0.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,t){e>this.minalign&&(this.minalign=e);const i=~(this.bb.capacity()-this.space+t)+1&e-1;for(;this.space<i+e+t;){const n=this.bb.capacity();this.bb=u_.growByteBuffer(this.bb),this.space+=this.bb.capacity()-n}this.pad(i)}pad(e){for(let t=0;t<e;t++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,t,i){(this.force_defaults||t!=i)&&(this.addInt8(t),this.slot(e))}addFieldInt16(e,t,i){(this.force_defaults||t!=i)&&(this.addInt16(t),this.slot(e))}addFieldInt32(e,t,i){(this.force_defaults||t!=i)&&(this.addInt32(t),this.slot(e))}addFieldInt64(e,t,i){(this.force_defaults||!t.equals(i))&&(this.addInt64(t),this.slot(e))}addFieldFloat32(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat32(t),this.slot(e))}addFieldFloat64(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat64(t),this.slot(e))}addFieldOffset(e,t,i){(this.force_defaults||t!=i)&&(this.addOffset(t),this.slot(e))}addFieldStruct(e,t,i){t!=i&&(this.nested(t),this.slot(e))}nested(e){if(e!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const t=e.capacity();if(t&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const i=t<<1,n=m0.allocate(i);return n.setPosition(i-t),n.bytes().set(e.bytes(),i-t),n}addOffset(e){this.prep(_c,0),this.writeInt32(this.offset()-e+_c)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&this.vtable[t]==0;t--);const i=t+1;for(;t>=0;t--)this.addInt16(this.vtable[t]!=0?e-this.vtable[t]:0);const n=2;this.addInt16(e-this.object_start);const r=(i+n)*ET;this.addInt16(r);let o=0;const a=this.space;e:for(t=0;t<this.vtables.length;t++){const l=this.bb.capacity()-this.vtables[t];if(r==this.bb.readInt16(l)){for(let c=ET;c<r;c+=ET)if(this.bb.readInt16(a+c)!=this.bb.readInt16(l+c))continue e;o=this.vtables[t];break}}return o?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,o-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,t,i){const n=i?fD:0;if(t){const r=t;if(this.prep(this.minalign,_c+Qh+n),r.length!=Qh)throw new Error("FlatBuffers: file identifier must be length "+Qh);for(let o=Qh-1;o>=0;o--)this.writeInt8(r.charCodeAt(o))}this.prep(this.minalign,_c+n),this.addOffset(e),n&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,t){this.finish(e,t,!0)}requiredField(e,t){const i=this.bb.capacity()-e,n=i-this.bb.readInt32(i);if(!(this.bb.readInt16(n+t)!=0))throw new Error("FlatBuffers: field "+t+" must be set")}startVector(e,t,i){this.notNested(),this.vector_num_elems=t,this.prep(_c,e*t),this.prep(i,e*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const t=this.createString(e);return this.string_maps.set(e,t),t}createString(e){if(!e)return 0;let t;if(e instanceof Uint8Array)t=e;else{t=[];let i=0;for(;i<e.length;){let n;const r=e.charCodeAt(i++);if(r<55296||r>=56320)n=r;else{const o=e.charCodeAt(i++);n=(r<<10)+o+(65536-56623104-56320)}n<128?t.push(n):(n<2048?t.push(n>>6&31|192):(n<65536?t.push(n>>12&15|224):t.push(n>>18&7|240,n>>12&63|128),t.push(n>>6&63|128)),t.push(n&63|128))}}this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length);for(let i=0,n=this.space,r=this.bb.bytes();i<t.length;i++)r[n++]=t[i];return this.endVector()}createLong(e,t){return su.create(e,t)}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const t=[];for(let i=0;i<e.length;++i){const n=e[i];if(n!==null)t.push(this.createObjectOffset(n));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return t}createStructOffsetList(e,t){return t(this,e.length),this.createObjectOffsetList(e),this.endVector()}}const pD={};function mD(s,e){pD[s]=e}function nV(s){const e=s.getBufferIdentifier(),t=pD[e];return t(s)}function sV(s){return typeof s.guid=="function"?s.guid():null}function aE(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var rV={exports:{}};(function(s){var e={};e.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),e.useArrayBufferView=!e.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),s.exports.binaryFeatures=e;var t=s.exports.BlobBuilder;typeof window<"u"&&(t=s.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function i(){this._pieces=[],this._parts=[]}i.prototype.append=function(n){typeof n=="number"?this._pieces.push(n):(this.flush(),this._parts.push(n))},i.prototype.flush=function(){if(this._pieces.length>0){var n=new Uint8Array(this._pieces);e.useArrayBufferView||(n=n.buffer),this._parts.push(n),this._pieces=[]}},i.prototype.getBuffer=function(){if(this.flush(),e.useBlobBuilder){for(var n=new t,r=0,o=this._parts.length;r<o;r++)n.append(this._parts[r]);return n.getBlob()}else return new Blob(this._parts)},s.exports.BufferBuilder=i})(rV);var oV=rV.exports,Gne=oV.BufferBuilder,sF=oV.binaryFeatures,Hne={unpack:function(s){var e=new Er(s);return e.unpack()},pack:function(s){var e=new Tr;e.pack(s);var t=e.getBuffer();return t}},Vne=Hne;function Er(s){this.index=0,this.dataBuffer=s,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}Er.prototype.unpack=function(){var s=this.unpack_uint8();if(s<128)return s;if((s^224)<32)return(s^224)-32;var e;if((e=s^160)<=15)return this.unpack_raw(e);if((e=s^176)<=15)return this.unpack_string(e);if((e=s^144)<=15)return this.unpack_array(e);if((e=s^128)<=15)return this.unpack_map(e);switch(s){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}};Er.prototype.unpack_uint8=function(){var s=this.dataView[this.index]&255;return this.index++,s};Er.prototype.unpack_uint16=function(){var s=this.read(2),e=(s[0]&255)*256+(s[1]&255);return this.index+=2,e};Er.prototype.unpack_uint32=function(){var s=this.read(4),e=((s[0]*256+s[1])*256+s[2])*256+s[3];return this.index+=4,e};Er.prototype.unpack_uint64=function(){var s=this.read(8),e=((((((s[0]*256+s[1])*256+s[2])*256+s[3])*256+s[4])*256+s[5])*256+s[6])*256+s[7];return this.index+=8,e};Er.prototype.unpack_int8=function(){var s=this.unpack_uint8();return s<128?s:s-256};Er.prototype.unpack_int16=function(){var s=this.unpack_uint16();return s<32768?s:s-65536};Er.prototype.unpack_int32=function(){var s=this.unpack_uint32();return s<Math.pow(2,31)?s:s-Math.pow(2,32)};Er.prototype.unpack_int64=function(){var s=this.unpack_uint64();return s<Math.pow(2,63)?s:s-Math.pow(2,64)};Er.prototype.unpack_raw=function(s){if(this.length<this.index+s)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+s+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+s);return this.index+=s,e};Er.prototype.unpack_string=function(s){for(var e=this.read(s),t=0,i="",n,r;t<s;)n=e[t],n<128?(i+=String.fromCharCode(n),t++):(n^192)<32?(r=(n^192)<<6|e[t+1]&63,i+=String.fromCharCode(r),t+=2):(r=(n&15)<<12|(e[t+1]&63)<<6|e[t+2]&63,i+=String.fromCharCode(r),t+=3);return this.index+=s,i};Er.prototype.unpack_array=function(s){for(var e=new Array(s),t=0;t<s;t++)e[t]=this.unpack();return e};Er.prototype.unpack_map=function(s){for(var e={},t=0;t<s;t++){var i=this.unpack(),n=this.unpack();e[i]=n}return e};Er.prototype.unpack_float=function(){var s=this.unpack_uint32(),e=s>>31,t=(s>>23&255)-127,i=s&8388607|8388608;return(e===0?1:-1)*i*Math.pow(2,t-23)};Er.prototype.unpack_double=function(){var s=this.unpack_uint32(),e=this.unpack_uint32(),t=s>>31,i=(s>>20&2047)-1023,n=s&1048575|1048576,r=n*Math.pow(2,i-20)+e*Math.pow(2,i-52);return(t===0?1:-1)*r};Er.prototype.read=function(s){var e=this.index;if(e+s<=this.length)return this.dataView.subarray(e,e+s);throw new Error("BinaryPackFailure: read index out of range")};function Tr(){this.bufferBuilder=new Gne}Tr.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};Tr.prototype.pack=function(s){var e=typeof s;if(e==="string")this.pack_string(s);else if(e==="number")Math.floor(s)===s?this.pack_integer(s):this.pack_double(s);else if(e==="boolean")s===!0?this.bufferBuilder.append(195):s===!1&&this.bufferBuilder.append(194);else if(e==="undefined")this.bufferBuilder.append(192);else if(e==="object")if(s===null)this.bufferBuilder.append(192);else{var t=s.constructor;if(t==Array)this.pack_array(s);else if(t==Blob||t==File||s instanceof Blob||s instanceof File)this.pack_bin(s);else if(t==ArrayBuffer)sF.useArrayBufferView?this.pack_bin(new Uint8Array(s)):this.pack_bin(s);else if("BYTES_PER_ELEMENT"in s)sF.useArrayBufferView?this.pack_bin(new Uint8Array(s.buffer)):this.pack_bin(s.buffer);else if(t==Object||t.toString().startsWith("class"))this.pack_object(s);else if(t==Date)this.pack_string(s.toString());else if(typeof s.toBinaryPack=="function")this.bufferBuilder.append(s.toBinaryPack());else throw new Error('Type "'+t.toString()+'" not yet supported')}else throw new Error('Type "'+e+'" not yet supported');this.bufferBuilder.flush()};Tr.prototype.pack_bin=function(s){var e=s.length||s.byteLength||s.size;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this.bufferBuilder.append(218),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(s)};Tr.prototype.pack_string=function(s){var e=jne(s);if(e<=15)this.pack_uint8(176+e);else if(e<=65535)this.bufferBuilder.append(216),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(s)};Tr.prototype.pack_array=function(s){var e=s.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this.bufferBuilder.append(220),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(e);else throw new Error("Invalid length");for(var t=0;t<e;t++)this.pack(s[t])};Tr.prototype.pack_integer=function(s){if(s>=-32&&s<=127)this.bufferBuilder.append(s&255);else if(s>=0&&s<=255)this.bufferBuilder.append(204),this.pack_uint8(s);else if(s>=-128&&s<=127)this.bufferBuilder.append(208),this.pack_int8(s);else if(s>=0&&s<=65535)this.bufferBuilder.append(205),this.pack_uint16(s);else if(s>=-32768&&s<=32767)this.bufferBuilder.append(209),this.pack_int16(s);else if(s>=0&&s<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(s);else if(s>=-2147483648&&s<=2147483647)this.bufferBuilder.append(210),this.pack_int32(s);else if(s>=-9223372036854776e3&&s<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(s);else if(s>=0&&s<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(s);else throw new Error("Invalid integer")};Tr.prototype.pack_double=function(s){var e=0;s<0&&(e=1,s=-s);var t=Math.floor(Math.log(s)/Math.LN2),i=s/Math.pow(2,t)-1,n=Math.floor(i*Math.pow(2,52)),r=Math.pow(2,32),o=e<<31|t+1023<<20|n/r&1048575,a=n%r;this.bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(a)};Tr.prototype.pack_object=function(s){var e=Object.keys(s),t=e.length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(t);else throw new Error("Invalid length");for(var i in s)s.hasOwnProperty(i)&&(this.pack(i),this.pack(s[i]))};Tr.prototype.pack_uint8=function(s){this.bufferBuilder.append(s)};Tr.prototype.pack_uint16=function(s){this.bufferBuilder.append(s>>8),this.bufferBuilder.append(s&255)};Tr.prototype.pack_uint32=function(s){var e=s&4294967295;this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};Tr.prototype.pack_uint64=function(s){var e=s/Math.pow(2,32),t=s%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};Tr.prototype.pack_int8=function(s){this.bufferBuilder.append(s&255)};Tr.prototype.pack_int16=function(s){this.bufferBuilder.append((s&65280)>>8),this.bufferBuilder.append(s&255)};Tr.prototype.pack_int32=function(s){this.bufferBuilder.append(s>>>24&255),this.bufferBuilder.append((s&16711680)>>>16),this.bufferBuilder.append((s&65280)>>>8),this.bufferBuilder.append(s&255)};Tr.prototype.pack_int64=function(s){var e=Math.floor(s/Math.pow(2,32)),t=s%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};function Qne(s){var e=s.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}function jne(s){return s.length>600?new Blob([s]).size:s.replace(/[^\u0000-\u007F]/g,Qne).length}const rF=aE(Vne);let aV=!0,lV=!0;function zy(s,e,t){const i=s.match(e);return i&&i.length>=t&&parseInt(i[t],10)}function bv(s,e,t){if(!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype,n=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return n.apply(this,arguments);const l=c=>{const h=t(c);h&&(a.handleEvent?a.handleEvent(h):a(h))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,l),n.apply(this,[o,l])};const r=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return r.apply(this,arguments);if(!this._eventMap[e].has(a))return r.apply(this,arguments);const l=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[o,l])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function Wne(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(aV=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function qne(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(lV=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function gD(){if(typeof window=="object"){if(aV)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function lE(s,e){lV&&console.warn(s+" is deprecated, please use "+e+" instead.")}function Xne(s){const e={browser:null,version:null};if(typeof s>"u"||!s.navigator)return e.browser="Not a browser.",e;const{navigator:t}=s;if(t.mozGetUserMedia)e.browser="firefox",e.version=zy(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection&&!s.RTCIceGatherer)e.browser="chrome",e.version=zy(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=zy(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(s.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=zy(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function oF(s){return Object.prototype.toString.call(s)==="[object Object]"}function cV(s){return oF(s)?Object.keys(s).reduce(function(e,t){const i=oF(s[t]),n=i?cV(s[t]):s[t],r=i&&!Object.keys(n).length;return n===void 0||r?e:Object.assign(e,{[t]:n})},{}):s}function lR(s,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?lR(s,s.get(e[i]),t):i.endsWith("Ids")&&e[i].forEach(n=>{lR(s,s.get(n),t)})}))}function aF(s,e,t){const i=t?"outbound-rtp":"inbound-rtp",n=new Map;if(e===null)return n;const r=[];return s.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&r.push(o)}),r.forEach(o=>{s.forEach(a=>{a.type===i&&a.trackId===o.id&&lR(s,a,n)})}),n}const lF=gD;function hV(s,e){const t=s&&s.navigator;if(!t.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const h=typeof a[c]=="object"?a[c]:{ideal:a[c]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const d=function(f,p){return f?f+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(h.ideal!==void 0){l.optional=l.optional||[];let f={};typeof h.ideal=="number"?(f[d("min",c)]=h.ideal,l.optional.push(f),f={},f[d("max",c)]=h.ideal,l.optional.push(f)):(f[d("",c)]=h.ideal,l.optional.push(f))}h.exact!==void 0&&typeof h.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[d("",c)]=h.exact):["min","max"].forEach(f=>{h[f]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[d(f,c)]=h[f])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},n=function(a,l){if(e.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const c=function(h,d,f){d in h&&!(f in h)&&(h[f]=h[d],delete h[d])};a=JSON.parse(JSON.stringify(a)),c(a.audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const h=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!h)){delete a.video.facingMode;let d;if(c.exact==="environment"||c.ideal==="environment"?d=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(d=["front"]),d)return t.mediaDevices.enumerateDevices().then(f=>{f=f.filter(m=>m.kind==="videoinput");let p=f.find(m=>d.some(v=>m.label.toLowerCase().includes(v)));return!p&&f.length&&d.includes("back")&&(p=f[f.length-1]),p&&(a.video.deviceId=c.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=i(a.video),lF("chrome: "+JSON.stringify(a)),l(a)})}a.video=i(a.video)}return lF("chrome: "+JSON.stringify(a)),l(a)},r=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,c){n(a,h=>{t.webkitGetUserMedia(h,l,d=>{c&&c(r(d))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(l){return n(l,c=>a(c).then(h=>{if(c.audio&&!h.getAudioTracks().length||c.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return h},h=>Promise.reject(r(h))))}}}function Yne(s,e){if(!(s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices)&&s.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}s.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(n=>{const r=i.video&&i.video.width,o=i.video&&i.video.height,a=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:a||3}},r&&(i.video.mandatory.maxWidth=r),o&&(i.video.mandatory.maxHeight=o),s.navigator.mediaDevices.getUserMedia(i)})}}}function uV(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function dV(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",n=>{let r;s.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===n.track.id):r={track:n.track};const o=new Event("track");o.track=n.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(n=>{let r;s.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===n.id):r={track:n};const o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else bv(s,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function fV(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const e=function(n,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=n.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:n}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(a,l){let c=n.apply(this,arguments);return c||(c=e(this,a),this._senders.push(c)),c};const r=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const t=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],t.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof s=="object"&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const e=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(n=>n._pc=this),i},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function pV(s){if(!s.RTCPeerConnection)return;const e=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[i,n,r]=arguments;if(arguments.length>0&&typeof i=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof i!="function"))return e.apply(this,[]);const o=function(l){const c={};return l.result().forEach(d=>{const f={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(p=>{f[p]=d.stat(p)}),c[f.id]=f}),c},a=function(l){return new Map(Object.keys(l).map(c=>[c,l[c]]))};if(arguments.length>=2){const l=function(c){n(a(o(c)))};return e.apply(this,[l,i])}return new Promise((l,c)=>{e.apply(this,[function(h){l(a(o(h)))},c])}).then(n,r)}}function mV(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const t=s.RTCPeerConnection.prototype.getSenders;t&&(s.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r});const i=s.RTCPeerConnection.prototype.addTrack;i&&(s.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),s.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>aF(o,r.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const t=s.RTCPeerConnection.prototype.getReceivers;t&&(s.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),bv(s,"track",i=>(i.receiver._pc=i.srcElement,i)),s.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(r=>aF(r,n.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype&&"getStats"in s.RTCRtpReceiver.prototype))return;const e=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const i=arguments[0];let n,r,o;return this.getSenders().forEach(a=>{a.track===i&&(n?o=!0:n=a)}),this.getReceivers().forEach(a=>(a.track===i&&(r?o=!0:r=a),a.track===i)),o||n&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function gV(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const t=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const l=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const i=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const n=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),n.apply(this,arguments)}}function vV(s,e){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&e.version>=65)return gV(s);const t=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const h=t.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(d=>this._reverseStreams[d.id])};const i=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const d=new s.MediaStream(h.getTracks());this._streams[h.id]=d,this._reverseStreams[d.id]=h,h=d}i.apply(this,[h])};const n=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},s.RTCPeerConnection.prototype.addTrack=function(h,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(v=>v===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[d.id];if(m)m.addTrack(h),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new s.MediaStream([h]);this._streams[d.id]=v,this._reverseStreams[v.id]=d,this.addStream(v)}return this.getSenders().find(v=>v.track===h)};function r(c,h){let d=h.sdp;return Object.keys(c._reverseStreams||[]).forEach(f=>{const p=c._reverseStreams[f],m=c._streams[p.id];d=d.replace(new RegExp(m.id,"g"),p.id)}),new RTCSessionDescription({type:h.type,sdp:d})}function o(c,h){let d=h.sdp;return Object.keys(c._reverseStreams||[]).forEach(f=>{const p=c._reverseStreams[f],m=c._streams[p.id];d=d.replace(new RegExp(p.id,"g"),m.id)}),new RTCSessionDescription({type:h.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){const h=s.RTCPeerConnection.prototype[c],d={[c](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[m=>{const v=r(this,m);f[0].apply(null,[v])},m=>{f[1]&&f[1].apply(null,m)},arguments[2]]):h.apply(this,arguments).then(m=>r(this,m))}};s.RTCPeerConnection.prototype[c]=d[c]});const a=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:r(this,c)}}),s.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(h._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(v=>h.track===v)&&(f=this._streams[p])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function cR(s,e){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=s.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new(t==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};s.RTCPeerConnection.prototype[t]=n[t]})}function yV(s,e){bv(s,"negotiationneeded",t=>{const i=t.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return t})}const cF=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:yV,shimAddTrackRemoveTrack:vV,shimAddTrackRemoveTrackWithNative:gV,shimGetDisplayMedia:Yne,shimGetSendersWithDtmf:fV,shimGetStats:pV,shimGetUserMedia:hV,shimMediaStream:uV,shimOnTrack:dV,shimPeerConnection:cR,shimSenderReceiverGetStats:mV},Symbol.toStringTag,{value:"Module"}));function Kne(s,e){let t=!1;return s=JSON.parse(JSON.stringify(s)),s.filter(i=>{if(i&&(i.urls||i.url)){let n=i.urls||i.url;i.url&&!i.urls&&lE("RTCIceServer.url","RTCIceServer.urls");const r=typeof n=="string";return r&&(n=[n]),n=n.filter(o=>{if(o.indexOf("stun:")===0)return!1;const a=o.startsWith("turn")&&!o.startsWith("turn:[")&&o.includes("transport=udp");return a&&!t?(t=!0,!0):a&&!t}),delete i.url,i.urls=r?n[0]:n,!!n.length}})}var AV={exports:{}};(function(s){var e={};e.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(function(i){return i.trim()})},e.splitSections=function(t){var i=t.split(`
m=`);return i.map(function(n,r){return(r>0?"m="+n:n).trim()+`\r
`})},e.getDescription=function(t){var i=e.splitSections(t);return i&&i[0]},e.getMediaSections=function(t){var i=e.splitSections(t);return i.shift(),i},e.matchPrefix=function(t,i){return e.splitLines(t).filter(function(n){return n.indexOf(i)===0})},e.parseCandidate=function(t){var i;t.indexOf("a=candidate:")===0?i=t.substring(12).split(" "):i=t.substring(10).split(" ");for(var n={foundation:i[0],component:parseInt(i[1],10),protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]},r=8;r<i.length;r+=2)switch(i[r]){case"raddr":n.relatedAddress=i[r+1];break;case"rport":n.relatedPort=parseInt(i[r+1],10);break;case"tcptype":n.tcpType=i[r+1];break;case"ufrag":n.ufrag=i[r+1],n.usernameFragment=i[r+1];break;default:n[i[r]]=i[r+1];break}return n},e.writeCandidate=function(t){var i=[];i.push(t.foundation),i.push(t.component),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.address||t.ip),i.push(t.port);var n=t.type;return i.push("typ"),i.push(n),n!=="host"&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(t){return t.substr(14).split(" ")},e.parseRtpMap=function(t){var i=t.substr(9).split(" "),n={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),n.name=i[0],n.clockRate=parseInt(i[1],10),n.channels=i.length===3?parseInt(i[2],10):1,n.numChannels=n.channels,n},e.writeRtpMap=function(t){var i=t.payloadType;t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType);var n=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(n!==1?"/"+n:"")+`\r
`},e.parseExtmap=function(t){var i=t.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+`\r
`},e.parseFmtp=function(t){for(var i={},n,r=t.substr(t.indexOf(" ")+1).split(";"),o=0;o<r.length;o++)n=r[o].trim().split("="),i[n[0].trim()]=n[1];return i},e.writeFmtp=function(t){var i="",n=t.payloadType;if(t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var r=[];Object.keys(t.parameters).forEach(function(o){t.parameters[o]?r.push(o+"="+t.parameters[o]):r.push(o)}),i+="a=fmtp:"+n+" "+r.join(";")+`\r
`}return i},e.parseRtcpFb=function(t){var i=t.substr(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(t){var i="",n=t.payloadType;return t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(r){i+="a=rtcp-fb:"+n+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(t){var i=t.indexOf(" "),n={ssrc:parseInt(t.substr(7,i-7),10)},r=t.indexOf(":",i);return r>-1?(n.attribute=t.substr(i+1,r-i-1),n.value=t.substr(r+1)):n.attribute=t.substr(i+1),n},e.parseSsrcGroup=function(t){var i=t.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(function(n){return parseInt(n,10)})}},e.getMid=function(t){var i=e.matchPrefix(t,"a=mid:")[0];if(i)return i.substr(6)},e.parseFingerprint=function(t){var i=t.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1]}},e.getDtlsParameters=function(t,i){var n=e.matchPrefix(t+i,"a=fingerprint:");return{role:"auto",fingerprints:n.map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,i){var n="a=setup:"+i+`\r
`;return t.fingerprints.forEach(function(r){n+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),n},e.parseCryptoLine=function(t){var i=t.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;var i=t.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,i){var n=e.matchPrefix(t+i,"a=crypto:");return n.map(e.parseCryptoLine)},e.getIceParameters=function(t,i){var n=e.matchPrefix(t+i,"a=ice-ufrag:")[0],r=e.matchPrefix(t+i,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substr(12),password:r.substr(10)}:null},e.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`},e.parseRtpParameters=function(t){for(var i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=e.splitLines(t),r=n[0].split(" "),o=3;o<r.length;o++){var a=r[o],l=e.matchPrefix(t,"a=rtpmap:"+a+" ")[0];if(l){var c=e.parseRtpMap(l),h=e.matchPrefix(t,"a=fmtp:"+a+" ");switch(c.parameters=h.length?e.parseFmtp(h[0]):{},c.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+a+" ").map(e.parseRtcpFb),i.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(c.name.toUpperCase());break}}}return e.matchPrefix(t,"a=extmap:").forEach(function(d){i.headerExtensions.push(e.parseExtmap(d))}),i},e.writeRtpDescription=function(t,i){var n="";n+="m="+t+" ",n+=i.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=i.codecs.map(function(o){return o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType}).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(function(o){n+=e.writeRtpMap(o),n+=e.writeFmtp(o),n+=e.writeRtcpFb(o)});var r=0;return i.codecs.forEach(function(o){o.maxptime>r&&(r=o.maxptime)}),r>0&&(n+="a=maxptime:"+r+`\r
`),n+=`a=rtcp-mux\r
`,i.headerExtensions&&i.headerExtensions.forEach(function(o){n+=e.writeExtmap(o)}),n},e.parseRtpEncodingParameters=function(t){var i=[],n=e.parseRtpParameters(t),r=n.fecMechanisms.indexOf("RED")!==-1,o=n.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(t,"a=ssrc:").map(function(f){return e.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"}),l=a.length>0&&a[0].ssrc,c,h=e.matchPrefix(t,"a=ssrc-group:FID").map(function(f){var p=f.substr(17).split(" ");return p.map(function(m){return parseInt(m,10)})});h.length>0&&h[0].length>1&&h[0][0]===l&&(c=h[0][1]),n.codecs.forEach(function(f){if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){var p={ssrc:l,codecPayloadType:parseInt(f.parameters.apt,10)};l&&c&&(p.rtx={ssrc:c}),i.push(p),r&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},i.push(p))}}),i.length===0&&l&&i.push({ssrc:l});var d=e.matchPrefix(t,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substr(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substr(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(function(f){f.maxBitrate=d})),i},e.parseRtcpParameters=function(t){var i={},n=e.matchPrefix(t,"a=ssrc:").map(function(a){return e.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="cname"})[0];n&&(i.cname=n.value,i.ssrc=n.ssrc);var r=e.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=r.length===0;var o=e.matchPrefix(t,"a=rtcp-mux");return i.mux=o.length>0,i},e.parseMsid=function(t){var i,n=e.matchPrefix(t,"a=msid:");if(n.length===1)return i=n[0].substr(7).split(" "),{stream:i[0],track:i[1]};var r=e.matchPrefix(t,"a=ssrc:").map(function(o){return e.parseSsrcMedia(o)}).filter(function(o){return o.attribute==="msid"});if(r.length>0)return i=r[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(t){var i=e.parseMLine(t),n=e.matchPrefix(t,"a=max-message-size:"),r;n.length>0&&(r=parseInt(n[0].substr(19),10)),isNaN(r)&&(r=65536);var o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:i.fmt,maxMessageSize:r};var a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){var l=e.matchPrefix(t,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:r}}},e.writeSctpDescription=function(t,i){var n=[];return t.protocol!=="DTLS/SCTP"?n=["m="+t.kind+" 9 "+t.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:n=["m="+t.kind+" 9 "+t.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&n.push("a=max-message-size:"+i.maxMessageSize+`\r
`),n.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(t,i,n){var r,o=i!==void 0?i:2;t?r=t:r=e.generateSessionId();var a=n||"thisisadapterortc";return`v=0\r
o=`+a+" "+r+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.writeMediaSection=function(t,i,n,r){var o=e.writeRtpDescription(t.kind,i);if(o+=e.writeIceParameters(t.iceGatherer.getLocalParameters()),o+=e.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),n==="offer"?"actpass":"active"),o+="a=mid:"+t.mid+`\r
`,t.direction?o+="a="+t.direction+`\r
`:t.rtpSender&&t.rtpReceiver?o+=`a=sendrecv\r
`:t.rtpSender?o+=`a=sendonly\r
`:t.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,t.rtpSender){var a="msid:"+r.id+" "+t.rtpSender.track.id+`\r
`;o+="a="+a,o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+a,t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+`\r
`,t.rtpSender&&t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+`\r
`),o},e.getDirection=function(t,i){for(var n=e.splitLines(t),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(t){var i=e.splitLines(t),n=i[0].split(" ");return n[0].substr(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){var i=e.splitLines(t),n=i[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},e.parseOLine=function(t){var i=e.matchPrefix(t,"o=")[0],n=i.substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;for(var i=e.splitLines(t),n=0;n<i.length;n++)if(i[n].length<2||i[n].charAt(1)!=="=")return!1;return!0},s.exports=e})(AV);var _V=AV.exports;const pw=aE(_V);var qt=_V;function Jne(s){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[s.type]||s.type}function hF(s,e,t,i,n){var r=qt.writeRtpDescription(s.kind,e);if(r+=qt.writeIceParameters(s.iceGatherer.getLocalParameters()),r+=qt.writeDtlsParameters(s.dtlsTransport.getLocalParameters(),t==="offer"?"actpass":n||"active"),r+="a=mid:"+s.mid+`\r
`,s.rtpSender&&s.rtpReceiver?r+=`a=sendrecv\r
`:s.rtpSender?r+=`a=sendonly\r
`:s.rtpReceiver?r+=`a=recvonly\r
`:r+=`a=inactive\r
`,s.rtpSender){var o=s.rtpSender._initialTrackId||s.rtpSender.track.id;s.rtpSender._initialTrackId=o;var a="msid:"+(i?i.id:"-")+" "+o+`\r
`;r+="a="+a,r+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" "+a,s.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" "+a,r+="a=ssrc-group:FID "+s.sendEncodingParameters[0].ssrc+" "+s.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return r+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" cname:"+qt.localCName+`\r
`,s.rtpSender&&s.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" cname:"+qt.localCName+`\r
`),r}function Zne(s,e){var t=!1;return s=JSON.parse(JSON.stringify(s)),s.filter(function(i){if(i&&(i.urls||i.url)){var n=i.urls||i.url;i.url&&!i.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r=typeof n=="string";return r&&(n=[n]),n=n.filter(function(o){var a=o.indexOf("turn:")===0&&o.indexOf("transport=udp")!==-1&&o.indexOf("turn:[")===-1&&!t;return a?(t=!0,!0):o.indexOf("stun:")===0&&e>=14393&&o.indexOf("?transport=udp")===-1}),delete i.url,i.urls=r?n[0]:n,!!n.length}})}function lx(s,e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(r,o){r=parseInt(r,10);for(var a=0;a<o.length;a++)if(o[a].payloadType===r||o[a].preferredPayloadType===r)return o[a]},n=function(r,o,a,l){var c=i(r.parameters.apt,a),h=i(o.parameters.apt,l);return c&&h&&c.name.toLowerCase()===h.name.toLowerCase()};return s.codecs.forEach(function(r){for(var o=0;o<e.codecs.length;o++){var a=e.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if(r.name.toLowerCase()==="rtx"&&r.parameters&&a.parameters.apt&&!n(r,a,s.codecs,e.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(r.numChannels,a.numChannels),t.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(l){for(var c=0;c<r.rtcpFeedback.length;c++)if(r.rtcpFeedback[c].type===l.type&&r.rtcpFeedback[c].parameter===l.parameter)return!0;return!1});break}}}),s.headerExtensions.forEach(function(r){for(var o=0;o<e.headerExtensions.length;o++){var a=e.headerExtensions[o];if(r.uri===a.uri){t.headerExtensions.push(a);break}}}),t}function uF(s,e,t){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][s].indexOf(t)!==-1}function TT(s,e){var t=s.getRemoteCandidates().find(function(i){return e.foundation===i.foundation&&e.ip===i.ip&&e.port===i.port&&e.priority===i.priority&&e.protocol===i.protocol&&e.type===i.type});return t||s.addRemoteCandidate(e),!t}function Lr(s,e){var t=new Error(e);return t.name=s,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[s],t}var $ne=function(s,e){function t(l,c){c.addTrack(l),c.dispatchEvent(new s.MediaStreamTrackEvent("addtrack",{track:l}))}function i(l,c){c.removeTrack(l),c.dispatchEvent(new s.MediaStreamTrackEvent("removetrack",{track:l}))}function n(l,c,h,d){var f=new Event("track");f.track=c,f.receiver=h,f.transceiver={receiver:h},f.streams=d,s.setTimeout(function(){l._dispatchEvent("track",f)})}var r=function(l){var c=this,h=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(f){c[f]=h[f].bind(h)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",l=JSON.parse(JSON.stringify(l||{})),this.usingBundle=l.bundlePolicy==="max-bundle",l.rtcpMuxPolicy==="negotiate")throw Lr("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(l.rtcpMuxPolicy||(l.rtcpMuxPolicy="require"),l.iceTransportPolicy){case"all":case"relay":break;default:l.iceTransportPolicy="all";break}switch(l.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:l.bundlePolicy="balanced";break}if(l.iceServers=Zne(l.iceServers||[],e),this._iceGatherers=[],l.iceCandidatePoolSize)for(var d=l.iceCandidatePoolSize;d>0;d--)this._iceGatherers.push(new s.RTCIceGatherer({iceServers:l.iceServers,gatherPolicy:l.iceTransportPolicy}));else l.iceCandidatePoolSize=0;this._config=l,this.transceivers=[],this._sdpSessionId=qt.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(l,c){this._isClosed||(this.dispatchEvent(c),typeof this["on"+l]=="function"&&this["on"+l](c))},r.prototype._emitGatheringStateChange=function(){var l=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",l)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(l,c){var h=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:l,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&h)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var f=this._createIceAndDtlsTransports();d.iceTransport=f.iceTransport,d.dtlsTransport=f.dtlsTransport}return c||this.transceivers.push(d),d},r.prototype.addTrack=function(l,c){if(this._isClosed)throw Lr("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var h=this.transceivers.find(function(p){return p.track===l});if(h)throw Lr("InvalidAccessError","Track already exists.");for(var d,f=0;f<this.transceivers.length;f++)!this.transceivers[f].track&&this.transceivers[f].kind===l.kind&&(d=this.transceivers[f]);return d||(d=this._createTransceiver(l.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(c)===-1&&this.localStreams.push(c),d.track=l,d.stream=c,d.rtpSender=new s.RTCRtpSender(l,d.dtlsTransport),d.rtpSender},r.prototype.addStream=function(l){var c=this;if(e>=15025)l.getTracks().forEach(function(d){c.addTrack(d,l)});else{var h=l.clone();l.getTracks().forEach(function(d,f){var p=h.getTracks()[f];d.addEventListener("enabled",function(m){p.enabled=m.enabled})}),h.getTracks().forEach(function(d){c.addTrack(d,h)})}},r.prototype.removeTrack=function(l){if(this._isClosed)throw Lr("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(l instanceof s.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var c=this.transceivers.find(function(f){return f.rtpSender===l});if(!c)throw Lr("InvalidAccessError","Sender was not created by this connection.");var h=c.stream;c.rtpSender.stop(),c.rtpSender=null,c.track=null,c.stream=null;var d=this.transceivers.map(function(f){return f.stream});d.indexOf(h)===-1&&this.localStreams.indexOf(h)>-1&&this.localStreams.splice(this.localStreams.indexOf(h),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(l){var c=this;l.getTracks().forEach(function(h){var d=c.getSenders().find(function(f){return f.track===h});d&&c.removeTrack(d)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(l){return!!l.rtpSender}).map(function(l){return l.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(l){return!!l.rtpReceiver}).map(function(l){return l.rtpReceiver})},r.prototype._createIceGatherer=function(l,c){var h=this;if(c&&l>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var d=new s.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(d,"state",{value:"new",writable:!0}),this.transceivers[l].bufferedCandidateEvents=[],this.transceivers[l].bufferCandidates=function(f){var p=!f.candidate||Object.keys(f.candidate).length===0;d.state=p?"completed":"gathering",h.transceivers[l].bufferedCandidateEvents!==null&&h.transceivers[l].bufferedCandidateEvents.push(f)},d.addEventListener("localcandidate",this.transceivers[l].bufferCandidates),d},r.prototype._gather=function(l,c){var h=this,d=this.transceivers[c].iceGatherer;if(!d.onlocalcandidate){var f=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,d.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),d.onlocalcandidate=function(p){if(!(h.usingBundle&&c>0)){var m=new Event("icecandidate");m.candidate={sdpMid:l,sdpMLineIndex:c};var v=p.candidate,y=!v||Object.keys(v).length===0;if(y)(d.state==="new"||d.state==="gathering")&&(d.state="completed");else{d.state==="new"&&(d.state="gathering"),v.component=1,v.ufrag=d.getLocalParameters().usernameFragment;var g=qt.writeCandidate(v);m.candidate=Object.assign(m.candidate,qt.parseCandidate(g)),m.candidate.candidate=g,m.candidate.toJSON=function(){return{candidate:m.candidate.candidate,sdpMid:m.candidate.sdpMid,sdpMLineIndex:m.candidate.sdpMLineIndex,usernameFragment:m.candidate.usernameFragment}}}var _=qt.getMediaSections(h._localDescription.sdp);y?_[m.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:_[m.candidate.sdpMLineIndex]+="a="+m.candidate.candidate+`\r
`,h._localDescription.sdp=qt.getDescription(h._localDescription.sdp)+_.join("");var A=h.transceivers.every(function(b){return b.iceGatherer&&b.iceGatherer.state==="completed"});h.iceGatheringState!=="gathering"&&(h.iceGatheringState="gathering",h._emitGatheringStateChange()),y||h._dispatchEvent("icecandidate",m),A&&(h._dispatchEvent("icecandidate",new Event("icecandidate")),h.iceGatheringState="complete",h._emitGatheringStateChange())}},s.setTimeout(function(){f.forEach(function(p){d.onlocalcandidate(p)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var l=this,c=new s.RTCIceTransport(null);c.onicestatechange=function(){l._updateIceConnectionState(),l._updateConnectionState()};var h=new s.RTCDtlsTransport(c);return h.ondtlsstatechange=function(){l._updateConnectionState()},h.onerror=function(){Object.defineProperty(h,"state",{value:"failed",writable:!0}),l._updateConnectionState()},{iceTransport:c,dtlsTransport:h}},r.prototype._disposeIceAndDtlsTransports=function(l){var c=this.transceivers[l].iceGatherer;c&&(delete c.onlocalcandidate,delete this.transceivers[l].iceGatherer);var h=this.transceivers[l].iceTransport;h&&(delete h.onicestatechange,delete this.transceivers[l].iceTransport);var d=this.transceivers[l].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[l].dtlsTransport)},r.prototype._transceive=function(l,c,h){var d=lx(l.localCapabilities,l.remoteCapabilities);c&&l.rtpSender&&(d.encodings=l.sendEncodingParameters,d.rtcp={cname:qt.localCName,compound:l.rtcpParameters.compound},l.recvEncodingParameters.length&&(d.rtcp.ssrc=l.recvEncodingParameters[0].ssrc),l.rtpSender.send(d)),h&&l.rtpReceiver&&d.codecs.length>0&&(l.kind==="video"&&l.recvEncodingParameters&&e<15019&&l.recvEncodingParameters.forEach(function(f){delete f.rtx}),l.recvEncodingParameters.length?d.encodings=l.recvEncodingParameters:d.encodings=[{}],d.rtcp={compound:l.rtcpParameters.compound},l.rtcpParameters.cname&&(d.rtcp.cname=l.rtcpParameters.cname),l.sendEncodingParameters.length&&(d.rtcp.ssrc=l.sendEncodingParameters[0].ssrc),l.rtpReceiver.receive(d))},r.prototype.setLocalDescription=function(l){var c=this;if(["offer","answer"].indexOf(l.type)===-1)return Promise.reject(Lr("TypeError",'Unsupported type "'+l.type+'"'));if(!uF("setLocalDescription",l.type,c.signalingState)||c._isClosed)return Promise.reject(Lr("InvalidStateError","Can not set local "+l.type+" in state "+c.signalingState));var h,d;if(l.type==="offer")h=qt.splitSections(l.sdp),d=h.shift(),h.forEach(function(p,m){var v=qt.parseRtpParameters(p);c.transceivers[m].localCapabilities=v}),c.transceivers.forEach(function(p,m){c._gather(p.mid,m)});else if(l.type==="answer"){h=qt.splitSections(c._remoteDescription.sdp),d=h.shift();var f=qt.matchPrefix(d,"a=ice-lite").length>0;h.forEach(function(p,m){var v=c.transceivers[m],y=v.iceGatherer,g=v.iceTransport,_=v.dtlsTransport,A=v.localCapabilities,b=v.remoteCapabilities,E=qt.isRejected(p)&&qt.matchPrefix(p,"a=bundle-only").length===0;if(!E&&!v.rejected){var C=qt.getIceParameters(p,d),T=qt.getDtlsParameters(p,d);f&&(T.role="server"),(!c.usingBundle||m===0)&&(c._gather(v.mid,m),g.state==="new"&&g.start(y,C,f?"controlling":"controlled"),_.state==="new"&&_.start(T));var M=lx(A,b);c._transceive(v,M.codecs.length>0,!1)}})}return c._localDescription={type:l.type,sdp:l.sdp},l.type==="offer"?c._updateSignalingState("have-local-offer"):c._updateSignalingState("stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(l){var c=this;if(["offer","answer"].indexOf(l.type)===-1)return Promise.reject(Lr("TypeError",'Unsupported type "'+l.type+'"'));if(!uF("setRemoteDescription",l.type,c.signalingState)||c._isClosed)return Promise.reject(Lr("InvalidStateError","Can not set remote "+l.type+" in state "+c.signalingState));var h={};c.remoteStreams.forEach(function(g){h[g.id]=g});var d=[],f=qt.splitSections(l.sdp),p=f.shift(),m=qt.matchPrefix(p,"a=ice-lite").length>0,v=qt.matchPrefix(p,"a=group:BUNDLE ").length>0;c.usingBundle=v;var y=qt.matchPrefix(p,"a=ice-options:")[0];return y?c.canTrickleIceCandidates=y.substr(14).split(" ").indexOf("trickle")>=0:c.canTrickleIceCandidates=!1,f.forEach(function(g,_){var A=qt.splitLines(g),b=qt.getKind(g),E=qt.isRejected(g)&&qt.matchPrefix(g,"a=bundle-only").length===0,C=A[0].substr(2).split(" ")[2],T=qt.getDirection(g,p),M=qt.parseMsid(g),R=qt.getMid(g)||qt.generateIdentifier();if(E||b==="application"&&(C==="DTLS/SCTP"||C==="UDP/DTLS/SCTP")){c.transceivers[_]={mid:R,kind:b,protocol:C,rejected:!0};return}!E&&c.transceivers[_]&&c.transceivers[_].rejected&&(c.transceivers[_]=c._createTransceiver(b,!0));var S,I,L,U,D,V,O,F,N,q=qt.parseRtpParameters(g),$,oe;E||($=qt.getIceParameters(g,p),oe=qt.getDtlsParameters(g,p),oe.role="client"),O=qt.parseRtpEncodingParameters(g);var ae=qt.parseRtcpParameters(g),Re=qt.matchPrefix(g,"a=end-of-candidates",p).length>0,se=qt.matchPrefix(g,"a=candidate:").map(function(We){return qt.parseCandidate(We)}).filter(function(We){return We.component===1});if((l.type==="offer"||l.type==="answer")&&!E&&v&&_>0&&c.transceivers[_]&&(c._disposeIceAndDtlsTransports(_),c.transceivers[_].iceGatherer=c.transceivers[0].iceGatherer,c.transceivers[_].iceTransport=c.transceivers[0].iceTransport,c.transceivers[_].dtlsTransport=c.transceivers[0].dtlsTransport,c.transceivers[_].rtpSender&&c.transceivers[_].rtpSender.setTransport(c.transceivers[0].dtlsTransport),c.transceivers[_].rtpReceiver&&c.transceivers[_].rtpReceiver.setTransport(c.transceivers[0].dtlsTransport)),l.type==="offer"&&!E){S=c.transceivers[_]||c._createTransceiver(b),S.mid=R,S.iceGatherer||(S.iceGatherer=c._createIceGatherer(_,v)),se.length&&S.iceTransport.state==="new"&&(Re&&(!v||_===0)?S.iceTransport.setRemoteCandidates(se):se.forEach(function(We){TT(S.iceTransport,We)})),F=s.RTCRtpReceiver.getCapabilities(b),e<15019&&(F.codecs=F.codecs.filter(function(We){return We.name!=="rtx"})),V=S.sendEncodingParameters||[{ssrc:(2*_+2)*1001}];var ye=!1;if(T==="sendrecv"||T==="sendonly"){if(ye=!S.rtpReceiver,D=S.rtpReceiver||new s.RTCRtpReceiver(S.dtlsTransport,b),ye){var Ae;N=D.track,M&&M.stream==="-"||(M?(h[M.stream]||(h[M.stream]=new s.MediaStream,Object.defineProperty(h[M.stream],"id",{get:function(){return M.stream}})),Object.defineProperty(N,"id",{get:function(){return M.track}}),Ae=h[M.stream]):(h.default||(h.default=new s.MediaStream),Ae=h.default)),Ae&&(t(N,Ae),S.associatedRemoteMediaStreams.push(Ae)),d.push([N,D,Ae])}}else S.rtpReceiver&&S.rtpReceiver.track&&(S.associatedRemoteMediaStreams.forEach(function(We){var lt=We.getTracks().find(function(rt){return rt.id===S.rtpReceiver.track.id});lt&&i(lt,We)}),S.associatedRemoteMediaStreams=[]);S.localCapabilities=F,S.remoteCapabilities=q,S.rtpReceiver=D,S.rtcpParameters=ae,S.sendEncodingParameters=V,S.recvEncodingParameters=O,c._transceive(c.transceivers[_],!1,ye)}else if(l.type==="answer"&&!E){S=c.transceivers[_],I=S.iceGatherer,L=S.iceTransport,U=S.dtlsTransport,D=S.rtpReceiver,V=S.sendEncodingParameters,F=S.localCapabilities,c.transceivers[_].recvEncodingParameters=O,c.transceivers[_].remoteCapabilities=q,c.transceivers[_].rtcpParameters=ae,se.length&&L.state==="new"&&((m||Re)&&(!v||_===0)?L.setRemoteCandidates(se):se.forEach(function(We){TT(S.iceTransport,We)})),(!v||_===0)&&(L.state==="new"&&L.start(I,$,"controlling"),U.state==="new"&&U.start(oe));var je=lx(S.localCapabilities,S.remoteCapabilities),Be=je.codecs.filter(function(We){return We.name.toLowerCase()==="rtx"}).length;!Be&&S.sendEncodingParameters[0].rtx&&delete S.sendEncodingParameters[0].rtx,c._transceive(S,T==="sendrecv"||T==="recvonly",T==="sendrecv"||T==="sendonly"),D&&(T==="sendrecv"||T==="sendonly")?(N=D.track,M?(h[M.stream]||(h[M.stream]=new s.MediaStream),t(N,h[M.stream]),d.push([N,D,h[M.stream]])):(h.default||(h.default=new s.MediaStream),t(N,h.default),d.push([N,D,h.default]))):delete S.rtpReceiver}}),c._dtlsRole===void 0&&(c._dtlsRole=l.type==="offer"?"active":"passive"),c._remoteDescription={type:l.type,sdp:l.sdp},l.type==="offer"?c._updateSignalingState("have-remote-offer"):c._updateSignalingState("stable"),Object.keys(h).forEach(function(g){var _=h[g];if(_.getTracks().length){if(c.remoteStreams.indexOf(_)===-1){c.remoteStreams.push(_);var A=new Event("addstream");A.stream=_,s.setTimeout(function(){c._dispatchEvent("addstream",A)})}d.forEach(function(b){var E=b[0],C=b[1];_.id===b[2].id&&n(c,E,C,[_])})}}),d.forEach(function(g){g[2]||n(c,g[0],g[1],[])}),s.setTimeout(function(){c&&c.transceivers&&c.transceivers.forEach(function(g){g.iceTransport&&g.iceTransport.state==="new"&&g.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),g.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(l){l.iceTransport&&l.iceTransport.stop(),l.dtlsTransport&&l.dtlsTransport.stop(),l.rtpSender&&l.rtpSender.stop(),l.rtpReceiver&&l.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(l){this.signalingState=l;var c=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",c)},r.prototype._maybeFireNegotiationNeeded=function(){var l=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,s.setTimeout(function(){if(l.needNegotiation){l.needNegotiation=!1;var c=new Event("negotiationneeded");l._dispatchEvent("negotiationneeded",c)}},0))},r.prototype._updateIceConnectionState=function(){var l,c={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&!d.rejected&&c[d.iceTransport.state]++}),l="new",c.failed>0?l="failed":c.checking>0?l="checking":c.disconnected>0?l="disconnected":c.new>0?l="new":c.connected>0?l="connected":c.completed>0&&(l="completed"),l!==this.iceConnectionState){this.iceConnectionState=l;var h=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",h)}},r.prototype._updateConnectionState=function(){var l,c={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&d.dtlsTransport&&!d.rejected&&(c[d.iceTransport.state]++,c[d.dtlsTransport.state]++)}),c.connected+=c.completed,l="new",c.failed>0?l="failed":c.connecting>0?l="connecting":c.disconnected>0?l="disconnected":c.new>0?l="new":c.connected>0&&(l="connected"),l!==this.connectionState){this.connectionState=l;var h=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",h)}},r.prototype.createOffer=function(){var l=this;if(l._isClosed)return Promise.reject(Lr("InvalidStateError","Can not call createOffer after close"));var c=l.transceivers.filter(function(m){return m.kind==="audio"}).length,h=l.transceivers.filter(function(m){return m.kind==="video"}).length,d=arguments[0];if(d){if(d.mandatory||d.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");d.offerToReceiveAudio!==void 0&&(d.offerToReceiveAudio===!0?c=1:d.offerToReceiveAudio===!1?c=0:c=d.offerToReceiveAudio),d.offerToReceiveVideo!==void 0&&(d.offerToReceiveVideo===!0?h=1:d.offerToReceiveVideo===!1?h=0:h=d.offerToReceiveVideo)}for(l.transceivers.forEach(function(m){m.kind==="audio"?(c--,c<0&&(m.wantReceive=!1)):m.kind==="video"&&(h--,h<0&&(m.wantReceive=!1))});c>0||h>0;)c>0&&(l._createTransceiver("audio"),c--),h>0&&(l._createTransceiver("video"),h--);var f=qt.writeSessionBoilerplate(l._sdpSessionId,l._sdpSessionVersion++);l.transceivers.forEach(function(m,v){var y=m.track,g=m.kind,_=m.mid||qt.generateIdentifier();m.mid=_,m.iceGatherer||(m.iceGatherer=l._createIceGatherer(v,l.usingBundle));var A=s.RTCRtpSender.getCapabilities(g);e<15019&&(A.codecs=A.codecs.filter(function(E){return E.name!=="rtx"})),A.codecs.forEach(function(E){E.name==="H264"&&E.parameters["level-asymmetry-allowed"]===void 0&&(E.parameters["level-asymmetry-allowed"]="1"),m.remoteCapabilities&&m.remoteCapabilities.codecs&&m.remoteCapabilities.codecs.forEach(function(C){E.name.toLowerCase()===C.name.toLowerCase()&&E.clockRate===C.clockRate&&(E.preferredPayloadType=C.payloadType)})}),A.headerExtensions.forEach(function(E){var C=m.remoteCapabilities&&m.remoteCapabilities.headerExtensions||[];C.forEach(function(T){E.uri===T.uri&&(E.id=T.id)})});var b=m.sendEncodingParameters||[{ssrc:(2*v+1)*1001}];y&&e>=15019&&g==="video"&&!b[0].rtx&&(b[0].rtx={ssrc:b[0].ssrc+1}),m.wantReceive&&(m.rtpReceiver=new s.RTCRtpReceiver(m.dtlsTransport,g)),m.localCapabilities=A,m.sendEncodingParameters=b}),l._config.bundlePolicy!=="max-compat"&&(f+="a=group:BUNDLE "+l.transceivers.map(function(m){return m.mid}).join(" ")+`\r
`),f+=`a=ice-options:trickle\r
`,l.transceivers.forEach(function(m,v){f+=hF(m,m.localCapabilities,"offer",m.stream,l._dtlsRole),f+=`a=rtcp-rsize\r
`,m.iceGatherer&&l.iceGatheringState!=="new"&&(v===0||!l.usingBundle)&&(m.iceGatherer.getLocalCandidates().forEach(function(y){y.component=1,f+="a="+qt.writeCandidate(y)+`\r
`}),m.iceGatherer.state==="completed"&&(f+=`a=end-of-candidates\r
`))});var p=new s.RTCSessionDescription({type:"offer",sdp:f});return Promise.resolve(p)},r.prototype.createAnswer=function(){var l=this;if(l._isClosed)return Promise.reject(Lr("InvalidStateError","Can not call createAnswer after close"));if(!(l.signalingState==="have-remote-offer"||l.signalingState==="have-local-pranswer"))return Promise.reject(Lr("InvalidStateError","Can not call createAnswer in signalingState "+l.signalingState));var c=qt.writeSessionBoilerplate(l._sdpSessionId,l._sdpSessionVersion++);l.usingBundle&&(c+="a=group:BUNDLE "+l.transceivers.map(function(f){return f.mid}).join(" ")+`\r
`),c+=`a=ice-options:trickle\r
`;var h=qt.getMediaSections(l._remoteDescription.sdp).length;l.transceivers.forEach(function(f,p){if(!(p+1>h)){if(f.rejected){f.kind==="application"?f.protocol==="DTLS/SCTP"?c+=`m=application 0 DTLS/SCTP 5000\r
`:c+="m=application 0 "+f.protocol+` webrtc-datachannel\r
`:f.kind==="audio"?c+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:f.kind==="video"&&(c+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),c+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+f.mid+`\r
`;return}if(f.stream){var m;f.kind==="audio"?m=f.stream.getAudioTracks()[0]:f.kind==="video"&&(m=f.stream.getVideoTracks()[0]),m&&e>=15019&&f.kind==="video"&&!f.sendEncodingParameters[0].rtx&&(f.sendEncodingParameters[0].rtx={ssrc:f.sendEncodingParameters[0].ssrc+1})}var v=lx(f.localCapabilities,f.remoteCapabilities),y=v.codecs.filter(function(g){return g.name.toLowerCase()==="rtx"}).length;!y&&f.sendEncodingParameters[0].rtx&&delete f.sendEncodingParameters[0].rtx,c+=hF(f,v,"answer",f.stream,l._dtlsRole),f.rtcpParameters&&f.rtcpParameters.reducedSize&&(c+=`a=rtcp-rsize\r
`)}});var d=new s.RTCSessionDescription({type:"answer",sdp:c});return Promise.resolve(d)},r.prototype.addIceCandidate=function(l){var c=this,h;return l&&!(l.sdpMLineIndex!==void 0||l.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(d,f){if(c._remoteDescription)if(!l||l.candidate==="")for(var p=0;p<c.transceivers.length&&!(!c.transceivers[p].rejected&&(c.transceivers[p].iceTransport.addRemoteCandidate({}),h=qt.getMediaSections(c._remoteDescription.sdp),h[p]+=`a=end-of-candidates\r
`,c._remoteDescription.sdp=qt.getDescription(c._remoteDescription.sdp)+h.join(""),c.usingBundle));p++);else{var m=l.sdpMLineIndex;if(l.sdpMid){for(var v=0;v<c.transceivers.length;v++)if(c.transceivers[v].mid===l.sdpMid){m=v;break}}var y=c.transceivers[m];if(y){if(y.rejected)return d();var g=Object.keys(l.candidate).length>0?qt.parseCandidate(l.candidate):{};if(g.protocol==="tcp"&&(g.port===0||g.port===9)||g.component&&g.component!==1)return d();if((m===0||m>0&&y.iceTransport!==c.transceivers[0].iceTransport)&&!TT(y.iceTransport,g))return f(Lr("OperationError","Can not add ICE candidate"));var _=l.candidate.trim();_.indexOf("a=")===0&&(_=_.substr(2)),h=qt.getMediaSections(c._remoteDescription.sdp),h[m]+="a="+(g.type?_:"end-of-candidates")+`\r
`,c._remoteDescription.sdp=qt.getDescription(c._remoteDescription.sdp)+h.join("")}else return f(Lr("OperationError","Can not add ICE candidate"))}else return f(Lr("InvalidStateError","Can not add ICE candidate without a remote description"));d()})},r.prototype.getStats=function(l){if(l&&l instanceof s.MediaStreamTrack){var c=null;if(this.transceivers.forEach(function(d){d.rtpSender&&d.rtpSender.track===l?c=d.rtpSender:d.rtpReceiver&&d.rtpReceiver.track===l&&(c=d.rtpReceiver)}),!c)throw Lr("InvalidAccessError","Invalid selector.");return c.getStats()}var h=[];return this.transceivers.forEach(function(d){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(f){d[f]&&h.push(d[f].getStats())})}),Promise.all(h).then(function(d){var f=new Map;return d.forEach(function(p){p.forEach(function(m){f.set(m.id,m)})}),f})};var o=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];o.forEach(function(l){var c=s[l];if(c&&c.prototype&&c.prototype.getStats){var h=c.prototype.getStats;c.prototype.getStats=function(){return h.apply(this).then(function(d){var f=new Map;return Object.keys(d).forEach(function(p){d[p].type=Jne(d[p]),f.set(p,d[p])}),f})}}});var a=["createOffer","createAnswer"];return a.forEach(function(l){var c=r.prototype[l];r.prototype[l]=function(){var h=arguments;return typeof h[0]=="function"||typeof h[1]=="function"?c.apply(this,[arguments[2]]).then(function(d){typeof h[0]=="function"&&h[0].apply(null,[d])},function(d){typeof h[1]=="function"&&h[1].apply(null,[d])}):c.apply(this,arguments)}}),a=["setLocalDescription","setRemoteDescription","addIceCandidate"],a.forEach(function(l){var c=r.prototype[l];r.prototype[l]=function(){var h=arguments;return typeof h[1]=="function"||typeof h[2]=="function"?c.apply(this,arguments).then(function(){typeof h[1]=="function"&&h[1].apply(null)},function(d){typeof h[2]=="function"&&h[2].apply(null,[d])}):c.apply(this,arguments)}}),["getStats"].forEach(function(l){var c=r.prototype[l];r.prototype[l]=function(){var h=arguments;return typeof h[1]=="function"?c.apply(this,arguments).then(function(){typeof h[1]=="function"&&h[1].apply(null)}):c.apply(this,arguments)}}),r};const ese=aE($ne);function bV(s){const e=s&&s.navigator,t=function(n){return{name:{PermissionDeniedError:"NotAllowedError"}[n.name]||n.name,message:n.message,constraint:n.constraint,toString(){return this.name}}},i=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(n){return i(n).catch(r=>Promise.reject(t(r)))}}function xV(s){"getDisplayMedia"in s.navigator&&s.navigator.mediaDevices&&(s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||(s.navigator.mediaDevices.getDisplayMedia=s.navigator.getDisplayMedia.bind(s.navigator)))}function hR(s,e){if(s.RTCIceGatherer&&(s.RTCIceCandidate||(s.RTCIceCandidate=function(n){return n}),s.RTCSessionDescription||(s.RTCSessionDescription=function(n){return n}),e.version<15025)){const i=Object.getOwnPropertyDescriptor(s.MediaStreamTrack.prototype,"enabled");Object.defineProperty(s.MediaStreamTrack.prototype,"enabled",{set(n){i.set.call(this,n);const r=new Event("enabled");r.enabled=n,this.dispatchEvent(r)}})}s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)&&Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new s.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),s.RTCDtmfSender&&!s.RTCDTMFSender&&(s.RTCDTMFSender=s.RTCDtmfSender);const t=ese(s,e.version);s.RTCPeerConnection=function(n){return n&&n.iceServers&&(n.iceServers=Kne(n.iceServers,e.version),gD("ICE servers after filtering:",n.iceServers)),new t(n)},s.RTCPeerConnection.prototype=t.prototype}function wV(s){s.RTCRtpSender&&!("replaceTrack"in s.RTCRtpSender.prototype)&&(s.RTCRtpSender.prototype.replaceTrack=s.RTCRtpSender.prototype.setTrack)}const dF=Object.freeze(Object.defineProperty({__proto__:null,shimGetDisplayMedia:xV,shimGetUserMedia:bV,shimPeerConnection:hR,shimReplaceTrack:wV},Symbol.toStringTag,{value:"Module"}));function SV(s,e){const t=s&&s.navigator,i=s&&s.MediaStreamTrack;if(t.getUserMedia=function(n,r,o){lE("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(n).then(r,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const n=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),n(o.audio,"autoGainControl","mozAutoGainControl"),n(o.audio,"noiseSuppression","mozNoiseSuppression")),r(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return n(a,"mozAutoGainControl","autoGainControl"),n(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),n(a,"autoGainControl","mozAutoGainControl"),n(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function tse(s,e){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,s.navigator.mediaDevices.getUserMedia(i)})}function CV(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function uR(s,e){if(typeof s!="object"||!(s.RTCPeerConnection||s.mozRTCPeerConnection))return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=s.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};s.RTCPeerConnection.prototype[n]=o[n]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[r,o,a]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(c=>{c.type=t[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((h,d)=>{l.set(d,Object.assign({},h,{type:t[h.type]||h.type}))})}return l}).then(o,a)}}function EV(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const e=s.RTCPeerConnection.prototype.getSenders;e&&(s.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n});const t=s.RTCPeerConnection.prototype.addTrack;t&&(s.RTCPeerConnection.prototype.addTrack=function(){const n=t.apply(this,arguments);return n._pc=this,n}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function TV(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const e=s.RTCPeerConnection.prototype.getReceivers;e&&(s.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(n=>n._pc=this),i}),bv(s,"track",t=>(t.receiver._pc=t.srcElement,t)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function MV(s){!s.RTCPeerConnection||"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(t){lE("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&t.getTracks().includes(i.track)&&this.removeTrack(i)})})}function IV(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function RV(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.addTransceiver;e&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const i=arguments[1],n=i&&"sendEncodings"in i;n&&i.sendEncodings.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(n){const{sender:o}=r,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i.sendEncodings,o.sendEncodings=i.sendEncodings,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function PV(s){if(!(typeof s=="object"&&s.RTCRtpSender))return;const e=s.RTCRtpSender.prototype.getParameters;e&&(s.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function BV(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function DV(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const fF=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:RV,shimCreateAnswer:DV,shimCreateOffer:BV,shimGetDisplayMedia:tse,shimGetParameters:PV,shimGetUserMedia:SV,shimOnTrack:CV,shimPeerConnection:uR,shimRTCDataChannel:IV,shimReceiverGetStats:TV,shimRemoveStream:MV,shimSenderGetStats:EV},Symbol.toStringTag,{value:"Module"}));function OV(s){if(!(typeof s!="object"||!s.RTCPeerConnection)){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const e=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(n=>e.call(this,n,i)),i.getVideoTracks().forEach(n=>e.call(this,n,i))},s.RTCPeerConnection.prototype.addTrack=function(i,...n){return n&&n.forEach(r=>{this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]}),e.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);const n=t.getTracks();this.getSenders().forEach(r=>{n.includes(r.track)&&this.removeTrack(r)})})}}function LV(s){if(!(typeof s!="object"||!s.RTCPeerConnection)&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const r=new Event("addstream");r.stream=n,this.dispatchEvent(r)})})}});const e=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function kV(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const e=s.RTCPeerConnection.prototype,t=e.createOffer,i=e.createAnswer,n=e.setLocalDescription,r=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(c,h){const d=arguments.length>=2?arguments[2]:arguments[0],f=t.apply(this,[d]);return h?(f.then(c,h),Promise.resolve()):f},e.createAnswer=function(c,h){const d=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[d]);return h?(f.then(c,h),Promise.resolve()):f};let a=function(l,c,h){const d=n.apply(this,[l]);return h?(d.then(c,h),Promise.resolve()):d};e.setLocalDescription=a,a=function(l,c,h){const d=r.apply(this,[l]);return h?(d.then(c,h),Promise.resolve()):d},e.setRemoteDescription=a,a=function(l,c,h){const d=o.apply(this,[l]);return h?(d.then(c,h),Promise.resolve()):d},e.addIceCandidate=a}function FV(s){const e=s&&s.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,i=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=n=>i(UV(n))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(i,n,r){e.mediaDevices.getUserMedia(i).then(n,r)}.bind(e))}function UV(s){return s&&s.video!==void 0?Object.assign({},s,{video:cV(s.video)}):s}function NV(s){if(!s.RTCPeerConnection)return;const e=s.RTCPeerConnection;s.RTCPeerConnection=function(i,n){if(i&&i.iceServers){const r=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(lE("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(i.iceServers[o])}i.iceServers=r}return new e(i,n)},s.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function zV(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function GV(s){const e=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const n=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):i.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio"),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video")}return e.apply(this,arguments)}}function HV(s){typeof s!="object"||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}const pF=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:HV,shimCallbacksAPI:kV,shimConstraints:UV,shimCreateOfferLegacy:GV,shimGetUserMedia:FV,shimLocalStreamsAPI:OV,shimRTCIceServerUrls:NV,shimRemoteStreamsAPI:LV,shimTrackEventTransceiver:zV},Symbol.toStringTag,{value:"Module"}));function mw(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const e=s.RTCIceCandidate;s.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const n=new e(i),r=pw.parseCandidate(i.candidate),o=Object.assign(n,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(i)},s.RTCIceCandidate.prototype=e.prototype,bv(s,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new s.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Gy(s,e){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const l=pw.splitSections(a.sdp);return l.shift(),l.some(c=>{const h=pw.parseMLine(c);return h&&h.kind==="application"&&h.protocol.indexOf("SCTP")!==-1})},i=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},n=function(a){let l=65536;return e.browser==="firefox"&&(e.version<57?a===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},r=function(a,l){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const h=pw.matchPrefix(a.sdp,"a=max-message-size:");return h.length>0?c=parseInt(h[0].substr(19),10):e.browser==="firefox"&&l!==-1&&(c=2147483637),c},o=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const l=i(arguments[0]),c=n(l),h=r(arguments[0],l);let d;c===0&&h===0?d=Number.POSITIVE_INFINITY:c===0||h===0?d=Math.max(c,h):d=Math.min(c,h);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return d}}),this._sctp=f}return o.apply(this,arguments)}}function Hy(s){if(!(s.RTCPeerConnection&&"createDataChannel"in s.RTCPeerConnection.prototype))return;function e(i,n){const r=i.send;i.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(i.readyState==="open"&&n.sctp&&l>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}const t=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const n=t.apply(this,arguments);return e(n,this),n},bv(s,"datachannel",i=>(e(i.channel,i.target),i))}function dR(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const e=s.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const i=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const r=n.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const o=new Event("connectionstatechange",n);r.dispatchEvent(o)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function fR(s,e){if(!s.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=n.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);s.RTCSessionDescription&&n instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:n.type,sdp:r}):n.sdp=r}return t.apply(this,arguments)}}function gw(s,e){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const t=s.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const ise=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:fR,shimAddIceCandidateNullOrEmpty:gw,shimConnectionState:dR,shimMaxMessageSize:Gy,shimRTCIceCandidate:mw,shimSendThrowTypeError:Hy},Symbol.toStringTag,{value:"Module"}));function nse({window:s}={},e={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const t=gD,i=Xne(s),n={browserDetails:i,commonShim:ise,extractVersion:zy,disableLog:Wne,disableWarnings:qne};switch(i.browser){case"chrome":if(!cF||!cR||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),n;if(i.version===null)return t("Chrome shim can not determine version, not shimming."),n;t("adapter.js shimming chrome."),n.browserShim=cF,gw(s,i),hV(s,i),uV(s),cR(s,i),dV(s),vV(s,i),fV(s),pV(s),mV(s),yV(s,i),mw(s),dR(s),Gy(s,i),Hy(s),fR(s,i);break;case"firefox":if(!fF||!uR||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),n;t("adapter.js shimming firefox."),n.browserShim=fF,gw(s,i),SV(s,i),uR(s,i),CV(s),MV(s),EV(s),TV(s),IV(s),RV(s),PV(s),BV(s),DV(s),mw(s),dR(s),Gy(s,i),Hy(s);break;case"edge":if(!dF||!hR||!e.shimEdge)return t("MS edge shim is not included in this adapter release."),n;t("adapter.js shimming edge."),n.browserShim=dF,bV(s),xV(s),hR(s,i),wV(s),Gy(s,i),Hy(s);break;case"safari":if(!pF||!e.shimSafari)return t("Safari shim is not included in this adapter release."),n;t("adapter.js shimming safari."),n.browserShim=pF,gw(s,i),NV(s),GV(s),kV(s),OV(s),LV(s),zV(s),FV(s),HV(s),mw(s),Gy(s,i),Hy(s),fR(s,i);break;default:t("Unsupported browser!");break}return n}const mF=nse({window:typeof window>"u"?void 0:window});function th(s,e,t,i){Object.defineProperty(s,e,{get:t,set:i,enumerable:!0,configurable:!0})}var MT=mF.default||mF,hy=new(function(){function s(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return s.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},s.prototype.isBrowserSupported=function(){var e=this.getBrowser(),t=this.getVersion(),i=this.supportedBrowsers.includes(e);return i?e==="chrome"?t>=this.minChromeVersion:e==="firefox"?t>=this.minFirefoxVersion:e==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1},s.prototype.getBrowser=function(){return MT.browserDetails.browser},s.prototype.getVersion=function(){return MT.browserDetails.version||0},s.prototype.isUnifiedPlanSupported=function(){var e=this.getBrowser(),t=MT.browserDetails.version||0;if(e==="chrome"&&t<this.minChromeVersion)return!1;if(e==="firefox"&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var i,n=!1;try{i=new RTCPeerConnection,i.addTransceiver("audio"),n=!0}catch{}finally{i&&i.close()}return n},s.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},s}()),gF={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},sse=function(){function s(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=gF,this.browser=hy.getBrowser(),this.browserVersion=hy.getVersion(),this.supports=function(){var e={browser:hy.isBrowserSupported(),webRTC:hy.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;var t;try{t=new RTCPeerConnection(gF),e.audioVideo=!0;var i=void 0;try{i=t.createDataChannel("_PEERJSTEST",{ordered:!0}),e.data=!0,e.reliable=!!i.ordered;try{i.binaryType="blob",e.binaryBlob=!hy.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{t&&t.close()}return e}(),this.pack=rF.pack,this.unpack=rF.unpack,this._dataCount=1}return s.prototype.noop=function(){},s.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},s.prototype.chunk=function(e){for(var t=[],i=e.size,n=Math.ceil(i/Li.chunkedMTU),r=0,o=0;o<i;){var a=Math.min(i,o+Li.chunkedMTU),l=e.slice(o,a),c={__peerData:this._dataCount,n:r,data:l,total:n};t.push(c),o=a,r++}return this._dataCount++,t},s.prototype.blobToArrayBuffer=function(e,t){var i=new FileReader;return i.onload=function(n){n.target&&t(n.target.result)},i.readAsArrayBuffer(e),i},s.prototype.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i)&255;return t.buffer},s.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},s.prototype.isSecure=function(){return location.protocol==="https:"},s}(),Li=new sse,VV={};th(VV,"Peer",()=>gR,s=>gR=s);var d_={},rse=Object.prototype.hasOwnProperty,Eo="~";function g0(){}Object.create&&(g0.prototype=Object.create(null),new g0().__proto__||(Eo=!1));function ose(s,e,t){this.fn=s,this.context=e,this.once=t||!1}function QV(s,e,t,i,n){if(typeof t!="function")throw new TypeError("The listener must be a function");var r=new ose(t,i||s,n),o=Eo?Eo+e:e;return s._events[o]?s._events[o].fn?s._events[o]=[s._events[o],r]:s._events[o].push(r):(s._events[o]=r,s._eventsCount++),s}function vw(s,e){--s._eventsCount===0?s._events=new g0:delete s._events[e]}function Yr(){this._events=new g0,this._eventsCount=0}Yr.prototype.eventNames=function(){var e=[],t,i;if(this._eventsCount===0)return e;for(i in t=this._events)rse.call(t,i)&&e.push(Eo?i.slice(1):i);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Yr.prototype.listeners=function(e){var t=Eo?Eo+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,o=new Array(r);n<r;n++)o[n]=i[n].fn;return o};Yr.prototype.listenerCount=function(e){var t=Eo?Eo+e:e,i=this._events[t];return i?i.fn?1:i.length:0};Yr.prototype.emit=function(e,t,i,n,r,o){var a=Eo?Eo+e:e;if(!this._events[a])return!1;var l=this._events[a],c=arguments.length,h,d;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,n),!0;case 5:return l.fn.call(l.context,t,i,n,r),!0;case 6:return l.fn.call(l.context,t,i,n,r,o),!0}for(d=1,h=new Array(c-1);d<c;d++)h[d-1]=arguments[d];l.fn.apply(l.context,h)}else{var f=l.length,p;for(d=0;d<f;d++)switch(l[d].once&&this.removeListener(e,l[d].fn,void 0,!0),c){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,t);break;case 3:l[d].fn.call(l[d].context,t,i);break;case 4:l[d].fn.call(l[d].context,t,i,n);break;default:if(!h)for(p=1,h=new Array(c-1);p<c;p++)h[p-1]=arguments[p];l[d].fn.apply(l[d].context,h)}}return!0};Yr.prototype.on=function(e,t,i){return QV(this,e,t,i,!1)};Yr.prototype.once=function(e,t,i){return QV(this,e,t,i,!0)};Yr.prototype.removeListener=function(e,t,i,n){var r=Eo?Eo+e:e;if(!this._events[r])return this;if(!t)return vw(this,r),this;var o=this._events[r];if(o.fn)o.fn===t&&(!n||o.once)&&(!i||o.context===i)&&vw(this,r);else{for(var a=0,l=[],c=o.length;a<c;a++)(o[a].fn!==t||n&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[r]=l.length===1?l[0]:l:vw(this,r)}return this};Yr.prototype.removeAllListeners=function(e){var t;return e?(t=Eo?Eo+e:e,this._events[t]&&vw(this,t)):(this._events=new g0,this._eventsCount=0),this};Yr.prototype.off=Yr.prototype.removeListener;Yr.prototype.addListener=Yr.prototype.on;Yr.prefixed=Eo;Yr.EventEmitter=Yr;d_=Yr;var bt={};th(bt,"LogLevel",()=>Lo,s=>Lo=s);th(bt,"default",()=>vF,s=>vF=s);var bf=function(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var i=t.call(s),n,r=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)r.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},xf=function(s,e,t){if(t||arguments.length===2)for(var i=0,n=e.length,r;i<n;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return s.concat(r||Array.prototype.slice.call(e))},ase="PeerJS: ",Lo;(function(s){s[s.Disabled=0]="Disabled",s[s.Errors=1]="Errors",s[s.Warnings=2]="Warnings",s[s.All=3]="All"})(Lo||(Lo={}));var lse=function(){function s(){this._logLevel=Lo.Disabled}return Object.defineProperty(s.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),s.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=Lo.All&&this._print.apply(this,xf([Lo.All],bf(e),!1))},s.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=Lo.Warnings&&this._print.apply(this,xf([Lo.Warnings],bf(e),!1))},s.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=Lo.Errors&&this._print.apply(this,xf([Lo.Errors],bf(e),!1))},s.prototype.setLogFunction=function(e){this._print=e},s.prototype._print=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=xf([ase],bf(t),!1);for(var r in n)n[r]instanceof Error&&(n[r]="("+n[r].name+") "+n[r].message);e>=Lo.All?console.log.apply(console,xf([],bf(n),!1)):e>=Lo.Warnings?console.warn.apply(console,xf(["WARNING"],bf(n),!1)):e>=Lo.Errors&&console.error.apply(console,xf(["ERROR"],bf(n),!1))},s}(),vF=new lse,jV={};th(jV,"Socket",()=>yF,s=>yF=s);var wl;(function(s){s.Data="data",s.Media="media"})(wl||(wl={}));var is;(function(s){s.BrowserIncompatible="browser-incompatible",s.Disconnected="disconnected",s.InvalidID="invalid-id",s.InvalidKey="invalid-key",s.Network="network",s.PeerUnavailable="peer-unavailable",s.SslUnavailable="ssl-unavailable",s.ServerError="server-error",s.SocketError="socket-error",s.SocketClosed="socket-closed",s.UnavailableID="unavailable-id",s.WebRTC="webrtc"})(is||(is={}));var Mh;(function(s){s.Binary="binary",s.BinaryUTF8="binary-utf8",s.JSON="json"})(Mh||(Mh={}));var Jh;(function(s){s.Message="message",s.Disconnected="disconnected",s.Error="error",s.Close="close"})(Jh||(Jh={}));var yr;(function(s){s.Heartbeat="HEARTBEAT",s.Candidate="CANDIDATE",s.Offer="OFFER",s.Answer="ANSWER",s.Open="OPEN",s.Error="ERROR",s.IdTaken="ID-TAKEN",s.InvalidKey="INVALID-KEY",s.Leave="LEAVE",s.Expire="EXPIRE"})(yr||(yr={}));var vD={};vD=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stückler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Sören Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var cse=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),hse=function(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var i=t.call(s),n,r=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)r.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},use=function(s,e,t){if(t||arguments.length===2)for(var i=0,n=e.length,r;i<n;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return s.concat(r||Array.prototype.slice.call(e))},dse=function(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],i=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},yF=function(s){cse(e,s);function e(t,i,n,r,o,a){a===void 0&&(a=5e3);var l=s.call(this)||this;l.pingInterval=a,l._disconnected=!0,l._messagesQueue=[];var c=t?"wss://":"ws://";return l._baseUrl=c+i+":"+n+r+"peerjs?key="+o,l}return e.prototype.start=function(t,i){var n=this;this._id=t;var r="".concat(this._baseUrl,"&id=").concat(t,"&token=").concat(i);this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+vD.version),this._disconnected=!1,this._socket.onmessage=function(o){var a;try{a=JSON.parse(o.data),bt.default.log("Server message received:",a)}catch{bt.default.log("Invalid server message",o.data);return}n.emit(Jh.Message,a)},this._socket.onclose=function(o){n._disconnected||(bt.default.log("Socket closed.",o),n._cleanup(),n._disconnected=!0,n.emit(Jh.Disconnected))},this._socket.onopen=function(){n._disconnected||(n._sendQueuedMessages(),bt.default.log("Socket open"),n._scheduleHeartbeat())})},e.prototype._scheduleHeartbeat=function(){var t=this;this._wsPingTimer=setTimeout(function(){t._sendHeartbeat()},this.pingInterval)},e.prototype._sendHeartbeat=function(){if(!this._wsOpen()){bt.default.log("Cannot send heartbeat, because socket closed");return}var t=JSON.stringify({type:yr.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()},e.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},e.prototype._sendQueuedMessages=function(){var t,i,n=use([],hse(this._messagesQueue),!1);this._messagesQueue=[];try{for(var r=dse(n),o=r.next();!o.done;o=r.next()){var a=o.value;this.send(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}},e.prototype.send=function(t){if(!this._disconnected){if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(Jh.Error,"Invalid message");return}if(this._wsOpen()){var i=JSON.stringify(t);this._socket.send(i)}}},e.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},e.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},e}(d_.EventEmitter),pR={};th(pR,"MediaConnection",()=>bF,s=>bF=s);var yD={};th(yD,"Negotiator",()=>AF,s=>AF=s);var lS=function(){return lS=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},lS.apply(this,arguments)},cx=function(s,e,t,i){function n(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(i.next(h))}catch(d){o(d)}}function l(h){try{c(i.throw(h))}catch(d){o(d)}}function c(h){h.done?r(h.value):n(h.value).then(a,l)}c((i=i.apply(s,e||[])).next())})},hx=function(s,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,n,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(h){return l([c,h])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(r=c[0]&2?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[c[0]&2,r.value]),c[0]){case 0:case 1:r=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,n=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){t.label=c[1];break}if(c[0]===6&&t.label<r[1]){t.label=r[1],r=c;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(c);break}r[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(s,t)}catch(h){c=[6,h],n=0}finally{i=r=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},AF=function(){function s(e){this.connection=e}return s.prototype.startConnection=function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===wl.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===wl.Data){var i=this.connection,n={ordered:!!e.reliable},r=t.createDataChannel(i.label,n);i.initialize(r)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},s.prototype._startPeerConnection=function(){bt.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},s.prototype._setupListeners=function(e){var t=this,i=this.connection.peer,n=this.connection.connectionId,r=this.connection.type,o=this.connection.provider;bt.default.log("Listening for ICE candidates."),e.onicecandidate=function(a){!a.candidate||!a.candidate.candidate||(bt.default.log("Received ICE candidates for ".concat(i,":"),a.candidate),o.socket.send({type:yr.Candidate,payload:{candidate:a.candidate,type:r,connectionId:n},dst:i}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":bt.default.log("iceConnectionState is failed, closing connections to "+i),t.connection.emit("error",new Error("Negotiation of connection to "+i+" failed.")),t.connection.close();break;case"closed":bt.default.log("iceConnectionState is closed, closing connections to "+i),t.connection.emit("error",new Error("Connection to "+i+" closed.")),t.connection.close();break;case"disconnected":bt.default.log("iceConnectionState changed to disconnected on the connection with "+i);break;case"completed":e.onicecandidate=Li.noop;break}t.connection.emit("iceStateChanged",e.iceConnectionState)},bt.default.log("Listening for data channel"),e.ondatachannel=function(a){bt.default.log("Received data channel");var l=a.channel,c=o.getConnection(i,n);c.initialize(l)},bt.default.log("Listening for remote stream"),e.ontrack=function(a){bt.default.log("Received remote stream");var l=a.streams[0],c=o.getConnection(i,n);if(c.type===wl.Media){var h=c;t._addStreamToMediaConnection(l,h)}}},s.prototype.cleanup=function(){bt.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t=e.signalingState!=="closed",i=!1;if(this.connection.type===wl.Data){var n=this.connection,r=n.dataChannel;r&&(i=!!r.readyState&&r.readyState!=="closed")}(t||i)&&e.close()}},s.prototype._makeOffer=function(){return cx(this,void 0,Promise,function(){var e,t,i,n,r,o,a;return hx(this,function(l){switch(l.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,l.label=1;case 1:return l.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:i=l.sent(),bt.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),l.label=3;case 3:return l.trys.push([3,5,,6]),[4,e.setLocalDescription(i)];case 4:return l.sent(),bt.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),n={sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:Li.browser},this.connection.type===wl.Data&&(r=this.connection,n=lS(lS({},n),{label:r.label,reliable:r.reliable,serialization:r.serialization})),t.socket.send({type:yr.Offer,payload:n,dst:this.connection.peer}),[3,6];case 5:return o=l.sent(),o!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(is.WebRTC,o),bt.default.log("Failed to setLocalDescription, ",o)),[3,6];case 6:return[3,8];case 7:return a=l.sent(),t.emitError(is.WebRTC,a),bt.default.log("Failed to createOffer, ",a),[3,8];case 8:return[2]}})})},s.prototype._makeAnswer=function(){return cx(this,void 0,Promise,function(){var e,t,i,n,r;return hx(this,function(o){switch(o.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:i=o.sent(),bt.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,e.setLocalDescription(i)];case 4:return o.sent(),bt.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),t.socket.send({type:yr.Answer,payload:{sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,browser:Li.browser},dst:this.connection.peer}),[3,6];case 5:return n=o.sent(),t.emitError(is.WebRTC,n),bt.default.log("Failed to setLocalDescription, ",n),[3,6];case 6:return[3,8];case 7:return r=o.sent(),t.emitError(is.WebRTC,r),bt.default.log("Failed to create answer, ",r),[3,8];case 8:return[2]}})})},s.prototype.handleSDP=function(e,t){return cx(this,void 0,Promise,function(){var i,n,r,o;return hx(this,function(a){switch(a.label){case 0:t=new RTCSessionDescription(t),i=this.connection.peerConnection,n=this.connection.provider,bt.default.log("Setting remote description",t),r=this,a.label=1;case 1:return a.trys.push([1,5,,6]),[4,i.setRemoteDescription(t)];case 2:return a.sent(),bt.default.log("Set remoteDescription:".concat(e," for:").concat(this.connection.peer)),e!=="OFFER"?[3,4]:[4,r._makeAnswer()];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:return o=a.sent(),n.emitError(is.WebRTC,o),bt.default.log("Failed to setRemoteDescription, ",o),[3,6];case 6:return[2]}})})},s.prototype.handleCandidate=function(e){return cx(this,void 0,Promise,function(){var t,i,n,r,o,a;return hx(this,function(l){switch(l.label){case 0:bt.default.log("handleCandidate:",e),t=e.candidate,i=e.sdpMLineIndex,n=e.sdpMid,r=this.connection.peerConnection,o=this.connection.provider,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,r.addIceCandidate(new RTCIceCandidate({sdpMid:n,sdpMLineIndex:i,candidate:t}))];case 2:return l.sent(),bt.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return a=l.sent(),o.emitError(is.WebRTC,a),bt.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}})})},s.prototype._addTracksToConnection=function(e,t){if(bt.default.log("add tracks from stream ".concat(e.id," to peer connection")),!t.addTrack)return bt.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(function(i){t.addTrack(i,e)})},s.prototype._addStreamToMediaConnection=function(e,t){bt.default.log("add stream ".concat(e.id," to media connection ").concat(t.connectionId)),t.addStream(e)},s}(),AD={};th(AD,"BaseConnection",()=>_F,s=>_F=s);var fse=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),_F=function(s){fse(e,s);function e(t,i,n){var r=s.call(this)||this;return r.peer=t,r.provider=i,r.options=n,r._open=!1,r.metadata=n.metadata,r}return Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),e}(d_.EventEmitter),pse=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),cS=function(){return cS=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},cS.apply(this,arguments)},mse=function(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],i=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},bF=function(s){pse(e,s);function e(t,i,n){var r=s.call(this,t,i,n)||this;return r._localStream=r.options._stream,r.connectionId=r.options.connectionId||e.ID_PREFIX+Li.randomToken(),r._negotiator=new yD.Negotiator(r),r._localStream&&r._negotiator.startConnection({_stream:r._localStream,originator:!0}),r}return Object.defineProperty(e.prototype,"type",{get:function(){return wl.Media},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),e.prototype.addStream=function(t){bt.default.log("Receiving stream",t),this._remoteStream=t,s.prototype.emit.call(this,"stream",t)},e.prototype.handleMessage=function(t){var i=t.type,n=t.payload;switch(t.type){case yr.Answer:this._negotiator.handleSDP(i,n.sdp),this._open=!0;break;case yr.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:bt.default.warn("Unrecognized message type:".concat(i," from peer:").concat(this.peer));break}},e.prototype.answer=function(t,i){var n,r;if(i===void 0&&(i={}),this._localStream){bt.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,i&&i.sdpTransform&&(this.options.sdpTransform=i.sdpTransform),this._negotiator.startConnection(cS(cS({},this.options._payload),{_stream:t}));var o=this.provider._getMessages(this.connectionId);try{for(var a=mse(o),l=a.next();!l.done;l=a.next()){var c=l.value;this.handleMessage(c)}}catch(h){n={error:h}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}this._open=!0},e.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,s.prototype.emit.call(this,"close"))},e.ID_PREFIX="mc_",e}(AD.BaseConnection),mR={};th(mR,"DataConnection",()=>wF,s=>wF=s);var WV={};th(WV,"EncodingQueue",()=>xF,s=>xF=s);var gse=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),xF=function(s){gse(e,s);function e(){var t=s.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(i){t._processing=!1,i.target&&t.emit("done",i.target.result),t.doNextTask()},t.fileReader.onerror=function(i){bt.default.error("EncodingQueue error:",i),t._processing=!1,t.destroy(),t.emit("error",i)},t}return Object.defineProperty(e.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),e.prototype.enque=function(t){this.queue.push(t),!this.processing&&this.doNextTask()},e.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},e.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},e}(d_.EventEmitter),vse=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),yse=function(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],i=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},wF=function(s){vse(e,s);function e(t,i,n){var r=s.call(this,t,i,n)||this;return r.stringify=JSON.stringify,r.parse=JSON.parse,r._buffer=[],r._bufferSize=0,r._buffering=!1,r._chunkedData={},r._encodingQueue=new WV.EncodingQueue,r.connectionId=r.options.connectionId||e.ID_PREFIX+Li.randomToken(),r.label=r.options.label||r.connectionId,r.serialization=r.options.serialization||Mh.Binary,r.reliable=!!r.options.reliable,r._encodingQueue.on("done",function(o){r._bufferedSend(o)}),r._encodingQueue.on("error",function(){bt.default.error("DC#".concat(r.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),r.close()}),r._negotiator=new yD.Negotiator(r),r._negotiator.startConnection(r.options._payload||{originator:!0}),r}return Object.defineProperty(e.prototype,"type",{get:function(){return wl.Data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),e.prototype.initialize=function(t){this._dc=t,this._configureDataChannel()},e.prototype._configureDataChannel=function(){var t=this;(!Li.supports.binaryBlob||Li.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){bt.default.log("DC#".concat(t.connectionId," dc connection success")),t._open=!0,t.emit("open")},this.dataChannel.onmessage=function(i){bt.default.log("DC#".concat(t.connectionId," dc onmessage:"),i.data),t._handleDataMessage(i)},this.dataChannel.onclose=function(){bt.default.log("DC#".concat(t.connectionId," dc closed for:"),t.peer),t.close()}},e.prototype._handleDataMessage=function(t){var i=this,n=t.data,r=n.constructor,o=this.serialization===Mh.Binary||this.serialization===Mh.BinaryUTF8,a=n;if(o){if(r===Blob){Li.blobToArrayBuffer(n,function(c){var h=Li.unpack(c);i.emit("data",h)});return}else if(r===ArrayBuffer)a=Li.unpack(n);else if(r===String){var l=Li.binaryStringToArrayBuffer(n);a=Li.unpack(l)}}else this.serialization===Mh.JSON&&(a=this.parse(n));if(a.__peerData){this._handleChunk(a);return}s.prototype.emit.call(this,"data",a)},e.prototype._handleChunk=function(t){var i=t.__peerData,n=this._chunkedData[i]||{data:[],count:0,total:t.total};if(n.data[t.n]=t.data,n.count++,this._chunkedData[i]=n,n.total===n.count){delete this._chunkedData[i];var r=new Blob(n.data);this._handleDataMessage({data:r})}},e.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,s.prototype.emit.call(this,"close"))},e.prototype.send=function(t,i){if(!this.open){s.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===Mh.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===Mh.Binary||this.serialization===Mh.BinaryUTF8){var n=Li.pack(t);if(!i&&n.size>Li.chunkedMTU){this._sendChunks(n);return}Li.supports.binaryBlob?this._bufferedSend(n):this._encodingQueue.enque(n)}else this._bufferedSend(t)},e.prototype._bufferedSend=function(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)},e.prototype._trySend=function(t){var i=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>e.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){i._buffering=!1,i._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(n){return bt.default.error("DC#:".concat(this.connectionId," Error when sending:"),n),this._buffering=!0,this.close(),!1}return!0},e.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},e.prototype._sendChunks=function(t){var i,n,r=Li.chunk(t);bt.default.log("DC#".concat(this.connectionId," Try to send ").concat(r.length," chunks..."));try{for(var o=yse(r),a=o.next();!a.done;a=o.next()){var l=a.value;this.send(l,!0)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}},e.prototype.handleMessage=function(t){var i=t.payload;switch(t.type){case yr.Answer:this._negotiator.handleSDP(t.type,i.sdp);break;case yr.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:bt.default.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}},e.ID_PREFIX="dc_",e.MAX_BUFFERED_AMOUNT=8388608,e}(AD.BaseConnection),qV={};th(qV,"API",()=>EF,s=>EF=s);var SF=function(s,e,t,i){function n(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(i.next(h))}catch(d){o(d)}}function l(h){try{c(i.throw(h))}catch(d){o(d)}}function c(h){h.done?r(h.value):n(h.value).then(a,l)}c((i=i.apply(s,e||[])).next())})},CF=function(s,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,n,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(h){return l([c,h])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(r=c[0]&2?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[c[0]&2,r.value]),c[0]){case 0:case 1:r=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,n=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){t.label=c[1];break}if(c[0]===6&&t.label<r[1]){t.label=r[1],r=c;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(c);break}r[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(s,t)}catch(h){c=[6,h],n=0}finally{i=r=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},EF=function(){function s(e){this._options=e}return s.prototype._buildRequest=function(e){var t=this._options.secure?"https":"http",i=this._options,n=i.host,r=i.port,o=i.path,a=i.key,l=new URL("".concat(t,"://").concat(n,":").concat(r).concat(o).concat(a,"/").concat(e));return l.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),l.searchParams.set("version",vD.version),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})},s.prototype.retrieveId=function(){return SF(this,void 0,Promise,function(){var e,t,i;return CF(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(e=n.sent(),e.status!==200)throw new Error("Error. Status:".concat(e.status));return[2,e.text()];case 2:throw t=n.sent(),bt.default.error("Error retrieving ID",t),i="",this._options.path==="/"&&this._options.host!==Li.CLOUD_HOST&&(i=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+i);case 3:return[2]}})})},s.prototype.listAllPeers=function(){return SF(this,void 0,Promise,function(){var e,t,i;return CF(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(e=n.sent(),e.status!==200)throw e.status===401?(t="",this._options.host===Li.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)):new Error("Error. Status:".concat(e.status));return[2,e.json()];case 2:throw i=n.sent(),bt.default.error("Error retrieving list peers",i),new Error("Could not get list peers from the server."+i);case 3:return[2]}})})},s}(),Ase=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),pA=function(){return pA=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},pA.apply(this,arguments)},uy=function(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],i=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},_se=function(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var i=t.call(s),n,r=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)r.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},gR=function(s){Ase(e,s);function e(t,i){var n=s.call(this)||this;n._id=null,n._lastServerId=null,n._destroyed=!1,n._disconnected=!1,n._open=!1,n._connections=new Map,n._lostMessages=new Map;var r;return t&&t.constructor==Object?i=t:t&&(r=t.toString()),i=pA({debug:0,host:Li.CLOUD_HOST,port:Li.CLOUD_PORT,path:"/",key:e.DEFAULT_KEY,token:Li.randomToken(),config:Li.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},i),n._options=i,n._options.host==="/"&&(n._options.host=window.location.hostname),n._options.path&&(n._options.path[0]!=="/"&&(n._options.path="/"+n._options.path),n._options.path[n._options.path.length-1]!=="/"&&(n._options.path+="/")),n._options.secure===void 0&&n._options.host!==Li.CLOUD_HOST?n._options.secure=Li.isSecure():n._options.host==Li.CLOUD_HOST&&(n._options.secure=!0),n._options.logFunction&&bt.default.setLogFunction(n._options.logFunction),bt.default.logLevel=n._options.debug||0,n._api=new qV.API(i),n._socket=n._createServerConnection(),!Li.supports.audioVideo&&!Li.supports.data?(n._delayedAbort(is.BrowserIncompatible,"The current browser does not support WebRTC"),n):r&&!Li.validateId(r)?(n._delayedAbort(is.InvalidID,'ID "'.concat(r,'" is invalid')),n):(r?n._initialize(r):n._api.retrieveId().then(function(o){return n._initialize(o)}).catch(function(o){return n._abort(is.ServerError,o)}),n)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connections",{get:function(){var t,i,n=Object.create(null);try{for(var r=uy(this._connections),o=r.next();!o.done;o=r.next()){var a=_se(o.value,2),l=a[0],c=a[1];n[l]=c}}catch(h){t={error:h}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),e.prototype._createServerConnection=function(){var t=this,i=new jV.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return i.on(Jh.Message,function(n){t._handleMessage(n)}),i.on(Jh.Error,function(n){t._abort(is.SocketError,n)}),i.on(Jh.Disconnected,function(){t.disconnected||(t.emitError(is.Network,"Lost connection to server."),t.disconnect())}),i.on(Jh.Close,function(){t.disconnected||t._abort(is.SocketClosed,"Underlying socket is already closed.")}),i},e.prototype._initialize=function(t){this._id=t,this.socket.start(t,this._options.token)},e.prototype._handleMessage=function(t){var i,n,r=t.type,o=t.payload,a=t.src;switch(r){case yr.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case yr.Error:this._abort(is.ServerError,o.msg);break;case yr.IdTaken:this._abort(is.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case yr.InvalidKey:this._abort(is.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case yr.Leave:bt.default.log("Received leave message from ".concat(a)),this._cleanupPeer(a),this._connections.delete(a);break;case yr.Expire:this.emitError(is.PeerUnavailable,"Could not connect to peer ".concat(a));break;case yr.Offer:var m=o.connectionId,v=this.getConnection(a,m);if(v&&(v.close(),bt.default.warn("Offer received for existing Connection ID:".concat(m))),o.type===wl.Media){var l=new pR.MediaConnection(a,this,{connectionId:m,_payload:o,metadata:o.metadata});v=l,this._addConnection(a,v),this.emit("call",l)}else if(o.type===wl.Data){var c=new mR.DataConnection(a,this,{connectionId:m,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable});v=c,this._addConnection(a,v),this.emit("connection",c)}else{bt.default.warn("Received malformed connection type:".concat(o.type));return}var h=this._getMessages(m);try{for(var d=uy(h),f=d.next();!f.done;f=d.next()){var p=f.value;v.handleMessage(p)}}catch(y){i={error:y}}finally{try{f&&!f.done&&(n=d.return)&&n.call(d)}finally{if(i)throw i.error}}break;default:if(!o){bt.default.warn("You received a malformed message from ".concat(a," of type ").concat(r));return}var m=o.connectionId,v=this.getConnection(a,m);v&&v.peerConnection?v.handleMessage(t):m?this._storeMessage(m,t):bt.default.warn("You received an unrecognized message:",t);break}},e.prototype._storeMessage=function(t,i){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(i)},e.prototype._getMessages=function(t){var i=this._lostMessages.get(t);return i?(this._lostMessages.delete(t),i):[]},e.prototype.connect=function(t,i){if(i===void 0&&(i={}),this.disconnected){bt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(is.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var n=new mR.DataConnection(t,this,i);return this._addConnection(t,n),n},e.prototype.call=function(t,i,n){if(n===void 0&&(n={}),this.disconnected){bt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(is.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!i){bt.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var r=new pR.MediaConnection(t,this,pA(pA({},n),{_stream:i}));return this._addConnection(t,r),r},e.prototype._addConnection=function(t,i){bt.default.log("add connection ".concat(i.type,":").concat(i.connectionId," to peerId:").concat(t)),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(i)},e.prototype._removeConnection=function(t){var i=this._connections.get(t.peer);if(i){var n=i.indexOf(t);n!==-1&&i.splice(n,1)}this._lostMessages.delete(t.connectionId)},e.prototype.getConnection=function(t,i){var n,r,o=this._connections.get(t);if(!o)return null;try{for(var a=uy(o),l=a.next();!l.done;l=a.next()){var c=l.value;if(c.connectionId===i)return c}}catch(h){n={error:h}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return null},e.prototype._delayedAbort=function(t,i){var n=this;setTimeout(function(){n._abort(t,i)},0)},e.prototype._abort=function(t,i){bt.default.error("Aborting!"),this.emitError(t,i),this._lastServerId?this.disconnect():this.destroy()},e.prototype.emitError=function(t,i){bt.default.error("Error:",i);var n;typeof i=="string"?n=new Error(i):n=i,n.type=t,this.emit("error",n)},e.prototype.destroy=function(){this.destroyed||(bt.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},e.prototype._cleanup=function(){var t,i;try{for(var n=uy(this._connections.keys()),r=n.next();!r.done;r=n.next()){var o=r.value;this._cleanupPeer(o),this._connections.delete(o)}}catch(a){t={error:a}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}this.socket.removeAllListeners()},e.prototype._cleanupPeer=function(t){var i,n,r=this._connections.get(t);if(r)try{for(var o=uy(r),a=o.next();!a.done;a=o.next()){var l=a.value;l.close()}}catch(c){i={error:c}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}},e.prototype.disconnect=function(){if(!this.disconnected){var t=this.id;bt.default.log("Disconnect peer with ID:".concat(t)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit("disconnected",t)}},e.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)bt.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)bt.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},e.prototype.listAllPeers=function(t){var i=this;t===void 0&&(t=function(n){}),this._api.listAllPeers().then(function(n){return t(n)}).catch(function(n){return i._abort(is.ServerError,n)})},e.DEFAULT_KEY="peerjs",e}(d_.EventEmitter),vR=VV.Peer;const bse=Object.freeze(Object.defineProperty({__proto__:null,get Peer(){return gR},default:vR,util:Li},Symbol.toStringTag,{value:"Module"}));let _D;function xse(){return _D}function wse(s){_D=s}function XV(s,e){return e||(e={}),e={..._D,...e},s?new vR(s,e):new vR(e)}async function TF(){const s=await jc(()=>Promise.resolve().then(()=>bse),void 0,import.meta.url);return console.log(s),s.default===void 0?s:s.default}var yR;(function(s){s.ConnectionList="connection-list"})(yR||(yR={}));class YV{constructor(){u(this,"_host");u(this,"_client");u(this,"_clientData");this.onEnable()}get isHost(){return this._host!==void 0}onEnable(){const e="HOST-5980e65c-8438-453e-8b35-f13c736dcd81";this.trySetupHost(e)}async trySetupHost(e){const t=await TF(),i=new t(e);i.on("error",n=>{console.error(n),this._host=void 0,this.trySetupClient(e)}),i.on("open",n=>{this._host=new Cse(i)})}async trySetupClient(e){const t=await TF();this._client=new t,this._client.on("error",i=>{console.error("Client error",i)}),this._client.on("open",i=>{console.log("client connected",i),this._clientData=this._client.connect(e,{metadata:{id:i}}),this._clientData.on("open",()=>{console.log("Connected to host")}),this._clientData.on("data",n=>{console.log("<<",n)})})}}class Sse{constructor(e){u(this,"_peer");this._peer=e}}class Cse extends Sse{constructor(t){var i;super(t);u(this,"_connections",[]);console.log("I AM THE HOST"),(i=this._peer)==null||i.on("connection",this.onConnection.bind(this)),this._peer.on("close",()=>{this.broadcast("BYE")}),setInterval(()=>{this.broadcast("HELLO")},2e3)}get isHost(){return!0}onConnection(t){console.log("host connection",t),t.on("open",()=>{this._connections.push(t),this.broadcastConnection(t)})}broadcastConnection(t){const i=this._connections.map(n=>{var r;return(r=n.metadata)==null?void 0:r.id}).filter(n=>n!==void 0);this.broadcast({type:yR.ConnectionList,connections:i})}broadcast(t){if(t!=null){console.log(">>",t);for(const i in this._peer.connections){const n=this._peer.connections[i];if(n)if(Array.isArray(n))for(const r of n)r&&r.send(t);else console.warn(n)}}}}var Ga;(function(s){s[s.OnConnection=0]="OnConnection",s[s.OnRoomJoin=1]="OnRoomJoin",s[s.Queued=2]="Queued",s[s.Immediate=3]="Immediate"})(Ga||(Ga={}));const MF="https://urls.needle.tools/default-networking-backend/index";let Ah="wss://needle-tiny-starter.glitch.me/socket";const oo=!!ie("debugnet"),Vy=!!(oo||ie("debugowner")),IT=ie("debugnetbin");var hS;(function(s){s.ConnectionInfo="connection-start-info"})(hS||(hS={}));var Ut;(function(s){s.Join="join-room",s.Leave="leave-room",s.JoinedRoom="joined-room",s.LeftRoom="left-room",s.UserJoinedRoom="user-joined-room",s.UserLeftRoom="user-left-room",s.RoomStateSent="room-state-sent"})(Ut||(Ut={}));class Ese{constructor(){u(this,"room");u(this,"viewId");u(this,"allowEditing");u(this,"inRoom")}}class Tse{constructor(){u(this,"room")}}class Mse{constructor(){u(this,"userId")}}var fr;(function(s){s.RequestHasOwner="request-has-owner",s.ResponseHasOwner="response-has-owner",s.RequestIsOwner="request-is-owner",s.ResponseIsOwner="response-is-owner",s.RequestOwnership="request-ownership",s.GainedOwnership="gained-ownership",s.RemoveOwnership="remove-ownership",s.LostOwnership="lost-ownership",s.GainedOwnershipBroadcast="gained-ownership-broadcast",s.LostOwnershipBroadcast="lost-ownership-broadcast"})(fr||(fr={}));class bD{constructor(e,t){u(this,"guid");u(this,"connection");u(this,"_hasOwnership",!1);u(this,"_isOwned");u(this,"_gainSubscription");u(this,"_lostSubscription");u(this,"_hasOwnerResponse");u(this,"_isWaitingForOwnershipResponseCallback",null);this.connection=e,this.guid=t,this._gainSubscription=this.onGainedOwnership.bind(this),this._lostSubscription=this.onLostOwnership.bind(this),e.beginListen(fr.LostOwnership,this._lostSubscription),e.beginListen(fr.GainedOwnershipBroadcast,this._gainSubscription),this._hasOwnerResponse=this.onHasOwnerResponse.bind(this),e.beginListen(fr.ResponseHasOwner,this._hasOwnerResponse)}get hasOwnership(){return this._hasOwnership}get isOwned(){return this._isOwned}get isConnected(){return this.connection.isConnected}updateIsOwned(){this.connection.send(fr.RequestHasOwner,{guid:this.guid})}onHasOwnerResponse(e){e.guid===this.guid&&(this._isOwned=e.value)}requestOwnershipIfNotOwned(){return this._isWaitingForOwnershipResponseCallback!==null?this:(this._isWaitingForOwnershipResponseCallback=this.waitForHasOwnershipRequestResponse.bind(this),this.connection.beginListen(fr.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this.connection.send(fr.RequestHasOwner,{guid:this.guid}),this)}waitForHasOwnershipRequestResponse(e){e.guid===this.guid&&(this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(fr.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this._isOwned=e.value,e.value||(Vy&&console.log("request ownership",this.guid),this.requestOwnership()))}requestOwnershipAsync(){return new Promise((e,t)=>{this.requestOwnership();let i=0;const n=()=>{if(i++>10)return t("Timeout");setTimeout(()=>{this.hasOwnership?e(this):n()},100)};n()})}requestOwnership(){return Vy&&console.log("Request ownership",this.guid),this.connection.send(fr.RequestOwnership,{guid:this.guid}),this}freeOwnership(){return this.connection.send(fr.RemoveOwnership,{guid:this.guid}),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(fr.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this}destroy(){this.connection.stopListen(fr.GainedOwnership,this._gainSubscription),this.connection.stopListen(fr.LostOwnership,this._lostSubscription),this.connection.stopListen(fr.ResponseHasOwner,this._hasOwnerResponse),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(fr.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null)}onGainedOwnership(e){e.guid===this.guid&&(this._isOwned=!0,this.connection.connectionId===e.owner?(Vy&&console.log("GAINED OWNERSHIP",this.guid),this._hasOwnership=!0):this._hasOwnership=!1)}onLostOwnership(e){e===this.guid&&(Vy&&console.log("LOST OWNERSHIP",this.guid),this._hasOwnership=!1,this._isOwned=!1)}}class KV{constructor(e){u(this,"context");u(this,"_peer",null);u(this,"_usersInRoomCopy",[]);u(this,"_defaultMessagesBuffer",[]);u(this,"_defaultMessagesBufferArray",[]);u(this,"netWebSocketUrlProvider");u(this,"_listeners",{});u(this,"_listenersBinary",{});u(this,"connected",!1);u(this,"channelId");u(this,"_connectionId",null);u(this,"_ws");u(this,"_waitingForSocket",{});u(this,"_isInRoom",!1);u(this,"_currentRoomName",null);u(this,"_currentRoomViewId",null);u(this,"_currentRoomAllowEditing",!0);u(this,"_currentInRoom",[]);u(this,"_state",{});u(this,"_currentDelay",-1);u(this,"_connectingToWebsocketPromise",null);this.context=e}get peer(){return this._peer||(this._peer=new YV),this._peer}tryGetState(e){return e==="invalid"?null:this._state[e]}get connectionId(){return this._connectionId}get isDebugEnabled(){return oo}get isConnected(){return this.connected}get currentRoomName(){return this._currentRoomName}get allowEditing(){return this._currentRoomAllowEditing}get currentRoomViewId(){return this._currentRoomViewId}getViewOnlyUrl(){if(this.currentRoomViewId===null)return null;const e=new URL(window.location.href);return e.searchParams.set("view",this.currentRoomViewId),e.href}get isInRoom(){return this._isInRoom}get currentLatency(){return this._currentDelay}get currentServerUrl(){var e;return((e=this._ws)==null?void 0:e.url)??null}sendPing(){this.send("ping",{time:this.context.time.time})}userIsInRoom(e){return this._currentInRoom.indexOf(e)!==-1}usersInRoom(e=null){e||(e=this._usersInRoomCopy),e.length=0;for(const t of this._currentInRoom)e.push(t);return e}joinRoom(e,t=!1){return e?e.length>1024?(console.error('Room name too long, can not join: "'+e+'". Max length is 1024 characters.'),!1):(this.connect(),oo&&console.log("join: "+e),this.send(Ut.Join,{room:e,viewOnly:t},Ga.OnConnection),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}leaveRoom(e=null){return e||(e=this.currentRoomName),e?(this.send(Ut.Leave,{room:e}),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}send(e,t=null,i=Ga.Queued){if(t===null&&(t={}),i===Ga.Queued){this._defaultMessagesBuffer.push({key:e,value:t});return}return this.sendWithWebsocket(e,t,i)}sendDeleteRemoteState(e){this.send("delete-state",{guid:e,dontSave:!0}),delete this._state[e]}sendDeleteRemoteStateAll(){this.send("delete-all-state"),this._state={}}sendBinary(e){var t;IT&&console.log("<< send binary",this.context.time.frame,e.length/1024+" KB"),(t=this._ws)==null||t.send(e)}sendBufferedMessagesNow(){var i;if(!this._ws)return;this._defaultMessagesBufferArray.length=0;const e=Object.keys(this._defaultMessagesBuffer).length;for(const n in this._defaultMessagesBuffer){const r=this._defaultMessagesBuffer[n];if(e<=1){this.sendWithWebsocket(r.key,r.value,Ga.Immediate);break}const o=this.toMessage(r.key,r.value);this._defaultMessagesBufferArray.push(o)}if(this._defaultMessagesBuffer.length=0,this._defaultMessagesBufferArray.length>0&&oo&&console.log("SEND BUFFERED",this._defaultMessagesBufferArray.length),this._defaultMessagesBufferArray.length<=0)return;const t=JSON.stringify(this._defaultMessagesBufferArray);(i=this._ws)==null||i.send(t)}beginListen(e,t){return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t),t}stopListening(e,t){return this.stopListen(e,t)}stopListen(e,t){if(!t||!this._listeners[e])return;const i=this._listeners[e].indexOf(t);i>=0&&this._listeners[e].splice(i,1)}beginListenBinary(e,t){return this._listenersBinary[e]||(this._listenersBinary[e]=[]),this._listenersBinary[e].push(t),t}stopListenBinary(e,t){if(!this._listenersBinary[e])return;const i=this._listenersBinary[e].indexOf(t);i>=0&&this._listenersBinary[e].splice(i,1)}registerProvider(e){this.netWebSocketUrlProvider=e}async connect(){var t;if(this.connected)return Promise.resolve(!0);oo&&console.log("connecting");const e=(t=this.netWebSocketUrlProvider)==null?void 0:t.getWebsocketUrl();return e?Ah=e:j4()&&(Ah="wss://"+window.location.host+"/socket"),this.connectWebsocket()}disconnect(){var e;(e=this._ws)==null||e.close(),this._ws=void 0}connectWebsocket(){return this._connectingToWebsocketPromise?this._connectingToWebsocketPromise:this._connectingToWebsocketPromise=new Promise(async(e,t)=>{var c,h;let i=!1;const n=d=>{i||(i=!0,e(d))};if(Ah===void 0&&(console.log("Fetch default backend url: "+MF),Ah=await(await fetch(MF)).text()),Ah===void 0){n(!1);return}console.debug(`⊡ Connecting to networking backend on
`+Ah);const r=await jc(()=>import("./index-d7be2e3b.js"),[],import.meta.url),o=((c=r.default)==null?void 0:c.WebsocketBuilder)??r.WebsocketBuilder,a=((h=r.default)==null?void 0:h.ExponentialBackoff)??r.ExponentialBackoff,l=new o(Ah).withMaxRetries(3).withBackoff(new a(2e3,2)).onOpen(()=>{this._connectingToWebsocketPromise=null,this._ws=l,this.connected=!0,Xe()||oo?console.log(`⊞ Connected to networking backend
`+Ah):console.debug("⊞ Connected to networking backend",Ah),n(!0),this.onSendQueued(Ga.OnConnection)}).onClose(d=>{this._connectingToWebsocketPromise=null,this.connected=!1,this._isInRoom=!1,n(!1)}).onError(d=>{console.error("⊠ Websocket error"),n(!1)}).onRetry(()=>{console.log("Retry connecting to networking websocket")}).build();l.addEventListener(r.WebsocketEvent.message,(d,f)=>{this.onMessage(d,f)})})}onMessage(e,t){const i=t.data;try{if(typeof i!="string"){i.size&&this.handleIncomingBinaryMessage(i);return}const n=JSON.parse(i);if(Array.isArray(n))for(const r of n)this.handleIncomingStringMessage(r);else this.handleIncomingStringMessage(n);return}catch(n){oo&&i==="pong"?console.log("<<",i):Xe()&&console.error("Failed to parse message",n)}}async handleIncomingBinaryMessage(e){IT&&console.log("<< bin",this.context.time.frame);const t=await e.arrayBuffer();var i=new Uint8Array(t);const n=new m0(i),r=n.getBufferIdentifier(),o=this._listenersBinary[r],a=nV(n),l=sV(a);if(l&&typeof l=="string"&&(this._state[l]=a),!o)return;const c=a??n;for(const h of o)h(c)}handleIncomingStringMessage(e){var n,r;if(oo&&console.log("<<",e.key??e),e.key)switch(e.key){case hS.ConnectionInfo:if(e.data){const l=e.data;l&&(console.assert(l.id!==void 0&&l.id!==null&&l.id.length>0,"server did not send connection id",l.id),console.debug("Your id is: "+l.id,this.context.alias??""),this._connectionId=l.id)}else console.warn("Expected connection id in "+e.key);break;case Ut.JoinedRoom:if(oo&&console.log(e),e){this._isInRoom=!0;const l=e;this._currentRoomName=l.room,this._currentRoomViewId=l.viewId,this._currentRoomAllowEditing=l.allowEditing??!0,this._currentInRoom.length=0,this._currentInRoom.push(...l.inRoom),(IT||Xe())&&console.debug("Joined Needle Engine Room: "+l.room);const c=new URL(window.location.href);c.searchParams.has("room")&&c.searchParams.delete("room"),c.searchParams.set("view",this._currentRoomViewId),console.debug(`Room view id: ${this._currentRoomViewId}
${c.href}`)}this.onSendQueued(Ga.OnRoomJoin);break;case Ut.LeftRoom:e.room===this.currentRoomName&&(this._isInRoom=!1,this._currentRoomName=null,this._currentInRoom.length=0);break;case Ut.UserJoinedRoom:if(e.data){const l=e.data;this._currentInRoom.push(l.userId),oo&&console.log(l.userId+" joined","now in room:",this._currentInRoom)}break;case Ut.UserLeftRoom:if(e.data){const l=e.data,c=this._currentInRoom.indexOf(l.userId);c>=0&&(oo&&console.log(l.userId+" left","now in room:",this._currentInRoom),this._currentInRoom.splice(c,1)),l.userId===this.connectionId&&console.log("you left the room")}break;case"all-room-state-deleted":oo&&console.log("RECEIVED all-room-state-deleted"),this._state={};break;case"ping":case"pong":const a=(n=e.data)==null?void 0:n.time;a&&(this._currentDelay=this.context.time.time-a),oo&&console.log("Current latency: "+this._currentDelay.toFixed(4)+" sec","Clients in room: "+((r=this._currentInRoom)==null?void 0:r.length));break}const t=e.data;t&&(this._state[t.guid]=t);let i=this._listeners[e.key];if(i){i=[...i];for(const o of i)try{o(e.data)}catch(a){console.error('Error invoking callback for "'+e.key+'"',a)}}}toMessage(e,t){return{key:e,data:t}}sendWithWebsocket(e,t,i=Ga.OnRoomJoin){if(!this._ws){const r=this._waitingForSocket[i]||[];r.push(()=>this.sendWithWebsocket(e,t,i)),this._waitingForSocket[i]=r;return}const n=JSON.stringify(this.toMessage(e,t));oo&&console.log(">>",e),this._ws.send(n)}onSendQueued(e){const t=this._waitingForSocket[e];if(t){for(const i of t)i();t.length=0}}}const mA=ie("debugwebxr");class RT{constructor(e,t){u(this,"controllerStates",[]);u(this,"userId");u(this,"context");u(this,"userStateEvtName");u(this,"onReceivedControllerState",e=>{mA&&console.log(`XRSync: Received change for ${this.userId}: ${e.type} ${e.handedness}; tracked=${e.isTracking}`);let t=!1;for(let i=0;i<this.controllerStates.length;i++)if(this.controllerStates[i].index===e.index){this.controllerStates[i]=e,t=!0;break}t||this.controllerStates.push(e)});this.userId=e,this.context=t,this.userStateEvtName="xr-sync-user-state-"+e,this.context.connection.beginListen(this.userStateEvtName,this.onReceivedControllerState)}dispose(){this.context.connection.stopListen(this.userStateEvtName,this.onReceivedControllerState)}update(e){if(this.context.connection.isConnected!=!1){for(let t=this.controllerStates.length-1;t>=0;t--){const i=this.controllerStates[t];let n=!1;for(let r=0;r<e.controllers.length;r++)e.controllers[r].index===i.index&&(n=!0);n||(mA&&console.log(`XRSync: ${i.type} ${i.handedness} removed`,i.index),this.controllerStates.splice(t,1),this.sendControllerRemoved(i))}for(const t of e.controllers)this.updateControllerStates(t)}}onExitXR(e){for(const t of this.controllerStates)this.sendControllerRemoved(t);this.controllerStates.length=0}sendControllerRemoved(e){e.isTracking=!1,e.guid="",this.context.connection.send(this.userStateEvtName,e),this.context.connection.sendDeleteRemoteState(e.guid)}updateControllerStates(e){const t=this.controllerStates.find(i=>i.index===e.index);if(t){let i=!1;i||(i=t.isTracking!=e.isTracking),i&&(t.isTracking=e.isTracking,this.context.connection.send(this.userStateEvtName,t))}else{const i={guid:this.userId+"-"+e.index,isTracking:e.isTracking,handedness:e.side,index:e.index,type:e.hand?"hand":"controller"};this.controllerStates.push(i),this.context.connection.send(this.userStateEvtName,i),mA&&console.log(`XRSync: ${i.type} ${i.handedness} added`,i.index)}}}class JV{constructor(e){u(this,"context");u(this,"onJoinedRoom",()=>{if(this.context.connection.connectionId){this._states.has(this.context.connection.connectionId)||(mA&&console.log("XRSync: Local user joined room",this.context.connection.connectionId),this._states.set(this.context.connection.connectionId,new RT(this.context.connection.connectionId,this.context)));for(const e of this.context.connection.usersInRoom())this._states.has(e)||this._states.set(e,new RT(e,this.context))}});u(this,"onLeftRoom",()=>{if(this.context.connection.connectionId&&!this._states.has(this.context.connection.connectionId)){const e=this._states.get(this.context.connection.connectionId);e==null||e.dispose(),this._states.delete(this.context.connection.connectionId)}});u(this,"onOtherUserJoinedRoom",e=>{const t=e.userId;this._states.has(t)||(mA&&console.log("XRSync: Remote user joined room",t),this._states.set(t,new RT(t,this.context)))});u(this,"onOtherUserLeftRoom",e=>{const t=e.userId;if(!this._states.has(t)){const i=this._states.get(t);i==null||i.dispose(),this._states.delete(t)}});u(this,"_states",new Map);this.context=e,this.context.connection.beginListen(Ut.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Ut.LeftRoom,this.onLeftRoom),this.context.connection.beginListen(Ut.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.beginListen(Ut.UserLeftRoom,this.onOtherUserLeftRoom)}hasState(e){return e?this._states.has(e):!1}isTracking(e,t){if(!e)return;const i=this._states.get(e);if(!i)return;const n=i.controllerStates.find(r=>r.handedness===t);return(n==null?void 0:n.isTracking)||!1}getDeviceType(e,t){if(!e)return;const i=this._states.get(e);if(!i)return;const n=i.controllerStates.find(r=>r.handedness===t);return(n==null?void 0:n.type)||"unknown"}destroy(){this.context.connection.stopListen(Ut.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Ut.LeftRoom,this.onLeftRoom),this.context.connection.stopListen(Ut.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.stopListen(Ut.UserLeftRoom,this.onOtherUserLeftRoom)}onUpdate(e){if(this.context.connection.isConnected&&this.context.connection.connectionId){const t=this._states.get(this.context.connection.connectionId);t==null||t.update(e)}}onExitXR(e){if(this.context.connection.isConnected&&this.context.connection.connectionId){const t=this._states.get(this.context.connection.connectionId);t==null||t.onExitXR(e)}}}class IF{constructor(){u(this,"_fadeToColorQuad");u(this,"_fadeToColorMaterial");u(this,"_requestedFadeValue",0);u(this,"_transitionPromise",null);u(this,"_transitionResolve",null);this._fadeToColorMaterial=new Kt({color:0,transparent:!0,depthTest:!1,fog:!1,side:Pi}),this._fadeToColorQuad=new le(new _s(10,10),this._fadeToColorMaterial)}dispose(){this._fadeToColorQuad.geometry.dispose(),this._fadeToColorMaterial.dispose()}update(e,t){const i=this._fadeToColorQuad,n=this._fadeToColorMaterial;i.parent!==e&&n.opacity>0?e.add(i):n.opacity===0&&i.removeFromParent(),i.layers.set(2),i.material=this._fadeToColorMaterial,i.position.z=-1,i.renderOrder=1/0;const r=this._requestedFadeValue;n.opacity=et.lerp(n.opacity,r,t/.03),Math.abs(n.opacity-r)<=.01&&this._transitionResolve&&(this._transitionResolve(),this._transitionResolve=null,this._transitionPromise=null,this._requestedFadeValue=0)}remove(){this._fadeToColorQuad.removeFromParent()}fadeTransition(){if(this._transitionPromise)return this._transitionPromise;this._requestedFadeValue=1;const e=new Promise(t=>{this._transitionResolve=t});return this._transitionPromise=e,e}}class Ise extends vv{constructor(e,t={}){const i=t.font;if(i===void 0)super();else{const n=i.generateShapes(e,t.size);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(n,t)}this.type="TextGeometry"}}class Rse extends Vn{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new Hn(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){const l=r.parse(JSON.parse(a));t&&t(l)},i,n)}parse(e){return new ZV(e)}}class ZV{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const i=[],n=Pse(e,t,this.data);for(let r=0,o=n.length;r<o;r++)i.push(...n[r].toShapes());return i}}function Pse(s,e,t){const i=Array.from(s),n=e/t.resolution,r=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*n,o=[];let a=0,l=0;for(let c=0;c<i.length;c++){const h=i[c];if(h===`
`)a=0,l-=r;else{const d=Bse(h,n,a,l,t);a+=d.offsetX,o.push(d.path)}}return o}function Bse(s,e,t,i,n){const r=n.glyphs[s]||n.glyphs["?"];if(!r){console.error('THREE.Font: character "'+s+'" does not exists in font family '+n.familyName+".");return}const o=new V4;let a,l,c,h,d,f,p,m;if(r.o){const v=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let y=0,g=v.length;y<g;)switch(v[y++]){case"m":a=v[y++]*e+t,l=v[y++]*e+i,o.moveTo(a,l);break;case"l":a=v[y++]*e+t,l=v[y++]*e+i,o.lineTo(a,l);break;case"q":c=v[y++]*e+t,h=v[y++]*e+i,d=v[y++]*e+t,f=v[y++]*e+i,o.quadraticCurveTo(d,f,c,h);break;case"b":c=v[y++]*e+t,h=v[y++]*e+i,d=v[y++]*e+t,f=v[y++]*e+i,p=v[y++]*e+t,m=v[y++]*e+i,o.bezierCurveTo(d,f,p,m,c,h);break}}return{offsetX:r.ha*e,path:o}}var Wa;(function(s){s[s.Quad=0]="Quad",s[s.Cube=1]="Cube",s[s.Sphere=2]="Sphere",s[s.RoundedCube=10]="RoundedCube"})(Wa||(Wa={}));var z0,AR;class Vd{static createText(e,t){let i=null;const n=(t==null?void 0:t.font)||Ose((t==null?void 0:t.familyFamily)||null);n instanceof ZV?i=lf(this,z0,AR).call(this,e,n,t):i==null&&(i=new pt);const r=(t==null?void 0:t.color)||16777215,o=new le(i,(t==null?void 0:t.material)??new ms({color:r}));return this.applyDefaultObjectOptions(o,t),n instanceof Promise?n.then(a=>{o.geometry=lf(this,z0,AR).call(this,e,a,t),t!=null&&t.onGeometry&&t.onGeometry(o)}):t!=null&&t.onGeometry&&t.onGeometry(o),o}static createOccluder(e){const t=new Kt({colorWrite:!1,depthWrite:!0,side:Pi});return this.createPrimitive(e,{material:t})}static createPrimitive(e,t){let i;const n=(t==null?void 0:t.color)||16777215;switch(e){case"Quad":case Wa.Quad:{const r=new _s(1,1,1,1),o=(t==null?void 0:t.material)??new ms({color:n});t!=null&&t.texture&&"map"in o&&(o.map=t.texture),i=new le(r,o),i.name="Quad"}break;case"Cube":case Wa.Cube:{const r=new Xi(1,1,1),o=(t==null?void 0:t.material)??new ms({color:n});t!=null&&t.texture&&"map"in o&&(o.map=t.texture),i=new le(r,o),i.name="Cube"}break;case Wa.RoundedCube:case"RoundedCube":{const r=Dse(1,1,1,.1,2),o=(t==null?void 0:t.material)??new ms({color:n});t!=null&&t.texture&&"map"in o&&(o.map=t.texture),i=new le(r,o),i.name="RoundedCube"}break;case"Sphere":case Wa.Sphere:{const r=new Wo(.5,16,16),o=(t==null?void 0:t.material)??new ms({color:n});t!=null&&t.texture&&"map"in o&&(o.map=t.texture),i=new le(r,o),i.name="Sphere"}break;case"ShaderBall":i=new vs,i.name="ShaderBall",Lse(i,t);break}return this.applyDefaultObjectOptions(i,t),i}static createSprite(e){const i=new CC({color:16777215});e!=null&&e.texture&&"map"in i&&(i.map=e.texture);const n=new qP(i);return this.applyDefaultObjectOptions(n,e),n}static applyDefaultObjectOptions(e,t){e.receiveShadow=!0,e.castShadow=!0,t!=null&&t.name&&(e.name=t.name),t!=null&&t.position&&(Array.isArray(t.position)?e.position.set(t.position[0],t.position[1],t.position[2]):e.position.set(t.position.x,t.position.y,t.position.z)),t!=null&&t.rotation&&(Array.isArray(t.rotation)?e.rotation.set(t.rotation[0],t.rotation[1],t.rotation[2]):e.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z)),t!=null&&t.scale&&(typeof t.scale=="number"?e.scale.set(t.scale,t.scale,t.scale):e.scale.set(t.scale.x,t.scale.y,t.scale.z)),(t==null?void 0:t.receiveShadow)!=null&&(e.receiveShadow=t.receiveShadow),(t==null?void 0:t.castShadow)!=null&&(e.castShadow=t.castShadow),t!=null&&t.parent&&t.parent.add(e)}}z0=new WeakSet,AR=function(e,t,i){const n=(i==null?void 0:i.depth)||.1;return new Ise(e,{font:t,size:1,depth:n,height:n,bevelEnabled:(i==null?void 0:i.bevel)||!1,bevelThickness:.01,bevelOffset:.01,bevelSize:.01})},ls(Vd,z0);function Dse(s,e,t,i,n){const r=new gd,o=1e-5,a=i-o;r.absarc(o,o,o,-Math.PI/2,-Math.PI,!0),r.absarc(o,e-a*2,o,Math.PI,Math.PI/2,!0),r.absarc(s-a*2,e-a*2,o,Math.PI/2,0,!0),r.absarc(s-a*2,o,o,0,-Math.PI/2,!0);const l=new vv(r,{bevelEnabled:!0,bevelSegments:n*2,steps:1,bevelSize:a,bevelThickness:i,curveSegments:n});return l.scale(1,1,1-i),l.center(),l.computeVertexNormals(),l}const ux=new Map;function Ose(s){let e="";switch(s){default:case"OpenSans":e="https://cdn.needle.tools/static/fonts/facetype/Open Sans_Regular_ascii.json";break;case"Helvetiker":e="https://raw.githubusercontent.com/mrdoob/three.js/master/examples/fonts/helvetiker_regular.typeface.json";break}if(ux.has(e)){const n=ux.get(e);if(n)return n}const t=new Rse,i=new Promise((n,r)=>{t.load(e,o=>{ux.set(e,o),n(o)},void 0,r)});return ux.set(e,i),i}let PT=!1,BT=null;function Lse(s,e){if(BT===null){const t="https://cdn.needle.tools/static/models/shaderball.glb",i=new Za,n=rE(null);i.setDRACOLoader(n.dracoLoader),i.setKTX2Loader(n.ktx2Loader),PT=!0,BT=i.loadAsync(t).then(r=>{const o=r.scene;return o.position.y-=.5,o}).catch(r=>(console.warn("Failed to load shaderball mesh: "+r.message),PF())).finally(()=>{PT=!1})}if(PT){const t=PF();t.name="ShaderBall-Placeholder";const i=t.children[0];(i==null?void 0:i.type)==="Mesh"&&RF(i,e),s.add(t)}BT.then(t=>{s.children.forEach(r=>{r.name==="ShaderBall-Placeholder"&&s.remove(r)});const i=t.clone(),n=i.children[0];(n==null?void 0:n.type)==="Mesh"&&RF(n,e),s.add(i)})}function RF(s,e){var i;if((e==null?void 0:e.color)||(e==null?void 0:e.material)||(e==null?void 0:e.texture)){const n=(e==null?void 0:e.material)??((i=s.material)==null?void 0:i.clone())??new ms;e.color&&"color"in n&&n.color instanceof me&&n.color.set(e.color),e!=null&&e.texture&&"map"in n&&(n.map=e.texture),s.material=n}}function PF(){return new vs().add(Vd.createPrimitive("Sphere",{material:new Kt({transparent:!0,opacity:.1})}))}const c2=class{constructor(e,t,i){u(this,"_session");u(this,"_mode");u(this,"_init");u(this,"_renderer");u(this,"_camera");u(this,"_scene");u(this,"onEnd",()=>{var e;(e=this._session)==null||e.removeEventListener("end",this.onEnd),this._renderer.setAnimationLoop(null),this._renderer.dispose(),this._scene.clear()});u(this,"_lastTime",0);u(this,"onFrame",(e,t)=>{const i=e-this._lastTime;this.update(e,i),this._camera.parent!==this._scene&&this._scene.add(this._camera),this._renderer.render(this._scene,this._camera)});u(this,"_objects",[]);this._mode=e,this._init=t,this._session=i,this._session.addEventListener("end",this.onEnd),this._renderer=new eh({alpha:!0}),this._renderer.setAnimationLoop(this.onFrame),this._renderer.xr.setSession(i),this._renderer.xr.enabled=!0,this._camera=new zt,this._scene=new Ks,this._scene.fog=new SC(4473924,10,250),this._scene.add(this._camera),this.setupScene()}static get active(){return this._active}static async start(e,t){if(this._active)return console.error("Cannot start a new XR session while one is already active"),null;if(this._requestInFlight)return console.error("Cannot start a new XR session while a request is already in flight"),null;if("xr"in navigator&&navigator.xr){if(!t)return console.error("XRSessionInit must be provided"),null;this._requestInFlight=!0;const i=await navigator.xr.requestSession(e,t);return i.addEventListener("end",()=>{this._active=null}),this._requestInFlight?(this._requestInFlight=!1,this._active=new c2(e,t,i),this._active):(i.end(),null)}return null}static async handoff(){return this._active?this._active.handoff():null}static async stop(){this._requestInFlight=!1,this._active&&(await this._active.end(),await Xc(100)),this._active=null}get isAR(){return this._mode==="immersive-ar"}end(){return this._session?this._session.end():Promise.resolve()}async handoff(){if(!this._session)throw new Error("Cannot handoff a session that has already ended");const e={session:this._session,mode:this._mode,init:this._init};return await this.onBeforeHandoff(),this.onEnd(),this._session=null,e}async onBeforeHandoff(){await Xc(1e3),this._scene.clear()}setupScene(){this._scene.background=new me(0),this._scene.add(new Av(5,10,1118481,1118481));const e=new Op(16777215,1);e.position.set(0,20,0),e.castShadow=!1,this._scene.add(e);const t=new Op(16777215,1);t.position.set(0,-1,0),t.castShadow=!1,this._scene.add(t);const i=new Dp(16777215,1,100,1);i.position.set(0,2,0),i.castShadow=!1,i.distance=200,this._scene.add(i);const n=50;for(let r=0;r<100;r++){const o=new ms({color:2236962,metalness:1,roughness:.8});this.isAR&&(o.emissive=new me(Math.random(),Math.random(),Math.random()),o.emissiveIntensity=Math.random());const a=et.random(0,1)>.5?Wa.Sphere:Wa.Cube,l=Vd.createPrimitive(a,{material:o});l.position.x=et.random(-n,n),l.position.y=et.random(-2,n),l.position.z=et.random(-n,n),l.rotation.x=et.random(0,Math.PI*2),l.rotation.y=et.random(0,Math.PI*2),l.rotation.z=et.random(0,Math.PI*2),l.scale.multiplyScalar(.5+Math.random()*10);const c=l.position.distanceTo(this._camera.position)-l.scale.x;c<1&&l.position.multiplyScalar(1+1/c),this._objects.push(l),this._scene.add(l)}}update(e,t){const i=e*4e-4;for(let n=0;n<this._objects.length;n++){const r=this._objects[n];r.position.y+=Math.sin(i+n*.5)*.005,r.rotateY(.002)}}};let ud=c2;u(ud,"_active",null),u(ud,"_requestInFlight",!1);var v0;(function(s){const e=[];function t(){if(!(e!=null&&e.length))return!1;for(const r of e)r.exportAndOpen();return!0}s.exportAndOpen=t;function i(r){e.push(r)}s.registerExporter=i;function n(r){if(!e)return;const o=e.indexOf(r);o>=0&&e.splice(o,1)}s.unregisterExporter=n})(v0||(v0={}));const BF="NeedleXRSession onStart",DF="NeedleXRSession onEnd",us=ie("debugwebxr"),OF=ie("stats");let DT=0;function kse(s){let e=null;const t=s;return t.getAROverlayContainer?e=t.getAROverlayContainer():e=s,e}Fse();async function Fse(){var s;if(ie("debugasap")){let e=globalThis["needle:XRSession"];if(e instanceof Promise){delete globalThis["needle:XRSession"],xi.addContextCreatedCallback(async t=>{if(!e)return;fp(!0);const i=await e;if(i){const n=It.getDefaultSessionInit("immersive-vr");It.setSession("immersive-vr",i,n,t.context)}else console.error("NeedleXRSession: ASAP session was rejected");e=void 0});return}}if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent)){console.warn("WebXRViewer does not support addEventListener");return}(s=navigator.xr)==null||s.addEventListener("sessiongranted",async()=>{fp(!0),console.log("Received Session Granted..."),await Xc(100);const e=sessionStorage.getItem("needle_xr_session_mode"),t=sessionStorage.getItem("needle_xr_session_init")??null,i=t?JSON.parse(t):null;let n=null;if($V()&&(await ud.start(e||"immersive-vr",i||It.getDefaultSessionInit("immersive-vr")),await zse(),n=await ud.handoff()),n)It.setSession(n.mode,n.session,n.init,Ot.Current);else if(e&&t){console.log("Session Granted: Restore last session");const r=JSON.parse(t);It.start(e,r).catch(o=>console.warn(o))}else It.start("immersive-vr").catch(r=>console.warn("Session Granted failed:",r))},{once:!0})}}function Use(s,e){sessionStorage.setItem("needle_xr_session_mode",s),sessionStorage.setItem("needle_xr_session_init",JSON.stringify(e))}function Nse(){sessionStorage.removeItem("needle_xr_session_mode"),sessionStorage.removeItem("needle_xr_session_init")}const xD=new Set;xi.registerCallback(yi.ContextCreationStart,async s=>{xD.add(s.context)});xi.registerCallback(yi.ContextCreated,async s=>{xD.delete(s.context)});function $V(){return xD.size>0}function zse(){return new Promise(s=>{const e=Date.now(),t=setInterval(()=>{(!$V()||Date.now()-e>6e4)&&(clearInterval(t),s())},100)})}St.isDesktop()&&Xe()&&window.addEventListener("keydown",s=>{(s.key==="x"||s.key==="Escape")&&It.active&&It.stop()});const Oh=class{constructor(e,t,i,n){u(this,"context");u(this,"session");u(this,"mode");u(this,"controllers",[]);u(this,"_rigScale",1);u(this,"_lastRigScaleUpdate",-1);u(this,"_rigs",[]);u(this,"_viewerHitTestSource",null);u(this,"_defaultRig");u(this,"_xr_scripts");u(this,"_xr_update_scripts",[]);u(this,"_inactive_scripts",[]);u(this,"_controllerAdded");u(this,"_controllerRemoved");u(this,"_originalCameraWorldPosition");u(this,"_originalCameraWorldRotation");u(this,"_originalCameraWorldScale");u(this,"_originalCameraParent");u(this,"_mainCamera",null);u(this,"onRendererSessionSet",()=>{var e;this.running&&(this.context.renderer.xr.enabled=!0,this.context.renderer.xr.updateCamera(this.context.mainCamera),(e=this.context.mainCameraComponent)==null||e.applyClearFlags())});u(this,"onInputSourceAdded",e=>{if(e.targetRayMode==="screen")return;let t=0;for(let n=0;n<this.session.inputSources.length;n++)if(this.session.inputSources[n]===e){t=n;break}if(this.controllers.find(n=>n.inputSource===e)){console.warn("Controller already exists for input source",t);return}us&&console.log("Adding controller",t);const i=new dD(this,e,t);this._newControllers.push(i)});u(this,"_ended",!1);u(this,"_newControllers",[]);u(this,"onEnd",e=>{var n,r,o;if(this._ended)return;this._ended=!0,us&&console.log("XR Session ended"),Nse(),this.onAfterRender(),this.revertCustomForward(),this._didStart=!1,this._previousCameraParent=null,Hd(this.onBefore,Wt.LateUpdate);const t=this.context.pre_render_callbacks.indexOf(this.onBeforeRender);t>=0&&this.context.pre_render_callbacks.splice(t,1);const i=this.context.post_render_callbacks.indexOf(this.onAfterRender);i>=0&&this.context.post_render_callbacks.splice(i,1),this.context.xr=null,this.context.renderer.xr.enabled=!1,this.context.pre_update_oneshot_callbacks.push(()=>{var a,l;(a=this.context.mainCameraComponent)==null||a.applyClearFlags(),(l=this.context.mainCameraComponent)==null||l.applyClippingPlane()}),$H({session:this});for(const a of Oh._xrEndListeners)a({xr:this});for(let a=0;a<this.controllers.length;a++)this.disconnectInputSource(this.controllers[a].inputSource);for(const a of this._xr_scripts)(n=a==null?void 0:a.onLeaveXR)==null||n.call(a,{xr:this});(r=this.sync)==null||r.onExitXR(this),this.context.mainCamera&&((o=this._originalCameraParent)==null||o.add(this.context.mainCamera),this._originalCameraWorldPosition&&Os(this.context.mainCamera,this._originalCameraWorldPosition),this._originalCameraWorldRotation&&Ka(this.context.mainCamera,this._originalCameraWorldRotation),this._originalCameraWorldScale&&Jg(this.context.mainCamera,this._originalCameraWorldScale)),this.context.requestSizeUpdate(),this._defaultRig.gameObject.removeFromParent(),fp(!1),performance.mark(DF),performance.measure("NeedleXRSession",BF,DF)});u(this,"_didStart",!1);u(this,"onBefore",e=>{var n,r,o,a,l,c,h,d;const t=e.xrFrame;if(!t)return;performance.mark("NeedleXRSession onBefore start"),this.context.xr=this,this.context.mainCameraComponent&&this.context.mainCameraComponent!==this._mainCamera&&(this._mainCamera=this.context.mainCameraComponent),((n=this.rig)==null?void 0:n.isActive)==!1&&(us&&console.warn("Latest rig is not active - trying to activate a different rig",this.rig),this.updateActiveXRRig()),this.rig&&((r=this._mainCamera)!=null&&r.gameObject)&&((a=(o=this._mainCamera)==null?void 0:o.gameObject)==null?void 0:a.parent)!==this.rig.gameObject&&this.rig.gameObject.add((l=this._mainCamera)==null?void 0:l.gameObject),this.internalUpdateState(),this.applyCustomForward();const i={xr:this};if(this._didStart){if(this.context.new_scripts_xr.length>0){const f=[...this.context.new_scripts_xr];for(let p=0;p<f.length;p++){const m=this.context.new_scripts_xr[p];if(!m||m.destroyed||((c=m.supportsXR)==null?void 0:c.call(m,this.mode))==!1){this.context.new_scripts_xr.splice(p,1);continue}if(!m.activeAndEnabled){this.context.new_scripts_xr.splice(p,1),this.markInactive(m);continue}if(this.addScript(m)){this.invokeCallback_EnterXR(m);for(const v of this.controllers)this.invokeCallback_ControllerAdded(m,v)}}}}else{if(this._didStart=!0,this.mode==="immersive-vr"){const p=Ja(this.context.scene.children);if(p){const m=p.getSize(yt());if(m.length()>0){const v=this._defaultRig.gameObject;v.position.set(p.min.x+m.x*.5,p.min.y,p.max.z+m.z*.5+1.5);const y=p.getCenter(yt());y.y=v.position.y,v.lookAt(y)}}}ZH({session:this});for(const p of Oh._xrStartListeners)p(i);const f=[...this._xr_scripts];us&&console.log("NeedleXRSession start, handle scripts:",f);for(const p of f){if(p.destroyed){this._script_to_remove.push(p);continue}if(!p.activeAndEnabled){this.markInactive(p);continue}this.invokeCallback_EnterXR(p);for(const m of this.controllers)this.invokeCallback_ControllerAdded(p,m)}}this.syncCameraCullingMask();for(const f of this.controllers)f.onUpdate(t);if(this._newControllers.length>0){const f=[...this._newControllers];this._newControllers.length=0;for(const p of f){if(!p.connected){console.warn("New controller is not connected",p);continue}this.controllers.push(p);for(const m of this._xr_scripts){if(m.destroyed){this._script_to_remove.push(m);continue}m.activeAndEnabled!==!1&&this.invokeCallback_ControllerAdded(m,p)}}this.controllers.sort((p,m)=>p.index-m.index)}us&&this.context.time.frame%30===0&&this.controllers.length<=0&&this.session.inputSources.length>0&&(fp(!0),console.error("XRControllers are not added but inputSources are present")),performance.mark("NeedleXRSession update scripts start");for(const f of this._xr_update_scripts){if(f.destroyed===!0){this._script_to_remove.push(f);continue}if(f.activeAndEnabled===!1){this.markInactive(f);continue}f.onUpdateXR&&f.onUpdateXR(i)}if(performance.mark("NeedleXRSession update scripts end"),performance.measure("NeedleXRSession update scripts","NeedleXRSession update scripts start","NeedleXRSession update scripts end"),this.handleInactiveScripts(),this._script_to_remove.length>0){const f=[...new Set(this._script_to_remove)];this._script_to_remove.length=0;for(const p of f)!p.destroyed&&this.running&&((h=p.onLeaveXR)==null||h.call(p,i)),this.removeScript(p)}(d=this.sync)==null||d.onUpdate(this),this.onRenderDebug(),performance.mark("NeedleXRSession onBefore end"),performance.measure("NE XR frame","NeedleXRSession onBefore start","NeedleXRSession onBefore end")});u(this,"onBeforeRender",()=>{this.context.mainCamera&&this.updateFade(this.context.mainCamera)});u(this,"onAfterRender",()=>{if(this.onUpdateFade_PostRender(),St.isDesktop()||!this._renderOnceOnDevice){const e=this.context.renderer;if(e.xr.isPresenting&&this.context.mainCamera){this._renderOnceOnDevice=!0;const t=e.xr.enabled,i=e.getRenderTarget(),n=this.context.scene.background;e.xr.enabled=!1,e.setRenderTarget(null),this.isPassThrough&&(this.context.scene.background=null),this.context.composer?this.context.composer.render(this.context.time.deltaTime):e.render(this.context.scene,this.context.mainCamera),e.xr.enabled=t,e.setRenderTarget(i),this.context.scene.background=n}}});u(this,"_script_to_remove",[]);u(this,"_camera");u(this,"_cameraRenderParent",new ge().rotateY(Math.PI));u(this,"_previousCameraParent");u(this,"_customforward",!0);u(this,"originalCameraNearPlane");u(this,"_viewerPose");u(this,"_transformOrientation",new xe);u(this,"_transformPosition",new w);u(this,"_transition");var r,o;performance.mark(BF),Use(e,n.init),this.session=t,this.mode=e,this.context=i,(us||ie("console"))&&fp(!0),this._xr_scripts=[...n.scripts],this._xr_update_scripts=this._xr_scripts.filter(a=>typeof a.onUpdateXR=="function"),this._controllerAdded=n.controller_added,this._controllerRemoved=n.controller_removed,Gd(this.onBefore,Wt.LateUpdate),this.context.pre_render_callbacks.push(this.onBeforeRender),this.context.post_render_callbacks.push(this.onAfterRender),((r=n.init.optionalFeatures)!=null&&r.includes("hit-test")||(o=n.init.requiredFeatures)!=null&&o.includes("hit-test"))&&t.requestReferenceSpace("viewer").then(a=>{var l,c;return(c=(l=t.requestHitTestSource)==null?void 0:l.call(t,{space:a}))==null?void 0:c.then(h=>this._viewerHitTestSource=h).catch(h=>console.error(h))}).catch(a=>console.error(a)),this.context.mainCamera&&(this._originalCameraWorldPosition=Qt(this.context.mainCamera,new w),this._originalCameraWorldRotation=qi(this.context.mainCamera,new xe),this._originalCameraWorldScale=ln(this.context.mainCamera,new w),this._originalCameraParent=this.context.mainCamera.parent),this._defaultRig=new kne,this.context.scene.add(this._defaultRig.gameObject),this.addRig(this._defaultRig);for(let a=0;a<t.inputSources.length;a++){const l=t.inputSources[a];if(!l.handedness){console.warn("Input source in xr session has no handedness - ignoring",a);continue}this.onInputSourceAdded(l)}this.session.addEventListener("end",this.onEnd),this.session.addEventListener("inputsourceschange",a=>{for(const l of a.removed)this.disconnectInputSource(l);for(const l of a.added)this.onInputSourceAdded(l)}),this.context.xr=this,this.context.renderer.xr.setSession(this.session).then(this.onRendererSessionSet),"controllerAutoUpdate"in this.context.renderer.xr?(console.debug("Disabling three.js controllerAutoUpdate"),this.context.renderer.xr.controllerAutoUpdate=!1):us&&console.warn("controllerAutoUpdate is not available in three.js - cannot disable it")}static getXRSync(e){return this._sync||(this._sync=new JV(e)),this._sync}static get currentSessionRequest(){return this._currentSessionRequestMode}static get active(){return this._activeSession}static get activeMode(){var e;return((e=this._activeSession)==null?void 0:e.mode)??null}static get xrSystem(){return"xr"in navigator?navigator.xr:void 0}static isXRSupported(){return Promise.all([this.isVRSupported(),this.isARSupported()]).then(e=>e.some(t=>t)).catch(()=>!1)}static isVRSupported(){return this.isSessionSupported("immersive-vr")}static isARSupported(){return this.isSessionSupported("immersive-ar")}static isSessionSupported(e){var t;return((t=this.xrSystem)==null?void 0:t.isSessionSupported(e).catch(i=>(us&&console.error(i),!1)))??Promise.resolve(!1)}static onSessionRequestStart(e){this._sessionRequestStartListeners.push(e)}static offSessionRequestStart(e){const t=this._sessionRequestStartListeners.indexOf(e);t>=0&&this._sessionRequestStartListeners.splice(t,1)}static onSessionRequestEnd(e){this._sessionRequestEndListeners.push(e)}static offSessionRequestEnd(e){const t=this._sessionRequestEndListeners.indexOf(e);t>=0&&this._sessionRequestEndListeners.splice(t,1)}static onXRSessionStart(e){this._xrStartListeners.push(e)}static offXRSessionStart(e){const t=this._xrStartListeners.indexOf(e);t>=0&&this._xrStartListeners.splice(t,1)}static onXRSessionEnd(e){this._xrEndListeners.push(e)}static offXRSessionEnd(e){const t=this._xrEndListeners.indexOf(e);t>=0&&this._xrEndListeners.splice(t,1)}static onControllerAdded(e){this._controllerAddedListeners.push(e)}static offControllerAdded(e){const t=this._controllerAddedListeners.indexOf(e);t>=0&&this._controllerAddedListeners.splice(t,1)}static onControllerRemoved(e){this._controllerRemovedListeners.push(e)}static offControllerRemoved(e){const t=this._controllerRemovedListeners.indexOf(e);t>=0&&this._controllerRemovedListeners.splice(t,1)}static offerSession(e,t,i){return"xr"in navigator&&navigator.xr&&"offerSession"in navigator.xr?(typeof navigator.xr.offerSession=="function"&&(console.log("WebXR offerSession is available - requesting mode: "+e),t=="default"&&(t=this.getDefaultSessionInit(e)),navigator.xr.offerSession(e,{...t}).then(n=>Oh.setSession(e,n,t,i)).catch(n=>{console.log("XRSession offer rejected (perhaps because another call to offerSession was made or a call to requestSession was made)")})),!0):!1}static getDefaultSessionInit(e){switch(e){case"immersive-ar":return{optionalFeatures:["anchors","local-floor","hand-tracking","layers","dom-overlay","hit-test","unbounded"]};case"immersive-vr":return{optionalFeatures:["local-floor","bounded-floor","hand-tracking","high-fixed-foveation-level","layers"]};default:return console.warn("No default session init for mode",e),{}}}static async start(e,t,i){var a,l,c,h;if(St.isiOS()){if(e==="ar")if(await this.isARSupported())e="immersive-ar";else return v0.exportAndOpen(),null}else e=="ar"&&(e="immersive-ar");if(Xe()&&ie("debugxrpreroom"))return console.warn("Debug: Starting temporary XR session"),await ud.start(e,t||Oh.getDefaultSessionInit(e)),null;if(this._currentSessionRequest)return console.warn("A XRSession is already being requested"),(us||Xe())&&Yi("A XRSession is already being requested"),this._currentSessionRequest.then(()=>this._activeSession);if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;if(i||(i=Ot.Current),i||(i=xi.All[0]),!i)throw new Error("No Needle Engine Context found");switch(performance.mark("NeedleXRSession start"),t||(t={}),e){case"immersive-ar":{if(await((a=this.xrSystem)==null?void 0:a.isSessionSupported("immersive-ar"))!==!0)return console.error(e+" is not supported by this browser."),null;const f=this.getDefaultSessionInit(e),p=kse(i.domElement);p&&!St.isQuest()&&(f.domOverlay={root:p},f.optionalFeatures.push("dom-overlay")),t={...f,...t}}break;case"immersive-vr":{if(await((l=this.xrSystem)==null?void 0:l.isSessionSupported("immersive-vr"))!==!0)return console.error(e+" is not supported by this browser."),null;t={...this.getDefaultSessionInit(e),...t}}break;default:console.warn("No default session init for mode",e);break}t.optionalFeatures??(t.optionalFeatures=[]),t.requiredFeatures??(t.requiredFeatures=[]),await ud.stop();const n=e=="immersive-ar"?i.scripts_immersive_ar:i.scripts_immersive_vr;us?console.log(`%cRequesting ${e} session`,"font-weight:bold;",t,n):console.log(`%cRequesting ${e} session`,"font-weight:bold;");for(const d of n)d.onBeforeXR&&d.onBeforeXR(e,t);for(const d of this._sessionRequestStartListeners)d({mode:e,init:t});us&&Pn("Requesting "+e+" session ("+Date.now()+")"),this._currentSessionRequest=(c=navigator.xr)==null?void 0:c.requestSession(e,t),this._currentSessionRequestMode=e;const r=await((h=this._currentSessionRequest)==null?void 0:h.catch(d=>{console.error(d,"Code: "+d.code),d.code===9&&Yi("Make sure your device has the required permissions (e.g. camera access)"),console.log("If the specified XR configuration is not supported (e.g. entering AR doesnt work) - make sure you access the website on a secure connection (HTTPS) and your device has the required permissions (e.g. camera access)"),location.protocol==="http:"&&Yi("XR requires a secure connection (HTTPS)")}));this._currentSessionRequest=void 0,this._currentSessionRequestMode=null;for(const d of this._sessionRequestEndListeners)d({mode:e,init:t,newSession:r||null});if(!r)return console.warn("XR Session request was rejected"),null;const o=this.setSession(e,r,t,i);return performance.mark("NeedleXRSession end"),performance.measure("NeedleXRSession Startup","NeedleXRSession start","NeedleXRSession end"),o}static setSession(e,t,i,n){if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;const r=e=="immersive-ar"?n.scripts_immersive_ar:n.scripts_immersive_vr;return this._activeSession=new Oh(e,t,n,{scripts:r,controller_added:this._controllerAddedListeners,controller_removed:this._controllerRemovedListeners,init:i}),t.addEventListener("end",this.onEnd),us?console.log(`%cStarted ${e} session`,"font-weight:bold;",r):console.log(`%cStarted ${e} session`,"font-weight:bold;"),this._activeSession}static stop(){var e;(e=this._activeSession)==null||e.end()}get sync(){return Oh._sync}get running(){return!this._ended&&this.session!=null}get interactionMode(){return this.session.interactionMode}get visibilityState(){return this.session.visibilityState}get isVisibleBlurred(){return this.session.visibilityState==="visible-blurred"}get isSystemKeyboardSupported(){return this.session.isSystemKeyboardSupported}get environmentBlendMode(){return this.session.environmentBlendMode}get frame(){return this.context.xrFrame}get leftController(){return this.controllers.find(e=>e.side==="left")}get rightController(){return this.controllers.find(e=>e.side==="right")}getController(e){return typeof e=="number"?this.controllers[e]||null:this.controllers.find(t=>t.side===e)||null}get isPassThrough(){return!!(this.environmentBlendMode!=="opaque"&&this.interactionMode==="world-space"||this.mode==="immersive-ar"&&this.environmentBlendMode!=="opaque"&&this.controllers.some(e=>e.inputSource.targetRayMode==="tracked-pointer")||Xe()&&St.isDesktop()&&this.mode==="immersive-ar")}get isAR(){return this.mode==="immersive-ar"}get isVR(){return this.mode==="immersive-vr"}get isScreenBasedAR(){return this.isAR&&!this.isPassThrough}get posePosition(){return this._transformPosition}get poseOrientation(){return this._transformOrientation}get referenceSpace(){return this.context.renderer.xr.getReferenceSpace()}get viewerPose(){return this._viewerPose}get isTrackingImages(){if(this.frame&&"getImageTrackingResults"in this.frame&&typeof this.frame.getImageTrackingResults=="function")try{const e=this.frame.getImageTrackingResults();for(const t of e)if(t.trackingState==="tracked")return!0}catch{return!1}return!1}get rig(){const e=this._rigs[0]??null;return e!=null&&e.gameObject&&Up(e.gameObject)||(e==null?void 0:e.isActive)===!1?(this.updateActiveXRRig(),this._rigs[0]??null):e}get rigScale(){return this._rigs[0]?(this._lastRigScaleUpdate!==this.context.time.frame&&(this._lastRigScaleUpdate=this.context.time.frame,this._rigScale=this._rigs[0].gameObject.worldScale.x),this._rigScale):1}addRig(e){this._rigs.indexOf(e)>=0||(e.priority===void 0&&(e.priority=0),this._rigs.push(e),this.updateActiveXRRig())}removeRig(e){const t=this._rigs.indexOf(e);t!==-1&&(this._rigs.splice(t,1),this.updateActiveXRRig())}setRigActive(e){const t=this._rigs.indexOf(e);this._rigs.splice(t,1),this._rigs.unshift(e),this.updateActiveXRRig()}getUserOffsetInRig(){var i;const e=(i=this.context.mainCamera)==null?void 0:i.position;if(!e||!this.rig)return yt(0,0,0);const t=yt(e);return t.x*=-1,t.z*=-1,t.applyQuaternion(bl(this.rig.gameObject.quaternion)),t}updateActiveXRRig(){const e=this._rigs[0]??null;this._defaultRig.gameObject.parent!==this.context.scene&&this.context.scene.add(this._defaultRig.gameObject),this._defaultRig.gameObject.visible=!0,this._rigs.includes(this._defaultRig)||this._rigs.push(this._defaultRig);let t=this._rigs[0];t&&t.priority===void 0&&(t.priority=0);for(let i=1;i<this._rigs.length;i++){const n=this._rigs[i];if(n.isActive){if(Up(n.gameObject)){this._rigs.splice(i,1),i--;continue}(!t||t.isActive===!1||n.priority!==void 0&&n.priority>t.priority)&&(t=n)}}if(e!==t){const i=this._rigs.indexOf(t);i>=0&&this._rigs.splice(i,1),this._rigs.unshift(t)}us&&(e===t?console.log("Updated Active XR Rig:",t,"prev:",e):console.log("Updated Active XRRig:",t," (the same as before)"))}getHitTest(e){if(e)return this.getControllerHitTest(e);if(!this._viewerHitTestSource)return null;const t=this._viewerHitTestSource,i=this.frame.getHitTestResults(t);if(i.length>0){const n=i[0];return this.convertHitTestResult(n)}return null}getControllerHitTest(e){const t=e.getHitTestSource();if(!t)return null;const i=this.frame.getHitTestResultsForTransientInput(t);for(const n of i)if(n.inputSource===e.inputSource)for(const r of n.results)return this.convertHitTestResult(r);return null}convertHitTestResult(e){const t=this.context.renderer.xr.getReferenceSpace(),i=t&&e.getPose(t);if(i){const n=yt(i.transform.position),r=bl(i.transform.orientation),o=this.context.mainCamera;if((o==null?void 0:o.parent)!==this._cameraRenderParent&&n.applyMatrix4(Rg),o!=null&&o.parent){n.applyMatrix4(o.parent.matrixWorld),r.multiply(Ua);const a=qi(o.parent);a.premultiply(Ua),r.premultiply(a)}return{hit:e,position:n,quaternion:r}}return null}convertSpace(e){const t=yt(e.position);t.applyMatrix4(Rg);const i=bl(e.orientation);return i.premultiply(Ua),{position:t,quaternion:i}}disconnectInputSource(e){const t=(i,n,r)=>{if(i.inputSource===e){us&&console.log("Disconnecting controller",i.index),this.controllers.splice(r,1),this.invokeControllerEvent(i,this._controllerRemoved,"removed");const o={xr:this,controller:i,change:"removed"};for(const a of this._xr_scripts)a.onXRControllerRemoved&&a.onXRControllerRemoved(o);i.onDisconnected()}};for(let i=this.controllers.length-1;i>=0;i--){const n=this.controllers[i];t(n,this.controllers,i)}for(let i=this._newControllers.length-1;i>=0;i--){const n=this._newControllers[i];t(n,this._newControllers,i)}}end(){this._ended||this.session.end().catch(e=>console.warn(e))}onRenderDebug(){if(us)for(const e of this.controllers)e.onRenderDebug();if((us||OF)&&this.rig&&(DT++,DT>=20)){const e=this.rig.gameObject.worldPosition,t=this.rig.gameObject.worldForward;e.add(t.multiplyScalar(1.5));const i=this.rig.gameObject.worldUp;e.add(i.multiplyScalar(2.5));let n="";if(n+=`${this.context.time.smoothedFps.toFixed(0)} FPS`,n+=`, calls: ${this.context.renderer.info.render.calls}, tris: ${this.context.renderer.info.render.triangles.toLocaleString()}`,us||OF)for(const r of this.controllers)n+=`
${r.hand?"hand":"ctrl"} ${r.inputSource.handedness}[${r.index}] con:${r.connected} tr:${r.isTracking} hts:${r.hasHitTestSource?"yes":"no"}`;DT=0,At.DrawLabel(e,n,void 0,1/60*20)}}addScript(e){return this._xr_scripts.includes(e)?!1:(us&&console.log("Register new XRScript",e),this._xr_scripts.push(e),typeof e.onUpdateXR=="function"&&this._xr_update_scripts.push(e),!0)}markInactive(e){if(!(this._inactive_scripts.indexOf(e)>=0)){this.removeScript(e,!1),this._inactive_scripts.push(e);for(const t of this.controllers)this.invokeCallback_ControllerRemoved(e,t);this.invokeCallback_LeaveXR(e)}}handleInactiveScripts(){if(this._inactive_scripts.length>0)for(let e=this._inactive_scripts.length-1;e>=0;e--){const t=this._inactive_scripts[e];if(t.activeAndEnabled){this._inactive_scripts.splice(e,1),this.addScript(t),this.invokeCallback_EnterXR(t);for(const i of this.controllers)this.invokeCallback_ControllerAdded(t,i)}}}removeScript(e,t=!0){us&&console.log("Remove XRScript",e);const i=this._xr_scripts.indexOf(e);i>=0&&this._xr_scripts.splice(i,1);const n=this._xr_update_scripts.indexOf(e);if(n>=0&&this._xr_update_scripts.splice(n,1),t){const r=this._inactive_scripts.indexOf(e);r>=0&&this._inactive_scripts.splice(r,1)}}invokeCallback_EnterXR(e){e.onEnterXR&&e.onEnterXR({xr:this})}invokeCallback_ControllerAdded(e,t){e.onXRControllerAdded&&e.onXRControllerAdded({xr:this,controller:t,change:"added"})}invokeCallback_ControllerRemoved(e,t){e.onXRControllerRemoved&&e.onXRControllerRemoved({xr:this,controller:t,change:"removed"})}invokeCallback_LeaveXR(e){e.onLeaveXR&&!e.destroyed&&e.onLeaveXR({xr:this})}syncCameraCullingMask(){var i;const e=this.context.xrCamera,t=(i=this.context.mainCameraComponent)==null?void 0:i.cullingMask;if(e&&t!==void 0){for(const n of e.cameras)n.layers.mask=t;e.layers.mask=t}else if(e){for(const n of e.cameras)n.layers.enableAll();e.layers.enableAll()}}invokeControllerEvent(e,t,i){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r)try{r({xr:this,controller:e,change:i})}catch(o){console.error(o)}}}applyCustomForward(){var e;if(this.context.mainCamera&&this._customforward){this._camera=this.context.mainCamera,this._camera.parent!==this._cameraRenderParent&&(this._previousCameraParent=this._camera.parent,(e=this._previousCameraParent)==null||e.add(this._cameraRenderParent)),this._cameraRenderParent.name="XR Camera Render Parent",this._cameraRenderParent.add(this._camera);let t=.02;if(this.rig){const i=ln(this.rig.gameObject);t*=i.x}this._camera instanceof zt&&this._camera.near>t&&(this.originalCameraNearPlane=this._camera.near,this._camera.near=t)}}revertCustomForward(){this._camera&&this._previousCameraParent&&this._previousCameraParent.add(this._camera),this._previousCameraParent=null,this._camera instanceof zt&&this.originalCameraNearPlane!=null&&(this._camera.near=this.originalCameraNearPlane)}internalUpdateState(){const e=this.context.renderer.xr.getReferenceSpace();if(!e){this._viewerPose=void 0;return}if(this._viewerPose=this.frame.getViewerPose(e),this._viewerPose){const t=this._viewerPose.transform;this._transformPosition.set(t.position.x,t.position.y,t.position.z),this._transformOrientation.set(t.orientation.x,t.orientation.y,t.orientation.z,t.orientation.w)}}get transition(){return this._transition||(this._transition=new IF),this._transition}fadeTransition(){return this._transition||(this._transition=new IF),this._transition.fadeTransition()}updateFade(e){this._transition&&e instanceof zt&&this._transition.update(e,this.context.time.deltaTime)}onUpdateFade_PostRender(){var e;(e=this._transition)==null||e.remove()}};let It=Oh;u(It,"_sync",null),u(It,"_currentSessionRequestMode",null),u(It,"_currentSessionRequest"),u(It,"_activeSession"),u(It,"_sessionRequestStartListeners",[]),u(It,"_sessionRequestEndListeners",[]),u(It,"_xrStartListeners",[]),u(It,"_xrEndListeners",[]),u(It,"_controllerAddedListeners",[]),u(It,"_controllerRemovedListeners",[]),u(It,"onEnd",()=>{us&&console.log("XR Session ended"),Oh._activeSession=null});const OT=ie("debugwebxr");class e5{static tryFindAvatarObjects(e,t,i){if(i.head&&i.leftHand&&i.rightHand)return;const n=e.name.toLocaleLowerCase();!i.head&&n.includes("head")&&(OT&&console.log("FOUND AVATAR HEAD",e.name),i.head=new si("",t,e)),n.includes("hand")&&(!i.leftHand&&n.includes("left")&&(OT&&console.log("FOUND AVATAR LEFT HAND",e.name),i.leftHand=new si("",t,e)),!i.rightHand&&n.includes("right")&&(OT&&console.log("FOUND AVATAR RIGHT HAND",e.name),i.rightHand=new si("",t,e)));for(let r=0;r<e.children.length;r++){if(i.head&&i.leftHand&&i.rightHand)return;const o=e.children[r];this.tryFindAvatarObjects(o,t,i)}}}const kr=new w,LF=new w,kF=new xe,Gse=ie("debuggizmos"),hl=8947848,LT=32,La=class{constructor(){}static isGizmo(e){return e[_R]!==void 0}static DrawLabel(e,t,i=.05,n=0,r,o,a){var h;if(!La.enabled)return null;r||(r=hl);const l=((h=It.active)==null?void 0:h.rigScale)??1,c=pn.getTextLabel(n,t,i*l,r,o);return a instanceof ge&&a.add(c),c.position.x=e.x,c.position.y=e.y,c.position.z=e.z,c}static DrawRay(e,t,i=hl,n=0,r=!0){if(!La.enabled)return;const o=pn.getLine(n),a=o.geometry.getAttribute("position");a.setXYZ(0,e.x,e.y,e.z),kr.set(t.x,t.y,t.z).multiplyScalar(999999999),a.setXYZ(1,e.x+kr.x,e.y+kr.y,e.z+kr.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawDirection(e,t,i=hl,n=0,r=!0,o=1){if(!La.enabled)return;const a=pn.getLine(n),l=a.geometry.getAttribute("position");l.setXYZ(0,e.x,e.y,e.z),t.w!==void 0?(kr.set(0,0,-o),kF.set(t.x,t.y,t.z,t.w),kr.applyQuaternion(kF)):(kr.set(t.x,t.y,t.z),kr.multiplyScalar(o)),l.setXYZ(1,e.x+kr.x,e.y+kr.y,e.z+kr.z),l.needsUpdate=!0,a.material.color.set(i),a.material.depthTest=r,a.material.depthWrite=!1}static DrawLine(e,t,i=hl,n=0,r=!0){if(!La.enabled)return;const o=pn.getLine(n),a=o.geometry.getAttribute("position");a.setXYZ(0,e.x,e.y,e.z),a.setXYZ(1,t.x,t.y,t.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1,o.material.fog=!1}static DrawCircle(e,t,i,n=hl,r=0,o=!0){if(!La.enabled)return;const a=pn.getCircle(r);a.position.set(e.x,e.y,e.z),a.scale.set(i,i,i),a.quaternion.setFromUnitVectors(this._up,kr.set(t.x,t.y,t.z).normalize()),a.material.color.set(n),a.material.depthTest=o,a.material.depthWrite=!1,a.material.fog=!1}static DrawWireSphere(e,t,i=hl,n=0,r=!0){if(!La.enabled)return;const o=pn.getSphere(t,n,!0);kp(o,e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1,o.material.fog=!1}static DrawSphere(e,t,i=hl,n=0,r=!0){if(!La.enabled)return;const o=pn.getSphere(t,n,!1);kp(o,e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawWireBox(e,t,i=hl,n=0,r=!0){if(!La.enabled)return;const o=pn.getBox(n);o.position.set(e.x,e.y,e.z),o.scale.set(t.x,t.y,t.z),o.material.color.set(i),o.material.depthTest=r,o.material.wireframe=!0,o.material.depthWrite=!1,o.material.fog=!1}static DrawWireBox3(e,t=hl,i=0,n=!0){if(!La.enabled)return;const r=pn.getBox(i);r.position.copy(e.getCenter(kr)),r.scale.copy(e.getSize(kr)),r.material.color.set(t),r.material.depthTest=n,r.material.wireframe=!0,r.material.depthWrite=!1,r.material.fog=!1}static DrawArrow(e,t,i=hl,n=0,r=!0,o=!1){if(!La.enabled)return;const a=pn.getArrowHead(n);a.position.set(t.x,t.y,t.z),a.quaternion.setFromUnitVectors(this._up.set(0,1,0),kr.set(t.x,t.y,t.z).sub(LF.set(e.x,e.y,e.z)).normalize());const c=kr.set(t.x,t.y,t.z).sub(LF.set(e.x,e.y,e.z)).length()*.1;a.scale.set(c,c,c),a.material.color.set(i),a.material.depthTest=r,a.material.wireframe=o,this.DrawLine(e,t,i,n,r)}static DrawWireMesh(e){const t=pn.getMesh(e.duration??0);"mesh"in e?(t.geometry=e.mesh.geometry,t.matrix.copy(e.mesh.matrixWorld)):(t.geometry=e.geometry,t.matrix.copy(e.matrix)),t.matrixAutoUpdate=!1,t.matrixWorldAutoUpdate=!1,t.material.color.set(e.color??hl),t.material.depthTest=e.depthTest??!0,t.material.wireframe=!0}static setVisible(e){for(const t of pn.timedObjectsBuffer)t.visible=e}};let At=La;u(At,"enabled",!0),u(At,"_up",new w(0,1,0));const Hse=new Xi(1,1,1);function wD(s=null){const e=new me(s??14540253),t=new sB(Hse);return new Xr(t,new hn({color:e}))}const _R=Symbol("GizmoCache");class pn{static ensureFont(){let e=Zi.FontLibrary.getFontFamily(this.familyName);if(!e){e=Zi.FontLibrary.addFontFamily(this.familyName);const t=e.addVariant("normal","normal","https://uploads.needle.tools/include/font-msdf.json","https://uploads.needle.tools/include/font.png");t==null||t.addEventListener("ready",()=>{Zi.update()})}}static getTextLabel(e,t,i,n,r){this.ensureFont();let o=this.textLabelCache.pop(),a=1;r&&typeof r=="string"&&(r==null?void 0:r.length)>=8&&r.startsWith("#")?(a=parseInt(r.substring(7),16)/255,r=r.substring(0,7),Gse&&console.log(r,a)):typeof r=="object"&&r.a!==void 0&&(a=r.a);const l={boxSizing:"border-box",fontFamily:this.familyName,width:"auto",fontSize:i,color:n,lineHeight:1,backgroundColor:r??void 0,backgroundOpacity:a,textContent:t,borderRadius:.5*i,padding:.8*i,whiteSpace:"pre",offset:.05*i};if(o)o.set(l);else{o=new qB(l);const c=this,h=o;h.setText=function(d){this.set({textContent:d}),c.tmuiNeedsUpdate=!0}}return this.tmuiNeedsUpdate=!0,this.registerTimedObject(Ot.Current,o,e,this.textLabelCache),o}static getBox(e){let t=this.boxesCache.pop();if(!t){const i=new Xi(1,1,1);t=new le(i)}return this.registerTimedObject(Ot.Current,t,e,this.boxesCache),t}static getLine(e){let t=this.linesCache.pop();if(!t){t=new Rn;let i=t.geometry.getAttribute("position");i||(i=new ot(new Float32Array(2*3),3),t.geometry.setAttribute("position",i))}return t.frustumCulled=!1,this.registerTimedObject(Ot.Current,t,e,this.linesCache),t}static getCircle(e){let t=this.circlesCache.pop();if(!t){t=new Rn;let i=t.geometry.getAttribute("position");if(!i){i=new ot(new Float32Array(LT*3),3),t.geometry.setAttribute("position",i);const n=yt(0,1,0),r=yt(0,0,1),o=yt(r);o.cross(n).normalize();const a=yt(o),l=Math.PI*2/(LT-1);for(let c=0;c<LT+1;c++){const h=l*c;n.copy(a).multiplyScalar(Math.cos(h)*1),o.copy(r).multiplyScalar(Math.sin(h)*1);const d=n.add(o);i.setXYZ(c,d.x,d.y,d.z)}}}return t.frustumCulled=!1,this.registerTimedObject(Ot.Current,t,e,this.circlesCache),t}static getSphere(e,t,i){let n=this.spheresCache.pop();return n||(n=new le(new Wo(1,8,8))),n.scale.set(e,e,e),n.material.wireframe=i,this.registerTimedObject(Ot.Current,n,t,this.spheresCache),n}static getArrowHead(e){let t=this.arrowHeadsCache.pop();return t||(t=new le(new ts(0,.5,1,8))),this.registerTimedObject(Ot.Current,t,e,this.arrowHeadsCache),t}static getMesh(e){let t=this.mesh.pop();return t||(t=new le,t.material=new Kt),this.registerTimedObject(Ot.Current,t,e,this.mesh),t}static registerTimedObject(e,t,i,n){if(!e){console.error("No Needle Engine context available. Did you call a Gizmos function in global scope?");return}const r=this.contextBeforeRenderCallbacks.get(e),o=this.contextPostRenderCallbacks.get(e);if(r){if(e.pre_render_callbacks[e.pre_render_callbacks.length-1]!==r){const a=e.pre_render_callbacks.indexOf(r);a>=0&&e.pre_render_callbacks.splice(a,1),e.pre_render_callbacks.push(r)}}else{const a=()=>{this.onBeforeRender(e,this.timedObjectsBuffer)};this.contextBeforeRenderCallbacks.set(e,a),e.pre_render_callbacks.push(a)}if(o){if(e.post_render_callbacks[e.post_render_callbacks.length-1]!==o){const a=e.post_render_callbacks.indexOf(o);a>=0&&e.post_render_callbacks.splice(a,1),e.post_render_callbacks.push(o)}}else{const a=()=>{this.onPostRender(e,this.timedObjectsBuffer,this.timesBuffer)};this.contextPostRenderCallbacks.set(e,a),e.post_render_callbacks.push(a)}t.traverse(a=>{a.layers.disableAll(),a.layers.enable(2)}),t.renderOrder=999999,t[_R]=n,t.castShadow=!1,t.receiveShadow=!1,t.isGizmo=!0,this.timedObjectsBuffer.push(t),this.timesBuffer.push(Ot.Current.time.realtimeSinceStartup+i),e.scene.add(t)}static onBeforeRender(e,t){this.tmuiNeedsUpdate&&(this.tmuiNeedsUpdate=!1,Zi.update());for(let i=0;i<t.length;i++){const n=t[i];if(e.mainCamera&&n instanceof Zi.MeshUIBaseElement){if(Up(n))continue;const r=e.isInVR,o=!1,a=!r;a_(n,e.mainCamera,o,a)}}}static onPostRender(e,t,i){const n=e.time.realtimeSinceStartup;for(let r=t.length-1;r>=0;r--){const o=t[r];n>=i[r]-1e-6&&(t.splice(r,1),i.splice(r,1),o.removeFromParent(),Up(o)!=!0&&o[_R].push(o))}}}u(pn,"familyName","needle-gizmos"),u(pn,"linesCache",[]),u(pn,"circlesCache",[]),u(pn,"spheresCache",[]),u(pn,"boxesCache",[]),u(pn,"arrowHeadsCache",[]),u(pn,"mesh",[]),u(pn,"textLabelCache",[]),u(pn,"timedObjectsBuffer",new Array),u(pn,"timesBuffer",new Array),u(pn,"contextPostRenderCallbacks",new Map),u(pn,"contextBeforeRenderCallbacks",new Map),u(pn,"tmuiNeedsUpdate",!1);const xl=ie("debugphysics"),FF=new Wr;class Yc{constructor(){u(this,"ray");u(this,"cam");u(this,"screenPoint");u(this,"raycaster");u(this,"results");u(this,"targets");u(this,"recursive",!0);u(this,"minDistance");u(this,"maxDistance");u(this,"lineThreshold");u(this,"layerMask");u(this,"ignore");u(this,"testObject");u(this,"useAcceleratedRaycast")}screenPointFromOffset(e,t){this.screenPoint===void 0&&(this.screenPoint=new Z),this.screenPoint.x=e/window.innerWidth*2-1,this.screenPoint.y=-(t/window.innerHeight)*2+1}setLayer(e){FF.set(e),this.layerMask=FF}setMask(e){this.layerMask||(this.layerMask=new Wr);const t=this.layerMask;t?t.mask=e:this.layerMask=e}}u(Yc,"AllLayers",4294967295);class SD{constructor(e,t,i){u(this,"distance");u(this,"point");u(this,"object");this.object=e,this.distance=t,this.point=i}}const JS=class{constructor(e){u(this,"context");u(this,"engine");u(this,"raycaster",new Nd);u(this,"defaultRaycastOptions",new Yc);u(this,"targetBuffer",new Array(1));u(this,"defaultThresholds",{Mesh:{},Line:{threshold:-1},LOD:{},Points:{threshold:0},Sprite:{}});u(this,"sphereResults",new Array);u(this,"sphereMask",new Wr);u(this,"sphere",new _n);u(this,"tempBoundingBox",new Si);this.context=e}static get raycasting(){return this._raycasting>0}raycastPhysicsFast(e,t=void 0,i=1/0,n=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycast(e,t,{maxDistance:i,solid:n}))??null}raycastPhysicsFastAndGetNormal(e,t=void 0,i=1/0,n=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycastAndGetNormal(e,t,{maxDistance:i,solid:n}))??null}sphereOverlapPhysics(e,t){var i;return((i=this.context.physics.engine)==null?void 0:i.sphereOverlap(e,t))??null}sphereOverlap(e,t,i=!0,n=!1,r=null){if(this.sphereResults.length=0,!this.context.scene)return this.sphereResults;const o=this.sphereMask;o.enableAll(),o.disable(2);for(const a of this.context.scene.children)this.intersectSphere(a,e,t,o,this.sphereResults,i,n,r);return this.sphereResults.sort((a,l)=>a.distance-l.distance)}raycastFromRay(e,t=null){const i=t??this.defaultRaycastOptions;i.ray=e;const n=this.raycast(i);return i===this.defaultRaycastOptions&&(i.ray=void 0),n}raycast(e=null){xl&&performance.mark("raycast.start"),e||(e=this.defaultRaycastOptions);const t=e.screenPoint??this.context.input.mousePositionRC,i=e.raycaster??this.raycaster;if(i.near=e.minDistance??0,i.far=e.maxDistance??1/0,i.params=this.defaultThresholds,e.lineThreshold===void 0&&(e.lineThreshold=-1),i.params.Line={threshold:e.lineThreshold},e.ray)i.ray.copy(e.ray);else{const a=e.cam??this.context.mainCamera;if(!a)return xl&&console.error("Can not perform raycast - no main camera found"),this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),this.defaultRaycastOptions.results??[];const l=this.context.xrCamera;this.context.isInXR&&l instanceof WP&&l.cameras.length>0?i.setFromCamera(t,l.cameras[0]):i.setFromCamera(t,a)}let n=e.targets;n||(n=this.targetBuffer,n.length=1,n[0]=this.context.scene);let r=e.results;this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),r||(this.defaultRaycastOptions.results||(this.defaultRaycastOptions.results=new Array),r=this.defaultRaycastOptions.results),e.layerMask!==void 0?e.layerMask instanceof Wr?i.layers.mask=e.layerMask.mask:i.layers.mask=e.layerMask:(i.layers.enableAll(),i.layers.disable(2)),xl&&(At.DrawRay(i.ray.origin,i.ray.direction,16711680,2),console.time("raycast")),r.length=0,JS._raycasting++,this.intersect(this.raycaster,n,r,e),r.sort((a,l)=>a.distance-l.distance);const o=e.ignore;return o!==void 0&&o.length>0&&(r=r.filter(a=>!o.includes(a.object))),JS._raycasting--,xl&&(console.timeEnd("raycast"),console.warn("#"+this.context.time.frame+", hits:",r!=null&&r.length?[...r]:"nothing"),performance.mark("raycast.end"),performance.measure("raycast","raycast.start","raycast.end")),r}intersect(e,t,i,n){var r,o,a;for(const l of t){if(!l||l.visible===!1||At.isGizmo(l)||n.lineThreshold!==void 0&&n.lineThreshold<0&&l instanceof Rn)continue;let c=!0;const h=l,d=h.geometry;if(n.testObject){const f=(r=n.testObject)==null?void 0:r.call(n,l);if(f===!1)continue;f==="continue in children"&&(c=!1)}if(c&&(d&&UF(d)||(c=!1)),c){const f=Wp(l);f&&(h.geometry=f);const p=i.length;let m=!0;n.precise===!1&&(m=!1),m||(m=((a=(o=d.getAttribute("position"))==null?void 0:o.array)==null?void 0:a.length)<64),h instanceof Kg&&(m=!1),!m&&Qse(h,e,i)||(n.useAcceleratedRaycast!==!1?uS.runMeshBVHRaycast(e,h,i,this.context):e.intersectObject(h,!1,i)),xl&&i.length!=p&&At.DrawWireMesh({mesh:l,depthTest:!1,duration:.2,color:f?8969557:7798784}),h.geometry=d}n.recursive!==!1&&this.intersect(e,l.children,i,n)}return i}intersectSphere(e,t,i,n,r,o,a,l){let c=e&&e.isMesh&&e.layers.test(n)&&!At.isGizmo(e);c&&(c=e.visible),c&&(c=!(e instanceof Rn)),c&&(c=!(e instanceof Kg));const h=e,d=h.geometry;if(c&&l){const f=l(e);if(f===!1)return;f==="continue in children"&&(c=!1)}if(d&&UF(d)||(c=!1),c){if(a){const f=this.sphere;f.center.copy(t),f.radius=i;const p=r.length;if(uS.runMeshBVHRaycast(this.sphere,h,r,this.context),p!=r.length&&!o)return}else if(d.boundingBox||d.computeBoundingBox(),d.boundingBox){h.matrixWorldNeedsUpdate&&h.updateWorldMatrix(!1,!1);const f=this.tempBoundingBox.copy(d.boundingBox).applyMatrix4(h.matrixWorld),p=this.sphere;if(p.center.copy(t),p.radius=i,p.intersectsBox(f)){const m=Qt(e),v=m.distanceTo(p.center),y=new SD(e,v,m);if(r.push(y),!o)return}}}if(e.children)for(const f of e.children){const p=r.length;if(this.intersectSphere(f,t,i,n,r,o,a,l),p!=r.length&&!o)return}}};let Bg=JS;u(Bg,"_raycasting",0);function UF(s){return!(s.index&&s.index.array.length<3)}const wf=new _n,dx=new Ar,Vse=new Ht;function Qse(s,e,t){const i=s._computeIntersections;if(!i)return!1;let n=s["_computeIntersections:Needle"];return n||(n=s["_computeIntersections:Needle"]=function(r,o,a){const l=this,c=l.geometry.boundingSphere;if(c){if(l instanceof Kg){dx.setFromNormalAndCoplanarPoint(yt(0,1,0),yt(0,-l.position.y,0)),dx.applyMatrix4(l.matrixWorld,Vse);const d=r.ray.intersectPlane(dx,yt());if(d){wf.copy(c),wf.applyMatrix4(l.matrixWorld);const p=yt(d).sub(r.ray.origin).length(),m=wf.radius*.5;p<m&&o.push({distance:p,point:d,object:l,normal:dx.normal.clone()})}return}wf.copy(c),wf.applyMatrix4(l.matrixWorld);const h=r.ray.intersectSphere(wf,yt());if(h){const d=yt(h).sub(r.ray.origin),f=d.length();if(f>wf.radius){const p=d.clone().normalize();o.push({distance:f,point:h,object:l,normal:p})}}}}),s._computeIntersections=n,e.intersectObject(s,!1,t),s._computeIntersections=i,!0}var uS;(function(s){function e(g,_,A,b){var C,T,M;if(!_.geometry||!_.geometry.hasAttribute("position"))return!1;const E=_.geometry;if(_!=null&&_.isSkinnedMesh){const R=_,S=R.bvhNeedsUpdate;if(!R.staticGenerator)a(),r&&(R.staticGenerator=new r(_),R.staticGenerator.applyWorldTransforms=!1,R.staticGeometry=R.staticGenerator.generate(),E.boundsTree=o==null?void 0:o.call(R.staticGeometry),R.staticGeometryLastUpdate=performance.now()+Math.random()*200,R.autoUpdateMeshBVH===void 0&&(R.autoUpdateMeshBVH=!1));else if(E.boundsTree&&(R.autoUpdateMeshBVH===!0||S===!0)){const I=performance.now(),L=I-R.staticGeometryLastUpdate;(S||L>100)&&(R.bvhNeedsUpdate=!1,R.staticGeometryLastUpdate=I,(C=R.staticGenerator)==null||C.generate(R.staticGeometry),E.boundsTree.refit())}}else if(!E.boundsTree){c||y();let R=!0;if((b.xr||E[p]===!1||(T=E.getAttribute("position"))!=null&&T.isInterleavedBufferAttribute||E.index&&((M=E.index)!=null&&M.isInterleavedBufferAttribute))&&(R=!1),R&&d){if(E[f]===void 0){let S=null;if(v.length>0){const I=v.shift();I&&!I.running&&(S=I)}if(!S&&m.length<3&&(S=new d,m.push(S)),S!=null&&!S.running){xl&&console.log("<<<< worker start",S),E[f]="queued",performance.mark("bvh.create.start");const I=E.clone();S.generate(I).then(L=>{E[f]="done",E.boundsTree=L}).catch(L=>{E[f]="failed - "+(L==null?void 0:L.message),E[p]=!1}).finally(()=>{xl&&console.log(">>>>> worker done"),v.push(S),I.dispose(),performance.mark("bvh.create.end"),performance.measure("bvh.create (worker)","bvh.create.start","bvh.create.end")})}else xl&&console.warn("No worker available")}}else(!h||!R)&&(a(),n&&(performance.mark("bvh.create.start"),E.boundsTree=new n(E),performance.mark("bvh.create.end"),performance.measure("bvh.create","bvh.create.start","bvh.create.end")))}if(g instanceof Nd){const R=g,S=_.raycast;i&&E.boundsTree?(_.acceleratedRaycast||(_.acceleratedRaycast=i.bind(_)),_.raycast=_.acceleratedRaycast):xl&&console.warn("No bounds tree found for mesh",_.name);const I=R.firstHitOnly;return R.firstHitOnly=!1,R.intersectObject(_,!1,A),R.firstHitOnly=I,_.raycast=S,!0}else if(g instanceof _n){const R=E.boundsTree;if(R){const S=g;if(l.copy(_.matrixWorld).invert(),S.applyMatrix4(l),R.intersectsSphere(S)){const L=Qt(_),U=L.distanceTo(S.center),D=new SD(_,U,L);A.push(D)}}return!0}return!1}s.runMeshBVHRaycast=e;let t=!1,i=null,n=null,r=null,o=null;function a(){t||(t=!0,jc(()=>import("./index-ea92657e.js"),["./index-ea92657e.js","./MeshBVH-2c0d8f44.js"],import.meta.url).then(g=>{i=g.acceleratedRaycast,n=g.MeshBVH,r=g.StaticGeometryGenerator,o=g.computeBoundsTree}).catch(g=>{(xl||Xe())&&console.warn("Failed to load mesh bvh library")}))}const l=new fe;let c=!1,h=!1,d=null;const f=Symbol("Needle:MeshBVH-Worker"),p=Symbol("Needle:MeshBVH-CanUseWorker"),m=[],v=[];function y(){c=!0,h=!0,jc(()=>import("./GenerateMeshBVHWorker-5857f93c.js"),["./GenerateMeshBVHWorker-5857f93c.js","./MeshBVH-2c0d8f44.js"],import.meta.url).then(g=>{d=g.GenerateMeshBVHWorker}).catch(g=>{(xl||Xe())&&console.warn("Failed to setup mesh bvh worker")}).finally(()=>{h=!1})}})(uS||(uS={}));const NF=Symbol("gltf-loader-internal-usage-tracker"),jse=ie("debugusers"),NA=class{constructor(e){u(this,"parser");u(this,"_getDependency");u(this,"_loadingId");u(this,"_loadedObjects",new Set);this.parser=e,this._getDependency=this.parser.getDependency,this._loadingId=Date.now().toString()}get name(){return"NEEDLE_internal_usage_tracker"}static isLoading(e){return NA._loadingProcesses>0}beforeRoot(){NA._loadingProcesses++;const e=this,t=this._getDependency;return this.parser.getDependency=function(i,n){const r=t.call(this,i,n);return r.then(o=>(o&&(e._loadedObjects.add(o),o[NF]=e._loadingId),o)),r},null}afterRoot(e){NA._loadingProcesses--,this.parser.getDependency=this._getDependency;for(const t of this._loadedObjects)delete t[NF],t instanceof ge&&(t.parent||t instanceof le&&setTimeout(()=>{jse&&console.warn("> GLTF LOADER: Mesh not used in scene!",t),t.material=null,t.geometry=null},1e3));return null}};let gA=NA;u(gA,"_loadingProcesses",0);class t5{constructor(){window.addEventListener("unhandledrejection",e=>{var i;if(e.defaultPrevented)return;const t=(i=e==null?void 0:e.reason)==null?void 0:i.path;if(t){const n=t[0];n&&n.tagName==="IMG"&&(console.warn(`Could not load image:
`+n.src),e.preventDefault())}})}}const cE=ie("trackresources");function i5(){return cE==="dispose"}let qp=!0;cE===0&&(qp=!1);function Wse(s){qp=s}function n5(){return qp}const s5=Symbol("disposable");function CD(s,e){s&&(s[s5]=e,pp&&console.warn("Set disposable",e,s))}const r5=Symbol("disposed");function qse(s){return s[r5]===!0}function rn(s){var e;if(s){if(s[s5]===!1){pp&&console.warn("Object is marked as not disposable",s);return}if(s[r5]=!0,s instanceof Ks)rn(s.environment),rn(s.background),rn(s.customDepthMaterial),rn(s.customDistanceMaterial);else if(s instanceof ga)rn(s.geometry),rn(s.material),rn(s.skeleton),rn(s.bindMatrix),rn(s.bindMatrixInverse),rn(s.customDepthMaterial),rn(s.customDistanceMaterial),s.geometry=null,s.material=null,s.visible=!1;else if(s instanceof le)rn(s.geometry),rn(s.material),rn(s.customDepthMaterial),rn(s.customDistanceMaterial),s.geometry=null,s.material=null,s.visible=!1;else if(s instanceof pt){Lm(s);for(const t of Object.keys(s.attributes)){const i=s.attributes[t];rn(i)}}else if(s instanceof ot||s instanceof vo)pp&&console.warn("BufferAttribute dispose not supported",s.count);else if(s instanceof Array)for(const t of s)t instanceof Vt&&rn(t);else if(s instanceof Vt){Lm(s);for(const i of Object.keys(s)){const n=s[i];n instanceof Pt&&(rn(n),s[i]=null)}const t=s.uniforms;if(t)for(const i of Object.keys(t)){const n=t[i];n instanceof Pt?(rn(n),t[i]=null):n instanceof Se&&(rn(n.value),n.value=null)}}else s instanceof Pt?(Lm(s),Lm(s.source),((e=s.source)==null?void 0:e.data)instanceof ImageBitmap&&Lm(s.source.data)):s instanceof Gp?(Lm(s.boneTexture),s.boneTexture=null):s instanceof Pp||!(s instanceof ge)&&pp&&console.warn("Unknown object type",s)}}function Lm(s){s&&((pp||i5()||cE)&&console.warn("🧨 FREE",s),s instanceof ImageBitmap?s.close():s instanceof qh?s.data=null:s.dispose())}function o5(s){(s instanceof le||s instanceof ga)&&(s.material=null,s.geometry=null)}const Xse=new Set;function ED(s,e,t=null,i){if(i||(i=Xse,i.clear()),!s)return i;const n=s[y0];if(n)for(const r of n)i.has(r)||(t==null?void 0:t.call(null,r))!==!1&&(i.add(r),e&&ED(r,!0,t,i));return i}function Yse(s){return s[Qy]}const pp=ie("debugresourceusers")||ie("debugmemory"),y0=Symbol("needle-resource-users"),Qy=Symbol("needle-resource-users-count");function to(s,e){sE(s,e,function(t,i){qp&&!Bg.raycasting&&(dS(y0,this,t,!1),dS(y0,this,i,!0))})}qp&&(to(le.prototype,"material"),to(le.prototype,"geometry"),to(Vt.prototype,"map"),to(Vt.prototype,"bumpMap"),to(Vt.prototype,"alphaMap"),to(Vt.prototype,"normalMap"),to(Vt.prototype,"displacementMap"),to(Vt.prototype,"roughnessMap"),to(Vt.prototype,"metalnessMap"),to(Vt.prototype,"emissiveMap"),to(Vt.prototype,"specularMap"),to(Vt.prototype,"envMap"),to(Vt.prototype,"lightMap"),to(Vt.prototype,"aoMap"),to(Vt.prototype,"gradientMap"));function Kse(s){if(qp===!1)return;const e=s[y0];if(e)for(const t of e)dS(y0,t,s,!1)}qp&&sE(Vt.prototype,"dispose",function(){Kse(this)});let bR=0;function dS(s,e,t,i){if(bR>0)return;if(Array.isArray(t)){for(const r of t)dS(s,e,r,i);return}if(!t)return;let n=t[s];if(n||(n=new Set),i){if(e&&!n.has(e)){n.add(e);let r=t[Qy]||0;r+=1,t[Qy]=r,pp&&console.warn(`🟢 Added user of "${t.type}"`,e,t,r,"users:",n)}}else if(e&&n.has(e)){n.delete(e);let r=t[Qy]||0;r>0&&(r-=1,t[Qy]=r),pp&&console.warn(`🔴 Removed user of "${t.type}"`,e,t,r,"users:",n),r<=0&&(gA.isLoading(t)||(cE&&console.warn(`🔴 Removed all user of "${t.type}"`,t),i5()&&rn(t)))}t[s]=n}try{sE(eh.prototype,"render",function(){bR++},function(){bR--})}catch(s){console.warn("Could not wrap WebGLRenderer.render",s)}var tv;(function(s){s.Added="component-added",s.Removing="removing-component"})(tv||(tv={}));const zF=ie("debugcomponentevents");class f_{static addComponentLifecylceEventListener(e,t){this.eventListeners.has(e)&&this.eventListeners.set(e,[]);let i=this.eventListeners.get(e);i||(i=[]),i.push(t),this.eventListeners.set(e,i),zF&&console.log("Added event listener for "+e,this.eventListeners)}static removeComponentLifecylceEventListener(e,t){const i=this.eventListeners.get(e);if(!i)return;const n=i.indexOf(t);n<0||i.splice(n,1)}static dispatchComponentLifecycleEvent(e,t){const i=this.eventListeners.get(e);if(zF&&console.log("Dispatching event "+e,i),!!i)for(const n of i)n(t)}}u(f_,"eventListeners",new Map);const A0=Symbol("NEEDLE_NEED_UPDATE_INSTANCE"),a5=Symbol("isUsingInstancing"),l5=Symbol("instancingRenderer"),jy=Symbol("instancingAutoUpdateBounds");class Ya{static isUsingInstancing(e){return e[a5]===!0}static getRenderer(e){return e[l5]||null}setAutoUpdateBounds(e,t){const i=Ya.getRenderer(e);i&&(i[jy]=t)}static markDirty(e,t=!0){if(e&&(this.isUsingInstancing(e)&&(e[A0]=!0,e.matrixWorldNeedsUpdate=!0),t))for(const i of e.children)Ya.markDirty(i,!0)}}function Dg(s,e){try{e?s(e):s()}catch(t){return console.error(t),!1}return!0}const xR=ie("debugnewscripts"),Jse=ie("debughierarchy"),Cn=[];function Zse(){return Cn.length>0}function fS(s){if(!(s.new_scripts.length<=0)){if(xR&&console.log("Register new components",s.new_scripts.length,[...s.new_scripts],s.alias?"element: "+s.alias:s.hash,s),s.new_scripts_pre_setup_callbacks.length>0){for(const e of s.new_scripts_pre_setup_callbacks)e&&e();s.new_scripts_pre_setup_callbacks.length=0}Cn.length=0,s.new_scripts.length>0&&Cn.push(...s.new_scripts),s.new_scripts.length=0;for(let e=0;e<Cn.length;e++)try{const t=Cn[e];if(t.isComponent!==!0){(Xe()||xR)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,t),Cn.splice(e,1),e--;continue}if(t.destroyed)continue;if(!t.gameObject){console.warn(`Component can not be initialized: no GameObject assigned.
Did you add and remove a component in the same frame?`),Cn.splice(e,1),e--;continue}t.context=s,vA(t.gameObject),TD(t,s)}catch(t){console.error(t),jh(Cn[e],s),Cn.splice(e,1),e--}for(let e=0;e<Cn.length;e++)try{const t=Cn[e];if(t.destroyed){jh(Cn[e],s),Cn.splice(e,1),e--;continue}if(t.registering)try{t.registering()}catch(i){console.error(i)}t.__internalAwake!==void 0&&(t.gameObject||console.error("Calling awake for a component without a GameObject",t,t.gameObject),vA(t.gameObject),t.activeAndEnabled&&Dg(t.__internalAwake.bind(t)))}catch(t){console.error(t),jh(Cn[e],s),Cn.splice(e,1),e--}for(let e=0;e<Cn.length;e++)try{const t=Cn[e];if(t.destroyed||t.enabled===!1||(vA(t.gameObject),t.activeAndEnabled===!1))continue;t.__internalEnable!==void 0&&(t.enabled=!0,Dg(t.__internalEnable.bind(t)))}catch(t){console.error(t),jh(Cn[e],s),Cn.splice(e,1),e--}for(let e=0;e<Cn.length;e++)try{const t=Cn[e];if(t.destroyed||!t.gameObject)continue;s.new_script_start.push(t)}catch(t){console.error(t),jh(Cn[e],s),Cn.splice(e,1),e--}Cn.length=0;for(const e of s.new_scripts_post_setup_callbacks)e&&e();s.new_scripts_post_setup_callbacks.length=0}}function $se(s){s&&(s.__internalDisable(!0),jh(s,s.context))}function c5(s,e){for(let t=0;t<s.new_script_start.length;t++)try{const i=s.new_script_start[t];if(e!==void 0&&i.gameObject!==e||i.destroyed||i.activeAndEnabled===!1)continue;Dg(i.__internalAwake.bind(i)),i.enabled&&(Dg(i.__internalEnable.bind(i)),Dg(i.__internalStart.bind(i)),s.new_script_start.splice(t,1),t--)}catch(i){console.error(i),jh(s.new_script_start[t],s),s.new_script_start.splice(t,1),t--}}function TD(s,e){e.scripts.indexOf(s)===-1&&(e.scripts.push(s),s.earlyUpdate&&e.scripts_earlyUpdate.push(s),s.update&&e.scripts_update.push(s),s.lateUpdate&&e.scripts_lateUpdate.push(s),s.onBeforeRender&&e.scripts_onBeforeRender.push(s),s.onAfterRender&&e.scripts_onAfterRender.push(s),s.onPausedChanged&&e.scripts_pausedChanged.push(s),kT(s,null)&&e.new_scripts_xr.push(s),kT(s,"immersive-vr")&&e.scripts_immersive_vr.push(s),kT(s,"immersive-ar")&&e.scripts_immersive_ar.push(s))}function jh(s,e){Ra(s,e.new_scripts),Ra(s,e.new_script_start),Ra(s,e.scripts),Ra(s,e.scripts_earlyUpdate),Ra(s,e.scripts_update),Ra(s,e.scripts_lateUpdate),Ra(s,e.scripts_onBeforeRender),Ra(s,e.scripts_onAfterRender),Ra(s,e.scripts_pausedChanged),Ra(s,e.new_scripts_xr),Ra(s,e.scripts_immersive_vr),Ra(s,e.scripts_immersive_ar),e.stopAllCoroutinesFrom(s)}function Ra(s,e){const t=e.indexOf(s);t>=0&&e.splice(t,1)}function kT(s,e){var t;if(s){const i=s;if(i.onBeforeXR||i.onEnterXR||i.onUpdateXR||i.onLeaveXR||i.onXRControllerAdded||i.onXRControllerRemoved)return!(e!=null&&((t=i.supportsXR)==null?void 0:t.call(i,e))===!1)}return!1}function yw(s){if(s||(s=xi.Current.scene),!s){console.trace("Invalid call - no current context.");return}const e=wv(s);h5(s,e,!0)||(xR||Xe()?console.error(`Error updating hierarchy
Do you have circular references in your project? <a target="_blank" href="https://docs.needle.tools/circular-reference"> Click here for more information.`,s):console.error('Failed to update active state in hierarchy of "'+s.name+'"',s),console.warn(" ↑ this error might be caused by circular references. Please make sure you don't have files with circular references (e.g. one GLB 1 is loading GLB 2 which is then loading GLB 1 again)."))}function h5(s,e,t,i=0){if(i>1e3)return console.warn("Hierarchy is too deep (> 1000 level) - will abort updating active state"),!1;const n=wv(s);if(e&&(e=n,e&&s.parent)){const l=s.parent;e=l[nu],e===void 0&&(l instanceof Ks||(e=!0))}const o=s[nu]!==e;s[nu]=e,o&&(Jse&&console.warn("ACTIVE CHANGE",s.name,n,s.visible,e,"changed?"+o,s),t&&ere(s,l=>{e?l.enabled&&(Dg(l.__internalAwake.bind(l)),l.enabled&&(l.__didEnable=!0,l.onEnable())):l.__didAwake&&l.enabled&&(l.__didEnable=!1,l.onDisable())}));let a=!0;if(s.children){const l=i+1;for(const c of s.children)h5(c,e,t,l)===!1&&(a=!1)}return a}function vA(s){let e=!0,t=s,i=!1;for(;t&&t;){if(t.type==="Scene"&&(i=!0),!wv(t)){e=!1;break}t=t.parent}if(!s){console.error("GO is null");return}s[nu]=e&&i}function ere(s,e){var t;if((t=s.userData)!=null&&t.components)for(const i of s.userData.components)e(i)}const Aw=new Map,u5=Symbol("prewarmFlag"),wR=Symbol("waitingForPrewarm"),SR=ie("debugprewarm");function tre(s,e){if(!s||s[u5]===!0||s[wR]===!0)return;Aw.has(e)||Aw.set(e,[]),s[wR]=!0,Aw.get(e).push(s),SR&&console.debug("register prewarm",s.name)}let GF=null,HF=null;function ire(s){if(!s)return;const e=Aw.get(s);if(!(e!=null&&e.length))return;const t=s.mainCamera;if(t){SR&&console.log("prewarm",e.length,"objects",[...e]);const i=s.renderer;if(i.compile){const n=s.scene;i.compile(n,t),GF??(GF=new VP(64)),HF??(HF=new HP(.001,9999999,GF)),HF.update(i,n);for(const r of e)r[u5]=!0,r[wR]=!1;e.length=0,SR&&console.log("prewarm done")}}}const nre=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function sre(s){return typeof s=="string"&&nre.test(s)}const ur=[];for(let s=0;s<256;++s)ur.push((s+256).toString(16).slice(1));function rre(s,e=0){return ur[s[e+0]]+ur[s[e+1]]+ur[s[e+2]]+ur[s[e+3]]+"-"+ur[s[e+4]]+ur[s[e+5]]+"-"+ur[s[e+6]]+ur[s[e+7]]+"-"+ur[s[e+8]]+ur[s[e+9]]+"-"+ur[s[e+10]]+ur[s[e+11]]+ur[s[e+12]]+ur[s[e+13]]+ur[s[e+14]]+ur[s[e+15]]}function ore(s){if(!sre(s))throw TypeError("Invalid UUID");let e;const t=new Uint8Array(16);return t[0]=(e=parseInt(s.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(s.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(s.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(s.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(s.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}function are(s){s=unescape(encodeURIComponent(s));const e=[];for(let t=0;t<s.length;++t)e.push(s.charCodeAt(t));return e}const lre="6ba7b810-9dad-11d1-80b4-00c04fd430c8",cre="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function hre(s,e,t){function i(n,r,o,a){var l;if(typeof n=="string"&&(n=are(n)),typeof r=="string"&&(r=ore(r)),((l=r)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+n.length);if(c.set(r),c.set(n,r.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,o){a=a||0;for(let h=0;h<16;++h)o[a+h]=c[h];return o}return rre(c)}try{i.name=s}catch{}return i.DNS=lre,i.URL=cre,i}function ure(s,e,t,i){switch(s){case 0:return e&t^~e&i;case 1:return e^t^i;case 2:return e&t^e&i^t&i;case 3:return e^t^i}}function FT(s,e){return s<<e|s>>>32-e}function dre(s){const e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof s=="string"){const o=unescape(encodeURIComponent(s));s=[];for(let a=0;a<o.length;++a)s.push(o.charCodeAt(a))}else Array.isArray(s)||(s=Array.prototype.slice.call(s));s.push(128);const i=s.length/4+2,n=Math.ceil(i/16),r=new Array(n);for(let o=0;o<n;++o){const a=new Uint32Array(16);for(let l=0;l<16;++l)a[l]=s[o*64+l*4]<<24|s[o*64+l*4+1]<<16|s[o*64+l*4+2]<<8|s[o*64+l*4+3];r[o]=a}r[n-1][14]=(s.length-1)*8/Math.pow(2,32),r[n-1][14]=Math.floor(r[n-1][14]),r[n-1][15]=(s.length-1)*8&4294967295;for(let o=0;o<n;++o){const a=new Uint32Array(80);for(let p=0;p<16;++p)a[p]=r[o][p];for(let p=16;p<80;++p)a[p]=FT(a[p-3]^a[p-8]^a[p-14]^a[p-16],1);let l=t[0],c=t[1],h=t[2],d=t[3],f=t[4];for(let p=0;p<80;++p){const m=Math.floor(p/20),v=FT(l,5)+ure(m,c,h,d)+f+e[m]+a[p]>>>0;f=d,d=h,h=FT(c,30)>>>0,c=l,l=v}t[0]=t[0]+l>>>0,t[1]=t[1]+c>>>0,t[2]=t[2]+h>>>0,t[3]=t[3]+d>>>0,t[4]=t[4]+f>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}const fre=hre("v5",80,dre),VF=fre;xi.registerCallback(yi.ContextCreated,s=>{const e=s.context;p5(e),d5(e)});const pS=ie("debugcomponents"),QF="eff8ba80-635d-11ec-90d6-0242ac120003";class Ls{constructor(e){u(this,"_originalSeed");u(this,"_seed");typeof e=="string"&&(e=Ls.hash(e)),this._originalSeed=e,this._seed=e}get seed(){return this._seed}set seed(e){this._seed=e}reset(){this._seed=this._originalSeed}generateUUID(e){if(typeof e=="string")return VF(e,QF);const t=this._seed;return this._seed-=1,VF(t.toString(),QF)}initialize(e){typeof e=="string"?this._seed=Ls.hash(e):this._seed=e}static createFromString(e){return new Ls(this.hash(e))}static hash(e){let t=0;for(let i=0;i<e.length;i++)t=e.charCodeAt(i)+((t<<5)-t);return t}}var Fp;(function(s){s.NewInstanceCreated="new-instance-created",s.InstanceDestroyed="instance-destroyed"})(Fp||(Fp={}));class pre{constructor(e){u(this,"guid");u(this,"dontSave");this.guid=e}}function p_(s,e,t=!0,i){if(!s)return;const n=s;if(ba(s,t),!e){console.warn("Can not send destroy: No networking connection provided",s.guid);return}if(!e.isConnected){Xe()&&console.debug("Can not send destroy: not connected",s.guid);return}let r=s.guid;if(!r&&n.uuid&&(r=n.uuid),!r){console.warn("Can not send destroy: failed to find guid",s);return}MD(r,e,i)}function MD(s,e,t){const i=new pre(s);(t==null?void 0:t.saveInRoom)===!1&&(i.dontSave=!0),e.send(Fp.InstanceDestroyed,i,Ga.Queued)}function d5(s){s.connection.beginListen(Fp.InstanceDestroyed,e=>{pS&&console.log("[Remote] Destroyed",s.scene,e);const t=A_(e.guid,s.scene);t&&ba(t)})}class mre{constructor(e,t,i){u(this,"filename");u(this,"hash");u(this,"size");this.filename=e,this.hash=t,this.size=i}}class f5{constructor(e,t){u(this,"guid");u(this,"originalGuid");u(this,"seed");u(this,"visible");u(this,"hostData");u(this,"dontSave");u(this,"parent");u(this,"position");u(this,"rotation");u(this,"scale");u(this,"preventCreation");u(this,"deleteStateOnDisconnect");this.originalGuid=e,this.guid=t}}function ID(s,e,t,i){var l,c;const n=s;if(!n.guid)return console.warn("Can not instantiate: No guid",n),null;if(e.context||(e.context=Ot.Current),!e.context)return console.error("Missing network instantiate options / reference to network connection in sync instantiate"),null;const r=e?{...e}:null,{instance:o,seed:a}=gre(n,e);if(o){const h=o;if(h.guid){pS&&console.log("[Local] new instance","gameobject:",o==null?void 0:o.guid);const d=new f5(n.guid,h.guid);d.seed=a,e.deleteOnDisconnect===!0&&(d.deleteStateOnDisconnect=!0),r&&(r.position&&(d.position={x:r.position.x,y:r.position.y,z:r.position.z}),r.rotation&&(d.rotation={x:r.rotation.x,y:r.rotation.y,z:r.rotation.z,w:r.rotation.w}),r.scale&&(d.scale={x:r.scale.x,y:r.scale.y,z:r.scale.z})),d.position||(d.position={x:h.position.x,y:h.position.y,z:h.position.z}),d.rotation||(d.rotation={x:h.quaternion.x,y:h.quaternion.y,z:h.quaternion.z,w:h.quaternion.w}),d.scale||(d.scale={x:h.scale.x,y:h.scale.y,z:h.scale.z}),d.visible=n.visible,r!=null&&r.parent&&(typeof r.parent=="string"?d.parent=r.parent:d.parent=r.parent.guid),d.hostData=t,i===!1&&(d.dontSave=!0),!((l=e==null?void 0:e.context)==null?void 0:l.connection)&&Xe()&&console.debug("Object will be instantiated but it will not be synced: not connected",n.guid),(c=e==null?void 0:e.context)==null||c.connection.send(Fp.NewInstanceCreated,d)}else console.warn("Missing guid, can not send new instance event",h)}return o}function hE(){return Math.random()*9999999}function p5(s){s.connection.beginListen(Fp.NewInstanceCreated,async e=>{const t=await vre(e.originalGuid,s.scene);if(e.preventCreation===!0)return;if(!t){console.warn("could not find object that was instantiated: "+e.guid);return}const i=new Gl;e.position&&(i.position=new w(e.position.x,e.position.y,e.position.z)),e.rotation&&(i.rotation=new xe(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w)),e.scale&&(i.scale=new w(e.scale.x,e.scale.y,e.scale.z)),i.parent=e.parent,e.seed&&(i.idProvider=new Ls(e.seed)),i.visible=e.visible,i.context=s,pS&&s.alias&&console.log("[Remote] instantiate in: "+s.alias);const n=Sv(t,i);n&&(e.parent==="scene"&&s.scene.add(n),pS&&console.log("[Remote] new instance","gameobject:",n==null?void 0:n.guid,t))})}function gre(s,e){const t=hE(),i=e??new Gl;i.idProvider=new Ls(t);const n=Sv(s,i);return{seed:t,instance:n}}const m5={};function g5(s,e){m5[s]=e}async function vre(s,e){const t=m5[s];if(t!=null){const i=await t(s);if(i)return i}return v5(s,e)}function v5(s,e){if(e===null||!s)return null;if(e.guid===s)return e;if(e.children)for(const t of e.children){const i=v5(s,t);if(i)return i}return null}const m_=ie("gizmos"),qs=ie("debugextension"),UT=ie("debugtypes");class yre{constructor(){u(this,"_types",new Map);UT&&console.warn("TypeStore: Created",this)}add(e,t){UT&&console.warn("ADD TYPE",e);const i=this._types.get(e);i?UT&&i!==t&&console.warn("Type name exists multiple times in your project and may lead to runtime errors:",e):this._types.set(e,t)}get(e){return this._types.get(e)||null}getKey(e){for(const[t,i]of this._types)if(i===e)return t;return null}}const Are=Symbol("BuiltInType"),X=new yre,_re=function(s){X.get(s.name)||X.add(s.name,s)},RD=ie("debugresolvedependencies"),bre=["/extensions/","extensions/"],xre=[{prefix:"/nodes/",dependencyName:"node"},{prefix:"/meshes/",dependencyName:"mesh"},{prefix:"/materials/",dependencyName:"material"},{prefix:"/textures/",dependencyName:"texture"},{prefix:"/animations/",dependencyName:"animation"},{prefix:"nodes/",dependencyName:"node"},{prefix:"meshes/",dependencyName:"mesh"},{prefix:"materials/",dependencyName:"material"},{prefix:"textures/",dependencyName:"texture"},{prefix:"animations/",dependencyName:"animation"}];async function PD(s,e){RD&&console.log(s,e);const t=[];CR(xre,s,e,t);const i=await Promise.all(t);return typeof e=="string"&&i.length===1?i[0]:i}function y5(s,e){return!s||!e?!1:s["needle:identifier"]!=null&&e["needle:identifier"]!=null?s["needle:identifier"]===e["needle:identifier"]:!1}function wre(s,e){s["needle:identifier"]=e}function CR(s,e,t,i){if(typeof t=="object"&&t!==void 0&&t!==null)for(const n of Object.keys(t)){const r=t[n];if(typeof r=="string"){const o=jF(e,r);if(o!=null)typeof o.then=="function"?i.push(o.then(a=>t[n]=a)):t[n]=o;else{const a=WF(s,e,r);if(a){i.push(a.then(l=>(t[n]=l,l)));continue}}}else if(Array.isArray(r))for(let o=0;o<r.length;o++){const a=r[o],l=jF(e,a);if(l!==null){typeof l.then=="function"?i.push(l.then(c=>r[o]=c)):r[o]=l;continue}for(const c of s){const h=A5(c.prefix,a);if(h>=0){RD&&console.log(c,h,c.dependencyName),i.push(e.getDependency(c.dependencyName,h).then(d=>r[o]=d));break}}typeof a=="object"&&CR(s,e,a,i)}else typeof r=="object"&&CR(s,e,r,i)}else if(typeof t=="string"){const n=WF(s,e,t);n&&i.push(n)}}function jF(s,e){if(s&&s.plugins&&typeof e=="string"){for(const t of bre)if(e.startsWith(t)){let i=e.substring(t.length);const n=i.indexOf("/");n>=0&&(i=i.substring(0,n));const r=s.plugins[i];if(qs&&console.log(i,r),typeof(r==null?void 0:r.resolve)=="function"){const o=e.substring(t.length+i.length+1);return r.resolve(s,o)}break}}return null}function WF(s,e,t){for(const i of s){const n=A5(i.prefix,t);if(n>=0)return RD&&console.warn("GET DEPENDENCY",i,n,i.dependencyName),e.getDependency(i.dependencyName,n)}return null}function A5(s,e){if(typeof e=="string"&&e.startsWith(s)){const t=e.substring(s.length),i=Number.parseInt(t);if(i>=0)return i}return-1}const NT="NEEDLE_persistent_assets";function Sre(s){return(s==null?void 0:s.___persistentAsset)===!0}class Cre{constructor(e){u(this,"parser");this.parser=e}get name(){return NT}async afterRoot(e){var n,r;if(!((r=(n=this.parser)==null?void 0:n.json)!=null&&r.extensions))return;const t=this.parser.json.extensions[NT];if(!t)return;qs&&console.log(t);const i=new Array;for(const o of t==null?void 0:t.assets){const a=PD(this.parser,o);a&&i.push(a)}await Promise.all(i)}resolve(e,t){const i=Number.parseInt(t);if(i>=0){qs&&console.log(t);const n=e.json.extensions[NT];if(n){const r=n==null?void 0:n.assets[i];if(r&&typeof r=="object"){r.___persistentAsset=!0;const o=r.__type;o&&X.get(o)}return r}}return null}}const mc=ie("debugserializer");class Ere{constructor(){u(this,"typeMap",new Map)}register(e,t){if(this.typeMap.has(e)){const i=this.typeMap.get(e);if(i===t)return;mc&&console.warn("Type: "+e+" is already registered",t,i)}mc&&console.log("Register type serializer",t.name,t,e),this.typeMap.set(e,t)}getSerializer(e){if(e)return this.typeMap.get(e)}getSerializerForConstructor(e,t=0){if(t>20)return;if(!e||!e.constructor){mc&&console.log("invalid type");return}const i=e.name,n=this.getSerializer(e);if(n!==void 0)return mc&&console.log("FOUND SERIALIZER",n==null?void 0:n.name,e.name,e.constructor.name,"for type: "+i,n,e,this.typeMap),n;const r=Object.getPrototypeOf(e);if(r&&r!==e){const o=this.getSerializerForConstructor(r,++t);if(o){const a=r.constructor||r.prototype;mc&&console.log("FOUND SERIALIZER(in constructor) "+a.constructor.name,a.name,a,o),this.register(a,o)}return o}mc&&console.warn("No serializer found for "+i,e,e.name,e.constructor.name)}}const mS=new Ere;class tl{constructor(e,t){u(this,"name");if(this.name=t,Array.isArray(e))for(const i of e)mS.register(i,this);else mS.register(e,this)}}class Tre{constructor(){u(this,"isDevMode",So());u(this,"cache",{})}registerDefinedKeys(e,t){if(this.isDevMode&&this.cache[e]===void 0){this.cache[e]=Object.keys(t);const i=t;i.$serializedTypes&&Object.keys(i.$serializedTypes)&&this.cache[e].push(...Object.keys(i.$serializedTypes)),mc&&console.log("registerDefinedKeys for "+e,this.cache[e],t)}}getDefinedKey(e,t){return this.cache[e]===void 0?!1:this.cache[e].includes(t)}}class BD{constructor(e){u(this,"root");u(this,"gltf");u(this,"gltfId");u(this,"object");u(this,"target");u(this,"nodeId");u(this,"nodeToObject");u(this,"objectToNode");u(this,"context");u(this,"path");u(this,"type");u(this,"serializable");u(this,"implementationInformation");this.root=e}}function _5(s,e){const t=s.$serializedTypes;if(t===void 0)return null;const i={};for(const n in t){const r=s[n];if(r!=null&&typeof r=="object"){const o=mS.getSerializerForConstructor(r);if(o){i[n]=o.onSerialize(r,e);continue}}i[n]=r}return i.name=s.constructor.name,typeof s.guid=="string"&&(i.guid=s.guid),i}const _w=[];function b5(s,e){if(!s)return e;typeof s.$serializedTypes=="object"&&(e||(e={}),Object.assign(e,s.$serializedTypes));const t=Object.getPrototypeOf(s);return b5(t,e)}function gS(s,e,t){if(!s)return!1;if(t.target=s,s.onBeforeDeserialize!==void 0){const n=s.onBeforeDeserialize(e,t);if(typeof n=="boolean")return n}const i=b5(s);if(e){if(typeof e.guid=="string"&&(s.guid=e.guid),i)for(const n in i){let a=function(l){const h=l.type;return h?ER(o,h,t,void 0,s[n]):ER(o,l,t,void 0,s[n])};const r=i[n],o=e[n];if(mc&&console.log(n,o,s,r),!(s[n]!==void 0&&o===void 0)&&(t.type=void 0,t.path=n,t.serializable=r,!(s.onBeforeDeserializeMember!==void 0&&s.onBeforeDeserializeMember(n,o,t)===!0))){if(r===null)s[n]=o;else{if(Array.isArray(r))for(let l=0;l<r.length;l++){const c=r[l],h=a(c);if(h!==void 0||l===r.length-1){s[n]=h;break}}else s[n]=a(r);_w.length=0}s.onAfterDeserializeMember!==void 0&&s.onAfterDeserializeMember(n,o,t)}}Rre(s,e)}return Ire(s,e,t.implementationInformation),s.onAfterDeserialize!==void 0&&s.onAfterDeserialize(e,t),!0}const Mre=ie("noerrors");function Ire(s,e,t){var r,o;if(Mre||!e||!So()||!s||s.constructor&&s.constructor[Are]===!0)return;const i=(r=s.constructor)==null?void 0:r.name,n=Object.getOwnPropertyNames(e);for(const a of n){if(a==="sourceId")continue;const l=s[a];if(l==null)continue;const c=e[a];if((t==null?void 0:t.getDefinedKey(i,a))===!1){const h=a.charAt(0).toUpperCase()+a.slice(1);t.getDefinedKey(i,h)&&(Ec(os.Warn,'<strong>Please rename</strong> "'+h+'" to "'+a+'" in '+i),console.warn('Please use lowercase for field: "'+h+'" in '+i,c,s));continue}if(c!=null){if(typeof c=="object"&&(l===void 0||!l.isObject3D)){if(typeof c.node=="number"||typeof c.guid=="string"){if(c.could_not_resolve)continue;if(!(l!==void 0&&Object.keys(l).length>1)){Ec(os.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(Object3D)
${a}? : Object3D;

in script ${i}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(i,a,s[a],s);continue}}else if(!Array.isArray(l)){const h=(o=l.constructor)==null?void 0:o.name;if(h==="Object"&&!l.constructor["did_warn:missing_serializable"]){l.constructor["did_warn:missing_serializable"]=!0;const d='You might be missing a @serializable(Type) decorator for field "'+a+'" in '+i+".ts";console.warn(d+`
${a}:`,c,h),Ec(os.Warn,"Dev Warning: Are you missing a type in @serializable? Please check the browser console for details")}}}if(typeof l=="string"&&typeof c=="string"&&(c.endsWith(".gltf")||c.endsWith(".glb"))){Ec(os.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(AssetReference)
${a}? : AssetReference;

in script ${i}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(i,a,s[a],s);continue}}}}function Rre(s,e){for(const t of Object.keys(e)){const i=e[t];if(typeof i=="object"&&i!==null&&i!==void 0){const n=s[t];if(!n){mc&&console.log(t,"is undefined on",s);continue}for(const r of Object.keys(i))if(n[r]===void 0&&qF(i[r])&&!qF(n)){const a=Pre(n,r);if(a&&((a==null?void 0:a.writable)===void 0||(a==null?void 0:a.writable)===!1)&&a.set===void 0){mc&&console.warn('Property is not writable "'+r+'"',n,a,i[r],n[r]);continue}n[r]=i[r]}}}}function Pre(s,e){for(;s;){const t=Object.getOwnPropertyDescriptor(s,e);if(t)return t;s=Object.getPrototypeOf(s)}}function qF(s){switch(typeof s){case"number":case"string":case"boolean":return!0}return!1}function ER(s,e,t,i,n){let r=typeof e=="function"&&e.prototype===void 0,o=e;if(r)try{if(o=e==null?void 0:e.call(e,n),r=!1,o==null)return}catch(h){console.error("Error in callback",h,s)}if(t.type=o,!r&&n instanceof o)return n;if(i||(i={serializer:mS.getSerializerForConstructor(o)}),n&&typeof n=="object"&&Sre(n)){if(n.__concreteInstance)return n.__concreteInstance;const h=n;if(!h.$serializedTypes&&o.prototype.$serializedTypes&&(h.$serializedTypes=o.prototype.$serializedTypes),h.$serializedTypes&&gS(h,s,t),n&&o!==void 0)try{let d=null;i.serializer&&(d=i.serializer.onDeserialize(s,t)),d||(d=new o,qs&&console.log("Create concrete instance for persistent asset",n,"instance:",d),iv(d,n)),n.__concreteInstance=d,n=d}catch(d){console.error("Error creating instance or creating values on instance",d,n,o)}return n}if(Array.isArray(s)){const h=[];for(let d=0;d<s.length;d++){const f=s[d],p=ER(f,e,t,i,f);h.push(p)}return h}const a=i==null?void 0:i.serializer;if(a)return a.onDeserialize(s,t);let l;if(s&&(s.isMaterial||s.isTexture||s.isObject3D||s instanceof Ho))l=s;else{if(s===void 0)return;if(s===null&&(o===Vt||o===Pt||o===le||o===Ho))return null;try{l=new o(...Bre(s))}catch(h){console.error("Error creating "+t.path,t.target,h);return}}const c=l;return c.$serializedTypes&&gS(c,s,t),l}function Bre(s){if(_w.length=0,typeof s=="object"&&s!==null&&s!==void 0)for(const e of Object.keys(s))_w.push(s[e]);return _w}const TR=Symbol("assigned component properties");function iv(s,e,t){var n;if(e==null||s==null)return;s[TR]=!0;const i=((n=s.constructor)==null?void 0:n.name)??"unknown";t==null||t.registerDefinedKeys(i,s);for(const r of Object.keys(e)){const o=Dre(s,r);typeof(o==null?void 0:o.value)!="function"&&(!o||o.writable===!0||(o==null?void 0:o.set)!==void 0)&&(s[r]=e[r])}delete s[TR]}function Dre(s,e){let t;do t=Object.getOwnPropertyDescriptor(s,e);while(!t&&(s=Object.getPrototypeOf(s)));return t}const x5=Symbol("customVisibilityFlag");function rd(s,e){s.layers[x5]=e}const XF=Symbol("DidPatchLayers");function Ore(){const s=Wr.prototype;if(s[XF])return;s[XF]=!0;const e=s.test;s.test=function(t){return this[x5]===!1?!1:e.call(this,t)}}Ore();Object.defineProperty(zt.prototype,"fov",{get:function(){return this._fov},set:function(s){const e=s!==this._fov;this._fov=s,e&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0});Object.defineProperty(zt.prototype,"near",{get:function(){return this._near},set:function(s){const e=s!==this._near;this._near=s,e&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0});Object.defineProperty(zt.prototype,"far",{get:function(){return this._far},set:function(s){const e=s!==this._far;this._far=s,e&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0});const w5=new Map;function S5(s,e){if(!s)return;if(!e){console.warn("No prototype found",s,s.prototype,s.constructor);return}const t=w5.get(e);t&&t.apply(s)}function C5(s){const e=Lre(s.prototype);w5.set(s,e)}function Lre(s){return new kre(s)}class kre{constructor(e){u(this,"$symbol");u(this,"extensions");u(this,"descriptors");this.$symbol=Symbol("prototype-extension"),this.extensions=Object.keys(e),this.descriptors=new Array;for(let t=0;t<this.extensions.length;t++){const i=this.extensions[t],n=Object.getOwnPropertyDescriptor(e,i);n&&this.descriptors.push(n)}}apply(e){if(!e[this.$symbol]){e[this.$symbol]=!0;for(let t=0;t<this.extensions.length;t++){const i=this.extensions[t],n=this.descriptors[t];n&&Object.defineProperty(e,i,n)}}}}const Sf=new Nd,zr=new w,Gu=new w,Mn=new xe,YF={X:new w(1,0,0),Y:new w(0,1,0),Z:new w(0,0,1)},zT={type:"change"},KF={type:"mouseDown"},JF={type:"mouseUp",mode:null},ZF={type:"objectChange"};class Fre extends ge{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const i=new DD;this._gizmo=i,this.add(i);const n=new Vre;this._plane=n,this.add(n);const r=this;function o(_,A){let b=A;Object.defineProperty(r,_,{get:function(){return b!==void 0?b:A},set:function(E){b!==E&&(b=E,n[_]=E,i[_]=E,r.dispatchEvent({type:_+"-changed",value:E}),r.dispatchEvent(zT))}}),r[_]=A,n[_]=A,i[_]=A}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new w,l=new w,c=new xe,h=new xe,d=new w,f=new xe,p=new w,m=new w,v=new w,y=0,g=new w;o("worldPosition",a),o("worldPositionStart",l),o("worldQuaternion",c),o("worldQuaternionStart",h),o("cameraPosition",d),o("cameraQuaternion",f),o("pointStart",p),o("pointEnd",m),o("rotationAxis",v),o("rotationAngle",y),o("eye",g),this._offset=new w,this._startNorm=new w,this._endNorm=new w,this._cameraScale=new w,this._parentPosition=new w,this._parentQuaternion=new xe,this._parentQuaternionInv=new xe,this._parentScale=new w,this._worldScaleStart=new w,this._worldQuaternionInv=new xe,this._worldScale=new w,this._positionStart=new w,this._quaternionStart=new xe,this._scaleStart=new w,this._getPointer=Ure.bind(this),this._onPointerDown=zre.bind(this),this._onPointerHover=Nre.bind(this),this._onPointerMove=Gre.bind(this),this._onPointerUp=Hre.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&Sf.setFromCamera(e,this.camera);const t=GT(this._gizmo.picker[this.mode],Sf);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&Sf.setFromCamera(e,this.camera);const t=GT(this._plane,Sf,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,KF.mode=this.mode,this.dispatchEvent(KF)}}pointerMove(e){const t=this.axis,i=this.mode,n=this.object;let r=this.space;if(i==="scale"?r="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(r="world"),n===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&Sf.setFromCamera(e,this.camera);const o=GT(this._plane,Sf,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(n.position.applyQuaternion(Mn.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),r==="world"&&(n.parent&&n.position.add(zr.setFromMatrixPosition(n.parent.matrixWorld)),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(zr.setFromMatrixPosition(n.parent.matrixWorld))));else if(i==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),Gu.set(a,a,a)}else zr.copy(this.pointStart),Gu.copy(this.pointEnd),zr.applyQuaternion(this._worldQuaternionInv),Gu.applyQuaternion(this._worldQuaternionInv),Gu.divide(zr),t.search("X")===-1&&(Gu.x=1),t.search("Y")===-1&&(Gu.y=1),t.search("Z")===-1&&(Gu.z=1);n.scale.copy(this._scaleStart).multiply(Gu),this.scaleSnap&&(t.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(zr.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(zr.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(YF[t]),zr.copy(YF[t]),r==="local"&&zr.applyQuaternion(this.worldQuaternion),zr.cross(this.eye),zr.length()===0?l=!0:this.rotationAngle=this._offset.dot(zr.normalize())*a),(t==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&t!=="E"&&t!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(Mn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(Mn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(zT),this.dispatchEvent(ZF)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(JF.mode=this.mode,this.dispatchEvent(JF)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(zT),this.dispatchEvent(ZF),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Sf}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Ure(s){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:s.button};{const e=this.domElement.getBoundingClientRect();return{x:(s.clientX-e.left)/e.width*2-1,y:-(s.clientY-e.top)/e.height*2+1,button:s.button}}}function Nre(s){if(this.enabled)switch(s.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(s));break}}function zre(s){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(s)),this.pointerDown(this._getPointer(s)))}function Gre(s){this.enabled&&this.pointerMove(this._getPointer(s))}function Hre(s){this.enabled&&(this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(s)))}function GT(s,e,t){const i=e.intersectObject(s,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||t)return i[n];return!1}const fx=new oi,Ji=new w(0,1,0),$F=new w(0,0,0),eU=new fe,px=new xe,bw=new xe,Yl=new w,tU=new fe,Wy=new w(1,0,0),Uf=new w(0,1,0),qy=new w(0,0,1),mx=new w,dy=new w,fy=new w;class DD extends ge{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Kt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new hn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const n=t.clone();n.opacity=.5;const r=e.clone();r.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const h=e.clone();h.color.setHex(255),h.opacity=.5;const d=e.clone();d.opacity=.25;const f=e.clone();f.color.setHex(16776960),f.opacity=.25,e.clone().color.setHex(16776960);const m=e.clone();m.color.setHex(7895160);const v=new ts(0,.04,.1,12);v.translate(0,.05,0);const y=new Xi(.08,.08,.08);y.translate(0,.04,0);const g=new pt;g.setAttribute("position",new nt([0,0,0,1,0,0],3));const _=new ts(.0075,.0075,.5,3);_.translate(0,.25,0);function A(V,O){const F=new Hh(V,.0075,3,64,O*Math.PI*2);return F.rotateY(Math.PI/2),F.rotateX(Math.PI/2),F}function b(){const V=new pt;return V.setAttribute("position",new nt([0,0,0,1,1,1],3)),V}const E={X:[[new le(v,r),[.5,0,0],[0,0,-Math.PI/2]],[new le(v,r),[-.5,0,0],[0,0,Math.PI/2]],[new le(_,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new le(v,o),[0,.5,0]],[new le(v,o),[0,-.5,0],[Math.PI,0,0]],[new le(_,o)]],Z:[[new le(v,a),[0,0,.5],[Math.PI/2,0,0]],[new le(v,a),[0,0,-.5],[-Math.PI/2,0,0]],[new le(_,a),null,[Math.PI/2,0,0]]],XYZ:[[new le(new Xh(.1,0),d.clone()),[0,0,0]]],XY:[[new le(new Xi(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new le(new Xi(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new le(new Xi(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},C={X:[[new le(new ts(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new le(new ts(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new le(new ts(.2,0,.6,4),i),[0,.3,0]],[new le(new ts(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new le(new ts(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new le(new ts(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new le(new Xh(.2,0),i)]],XY:[[new le(new Xi(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new le(new Xi(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new le(new Xi(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},T={START:[[new le(new Xh(.01,2),n),null,null,null,"helper"]],END:[[new le(new Xh(.01,2),n),null,null,null,"helper"]],DELTA:[[new Rn(b(),n),null,null,null,"helper"]],X:[[new Rn(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Rn(g,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Rn(g,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={XYZE:[[new le(A(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new le(A(.5,.5),r)]],Y:[[new le(A(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new le(A(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new le(A(.75,1),f),null,[0,Math.PI/2,0]]]},R={AXIS:[[new Rn(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},S={XYZE:[[new le(new Wo(.25,10,8),i)]],X:[[new le(new Hh(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new le(new Hh(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new le(new Hh(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new le(new Hh(.75,.1,2,24),i)]]},I={X:[[new le(y,r),[.5,0,0],[0,0,-Math.PI/2]],[new le(_,r),[0,0,0],[0,0,-Math.PI/2]],[new le(y,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new le(y,o),[0,.5,0]],[new le(_,o)],[new le(y,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new le(y,a),[0,0,.5],[Math.PI/2,0,0]],[new le(_,a),[0,0,0],[Math.PI/2,0,0]],[new le(y,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new le(new Xi(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new le(new Xi(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new le(new Xi(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new le(new Xi(.1,.1,.1),d.clone())]]},L={X:[[new le(new ts(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new le(new ts(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new le(new ts(.2,0,.6,4),i),[0,.3,0]],[new le(new ts(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new le(new ts(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new le(new ts(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new le(new Xi(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new le(new Xi(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new le(new Xi(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new le(new Xi(.2,.2,.2),i),[0,0,0]]]},U={X:[[new Rn(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Rn(g,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Rn(g,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function D(V){const O=new ge;for(const F in V)for(let N=V[F].length;N--;){const q=V[F][N][0].clone(),$=V[F][N][1],oe=V[F][N][2],ae=V[F][N][3],Re=V[F][N][4];q.name=F,q.tag=Re,$&&q.position.set($[0],$[1],$[2]),oe&&q.rotation.set(oe[0],oe[1],oe[2]),ae&&q.scale.set(ae[0],ae[1],ae[2]),q.updateMatrix();const se=q.geometry.clone();se.applyMatrix4(q.matrix),q.geometry=se,q.renderOrder=1/0,q.position.set(0,0,0),q.rotation.set(0,0,0),q.scale.set(1,1,1),O.add(q)}return O}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=D(E)),this.add(this.gizmo.rotate=D(M)),this.add(this.gizmo.scale=D(I)),this.add(this.picker.translate=D(C)),this.add(this.picker.rotate=D(S)),this.add(this.picker.scale=D(L)),this.add(this.helper.translate=D(T)),this.add(this.helper.rotate=D(R)),this.add(this.helper.scale=D(U)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:bw;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let r=0;r<n.length;r++){const o=n[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(Mn.setFromEuler(fx.set(0,0,0)),o.quaternion.copy(i).multiply(Mn),Math.abs(Ji.copy(Wy).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(Mn.setFromEuler(fx.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply(Mn),Math.abs(Ji.copy(Uf).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(Mn.setFromEuler(fx.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply(Mn),Math.abs(Ji.copy(qy).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(Mn.setFromEuler(fx.set(0,Math.PI/2,0)),Ji.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(eU.lookAt($F,Ji,Uf)),o.quaternion.multiply(Mn),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),zr.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),zr.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(zr),o.visible=this.dragging):(o.quaternion.copy(i),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Ji.copy(Wy).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Ji.copy(Uf).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Ji.copy(qy).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Ji.copy(qy).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Ji.copy(Wy).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Ji.copy(Uf).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(px.copy(i),Ji.copy(this.eye).applyQuaternion(Mn.copy(i).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(eU.lookAt(this.eye,$F,Uf)),o.name==="X"&&(Mn.setFromAxisAngle(Wy,Math.atan2(-Ji.y,Ji.z)),Mn.multiplyQuaternions(px,Mn),o.quaternion.copy(Mn)),o.name==="Y"&&(Mn.setFromAxisAngle(Uf,Math.atan2(Ji.x,Ji.z)),Mn.multiplyQuaternions(px,Mn),o.quaternion.copy(Mn)),o.name==="Z"&&(Mn.setFromAxisAngle(qy,Math.atan2(Ji.y,Ji.x)),Mn.multiplyQuaternions(px,Mn),o.quaternion.copy(Mn))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(l){return o.name===l}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class Vre extends le{constructor(){super(new _s(1e5,1e5,2,2),new Kt({visible:!1,wireframe:!0,side:Pi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),mx.copy(Wy).applyQuaternion(t==="local"?this.worldQuaternion:bw),dy.copy(Uf).applyQuaternion(t==="local"?this.worldQuaternion:bw),fy.copy(qy).applyQuaternion(t==="local"?this.worldQuaternion:bw),Ji.copy(dy),this.mode){case"translate":case"scale":switch(this.axis){case"X":Ji.copy(this.eye).cross(mx),Yl.copy(mx).cross(Ji);break;case"Y":Ji.copy(this.eye).cross(dy),Yl.copy(dy).cross(Ji);break;case"Z":Ji.copy(this.eye).cross(fy),Yl.copy(fy).cross(Ji);break;case"XY":Yl.copy(fy);break;case"YZ":Yl.copy(mx);break;case"XZ":Ji.copy(fy),Yl.copy(dy);break;case"XYZ":case"E":Yl.set(0,0,0);break}break;case"rotate":default:Yl.set(0,0,0)}Yl.length()===0?this.quaternion.copy(this.cameraQuaternion):(tU.lookAt(zr.set(0,0,0),Yl,Ji),this.quaternion.setFromRotationMatrix(tU)),super.updateMatrixWorld(e)}}const Qre=ie("debuggetcomponent"),iU=()=>Qre||globalThis.NEEDLE_DEBUG_GETCOMPONENT===!0;function jre(s){return s==null||s.isObject3D?s:s.object&&s.object.isObject3D?s.object:s}function OD(s,e){if(!s||!s.userData.components)return e;const t=s.userData.components.indexOf(e);return t<0||(f_.dispatchComponentLifecycleEvent(tv.Removing,e),e.gameObject=null,s.userData.components.splice(t,1)),e}function g_(s,e,t){const i=Xp(s,e);return i||ya(s,e,t)}const E5=new Ls("addComponentIdProvider");function mp(s,e,t=!0){s.userData||(s.userData={}),s.userData.components||(s.userData.components=[]),s.userData.components.push(e),e.gameObject=s,(e.guid===void 0||e.guid==="invalid")&&(e.guid=E5.generateUUID()),fE(s),yE(e,e.context);try{t&&e.__internalAwake&&(vA(s),e.activeAndEnabled&&e.__internalAwake()),f_.dispatchComponentLifecycleEvent(tv.Added,e)}catch(i){console.error(i)}return e}function ya(s,e,t,i){if(typeof e=="function"){const n=new e;t&&n.__internalNewInstanceCreated(t);let r=!0;return(i==null?void 0:i.callAwake)!=null&&(r=i.callAwake),mp(s,n,r)}if(e.destroyed)return console.warn("Can not move/add a destroyed component",e),e;if(e.gameObject===s)return e;if(e.gameObject&&e.gameObject.userData.components){const n=e.gameObject.userData.components.indexOf(e);e.gameObject.userData.components.splice(n,1)}if(!s.userData.components)s.userData.components=[];else if(s.userData.components.includes(e))return e;return s.userData.components.push(e),e.gameObject=s,(e.guid===void 0||e.guid==="invalid")&&(e.guid=E5.generateUUID()),t&&e._internalInit(t),yE(e,e.context),e}function T5(s){if(s.gameObject&&s.gameObject.userData.components){const e=s.gameObject.userData.components.indexOf(s);s.gameObject.userData.components.splice(e,1)}s.__internalDisable&&s.__internalDisable(),jh(s,s.context??Ot.Current),s.destroy(),s.gameObject=null}let nU=!1;function M5(s,e,t){var i;if(s==null)return null;if(!s.isObject3D)return console.error("Object is not object3D"),null;if(!((i=s==null?void 0:s.userData)!=null&&i.components)||(typeof e=="string"&&(nU||(nU=!0,console.warn(`Accessing components by name is not supported.
Please use the component type instead. This may keep working in local development but it will fail when bundling your application.

You can import other modules your main module to get access to types
or if you use npmdefs you can make types available globally using globalThis:
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis`,e))),iU()&&console.log("[onGetComponent] FIND",e),e==null))return null;for(let n=0;n<s.userData.components.length;n++){const r=s.userData.components[n];let o=Object.getPrototypeOf(r);for(;o;){if(o===e.prototype)if(iU()&&console.log("[onGetComponent] MATCH BY PROTOYPE",o),t)t.push(r);else return r;o=Object.getPrototypeOf(o)}}return t||null}function Xp(s,e){const t=M5(s,e);return t?Array.isArray(t)?t[0]:t:null}function v_(s,e,t,i=!0){return t||(t=[]),i&&(t.length=0),M5(s,e,t),t}function y_(s,e,t){var n;const i=Xp(s,e);if(t===!1&&(i==null?void 0:i.enabled)===!1)return null;if(i)return i;for(let r=0;r<((n=s==null?void 0:s.children)==null?void 0:n.length);r++){const o=y_(s.children[r],e);if(o)return o}return null}function xv(s,e,t,i=!0){var n;t||(t=[]),i&&(t.length=0),v_(s,e,t,!1);for(let r=0;r<((n=s==null?void 0:s.children)==null?void 0:n.length);r++)xv(s.children[r],e,t,!1);return t}function _0(s,e){if(!s)return null;if(Array.isArray(s)){for(let i=0;i<s.length;i++){const n=jre(s[i]),r=_0(n,e);if(r)return r}return null}const t=Xp(s,e);return t||(s.parent?_0(s.parent,e):null)}function uE(s,e,t,i=!0){return t||(t=[]),i&&(t.length=0),s?(v_(s,e,t,!1),s.parent?uE(s.parent,e,t,!1):t):t}function dE(s,e=void 0,t=!0){if(!s)return null;if(!e&&(e=Ot.Current,!e))return console.error("Can not search object without any needle context or scene!!!"),null;let i=e;if(i.isScene||(i=e==null?void 0:e.scene),!i)return null;for(const n in i.children){const r=i.children[n];if(t===!1&&r[nu]===!1)continue;const o=y_(r,s);if(o)return o}return null}function I5(s,e,t=void 0){if(!s)return e??[];if(e||(e=[]),e.length=0,!t&&(t=Ot.Current,!t))return console.error("Can not search object without any needle context or scene!!!"),e;"scene"in t&&(t=t.scene);const i=t;if(!i)return e;for(const n in i.children){const r=i.children[n];xv(r,s,e,!1)}return e}function fE(s){s&&s.isObject3D===!0&&S5(s,ge)}ge.prototype.SetActive=function(s){this.visible=s};ge.prototype.setActive=function(s){this.visible=s};ge.prototype.destroy=function(){ba(this)};ge.prototype.addComponent=function(s,e){return ya(this,s,e)};ge.prototype.addNewComponent=function(s,e){return ya(this,s,e)};ge.prototype.removeComponent=function(s){return OD(this,s)};ge.prototype.getOrAddComponent=function(s,e){return g_(this,s,e)};ge.prototype.getComponent=function(s){return Xp(this,s)};ge.prototype.getComponents=function(s,e){return v_(this,s,e)};ge.prototype.getComponentInChildren=function(s){return y_(this,s)};ge.prototype.getComponentsInChildren=function(s,e){return xv(this,s,e)};ge.prototype.getComponentInParent=function(s){return _0(this,s)};ge.prototype.getComponentsInParent=function(s,e){return uE(this,s,e)};Object.getOwnPropertyDescriptor(ge.prototype,"activeSelf")||Object.defineProperty(ge.prototype,"activeSelf",{get:function(){return wv(this)},set:function(s){yA(this,s)}});Object.getOwnPropertyDescriptor(ge.prototype,"worldPosition")||Object.defineProperty(ge.prototype,"worldPosition",{get:function(){return this instanceof DD?Qt(this.object):Qt(this)},set:function(s){Os(this,s)}});Object.getOwnPropertyDescriptor(ge.prototype,"worldQuaternion")||Object.defineProperty(ge.prototype,"worldQuaternion",{get:function(){return this instanceof DD?qi(this.object):qi(this)},set:function(s){Ka(this,s)}});Object.getOwnPropertyDescriptor(ge.prototype,"worldRotation")||Object.defineProperty(ge.prototype,"worldRotation",{get:function(){return l_(this)},set:function(s){eD(this,s)}});Object.getOwnPropertyDescriptor(ge.prototype,"worldScale")||Object.defineProperty(ge.prototype,"worldScale",{get:function(){return ln(this)},set:function(s){Jg(this,s)}});Object.getOwnPropertyDescriptor(ge.prototype,"worldForward")||Object.defineProperty(ge.prototype,"worldForward",{get:function(){return yt().set(0,0,1).applyQuaternion(qi(this))}});Object.getOwnPropertyDescriptor(ge.prototype,"worldRight")||Object.defineProperty(ge.prototype,"worldRight",{get:function(){return yt().set(1,0,0).applyQuaternion(qi(this))}});Object.getOwnPropertyDescriptor(ge.prototype,"worldUp")||Object.defineProperty(ge.prototype,"worldUp",{get:function(){return yt().set(0,1,0).applyQuaternion(qi(this))}});C5(ge);class Vi extends me{constructor(t,i,n,r){var e=(...args)=>{super(...args);u(this,"alpha",1)};i!=null&&n!=null?(e(t,i,n),this.alpha=r):(e(t),this.alpha=1)}get isRGBAColor(){return!0}set a(t){this.alpha=t}get a(){return this.alpha}clone(){const t=super.clone();return t.alpha=this.alpha,t}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,"alpha"in t&&typeof t.alpha=="number"?this.alpha=t.alpha:typeof t.a=="number"&&(this.alpha=t.a),this}lerp(t,i){const n=t;return n.alpha!=null&&(this.alpha=et.lerp(this.alpha,n.alpha,i)),super.lerp(t,i)}lerpColors(t,i,n){const r=t,o=i;return r.alpha!=null&&o.alpha!=null&&(this.alpha=et.lerp(r.alpha,o.alpha,n)),super.lerpColors(t,i,n)}multiply(t){const i=t;return i.alpha!=null&&(this.alpha=this.alpha*i.alpha),super.multiply(t)}fromArray(t,i=0){return this.alpha=t[i+3],super.fromArray(t,i)}}const xw=ie("debuggetcomponent"),ww=ie("debuginstantiate");var MR;(function(s){s[s.None=0]="None",s[s.HideInHierarchy=1]="HideInHierarchy",s[s.HideInInspector=2]="HideInInspector",s[s.DontSaveInEditor=4]="DontSaveInEditor",s[s.NotEditable=8]="NotEditable",s[s.DontSaveInBuild=16]="DontSaveInBuild",s[s.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",s[s.DontSave=52]="DontSave",s[s.HideAndDontSave=61]="HideAndDontSave"})(MR||(MR={}));class Gl{constructor(){u(this,"idProvider");u(this,"parent");u(this,"keepWorldPosition");u(this,"position");u(this,"rotation");u(this,"scale");u(this,"visible");u(this,"context");u(this,"components")}clone(){var t,i,n;const e=new Gl;return e.idProvider=this.idProvider,e.parent=this.parent,e.keepWorldPosition=this.keepWorldPosition,e.position=(t=this.position)==null?void 0:t.clone(),e.rotation=(i=this.rotation)==null?void 0:i.clone(),e.scale=(n=this.scale)==null?void 0:n.clone(),e.visible=this.visible,e.context=this.context,e.components=this.components,e}cloneAssign(e){var t,i,n;this.idProvider=e.idProvider,this.parent=e.parent,this.keepWorldPosition=e.keepWorldPosition,this.position=(t=e.position)==null?void 0:t.clone(),this.rotation=(i=e.rotation)==null?void 0:i.clone(),this.scale=(n=e.scale)==null?void 0:n.clone(),this.visible=e.visible,this.context=e.context,this.components=e.components}}function wv(s){return s.visible}function yA(s,e){return typeof e=="number"&&(e=e>.5),s.visible=e,s.visible}function R5(s){return s[nu]||pE(s)}function P5(s,e){s[a5]=e}function pE(s){return Ya.isUsingInstancing(s)}function A_(s,e){return qg(s,e,!0,!0)}const B5=Symbol("isDestroyed");function Up(s){return s[B5]}function D5(s,e){s[B5]=e}const IR=Symbol("isDontDestroy");function RR(s,e=!0){s[IR]=e}const Sw=[],Cw=[];function ba(s,e=!0,t=!1){Sw.length=0,Cw.length=0,PR(s,e,!0);for(const i of Sw)i.gameObject=null,i.context=null;for(const i of Cw)D5(i,!0),t&&rn(i),o5(i);Cw.length=0,Sw.length=0}function PR(s,e=!0,t=!0){var o;if(s==null)return;const i=s;if(i.isComponent){if(i[IR])return;Sw.push(i);const a=i.gameObject;i.__internalDisable(),i.__internalDestroy(),i.gameObject=a;return}if(s[IR])return;const n=s;xw&&console.log(n),Cw.push(n);const r=(o=n.userData)==null?void 0:o.components;if(r!=null&&Array.isArray(r)){let a=r.length;for(let l=0;l<r.length;l++){const c=r[l];PR(c,e,!1),r.length<a&&(a=r.length,l--)}}if(e&&n.children)for(const a of n.children)PR(a,e,!1);t&&n.removeFromParent()}function Np(s,e,t=!0){return O5(s,e,t)}function*mE(s,e,t=!1,i=999,n=0){if(s!=null&&s.userData.components&&!(n>i)){for(const r of s.userData.components)e&&(r==null?void 0:r.isComponent)===!0&&r instanceof e?yield r:yield r;if(t===!0)for(const r of s.children)yield*mE(r,e,!0,i,n+1)}}function O5(s,e,t,i=0){var n;if(s){if(s.isObject3D,i>1e3){console.warn("Failed to iterate components: too many levels");return}if((n=s.userData)!=null&&n.components)for(let r=0;r<s.userData.components.length;r++){const o=s.userData.components[r];if((o==null?void 0:o.isComponent)===!0){const a=e(o);if(a!==void 0)return a}}if(t&&s.children){const r=i+1;for(let o=0;o<s.children.length;o++){const a=s.children[o];if(!a)continue;const l=O5(a,e,t,r);if(l!==void 0)return l}}}}function Sv(s,e=null){let t=null;e!==null&&(e.x!==void 0?(t=new Gl,t.position=e):t=e);let i=Ot.Current;t!=null&&t.context&&(i=t.context),xw&&i.alias&&console.log("context",i.alias),t&&!t.idProvider&&(t.idProvider=new Ls(Date.now()));const n=[],r={},o={},a=L5(i,s,t,n,r,o);a&&(qre(r),Wre(o,r)),xw&&(rS(s,!0),rS(a,!0));const l={};if((t==null?void 0:t.components)!==!1){for(const c in n){const h=n[c],d=h.guid;t&&t.idProvider&&(h.guid=t.idProvider.generateUUID(),l[d]=h.guid,xw&&console.log(h.name,h.guid)),yE(h,i),h.__internalNewInstanceCreated&&h.__internalNewInstanceCreated()}for(const c in n){const h=n[c];h.resolveGuids&&h.resolveGuids(l),h.enabled!==!1&&(h.enabled=!0)}fS(i)}return a}function L5(s,e,t,i,n,r){var h;if(!e)return null;const o=e.userData;e.userData={};const a=e.children;e.children=[];const l=e.clone(!1);if(fE(l),e.userData=o,e.children=a,n[e.uuid]={original:e,clone:l},ww&&console.log("ADD",e,l),e.type==="SkinnedMesh"&&(r[e.uuid]={original:e,clone:l}),(t==null?void 0:t.visible)!==void 0&&(l.visible=t.visible),t!=null&&t.idProvider){l.uuid=t.idProvider.generateUUID();const d=l;d&&(d.guid=l.uuid)}e.animations&&e.animations.length>0&&(l.animations=[...e.animations]);const c=e.parent;if(c&&c.add(l),t!=null&&t.position?Os(l,t.position):l.position.copy(e.position),t!=null&&t.rotation?Ka(l,t.rotation):l.quaternion.copy(e.quaternion),t!=null&&t.scale?l.scale.copy(t.scale):l.scale.copy(e.scale),t!=null&&t.parent&&t.parent!=="scene"){let d=null;if(typeof t.parent=="string"?d=qg(t.parent,s.scene,!0):d=t.parent,d){const f=t.keepWorldPosition===!0?d.attach:d.add;f?f.call(d,l):console.error("Invalid parent object",d,"received when instantiating:",e)}else console.warn("could not find parent:",t.parent)}for(const[d,f]of Object.entries(e.userData))d!=="components"&&(l.userData[d]=f);if((h=e.userData)!=null&&h.components){const d=e.userData.components,f=[];l.userData.components=f;for(let p=0;p<d.length;p++){const m=d[p],v=new m.constructor;iv(v,m),m[hA]!==void 0&&(v[hA]=m[hA]),f.push(v),v.gameObject=l,i.push(v),n[m.guid]={original:m,clone:v},f_.dispatchComponentLifecycleEvent(tv.Added,v)}}t&&(t.position=void 0,t.rotation=void 0,t.scale=void 0,t.parent=void 0);for(const d in e.children){const f=e.children[d],p=L5(s,f,t,i,n,r);p&&l.add(p)}return l}function Wre(s,e){for(const t in s){const i=s[t],n=i.original,r=n.skeleton,o=i.clone;if(!r){console.warn("Skinned mesh has no skeleton?",i);continue}const a=r.bones,l=o.skeleton.clone();o.skeleton=l,o.bindMatrix.clone().copy(n.bindMatrix),o.bindMatrixInverse.copy(n.bindMatrixInverse);const c=[];l.bones=c;for(let h=0;h<a.length;h++){const d=a[h],p=e[d.uuid].clone;c.push(p)}}for(const t in s){const i=s[t].clone;i.skeleton.update(),i.bind(i.skeleton,i.bindMatrix),i.updateMatrixWorld(!0)}}function qre(s){var e;for(const t in s){const n=s[t].clone;if(n!=null&&n.isObject3D&&((e=n==null?void 0:n.userData)!=null&&e.components))for(let r=0;r<n.userData.components.length;r++){const o=n.userData.components[r],a=Object.entries(o);for(const[l,c]of a)if(Array.isArray(c)){const h=[];o[l]=h;for(let d=0;d<c.length;d++){const f=c[d];if(typeof f!="object"){h.push(f);continue}const p=sU(o,l,f,s);p!==void 0?h.push(p):h.push(f)}}else if(typeof c=="object"){const h=sU(o,l,c,s);h!==void 0&&(o[l]=h)}}}}function sU(s,e,t,i){var n,r;if(t!=null)if(t.isComponent===!0){const o=t.gameObject;if(o){const a=o.uuid,l=(n=i[a])==null?void 0:n.clone;if(!l){ww&&console.log("reference did not change",e,s,t);return}const c=o.userData.components.indexOf(t);if(c>=0&&l.isObject3D)return ww&&console.log(e,a),l.userData.components[c];console.warn("could not find component",e,t)}}else if(t.isObject3D===!0){if(e==="gameObject")return;const o=t;if(o){const a=o.uuid,l=(r=i[a])==null?void 0:r.clone;if(l)return ww&&console.log(e,"old",t,"new",l),l}}else{if(t.isVector4||t.isVector3||t.isVector2||t.isQuaternion||t.isEuler)return t.clone();if(t.isColor===!0)return t.clone();if(t.isEventList===!0)return t.__internalOnInstantiate(i)}}var k5={exports:{}},F5={exports:{}};(function(){var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(t,i){return t<<i|t>>>32-i},rotr:function(t,i){return t<<32-i|t>>>i},endian:function(t){if(t.constructor==Number)return e.rotl(t,8)&16711935|e.rotl(t,24)&4278255360;for(var i=0;i<t.length;i++)t[i]=e.endian(t[i]);return t},randomBytes:function(t){for(var i=[];t>0;t--)i.push(Math.floor(Math.random()*256));return i},bytesToWords:function(t){for(var i=[],n=0,r=0;n<t.length;n++,r+=8)i[r>>>5]|=t[n]<<24-r%32;return i},wordsToBytes:function(t){for(var i=[],n=0;n<t.length*32;n+=8)i.push(t[n>>>5]>>>24-n%32&255);return i},bytesToHex:function(t){for(var i=[],n=0;n<t.length;n++)i.push((t[n]>>>4).toString(16)),i.push((t[n]&15).toString(16));return i.join("")},hexToBytes:function(t){for(var i=[],n=0;n<t.length;n+=2)i.push(parseInt(t.substr(n,2),16));return i},bytesToBase64:function(t){for(var i=[],n=0;n<t.length;n+=3)for(var r=t[n]<<16|t[n+1]<<8|t[n+2],o=0;o<4;o++)n*8+o*6<=t.length*8?i.push(s.charAt(r>>>6*(3-o)&63)):i.push("=");return i.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var i=[],n=0,r=0;n<t.length;r=++n%4)r!=0&&i.push((s.indexOf(t.charAt(n-1))&Math.pow(2,-2*r+8)-1)<<r*2|s.indexOf(t.charAt(n))>>>6-r*2);return i}};F5.exports=e})();var Xre=F5.exports,BR={utf8:{stringToBytes:function(s){return BR.bin.stringToBytes(unescape(encodeURIComponent(s)))},bytesToString:function(s){return decodeURIComponent(escape(BR.bin.bytesToString(s)))}},bin:{stringToBytes:function(s){for(var e=[],t=0;t<s.length;t++)e.push(s.charCodeAt(t)&255);return e},bytesToString:function(s){for(var e=[],t=0;t<s.length;t++)e.push(String.fromCharCode(s[t]));return e.join("")}}},rU=BR;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Yre=function(s){return s!=null&&(U5(s)||Kre(s)||!!s._isBuffer)};function U5(s){return!!s.constructor&&typeof s.constructor.isBuffer=="function"&&s.constructor.isBuffer(s)}function Kre(s){return typeof s.readFloatLE=="function"&&typeof s.slice=="function"&&U5(s.slice(0,0))}(function(){var s=Xre,e=rU.utf8,t=Yre,i=rU.bin,n=function(r,o){r.constructor==String?o&&o.encoding==="binary"?r=i.stringToBytes(r):r=e.stringToBytes(r):t(r)?r=Array.prototype.slice.call(r,0):!Array.isArray(r)&&r.constructor!==Uint8Array&&(r=r.toString());for(var a=s.bytesToWords(r),l=r.length*8,c=1732584193,h=-271733879,d=-1732584194,f=271733878,p=0;p<a.length;p++)a[p]=(a[p]<<8|a[p]>>>24)&16711935|(a[p]<<24|a[p]>>>8)&4278255360;a[l>>>5]|=128<<l%32,a[(l+64>>>9<<4)+14]=l;for(var m=n._ff,v=n._gg,y=n._hh,g=n._ii,p=0;p<a.length;p+=16){var _=c,A=h,b=d,E=f;c=m(c,h,d,f,a[p+0],7,-680876936),f=m(f,c,h,d,a[p+1],12,-389564586),d=m(d,f,c,h,a[p+2],17,606105819),h=m(h,d,f,c,a[p+3],22,-1044525330),c=m(c,h,d,f,a[p+4],7,-176418897),f=m(f,c,h,d,a[p+5],12,1200080426),d=m(d,f,c,h,a[p+6],17,-1473231341),h=m(h,d,f,c,a[p+7],22,-45705983),c=m(c,h,d,f,a[p+8],7,1770035416),f=m(f,c,h,d,a[p+9],12,-1958414417),d=m(d,f,c,h,a[p+10],17,-42063),h=m(h,d,f,c,a[p+11],22,-1990404162),c=m(c,h,d,f,a[p+12],7,1804603682),f=m(f,c,h,d,a[p+13],12,-40341101),d=m(d,f,c,h,a[p+14],17,-1502002290),h=m(h,d,f,c,a[p+15],22,1236535329),c=v(c,h,d,f,a[p+1],5,-165796510),f=v(f,c,h,d,a[p+6],9,-1069501632),d=v(d,f,c,h,a[p+11],14,643717713),h=v(h,d,f,c,a[p+0],20,-373897302),c=v(c,h,d,f,a[p+5],5,-701558691),f=v(f,c,h,d,a[p+10],9,38016083),d=v(d,f,c,h,a[p+15],14,-660478335),h=v(h,d,f,c,a[p+4],20,-405537848),c=v(c,h,d,f,a[p+9],5,568446438),f=v(f,c,h,d,a[p+14],9,-1019803690),d=v(d,f,c,h,a[p+3],14,-187363961),h=v(h,d,f,c,a[p+8],20,1163531501),c=v(c,h,d,f,a[p+13],5,-1444681467),f=v(f,c,h,d,a[p+2],9,-51403784),d=v(d,f,c,h,a[p+7],14,1735328473),h=v(h,d,f,c,a[p+12],20,-1926607734),c=y(c,h,d,f,a[p+5],4,-378558),f=y(f,c,h,d,a[p+8],11,-2022574463),d=y(d,f,c,h,a[p+11],16,1839030562),h=y(h,d,f,c,a[p+14],23,-35309556),c=y(c,h,d,f,a[p+1],4,-1530992060),f=y(f,c,h,d,a[p+4],11,1272893353),d=y(d,f,c,h,a[p+7],16,-155497632),h=y(h,d,f,c,a[p+10],23,-1094730640),c=y(c,h,d,f,a[p+13],4,681279174),f=y(f,c,h,d,a[p+0],11,-358537222),d=y(d,f,c,h,a[p+3],16,-722521979),h=y(h,d,f,c,a[p+6],23,76029189),c=y(c,h,d,f,a[p+9],4,-640364487),f=y(f,c,h,d,a[p+12],11,-421815835),d=y(d,f,c,h,a[p+15],16,530742520),h=y(h,d,f,c,a[p+2],23,-995338651),c=g(c,h,d,f,a[p+0],6,-198630844),f=g(f,c,h,d,a[p+7],10,1126891415),d=g(d,f,c,h,a[p+14],15,-1416354905),h=g(h,d,f,c,a[p+5],21,-57434055),c=g(c,h,d,f,a[p+12],6,1700485571),f=g(f,c,h,d,a[p+3],10,-1894986606),d=g(d,f,c,h,a[p+10],15,-1051523),h=g(h,d,f,c,a[p+1],21,-2054922799),c=g(c,h,d,f,a[p+8],6,1873313359),f=g(f,c,h,d,a[p+15],10,-30611744),d=g(d,f,c,h,a[p+6],15,-1560198380),h=g(h,d,f,c,a[p+13],21,1309151649),c=g(c,h,d,f,a[p+4],6,-145523070),f=g(f,c,h,d,a[p+11],10,-1120210379),d=g(d,f,c,h,a[p+2],15,718787259),h=g(h,d,f,c,a[p+9],21,-343485551),c=c+_>>>0,h=h+A>>>0,d=d+b>>>0,f=f+E>>>0}return s.endian([c,h,d,f])};n._ff=function(r,o,a,l,c,h,d){var f=r+(o&a|~o&l)+(c>>>0)+d;return(f<<h|f>>>32-h)+o},n._gg=function(r,o,a,l,c,h,d){var f=r+(o&l|a&~l)+(c>>>0)+d;return(f<<h|f>>>32-h)+o},n._hh=function(r,o,a,l,c,h,d){var f=r+(o^a^l)+(c>>>0)+d;return(f<<h|f>>>32-h)+o},n._ii=function(r,o,a,l,c,h,d){var f=r+(a^(o|~l))+(c>>>0)+d;return(f<<h|f>>>32-h)+o},n._blocksize=16,n._digestsize=16,k5.exports=function(r,o){if(r==null)throw new Error("Illegal argument "+r);var a=s.wordsToBytes(n(r,o));return o&&o.asBytes?a:o&&o.asString?i.bytesToString(a):s.bytesToHex(a)}})();var Jre=k5.exports;const Zre=aE(Jre);class DR{constructor(e,t,i,n){u(this,"success");u(this,"filename");u(this,"hash");u(this,"size");u(this,"url");this.success=e,this.filename=t,this.hash=i,this.size=n}}async function N5(s,e){const t=await s.arrayBuffer(),i=LD(t),n=s.name.split(".").pop(),r=i+"."+n,o=s.name.split(".").shift();console.assert(o!==void 0);const a={alias:o,filename:r},c=await(await fetch(e+"/exists",{method:"POST",body:JSON.stringify(a)})).json();if(c.success||console.warn("exists check did fail"),c.exists)return console.log("file already exists",i),new DR(!0,r,i,s.size);console.log("begin uploading file",o,s.size);const h=new FormData;h.append("file",s);const d={};d.filesize=s.size,o&&(d.alias=o);const p=await(await fetch(e+"/upload/file",{method:"POST",body:h,headers:d})).json();if((p==null?void 0:p.success)===!1)return p.message!==void 0?console.error("Upload failed:",p.message):console.error("Upload failed"),null;console.assert(p.hash_sum===i,"hash sum did not match","received:",p.hash_sum,"expected:",i),p.success&&console.log("successfully uploaded",i,p.id);const m=new DR(p.success,r,i,s.size);return m.url=e,m}function LD(s){return Zre(new Uint8Array(s))}async function kD(s,e,t,i,n=!1){try{const r=await fetch(i+"/download/file",{method:"POST",body:s});if(r.status!==200)return console.error("download failed",r),null;const o=await r.blob(),a=await o.arrayBuffer();n||console.assert(o.size===t,"size mismatch","expected:",t,"got:",o.size);const l=LD(a);return n||console.assert(l===e,"hash mismatch, downloaded file is invalid"),o.arrayBuffer()}catch(r){console.error(r)}return null}async function z5(s,e){var h;const t=await fetch(s),i=(h=t.body)==null?void 0:h.getReader(),n=t.headers.get("Content-Length"),r=n?parseInt(n):0;if(!i)return null;let o=0;const a=[];for(;;){const{done:d,value:f}=await i.read();if(f&&(a.push(f),o+=f.length,e.call(null,new ProgressEvent("progress",{loaded:o,total:r}))),d)break}const l=new Uint8Array(o);let c=0;for(const d of a)l.set(d,c),c+=d.length;return l}const Hu=ie("debugaddressables");class G5{constructor(e){u(this,"_context");u(this,"_assetReferences",{});u(this,"preUpdate",()=>{});this._context=e,this._context.pre_update_callbacks.push(this.preUpdate)}dispose(){const e=this._context.pre_update_callbacks.indexOf(this.preUpdate);e>=0&&this._context.pre_update_callbacks.splice(e,1);for(const t in this._assetReferences){const i=this._assetReferences[t];i==null||i.unload()}this._assetReferences={}}findAssetReference(e){return this._assetReferences[e]||null}registerAssetReference(e){return e.url&&(this._assetReferences[e.url]?console.warn("Asset reference already registered",e):this._assetReferences[e.url]=e),e}unregisterAssetReference(e){e.url&&delete this._assetReferences[e.url]}}const HT=Symbol("assetReference"),Xf=class{constructor(e,t,i=null){u(this,"_loading");u(this,"_asset");u(this,"_glbRoot");u(this,"_url");u(this,"_progressListeners",[]);u(this,"_hash");u(this,"_hashedUri");u(this,"_isLoadingRawBinary",!1);u(this,"_rawBinary");this._url=e,this._hash=t,e.includes("?v=")?this._hashedUri=e:this._hashedUri=t?e+"?v="+t:e,i!==null&&(this.asset=i),g5(this._url,this.onResolvePrefab.bind(this))}static getOrCreateFromUrl(e,t){if(!t&&(t=Ot.Current,!t))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.');const i=t.addressables,n=i.findAssetReference(e);if(n)return n;const r=new Xf(e,t.hash);return i.registerAssetReference(r),r}static getOrCreate(e,t,i){if(typeof e=="string"){if(!i&&(i=Ot.Current,!i))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.')}else i=e.context,e=e.sourceId;const n=zd(e,t);Hu&&console.log("GetOrCreate Addressable from",e,t,"FinalPath=",n);const r=i.addressables,o=r.findAssetReference(n);if(o)return o;const a=new Xf(n,i.hash);return r.registerAssetReference(a),a}get asset(){return this._glbRoot??this._asset}set asset(e){this._asset=e}get uri(){return this._url}get url(){return this._url}get hasUrl(){return this._url!==void 0&&(this._url.startsWith("http")||this._url.startsWith("blob:")||this._url.startsWith("www.")||this._url.includes("/"))}get rawAsset(){return this._asset}async onResolvePrefab(e){return e===this.url&&(this.mustLoad&&await this.loadAssetAsync(),this.asset)?this.asset:null}get mustLoad(){return!this.asset||this.asset.__destroyed===!0||Up(this.asset)===!0}isLoaded(){return this._rawBinary||this.asset!==void 0}unload(){this.asset&&(Hu&&console.log("Unload",this.asset),this.asset.scene&&ba(this.asset.scene,!0,!0),ba(this.asset,!0,!0)),this.asset=null,this._rawBinary=void 0,this._glbRoot=null,this._loading=void 0,Ot.Current&&Ot.Current.addressables.unregisterAssetReference(this)}async preload(){if(!this.mustLoad||this._isLoadingRawBinary)return null;if(this._rawBinary!==void 0)return this._rawBinary;this._isLoadingRawBinary=!0,Hu&&console.log("Preload",this._hashedUri);const e=await z5(this._hashedUri,t=>{this.raiseProgressEvent(t)});return this._rawBinary=(e==null?void 0:e.buffer)??null,this._isLoadingRawBinary=!1,this._rawBinary}async loadAssetAsync(e){if(Hu&&console.log("loadAssetAsync",this.url),!this.mustLoad)return this.asset;if(e&&this._progressListeners.push(e),this._loading!==void 0)return this._loading.then(n=>this.asset);const t=Ot.Current;this._rawBinary?(this._loading=Fl().parseSync(t,this._rawBinary,this.url,null),this.raiseProgressEvent(new ProgressEvent("progress",{loaded:this._rawBinary.byteLength,total:this._rawBinary.byteLength}))):(Hu&&console.log("Load async",this.url),this._loading=Fl().loadSync(t,this._hashedUri,this.url,null,n=>{this.raiseProgressEvent(n)}));const i=await this._loading;if(this._progressListeners.length=0,this._glbRoot=this.tryGetActualGameObjectRoot(i),this._loading=void 0,i)return i[HT]=this,this._glbRoot&&(this._glbRoot[HT]=this),this.asset&&(this.asset[HT]=this),fS(t),i.scene!==void 0&&(this.asset=i),this.asset}async instantiate(e){return this.onInstantiate(e,!1)}async instantiateSynced(e,t=!0){return this.onInstantiate(e,!0,t)}beginListenDownload(e){this._progressListeners.indexOf(e)<0&&this._progressListeners.push(e)}endListenDownload(e){const t=this._progressListeners.indexOf(e);t>=0&&this._progressListeners.splice(t,1)}raiseProgressEvent(e){for(const t of this._progressListeners)t(this,e)}async onInstantiate(e,t=!1,i){const n=Ot.Current,r=new Gl;if(e instanceof ge?r.parent=e:e&&(Object.assign(r,e),r.cloneAssign(e)),r.parent||(r.parent=n.scene),this.mustLoad&&await this.loadAssetAsync(),Hu&&console.log("Instantiate",this.url,"parent:",e),this.asset){Hu&&console.log("Add to scene",this.asset);let o=Xf.currentlyInstantiating.get(this.url);if(o!==void 0&&o>=1e4)return console.error("Recursive or too many instantiations of "+this.url+" in the same frame ("+o+")"),null;try{if(o===void 0&&(o=0),o+=1,Xf.currentlyInstantiating.set(this.url,o),t){r.context=n;const a=this.asset;a.guid=this.url;const l=ID(a,r,void 0,i);if(l)return l}else{const a=Sv(this.asset,r);if(a)return a}}finally{n.post_render_callbacks.push(()=>{o===void 0||o<0?o=0:o-=1,Xf.currentlyInstantiating.set(this.url,o)})}}else Hu&&console.warn("Failed to load asset",this.url);return null}tryGetActualGameObjectRoot(e){if(e&&e.scene){const t=e.scene;return t.isGroup&&t.children.length===1&&t.children[0].name+"glb"===t.name?t.children[0]:t}return null}};let si=Xf;u(si,"currentlyInstantiating",new Map);class $re extends tl{constructor(){super([si],"AssetReferenceSerializer")}onSerialize(e,t){if(e&&e.uri!==void 0&&typeof e.uri=="string")return e.uri}onDeserialize(e,t){if(typeof e=="string")return t.context?t.gltfId?si.getOrCreate(t.gltfId,e,t.context):(console.error("Missing source id"),null):(console.error("Missing context"),null);if(e instanceof ge){if(!t.context)return console.error("Missing context"),null;if(!t.gltfId)return console.error("Missing source id"),null;const i=e,n=t.context,r=i.guid??i.uuid,o=n.addressables.findAssetReference(r);if(o)return o;const a=new si(r,void 0,i);return n.addressables.registerAssetReference(a),a}return null}}new $re;const eoe=Promise.resolve(null),zA=class{constructor(e){u(this,"url");u(this,"_bitmap");u(this,"_bitmapObject");u(this,"loader",null);this.url=e}static getOrCreate(e){let t=zA.imageReferences.get(e);return t||(t=new zA(e),zA.imageReferences.set(e,t)),t}dispose(){this._bitmapObject&&this._bitmapObject.close(),this._bitmap=void 0}createHTMLImage(){const e=new Image;return e.src=this.url,e}createTexture(){return this.url?(this.loader||(this.loader=new Xa),this.loader.setCrossOrigin("anonymous"),this.loader.loadAsync(this.url)):eoe}getBitmap(){return this._bitmap?this._bitmap:(this._bitmap=new Promise((e,t)=>{const i=document.createElement("img");i.addEventListener("load",()=>{this._bitmap=createImageBitmap(i).then(n=>(this._bitmapObject=n,e(n),n))}),i.addEventListener("error",n=>{console.error("Failed to load image:"+this.url,n),e(null)}),i.src=this.url}),this._bitmap)}};let Og=zA;u(Og,"imageReferences",new Map);class H5 extends tl{constructor(){super([Og],"ImageReferenceSerializer")}onSerialize(e,t){return null}onDeserialize(e,t){if(typeof e=="string"){const i=zd(t.gltfId,e);return Og.getOrCreate(i)}}}new H5;const GA=class{constructor(e){u(this,"url");u(this,"res");this.url=e}static getOrCreate(e){let t=GA.cache.get(e);return t||(t=new GA(e),GA.cache.set(e,t)),t}async loadRaw(){return this.res||(this.res=fetch(this.url)),this.res.then(e=>e.blob())}async loadText(){return this.res||(this.res=fetch(this.url)),this.res.then(e=>e.text())}};let Lg=GA;u(Lg,"cache",new Map);class V5 extends tl{constructor(){super([Lg],"FileReferenceSerializer")}onSerialize(e,t){return null}onDeserialize(e,t){if(typeof e=="string"){const i=zd(t.gltfId,e);return Lg.getOrCreate(i)}}}new V5;class toe{constructor(e){u(this,"context");u(this,"mixers",[]);this.context=e}onDestroy(){this.mixers.forEach(e=>e.stopAllAction()),this.mixers.length=0}registerAnimationMixer(e){if(!e){console.warn("AnimationsRegistry.registerAnimationMixer called with null or undefined mixer");return}this.mixers.includes(e)||this.mixers.push(e)}unregisterAnimationMixer(e){if(!e){console.warn("AnimationsRegistry.unregisterAnimationMixer called with null or undefined mixer");return}const t=this.mixers.indexOf(e);t!==-1&&this.mixers.splice(t,1)}}class nv{static tryGetActionsFromMixer(e){const t=e._actions;return t||null}static tryGetAnimationClipsFromObjectHierarchy(e,t){if(t||(t=new Array),e)e.animations&&t.push(...e.animations);else return t;if(e.children)for(const i of e.children)this.tryGetAnimationClipsFromObjectHierarchy(i,t);return t}static assignAnimationsFromFile(e,t){if(!e||!e.animations){console.debug("No animations found in file");return}for(let n=0;n<e.animations.length;n++){const r=e.animations[n];if(!r.tracks||r.tracks.length<=0){console.warn("Animation has no tracks");continue}for(const o in r.tracks){const a=r.tracks[o],l=Xt.parseTrackName(a.name);let c=Xt.findNode(e.scene,l.nodeName);if(!c){const d=a.__objectName??a.name.substring(0,a.name.indexOf("."));if(c=e.scene.getObjectByProperty("uuid",d),!c)continue}let h=i(c);if(!h){if(!(t!=null&&t.createAnimationComponent)){console.warn("No AnimationComponent found in parent hierarchy of object and no 'createAnimationComponent' callback was provided in options.");continue}h=t.createAnimationComponent(e.scene,r)}h.addClip&&h.addClip(r)}}function i(n){var o;if(!n)return null;const r=(o=n.userData)==null?void 0:o.components;if(r&&r.length>0){for(let a=0;a<r.length;a++)if(r[a].isAnimationComponent===!0)return n}return i(n.parent)}}}var vd;(function(s){s.Visible="application-visible",s.Hidden="application-hidden",s.MuteChanged="application-mutechanged"})(vd||(vd={}));let vS=!1;const cg=[];function Yp(){if(vS)return;Xe()&&console.debug("User interaction registered: audio can now be played"),vS=!0;const s=[...cg];cg.length=0,s.forEach(e=>e())}document.addEventListener("mousedown",Yp);document.addEventListener("pointerup",Yp);document.addEventListener("click",Yp);document.addEventListener("dragstart",Yp);document.addEventListener("touchend",Yp);document.addEventListener("keydown",Yp);It.onXRSessionStart(()=>{Yp()});const h2=class extends EventTarget{constructor(t){super();u(this,"_mute",!1);u(this,"context");u(this,"_isVisible",!0);this.context=t,window.addEventListener("visibilitychange",this.onVisiblityChanged.bind(this),!1)}static get userInteractionRegistered(){return vS}static registerWaitForInteraction(t){if(t!==null){if(vS){t();return}cg.indexOf(t)===-1&&cg.push(t)}}static unregisterWaitForInteraction(t){const i=cg.indexOf(t);i!==-1&&cg.splice(i,1)}get muted(){return this._mute}set muted(t){t!==this._mute&&(this._mute=t,this.dispatchEvent(new Event(vd.MuteChanged)))}get hasFocus(){return document.hasFocus()}get isVisible(){return this._isVisible}onVisiblityChanged(t){switch(t.target.visibilityState){case"hidden":this._isVisible=!1,this.dispatchEvent(new Event(vd.Hidden));break;case"visible":this._isVisible=!0,this.dispatchEvent(new Event(vd.Visible));break}}};let Bl=h2;u(Bl,"registerWaitForAllowAudio",h2.registerWaitForInteraction);function*Q5(s,e=null){const t=e?e.time:Ot.Current.time,i=t.time;for(;t.time-i<s;)yield}function*ioe(s){for(let e=0;e<s;e++)yield}function*j5(s){let e=!0;for(s.then(()=>e=!1),s.catch(()=>e=!1);e;)yield}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var oU=function(s){return URL.createObjectURL(new Blob([s],{type:"text/javascript"}))};try{URL.revokeObjectURL(oU(""))}catch{oU=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var gs=Uint8Array,yo=Uint16Array,sv=Uint32Array,gE=new gs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),vE=new gs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),OR=new gs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),W5=function(s,e){for(var t=new yo(31),i=0;i<31;++i)t[i]=e+=1<<s[i-1];for(var n=new sv(t[30]),i=1;i<30;++i)for(var r=t[i];r<t[i+1];++r)n[r]=r-t[i]<<5|i;return[t,n]},q5=W5(gE,2),X5=q5[0],LR=q5[1];X5[28]=258,LR[258]=28;var Y5=W5(vE,0),noe=Y5[0],aU=Y5[1],kR=new yo(32768);for(var yn=0;yn<32768;++yn){var Vu=(yn&43690)>>>1|(yn&21845)<<1;Vu=(Vu&52428)>>>2|(Vu&13107)<<2,Vu=(Vu&61680)>>>4|(Vu&3855)<<4,kR[yn]=((Vu&65280)>>>8|(Vu&255)<<8)>>>1}var Fc=function(s,e,t){for(var i=s.length,n=0,r=new yo(e);n<i;++n)++r[s[n]-1];var o=new yo(e);for(n=0;n<e;++n)o[n]=o[n-1]+r[n-1]<<1;var a;if(t){a=new yo(1<<e);var l=15-e;for(n=0;n<i;++n)if(s[n])for(var c=n<<4|s[n],h=e-s[n],d=o[s[n]-1]++<<h,f=d|(1<<h)-1;d<=f;++d)a[kR[d]>>>l]=c}else for(a=new yo(i),n=0;n<i;++n)s[n]&&(a[n]=kR[o[s[n]-1]++]>>>15-s[n]);return a},Pd=new gs(288);for(var yn=0;yn<144;++yn)Pd[yn]=8;for(var yn=144;yn<256;++yn)Pd[yn]=9;for(var yn=256;yn<280;++yn)Pd[yn]=7;for(var yn=280;yn<288;++yn)Pd[yn]=8;var b0=new gs(32);for(var yn=0;yn<32;++yn)b0[yn]=5;var soe=Fc(Pd,9,0),roe=Fc(Pd,9,1),ooe=Fc(b0,5,0),aoe=Fc(b0,5,1),VT=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},ul=function(s,e,t){var i=e/8|0;return(s[i]|s[i+1]<<8)>>(e&7)&t},QT=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(e&7)},FD=function(s){return(s/8|0)+(s&7&&1)},UD=function(s,e,t){(e==null||e<0)&&(e=0),(t==null||t>s.length)&&(t=s.length);var i=new(s instanceof yo?yo:s instanceof sv?sv:gs)(t-e);return i.set(s.subarray(e,t)),i},loe=function(s,e,t){var i=s.length;if(!i||t&&!t.l&&i<5)return e||new gs(0);var n=!e||t,r=!t||t.i;t||(t={}),e||(e=new gs(i*3));var o=function(Ae){var je=e.length;if(Ae>je){var Be=new gs(Math.max(je*2,Ae));Be.set(e),e=Be}},a=t.f||0,l=t.p||0,c=t.b||0,h=t.l,d=t.d,f=t.m,p=t.n,m=i*8;do{if(!h){t.f=a=ul(s,l,1);var v=ul(s,l+1,3);if(l+=3,v)if(v==1)h=roe,d=aoe,f=9,p=5;else if(v==2){var A=ul(s,l,31)+257,b=ul(s,l+10,15)+4,E=A+ul(s,l+5,31)+1;l+=14;for(var C=new gs(E),T=new gs(19),M=0;M<b;++M)T[OR[M]]=ul(s,l+M*3,7);l+=b*3;for(var R=VT(T),S=(1<<R)-1,I=Fc(T,R,1),M=0;M<E;){var L=I[ul(s,l,S)];l+=L&15;var y=L>>>4;if(y<16)C[M++]=y;else{var U=0,D=0;for(y==16?(D=3+ul(s,l,3),l+=2,U=C[M-1]):y==17?(D=3+ul(s,l,7),l+=3):y==18&&(D=11+ul(s,l,127),l+=7);D--;)C[M++]=U}}var V=C.subarray(0,A),O=C.subarray(A);f=VT(V),p=VT(O),h=Fc(V,f,1),d=Fc(O,p,1)}else throw"invalid block type";else{var y=FD(l)+4,g=s[y-4]|s[y-3]<<8,_=y+g;if(_>i){if(r)throw"unexpected EOF";break}n&&o(c+g),e.set(s.subarray(y,_),c),t.b=c+=g,t.p=l=_*8;continue}if(l>m){if(r)throw"unexpected EOF";break}}n&&o(c+131072);for(var F=(1<<f)-1,N=(1<<p)-1,q=l;;q=l){var U=h[QT(s,l)&F],$=U>>>4;if(l+=U&15,l>m){if(r)throw"unexpected EOF";break}if(!U)throw"invalid length/literal";if($<256)e[c++]=$;else if($==256){q=l,h=null;break}else{var oe=$-254;if($>264){var M=$-257,ae=gE[M];oe=ul(s,l,(1<<ae)-1)+X5[M],l+=ae}var Re=d[QT(s,l)&N],se=Re>>>4;if(!Re)throw"invalid distance";l+=Re&15;var O=noe[se];if(se>3){var ae=vE[se];O+=QT(s,l)&(1<<ae)-1,l+=ae}if(l>m){if(r)throw"unexpected EOF";break}n&&o(c+131072);for(var ye=c+oe;c<ye;c+=4)e[c]=e[c-O],e[c+1]=e[c+1-O],e[c+2]=e[c+2-O],e[c+3]=e[c+3-O];c=ye}}t.l=h,t.p=q,t.b=c,h&&(a=1,t.m=f,t.d=d,t.n=p)}while(!a);return c==e.length?e:UD(e,0,c)},_h=function(s,e,t){t<<=e&7;var i=e/8|0;s[i]|=t,s[i+1]|=t>>>8},py=function(s,e,t){t<<=e&7;var i=e/8|0;s[i]|=t,s[i+1]|=t>>>8,s[i+2]|=t>>>16},jT=function(s,e){for(var t=[],i=0;i<s.length;++i)s[i]&&t.push({s:i,f:s[i]});var n=t.length,r=t.slice();if(!n)return[ND,0];if(n==1){var o=new gs(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(E,C){return E.f-C.f}),t.push({s:-1,f:25001});var a=t[0],l=t[1],c=0,h=1,d=2;for(t[0]={s:-1,f:a.f+l.f,l:a,r:l};h!=n-1;)a=t[t[c].f<t[d].f?c++:d++],l=t[c!=h&&t[c].f<t[d].f?c++:d++],t[h++]={s:-1,f:a.f+l.f,l:a,r:l};for(var f=r[0].s,i=1;i<n;++i)r[i].s>f&&(f=r[i].s);var p=new yo(f+1),m=FR(t[h-1],p,0);if(m>e){var i=0,v=0,y=m-e,g=1<<y;for(r.sort(function(C,T){return p[T.s]-p[C.s]||C.f-T.f});i<n;++i){var _=r[i].s;if(p[_]>e)v+=g-(1<<m-p[_]),p[_]=e;else break}for(v>>>=y;v>0;){var A=r[i].s;p[A]<e?v-=1<<e-p[A]++-1:++i}for(;i>=0&&v;--i){var b=r[i].s;p[b]==e&&(--p[b],++v)}m=e}return[new gs(p),m]},FR=function(s,e,t){return s.s==-1?Math.max(FR(s.l,e,t+1),FR(s.r,e,t+1)):e[s.s]=t},lU=function(s){for(var e=s.length;e&&!s[--e];);for(var t=new yo(++e),i=0,n=s[0],r=1,o=function(l){t[i++]=l},a=1;a<=e;++a)if(s[a]==n&&a!=e)++r;else{if(!n&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(n),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(n);r=1,n=s[a]}return[t.subarray(0,i),e]},my=function(s,e){for(var t=0,i=0;i<e.length;++i)t+=s[i]*e[i];return t},Ew=function(s,e,t){var i=t.length,n=FD(e+2);s[n]=i&255,s[n+1]=i>>>8,s[n+2]=s[n]^255,s[n+3]=s[n+1]^255;for(var r=0;r<i;++r)s[n+r+4]=t[r];return(n+4+i)*8},cU=function(s,e,t,i,n,r,o,a,l,c,h){_h(e,h++,t),++n[256];for(var d=jT(n,15),f=d[0],p=d[1],m=jT(r,15),v=m[0],y=m[1],g=lU(f),_=g[0],A=g[1],b=lU(v),E=b[0],C=b[1],T=new yo(19),M=0;M<_.length;++M)T[_[M]&31]++;for(var M=0;M<E.length;++M)T[E[M]&31]++;for(var R=jT(T,7),S=R[0],I=R[1],L=19;L>4&&!S[OR[L-1]];--L);var U=c+5<<3,D=my(n,Pd)+my(r,b0)+o,V=my(n,f)+my(r,v)+o+14+3*L+my(T,S)+(2*T[16]+3*T[17]+7*T[18]);if(U<=D&&U<=V)return Ew(e,h,s.subarray(l,l+c));var O,F,N,q;if(_h(e,h,1+(V<D)),h+=2,V<D){O=Fc(f,p,0),F=f,N=Fc(v,y,0),q=v;var $=Fc(S,I,0);_h(e,h,A-257),_h(e,h+5,C-1),_h(e,h+10,L-4),h+=14;for(var M=0;M<L;++M)_h(e,h+3*M,S[OR[M]]);h+=3*L;for(var oe=[_,E],ae=0;ae<2;++ae)for(var Re=oe[ae],M=0;M<Re.length;++M){var se=Re[M]&31;_h(e,h,$[se]),h+=S[se],se>15&&(_h(e,h,Re[M]>>>5&127),h+=Re[M]>>>12)}}else O=soe,F=Pd,N=ooe,q=b0;for(var M=0;M<a;++M)if(i[M]>255){var se=i[M]>>>18&31;py(e,h,O[se+257]),h+=F[se+257],se>7&&(_h(e,h,i[M]>>>23&31),h+=gE[se]);var ye=i[M]&31;py(e,h,N[ye]),h+=q[ye],ye>3&&(py(e,h,i[M]>>>5&8191),h+=vE[ye])}else py(e,h,O[i[M]]),h+=F[i[M]];return py(e,h,O[256]),h+F[256]},coe=new sv([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ND=new gs(0),hoe=function(s,e,t,i,n,r){var o=s.length,a=new gs(i+o+5*(1+Math.ceil(o/7e3))+n),l=a.subarray(i,a.length-n),c=0;if(!e||o<8)for(var h=0;h<=o;h+=65535){var d=h+65535;d<o?c=Ew(l,c,s.subarray(h,d)):(l[h]=r,c=Ew(l,c,s.subarray(h,o)))}else{for(var f=coe[e-1],p=f>>>13,m=f&8191,v=(1<<t)-1,y=new yo(32768),g=new yo(v+1),_=Math.ceil(t/3),A=2*_,b=function(we){return(s[we]^s[we+1]<<_^s[we+2]<<A)&v},E=new sv(25e3),C=new yo(288),T=new yo(32),M=0,R=0,h=0,S=0,I=0,L=0;h<o;++h){var U=b(h),D=h&32767,V=g[U];if(y[D]=V,g[U]=D,I<=h){var O=o-h;if((M>7e3||S>24576)&&O>423){c=cU(s,l,0,E,C,T,R,S,L,h-L,c),S=M=R=0,L=h;for(var F=0;F<286;++F)C[F]=0;for(var F=0;F<30;++F)T[F]=0}var N=2,q=0,$=m,oe=D-V&32767;if(O>2&&U==b(h-oe))for(var ae=Math.min(p,O)-1,Re=Math.min(32767,h),se=Math.min(258,O);oe<=Re&&--$&&D!=V;){if(s[h+N]==s[h+N-oe]){for(var ye=0;ye<se&&s[h+ye]==s[h+ye-oe];++ye);if(ye>N){if(N=ye,q=oe,ye>ae)break;for(var Ae=Math.min(oe,ye-2),je=0,F=0;F<Ae;++F){var Be=h-oe+F+32768&32767,We=y[Be],lt=Be-We+32768&32767;lt>je&&(je=lt,V=Be)}}}D=V,V=y[D],oe+=D-V+32768&32767}if(q){E[S++]=268435456|LR[N]<<18|aU[q];var rt=LR[N]&31,W=aU[q]&31;R+=gE[rt]+vE[W],++C[257+rt],++T[W],I=h+N,++M}else E[S++]=s[h],++C[s[h]]}}c=cU(s,l,r,E,C,T,R,S,L,h-L,c),!r&&c&7&&(c=Ew(l,c+1,ND))}return UD(a,0,i+FD(c)+n)},uoe=function(){for(var s=new sv(256),e=0;e<256;++e){for(var t=e,i=9;--i;)t=(t&1&&3988292384)^t>>>1;s[e]=t}return s}(),doe=function(){var s=-1;return{p:function(e){for(var t=s,i=0;i<e.length;++i)t=uoe[t&255^e[i]]^t>>>8;s=t},d:function(){return~s}}},foe=function(s,e,t,i,n){return hoe(s,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(s.length)))*1.5):12+e.mem,t,i,!n)},K5=function(s,e){var t={};for(var i in s)t[i]=s[i];for(var i in e)t[i]=e[i];return t},pr=function(s,e,t){for(;t;++e)s[e]=t,t>>>=8},poe=function(s){if((s[0]&15)!=8||s[0]>>>4>7||(s[0]<<8|s[1])%31)throw"invalid zlib data";if(s[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function moe(s,e){return foe(s,e||{},0,0)}function Xy(s,e){return loe((poe(s),s.subarray(2,-4)),e)}var J5=function(s,e,t,i){for(var n in s){var r=s[n],o=e+n;r instanceof gs?t[o]=[r,i]:Array.isArray(r)?t[o]=[r[0],K5(i,r[1])]:J5(r,o+"/",t,i)}},hU=typeof TextEncoder<"u"&&new TextEncoder,goe=typeof TextDecoder<"u"&&new TextDecoder,voe=0;try{goe.decode(ND,{stream:!0}),voe=1}catch{}function yS(s,e){if(e){for(var t=new gs(s.length),i=0;i<s.length;++i)t[i]=s.charCodeAt(i);return t}if(hU)return hU.encode(s);for(var n=s.length,r=new gs(s.length+(s.length>>1)),o=0,a=function(h){r[o++]=h},i=0;i<n;++i){if(o+5>r.length){var l=new gs(o+8+(n-i<<1));l.set(r),r=l}var c=s.charCodeAt(i);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|c&63)):c>55295&&c<57344?(c=65536+(c&1047552)|s.charCodeAt(++i)&1023,a(240|c>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|c&63)):(a(224|c>>12),a(128|c>>6&63),a(128|c&63))}return UD(r,0,o)}var UR=function(s){var e=0;if(s)for(var t in s){var i=s[t].length;if(i>65535)throw"extra field too long";e+=i+4}return e},uU=function(s,e,t,i,n,r,o,a){var l=i.length,c=t.extra,h=a&&a.length,d=UR(c);pr(s,e,o!=null?33639248:67324752),e+=4,o!=null&&(s[e++]=20,s[e++]=t.os),s[e]=20,e+=2,s[e++]=t.flag<<1|(r==null&&8),s[e++]=n&&8,s[e++]=t.compression&255,s[e++]=t.compression>>8;var f=new Date(t.mtime==null?Date.now():t.mtime),p=f.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(pr(s,e,p<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),e+=4,r!=null&&(pr(s,e,t.crc),pr(s,e+4,r),pr(s,e+8,t.size)),pr(s,e+12,l),pr(s,e+14,d),e+=16,o!=null&&(pr(s,e,h),pr(s,e+6,t.attrs),pr(s,e+10,o),e+=14),s.set(i,e),e+=l,d)for(var m in c){var v=c[m],y=v.length;pr(s,e,+m),pr(s,e+2,y),s.set(v,e+4),e+=4+y}return h&&(s.set(a,e),e+=h),e},yoe=function(s,e,t,i,n){pr(s,e,101010256),pr(s,e+8,t),pr(s,e+10,t),pr(s,e+12,i),pr(s,e+16,n)};function Aoe(s,e){e||(e={});var t={},i=[];J5(s,"",t,e);var n=0,r=0;for(var o in t){var a=t[o],l=a[0],c=a[1],h=c.level==0?0:8,d=yS(o),f=d.length,p=c.comment,m=p&&yS(p),v=m&&m.length,y=UR(c.extra);if(f>65535)throw"filename too long";var g=h?moe(l,c):l,_=g.length,A=doe();A.p(l),i.push(K5(c,{size:l.length,crc:A.d(),c:g,f:d,m,u:f!=o.length||m&&p.length!=v,o:n,compression:h})),n+=30+f+y+_,r+=76+2*(f+y)+(v||0)+_}for(var b=new gs(r+22),E=n,C=r-n,T=0;T<i.length;++T){var d=i[T];uU(b,d.o,d,d.f,d.u,d.c.length);var M=30+d.f.length+UR(d.extra);b.set(d.c,d.o+M),uU(b,n,d,d.f,d.u,d.c.length,d.o,d.m),n+=16+M+(d.m?d.m.length:0)}return yoe(b,n,i.length,C,E),b}class x0 extends uB{constructor(e){super(e),this.type=$i}parse(e){const R=Math.pow(2.7182818,2.2);function S(B,z){let J=0;for(let G=0;G<65536;++G)(G==0||B[G>>3]&1<<(G&7))&&(z[J++]=G);const P=J-1;for(;J<65536;)z[J++]=0;return P}function I(B){for(let z=0;z<16384;z++)B[z]={},B[z].len=0,B[z].lit=0,B[z].p=null}const L={l:0,c:0,lc:0};function U(B,z,J,P,G){for(;J<B;)z=z<<8|Ye(P,G),J+=8;J-=B,L.l=z>>J&(1<<B)-1,L.c=z,L.lc=J}const D=new Array(59);function V(B){for(let J=0;J<=58;++J)D[J]=0;for(let J=0;J<65537;++J)D[B[J]]+=1;let z=0;for(let J=58;J>0;--J){const P=z+D[J]>>1;D[J]=z,z=P}for(let J=0;J<65537;++J){const P=B[J];P>0&&(B[J]=P|D[P]++<<6)}}function O(B,z,J,P,G,Q){const Y=z;let K=0,pe=0;for(;P<=G;P++){if(Y.value-z.value>J)return!1;U(6,K,pe,B,Y);const ue=L.l;if(K=L.c,pe=L.lc,Q[P]=ue,ue==63){if(Y.value-z.value>J)throw new Error("Something wrong with hufUnpackEncTable");U(8,K,pe,B,Y);let be=L.l+6;if(K=L.c,pe=L.lc,P+be>G+1)throw new Error("Something wrong with hufUnpackEncTable");for(;be--;)Q[P++]=0;P--}else if(ue>=59){let be=ue-59+2;if(P+be>G+1)throw new Error("Something wrong with hufUnpackEncTable");for(;be--;)Q[P++]=0;P--}}V(Q)}function F(B){return B&63}function N(B){return B>>6}function q(B,z,J,P){for(;z<=J;z++){const G=N(B[z]),Q=F(B[z]);if(G>>Q)throw new Error("Invalid table entry");if(Q>14){const Y=P[G>>Q-14];if(Y.len)throw new Error("Invalid table entry");if(Y.lit++,Y.p){const K=Y.p;Y.p=new Array(Y.lit);for(let pe=0;pe<Y.lit-1;++pe)Y.p[pe]=K[pe]}else Y.p=new Array(1);Y.p[Y.lit-1]=z}else if(Q){let Y=0;for(let K=1<<14-Q;K>0;K--){const pe=P[(G<<14-Q)+Y];if(pe.len||pe.p)throw new Error("Invalid table entry");pe.len=Q,pe.lit=z,Y++}}}return!0}const $={c:0,lc:0};function oe(B,z,J,P){B=B<<8|Ye(J,P),z+=8,$.c=B,$.lc=z}const ae={c:0,lc:0};function Re(B,z,J,P,G,Q,Y,K,pe){if(B==z){P<8&&(oe(J,P,G,Q),J=$.c,P=$.lc),P-=8;let ue=J>>P;if(ue=new Uint8Array([ue])[0],K.value+ue>pe)return!1;const be=Y[K.value-1];for(;ue-- >0;)Y[K.value++]=be}else if(K.value<pe)Y[K.value++]=B;else return!1;ae.c=J,ae.lc=P}function se(B){return B&65535}function ye(B){const z=se(B);return z>32767?z-65536:z}const Ae={a:0,b:0};function je(B,z){const J=ye(B),G=ye(z),Q=J+(G&1)+(G>>1),Y=Q,K=Q-G;Ae.a=Y,Ae.b=K}function Be(B,z){const J=se(B),P=se(z),G=J-(P>>1)&65535,Q=P+G-32768&65535;Ae.a=Q,Ae.b=G}function We(B,z,J,P,G,Q,Y){const K=Y<16384,pe=J>G?G:J;let ue=1,be,De;for(;ue<=pe;)ue<<=1;for(ue>>=1,be=ue,ue>>=1;ue>=1;){De=0;const Le=De+Q*(G-be),Qe=Q*ue,$e=Q*be,it=P*ue,dt=P*be;let Bt,Bi,Zt,Ft;for(;De<=Le;De+=$e){let Wi=De;const Mt=De+P*(J-be);for(;Wi<=Mt;Wi+=dt){const Ki=Wi+it,Zr=Wi+Qe,Sn=Zr+it;K?(je(B[Wi+z],B[Zr+z]),Bt=Ae.a,Zt=Ae.b,je(B[Ki+z],B[Sn+z]),Bi=Ae.a,Ft=Ae.b,je(Bt,Bi),B[Wi+z]=Ae.a,B[Ki+z]=Ae.b,je(Zt,Ft),B[Zr+z]=Ae.a,B[Sn+z]=Ae.b):(Be(B[Wi+z],B[Zr+z]),Bt=Ae.a,Zt=Ae.b,Be(B[Ki+z],B[Sn+z]),Bi=Ae.a,Ft=Ae.b,Be(Bt,Bi),B[Wi+z]=Ae.a,B[Ki+z]=Ae.b,Be(Zt,Ft),B[Zr+z]=Ae.a,B[Sn+z]=Ae.b)}if(J&ue){const Ki=Wi+Qe;K?je(B[Wi+z],B[Ki+z]):Be(B[Wi+z],B[Ki+z]),Bt=Ae.a,B[Ki+z]=Ae.b,B[Wi+z]=Bt}}if(G&ue){let Wi=De;const Mt=De+P*(J-be);for(;Wi<=Mt;Wi+=dt){const Ki=Wi+it;K?je(B[Wi+z],B[Ki+z]):Be(B[Wi+z],B[Ki+z]),Bt=Ae.a,B[Ki+z]=Ae.b,B[Wi+z]=Bt}}be=ue,ue>>=1}return De}function lt(B,z,J,P,G,Q,Y,K,pe){let ue=0,be=0;const De=Y,Le=Math.trunc(P.value+(G+7)/8);for(;P.value<Le;)for(oe(ue,be,J,P),ue=$.c,be=$.lc;be>=14;){const $e=ue>>be-14&16383,it=z[$e];if(it.len)be-=it.len,Re(it.lit,Q,ue,be,J,P,K,pe,De),ue=ae.c,be=ae.lc;else{if(!it.p)throw new Error("hufDecode issues");let dt;for(dt=0;dt<it.lit;dt++){const Bt=F(B[it.p[dt]]);for(;be<Bt&&P.value<Le;)oe(ue,be,J,P),ue=$.c,be=$.lc;if(be>=Bt&&N(B[it.p[dt]])==(ue>>be-Bt&(1<<Bt)-1)){be-=Bt,Re(it.p[dt],Q,ue,be,J,P,K,pe,De),ue=ae.c,be=ae.lc;break}}if(dt==it.lit)throw new Error("hufDecode issues")}}const Qe=8-G&7;for(ue>>=Qe,be-=Qe;be>0;){const $e=z[ue<<14-be&16383];if($e.len)be-=$e.len,Re($e.lit,Q,ue,be,J,P,K,pe,De),ue=ae.c,be=ae.lc;else throw new Error("hufDecode issues")}return!0}function rt(B,z,J,P,G,Q){const Y={value:0},K=J.value,pe=gt(z,J),ue=gt(z,J);J.value+=4;const be=gt(z,J);if(J.value+=4,pe<0||pe>=65537||ue<0||ue>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const De=new Array(65537),Le=new Array(16384);I(Le);const Qe=P-(J.value-K);if(O(B,J,Qe,pe,ue,De),be>8*(P-(J.value-K)))throw new Error("Something wrong with hufUncompress");q(De,pe,ue,Le),lt(De,Le,B,J,be,ue,Q,G,Y)}function W(B,z,J){for(let P=0;P<J;++P)z[P]=B[z[P]]}function Ge(B){for(let z=1;z<B.length;z++){const J=B[z-1]+B[z]-128;B[z]=J}}function we(B,z){let J=0,P=Math.floor((B.length+1)/2),G=0;const Q=B.length-1;for(;!(G>Q||(z[G++]=B[J++],G>Q));)z[G++]=B[P++]}function Ne(B){let z=B.byteLength;const J=new Array;let P=0;const G=new DataView(B);for(;z>0;){const Q=G.getInt8(P++);if(Q<0){const Y=-Q;z-=Y+1;for(let K=0;K<Y;K++)J.push(G.getUint8(P++))}else{const Y=Q;z-=2;const K=G.getUint8(P++);for(let pe=0;pe<Y+1;pe++)J.push(K)}}return J}function Ee(B,z,J,P,G,Q){let Y=new DataView(Q.buffer);const K=J[B.idx[0]].width,pe=J[B.idx[0]].height,ue=3,be=Math.floor(K/8),De=Math.ceil(K/8),Le=Math.ceil(pe/8),Qe=K-(De-1)*8,$e=pe-(Le-1)*8,it={value:0},dt=new Array(ue),Bt=new Array(ue),Bi=new Array(ue),Zt=new Array(ue),Ft=new Array(ue);for(let Mt=0;Mt<ue;++Mt)Ft[Mt]=z[B.idx[Mt]],dt[Mt]=Mt<1?0:dt[Mt-1]+De*Le,Bt[Mt]=new Float32Array(64),Bi[Mt]=new Uint16Array(64),Zt[Mt]=new Uint16Array(De*64);for(let Mt=0;Mt<Le;++Mt){let Ki=8;Mt==Le-1&&(Ki=$e);let Zr=8;for(let Ii=0;Ii<De;++Ii){Ii==De-1&&(Zr=Qe);for(let ti=0;ti<ue;++ti)Bi[ti].fill(0),Bi[ti][0]=G[dt[ti]++],st(it,P,Bi[ti]),tt(Bi[ti],Bt[ti]),ct(Bt[ti]);jt(Bt);for(let ti=0;ti<ue;++ti)H(Bt[ti],Zt[ti],Ii*64)}let Sn=0;for(let Ii=0;Ii<ue;++Ii){const ti=J[B.idx[Ii]].type;for(let sr=8*Mt;sr<8*Mt+Ki;++sr){Sn=Ft[Ii][sr];for(let uh=0;uh<be;++uh){const Fn=uh*64+(sr&7)*8;Y.setUint16(Sn+0*2*ti,Zt[Ii][Fn+0],!0),Y.setUint16(Sn+1*2*ti,Zt[Ii][Fn+1],!0),Y.setUint16(Sn+2*2*ti,Zt[Ii][Fn+2],!0),Y.setUint16(Sn+3*2*ti,Zt[Ii][Fn+3],!0),Y.setUint16(Sn+4*2*ti,Zt[Ii][Fn+4],!0),Y.setUint16(Sn+5*2*ti,Zt[Ii][Fn+5],!0),Y.setUint16(Sn+6*2*ti,Zt[Ii][Fn+6],!0),Y.setUint16(Sn+7*2*ti,Zt[Ii][Fn+7],!0),Sn+=8*2*ti}}if(be!=De)for(let sr=8*Mt;sr<8*Mt+Ki;++sr){const uh=Ft[Ii][sr]+8*be*2*ti,Fn=be*64+(sr&7)*8;for(let Ru=0;Ru<Zr;++Ru)Y.setUint16(uh+Ru*2*ti,Zt[Ii][Fn+Ru],!0)}}}const Wi=new Uint16Array(K);Y=new DataView(Q.buffer);for(let Mt=0;Mt<ue;++Mt){J[B.idx[Mt]].decoded=!0;const Ki=J[B.idx[Mt]].type;if(J[Mt].type==2)for(let Zr=0;Zr<pe;++Zr){const Sn=Ft[Mt][Zr];for(let Ii=0;Ii<K;++Ii)Wi[Ii]=Y.getUint16(Sn+Ii*2*Ki,!0);for(let Ii=0;Ii<K;++Ii)Y.setFloat32(Sn+Ii*2*Ki,ce(Wi[Ii]),!0)}}}function st(B,z,J){let P,G=1;for(;G<64;)P=z[B.value],P==65280?G=64:P>>8==255?G+=P&255:(J[G]=P,G++),B.value++}function tt(B,z){z[0]=ce(B[0]),z[1]=ce(B[1]),z[2]=ce(B[5]),z[3]=ce(B[6]),z[4]=ce(B[14]),z[5]=ce(B[15]),z[6]=ce(B[27]),z[7]=ce(B[28]),z[8]=ce(B[2]),z[9]=ce(B[4]),z[10]=ce(B[7]),z[11]=ce(B[13]),z[12]=ce(B[16]),z[13]=ce(B[26]),z[14]=ce(B[29]),z[15]=ce(B[42]),z[16]=ce(B[3]),z[17]=ce(B[8]),z[18]=ce(B[12]),z[19]=ce(B[17]),z[20]=ce(B[25]),z[21]=ce(B[30]),z[22]=ce(B[41]),z[23]=ce(B[43]),z[24]=ce(B[9]),z[25]=ce(B[11]),z[26]=ce(B[18]),z[27]=ce(B[24]),z[28]=ce(B[31]),z[29]=ce(B[40]),z[30]=ce(B[44]),z[31]=ce(B[53]),z[32]=ce(B[10]),z[33]=ce(B[19]),z[34]=ce(B[23]),z[35]=ce(B[32]),z[36]=ce(B[39]),z[37]=ce(B[45]),z[38]=ce(B[52]),z[39]=ce(B[54]),z[40]=ce(B[20]),z[41]=ce(B[22]),z[42]=ce(B[33]),z[43]=ce(B[38]),z[44]=ce(B[46]),z[45]=ce(B[51]),z[46]=ce(B[55]),z[47]=ce(B[60]),z[48]=ce(B[21]),z[49]=ce(B[34]),z[50]=ce(B[37]),z[51]=ce(B[47]),z[52]=ce(B[50]),z[53]=ce(B[56]),z[54]=ce(B[59]),z[55]=ce(B[61]),z[56]=ce(B[35]),z[57]=ce(B[36]),z[58]=ce(B[48]),z[59]=ce(B[49]),z[60]=ce(B[57]),z[61]=ce(B[58]),z[62]=ce(B[62]),z[63]=ce(B[63])}function ct(B){const z=.5*Math.cos(.7853975),J=.5*Math.cos(3.14159/16),P=.5*Math.cos(3.14159/8),G=.5*Math.cos(3*3.14159/16),Q=.5*Math.cos(5*3.14159/16),Y=.5*Math.cos(3*3.14159/8),K=.5*Math.cos(7*3.14159/16),pe=new Array(4),ue=new Array(4),be=new Array(4),De=new Array(4);for(let Le=0;Le<8;++Le){const Qe=Le*8;pe[0]=P*B[Qe+2],pe[1]=Y*B[Qe+2],pe[2]=P*B[Qe+6],pe[3]=Y*B[Qe+6],ue[0]=J*B[Qe+1]+G*B[Qe+3]+Q*B[Qe+5]+K*B[Qe+7],ue[1]=G*B[Qe+1]-K*B[Qe+3]-J*B[Qe+5]-Q*B[Qe+7],ue[2]=Q*B[Qe+1]-J*B[Qe+3]+K*B[Qe+5]+G*B[Qe+7],ue[3]=K*B[Qe+1]-Q*B[Qe+3]+G*B[Qe+5]-J*B[Qe+7],be[0]=z*(B[Qe+0]+B[Qe+4]),be[3]=z*(B[Qe+0]-B[Qe+4]),be[1]=pe[0]+pe[3],be[2]=pe[1]-pe[2],De[0]=be[0]+be[1],De[1]=be[3]+be[2],De[2]=be[3]-be[2],De[3]=be[0]-be[1],B[Qe+0]=De[0]+ue[0],B[Qe+1]=De[1]+ue[1],B[Qe+2]=De[2]+ue[2],B[Qe+3]=De[3]+ue[3],B[Qe+4]=De[3]-ue[3],B[Qe+5]=De[2]-ue[2],B[Qe+6]=De[1]-ue[1],B[Qe+7]=De[0]-ue[0]}for(let Le=0;Le<8;++Le)pe[0]=P*B[16+Le],pe[1]=Y*B[16+Le],pe[2]=P*B[48+Le],pe[3]=Y*B[48+Le],ue[0]=J*B[8+Le]+G*B[24+Le]+Q*B[40+Le]+K*B[56+Le],ue[1]=G*B[8+Le]-K*B[24+Le]-J*B[40+Le]-Q*B[56+Le],ue[2]=Q*B[8+Le]-J*B[24+Le]+K*B[40+Le]+G*B[56+Le],ue[3]=K*B[8+Le]-Q*B[24+Le]+G*B[40+Le]-J*B[56+Le],be[0]=z*(B[Le]+B[32+Le]),be[3]=z*(B[Le]-B[32+Le]),be[1]=pe[0]+pe[3],be[2]=pe[1]-pe[2],De[0]=be[0]+be[1],De[1]=be[3]+be[2],De[2]=be[3]-be[2],De[3]=be[0]-be[1],B[0+Le]=De[0]+ue[0],B[8+Le]=De[1]+ue[1],B[16+Le]=De[2]+ue[2],B[24+Le]=De[3]+ue[3],B[32+Le]=De[3]-ue[3],B[40+Le]=De[2]-ue[2],B[48+Le]=De[1]-ue[1],B[56+Le]=De[0]-ue[0]}function jt(B){for(let z=0;z<64;++z){const J=B[0][z],P=B[1][z],G=B[2][z];B[0][z]=J+1.5747*G,B[1][z]=J-.1873*P-.4682*G,B[2][z]=J+1.8556*P}}function H(B,z,J){for(let P=0;P<64;++P)z[J+P]=ep.toHalfFloat(k(B[P]))}function k(B){return B<=1?Math.sign(B)*Math.pow(Math.abs(B),2.2):Math.sign(B)*Math.pow(R,Math.abs(B)-1)}function ve(B){return new DataView(B.array.buffer,B.offset.value,B.size)}function _e(B){const z=B.viewer.buffer.slice(B.offset.value,B.offset.value+B.size),J=new Uint8Array(Ne(z)),P=new Uint8Array(J.length);return Ge(J),we(J,P),new DataView(P.buffer)}function Pe(B){const z=B.array.slice(B.offset.value,B.offset.value+B.size),J=Xy(z),P=new Uint8Array(J.length);return Ge(J),we(J,P),new DataView(P.buffer)}function Me(B){const z=B.viewer,J={value:B.offset.value},P=new Uint16Array(B.width*B.scanlineBlockSize*(B.channels*B.type)),G=new Uint8Array(8192);let Q=0;const Y=new Array(B.channels);for(let $e=0;$e<B.channels;$e++)Y[$e]={},Y[$e].start=Q,Y[$e].end=Y[$e].start,Y[$e].nx=B.width,Y[$e].ny=B.lines,Y[$e].size=B.type,Q+=Y[$e].nx*Y[$e].ny*Y[$e].size;const K=ee(z,J),pe=ee(z,J);if(pe>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(K<=pe)for(let $e=0;$e<pe-K+1;$e++)G[$e+K]=vt(z,J);const ue=new Uint16Array(65536),be=S(G,ue),De=gt(z,J);rt(B.array,z,J,De,P,Q);for(let $e=0;$e<B.channels;++$e){const it=Y[$e];for(let dt=0;dt<Y[$e].size;++dt)We(P,it.start+dt,it.nx,it.size,it.ny,it.nx*it.size,be)}W(ue,P,Q);let Le=0;const Qe=new Uint8Array(P.buffer.byteLength);for(let $e=0;$e<B.lines;$e++)for(let it=0;it<B.channels;it++){const dt=Y[it],Bt=dt.nx*dt.size,Bi=new Uint8Array(P.buffer,dt.end*2,Bt*2);Qe.set(Bi,Le),Le+=Bt*2,dt.end+=Bt}return new DataView(Qe.buffer)}function Ct(B){const z=B.array.slice(B.offset.value,B.offset.value+B.size),J=Xy(z),P=B.lines*B.channels*B.width,G=B.type==1?new Uint16Array(P):new Uint32Array(P);let Q=0,Y=0;const K=new Array(4);for(let pe=0;pe<B.lines;pe++)for(let ue=0;ue<B.channels;ue++){let be=0;switch(B.type){case 1:K[0]=Q,K[1]=K[0]+B.width,Q=K[1]+B.width;for(let De=0;De<B.width;++De){const Le=J[K[0]++]<<8|J[K[1]++];be+=Le,G[Y]=be,Y++}break;case 2:K[0]=Q,K[1]=K[0]+B.width,K[2]=K[1]+B.width,Q=K[2]+B.width;for(let De=0;De<B.width;++De){const Le=J[K[0]++]<<24|J[K[1]++]<<16|J[K[2]++]<<8;be+=Le,G[Y]=be,Y++}break}}return new DataView(G.buffer)}function mt(B){const z=B.viewer,J={value:B.offset.value},P=new Uint8Array(B.width*B.lines*(B.channels*B.type*2)),G={version:at(z,J),unknownUncompressedSize:at(z,J),unknownCompressedSize:at(z,J),acCompressedSize:at(z,J),dcCompressedSize:at(z,J),rleCompressedSize:at(z,J),rleUncompressedSize:at(z,J),rleRawSize:at(z,J),totalAcUncompressedCount:at(z,J),totalDcUncompressedCount:at(z,J),acCompression:at(z,J)};if(G.version<2)throw new Error("EXRLoader.parse: "+Iu.compression+" version "+G.version+" is unsupported");const Q=new Array;let Y=ee(z,J)-2;for(;Y>0;){const it=ke(z.buffer,J),dt=vt(z,J),Bt=dt>>2&3,Bi=(dt>>4)-1,Zt=new Int8Array([Bi])[0],Ft=vt(z,J);Q.push({name:it,index:Zt,type:Ft,compression:Bt}),Y-=it.length+3}const K=Iu.channels,pe=new Array(B.channels);for(let it=0;it<B.channels;++it){const dt=pe[it]={},Bt=K[it];dt.name=Bt.name,dt.compression=0,dt.decoded=!1,dt.type=Bt.pixelType,dt.pLinear=Bt.pLinear,dt.width=B.width,dt.height=B.lines}const ue={idx:new Array(3)};for(let it=0;it<B.channels;++it){const dt=pe[it];for(let Bt=0;Bt<Q.length;++Bt){const Bi=Q[Bt];dt.name==Bi.name&&(dt.compression=Bi.compression,Bi.index>=0&&(ue.idx[Bi.index]=it),dt.offset=it)}}let be,De,Le;if(G.acCompressedSize>0)switch(G.acCompression){case 0:be=new Uint16Array(G.totalAcUncompressedCount),rt(B.array,z,J,G.acCompressedSize,be,G.totalAcUncompressedCount);break;case 1:const it=B.array.slice(J.value,J.value+G.totalAcUncompressedCount),dt=Xy(it);be=new Uint16Array(dt.buffer),J.value+=G.totalAcUncompressedCount;break}if(G.dcCompressedSize>0){const it={array:B.array,offset:J,size:G.dcCompressedSize};De=new Uint16Array(Pe(it).buffer),J.value+=G.dcCompressedSize}if(G.rleRawSize>0){const it=B.array.slice(J.value,J.value+G.rleCompressedSize),dt=Xy(it);Le=Ne(dt.buffer),J.value+=G.rleCompressedSize}let Qe=0;const $e=new Array(pe.length);for(let it=0;it<$e.length;++it)$e[it]=new Array;for(let it=0;it<B.lines;++it)for(let dt=0;dt<pe.length;++dt)$e[dt].push(Qe),Qe+=pe[dt].width*B.type*2;Ee(ue,$e,pe,be,De,P);for(let it=0;it<pe.length;++it){const dt=pe[it];if(!dt.decoded)switch(dt.compression){case 2:let Bt=0,Bi=0;for(let Zt=0;Zt<B.lines;++Zt){let Ft=$e[it][Bt];for(let Wi=0;Wi<dt.width;++Wi){for(let Mt=0;Mt<2*dt.type;++Mt)P[Ft++]=Le[Bi+Mt*dt.width*dt.height];Bi++}Bt++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(P.buffer)}function ke(B,z){const J=new Uint8Array(B);let P=0;for(;J[z.value+P]!=0;)P+=1;const G=new TextDecoder().decode(J.slice(z.value,z.value+P));return z.value=z.value+P+1,G}function Ve(B,z,J){const P=new TextDecoder().decode(new Uint8Array(B).slice(z.value,z.value+J));return z.value=z.value+J,P}function Tt(B,z){const J=ci(B,z),P=gt(B,z);return[J,P]}function Fe(B,z){const J=gt(B,z),P=gt(B,z);return[J,P]}function ci(B,z){const J=B.getInt32(z.value,!0);return z.value=z.value+4,J}function gt(B,z){const J=B.getUint32(z.value,!0);return z.value=z.value+4,J}function Ye(B,z){const J=B[z.value];return z.value=z.value+1,J}function vt(B,z){const J=B.getUint8(z.value);return z.value=z.value+1,J}const at=function(B,z){let J;return"getBigInt64"in DataView.prototype?J=Number(B.getBigInt64(z.value,!0)):J=B.getUint32(z.value+4,!0)+Number(B.getUint32(z.value,!0)<<32),z.value+=8,J};function Gt(B,z){const J=B.getFloat32(z.value,!0);return z.value+=4,J}function j(B,z){return ep.toHalfFloat(Gt(B,z))}function ce(B){const z=(B&31744)>>10,J=B&1023;return(B>>15?-1:1)*(z?z===31?J?NaN:1/0:Math.pow(2,z-15)*(1+J/1024):6103515625e-14*(J/1024))}function ee(B,z){const J=B.getUint16(z.value,!0);return z.value+=2,J}function Oe(B,z){return ce(ee(B,z))}function he(B,z,J,P){const G=J.value,Q=[];for(;J.value<G+P-1;){const Y=ke(z,J),K=ci(B,J),pe=vt(B,J);J.value+=3;const ue=ci(B,J),be=ci(B,J);Q.push({name:Y,pixelType:K,pLinear:pe,xSampling:ue,ySampling:be})}return J.value+=1,Q}function He(B,z){const J=Gt(B,z),P=Gt(B,z),G=Gt(B,z),Q=Gt(B,z),Y=Gt(B,z),K=Gt(B,z),pe=Gt(B,z),ue=Gt(B,z);return{redX:J,redY:P,greenX:G,greenY:Q,blueX:Y,blueY:K,whiteX:pe,whiteY:ue}}function Ke(B,z){const J=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],P=vt(B,z);return J[P]}function hi(B,z){const J=gt(B,z),P=gt(B,z),G=gt(B,z),Q=gt(B,z);return{xMin:J,yMin:P,xMax:G,yMax:Q}}function zi(B,z){const J=["INCREASING_Y"],P=vt(B,z);return J[P]}function xn(B,z){const J=Gt(B,z),P=Gt(B,z);return[J,P]}function wn(B,z){const J=Gt(B,z),P=Gt(B,z),G=Gt(B,z);return[J,P,G]}function pi(B,z,J,P,G){if(P==="string"||P==="stringvector"||P==="iccProfile")return Ve(z,J,G);if(P==="chlist")return he(B,z,J,G);if(P==="chromaticities")return He(B,J);if(P==="compression")return Ke(B,J);if(P==="box2i")return hi(B,J);if(P==="lineOrder")return zi(B,J);if(P==="float")return Gt(B,J);if(P==="v2f")return xn(B,J);if(P==="v3f")return wn(B,J);if(P==="int")return ci(B,J);if(P==="rational")return Tt(B,J);if(P==="timecode")return Fe(B,J);if(P==="preview")return J.value+=G,"skipped";J.value+=G}function kn(B,z,J){const P={};if(B.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");P.version=B.getUint8(4);const G=B.getUint8(5);P.spec={singleTile:!!(G&2),longName:!!(G&4),deepFormat:!!(G&8),multiPart:!!(G&16)},J.value=8;let Q=!0;for(;Q;){const Y=ke(z,J);if(Y==0)Q=!1;else{const K=ke(z,J),pe=gt(B,J),ue=pi(B,z,J,K,pe);ue===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${K}'.`):P[Y]=ue}}if(G&-5)throw console.error("THREE.EXRHeader:",P),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return P}function qn(B,z,J,P,G){const Q={size:0,viewer:z,array:J,offset:P,width:B.dataWindow.xMax-B.dataWindow.xMin+1,height:B.dataWindow.yMax-B.dataWindow.yMin+1,channels:B.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:B.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:Ui};switch(B.compression){case"NO_COMPRESSION":Q.lines=1,Q.uncompress=ve;break;case"RLE_COMPRESSION":Q.lines=1,Q.uncompress=_e;break;case"ZIPS_COMPRESSION":Q.lines=1,Q.uncompress=Pe;break;case"ZIP_COMPRESSION":Q.lines=16,Q.uncompress=Pe;break;case"PIZ_COMPRESSION":Q.lines=32,Q.uncompress=Me;break;case"PXR24_COMPRESSION":Q.lines=16,Q.uncompress=Ct;break;case"DWAA_COMPRESSION":Q.lines=32,Q.uncompress=mt;break;case"DWAB_COMPRESSION":Q.lines=256,Q.uncompress=mt;break;default:throw new Error("EXRLoader.parse: "+B.compression+" is unsupported")}if(Q.scanlineBlockSize=Q.lines,Q.type==1)switch(G){case vn:Q.getter=Oe,Q.inputSize=2;break;case $i:Q.getter=ee,Q.inputSize=2;break}else if(Q.type==2)switch(G){case vn:Q.getter=Gt,Q.inputSize=4;break;case $i:Q.getter=j,Q.inputSize=4}else throw new Error("EXRLoader.parse: unsupported pixelType "+Q.type+" for "+B.compression+".");Q.blockCount=(B.dataWindow.yMax+1)/Q.scanlineBlockSize;for(let K=0;K<Q.blockCount;K++)at(z,P);Q.outputChannels=Q.channels==3?4:Q.channels;const Y=Q.width*Q.height*Q.outputChannels;switch(G){case vn:Q.byteArray=new Float32Array(Y),Q.channels<Q.outputChannels&&Q.byteArray.fill(1,0,Y);break;case $i:Q.byteArray=new Uint16Array(Y),Q.channels<Q.outputChannels&&Q.byteArray.fill(15360,0,Y);break;default:console.error("THREE.EXRLoader: unsupported type: ",G);break}return Q.bytesPerLine=Q.width*Q.inputSize*Q.channels,Q.outputChannels==4?(Q.format=Ti,Q.colorSpace=Ui):(Q.format=Tl,Q.colorSpace=jr),Q}const Jo=new DataView(e),Mu=new Uint8Array(e),Zo={value:0},Iu=kn(Jo,e,Zo),ai=qn(Iu,Jo,Mu,Zo,this.type),Qv={value:0},rb={R:0,G:1,B:2,A:3,Y:0};for(let B=0;B<ai.height/ai.scanlineBlockSize;B++){const z=gt(Jo,Zo);ai.size=gt(Jo,Zo),ai.lines=z+ai.scanlineBlockSize>ai.height?ai.height-z:ai.scanlineBlockSize;const P=ai.size<ai.lines*ai.bytesPerLine?ai.uncompress(ai):ve(ai);Zo.value+=ai.size;for(let G=0;G<ai.scanlineBlockSize;G++){const Q=G+B*ai.scanlineBlockSize;if(Q>=ai.height)break;for(let Y=0;Y<ai.channels;Y++){const K=rb[Iu.channels[Y].name];for(let pe=0;pe<ai.width;pe++){Qv.value=(G*(ai.channels*ai.width)+Y*ai.width+pe)*ai.inputSize;const ue=(ai.height-1-Q)*(ai.width*ai.outputChannels)+pe*ai.outputChannels+K;ai.byteArray[ue]=ai.getter(P,Qv)}}}}return{header:Iu,width:ai.width,height:ai.height,data:ai.byteArray,format:ai.format,colorSpace:ai.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,i,n){function r(o,a){o.colorSpace=a.colorSpace,o.minFilter=Nt,o.magFilter=Nt,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,a)}return super.load(e,r,i,n)}}const _oe=Object.freeze(Object.defineProperty({__proto__:null,EXRLoader:x0},Symbol.toStringTag,{value:"Module"}));class AS extends uB{constructor(e){super(e),this.type=$i}parse(e){const o=function(M,R){switch(M){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(R||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(R||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(R||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(R||""))}},h=`
`,d=function(M,R,S){R=R||1024;let L=M.pos,U=-1,D=0,V="",O=String.fromCharCode.apply(null,new Uint16Array(M.subarray(L,L+128)));for(;0>(U=O.indexOf(h))&&D<R&&L<M.byteLength;)V+=O,D+=O.length,L+=128,O+=String.fromCharCode.apply(null,new Uint16Array(M.subarray(L,L+128)));return-1<U?(S!==!1&&(M.pos+=D+U+1),V+O.slice(0,U)):!1},f=function(M){const R=/^#\?(\S+)/,S=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,I=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,L=/^\s*FORMAT=(\S+)\s*$/,U=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,D={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let V,O;for((M.pos>=M.byteLength||!(V=d(M)))&&o(1,"no header found"),(O=V.match(R))||o(3,"bad initial token"),D.valid|=1,D.programtype=O[1],D.string+=V+`
`;V=d(M),V!==!1;){if(D.string+=V+`
`,V.charAt(0)==="#"){D.comments+=V+`
`;continue}if((O=V.match(S))&&(D.gamma=parseFloat(O[1])),(O=V.match(I))&&(D.exposure=parseFloat(O[1])),(O=V.match(L))&&(D.valid|=2,D.format=O[1]),(O=V.match(U))&&(D.valid|=4,D.height=parseInt(O[1],10),D.width=parseInt(O[2],10)),D.valid&2&&D.valid&4)break}return D.valid&2||o(3,"missing format specifier"),D.valid&4||o(3,"missing image size specifier"),D},p=function(M,R,S){const I=R;if(I<8||I>32767||M[0]!==2||M[1]!==2||M[2]&128)return new Uint8Array(M);I!==(M[2]<<8|M[3])&&o(3,"wrong scanline width");const L=new Uint8Array(4*R*S);L.length||o(4,"unable to allocate buffer space");let U=0,D=0;const V=4*I,O=new Uint8Array(4),F=new Uint8Array(V);let N=S;for(;N>0&&D<M.byteLength;){D+4>M.byteLength&&o(1),O[0]=M[D++],O[1]=M[D++],O[2]=M[D++],O[3]=M[D++],(O[0]!=2||O[1]!=2||(O[2]<<8|O[3])!=I)&&o(3,"bad rgbe scanline format");let q=0,$;for(;q<V&&D<M.byteLength;){$=M[D++];const ae=$>128;if(ae&&($-=128),($===0||q+$>V)&&o(3,"bad scanline data"),ae){const Re=M[D++];for(let se=0;se<$;se++)F[q++]=Re}else F.set(M.subarray(D,D+$),q),q+=$,D+=$}const oe=I;for(let ae=0;ae<oe;ae++){let Re=0;L[U]=F[ae+Re],Re+=I,L[U+1]=F[ae+Re],Re+=I,L[U+2]=F[ae+Re],Re+=I,L[U+3]=F[ae+Re],U+=4}N--}return L},m=function(M,R,S,I){const L=M[R+3],U=Math.pow(2,L-128)/255;S[I+0]=M[R+0]*U,S[I+1]=M[R+1]*U,S[I+2]=M[R+2]*U,S[I+3]=1},v=function(M,R,S,I){const L=M[R+3],U=Math.pow(2,L-128)/255;S[I+0]=ep.toHalfFloat(Math.min(M[R+0]*U,65504)),S[I+1]=ep.toHalfFloat(Math.min(M[R+1]*U,65504)),S[I+2]=ep.toHalfFloat(Math.min(M[R+2]*U,65504)),S[I+3]=ep.toHalfFloat(1)},y=new Uint8Array(e);y.pos=0;const g=f(y),_=g.width,A=g.height,b=p(y.subarray(y.pos),_,A);let E,C,T;switch(this.type){case vn:T=b.length/4;const M=new Float32Array(T*4);for(let S=0;S<T;S++)m(b,S*4,M,S*4);E=M,C=vn;break;case $i:T=b.length/4;const R=new Uint16Array(T*4);for(let S=0;S<T;S++)v(b,S*4,R,S*4);E=R,C=$i;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:_,height:A,data:E,header:g.string,gamma:g.gamma,exposure:g.exposure,type:C}}setDataType(e){return this.type=e,this}load(e,t,i,n){function r(o,a){switch(o.type){case vn:case $i:o.colorSpace=Ui,o.minFilter=Nt,o.magFilter=Nt,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,a)}return super.load(e,r,i,n)}}const boe=Object.freeze(Object.defineProperty({__proto__:null,RGBELoader:AS},Symbol.toStringTag,{value:"Module"})),dU="NEEDLE_lightmaps",gy=ie("debuglightmapsextension")||ie("debuglightmaps");var Zh;(function(s){s[s.Lightmap=0]="Lightmap",s[s.Skybox=1]="Skybox",s[s.Reflection=2]="Reflection"})(Zh||(Zh={}));class xoe{constructor(e,t,i){u(this,"parser");u(this,"registry");u(this,"source");this.parser=e,this.registry=t,this.source=i}get name(){return dU}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[dU];if(i){const n=i.textures;return n!=null&&n.length?(gy&&console.log(i),new Promise(async(r,o)=>{const a=[];for(const c of n)if(c.pointer){gy&&console.log(c);let h=null;if(c.pointer.startsWith("/textures/"))gy&&console.log("Load texture from gltf",c.pointer),h=PD(this.parser,c.pointer).then(d=>this.resolveTexture(c,d));else if(typeof c.pointer=="string"){gy&&console.log("Load texture from path",c.pointer);const d=zd(this.source,c.pointer);let f;d.endsWith(".exr")?f=new x0(this.parser.options.manager):d.endsWith(".hdr")?f=new AS(this.parser.options.manager):f=new Xa(this.parser.options.manager),h=f.loadAsync(d,void 0).then(p=>this.resolveTexture(c,p))}else c.pointer;h&&a.push(h)}const l=await YC(a);l!=null&&l.anyFailed&&Xe()&&console.error("Failed to load lightmap extension",l),r()})):null}}return null}resolveTexture(e,t){const i=t;gy&&console.log("Lightmap loaded:",i),i!=null&&i.isTexture&&(this.registry?(i.colorSpace=Ui,this.registry.registerTexture(this.source,e.type,i,e.index)):console.log(Zh[e.type],e.pointer,i))}}const fU=!!ie("debuglightmaps");class woe{constructor(e){u(this,"_context");u(this,"_lightmaps",new Map);this._context=e}clear(){this._lightmaps.clear()}registerTexture(e,t,i,n){fU&&console.log("Registering ",Zh[t]+' "'+e+'"',i),this._lightmaps.has(e)||this._lightmaps.set(e,new Map);const r=this._lightmaps.get(e),o=(r==null?void 0:r.get(t))??[];o.length<n&&(o.length=n+1),o[n]=i,r==null||r.set(t,o)}tryGetLightmap(e,t=0){return this.tryGet(e,Zh.Lightmap,t)}tryGetSkybox(e){return this.tryGet(e,Zh.Skybox,0)}tryGetReflection(e){return this.tryGet(e,Zh.Reflection,0)}tryGet(e,t,i){if(!e)return fU&&console.warn("Missing source id"),null;const n=this._lightmaps.get(e);if(!n)return null;const r=n.get(t);return r===void 0||!(r!=null&&r.length)||r.length<=i?null:r[i]}}Dt.lights_fragment_maps=Dt.lights_fragment_maps.replace("vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );",`
    vec2 lUv = vLightMapUv.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
    vec4 lightMapTexel = texture2D( lightMap, lUv);
    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
    lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
    lightMapTexel.a = 1.;
    lightMapTexel = conv_sRGBToLinear(lightMapTexel);
    `);Dt.lightmap_pars_fragment=`
    #ifdef USE_LIGHTMAP
        uniform sampler2D lightMap;
        uniform float lightMapIntensity;
        uniform vec4 lightmapScaleOffset;
        
        // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
        vec4 conv_sRGBToLinear( in vec4 value ) {
            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
        }
    #endif
    `;Dt.lights_fragment_begin=Dt.lights_fragment_begin.replace("irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );",`
#if defined(USE_LIGHTMAP)
irradiance += 0.;
#else
irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
#endif`);ze.lightmap.lightmapScaleOffset={value:new Je(1,1,0,0)};const WT=ie("debugprogressive"),gx=new Si,vx=new _n;class Soe{constructor(e){u(this,"context");u(this,"_lodsManager");this.context=e}get manager(){return this._lodsManager}get targetTriangleDensity(){var e;return((e=this._lodsManager)==null?void 0:e.targetTriangleDensity)??-1}set targetTriangleDensity(e){this._lodsManager&&(this._lodsManager.targetTriangleDensity=e)}setRenderer(e){var t;(t=this._lodsManager)==null||t.disable(),Vh.removePlugin(this),Vh.addPlugin(this),Vh.debugDrawLine=At.DrawLine,this._lodsManager=Vh.get(e),this._lodsManager.enable()}onAfterUpdatedLOD(e,t,i,n,r){WT&&this.onRenderDebug(i,n,r)}onRenderDebug(e,t,i){var a,l,c;if(!t.geometry||!fi.hasLODLevelAvailable(t.geometry)&&!fi.hasLODLevelAvailable(t.material))return;const n=Vh.getObjectLODState(t);if(!n)return;let r=i.mesh_lod;const o=i.mesh_lod!=n.lastLodLevel_Mesh||i.texture_lod!=n.lastLodLevel_Texture;if(WT&&t.geometry.boundingSphere){const h=t.geometry.boundingSphere;vx.copy(h),vx.applyMatrix4(t.matrixWorld);const d=vx.center,f=vx.radius,p=["#76c43e","#bcc43e","#c4ac3e","#c4673e","#ff3e3e"];if(o)At.DrawWireSphere(d,f,p[r],.1);else{const m=((a=t.geometry.index)==null?void 0:a.count)??0,v=(l=fi.getMeshLODInformation(t.geometry))==null?void 0:l.lods;r=v?Math.min((v==null?void 0:v.length)-1,r):0;let y="";if(v&&n.lastScreenCoverage>0)for(let A=0;A<v.length;A++){const b=v[A].density,E=A==v.length-1;y+=b.toFixed(0)+">"+(b/n.lastScreenCoverage).toFixed(0)+(E?"":",")}const g=v?(c=v[r])==null?void 0:c.density:-1;let _="LOD "+i.mesh_lod+`
TEX `+i.texture_lod;if(WT=="density"&&(_+=`
`+m+` tris
`+(g/n.lastScreenCoverage).toFixed(0)+` dens
`+(n.lastScreenCoverage*100).toFixed(1)+`% cov
`+(n.lastCentrality*100).toFixed(1)+`% centr
`+(gx.min.x.toFixed(2)+"-"+gx.max.x.toFixed(2)+"x"+gx.min.y.toFixed(2)+"-"+gx.max.y.toFixed(2))+" scr"),n.lastScreenCoverage>.1){const A=e,b=A.worldForward,E=A.worldPosition,T=yt(b).multiplyScalar(f*.7).add(d),M=T.distanceTo(E),R=p[Math.min(p.length-1,Math.max(0,r))]+"88",S=this.context.domHeight>0?screen.height/this.context.domHeight:1,I=e.isPerspectiveCamera?Math.tan(e.fov*Math.PI/180/2):1;At.DrawLabel(T,_,M*.012*S*I,void 0,16777215,R)}}}}}const Coe=ie("debugplayerview");var Uc;(function(s){s.Browser="browser",s.Headset="headset",s.Handheld="handheld"})(Uc||(Uc={}));class Z5{constructor(e,t){u(this,"userId");u(this,"context");u(this,"viewDevice",Uc.Browser);u(this,"removed",!1);u(this,"_object");this.userId=e,this.context=t}get currentObject(){return this._object}set currentObject(e){this._object=e}get isConnected(){return this.context.connection.userIsInRoom(this.userId)}}class $5{constructor(e){u(this,"context");u(this,"playerViews",new Map);this.context=e}setPlayerView(e,t,i){let n=this.playerViews.get(e);n||(n=new Z5(e,this.context),this.playerViews.set(e,n)),n.viewDevice=i,n.currentObject=t,n.removed=!1}getPlayerView(e){if(!e)return;if(!this.context.connection.userIsInRoom(e)){this.playerViews.delete(e);return}return this.playerViews.get(e)}removePlayerView(e,t){const i=this.playerViews.get(e);(i==null?void 0:i.viewDevice)===t&&(Coe&&console.log("REMOVE",e),i.removed=!0,this.playerViews.delete(e))}}new Hn;const __=new Uint8Array(4);__[0]=255;__[1]=255;__[2]=255;__[3]=255;const Eoe=new Go(__,1,1,Ti);function zD(s,e=1){const t="alpha"in s,i=e*e,n=new Uint8Array(4*i),r=Math.floor(s.r*255),o=Math.floor(s.g*255),a=Math.floor(s.b*255);for(let c=0;c<i;c++){const h=c*4;n[h+0]=r,n[h+1]=o,n[h+2]=a,t?n[h+3]=Math.floor(s.alpha*255):n[h+3]=255}const l=new Go(n,e,e);return l.needsUpdate=!0,l}function Toe(s,e,t,i=1,n=3){const o=i*n,a=[s,e,t],l=a.length,c=new Uint8Array(4*l*o),h=new me;for(let f=0;f<n;f++){const p=Math.floor(f/n*l),m=et.clamp(p+1,0,l-1),v=a[p],y=a[m],g=f/n*l%1;h.lerpColors(v,y,g);const _=Math.floor(h.r*255),A=Math.floor(h.g*255),b=Math.floor(h.b*255);for(let E=0;E<i;E++){const C=(f*i+E)*4;c[C+0]=_,c[C+1]=A,c[C+2]=b,c[C+3]=255}}const d=new Go(c,i,n);return d.needsUpdate=!0,d}var pU;(function(s){s[s.Vertex=0]="Vertex",s[s.Fragment=1]="Fragment"})(pU||(pU={}));function _S(s,e){const t=s.elements;e||(e=[]),e.length=0;for(let i=0;i<16;i+=4){const n=t[i],r=t[i+1],o=t[i+2],a=t[i+3],l=new Je(n,r,o,a);e.push(l)}return e}const qT=[],mU=[];function Moe(s,e){if(qT.length===0)for(let t=0;t<27;t++)qT.push(0);e||(e=qT);for(let t=0;t<27;t++)mU[t]=e[t];e=mU,s.unity_SHAr={value:new Je(e[9],e[3],e[6],e[0])},s.unity_SHBr={value:new Je(e[12],e[15],e[18],e[21])},s.unity_SHAg={value:new Je(e[10],e[4],e[7],e[1])},s.unity_SHBg={value:new Je(e[13],e[16],e[19],e[22])},s.unity_SHAb={value:new Je(e[11],e[5],e[8],e[2])},s.unity_SHBb={value:new Je(e[14],e[17],e[20],e[23])},s.unity_SHC={value:new Je(e[24],e[25],e[26],1)}}class Ioe{constructor(e,t,i){u(this,"vertexShader");u(this,"fragmentShader");u(this,"technique");this.vertexShader=e,this.fragmentShader=t,this.technique=i}}async function Roe(s,e){if(!s)return console.error("Can not find technique: no shader data"),null;const t=s.programs[e],i=t.vertexShader,n=t.fragmentShader;if(i!==void 0&&n!==void 0){const r=s.shaders[i],o=s.shaders[n];if(r.uri&&o.uri||r.code&&o.code){if(!r.code&&r.uri&&await gU(r),!o.code&&o.uri&&await gU(o),!r.code||!o.code)return null;const a=s.techniques[e];return new Ioe(r.code,o.code,a)}}return console.error("Shader technique not found",e),null}async function gU(s){const e=s.uri;if(e)if(e.endsWith(".glsl")){const i=await new Hn().loadAsync(e);s.code=i.toString()}else s.code=Poe(s.uri)}function Poe(s){return decodeURIComponent(Array.prototype.map.call(atob(s),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}const dl=ie("debugenvlight");var Sl;(function(s){s[s.Skybox=0]="Skybox",s[s.Trilight=1]="Trilight",s[s.Flat=3]="Flat",s[s.Custom=4]="Custom"})(Sl||(Sl={}));var rv;(function(s){s[s.Skybox=0]="Skybox",s[s.Custom=1]="Custom"})(rv||(rv={}));class eQ{constructor(e){u(this,"context");u(this,"_currentLightSettingsId");u(this,"_sceneLightSettings");u(this,"_timevec4",new Je);u(this,"__currentReflectionId",null);u(this,"_lighting",{});this.context=e,this.context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){const e=this.context.time;this._timevec4.x=e.time,this._timevec4.y=Math.sin(e.time),this._timevec4.z=Math.cos(e.time),this._timevec4.w=e.deltaTime}get timeVec4(){return this._timevec4}get environmentIntensity(){if(!this._sceneLightSettings||!this._currentLightSettingsId)return 1;const e=this._sceneLightSettings.get(this._currentLightSettingsId);return e?e.ambientIntensity:1}get sceneLightSettings(){var e;return(e=this._sceneLightSettings)==null?void 0:e.values()}enable(e){var i;e instanceof si&&(e=e.url);const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);return t?(dl&&console.log("Enable scene light settings",e,t),e!==this._currentLightSettingsId&&this._currentLightSettingsId&&this.disable(this._currentLightSettingsId),this._currentLightSettingsId=e,t.enabled=!0,!0):(dl&&console.warn("No light settings found for",e),!1)}disable(e){var i;if(e instanceof si&&(e=e.url),e==null)return!1;const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);return t?(dl&&console.log("Disable scene light settings",e,t),t.enabled=!1,!0):!1}disableCurrent(){if(this._currentLightSettingsId){const e=this._currentLightSettingsId;return this.disable(this._currentLightSettingsId),e}return null}internalRegisterSceneLightSettings(e){const t=e.sourceId;if(!t){console.error("Missing source id for scene light settings, can not register:",e);return}dl&&console.log("Register "+(e==null?void 0:e.sourceId)+" lighting",e),this._sceneLightSettings||(this._sceneLightSettings=new Map),this._sceneLightSettings.set(t,e)}internalUnregisterSceneLightSettings(e){const t=e.sourceId;if(!t){console.error("Missing source id for scene light settings, can not unregister:",e);return}dl&&console.log("Unregister "+(e==null?void 0:e.sourceId)+" lighting",e),this._sceneLightSettings&&this._sceneLightSettings.delete(t)}internalRegisterReflection(e,t){dl&&console.log("Register reflection",e,t);const i=new tQ(this.context,t,1);this._lighting[e]=i}internalGetReflection(e){return this._lighting[e]}internalEnableReflection(e){var i;this.__currentReflectionId=e;const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);switch(dl&&console.log("Enable reflection",e,t?Sl[t.ambientMode]:"Unknown ambient mode",t),t==null?void 0:t.ambientMode){case Sl.Skybox:case Sl.Custom:const n=this.internalGetReflection(e);if(n&&n.Source){dl&&console.log("Setting environment reflection",n);const r=this.context.scene,o=n.Source;o.mapping=bo,r.environment=o;return}else dl&&console.warn("Could not find reflection for source",e);break}if((t==null?void 0:t.environmentReflectionSource)===rv.Custom)switch(t==null?void 0:t.ambientMode){case Sl.Trilight:if(t.ambientTrilight){const n=t.ambientTrilight,r=Toe(n[0],n[1],n[2],64,64);r.colorSpace=_t,r.mapping=bo,this.context.scene.environment=r}else console.error("Missing ambient trilight",t.sourceId);return;case Sl.Flat:if(t.ambientLight){const n=zD(t.ambientLight,64);n.colorSpace=_t,n.mapping=bo,this.context.scene.environment=n}else console.error("Missing ambientlight",t.sourceId);return;default:return}}internalDisableReflection(e){if(e&&e!==this.__currentReflectionId){dl&&console.log("Not disabling reflection for",e,"because it is not the current light settings id",this.__currentReflectionId);return}dl&&console.log("Disable reflection",e);const t=this.context.scene;t.environment=null}}class tQ{constructor(e,t,i=1){u(this,"_source");this._source=t,t.mapping=bo}get Source(){return this._source}}const vU=ie("timescale");let NR=1;typeof vU=="number"&&(NR=vU);class iQ{constructor(){u(this,"_time",0);u(this,"_deltaTime",0);u(this,"_deltaTimeUnscaled",0);u(this,"timeScale",1);u(this,"_frame",0);u(this,"clock",new i_);u(this,"_smoothedFps",0);u(this,"_smoothedDeltaTime",0);u(this,"_fpsSamples",[]);u(this,"_fpsSampleIndex",0);typeof NR=="number"&&(this.timeScale=NR)}get time(){return this._time}set time(e){this._time=e}get deltaTime(){return this._deltaTime}set deltaTime(e){this._deltaTime=e}get deltaTimeUnscaled(){return this._deltaTimeUnscaled}get frame(){return this._frame}set frame(e){this._frame=e}get frameCount(){return this.frame}get realtimeSinceStartup(){return this.clock.elapsedTime}get smoothedFps(){return this._smoothedFps}get smoothedDeltaTime(){return 1/this._smoothedFps}update(){this.deltaTime=this.clock.getDelta(),this.deltaTime=Math.min(.1,this.deltaTime),this._deltaTimeUnscaled=this.deltaTime,this.deltaTime<=0&&(this.deltaTime=1e-12),this.deltaTime*=this.timeScale,this.frame+=1,this.time+=this.deltaTime,this._fpsSamples.length<60?this._fpsSamples.push(this.deltaTime):this._fpsSamples[this._fpsSampleIndex++%60]=this.deltaTime;let e=0;for(let t=0;t<this._fpsSamples.length;t++)e+=this._fpsSamples[t];this._smoothedDeltaTime=e/this._fpsSamples.length,this._smoothedFps=1/this._smoothedDeltaTime}}let yU=!1;function nQ(s){yU||(yU=!0,Boe(),Doe())}nQ();function Boe(){const s=`
float startCompression = 0.8;
float desaturation = 0.5;
// Patched tonemapping function
vec3 NeutralToneMapping( vec3 color ) {
    color *= toneMappingExposure;
    
    float d = 1. - startCompression;
    // float peak = dot(color, vec3(0.299, 0.587, 0.114));
    float peak = max(color.r, max(color.g, color.b));
    if (peak < startCompression) return color;
    float newPeak = 1. - d * d / (peak + d - startCompression);
    float invPeak = 1. / peak;
    
    float extraBrightness = dot(color * (1. - startCompression * invPeak), vec3(1, 1, 1));
    
    color *= newPeak * invPeak;
    float g = 1. - 3. / (desaturation * extraBrightness + 3.);
    return mix(color, vec3(1, 1, 1), g);
}
`,e="vec3 NeutralToneMapping( vec3 color ) {",t=`return mix(color, vec3(1, 1, 1), g);
}`,i=Dt.tonemapping_pars_fragment.indexOf(e),n=Dt.tonemapping_pars_fragment.indexOf(t,i);if(i>=0&&n>=0){const r=Dt.tonemapping_pars_fragment.substring(i,n+t.length);Dt.tonemapping_pars_fragment=Dt.tonemapping_pars_fragment.replace(r,s)}}function Doe(){const s=`
// 0: Default, 1: Golden, 2: Punchy
#define AGX_LOOK 0        

vec3 userSlope = vec3(1.0);
vec3 userOffset = vec3(0.0);
vec3 userPower = vec3(1.0);
float userSaturation = 1.0;

// Mean error^2: 3.6705141e-06
vec3 _agxDefaultContrastApprox(vec3 x) {
    vec3 x2 = x * x;
    vec3 x4 = x2 * x2;
    
    return  + 15.5     * x4 * x2
            - 40.14    * x4 * x
            + 31.96    * x4
            - 6.868    * x2 * x
            + 0.4298   * x2
            + 0.1191   * x
            - 0.00232;
}

vec3 _agx(vec3 val) {
    const mat3 agx_mat = mat3(
        0.842479062253094, 0.0423282422610123, 0.0423756549057051,
        0.0784335999999992,  0.878468636469772,  0.0784336,
        0.0792237451477643, 0.0791661274605434, 0.879142973793104);
    
    const float min_ev = -12.47393f;
    const float max_ev = 4.026069f;

    // val = pow(val, vec3(2.2)); 

    // Input transform (inset)
    val = agx_mat * val;
    
    // Log2 space encoding
    val = clamp(log2(val), min_ev, max_ev);
    val = (val - min_ev) / (max_ev - min_ev);
    
    // Apply sigmoid function approximation
    val = _agxDefaultContrastApprox(val);

    return val;
}

vec3 _agxEotf(vec3 val) {
    const mat3 agx_mat_inv = mat3(
        1.19687900512017, -0.0528968517574562, -0.0529716355144438,
        -0.0980208811401368, 1.15190312990417, -0.0980434501171241,
        -0.0990297440797205, -0.0989611768448433, 1.15107367264116);
        
    // Inverse input transform (outset)
    val = agx_mat_inv * val;
    
    // sRGB IEC 61966-2-1 2.2 Exponent Reference EOTF Display
    // NOTE: We're linearizing the output here. Comment/adjust when
    // *not* using a sRGB render target
    val = pow(val, vec3(2.2)); 

    return val;
}

vec3 _agxLook(vec3 val) {
    const vec3 lw = vec3(0.2126, 0.7152, 0.0722);
    float luma = dot(val, lw);
    
    // Default
    vec3 offset = vec3(0.0);
    vec3 slope = vec3(1.0);
    vec3 power = vec3(1.0);
    float sat = 1.0;
    
    #if AGX_LOOK == 1
    // Golden
    slope = vec3(1.0, 0.9, 0.5);
    power = vec3(0.8);
    sat = 0.8;
    #elif AGX_LOOK == 2
    // Punchy
    slope = vec3(1.0);
    power = vec3(1.35, 1.35, 1.35);
    sat = 1.4;
    #endif        
    
    // Needle
    slope = vec3(1.05);
    power = vec3(1.10, 1.10, 1.10);
    sat = 1.15;

    // User
    // slope = userSlope;
    // offset = userOffset;
    // power = userPower;
    // sat = userSaturation;
    
    // ASC CDL
    val = pow(val * slope + offset, power);
    return luma + sat * (val - luma);
}


vec3 AgXToneMapping( vec3 color ) {
    // apply AGX
    color *= toneMappingExposure;
    color = _agx(color);
    color = _agxLook(color); // Optional
    color = _agxEotf(color);
    return color;
}`,e="vec3 AgXToneMapping( vec3 color ) {",t=`	return color;
}`,i=Dt.tonemapping_pars_fragment.indexOf(e),n=Dt.tonemapping_pars_fragment.indexOf(t,i);if(i>=0&&n>=0){const r=Dt.tonemapping_pars_fragment.substring(i,n+t.length);Dt.tonemapping_pars_fragment=Dt.tonemapping_pars_fragment.replace(r,s)}}function br(s){const e=document.createElement("span");return e.style.maxWidth="48px",e.style.maxHeight="48px",e.style.overflow="hidden",e.classList.add("material-symbols-outlined","notranslate"),e.setAttribute("translate","no"),e.innerText=s,e}function sQ(s){var t;return((t=s.classList)==null?void 0:t.contains("material-symbols-outlined"))||!1}const yx=new Map;async function zR(s){const e="Material Symbols Outlined";if(document.fonts.check(`1em '${e}'`)||(console.log("Font not loaded yet"),await document.fonts.ready),yx.has(s))return yx.get(s);const t=document.createElement("canvas"),i=48;t.width=i,t.height=i;const n=t.getContext("2d");if(n){n.font=`${i}px '${e}'`,n.fillStyle="black",n.fillText(s,0,i);const r=t.toDataURL(),o=new Pt;return o.name=s+" icon",o.image=new Image,o.image.src=r,o.needsUpdate=!0,yx.set(s,o),o}return yx.set(s,null),null}const ZS=class{constructor(){u(this,"_fullscreenButton");u(this,"_muteButton");u(this,"_qrButton")}static getOrCreate(){return this._instance||(this._instance=new ZS),this._instance}static create(){return new ZS}get fullscreenButton(){return this._fullscreenButton}createFullscreenButton(e){if(this._fullscreenButton)return this._fullscreenButton;if(!document.fullscreenEnabled)return Xe()&&console.warn("NeedleMenu: Fullscreen button could not be created, device doesn't support the Fullscreen API"),null;const t=document.createElement("button");this._fullscreenButton=t,t.classList.add("fullscreen-button"),t.title="Click to enter fullscreen mode";const i=br("fullscreen"),n=br("fullscreen_exit");return t.appendChild(i),t.onclick=()=>{document.fullscreenElement?document.exitFullscreen():"webkitRequestFullscreen"in e.domElement&&typeof e.domElement.webkitRequestFullscreen=="function"?e.domElement.webkitRequestFullscreen():"requestFullscreen"in e.domElement&&e.domElement.requestFullscreen()},document.addEventListener("fullscreenchange",()=>{document.fullscreenElement?(i.remove(),t.appendChild(n),t.title="Click to enter fullscreen mode"):(n.remove(),t.appendChild(i),t.title="Click to exit fullscreen mode")}),globalThis.addEventListener("needle-xrsession-start",()=>{t.style.display="none"}),globalThis.addEventListener("needle-xrsession-end",()=>{t.style.display=""}),t}get muteButton(){return this._muteButton}createMuteButton(e){if(this._muteButton)return this._muteButton;const t=document.createElement("button");this._muteButton=t,t.classList.add("mute-button"),t.title="Click to mute/unmute";const i=br("volume_off"),n=br("volume_up");return e.application.muted?t.appendChild(i):t.appendChild(n),t.onclick=()=>{e.application.muted?(i.remove(),t.appendChild(n),e.application.muted=!1):(n.remove(),t.appendChild(i),e.application.muted=!0)},t}get qrButton(){return this._qrButton}createQRCode(){if(this._qrButton)return this._qrButton;const e=document.createElement("button");this._qrButton=e,e.innerText="QR Code",e.prepend(br("qr_code")),e.title="Scan this QR code with your phone to open this page",this.hideElementDuringXRSession(e);const t=document.createElement("div");t.style.cssText=`
            position: fixed;
            display: inline-block;
            padding: 1rem;
            background-color: white;
            border-radius: 0.4rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
        `;const i=document.createElement("div");i.classList.add("qr-code-container"),t.appendChild(i),e.addEventListener("click",()=>{if(t.parentNode)return r();window.location.href.includes("://localhost")&&Yi("To access your website from another device in the same local network you have to use the IP address instead of localhost."),n()});async function n(){await o(),document.body.appendChild(t);const a=i.getBoundingClientRect(),l=e.getBoundingClientRect();t.style.left=l.left+l.width*.5-a.width*.5+"px",l.top<a.height?t.style.top=`calc(${l.bottom}px + ${t.style.padding} * .6)`:t.style.top=`calc(${l.top-a.height}px - ${t.style.padding} * 2.5)`,t.style.opacity="0",t.style.pointerEvents="all",t.style.transition="opacity 0.2s ease-in-out",setTimeout(()=>{t.style.opacity="1",window.addEventListener("click",r,{once:!0})}),window.addEventListener("resize",r),window.addEventListener("scroll",r),document.fullscreenElement?document.fullscreenElement.appendChild(t):document.body.appendChild(t)}function r(){t.style.pointerEvents="none",t.style.transition="opacity 0.2s",t.style.opacity="0",setTimeout(()=>{var a;return(a=t.parentNode)==null?void 0:a.removeChild(t)},500),window.removeEventListener("click",r),window.removeEventListener("resize",r),window.removeEventListener("scroll",r)}async function o(){const l=await $4({text:window.location.href,width:200,height:200});i.innerHTML="",i.appendChild(l)}return e.addEventListener("pointerenter",()=>{o()},{once:!0}),e}hideElementDuringXRSession(e){oE(t=>{e["previous-display"]=e.style.display,e.style.display="none"}),uD(t=>{e["previous-display"]!=null&&(e.style.display=e["previous-display"])})}};let Ml=ZS;u(Ml,"_instance");function bS(s,e){const t=(e==null?void 0:e.element)||document.head,i=Array.from(t.querySelectorAll(`link[rel=stylesheet][href*='${s}']`));if(i.length<=0){const n=document.createElement("link");n.href=s,n.rel="stylesheet",t.appendChild(n),i.push(n)}if(e!=null&&e.loadedCallback)for(let n=0;n<i.length;n++)e!=null&&e.loadedCallback&&i[n].addEventListener("load",e.loadedCallback)}function rQ(){bS("https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap")}const GR="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&display=block",xS="needle-logo-element";class oQ extends HTMLElement{constructor(){super();u(this,"_root");u(this,"wrapper");u(this,"logoElement",document.createElement("img"));u(this,"textElement",document.createElement("span"));this._root=this.attachShadow({mode:"closed"});const t=document.createElement("template");t.innerHTML=`<style>
        :host {
            position: relative;
            min-width: fit-content;
            /* height: 100%; can not have height 100% because of align-items: stretch; in the parent */
            display: flex;
        }

        .wrapper {
            position: relative;
            display: grid;
            grid-template-columns: auto auto;
            padding: .1rem;
        }
        .wrapper:hover {
            cursor: pointer;
        }
        img {
            width: 95px;
            height: 100%;
            align-self: end;
            margin-left: 0.6rem;
        }
        span {
            font-size: 1rem;
            white-space: nowrap;
        }
        </style>
        <div class="wrapper">
            <img class="logo" src=${dee} />
        </div>
        `,this._root.appendChild(t.content.cloneNode(!0)),this.wrapper=this._root.querySelector(".wrapper"),this._root.appendChild(this.wrapper),this.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),this.wrapper.setAttribute("title","Made with Needle Engine")}static get elementName(){return xS}static create(){return document.createElement(xS)}setLogoVisible(t){this.logoElement.style.display=t?"block":"none"}}customElements.get(xS)||customElements.define(xS,oQ);const XT=ie("debugspatialmenu");class Ooe{constructor(e,t){u(this,"_context");u(this,"needleMenu");u(this,"htmlButtonsMap",new Map);u(this,"enabled",!0);u(this,"userRequestedMenu",!1);u(this,"uiisDirty",!1);u(this,"_showNeedleLogo");u(this,"_wasInXR",!1);u(this,"preRender",()=>{var t;if(!this.enabled){(t=this.menu)==null||t.removeFromParent();return}XT&&St.isDesktop()&&this.updateMenu();const e=this._context.xr;if(!(e!=null&&e.running)){this._wasInXR&&(this._wasInXR=!1,this.onExitXR());return}this._wasInXR||(this._wasInXR=!0,this.onEnterXR()),this.updateMenu()});u(this,"_menuTarget",new ge);u(this,"positionFilter",new XB(90,.5));u(this,"familyName","Needle Spatial Menu");u(this,"menu");u(this,"_poweredByNeedleElement");var n;this._context=e,this._context.pre_render_callbacks.push(this.preRender),this.needleMenu=t;const i=(n=this.needleMenu.shadowRoot)==null?void 0:n.querySelector(".options");i?new MutationObserver(o=>{if(this.enabled&&!(this._context.isInXR==!1&&!XT))for(const a of o)a.type==="childList"&&(a.addedNodes.forEach(l=>{this.createButtonFromHTMLNode(l)}),a.removedNodes.forEach(l=>{const c=l,h=this.htmlButtonsMap.get(c);h&&(this.htmlButtonsMap.delete(c),h.remove(),Zi.update())}))}).observe(i,{childList:!0}):console.error("Could not find options container in needle menu")}setEnabled(e){var t;this.enabled=e,e||(t=this.menu)==null||t.removeFromParent()}setDisplay(e){return this.enabled?(this.userRequestedMenu=e,!0):!1}onDestroy(){const e=this._context.pre_render_callbacks.indexOf(this.preRender);e>-1&&this._context.pre_render_callbacks.splice(e,1)}markDirty(){this.uiisDirty=!0}showNeedleLogo(e){this._showNeedleLogo=e}onEnterXR(){var t;const e=(t=this.needleMenu.shadowRoot)==null?void 0:t.querySelector(".options");e&&e.childNodes.forEach(i=>{this.createButtonFromHTMLNode(i)})}onExitXR(){var e;(e=this.menu)==null||e.removeFromParent()}createButtonFromHTMLNode(e){const t=this.getMenu(),i=this.htmlButtonsMap.get(e);if(i){i.add();return}if(e instanceof HTMLButtonElement){const n=this.createButton(t,e);this.htmlButtonsMap.set(e,n),n.add()}else e instanceof HTMLSlotElement&&e.assignedNodes().forEach(n=>{this.createButtonFromHTMLNode(n)})}updateMenu(){var r,o;performance.mark("NeedleSpatialMenu updateMenu start");const e=this.getMenu();this.handleNeedleWatermark(),this._context.scene.add(e);const t=this._context.mainCamera,i=this._context.xr,n=(i==null?void 0:i.rigScale)||1;if(t){const a=t.worldPosition,l=t.worldForward.multiplyScalar(-1),c=l.y>.6,h=l.y>.4,d=(e.visible?h:c)||this.userRequestedMenu,f=!e.visible&&d;e.visible=d||St.isDesktop()&&XT,l.multiplyScalar(3*n),a.add(l),(f||!1)&&(e.position.copy(this._menuTarget.position),e.position.y+=.25,this._menuTarget.position.copy(e.position),this.positionFilter.reset(e.position),e.quaternion.copy(this._menuTarget.quaternion),this.markDirty());const m=this._menuTarget.position.distanceTo(a);(f||m>1.5*n)&&(this.ensureRenderOnTop(this.menu),this._menuTarget.position.copy(a),this._context.scene.add(this._menuTarget),a_(this._menuTarget,this._context.mainCamera,!0,!0),this._menuTarget.removeFromParent()),this.positionFilter.filter(this._menuTarget.position,e.position,this._context.time.time);const v=5;(r=this.menu)==null||r.quaternion.slerp(this._menuTarget.quaternion,this._context.time.deltaTime*v),(o=this.menu)==null||o.scale.setScalar(n)}this.uiisDirty&&(performance.mark("SpatialMenu.update.uiisDirty.start"),this.uiisDirty=!1,Zi.update(),performance.mark("SpatialMenu.update.uiisDirty.end"),performance.measure("SpatialMenu.update.uiisDirty","SpatialMenu.update.uiisDirty.start","SpatialMenu.update.uiisDirty.end")),performance.mark("NeedleSpatialMenu updateMenu end"),performance.measure("SpatialMenu.update","NeedleSpatialMenu updateMenu start","NeedleSpatialMenu updateMenu end")}ensureRenderOnTop(e,t=0){e instanceof le&&(e.material.depthTest=!1,e.material.depthWrite=!1),e.renderOrder=1e3+t*2;for(const i of e.children)this.ensureRenderOnTop(i,t+1)}get isVisible(){var e;return(e=this.menu)==null?void 0:e.visible}getMenu(){if(this.menu)return this.menu;this.ensureFont(),this.menu=new Zi.Block({boxSizing:"border-box",fontFamily:this.familyName,height:"auto",fontSize:.1,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:.55,borderRadius:1,whiteSpace:"pre-wrap",flexDirection:"row",alignItems:"center",padding:new Je(0,.05,0,.05),borderColor:0,borderOpacity:.05,borderWidth:.005});const e=X.get("ObjectRaycaster");return e&&mp(this.menu,new e),this.menu}handleNeedleWatermark(){var e;if(!this._poweredByNeedleElement){this._poweredByNeedleElement=new Zi.Block({width:"auto",height:"auto",fontSize:.05,whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",margin:.02,borderRadius:.02,padding:.02,backgroundColor:16777215,backgroundOpacity:1}),this._poweredByNeedleElement["needle:use_eventsystem"]=!0;const t=new AU(this._context,()=>globalThis.open("https://needle.tools","_self"));mp(this._poweredByNeedleElement,t);const i=new Zi.Text({textContent:"Powered by",width:"auto",height:"auto"}),n=new Zi.Text({textContent:"needle",width:"auto",height:"auto",fontSize:.07,margin:new Je(0,0,0,.02)});this._poweredByNeedleElement.add(i),this._poweredByNeedleElement.add(n),(e=this.menu)==null||e.add(this._poweredByNeedleElement),this.markDirty(),new Xa().load("./include/needle/poweredbyneedle.webp",o=>{var l;t.allowModifyUI=!1,i.removeFromParent(),n.removeFromParent();const a=o.image.width/o.image.height;(l=this._poweredByNeedleElement)==null||l.set({backgroundImage:o,backgroundOpacity:1,width:.1*a,height:.1}),this.markDirty()})}if(this.menu){const t=this.menu.children.indexOf(this._poweredByNeedleElement);if(!this._showNeedleLogo&&yd())t>=0&&(this._poweredByNeedleElement.removeFromParent(),this.markDirty());else{this._poweredByNeedleElement.visible=!0,this.menu.add(this._poweredByNeedleElement);const i=this.menu.children.indexOf(this._poweredByNeedleElement);t!==i&&this.markDirty()}}}ensureFont(){let e=Zi.FontLibrary.getFontFamily(this.familyName);if(!e){e=Zi.FontLibrary.addFontFamily(this.familyName);const t=e.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");t==null||t.addEventListener("ready",()=>{this.markDirty()})}}createButton(e,t){const i=new Zi.Block({width:"auto",height:"auto",whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",backgroundColor:16777215,backgroundOpacity:0,padding:.02,margin:.01,borderRadius:.02,cursor:"pointer",fontSize:.05}),n=new Zi.Text({textContent:"",width:"auto",justifyContent:"center",alignItems:"center",backgroundOpacity:0,backgroundColor:16777215,fontFamily:this.familyName,color:0,borderRadius:.02,padding:.01});i.add(n),i["needle:use_eventsystem"]=!0;const r=new AU(this._context,()=>t.click());return mp(i,r),new Loe(this,e,t,i,n)}}class Loe{constructor(e,t,i,n,r){u(this,"menu");u(this,"root");u(this,"htmlbutton");u(this,"spatialContainer");u(this,"spatialText");u(this,"spatialIcon");u(this,"_lastText","");u(this,"_lastTexture");this.menu=e,this.root=t,this.htmlbutton=i,this.spatialContainer=n,this.spatialText=r,new MutationObserver(a=>{for(const l of a)l.type==="attributes"?l.attributeName==="style"&&this.updateVisible():l.type==="childList"&&this.updateText()}).observe(i,{attributes:!0,childList:!0}),this.updateText()}add(){this.spatialContainer.parent!=this.root&&(this.root.add(this.spatialContainer),this.menu.markDirty(),this.updateVisible(),this.updateText())}remove(){this.spatialContainer.parent&&(this.spatialContainer.removeFromParent(),this.menu.markDirty())}updateVisible(){const e=this.spatialContainer.visible;this.spatialContainer.visible=this.htmlbutton.style.display!=="none",e!==this.spatialContainer.visible&&this.menu.markDirty()}updateText(){let e="",t="";this.htmlbutton.childNodes.forEach(i=>{i.nodeType===Node.TEXT_NODE?e+=i.textContent:i instanceof HTMLElement&&sQ(i)&&i.textContent&&(t=i.textContent)}),this._lastText!==e&&(this._lastText=e,this.spatialText.name=e,this.spatialText.set({textContent:e}),this.menu.markDirty()),e.length<=0?this.spatialText.parent&&(this.spatialText.removeFromParent(),this.menu.markDirty()):this.spatialText.parent||(this.spatialContainer.add(this.spatialText),this.menu.markDirty()),t&&this.createIcon(t)}async createIcon(e){var i;if(!this.spatialIcon){const n=await zR(e);if(n&&!this.spatialIcon){const o=new Zi.Block({width:.08,height:.08,backgroundColor:16777215,backgroundImage:n,backgroundOpacity:1,margin:new Je(0,.005,0,0)});this.spatialIcon=o,this.spatialContainer.add(o),this.menu.markDirty()}}if(e!=this._lastTexture){this._lastTexture=e;const n=await zR(e);n&&((i=this.spatialIcon)==null||i.set({backgroundImage:n}),this.menu.markDirty())}const t=this.spatialContainer.children.indexOf(this.spatialIcon);t>0&&(this.spatialContainer.children.splice(t,1),this.spatialContainer.children.unshift(this.spatialIcon),this.menu.markDirty())}}class AU{constructor(e,t){u(this,"isComponent",!0);u(this,"enabled",!0);u(this,"gameObject");u(this,"allowModifyUI",!0);u(this,"context");u(this,"onclick");this.context=e,this.onclick=t}get activeAndEnabled(){return!0}__internalAwake(){}__internalEnable(){}__internalDisable(){}__internalStart(){}onEnable(){}onDisable(){}get element(){return this.gameObject}onPointerEnter(){this.context.input.setCursorPointer(),this.allowModifyUI&&(this.element.set({backgroundOpacity:1}),Zi.update())}onPointerExit(){this.context.input.setCursorNormal(),this.allowModifyUI&&(this.element.set({backgroundOpacity:0}),Zi.update())}onPointerDown(e){e.use()}onPointerUp(e){e.use()}onPointerClick(e){e.use(),this.onclick()}}const hg="needle-menu",AA=ie("debugmenu"),_U=ie("debugnoncommercial");let koe=class{constructor(e){u(this,"_context");u(this,"_menu");u(this,"_spatialMenu");u(this,"onPostMessage",e=>{if(e.origin===globalThis.location.origin&&typeof e.data=="object"){const t=e.data,i=t.type;if(i==="needle:menu"){const n=t.button;if(n){if(!n.label)return console.error("NeedleMenu: buttoninfo.label is required");if(!n.onclick)return console.error("NeedleMenu: buttoninfo.onclick is required");const r=document.createElement("button");if(r.textContent=n.label,n.icon){const o=br(n.icon);r.prepend(o)}n.priority&&r.setAttribute("priority",n.priority.toString()),r.onclick=()=>{if(n.onclick){const o=n.onclick.startsWith("http")||n.onclick.startsWith("www."),a=n.target||"_blank";o?globalThis.open(n.onclick,a):console.error("NeedleMenu: onclick is not a valid link",n.onclick)}},this._menu.appendChild(r)}else AA&&console.error("NeedleMenu: unknown postMessage event",t)}else AA&&console.warn("NeedleMenu: unknown postMessage type",i,t)}});u(this,"onStartXR",e=>{e.session.isScreenBasedAR&&(this._menu.previousParent=this._menu.parentNode,this._context.arOverlayElement.appendChild(this._menu),e.session.session.addEventListener("end",this.onExitXR),this._menu.closeFoldout())});u(this,"onExitXR",()=>{this._menu.previousParent&&(this._menu.previousParent.appendChild(this._menu),delete this._menu.previousParent)});u(this,"_muteButton");u(this,"_fullscreenButton");this._menu=wS.getOrCreate(e.domElement,e),this._context=e,this._spatialMenu=new Ooe(e,this._menu),window.addEventListener("message",this.onPostMessage),oE(this.onStartXR)}onDestroy(){window.removeEventListener("message",this.onPostMessage),this._menu.remove(),this._spatialMenu.onDestroy()}setPosition(e){this._menu.setPosition(e)}setVisible(e){this._menu.setVisible(e)}showNeedleLogo(e){var t;this._menu.showNeedleLogo(e),(t=this._spatialMenu)==null||t.showNeedleLogo(e)}showSpatialMenu(e){this._spatialMenu.setEnabled(e)}setSpatialMenuVisible(e){this._spatialMenu.setDisplay(e)}get spatialMenuIsVisible(){return this._spatialMenu.isVisible}showQRCodeButton(e){if(e==="desktop-only"&&(e=!St.isMobileDevice()),e){const t=Ml.getOrCreate().createQRCode();return t.style.display="",this._menu.appendChild(t),t}else{const t=Ml.getOrCreate().qrButton;return t&&(t.style.display="none"),t??null}}showAudioPlaybackOption(e){var t;if(!e){(t=this._muteButton)==null||t.remove();return}this._muteButton=Ml.getOrCreate().createMuteButton(this._context),this._muteButton.setAttribute("priority","100"),this._menu.appendChild(this._muteButton)}showFullscreenOption(e){var t;if(!e){(t=this._fullscreenButton)==null||t.remove();return}this._fullscreenButton=Ml.getOrCreate().createFullscreenButton(this._context),this._fullscreenButton&&(this._fullscreenButton.setAttribute("priority","150"),this._menu.appendChild(this._fullscreenButton))}appendChild(e){return this._menu.appendChild(e)}};var G0,H0,HR;const u2=class extends HTMLElement{constructor(){var d,f,p,m,v,y;super();ls(this,H0);u(this,"_domElement",null);u(this,"_context",null);u(this,"_sizeChangeInterval");ls(this,G0,t=>{if(!t.defaultPrevented&&t.target==this._domElement&&t instanceof PointerEvent&&t.button===0&&this.root.classList.contains("open")){const i=this.foldout.getBoundingClientRect(),n=t;n.clientX>i.left&&n.clientX<i.right&&n.clientY>i.top&&n.clientY<i.bottom||this.root.classList.toggle("open",!1)}});u(this,"_userRequestedLogoVisible");u(this,"_userRequestedMenuVisible");u(this,"root");u(this,"wrapper");u(this,"options");u(this,"logoContainer");u(this,"compactMenuButton");u(this,"foldout");u(this,"_isHandlingChange",!1);u(this,"_didSort",new Map);u(this,"_lastAvailableWidthChange",0);u(this,"_timeoutHandle",0);u(this,"handleSizeChange",(t,i)=>{if(!this._domElement)return;const n=this._domElement.clientWidth;if(n<100){clearTimeout(this._timeoutHandle),this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style");return}const r=20*2,o=n-r;if(!i&&Math.abs(o-this._lastAvailableWidthChange)<1)return;this._lastAvailableWidthChange=o,clearTimeout(this._timeoutHandle),this._timeoutHandle=setTimeout(()=>{const c=l();c<0?(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")):c>0&&(this.root.classList.remove("compact"),this.foldout.classList.remove("floating-panel-style"),l()<0&&(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")))},5);const a=()=>this.options.clientWidth+this.logoContainer.clientWidth,l=()=>o-a()});const t=document.createElement("template");t.innerHTML=`<style>

        #root {
            position: absolute;
            width: auto;
            max-width: 95%;
            left: 50%;
            transform: translateX(-50%);
            top: min(20px, 10vh);
            padding: 0.3rem;
            display: flex;
            visibility: visible;
            flex-direction: row-reverse; /* if we overflow this should be right aligned so the logo is always visible */
            pointer-events: all;
            z-index: 1000;
        }

        /** hide the menu if it's empty **/
        #root.has-no-options.logo-hidden {
            display: none; 
        }

        /** using a div here because then we can change the class for placement **/
        #root.bottom {
            top: auto;
            bottom: min(30px, 10vh);
        }
        #root.top {
            top: calc(.7rem + env(safe-area-inset-top));
        }
        
        .wrapper {
            position: relative;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 0px;
            padding: 0 0rem;
        }

        .wrapper > *, .options > button, .options > select, ::slotted(*) {
            position: relative;
            border: none;
            border-radius: 0;
            outline: 1px solid rgba(0,0,0,0);
            display: flex;
            justify-content: center;
            align-items: center;
            max-height: 2.3rem;
            max-width: 100%;

            /** basic font settings for all entries **/
            font-size: 1rem;
            font-family: 'Roboto Flex', sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-weight: 200;
            font-variation-settings: "wdth" 100;
            color: rgb(20,20,20);
        }

        .floating-panel-style {
            background: rgba(255, 255, 255, .4);
            outline: rgb(0 0 0 / 5%) 1px solid;
            border: 1px solid rgba(255, 255, 255, .1);
            box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);
            border-radius: 1.5rem;
            /** 
             * to make nested background filter work 
             * https://stackoverflow.com/questions/60997948/backdrop-filter-not-working-for-nested-elements-in-chrome 
             **/
            &::before {
                content: '';
                position: absolute;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                z-index: -1;
                border-radius: 1.5rem;
                -webkit-backdrop-filter: blur(8px);
                backdrop-filter: blur(8px);
            }
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        .options {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .options > *, ::slotted(*) {
            max-height: 2.25rem;
            padding: .4rem .5rem;
        }
        
        :host .options > *, ::slotted(*) {
            background: transparent;
            border: none;
            white-space: nowrap;
            transition: all 0.1s linear .02s;
            border-radius: 1.5rem;
            user-select: none;
        }
        :host .options > *:hover, ::slotted(*:hover) {
            cursor: pointer;
            color: black;
            background: rgba(245, 245, 245, .8);
            box-shadow: inset 0 0 1rem rgba(0,0,30,.2);
            outline: rgba(0,0,0,.1) 1px solid;
        }
        :host .options > *:active, ::slotted(*:active) {
            background: rgba(255, 255, 255, .8);
            box-shadow: inset 0px 1px 1px rgba(255,255,255,.5), inset 0 0 2rem rgba(0,0,30,.2), inset 0px 2px 4px rgba(0,0,20,.5);
            transition: all 0.05s linear;
        }
        :host .options > *:focus, ::slotted(*:focus) {
            outline: rgba(255,255,255,.5) 1px solid;
        }
        :host .options > *:focus-visible, ::slotted(*:focus-visible) {
            outline: rgba(0,0,0,.5) 1px solid;
        }

        :host .options > *:disabled, ::slotted(*:disabled) {
            background: rgba(0,0,0,.05);
            color: rgba(60,60,60,.7);
            pointer-events: none;
        }

        button, ::slotted(button) {
            gap: 0.3rem;
        }

        /** XR button animation **/
        :host button.this-mode-is-requested {
            background: repeating-linear-gradient(to right, #fff 0%, #fff 40%, #aaffff 55%, #fff 80%);
            background-size: 200% auto;
            background-position: 0 100%;
            animation: AnimationName .7s ease infinite forwards;
        }
        :host button.other-mode-is-requested {
            opacity: .5;
        }
        
        @keyframes AnimationName {
            0% { background-position: 0% 0 }
            100% { background-position: -200% 0 }
        }




        .logo {
            cursor: pointer;
            padding-left: 0.6rem;
            padding-bottom: .02rem;
            margin-right: 0.5rem;
        }
        .logo-hidden {
            .logo {
                display: none;
            }
        }
        :host .has-options .logo {
            border-left: 1px solid rgba(40,40,40,.4);
            margin-left: 0.3rem;
            margin-right: 0.5rem;
        }

        .logo > span {
            white-space: nowrap;
        }



        /** COMPACT */

        /** Hide the menu button normally **/
        .compact-menu-button { display: none; }
        /** And show it when we're in compact mode **/
        .compact .compact-menu-button {
            position: relative;
            display: block;
            background: none;
            border: none;
            border-radius: 2rem;

            margin: 0;
            padding: 0 .3rem;
            padding-top: .2rem;

            z-index: 100;

            color: #000;

            &:hover {
                background: rgba(255,255,255,.2);
                cursor: pointer;
            }
            &:focus {
                outline: 1px solid rgba(255,255,255,.5);
            }
            &:focus-visible {
                outline: 1px solid rgba(0,0,0,.5);
            }
            & .expanded-click-area {
                position: absolute;
                left: 0;
                right: 0;
                top: 10%;
                bottom: 10%;
                transform: scale(1.8);
            }
        }  
        .has-no-options .compact-menu-button {
            display: none;
        }
        .open .compact-menu-button {
            background: rgba(255,255,255,.2);
        }
        .logo-visible .compact-menu-button { 
            margin-left: .2rem;
        }
        
        /** Open and hide menu **/
        .compact .foldout { 
            display: none;
        }
        .open .options, .open .foldout {
            display: flex;
            justify-content: center;
        }
        .compact .wrapper {
            padding: 0;
        }
        .compact .wrapper, .compact .options {
            height: auto;
            max-height: initial;
            flex-direction: row;
            gap: .12rem;
        }
        .compact .options { 
            flex-wrap: wrap;
            gap: .3rem;
        }
        .compact .top .options {
            height: auto;
            flex-direction: row;
        }
        .compact .bottom .wrapper {
            height: auto;
            flex-direction: column;
        }

        .compact .foldout {
            max-height: min(100ch, calc(100vh - 100px));
            overflow: auto;
            overflow-x: hidden;
            align-items: center;

            position: fixed;
            bottom: calc(100% + 5px);
            z-index: 100;
            width: auto;
            left: .2rem;
            right: .2rem;
            padding: .2rem;

        }
        .compact.logo-hidden .foldout {
            /** for when there's no logo we want to center the foldout **/
            min-width: 24ch;
            margin-left: 50%;
            transform: translateX(calc(-50% - .2rem));
        }
        
        .compact.top .foldout {
            top: calc(100% + 5px);
            bottom: auto;
        }

        ::-webkit-scrollbar {
            max-width: 7px;
            background: rgba(100,100,100,.2);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, .3);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgb(150,150,150);
        }

        .compact .options > *, .compact .options > ::slotted(*) {
            font-size: 1.2rem;
            padding: .6rem .5rem;
            width: 100%;
        }
        .compact.has-options .logo {
            border: none;
            padding-left: 0;
            margin-left: 1rem;
            margin-bottom: .02rem;
        }
        .compact .options { 
            /** e.g. if we have a very wide menu item like a select with long option names we don't want to overflow **/
            max-width: 100%;
            
            & > button, & > select {
                display: flex;
                flex-basis: 100%;
                min-height: 3rem;
            }
            & > button.row2 {
                //border: 1px solid red !important;
                display: flex;
                flex: 1;
                flex-basis: 30%;
            }
        }

        /** If there's really not enough space then just hide all options **/
        @media (max-width: 100px) or (max-height: 100px){
            .foldout {
                display: none !important;
            }
            .compact-menu-button {
                display: none !important;
            }
        }
        
        /* dark mode */
        /*
        @media (prefers-color-scheme: dark) {
            :host {
                background: rgba(0,0,0, .6);
            }
            :host button {
                color: rgba(200,200,200);
            }
            :host button:hover {
                background: rgba(100,100,100, .8);
            }
        }
        */

        </style>
        
        <div id="root" class="logo-visible floating-panel-style bottom">
            <div class="wrapper">
                <div class="foldout">
                    <div class="options" part="options">
                        <slot></slot>
                    </div>
                    <div class="options" part="options">
                        <slot name="end"></slot>
                    </div>
                </div>
                <div style="user-select:none" class="logo">
                    <span class="madewith notranslate">powered by</span>
                </div>
            </div>
            <button class="compact-menu-button">
                <div class="expanded-click-area"></div>
            </button>
        </div>
        `;const i=this.attachShadow({mode:"open"});rQ(),bS(GR,{loadedCallback:()=>{this.handleSizeChange()}}),bS(GR,{element:i});const n=t.content.cloneNode(!0);i==null||i.appendChild(n),this.root=i.querySelector("#root"),this.wrapper=(d=this.root)==null?void 0:d.querySelector(".wrapper"),this.options=(f=this.root)==null?void 0:f.querySelector(".options"),this.logoContainer=(p=this.root)==null?void 0:p.querySelector(".logo"),this.compactMenuButton=(m=this.root)==null?void 0:m.querySelector(".compact-menu-button"),this.compactMenuButton.append(br("more_vert")),this.foldout=(v=this.root)==null?void 0:v.querySelector(".foldout"),(y=this.root)==null||y.appendChild(this.wrapper),this.wrapper.classList.add("wrapper");const r=oQ.create();r.style.minHeight="1rem",this.logoContainer.append(r),this.logoContainer.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")});try{Voe(g=>{if(g==!0&&ru()&&!_U){let _=this._userRequestedLogoVisible;_===void 0&&(_=!1),lf(this,H0,HR).call(this,_)}})}catch(g){console.error("[Needle Menu] License check failed.",g)}this.compactMenuButton.addEventListener("click",g=>{g.preventDefault(),this.root.classList.toggle("open")});let o=this._context;setTimeout(()=>o=this._context);let a=0;const l=(g,_)=>{var A,b,E;AA&&console.log("Set menu visible",_),o!=null&&o.isInAR&&o.arOverlayElement?g!=o.arOverlayElement&&o.arOverlayElement.appendChild(this):this.parentNode!=((A=this._domElement)==null?void 0:A.shadowRoot)&&((E=(b=this._domElement)==null?void 0:b.shadowRoot)==null||E.appendChild(this)),this.style.display=_?"flex":"none",this.style.visibility="visible",this.style.opacity="1"};let c=!1;new MutationObserver(g=>{var _;if(!c)try{c=!0,this.onChangeDetected(g);const A=this==null?void 0:this.parentNode;if((this.style.display!="flex"||this.style.visibility!="visible"||this.style.opacity!="1"||A!=((_=this._domElement)==null?void 0:_.shadowRoot))&&!ru()){const b=a++;So()&&this._userRequestedMenuVisible===!1?(b===0&&l(A,this._userRequestedMenuVisible),b===1&&console.warn("Needle Menu Warning: You need a PRO license to hide the Needle Engine menu → The menu will be visible in your deployed website if you don't have a PRO license. See https://needle.tools/pricing for details.")):b===0?l(A,!0):setTimeout(()=>l(A,!0),5)}}finally{c=!1}}).observe(this.root,{childList:!0,subtree:!0,attributes:!0}),AA&&this.___insertDebugOptions()}static create(){return document.createElement(hg,{is:hg})}static getOrCreate(t,i){let n=t.querySelector(hg);return!n&&t.shadowRoot&&(n=t.shadowRoot.querySelector(hg)),n||(n=u2.create(),t.shadowRoot?t.shadowRoot.appendChild(n):t.appendChild(n)),n._domElement=t,n._context=i,n}connectedCallback(){window.addEventListener("resize",this.handleSizeChange),this.handleMenuVisible(),this._sizeChangeInterval=setInterval(()=>this.handleSizeChange(void 0,!0),5e3),setTimeout(()=>{var t,i;(t=this._domElement)==null||t.addEventListener("resize",this.handleSizeChange),(i=this._domElement)==null||i.addEventListener("click",wt(this,G0))},1)}disconnectedCallback(){var t,i;window.removeEventListener("resize",this.handleSizeChange),clearInterval(this._sizeChangeInterval),(t=this._domElement)==null||t.removeEventListener("resize",this.handleSizeChange),(i=this._context)==null||i.domElement.removeEventListener("click",wt(this,G0))}showNeedleLogo(t){this._userRequestedLogoVisible=t,!(!t&&(!ru()||_U)&&(console.warn("Needle Menu: You need a PRO license to hide the Needle Engine logo."),!So()))&&lf(this,H0,HR).call(this,t)}setPosition(t){if(t!=="top"&&t!=="bottom")return console.error("NeedleMenu.setPosition: invalid position",t);this.root.classList.remove("top","bottom"),this.root.classList.add(t)}setVisible(t){this._userRequestedMenuVisible=t,this.style.display=t?"flex":"none"}closeFoldout(){this.root.classList.remove("open")}append(...t){for(const i of t)if(typeof i=="string"){const n=document.createTextNode(i);this.options.appendChild(n)}else this.options.appendChild(i)}appendChild(t){var n;if(!(t instanceof Node)){const r=document.createElement("button");if(r.textContent=t.label,r.onclick=t.onClick,r.setAttribute("priority",((n=t.priority)==null?void 0:n.toString())??"0"),t.title&&(r.title=t.title),t.icon){const o=br(t.icon);t.iconSide==="right"?r.appendChild(o):r.prepend(o)}t.class&&r.classList.add(t.class),t=r}return this.options.appendChild(t)}prepend(...t){for(const i of t)if(typeof i=="string"){const n=document.createTextNode(i);this.options.prepend(n)}else this.options.prepend(i)}onChangeDetected(t){if(!this._isHandlingChange){this._isHandlingChange=!0;try{this.handleMenuVisible();for(const i of t)i.target==this.options&&this.onOptionsChildrenChanged(i)}finally{this._isHandlingChange=!1}}}onOptionsChildrenChanged(t){if(this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions),this.handleSizeChange(void 0,!0),t.type==="childList"&&t.addedNodes.length>0){const i=Array.from(this.options.children);i.sort((r,o)=>{const a=parseInt(r.getAttribute("priority")||"0"),l=parseInt(o.getAttribute("priority")||"0");return a-l});let n=!1;for(let r=0;r<i.length;r++){const o=this.options.children[r],a=i[r];if(o!==a){n=!0;break}}if(n)for(const r of i)this.options.appendChild(r)}}handleMenuVisible(){AA&&console.log("Update VisibleState: Any Content?",this.hasAnyContent),this.hasAnyContent?this.root.style.display="":this.root.style.display="none",this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions)}get hasAnyContent(){return!!(this.logoContainer.style.display!="none"||this.hasAnyVisibleOptions)}get hasAnyVisibleOptions(){for(let t=0;t<this.options.children.length;t++){const i=this.options.children[t];if(i.tagName==="SLOT"){const r=i.assignedNodes();for(const o of r)if(o instanceof HTMLElement&&o.style.display!="none")return!0}else if(i.style.display!="none")return!0}return!1}___insertDebugOptions(){window.addEventListener("keydown",n=>{n.key==="p"&&this.setPosition(this.root.classList.contains("top")?"bottom":"top")});const t=document.createElement("button");t.textContent="Hide Buttons",t.onclick=()=>{const n=new Array(this.options.children.length);for(let r=0;r<this.options.children.length;r++)n[r]=this.options.children[r];for(const r of n)this.options.removeChild(r);setTimeout(()=>{for(const r of n)this.options.appendChild(r)},1e3)},this.appendChild(t);const i=document.createElement("button");i.textContent="Toggle Logo",i.addEventListener("click",()=>{this.logoContainer.style.display=this.logoContainer.style.display==="none"?"":"none"}),this.appendChild(i)}};let wS=u2;G0=new WeakMap,H0=new WeakSet,HR=function(t){this.logoContainer.style.display="",this.logoContainer.style.opacity="1",this.logoContainer.style.visibility="visible",t?(this.root.classList.remove("logo-hidden"),this.root.classList.add("logo-visible")):(this.root.classList.remove("logo-visible"),this.root.classList.add("logo-hidden"))};customElements.get(hg)||customElements.define(hg,wS);const Es=ie("debugcontext"),Foe=ie("stats"),Uoe=ie("debugactive"),Noe=ie("debugframerate"),zoe=ie("debugcoroutine"),Goe={};class Hoe{constructor(){u(this,"name");u(this,"alias");u(this,"hash");u(this,"runInBackground");u(this,"domElement");u(this,"renderer");u(this,"camera");u(this,"scene")}}var Wt;(function(s){s[s.Start=-1]="Start",s[s.EarlyUpdate=0]="EarlyUpdate",s[s.Update=1]="Update",s[s.LateUpdate=2]="LateUpdate",s[s.OnBeforeRender=3]="OnBeforeRender",s[s.OnAfterRender=4]="OnAfterRender",s[s.PrePhysicsStep=9]="PrePhysicsStep",s[s.PostPhysicsStep=10]="PostPhysicsStep",s[s.Undefined=-1]="Undefined"})(Wt||(Wt={}));function yE(s,e){if(!s)return;if(!s.isComponent){(Xe()||Es)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,s);return}e||(e=Ot.Current,Es&&console.warn("> Registering component without context"));const t=e==null?void 0:e.new_scripts;t.includes(s)||t.push(s)}const sn=class{constructor(e){u(this,"name");u(this,"alias");u(this,"isManagedExternally",!1);u(this,"isPaused",!1);u(this,"runInBackground",!1);u(this,"targetFrameRate");u(this,"physicsSteps",1);u(this,"hash");u(this,"domElement");u(this,"_resolutionScaleFactor",1);u(this,"_boundingClientRectFrame",-1);u(this,"_boundingClientRect",null);u(this,"_domX");u(this,"_domY");u(this,"xr",null);u(this,"_xrFrame",null);u(this,"_currentFrameEvent",Wt.Undefined);u(this,"scene");u(this,"renderer");u(this,"composer",null);u(this,"scripts",[]);u(this,"scripts_pausedChanged",[]);u(this,"scripts_earlyUpdate",[]);u(this,"scripts_update",[]);u(this,"scripts_lateUpdate",[]);u(this,"scripts_onBeforeRender",[]);u(this,"scripts_onAfterRender",[]);u(this,"scripts_WithCorroutines",[]);u(this,"scripts_immersive_vr",[]);u(this,"scripts_immersive_ar",[]);u(this,"coroutines",{});u(this,"post_setup_callbacks",[]);u(this,"pre_update_callbacks",[]);u(this,"pre_render_callbacks",[]);u(this,"post_render_callbacks",[]);u(this,"pre_update_oneshot_callbacks",[]);u(this,"new_scripts",[]);u(this,"new_script_start",[]);u(this,"new_scripts_pre_setup_callbacks",[]);u(this,"new_scripts_post_setup_callbacks",[]);u(this,"new_scripts_xr",[]);u(this,"mainCameraComponent");u(this,"_mainCamera",null);u(this,"_fallbackCamera",null);u(this,"application");u(this,"animations");u(this,"time");u(this,"input");u(this,"physics");u(this,"connection");u(this,"assets");u(this,"mainLight",null);u(this,"sceneLighting");u(this,"addressables");u(this,"lightmaps");u(this,"players");u(this,"lodsManager");u(this,"menu");u(this,"_sizeChanged",!1);u(this,"_isCreated",!1);u(this,"_isCreating",!1);u(this,"_isVisible",!1);u(this,"_stats",Foe?new dA:null);u(this,"_intersectionObserver",null);u(this,"_disposeCallbacks",[]);u(this,"maxRenderResolution");u(this,"_originalCreationArgs");u(this,"onUnhandledRejection",e=>{this.onError(e.reason)});u(this,"_cameraStack",[]);u(this,"_onBeforeRenderListeners",new Map);u(this,"_onAfterRenderListeners",new Map);u(this,"_requireDepthTexture",!1);u(this,"_requireColorTexture",!1);u(this,"_renderTarget");u(this,"_isRendering",!1);u(this,"_createId",0);u(this,"_renderlooperrors",0);u(this,"_lastTimestamp",0);u(this,"_accumulatedTime",0);u(this,"_dispatchReadyAfterFrame",!1);u(this,"_wasPaused",!1);this.name=(e==null?void 0:e.name)||"",this.alias=e==null?void 0:e.alias,this.domElement=(e==null?void 0:e.domElement)||document.body,this.hash=e==null?void 0:e.hash,e!=null&&e.renderer&&(this.renderer=e.renderer,this.isManagedExternally=!0),(e==null?void 0:e.runInBackground)!==void 0&&(this.runInBackground=e.runInBackground),e!=null&&e.scene?this.scene=e.scene:this.scene=new Ks,e!=null&&e.camera&&(this._mainCamera=e.camera),this.application=new Bl(this),this.time=new iQ,this.input=new tV(this),this.physics=new Bg(this),this.connection=new KV(this),this.assets=new t5,this.sceneLighting=new eQ(this),this.addressables=new G5(this),this.lightmaps=new woe(this),this.players=new $5(this),this.menu=new koe(this),this.lodsManager=new Soe(this),this.animations=new toe(this);const t=()=>this._sizeChanged=!0;window.addEventListener("resize",t),this._disposeCallbacks.push(()=>window.removeEventListener("resize",t));const i=new ResizeObserver(n=>this._sizeChanged=!0);i.observe(this.domElement),this._disposeCallbacks.push(()=>i.disconnect()),this._intersectionObserver=new IntersectionObserver(n=>{this._isVisible=n[0].isIntersecting}),this._disposeCallbacks.push(()=>{var n;return(n=this._intersectionObserver)==null?void 0:n.disconnect()}),xi.register(this)}static get DefaultTargetFrameRate(){return sn._defaultTargetFramerate.value}static set DefaultTargetFrameRate(e){sn._defaultTargetFramerate.value=e}static get DefaultWebGLRendererParameters(){return sn._defaultWebglRendererParameters}get version(){return ja}static get Current(){return xi.Current}static set Current(e){xi.Current=e}appendHTMLElement(e){return this.domElement.shadowRoot?this.domElement.shadowRoot.appendChild(e):this.domElement.appendChild(e)}get resolutionScaleFactor(){return this._resolutionScaleFactor}set resolutionScaleFactor(e){if(e!==this._resolutionScaleFactor&&typeof e=="number"){if(e<=0){console.error("Invalid resolution scale factor",e);return}this._resolutionScaleFactor=e,this.updateSize()}}calculateBoundingClientRect(){if(this.xr){this._domX=0,this._domY=0;return}this._boundingClientRectFrame!==this.time.frame&&(this._boundingClientRectFrame=this.time.frame,this._boundingClientRect=this.domElement.getBoundingClientRect(),this._domX=this._boundingClientRect.x,this._domY=this._boundingClientRect.y)}get domWidth(){return this.isInAR?window.innerWidth:this.domElement.clientWidth}get domHeight(){return this.isInAR?window.innerHeight:this.domElement.clientHeight}get domX(){return this.calculateBoundingClientRect(),this._domX}get domY(){return this.calculateBoundingClientRect(),this._domY}get isInXR(){var e,t;return((t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.isPresenting)||!1}get xrSessionMode(){var e;return(e=this.xr)==null?void 0:e.mode}get isInVR(){return this.xrSessionMode==="immersive-vr"}get isInAR(){return this.xrSessionMode==="immersive-ar"}get isInPassThrough(){return this.xr?this.xr.isPassThrough:!1}get xrSession(){var e,t;return(t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.getSession()}get xrFrame(){return this._xrFrame}get xrCamera(){var e,t;return this.renderer.xr.isPresenting?(t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.getCamera():void 0}get arOverlayElement(){const e=this.domElement;return typeof e.getAROverlayContainer=="function"?e.getAROverlayContainer():this.domElement}get currentFrameEvent(){return this._currentFrameEvent}get mainCamera(){if(this._mainCamera)return this._mainCamera;if(this.mainCameraComponent){const e=this.mainCameraComponent;return e.threeCamera||e.buildCamera(),e.threeCamera}return this._fallbackCamera||(this._fallbackCamera=new zt(75,this.domWidth/this.domHeight,.1,1e3)),this._fallbackCamera}set mainCamera(e){this._mainCamera=e}get rendererData(){return this.sceneLighting}get isCreated(){return this._isCreated}createNewRenderer(e){var t,i,n;if((t=this.renderer)==null||t.dispose(),e={...sn.DefaultWebGLRendererParameters,...e},!e.canvas){const r=(n=(i=this.domElement)==null?void 0:i.shadowRoot)==null?void 0:n.querySelector("canvas");r&&(e.canvas=r,Es&&console.log("Using canvas from shadow root",r))}Es&&console.log("Using Renderer Parameters:",e,this.domElement),this.renderer=new eh(e),this.renderer.debug.checkShaderErrors=Xe()||ie("checkshadererrors")===!0,this.renderer.toneMappingExposure=1,this.renderer.toneMapping=_o,this.renderer.setClearColor(new me("lightgrey"),0),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=EP,this.renderer.setSize(this.domWidth,this.domHeight),this.renderer.outputColorSpace=_t,this.lodsManager.setRenderer(this.renderer),this.input.bindEvents()}internalOnUpdateVisible(){var e,t;(e=this._intersectionObserver)==null||e.disconnect(),(t=this._intersectionObserver)==null||t.observe(this.domElement)}requestSizeUpdate(){this._sizeChanged=!0}updateSize(e=!1){var t,i,n;if(e||!this.isManagedExternally&&((t=this.renderer.xr)==null?void 0:t.isPresenting)===!1){this._sizeChanged=!1;const r=this.resolutionScaleFactor;let o=this.domWidth*r,a=this.domHeight*r;this.maxRenderResolution&&(this.maxRenderResolution.x=Math.max(1,this.maxRenderResolution.x),o=Math.min(this.maxRenderResolution.x,o),this.maxRenderResolution.y=Math.max(1,this.maxRenderResolution.y),a=Math.min(this.maxRenderResolution.y,a));const l=this.mainCamera;this.updateAspect(l),this.renderer.setSize(o,a,!0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.composer&&((i=this.composer.setSize)==null||i.call(this.composer,o,a),"setPixelRatio"in this.composer&&typeof this.composer.setPixelRatio=="function"&&((n=this.composer.setPixelRatio)==null||n.call(this.composer,window.devicePixelRatio)))}}updateAspect(e,t,i){if(!e)return;t===void 0&&(t=this.domWidth),i===void 0&&(i=this.domHeight);const n=e.aspect;e.aspect=t/i,n!==e.aspect&&e.updateProjectionMatrix()}recreate(){this.clear(),this.create(this._originalCreationArgs)}async onCreate(e){return this.create(e)}async create(e){try{this._isCreating=!0,e!==this._originalCreationArgs&&(this._originalCreationArgs=s_(e)),window.addEventListener("unhandledrejection",this.onUnhandledRejection);const t=await this.internalOnCreate(e);return this._isCreated=t,t}finally{window.removeEventListener("unhandledrejection",this.onUnhandledRejection),this._isCreating=!1}}onError(e){this.domElement.dispatchEvent(new CustomEvent("error",{detail:e}))}clear(){var e,t,i,n;xi.dispatchCallback(yi.ContextClearing,this),Xl(this,yi.ContextClearing),ba(this.scene,!0,!0),this.scene=new Ks,(e=this.addressables)==null||e.dispose(),(t=this.lightmaps)==null||t.clear(),(n=(i=this.physics)==null?void 0:i.engine)==null||n.clearCaches(),this.isManagedExternally||this.renderer&&(this.renderer.renderLists.dispose(),this.renderer.state.reset(),this.renderer.resetState()),xi.dispatchCallback(yi.ContextCleared,this)}dispose(){this.internalOnDestroy()}onDestroy(){this.internalOnDestroy()}internalOnDestroy(){var e,t;sn.Current=this,xi.dispatchCallback(yi.ContextDestroying,this),Xl(this,yi.ContextDestroying),this.clear(),(e=this.renderer)==null||e.setAnimationLoop(null),this.renderer&&(this.renderer.setClearAlpha(0),this.renderer.clear(),this.isManagedExternally||(Es&&console.log("Disposing renderer"),this.renderer.dispose())),this.scene=null,this.renderer=null,this.input.dispose(),this.menu.onDestroy(),this.animations.onDestroy();for(const i of this._disposeCallbacks)try{i()}catch(n){console.error("Error in on dispose callback:",n,i)}(t=this.domElement)!=null&&t.parentElement&&this.domElement.parentElement.removeChild(this.domElement),this._isCreated=!1,xi.dispatchCallback(yi.ContextDestroyed,this),Xl(this,yi.ContextDestroyed),xi.unregister(this),sn.Current===this&&(sn.Current=null)}registerCoroutineUpdate(e,t,i){return typeof(t==null?void 0:t.next)!="function"?(console.error("Registered invalid coroutine function from "+e.name+`
Coroutine functions must be generators: "*myCoroutine() {...}"
Start a coroutine from a component by calling "this.startCoroutine(myCoroutine())"`),t):(this.coroutines[i]||(this.coroutines[i]=[]),this.coroutines[i].push({comp:e,main:t}),t)}unregisterCoroutineUpdate(e,t){if(!this.coroutines[t])return;const i=this.coroutines[t].findIndex(n=>n.main===e);i>=0&&this.coroutines[t].splice(i,1)}stopAllCoroutinesFrom(e){for(const t in this.coroutines){const i=this.coroutines[t];for(let n=i.length-1;n>=0;n--)i[n].comp===e&&i.splice(n,1)}}setCurrentCamera(e){var n;if(!e)return;if(e.threeCamera||e.buildCamera(),!e.threeCamera){console.warn("Camera component is missing camera",e);return}const t=this._cameraStack.indexOf(e);t>=0&&this._cameraStack.splice(t,1),this._cameraStack.push(e),this.mainCameraComponent=e;const i=e.threeCamera;i.isPerspectiveCamera&&this.updateAspect(i),(n=this.mainCameraComponent)==null||n.applyClearFlagsIfIsActiveCamera()}removeCamera(e){if(!e)return;const t=this._cameraStack.indexOf(e);if(t>=0&&this._cameraStack.splice(t,1),this.mainCameraComponent===e&&(this.mainCameraComponent=void 0,this._cameraStack.length>0)){const i=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(i)}}addBeforeRenderListener(e,t){this._onBeforeRenderListeners.has(e.uuid)||(this._onBeforeRenderListeners.set(e.uuid,[]),e.onBeforeRender=this._createRenderCallbackWrapper(e,this._onBeforeRenderListeners)),this._onBeforeRenderListeners.get(e.uuid).push(t)}removeBeforeRenderListener(e,t){if(this._onBeforeRenderListeners.has(e.uuid)){const i=this._onBeforeRenderListeners.get(e.uuid),n=i.indexOf(t);n>=0&&i.splice(n,1)}}addAfterRenderListener(e,t){var i;this._onAfterRenderListeners.has(e.uuid)||(this._onAfterRenderListeners.set(e.uuid,[]),e.onAfterRender=this._createRenderCallbackWrapper(e,this._onAfterRenderListeners)),(i=this._onAfterRenderListeners.get(e.uuid))==null||i.push(t)}removeAfterRenderListener(e,t){if(this._onAfterRenderListeners.has(e.uuid)){const i=this._onAfterRenderListeners.get(e.uuid),n=i.indexOf(t);n>=0&&i.splice(n,1)}}_createRenderCallbackWrapper(e,t){return(i,n,r,o,a,l)=>{const c=t.get(e.uuid);if(c)for(let h=0;h<c.length;h++){const d=c[h];d(i,n,r,o,a,l)}}}get isRendering(){return this._isRendering}setRequireDepth(e){this._requireDepthTexture=e}setRequireColor(e){this._requireColorTexture=e}get depthTexture(){var e;return((e=this._renderTarget)==null?void 0:e.depthTexture)||null}get opaqueColorTexture(){var e;return((e=this._renderTarget)==null?void 0:e.texture)||null}get isVisibleToUser(){if(this.isInXR)return!0;if(!this._isVisible)return!1;const e=getComputedStyle(this.domElement);return e.visibility!=="hidden"&&e.display!=="none"&&e.opacity!=="0"}async internalOnCreate(e){var a,l,c,h,d,f,p,m;const t=++this._createId;Es&&console.log("Creating context",this.name,e);const i=globalThis["needle:dependencies:ready"];i instanceof Promise&&(Es&&console.log("Waiting for dependencies to be ready"),await i.catch(v=>{if(Es||Xe()){if(eE("Needle Engine dependencies failed to load. Please check the console for more details"),v instanceof ReferenceError){let y="YourComponentName";const g=v.message.indexOf("'");if(g>0){const _=v.message.indexOf("'",g+1);if(_>0){const A=v.message.substring(g+1,_);A.length>3&&(y=A)}}console.error(`Needle Engine dependencies failed to load:

# Make sure you don't have circular imports in your scripts!
→ Possible solution: Replace @serializable(${y}) in your script with @serializable(Behaviour)

---`,v);return}console.error("Needle Engine dependencies failed to load",v)}}).then(()=>{Es&&console.log("Needle Engine dependencies are ready")})),this.clear(),this.isManagedExternally===!1&&(this.createNewRenderer(),(a=this.renderer)==null||a.setAnimationLoop(null)),await Xc(1),sn.Current=this,await xi.dispatchCallback(yi.ContextCreationStart,this);let n=!0,r;try{sn.Current=this,e?r=await this.internalLoadInitialContent(t,e):r=[]}catch(v){console.error(v),n=!1}if(!n)return this.onError("Failed to load initial content"),!1;if(t!==this._createId||(l=e==null?void 0:e.abortSignal)!=null&&l.aborted)return!1;if(this.internalOnUpdateVisible(),!this.renderer)return Es&&console.warn("Context has no renderer (perhaps it was disconnected?",this.domElement.isConnected),!1;!this.isManagedExternally&&!this.domElement.shadowRoot&&this.domElement.prepend(this.renderer.domElement),sn.Current=this,sn.Current=this;for(let v=0;v<this.new_scripts.length;v++){const y=this.new_scripts[v];if(y.gameObject!==void 0&&y.gameObject!==null){y.gameObject.userData===void 0&&(y.gameObject.userData={}),y.gameObject.userData.components===void 0&&(y.gameObject.userData.components=[]);const g=y.gameObject.userData.components;g.includes(y)||g.push(y)}}if(this.post_setup_callbacks)for(let v=0;v<this.post_setup_callbacks.length;v++)sn.Current=this,await this.post_setup_callbacks[v](this);if(!this._mainCamera){sn.Current=this;let v=null;Np(this.scene,y=>{const g=y;if(g!=null&&g.isCamera){if(vA(g.gameObject),!g.activeAndEnabled)return;if(g.tag==="MainCamera")return v=g,!0;v=g}}),v?this.setCurrentCamera(v):!xi.dispatchCallback(yi.MissingCamera,this,{files:r})&&!this.mainCamera&&!this.isManagedExternally&&console.warn("Missing camera in main scene",this)}if(this.input.bindEvents(),sn.Current=this,fS(this),this.physics.engine&&((c=this.physics.engine)==null||c.step(0),(h=this.physics.engine)==null||h.postStep()),!this.isManagedExternally&&this.composer&&this.mainCamera){const v=new nE(this.scene,this.mainCamera);this.renderer.setSize(this.domWidth,this.domHeight),this.composer.addPass(v),this.composer.setSize(this.domWidth,this.domHeight)}this._sizeChanged=!0,this._stats&&(this._stats.showPanel(0),this._stats.dom.style.position="absolute",(d=this.domElement.shadowRoot)==null||d.appendChild(this._stats.dom)),Es&&rS(this.scene,!0),this.targetFrameRate===void 0?(Es&&console.warn("No target framerate set, using default",sn.DefaultTargetFrameRate),this.targetFrameRate=sn._defaultTargetFramerate):Es&&console.log("Target framerate set to",this.targetFrameRate),this._dispatchReadyAfterFrame=!0;const o=xi.dispatchCallback(yi.ContextCreated,this,{files:r});return o&&("internalSetLoadingMessage"in this.domElement&&typeof this.domElement.internalSetLoadingMessage=="function"&&((f=this.domElement)==null||f.internalSetLoadingMessage("finish loading")),await o),(p=e==null?void 0:e.abortSignal)!=null&&p.aborted?!1:(Xl(this,yi.ContextCreated),Es&&console.log("Context Created...",this.renderer,this.renderer.domElement),this._isCreating=!1,!this.isManagedExternally&&!((m=e==null?void 0:e.abortSignal)!=null&&m.aborted)&&this.restartRenderLoop(),!0)}async internalLoadInitialContent(e,t){var l,c,h,d;const i=new Array;if(t.files.length===0)return i;const n=[...t.files],r={name:"",progress:null,index:0,count:n.length},o=Fl(),a=0;for(let f=0;f<n.length;f++){if((l=t.abortSignal)!=null&&l.aborted){Es&&console.log("Aborting loading because of abort signal");break}if(e!==this._createId){Es&&console.log("Aborting loading because create id changed",e,this._createId);break}const p=n[f];(c=t==null?void 0:t.onLoadingStart)==null||c.call(this,f,p),Es&&console.log("Context Load "+p);const m=await o.loadSync(this,p,p,a,v=>{var y,g;(y=t.abortSignal)!=null&&y.aborted||(r.name=p,r.progress=v,r.index=f,r.count=n.length,(g=t.onLoadingProgress)==null||g.call(this,r))});(h=t==null?void 0:t.onLoadingFinished)==null||h.call(this,f,p,m??null),m?i.push({src:p,file:m}):console.warn("Could not load file: "+p)}if(e!==this._createId||(d=t.abortSignal)!=null&&d.aborted){for(const f of i)if(f&&f.file)for(const p of f.file.scenes)ba(p,!0,!0)}else{let f=!1;for(const p of i)p&&p.file&&(p.file.scene?(f=!0,this.scene.add(p.file.scene)):console.warn("No scene found in loaded file"));if(!f){for(const p of i)if(p&&p.file){let m=0;for(let v=0;v<p.file.parser.json.materials.length;v++){const y=await p.file.parser.getDependency("material",v),g=new ge;g.position.x=v*1.1,g.position.y=m,this.scene.add(g),Vd.createPrimitive("ShaderBall",{parent:g,material:y})}m+=1}}}return i}restartRenderLoop(){return this.renderer?this._isCreating?(console.warn("Can not start render loop while creating context"),!1):(this.renderer.setAnimationLoop((e,t)=>{this.isManagedExternally||this.update(e,t)}),!0):(console.error("Can not start render loop without renderer"),!1)}update(e,t){if(t===void 0&&(t=null),Xe()||Es||Zse())try{performance.mark("update.start"),this.internalStep(e,t),this._renderlooperrors=0,performance.mark("update.end"),performance.measure("NE Frame","update.start","update.end")}catch(i){this._renderlooperrors+=1,(Xe()||Es)&&(i instanceof Error||i instanceof TypeError)&&Pn("Caught unhandled exception during render-loop - see console for details.",os.Error),console.error("Frame #"+this.time.frame+`
`,i),this._renderlooperrors>=3&&(console.warn("Stopping render loop due to error"),this.renderer.setAnimationLoop(null)),this.domElement.dispatchEvent(new CustomEvent("error",{detail:i}))}else this.internalStep(e,t)}updatePhysics(e){this.internalUpdatePhysics(e)}internalStep(e,t){this.internalOnBeforeRender(e,t)!==!1&&(this.internalOnRender(),this.internalOnAfterRender())}internalOnBeforeRender(e,t){var n;this.renderer.info.autoReset=!0;const i=t!==null&&this._xrFrame===null;if(this._xrFrame=t,i&&this.domElement.dispatchEvent(new CustomEvent("xr-session-started",{detail:{context:this,session:this.xrSession,frame:t}})),this._currentFrameEvent=Wt.Undefined,this.isManagedExternally===!1&&this.isInXR===!1&&this.targetFrameRate!==void 0){this._lastTimestamp===0&&(this._lastTimestamp=e),this._accumulatedTime+=(e-this._lastTimestamp)/1e3,this._lastTimestamp=e;let r=this.targetFrameRate;if(typeof r=="object"&&(r=r.value),this._accumulatedTime<1/(r+1))return!1;this._accumulatedTime=0}if((n=this._stats)==null||n.begin(),sn.Current=this,this.onHandlePaused())return!1;for(sn.Current=this,this.time.update(),Noe&&console.log("FPS",this.time.smoothedFps.toFixed(0)),fS(this),yw(this.scene),c5(this),Xl(this,Wt.Start);this._cameraStack.length>0&&(!this.mainCameraComponent||this.mainCameraComponent.destroyed);){this._cameraStack.splice(this._cameraStack.length-1,1);const r=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(r)}if(this.pre_update_oneshot_callbacks){for(const r in this.pre_update_oneshot_callbacks)this.pre_update_oneshot_callbacks[r]();this.pre_update_oneshot_callbacks.length=0}if(this.pre_update_callbacks)for(const r in this.pre_update_callbacks)this.pre_update_callbacks[r]();this._currentFrameEvent=Wt.EarlyUpdate;for(let r=0;r<this.scripts_earlyUpdate.length;r++){const o=this.scripts_earlyUpdate[r];o.activeAndEnabled&&o.earlyUpdate!==void 0&&(sn.Current=this,o.earlyUpdate())}if(this.executeCoroutines(Wt.EarlyUpdate),Xl(this,Wt.EarlyUpdate),this.onHandlePaused())return!1;this._currentFrameEvent=Wt.Update;for(let r=0;r<this.scripts_update.length;r++){const o=this.scripts_update[r];o.activeAndEnabled&&o.update!==void 0&&(sn.Current=this,o.update())}if(this.executeCoroutines(Wt.Update),Xl(this,Wt.Update),this.onHandlePaused())return!1;this._currentFrameEvent=Wt.LateUpdate;for(let r=0;r<this.scripts_lateUpdate.length;r++){const o=this.scripts_lateUpdate[r];o.activeAndEnabled&&o.lateUpdate!==void 0&&(sn.Current=this,o.lateUpdate())}if(this.executeCoroutines(Wt.LateUpdate),Xl(this,Wt.LateUpdate),this.onHandlePaused()||(this.physicsSteps===void 0&&(this.physicsSteps=1),this.physics.engine&&this.physicsSteps>0&&this.internalUpdatePhysics(this.physicsSteps),this.onHandlePaused()))return!1;if(this.isVisibleToUser||this.runInBackground){this._currentFrameEvent=Wt.OnBeforeRender;for(let r=0;r<this.scripts_onBeforeRender.length;r++){const o=this.scripts_onBeforeRender[r];o.activeAndEnabled&&o.onBeforeRender!==void 0&&(sn.Current=this,o.onBeforeRender(t))}if(this.executeCoroutines(Wt.OnBeforeRender),Xl(this,Wt.OnBeforeRender),this._sizeChanged&&this.updateSize(),this.pre_render_callbacks)for(const r in this.pre_render_callbacks)this.pre_render_callbacks[r](t)}return!0}internalUpdatePhysics(e){if(!this.physics.engine)return!1;const t=e,i=this.time.deltaTime/t;for(let n=0;n<t;n++)this._currentFrameEvent=Wt.PrePhysicsStep,this.executeCoroutines(Wt.PrePhysicsStep),this.physics.engine.step(i),this._currentFrameEvent=Wt.PostPhysicsStep,this.executeCoroutines(Wt.PostPhysicsStep);return this.physics.engine.postStep(),!0}internalOnRender(){this.isManagedExternally||(ire(this),this._currentFrameEvent=Wt.Undefined,this.renderNow(),this._currentFrameEvent=Wt.OnAfterRender)}internalOnAfterRender(){if(this.isVisibleToUser||this.runInBackground){for(let e=0;e<this.scripts_onAfterRender.length;e++){const t=this.scripts_onAfterRender[e];t.activeAndEnabled&&t.onAfterRender!==void 0&&(sn.Current=this,t.onAfterRender())}if(this.executeCoroutines(Wt.OnAfterRender),Xl(this,Wt.OnAfterRender),this.post_render_callbacks)for(const e in this.post_render_callbacks)this.post_render_callbacks[e]()}this._currentFrameEvent=-1,this.connection.sendBufferedMessagesNow(),this._stats&&(this._stats.end(),this.time.frameCount%150===0&&console.log(this.renderer.info.render.calls+" DrawCalls",`
Render:`,{...this.renderer.info.render},`
Memory:`,{...this.renderer.info.memory},`
Target Framerate: `+this.targetFrameRate)),this._dispatchReadyAfterFrame&&(this._dispatchReadyAfterFrame=!1,this.domElement.dispatchEvent(new CustomEvent("ready")),xi.dispatchCallback(yi.ContextFirstFrameRendered,this))}renderNow(e){return!e&&(e=this.mainCamera,!e)?!1:(this.handleRendererContextLost(),this._isRendering=!0,this.renderRequiredTextures(),this.renderer.toneMapping!==_o&&nQ(),this.composer&&!this.isInXR?this.composer.render(this.time.deltaTime):e&&(this.isInXR&&St.isMacOS()&&this.renderer.clearDepth(),this.renderer.render(this.scene,e)),this._isRendering=!1,!0)}handleRendererContextLost(){this.renderer.getContext().isContextLost()&&(console.warn("Attempting to recover WebGL context..."),this.renderer.forceContextRestore())}onHandlePaused(){const e=this.evaluatePaused();if(this._wasPaused!==e){Uoe&&console.log("Paused?",e,"context:"+this.alias);for(let t=0;t<this.scripts_pausedChanged.length;t++){const i=this.scripts_pausedChanged[t];i.activeAndEnabled&&i.onPausedChanged!==void 0&&(sn.Current=this,i.onPausedChanged(e,this._wasPaused))}}return this._wasPaused=e,e}evaluatePaused(){return this.isInXR?!1:this.isPaused?!0:this.runInBackground?!1:!this.isVisibleToUser}renderRequiredTextures(){if(!this.mainCamera||!this._requireDepthTexture&&!this._requireColorTexture)return;if(!this._renderTarget){if(this._renderTarget=new Yt(this.domWidth,this.domHeight),this._requireDepthTexture){const i=new mv(this.domWidth,this.domHeight);this._renderTarget.depthTexture=i}this._requireColorTexture&&(this._renderTarget.texture=new Pt,this._renderTarget.texture.generateMipmaps=!1,this._renderTarget.texture.minFilter=ei,this._renderTarget.texture.magFilter=ei,this._renderTarget.texture.format=Ti)}const e=this._renderTarget;e.texture&&(e.texture.colorSpace=this.renderer.outputColorSpace);const t=this.renderer.getRenderTarget();this.renderer.setRenderTarget(e),this.renderer.render(this.scene,this.mainCamera),this.renderer.setRenderTarget(t)}executeCoroutines(e){var i;if(this.coroutines[e]){const n=this.coroutines[e];for(let r=0;r<n.length;r++)try{const o=n[r];if(!o.comp||o.comp.destroyed||!o.main||o.comp.enabled===!1){zoe&&console.log("Removing coroutine",o.comp,o.comp.enabled),n.splice(r,1),--r;continue}const l=o.chained;if(l&&l.length>0){const f=l[l.length-1].next();if(f.done&&l.pop(),t(f)&&(o.chained||(o.chained=[]),o.chained.push(f.value)),!f.done)continue}const c=o.main.next();if(c.done===!0){n.splice(r,1),--r;continue}const h=c.value;if(t(h)){if(h.next().done)continue;o.chained||(o.chained=[]),o.chained.push(h)}else if(h instanceof Promise){const d=h;o.chained||(o.chained=[]);const f=j5(d);(i=o.chained)==null||i.push(f);continue}}catch(o){console.error(o)}}function t(n){return!!(n&&n.next&&n.return)}}};let Ot=sn;u(Ot,"_defaultTargetFramerate",{value:90,toString(){return this.value}}),u(Ot,"_defaultWebglRendererParameters",{antialias:!0,alpha:!1,powerPreference:St.isiOS()||St.isMacOS()?"default":"high-performance"});const Va=ie("debuglicense");let gp="basic";Va&&console.log("License Type: "+gp);function yd(){switch(gp){case"pro":case"enterprise":return!0}return!1}function GD(){switch(gp){case"indie":return!0}return!1}function ru(){return yd()||GD()}const aQ=[];function Voe(s){if(yd()||GD())return s(!0);aQ.push(s)}function Qoe(s){for(const e of aQ)try{e(s)}catch{}}xi.registerCallback(yi.ContextRegistered,s=>{qoe(s.context),Yoe(),Woe(s.context)});let Ad,VR=!1,Yy="";async function joe(){if(Ad)return Ad;if(gp==="basic")try{const s="https://engine.needle.tools/licensing/check?location="+encodeURIComponent(window.location.href)+"&version="+ja+"&generator="+encodeURIComponent(tE),e=await fetch(s,{method:"GET"}).catch(t=>{Va&&console.error("License check failed",t)});(e==null?void 0:e.status)===200?(VR=!1,Va&&console.log("License check succeeded"),gp="pro",Qoe(!0)):(e==null?void 0:e.status)===403?(VR=!0,Yy=await e.text()):Va&&console.log("License check failed with status "+(e==null?void 0:e.status))}catch(s){Va&&console.error("License check failed",s)}else Va&&console.log('Runtime license check is skipped because license is already applied as "'+gp+'"')}Ad=joe();async function Woe(s){function e(){const n=document.createElement("div");n.className="needle-forbidden",n.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: all;
        zIndex: 2147483647;
        line-height: 1.5;
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        `;const r=n.style.cssText,o=document.createElement("div");n.appendChild(o),o.style.cssText=`
        position: absolute;
        left: 0;
        right: 0;
        top:0;
        bottom: 0;
        padding: 10%;
        color: white;
        font-size: 20px;
        font-family: sans-serif;
        text-align: center;
        pointer-events: all;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: rgba(0,0,0,.3);
        text-shadow: 0 0 2px black;
        `;const a=o.style.cssText,l=(Yy==null?void 0:Yy.length)>1?Yy:"This web application has been paused.<br/>You might be in violation of the Needle Engine terms of use.<br/>Please contact the Needle support if you think this is a mistake.";return o.innerHTML=l,setInterval(()=>{o.innerHTML!==l&&(o.innerHTML=l),o.parentNode!==n&&n.appendChild(o),n.style.cssText!==r&&(n.style.cssText=r),o.style.cssText!==a&&(o.style.cssText=a)},500),n}let t=e();const i=t.style.cssText;setInterval(()=>{var n;VR===!0&&(t.style.cssText!==i&&(t=e()),s.domElement.shadowRoot?t.parentNode!==s.domElement.shadowRoot&&((n=s.domElement.shadowRoot)==null||n.appendChild(t)):t.parentNode!=document.body&&document.body.appendChild(t))},500)}async function qoe(s){try{if(ru()!==!0)return YT(s)}catch(e){return Va&&console.log("License check failed",e),YT(s)}Va&&YT(s)}async function YT(s){s.domElement.addEventListener("ready",()=>!0),await(Ad==null?void 0:Ad.catch(()=>{})),!ru()&&Xoe()}let bU=0;async function Xoe(s){var o;const e=Date.now();if(e-bU<2e3)return;bU=e;const i=`
        position: relative;
        display: block;
        font-size: 18px;
        background-size: 20px;
        background-position: 10px 5px;
        background-repeat:no-repeat;
        background-image:url('data:image/webp;base64,UklGRrABAABXRUJQVlA4WAoAAAAQAAAAHwAAHwAAQUxQSKEAAAARN6CmbSM4WR7vdARON11EBDq3fLiNbVtVzpMCPlKAEzsx0Y/x+Ovuv4dn0EFE/ydAvz6YggXzgh5sVgXM/zOC/4sii7qgGvB5N7hmuQYwkvazWAu1JPW41FXSHq6pnaQWvqYH18Fc0j1hO/BFTtIeSBlJi5w6qIIO7IOrwhFsB2Yxukif0FTRLpXswHR8MxbslKe9VZsn/Ub5C7YFOpqSTABWUDgg6AAAAFAGAJ0BKiAAIAA+7VyoTqmkpCI3+qgBMB2JbACdMt69DwMIQBLhkTO6XwY00UEDK6cNIDnuNibPf0EgAP7Y1myuiQHLDsF/0h5unrGh6WAbv7aegg2ZMd3uRKfT/3SJztcaujYfTvMXspfCTmYcoO6a+vhC3ss4M8uM58t4siiu59I4aOl59e9Sr6xoxYlHf2v+NnBNpJYeJf8jABQAId/PXuBkLEFkiCucgSGEcfhvajql/j3reCGl0M5/9gQWy7ayNPs+wlvIxFnNfSlfuND4CZOCyxOHhRqOmHN4ULHo3tCSrUNvgAA=');
        background-max-size: 40px;
        margin-bottom: 5px;
        margin-top: .3em;
        margin-bottom: .5em;
        padding: .2em;
        padding-left: 25px;
        border-radius: .5em;
        border: 2px solid rgba(160,160,160,.3);
    `,r=`Needle Engine — No license active, commercial use is not allowed. Visit https://needle.tools/pricing for more information and licensing options! v${ja}`;(o=Ot.Current)!=null&&o.xr?console.log(r):console.log("%c "+r,i)}async function Yoe(){var s;if(!window.crossOriginIsolated)try{const e="https://needle-engine-analytics-v2-r26roub2hq-lz.a.run.app";if(e){Va&&console.log("Analytics backend url",e);const t=window.location.href.split("?")[0];let i="api/v2/new/request";e.endsWith("/")||(i="/"+i);const n=gp,r=`${e}${i}`;Va&&console.log("Sending non-commercial usage message to analytics backend",r);const o={license:n,url:t,hostname:window.location.hostname,pathname:window.location.pathname,version:ja,generator:tE,build_time:sD},a=(s=navigator.sendBeacon)==null?void 0:s.call(navigator,r,JSON.stringify(o));Va&&console.log("Send beacon result",a)}}catch(e){Va&&console.log("Failed to send non-commercial usage message to analytics backend",e)}}const jf=ie("debugloading"),vy=ie("debugloadingrendering"),xU=ie("debuglicense");class Koe{constructor(){u(this,"className");u(this,"additionalClasses")}}let yy=0,wU;function HD(s){jf&&console.log(s.progress.loaded.toFixed(0)+"/"+s.progress.total.toFixed(0),s);const e=s.count,t=s.progress.total;t===0||t===void 0?(wU!==s.name&&(yy=0),wU=s.name,yy+=(1-yy)*.001,jf&&Yi("Loading "+s.name+" did not report total size")):yy=s.progress.loaded/t;const i=s.index/e+yy/e;return et.clamp01(i)}const $S=class{constructor(e,t){u(this,"loadingProgress",0);u(this,"_element");u(this,"_progress",0);u(this,"_allowCustomLoadingElement",!0);u(this,"_loadingElement");u(this,"_loadingTextContainer",null);u(this,"_loadingBar",null);u(this,"_messageContainer",null);u(this,"_loadingElementOptions");u(this,"_progressLoop");this._element=e,this._loadingElementOptions=t}async onLoadingBegin(e){const t=this._element.shadowRoot||this._element;if(jf&&console.warn("Begin Loading"),!this._loadingElement){for(let i=0;i<t.children.length;i++){const n=t.children[i];if(n.classList.contains($S.LoadingContainerClassName)){if(!this._allowCustomLoadingElement){jf&&console.warn("Remove custom loading container"),t.removeChild(n);continue}this._loadingElement=this.createLoadingElement(n)}}this._loadingElement||(this._loadingElement=this.createLoadingElement())}this._progress=0,this.loadingProgress=0,this._loadingElement.style.display="flex",t.appendChild(this._loadingElement),this.smoothProgressLoop(),this.setMessage(e??"")}onLoadingUpdate(e,t){var n;if(!((n=this._loadingElement)!=null&&n.parentNode))return;let i=0;typeof e=="number"?i=e:("index"in e&&(i=HD(e)),!t&&"name"in e&&this.setMessage("loading "+e.name)),this.loadingProgress=i,t&&this.setMessage(t),this.updateDisplay()}onLoadingFinished(){jf&&console.warn("Finished Loading"),vy||(this.loadingProgress=1,this.onDoneLoading())}setMessage(e){this._messageContainer&&(this._messageContainer.innerText=e)}smoothProgressLoop(){if(this._progressLoop)return;let e=1/12;vy&&(e=1/500,typeof vy=="number"&&(e*=vy)),this._progressLoop=setInterval(()=>{this.loadingProgress>=.95&&!vy&&(e=.9),this._progress=et.lerp(this._progress,this.loadingProgress,e*this.loadingProgress),this.updateDisplay()},e)}onDoneLoading(){this._loadingElement&&(jf&&console.log("Hiding loading element"),this._loadingElement.style.display="none",this._loadingElement.remove()),this._progressLoop&&clearInterval(this._progressLoop),this._progressLoop=null}updateDisplay(){const e=this._progress,t=(e*100).toFixed(0)+"%";this._loadingBar&&(this._loadingBar.style.width=e*100+"%"),this._loadingTextContainer&&(this._loadingTextContainer.textContent=t)}createLoadingElement(e){var p,m;jf&&!e&&console.log("Creating loading element"),this._loadingElement=e||document.createElement("div");let t=this._element.getAttribute("loading-style");(!t||t==="auto")&&(window.matchMedia("(prefers-color-scheme: dark)").matches?t="dark":t="light");const i=yd();if(!e&&(this._loadingElement.style.position="absolute",this._loadingElement.style.width="100%",this._loadingElement.style.height="100%",this._loadingElement.style.left="0",this._loadingElement.style.top="0",t==="light"?this._loadingElement.style.backgroundColor="#ddd":this._loadingElement.style.backgroundColor="#222",this._loadingElement.style.display="flex",this._loadingElement.style.alignItems="center",this._loadingElement.style.justifyContent="center",this._loadingElement.style.zIndex=Number.MAX_SAFE_INTEGER.toString(),this._loadingElement.style.flexDirection="column",this._loadingElement.style.pointerEvents="none",this._loadingElement.style.color="white",this._loadingElement.style.fontFamily='system-ui, Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',this._loadingElement.style.fontSize="1rem",t==="light"?this._loadingElement.style.color="rgba(0,0,0,.6)":this._loadingElement.style.color="rgba(255,255,255,.3)",i&&this._element)){const v=this._element.getAttribute("loading-background-color");v&&(this._loadingElement.style.backgroundColor=v);const y=this._element.getAttribute("loading-text-color");y&&(this._loadingElement.style.color=y)}const n=((p=this._loadingElementOptions)==null?void 0:p.className)??$S.LoadingContainerClassName;if(this._loadingElement.classList.add(n),(m=this._loadingElementOptions)!=null&&m.additionalClasses)for(const v of this._loadingElementOptions.additionalClasses)this._loadingElement.classList.add(v);const r=document.createElement("div");this._loadingElement.appendChild(r);const o=document.createElement("img"),a=120;if(o.style.width=`${a}px`,o.style.height=`${a}px`,o.style.paddingTop="20px",o.style.paddingBottom="10px",o.style.margin="0px",o.style.userSelect="none",o.style.objectFit="contain",o.style.transition="transform 1.5s ease-out, opacity .3s ease-in-out",o.style.transform="translateY(30px)",o.style.opacity="0.05",setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(0px)"},1),o.src=aee,i&&this._element){const v=this._element.getAttribute("loading-logo-src");v&&(o.src=v)}r.appendChild(o);const l=document.createElement("div");l.style.cssText=`
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out 4s;
        `,setTimeout(()=>{l.style.opacity="1"},1),this._loadingElement.appendChild(l);const c=document.createElement("div"),h=100;c.style.display="flex",c.style.width=h+"%",c.style.height="3px",c.style.position="absolute",c.style.left="0",c.style.bottom="0px",c.style.opacity="0",c.style.transition="opacity 1s ease-in-out 2s",setTimeout(()=>{c.style.opacity="1"},1),t==="light"?c.style.backgroundColor="rgba(0,0,0,.2)":c.style.backgroundColor="rgba(255,255,255,.2)",this._loadingElement.appendChild(c),this._loadingBar=document.createElement("div"),c.appendChild(this._loadingBar);const d=function(v){return et.lerp(0,h,v)+"%"};if(this._loadingBar.style.background=`linear-gradient(90deg, #204f49 ${d(0)}, #0BA398 ${d(.3)}, #66A22F ${d(.6)}, #D7DB0A ${d(1)})`,this._loadingBar.style.backgroundAttachment="fixed",this._loadingBar.style.width="0%",this._loadingBar.style.height="100%",i&&this._element){const v=this._element.getAttribute("primary-color"),y=this._element.getAttribute("secondary-color");v&&y?this._loadingBar.style.background=`linear-gradient(90deg, ${v} ${d(0)}, ${y} ${d(1)})`:v?this._loadingBar.style.background=v:y&&(this._loadingBar.style.background=y)}this._loadingTextContainer=document.createElement("div"),this._loadingTextContainer.style.display="flex",this._loadingTextContainer.style.justifyContent="center",this._loadingTextContainer.style.marginTop=".2rem",l.appendChild(this._loadingTextContainer);const f=document.createElement("div");if(this._messageContainer=f,f.style.display="flex",f.style.fontSize=".8rem",f.style.paddingTop=".1rem",f.style.justifyContent="center",l.appendChild(f),i&&this._element){const v=this._element.getAttribute("loading-text-color");v&&(f.style.color=v)}return this.handleRuntimeLicense(this._loadingElement),this._loadingElement}async handleRuntimeLicense(e){let t=ru();if(t)return;xU&&console.log("Loading UI has commercial license?",t);const i=document.createElement("div");i.style.paddingTop=".6em",i.style.fontSize=".8em",i.style.textTransform="uppercase",i.innerText=`NEEDLE ENGINE NON COMMERCIAL VERSION
CLICK HERE TO GET A LICENSE`,i.style.cursor="pointer",i.style.userSelect="none",i.style.textAlign="center",i.style.pointerEvents="all",i.addEventListener("click",()=>window.open("https://needle.tools/pricing","_self")),i.style.opacity="0",e.appendChild(i),!Xe()&&Ad&&(xU&&console.log("Waiting for runtime license check"),await Ad,t=ru()),!t&&(i.style.transition="opacity .5s ease-in-out",i.style.opacity="1")}};let _A=$S;u(_A,"LoadingContainerClassName","loading");const Ay=ie("debugoverlay"),lQ="ar",Joe="quit-ar";class Zoe{constructor(){u(this,"arContainer",null);u(this,"currentSession",null);u(this,"_createdAROnlyElements",[]);u(this,"_reparentedObjects",[]);u(this,"contentElement",null);u(this,"originalDomOverlayParent",null);u(this,"requestEndAR",()=>{this.onRequestedEndAR()})}get ARContainer(){return this.arContainer}onBegin(e,t,i){var n;if(this.currentSession=i,this.arContainer=t,St.isMozillaXR()){const r=e.domElement.children;for(let o=0;o<(r==null?void 0:r.length);o++){const a=r[o];if(!a||a===this.arContainer)return;this._reparentedObjects.push({el:a,previousParent:a.parentElement}),(n=this.arContainer)==null||n.appendChild(a)}t?(this.originalDomOverlayParent=t.parentNode,this.originalDomOverlayParent&&(console.log("Reparent DOM Overlay to body",t,t.style.display),t.style.display="",t.style.visibility="",document.body.appendChild(t))):console.warn("WebXRViewer: No DOM Overlay found")}this.ensureQuitARButton(this.arContainer)}onEnd(e){var t;for(const i of this._createdAROnlyElements)i.remove&&i.remove();for(const i of this._reparentedObjects){const n=i.el;(t=i.previousParent)==null||t.appendChild(n)}this._reparentedObjects.length=0,St.isMozillaXR()&&setTimeout(()=>{var o;const i=e.renderer.domElement;i&&((o=e.domElement.shadowRoot)==null||o.prepend(i));const n=document.querySelectorAll("*");for(var r=0;r<n.length;r++){const a=n[r];a&&a._displayChanged!==void 0&&a._displayWas!==void 0&&(a.style.display=a._displayWas)}},10)}createOverlayContainer(e){if(this.contentElement)return this.contentElement;Ay&&console.log("Setup overlay container");const t=e.shadowRoot.querySelector(".content");this.contentElement=t;const i=e.shadowRoot.querySelector(".overlay-content");return i&&t.appendChild(i),Ay&&!St.isMobileDevice()&&this.ensureQuitARButton(t),t}onRequestedEndAR(){this.currentSession&&(this.currentSession.end(),this.currentSession=null)}ensureQuitARButton(e){const t=document.createElement("slot");t.setAttribute("name","quit-ar"),this.appendElement(t,e),this._createdAROnlyElements.push(t),t.style.pointerEvents="auto";const i=document.querySelector(`.${Joe}`);if(i){i.addEventListener("click",this.requestEndAR),Ay&&i.addEventListener("click",()=>console.log("Clicked quit-ar button"));return}t.addEventListener("click",this.requestEndAR),Ay&&t.addEventListener("click",()=>console.log("Clicked fallback close button"));const n=document.createElement("div");n.style.cssText=`
            position: fixed;
            top: 0;
            right: 0;
            z-index: 600;
            pointer-events: all;
        `,this.appendElement(n,t);var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("quit-ar-button"),r.setAttribute("width","40px"),r.setAttribute("height","40px"),r.style.cssText=`
            background: rgba(255, 255, 255, .4);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,.3);
            outline: 1px solid rgba(255, 255, 255, .6);
            display: flex;
            justify-content: center;
            align-items: center;
        `,n.appendChild(r);var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),o.setAttribute("stroke","#000000"),o.setAttribute("stroke-width","2px"),o.style.cssText=`
            /**filter: drop-shadow(0 0px 1.2px rgba(0,0,0,.7));**/
        `,r.appendChild(o),Ay&&console.log("Created fallback close button",r,e)}appendElement(e,t){return t.shadowRoot?t.shadowRoot.appendChild(e):t.appendChild(e)}}const AE=ie("debugdecoders");let KT,JT=null;function _E(){if(!JT){const s=rE(null);JT={dracoLoader:s.dracoLoader,ktx2Loader:s.ktx2Loader,meshoptDecoder:s.meshoptDecoder}}return JT}function SU(s){if(s!==void 0&&typeof s=="string"){cne(s);const e=_E();AE&&console.log("Setting draco decoder path to",s),e.dracoLoader.setDecoderPath(s)}}function CU(s){if(s!==void 0&&typeof s=="string"){const e=_E();AE&&console.log("Setting draco decoder type to",s),e.dracoLoader.setDecoderConfig({type:s})}}function EU(s){if(s!==void 0&&typeof s=="string"){hne(s);const e=_E();AE&&console.log("Setting ktx2 transcoder path to",s),e.ktx2Loader.setTranscoderPath(s)}}function bE(s,e){const t=_E();return KT||(KT=t.meshoptDecoder,AE&&console.log("Using the default meshopt decoder")),e.renderer?t.ktx2Loader.detectSupport(e.renderer):console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures will probably fail"),s.dracoLoader||s.setDRACOLoader(t.dracoLoader),s.ktx2Loader||s.setKTX2Loader(t.ktx2Loader),s.meshoptDecoder||s.setMeshoptDecoder(KT),s}function cQ(s,e,t){const i=t.length-s-1;if(e>=t[i])return i-1;if(e<=t[s])return s;let n=s,r=i,o=Math.floor((n+r)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?r=o:n=o,o=Math.floor((n+r)/2);return o}function $oe(s,e,t,i){const n=[],r=[],o=[];n[0]=1;for(let a=1;a<=t;++a){r[a]=e-i[s+1-a],o[a]=i[s+a]-e;let l=0;for(let c=0;c<a;++c){const h=o[c+1],d=r[a-c],f=n[c]/(h+d);n[c]=l+h*f,l=d*f}n[a]=l}return n}function eae(s,e,t,i){const n=cQ(s,i,e),r=$oe(n,i,s,e),o=new Je(0,0,0,0);for(let a=0;a<=s;++a){const l=t[n-s+a],c=r[a],h=l.w*c;o.x+=l.x*h,o.y+=l.y*h,o.z+=l.z*h,o.w+=l.w*c}return o}function tae(s,e,t,i,n){const r=[];for(let d=0;d<=t;++d)r[d]=0;const o=[];for(let d=0;d<=i;++d)o[d]=r.slice(0);const a=[];for(let d=0;d<=t;++d)a[d]=r.slice(0);a[0][0]=1;const l=r.slice(0),c=r.slice(0);for(let d=1;d<=t;++d){l[d]=e-n[s+1-d],c[d]=n[s+d]-e;let f=0;for(let p=0;p<d;++p){const m=c[p+1],v=l[d-p];a[d][p]=m+v;const y=a[p][d-1]/a[d][p];a[p][d]=f+m*y,f=v*y}a[d][d]=f}for(let d=0;d<=t;++d)o[0][d]=a[d][t];for(let d=0;d<=t;++d){let f=0,p=1;const m=[];for(let v=0;v<=t;++v)m[v]=r.slice(0);m[0][0]=1;for(let v=1;v<=i;++v){let y=0;const g=d-v,_=t-v;d>=v&&(m[p][0]=m[f][0]/a[_+1][g],y=m[p][0]*a[g][_]);const A=g>=-1?1:-g,b=d-1<=_?v-1:t-d;for(let C=A;C<=b;++C)m[p][C]=(m[f][C]-m[f][C-1])/a[_+1][g+C],y+=m[p][C]*a[g+C][_];d<=_&&(m[p][v]=-m[f][v-1]/a[_+1][d],y+=m[p][v]*a[d][_]),o[v][d]=y;const E=f;f=p,p=E}}let h=t;for(let d=1;d<=i;++d){for(let f=0;f<=t;++f)o[d][f]*=h;h*=t-d}return o}function iae(s,e,t,i,n){const r=n<s?n:s,o=[],a=cQ(s,i,e),l=tae(a,i,s,r,e),c=[];for(let h=0;h<t.length;++h){const d=t[h].clone(),f=d.w;d.x*=f,d.y*=f,d.z*=f,c[h]=d}for(let h=0;h<=r;++h){const d=c[a-s].clone().multiplyScalar(l[h][0]);for(let f=1;f<=s;++f)d.add(c[a-s+f].clone().multiplyScalar(l[h][f]));o[h]=d}for(let h=r+1;h<=n+1;++h)o[h]=new Je(0,0,0);return o}function nae(s,e){let t=1;for(let n=2;n<=s;++n)t*=n;let i=1;for(let n=2;n<=e;++n)i*=n;for(let n=2;n<=s-e;++n)i*=n;return t/i}function sae(s){const e=s.length,t=[],i=[];for(let r=0;r<e;++r){const o=s[r];t[r]=new w(o.x,o.y,o.z),i[r]=o.w}const n=[];for(let r=0;r<e;++r){const o=t[r].clone();for(let a=1;a<=r;++a)o.sub(n[r-a].clone().multiplyScalar(nae(r,a)*i[a]));n[r]=o.divideScalar(i[0])}return n}function rae(s,e,t,i,n){const r=iae(s,e,t,i,n);return sae(r)}class oae extends el{constructor(e,t,i,n,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=r||this.knots.length-1;for(let o=0;o<i.length;++o){const a=i[o];this.controlPoints[o]=new Je(a.x,a.y,a.z,a.w)}}getPoint(e,t=new w){const i=t,n=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=eae(this.degree,this.knots,this.controlPoints,n);return r.w!==1&&r.divideScalar(r.w),i.set(r.x,r.y,r.z)}getTangent(e,t=new w){const i=t,n=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=rae(this.degree,this.knots,this.controlPoints,n,1);return i.copy(r[1]).normalize(),i}}let ui,ns,ao;class hQ extends Vn{constructor(e){super(e)}load(e,t,i,n){const r=this,o=r.path===""?Lc.extractUrlBase(e):r.path,a=new Hn(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(l){try{t(r.parse(l,o))}catch(c){n?n(c):console.error(c),r.manager.itemError(e)}},i,n)}parse(e,t){if(dae(e))ui=new uae().parse(e);else{const n=pQ(e);if(!fae(n))throw new Error("THREE.FBXLoader: Unknown format.");if(MU(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+MU(n));ui=new hae().parse(n)}const i=new Xa(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new aae(i,this.manager).parse(ui)}}class aae{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){ns=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),n=this.parseDeformers(),r=new lae().parse(n);return this.parseScene(n,r,i),ao}parseConnections(){const e=new Map;return"Connections"in ui&&ui.Connections.connections.forEach(function(i){const n=i[0],r=i[1],o=i[2];e.has(n)||e.set(n,{parents:[],children:[]});const a={ID:r,relationship:o};e.get(n).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const l={ID:n,relationship:o};e.get(r).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in ui.Objects){const i=ui.Objects.Video;for(const n in i){const r=i[n],o=parseInt(n);if(e[o]=r.RelativeFilename||r.Filename,"Content"in r){const a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,l=typeof r.Content=="string"&&r.Content!=="";if(a||l){const c=this.parseImage(i[n]);t[r.RelativeFilename||r.Filename]=c}}}}for(const i in e){const n=e[i];t[n]!==void 0?e[i]=t[n]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){const t=e.Content,i=e.RelativeFilename||e.Filename,n=i.slice(i.lastIndexOf(".")+1).toLowerCase();let r;switch(n){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+n+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in ui.Objects){const i=ui.Objects.Texture;for(const n in i){const r=this.parseTexture(i[n],e);t.set(parseInt(n),r)}}return t}parseTexture(e,t){const i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;const n=e.WrapModeU,r=e.WrapModeV,o=n!==void 0?n.value:0,a=r!==void 0?r.value:0;if(i.wrapS=o===0?wo:ps,i.wrapT=a===0?wo:ps,"Scaling"in e){const l=e.Scaling.value;i.repeat.x=l[0],i.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;i.offset.x=l[0],i.offset.y=l[1]}return i}loadTexture(e,t){let i;const n=this.textureLoader.path,r=ns.get(e.id).children;r!==void 0&&r.length>0&&t[r[0].ID]!==void 0&&(i=t[r[0].ID],(i.indexOf("blob:")===0||i.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new Pt):(l.setPath(this.textureLoader.path),o=l.load(i))}else if(a==="dds"){const l=this.manager.getHandler(".dds");l===null?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),o=new Pt):(l.setPath(this.textureLoader.path),o=l.load(i))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new Pt):o=this.textureLoader.load(i);return this.textureLoader.setPath(n),o}parseMaterials(e){const t=new Map;if("Material"in ui.Objects){const i=ui.Objects.Material;for(const n in i){const r=this.parseMaterial(i[n],e);r!==null&&t.set(parseInt(n),r)}}return t}parseMaterial(e,t){const i=e.id,n=e.attrName;let r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!ns.has(i))return null;const o=this.parseParameters(e,t,i);let a;switch(r.toLowerCase()){case"phong":a=new up;break;case"lambert":a=new oB;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new up;break}return a.setValues(o),a.name=n,a}parseParameters(e,t,i){const n={};e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse?n.color=new me().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(n.color=new me().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.Emissive?n.emissive=new me().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(n.emissive=new me().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(n.opacity=parseFloat(e.Opacity.value)),n.opacity<1&&(n.transparent=!0),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Shininess&&(n.shininess=e.Shininess.value),e.Specular?n.specular=new me().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(n.specular=new me().fromArray(e.SpecularColor.value).convertSRGBToLinear());const r=this;return ns.get(i).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":n.bumpMap=r.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":n.aoMap=r.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=r.getTexture(t,o.ID),n.map!==void 0&&(n.map.colorSpace=_t);break;case"DisplacementColor":n.displacementMap=r.getTexture(t,o.ID);break;case"EmissiveColor":n.emissiveMap=r.getTexture(t,o.ID),n.emissiveMap!==void 0&&(n.emissiveMap.colorSpace=_t);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=r.getTexture(t,o.ID);break;case"ReflectionColor":n.envMap=r.getTexture(t,o.ID),n.envMap!==void 0&&(n.envMap.mapping=bo,n.envMap.colorSpace=_t);break;case"SpecularColor":n.specularMap=r.getTexture(t,o.ID),n.specularMap!==void 0&&(n.specularMap.colorSpace=_t);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=r.getTexture(t,o.ID),n.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),n}getTexture(e,t){return"LayeredTexture"in ui.Objects&&t in ui.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=ns.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in ui.Objects){const i=ui.Objects.Deformer;for(const n in i){const r=i[n],o=ns.get(parseInt(n));if(r.attrType==="Skin"){const a=this.parseSkeleton(o,i);a.ID=n,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[n]=a}else if(r.attrType==="BlendShape"){const a={id:n};a.rawTargets=this.parseMorphTargets(o,i),a.id=n,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const i=[];return e.children.forEach(function(n){const r=t[n.ID];if(r.attrType!=="Cluster")return;const o={ID:n.ID,indices:[],weights:[],transformLink:new fe().fromArray(r.TransformLink.a)};"Indexes"in r&&(o.indices=r.Indexes.a,o.weights=r.Weights.a),i.push(o)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){const i=[];for(let n=0;n<e.children.length;n++){const r=e.children[n],o=t[r.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=ns.get(parseInt(r.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,i.push(a)}return i}parseScene(e,t,i){ao=new vs;const n=this.parseModels(e.skeletons,t,i),r=ui.Objects.Model,o=this;n.forEach(function(l){var d;const c=r[l.ID];o.setLookAtProperties(l,c);const h=(d=ns.get(l.ID))==null?void 0:d.parents;h==null||h.forEach(function(f){const p=n.get(f.ID);p!==void 0&&p.add(l)}),l.parent===null&&ao.add(l)}),this.bindSkeleton(e.skeletons,t,n),this.addGlobalSceneSettings(),ao.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=dQ(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const a=new cae().parse();ao.children.length===1&&ao.children[0].isGroup&&(ao.children[0].animations=a,ao=ao.children[0]),ao.animations=a}parseModels(e,t,i){const n=new Map,r=ui.Objects.Model;for(const o in r){const a=parseInt(o),l=r[o],c=ns.get(a);let h=this.buildSkeleton(c,e,a,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,t,i);break;case"NurbsCurve":h=this.createCurve(c,t);break;case"LimbNode":case"Root":h=new Pp;break;case"Null":default:h=new vs;break}h.name=l.attrName?Xt.sanitizeNodeName(l.attrName):"",h.userData.originalName=l.attrName,h.ID=a}this.getTransformData(h,l),n.set(a,h)}return n}buildSkeleton(e,t,i,n){let r=null;return e==null||e.parents.forEach(function(o){for(const a in t){const l=t[a];l.rawBones.forEach(function(c,h){if(c.ID===o.ID){const d=r;r=new Pp,r.matrixWorld.copy(c.transformLink),r.name=n?Xt.sanitizeNodeName(n):"",r.userData.originalName=n,r.ID=i,l.bones[h]=r,d!==null&&r.add(d)}})}}),r}createCamera(e){let t,i;if(e.children.forEach(function(n){const r=ui.Objects.NodeAttribute[n.ID];r!==void 0&&(i=r)}),i===void 0)t=new ge;else{let n=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(n=1);let r=1;i.NearPlane!==void 0&&(r=i.NearPlane.value/1e3);let o=1e3;i.FarPlane!==void 0&&(o=i.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(a=i.AspectWidth.value,l=i.AspectHeight.value);const c=a/l;let h=45;i.FieldOfView!==void 0&&(h=i.FieldOfView.value);const d=i.FocalLength?i.FocalLength.value:null;switch(n){case 0:t=new zt(h,c,r,o),d!==null&&t.setFocalLength(d);break;case 1:t=new Nl(-a/2,a/2,l/2,-l/2,r,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+n+"."),t=new ge;break}}return t}createLight(e){let t,i;if(e.children.forEach(function(n){const r=ui.Objects.NodeAttribute[n.ID];r!==void 0&&(i=r)}),i===void 0)t=new ge;else{let n;i.LightType===void 0?n=0:n=i.LightType.value;let r=16777215;i.Color!==void 0&&(r=new me().fromArray(i.Color.value).convertSRGBToLinear());let o=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(o=0);let a=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?a=0:a=i.FarAttenuationEnd.value);const l=1;switch(n){case 0:t=new Dp(r,o,a,l);break;case 1:t=new Op(r,o);break;case 2:let c=Math.PI/3;i.InnerAngle!==void 0&&(c=li.degToRad(i.InnerAngle.value));let h=0;i.OuterAngle!==void 0&&(h=li.degToRad(i.OuterAngle.value),h=Math.max(h,1)),t=new t_(r,o,a,c,h,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new Dp(r,o);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,i){let n,r=null,o=null;const a=[];return e.children.forEach(function(l){t.has(l.ID)&&(r=t.get(l.ID)),i.has(l.ID)&&a.push(i.get(l.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new up({name:Vn.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(o)),"color"in r.attributes&&a.forEach(function(l){l.vertexColors=!0}),r.FBX_Deformer?(n=new ga(r,o),n.normalizeSkinWeights()):n=new le(r,o),n}createCurve(e,t){const i=e.children.reduce(function(r,o){return t.has(o.ID)&&(r=t.get(o.ID)),r},null),n=new hn({name:Vn.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new Rn(i,n)}getTransformData(e,t){const i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?i.eulerOrder=fQ(t.RotationOrder.value):i.eulerOrder="ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&ns.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const r=ui.Objects.Model[n.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),ao.add(e.target)):e.lookAt(new w().fromArray(o))}}})}bindSkeleton(e,t,i){const n=this.parsePoseNodes();for(const r in e){const o=e[r];ns.get(parseInt(o.ID)).parents.forEach(function(l){if(t.has(l.ID)){const c=l.ID;ns.get(c).parents.forEach(function(d){i.has(d.ID)&&i.get(d.ID).bind(new Gp(o.bones),n[d.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in ui.Objects){const t=ui.Objects.Pose;for(const i in t)if(t[i].attrType==="BindPose"&&t[i].NbPoseNodes>0){const n=t[i].PoseNode;Array.isArray(n)?n.forEach(function(r){e[r.Node]=new fe().fromArray(r.Matrix.a)}):e[n.Node]=new fe().fromArray(n.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in ui){if("AmbientColor"in ui.GlobalSettings){const e=ui.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],n=e[2];if(t!==0||i!==0||n!==0){const r=new me(t,i,n).convertSRGBToLinear();ao.add(new GC(r,1))}}"UnitScaleFactor"in ui.GlobalSettings&&(ao.userData.unitScaleFactor=ui.GlobalSettings.UnitScaleFactor.value)}}}class lae{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in ui.Objects){const i=ui.Objects.Geometry;for(const n in i){const r=ns.get(parseInt(n)),o=this.parseGeometry(r,i[n],e);t.set(parseInt(n),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){const n=i.skeletons,r=[],o=e.parents.map(function(d){return ui.Objects.Model[d.ID]});if(o.length===0)return;const a=e.children.reduce(function(d,f){return n[f.ID]!==void 0&&(d=n[f.ID]),d},null);e.children.forEach(function(d){i.morphTargets[d.ID]!==void 0&&r.push(i.morphTargets[d.ID])});const l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=fQ(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const h=dQ(c);return this.genGeometry(t,a,r,h)}genGeometry(e,t,i,n){const r=new pt;e.attrName&&(r.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),l=new nt(a.vertex,3);if(l.applyMatrix4(n),r.setAttribute("position",l),a.colors.length>0&&r.setAttribute("color",new nt(a.colors,3)),t&&(r.setAttribute("skinIndex",new bC(a.weightsIndices,4)),r.setAttribute("skinWeight",new nt(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const c=new Ht().getNormalMatrix(n),h=new nt(a.normal,3);h.applyNormalMatrix(c),r.setAttribute("normal",h)}if(a.uvs.forEach(function(c,h){const d=h===0?"uv":`uv${h}`;r.setAttribute(d,new nt(a.uvs[h],2))}),o.material&&o.material.mappingType!=="AllSame"){let c=a.materialIndex[0],h=0;if(a.materialIndex.forEach(function(d,f){d!==c&&(r.addGroup(h,f-h,c),c=d,h=f)}),r.groups.length>0){const d=r.groups[r.groups.length-1],f=d.start+d.count;f!==a.materialIndex.length&&r.addGroup(f,a.materialIndex.length-f,c)}r.groups.length===0&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,i,n),r}parseGeoNode(e,t){const i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let n=0;for(;e.LayerElementUV[n];)e.LayerElementUV[n].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return i.weightTable={},t!==null&&(i.skeleton=t,t.rawBones.forEach(function(n,r){n.indices.forEach(function(o,a){i.weightTable[o]===void 0&&(i.weightTable[o]=[]),i.weightTable[o].push({id:r,weight:n.weights[a]})})})),i}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,n=0,r=!1,o=[],a=[],l=[],c=[],h=[],d=[];const f=this;return e.vertexIndices.forEach(function(p,m){let v,y=!1;p<0&&(p=p^-1,y=!0);let g=[],_=[];if(o.push(p*3,p*3+1,p*3+2),e.color){const A=Ax(m,i,p,e.color);l.push(A[0],A[1],A[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(A){_.push(A.weight),g.push(A.id)}),_.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const A=[0,0,0,0],b=[0,0,0,0];_.forEach(function(E,C){let T=E,M=g[C];b.forEach(function(R,S,I){if(T>R){I[S]=T,T=R;const L=A[S];A[S]=M,M=L}})}),g=A,_=b}for(;_.length<4;)_.push(0),g.push(0);for(let A=0;A<4;++A)h.push(_[A]),d.push(g[A])}if(e.normal){const A=Ax(m,i,p,e.normal);a.push(A[0],A[1],A[2])}e.material&&e.material.mappingType!=="AllSame"&&(v=Ax(m,i,p,e.material)[0],v<0&&(f.negativeMaterialIndices=!0,v=0)),e.uv&&e.uv.forEach(function(A,b){const E=Ax(m,i,p,A);c[b]===void 0&&(c[b]=[]),c[b].push(E[0]),c[b].push(E[1])}),n++,y&&(f.genFace(t,e,o,v,a,l,c,h,d,n),i++,n=0,o=[],a=[],l=[],c=[],h=[],d=[])}),t}getNormalNewell(e){const t=new w(0,0,0);for(let i=0;i<e.length;i++){const n=e[i],r=e[(i+1)%e.length];t.x+=(n.y-r.y)*(n.z+r.z),t.y+=(n.z-r.z)*(n.x+r.x),t.z+=(n.x-r.x)*(n.y+r.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),n=(Math.abs(t.z)>.5?new w(0,1,0):new w(0,0,1)).cross(t).normalize(),r=t.clone().cross(n).normalize();return{normal:t,tangent:n,bitangent:r}}flattenVertex(e,t,i){return new Z(e.dot(t),e.dot(i))}genFace(e,t,i,n,r,o,a,l,c,h){let d;if(h>3){const f=[];for(let y=0;y<i.length;y+=3)f.push(new w(t.vertexPositions[i[y]],t.vertexPositions[i[y+1]],t.vertexPositions[i[y+2]]));const{tangent:p,bitangent:m}=this.getNormalTangentAndBitangent(f),v=[];for(const y of f)v.push(this.flattenVertex(y,p,m));d=Rl.triangulateShape(v,[])}else d=[[0,1,2]];for(const[f,p,m]of d)e.vertex.push(t.vertexPositions[i[f*3]]),e.vertex.push(t.vertexPositions[i[f*3+1]]),e.vertex.push(t.vertexPositions[i[f*3+2]]),e.vertex.push(t.vertexPositions[i[p*3]]),e.vertex.push(t.vertexPositions[i[p*3+1]]),e.vertex.push(t.vertexPositions[i[p*3+2]]),e.vertex.push(t.vertexPositions[i[m*3]]),e.vertex.push(t.vertexPositions[i[m*3+1]]),e.vertex.push(t.vertexPositions[i[m*3+2]]),t.skeleton&&(e.vertexWeights.push(l[f*4]),e.vertexWeights.push(l[f*4+1]),e.vertexWeights.push(l[f*4+2]),e.vertexWeights.push(l[f*4+3]),e.vertexWeights.push(l[p*4]),e.vertexWeights.push(l[p*4+1]),e.vertexWeights.push(l[p*4+2]),e.vertexWeights.push(l[p*4+3]),e.vertexWeights.push(l[m*4]),e.vertexWeights.push(l[m*4+1]),e.vertexWeights.push(l[m*4+2]),e.vertexWeights.push(l[m*4+3]),e.weightsIndices.push(c[f*4]),e.weightsIndices.push(c[f*4+1]),e.weightsIndices.push(c[f*4+2]),e.weightsIndices.push(c[f*4+3]),e.weightsIndices.push(c[p*4]),e.weightsIndices.push(c[p*4+1]),e.weightsIndices.push(c[p*4+2]),e.weightsIndices.push(c[p*4+3]),e.weightsIndices.push(c[m*4]),e.weightsIndices.push(c[m*4+1]),e.weightsIndices.push(c[m*4+2]),e.weightsIndices.push(c[m*4+3])),t.color&&(e.colors.push(o[f*3]),e.colors.push(o[f*3+1]),e.colors.push(o[f*3+2]),e.colors.push(o[p*3]),e.colors.push(o[p*3+1]),e.colors.push(o[p*3+2]),e.colors.push(o[m*3]),e.colors.push(o[m*3+1]),e.colors.push(o[m*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(r[f*3]),e.normal.push(r[f*3+1]),e.normal.push(r[f*3+2]),e.normal.push(r[p*3]),e.normal.push(r[p*3+1]),e.normal.push(r[p*3+2]),e.normal.push(r[m*3]),e.normal.push(r[m*3+1]),e.normal.push(r[m*3+2])),t.uv&&t.uv.forEach(function(v,y){e.uvs[y]===void 0&&(e.uvs[y]=[]),e.uvs[y].push(a[y][f*2]),e.uvs[y].push(a[y][f*2+1]),e.uvs[y].push(a[y][p*2]),e.uvs[y].push(a[y][p*2+1]),e.uvs[y].push(a[y][m*2]),e.uvs[y].push(a[y][m*2+1])})}addMorphTargets(e,t,i,n){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;i.forEach(function(o){o.rawTargets.forEach(function(a){const l=ui.Objects.Geometry[a.geoID];l!==void 0&&r.genMorphGeometry(e,t,l,n,a.name)})})}genMorphGeometry(e,t,i,n,r){const o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=i.Vertices!==void 0?i.Vertices.a:[],l=i.Indexes!==void 0?i.Indexes.a:[],c=e.attributes.position.count*3,h=new Float32Array(c);for(let m=0;m<l.length;m++){const v=l[m]*3;h[v]=a[m*3],h[v+1]=a[m*3+1],h[v+2]=a[m*3+2]}const d={vertexIndices:o,vertexPositions:h},f=this.genBuffers(d),p=new nt(f.vertex,3);p.name=r||i.attrName,p.applyMatrix4(n),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Normals.a;let r=[];return i==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:r,mappingType:t,referenceType:i}}parseUVs(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.UV.a;let r=[];return i==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:n,indices:r,mappingType:t,referenceType:i}}parseVertexColors(e){if(!e.Colors)return;const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Colors.a;let r=[];i==="IndexToDirect"&&(r=e.ColorIndex.a);for(let o=0,a=new me;o<n.length;o+=4)a.fromArray(n,o).convertSRGBToLinear().toArray(n,o);return{dataSize:4,buffer:n,indices:r,mappingType:t,referenceType:i}}parseMaterialIndices(e){const t=e.MappingInformationType,i=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const n=e.Materials.a,r=[];for(let o=0;o<n.length;++o)r.push(o);return{dataSize:1,buffer:n,indices:r,mappingType:t,referenceType:i}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new pt;const i=t-1,n=e.KnotVector.a,r=[],o=e.Points.a;for(let d=0,f=o.length;d<f;d+=4)r.push(new Je().fromArray(o,d));let a,l;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){a=i,l=n.length-1-a;for(let d=0;d<i;++d)r.push(r[d])}const h=new oae(i,n,r,a,l).getPoints(r.length*12);return new pt().setFromPoints(h)}}class cae{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const i in t){const n=t[i],r=this.addClip(n);e.push(r)}return e}parseClips(){if(ui.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=ui.Objects.AnimationCurveNode,t=new Map;for(const i in e){const n=e[i];if(n.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:n.id,attr:n.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){const t=ui.Objects.AnimationCurve;for(const i in t){const n={id:t[i].id,times:t[i].KeyTime.a.map(pae),values:t[i].KeyValueFloat.a},r=ns.get(n.id);if(r!==void 0){const o=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=n:a.match(/Y/)?e.get(o).curves.y=n:a.match(/Z/)?e.get(o).curves.z=n:a.match(/DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=n)}}}parseAnimationLayers(e){const t=ui.Objects.AnimationLayer,i=new Map;for(const n in t){const r=[],o=ns.get(parseInt(n));o!==void 0&&(o.children.forEach(function(l,c){if(e.has(l.ID)){const h=e.get(l.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(r[c]===void 0){const d=ns.get(l.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(d!==void 0){const f=ui.Objects.Model[d.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const p={modelName:f.attrName?Xt.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};ao.traverse(function(m){m.ID===f.id&&(p.transform=m.matrix,m.userData.transformData&&(p.eulerOrder=m.userData.transformData.eulerOrder))}),p.transform||(p.transform=new fe),"PreRotation"in f&&(p.preRotation=f.PreRotation.value),"PostRotation"in f&&(p.postRotation=f.PostRotation.value),r[c]=p}}r[c]&&(r[c][h.attr]=h)}else if(h.curves.morph!==void 0){if(r[c]===void 0){const d=ns.get(l.ID).parents.filter(function(g){return g.relationship!==void 0})[0].ID,f=ns.get(d).parents[0].ID,p=ns.get(f).parents[0].ID,m=ns.get(p).parents[0].ID,v=ui.Objects.Model[m],y={modelName:v.attrName?Xt.sanitizeNodeName(v.attrName):"",morphName:ui.Objects.Deformer[d].attrName};r[c]=y}r[c][h.attr]=h}}}),i.set(parseInt(n),r))}return i}parseAnimStacks(e){const t=ui.Objects.AnimationStack,i={};for(const n in t){const r=ns.get(parseInt(n)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(r[0].ID);i[n]={name:t[n].attrName,layer:o}}return i}addClip(e){let t=[];const i=this;return e.layer.forEach(function(n){t=t.concat(i.generateTracks(n))}),new Ho(e.name,-1,t)}generateTracks(e){const t=[];let i=new w,n=new w;if(e.transform&&e.transform.decompose(i,new xe,n),i=i.toArray(),n=n.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");r!==void 0&&t.push(r)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const r=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);r!==void 0&&t.push(r)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.S.curves,n,"scale");r!==void 0&&t.push(r)}if(e.DeformPercent!==void 0){const r=this.generateMorphTrack(e);r!==void 0&&t.push(r)}return t}generateVectorTrack(e,t,i,n){const r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,i);return new pu(e+"."+n,r,o)}generateRotationTrack(e,t,i,n,r){let o,a;if(t.x===void 0||t.y===void 0||t.z===void 0){console.warn("THREE.FBXLoader: Missing rotation curves "+(t.x===void 0?"x ":"")+(t.y===void 0?"y ":"")+(t.z===void 0?"z ":"")+" for animation of "+e+". This is currently not supported.");return}if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const d=this.interpolateRotations(t.x,t.y,t.z,r);o=d[0],a=d[1]}i!==void 0&&(i=i.map(li.degToRad),i.push(r),i=new oi().fromArray(i),i=new xe().setFromEuler(i)),n!==void 0&&(n=n.map(li.degToRad),n.push(r),n=new oi().fromArray(n),n=new xe().setFromEuler(n).invert());const l=new xe,c=new oi,h=[];if(!(!a||!o)){for(let d=0;d<a.length;d+=3)c.set(a[d],a[d+1],a[d+2],r),l.setFromEuler(c),i!==void 0&&l.premultiply(i),n!==void 0&&l.multiply(n),d>2&&new xe().fromArray(h,(d-3)/3*4).dot(l)<0&&l.set(-l.x,-l.y,-l.z,-l.w),l.toArray(h,d/3*4);return new qc(e+".quaternion",o,h)}}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,i=t.values.map(function(r){return r/100}),n=ao.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Rd(e.modelName+".morphTargetInfluences["+n+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(i,n){return i-n}),t.length>1){let i=1,n=t[0];for(let r=1;r<t.length;r++){const o=t[r];o!==n&&(t[i]=o,n=o,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){const n=i,r=[];let o=-1,a=-1,l=-1;return e.forEach(function(c){if(t.x&&(o=t.x.times.indexOf(c)),t.y&&(a=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),o!==-1){const h=t.x.values[o];r.push(h),n[0]=h}else r.push(n[0]);if(a!==-1){const h=t.y.values[a];r.push(h),n[1]=h}else r.push(n[1]);if(l!==-1){const h=t.z.values[l];r.push(h),n[2]=h}else r.push(n[2])}),r}interpolateRotations(e,t,i,n){const r=[],o=[];r.push(e.times[0]),o.push(li.degToRad(e.values[0])),o.push(li.degToRad(t.values[0])),o.push(li.degToRad(i.values[0]));for(let a=1;a<e.values.length;a++){const l=[e.values[a-1],t.values[a-1],i.values[a-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const c=l.map(li.degToRad),h=[e.values[a],t.values[a],i.values[a]];if(isNaN(h[0])||isNaN(h[1])||isNaN(h[2]))continue;const d=h.map(li.degToRad),f=[h[0]-l[0],h[1]-l[1],h[2]-l[2]],p=[Math.abs(f[0]),Math.abs(f[1]),Math.abs(f[2])];if(p[0]>=180||p[1]>=180||p[2]>=180){const v=Math.max(...p)/180,y=new oi(...c,n),g=new oi(...d,n),_=new xe().setFromEuler(y),A=new xe().setFromEuler(g);_.dot(A)&&A.set(-A.x,-A.y,-A.z,-A.w);const b=e.times[a-1],E=e.times[a]-b,C=new xe,T=new oi;for(let M=0;M<1;M+=1/v)C.copy(_.clone().slerp(A.clone(),M)),r.push(b+M*E),T.setFromQuaternion(C,n),o.push(T.x),o.push(T.y),o.push(T.z)}else r.push(e.times[a]),o.push(li.degToRad(e.values[a])),o.push(li.degToRad(t.values[a])),o.push(li.degToRad(i.values[a]))}return[r,o]}}class hae{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new uQ,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,i=e.split(/[\r\n]+/);return i.forEach(function(n,r){const o=n.match(/^[\s\t]*;/),a=n.match(/^[\s\t]*$/);if(o||a)return;const l=n.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=n.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=n.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(n,l):c?t.parseNodeProperty(n,c,i[++r]):h?t.popStack():n.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(n)}),this.allNodes}parseNodeBegin(e,t){const i=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:i},o=this.parseNodeAttr(n),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,r):i in a?(i==="PoseNode"?a.PoseNode.push(r):a[i].id!==void 0&&(a[i]={},a[i][a[i].id]=a[i]),o.id!==""&&(a[i][o.id]=r)):typeof o.id=="number"?(a[i]={},a[i][o.id]=r):i!=="Properties70"&&(i==="PoseNode"?a[i]=[r]:a[i]=r),typeof o.id=="number"&&(r.id=o.id),o.name!==""&&(r.attrName=o.name),o.type!==""&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",n="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:i,type:n}}parseNodeProperty(e,t,i){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();n==="Content"&&r===","&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,n,r);return}if(n==="C"){const l=r.split(",").slice(1),c=parseInt(l[0]),h=parseInt(l[1]);let d=r.split(",").slice(3);d=d.map(function(f){return f.trim().replace(/^"/,"")}),n="connections",r=[c,h],gae(r,d),o[n]===void 0&&(o[n]=[])}n==="Node"&&(o.id=r),n in o&&Array.isArray(o[n])?o[n].push(r):n!=="a"?o[n]=r:o.a=r,this.setCurrentProp(o,n),n==="a"&&r.slice(-1)!==","&&(o.a=$T(r))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=$T(t.a))}parseNodeSpecialProperty(e,t,i){const n=i.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=n[0],o=n[1],a=n[2],l=n[3];let c=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=$T(c);break}this.getPrevNode()[r]={type:o,type2:a,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),r)}}class uae{parse(e){const t=new TU(e);t.skip(23);const i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const n=new uQ;for(;!this.endOfContent(t);){const r=this.parseNode(t,i);r!==null&&n.add(r.name,r)}return n}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const i={},n=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(n===0)return null;const l=[];for(let f=0;f<r;f++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",h=l.length>1?l[1]:"",d=l.length>2?l[2]:"";for(i.singleProperty=r===1&&e.getOffset()===n;n>e.getOffset();){const f=this.parseNode(e,t);f!==null&&this.parseSubNode(a,i,f)}return i.propertyList=l,typeof c=="number"&&(i.id=c),h!==""&&(i.attrName=h),d!==""&&(i.attrType=d),a!==""&&(i.name=a),i}parseSubNode(e,t,i){if(i.singleProperty===!0){const n=i.propertyList[0];Array.isArray(n)?(t[i.name]=i,i.a=n):t[i.name]=n}else if(e==="Connections"&&i.name==="C"){const n=[];i.propertyList.forEach(function(r,o){o!==0&&n.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(n)}else if(i.name==="Properties70")Object.keys(i).forEach(function(r){t[r]=i[r]});else if(e==="Properties70"&&i.name==="P"){let n=i.propertyList[0],r=i.propertyList[1];const o=i.propertyList[2],a=i.propertyList[3];let l;n.indexOf("Lcl ")===0&&(n=n.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?l=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:l=i.propertyList[4],t[n]={type:r,type2:o,flag:a,value:l}}else t[i.name]===void 0?typeof i.id=="number"?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:i.name==="PoseNode"?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):t[i.name][i.id]===void 0&&(t[i.name][i.id]=i)}parseProperty(e){const t=e.getString(1);let i;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}const a=Xy(new Uint8Array(e.getArrayBuffer(o))),l=new TU(a.buffer);switch(t){case"b":case"c":return l.getBooleanArray(n);case"d":return l.getFloat64Array(n);case"f":return l.getFloat32Array(n);case"i":return l.getInt32Array(n);case"l":return l.getInt64Array(n)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class TU{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let i=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const n=i.indexOf(0);return n>=0&&(i=new Uint8Array(this.dv.buffer,t,n)),this._textDecoder.decode(i)}}class uQ{add(e,t){this[e]=t}}function dae(s){const e="Kaydara FBX Binary  \0";return s.byteLength>=e.length&&e===pQ(s,0,e.length)}function fae(s){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function i(n){const r=s[n-1];return s=s.slice(t+n),t++,r}for(let n=0;n<e.length;++n)if(i(1)===e[n])return!1;return!0}function MU(s){const e=/FBXVersion: (\d+)/,t=s.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function pae(s){return s/46186158e3}const mae=[];function Ax(s,e,t,i){let n;switch(i.mappingType){case"ByPolygonVertex":n=s;break;case"ByPolygon":n=e;break;case"ByVertice":n=t;break;case"AllSame":n=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(n=i.indices[n]);const r=n*i.dataSize,o=r+i.dataSize;return vae(mae,i.buffer,r,o)}const ZT=new oi,km=new w;function dQ(s){const e=new fe,t=new fe,i=new fe,n=new fe,r=new fe,o=new fe,a=new fe,l=new fe,c=new fe,h=new fe,d=new fe,f=new fe,p=s.inheritType?s.inheritType:0;if(s.translation&&e.setPosition(km.fromArray(s.translation)),s.preRotation){const S=s.preRotation.map(li.degToRad);S.push(s.eulerOrder||oi.DEFAULT_ORDER),t.makeRotationFromEuler(ZT.fromArray(S))}if(s.rotation){const S=s.rotation.map(li.degToRad);S.push(s.eulerOrder||oi.DEFAULT_ORDER),i.makeRotationFromEuler(ZT.fromArray(S))}if(s.postRotation){const S=s.postRotation.map(li.degToRad);S.push(s.eulerOrder||oi.DEFAULT_ORDER),n.makeRotationFromEuler(ZT.fromArray(S)),n.invert()}s.scale&&r.scale(km.fromArray(s.scale)),s.scalingOffset&&a.setPosition(km.fromArray(s.scalingOffset)),s.scalingPivot&&o.setPosition(km.fromArray(s.scalingPivot)),s.rotationOffset&&l.setPosition(km.fromArray(s.rotationOffset)),s.rotationPivot&&c.setPosition(km.fromArray(s.rotationPivot)),s.parentMatrixWorld&&(d.copy(s.parentMatrix),h.copy(s.parentMatrixWorld));const m=t.clone().multiply(i).multiply(n),v=new fe;v.extractRotation(h);const y=new fe;y.copyPosition(h);const g=y.clone().invert().multiply(h),_=v.clone().invert().multiply(g),A=r,b=new fe;if(p===0)b.copy(v).multiply(m).multiply(_).multiply(A);else if(p===1)b.copy(v).multiply(_).multiply(m).multiply(A);else{const I=new fe().scale(new w().setFromMatrixScale(d)).clone().invert(),L=_.clone().multiply(I);b.copy(v).multiply(m).multiply(L).multiply(A)}const E=c.clone().invert(),C=o.clone().invert();let T=e.clone().multiply(l).multiply(c).multiply(t).multiply(i).multiply(n).multiply(E).multiply(a).multiply(o).multiply(r).multiply(C);const M=new fe().copyPosition(T),R=h.clone().multiply(M);return f.copyPosition(R),T=f.clone().multiply(b),T.premultiply(h.invert()),T}function fQ(s){s=s||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return s===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[s]}function $T(s){return s.split(",").map(function(t){return parseFloat(t)})}function pQ(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=s.byteLength),new TextDecoder().decode(new Uint8Array(s,e,t))}function gae(s,e){for(let t=0,i=s.length,n=e.length;t<n;t++,i++)s[i]=e[t]}function vae(s,e,t,i){for(let n=t,r=0;n<i;n++,r++)s[r]=e[n];return s}class yae extends Vn{constructor(e){super(e)}load(e,t,i,n){const r=this,o=this.path===""?Lc.extractUrlBase(e):this.path,a=new Hn(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{t(r.parse(l,o))}catch(c){n?n(c):console.error(c),r.manager.itemError(e)}},i,n)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const i=e.split(`
`);let n={};const r=/\s+/,o={};for(let l=0;l<i.length;l++){let c=i[l];if(c=c.trim(),c.length===0||c.charAt(0)==="#")continue;const h=c.indexOf(" ");let d=h>=0?c.substring(0,h):c;d=d.toLowerCase();let f=h>=0?c.substring(h+1):"";if(f=f.trim(),d==="newmtl")n={name:f},o[f]=n;else if(d==="ka"||d==="kd"||d==="ks"||d==="ke"){const p=f.split(r,3);n[d]=[parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2])]}else n[d]=f}const a=new Aae(this.resourcePath||t,this.materialOptions);return a.setCrossOrigin(this.crossOrigin),a.setManager(this.manager),a.setMaterials(o),a}}class Aae{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:As,this.wrap=this.options.wrap!==void 0?this.options.wrap:wo}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const i in e){const n=e[i],r={};t[i]=r;for(const o in n){let a=!0,l=n[o];const c=o.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(l=[l[0]/255,l[1]/255,l[2]/255]),this.options&&this.options.ignoreZeroRGBs&&l[0]===0&&l[1]===0&&l[2]===0&&(a=!1);break}a&&(r[c]=l)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,i=this.materialsInfo[e],n={name:e,side:this.side};function r(a,l){return typeof l!="string"||l===""?"":/^https?:\/\//i.test(l)?l:a+l}function o(a,l){if(n[a])return;const c=t.getTextureParams(l,n),h=t.loadTexture(r(t.baseUrl,c.url));h.repeat.copy(c.scale),h.offset.copy(c.offset),h.wrapS=t.wrap,h.wrapT=t.wrap,(a==="map"||a==="emissiveMap")&&(h.colorSpace=_t),n[a]=h}for(const a in i){const l=i[a];let c;if(l!=="")switch(a.toLowerCase()){case"kd":n.color=new me().fromArray(l).convertSRGBToLinear();break;case"ks":n.specular=new me().fromArray(l).convertSRGBToLinear();break;case"ke":n.emissive=new me().fromArray(l).convertSRGBToLinear();break;case"map_kd":o("map",l);break;case"map_ks":o("specularMap",l);break;case"map_ke":o("emissiveMap",l);break;case"norm":o("normalMap",l);break;case"map_bump":case"bump":o("bumpMap",l);break;case"map_d":o("alphaMap",l),n.transparent=!0;break;case"ns":n.shininess=parseFloat(l);break;case"d":c=parseFloat(l),c<1&&(n.opacity=c,n.transparent=!0);break;case"tr":c=parseFloat(l),this.options&&this.options.invertTrProperty&&(c=1-c),c>0&&(n.opacity=1-c,n.transparent=!0);break}}return this.materials[e]=new up(n),this.materials[e]}getTextureParams(e,t){const i={scale:new Z(1,1),offset:new Z(0,0)},n=e.split(/\s+/);let r;return r=n.indexOf("-bm"),r>=0&&(t.bumpScale=parseFloat(n[r+1]),n.splice(r,2)),r=n.indexOf("-s"),r>=0&&(i.scale.set(parseFloat(n[r+1]),parseFloat(n[r+2])),n.splice(r,4)),r=n.indexOf("-o"),r>=0&&(i.offset.set(parseFloat(n[r+1]),parseFloat(n[r+2])),n.splice(r,4)),i.url=n.join(" ").trim(),i}loadTexture(e,t,i,n,r){const o=this.manager!==void 0?this.manager:hB;let a=o.getHandler(e);a===null&&(a=new Xa(o)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);const l=a.load(e,i,n,r);return t!==void 0&&(l.mapping=t),l}}const _ae=/^[og]\s*(.+)?/,bae=/^mtllib /,xae=/^usemtl /,wae=/^usemap /,IU=/\s+/,RU=new w,eM=new w,PU=new w,BU=new w,Pa=new w,_x=new me;function Sae(){const s={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(n,r){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const a={index:this.materials.length,name:n||"",mtllib:Array.isArray(r)&&r.length>0?r[r.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const c={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(n){const r=this.currentMaterial();if(r&&r.groupEnd===-1&&(r.groupEnd=this.geometry.vertices.length/3,r.groupCount=r.groupEnd-r.groupStart,r.inherited=!1),n&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return n&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),r}},i&&i.name&&typeof i.clone=="function"){const n=i.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseNormalIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseUVIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/2)*2},addVertex:function(e,t,i){const n=this.vertices,r=this.object.geometry.vertices;r.push(n[e+0],n[e+1],n[e+2]),r.push(n[t+0],n[t+1],n[t+2]),r.push(n[i+0],n[i+1],n[i+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){const n=this.normals,r=this.object.geometry.normals;r.push(n[e+0],n[e+1],n[e+2]),r.push(n[t+0],n[t+1],n[t+2]),r.push(n[i+0],n[i+1],n[i+2])},addFaceNormal:function(e,t,i){const n=this.vertices,r=this.object.geometry.normals;RU.fromArray(n,e),eM.fromArray(n,t),PU.fromArray(n,i),Pa.subVectors(PU,eM),BU.subVectors(RU,eM),Pa.cross(BU),Pa.normalize(),r.push(Pa.x,Pa.y,Pa.z),r.push(Pa.x,Pa.y,Pa.z),r.push(Pa.x,Pa.y,Pa.z)},addColor:function(e,t,i){const n=this.colors,r=this.object.geometry.colors;n[e]!==void 0&&r.push(n[e+0],n[e+1],n[e+2]),n[t]!==void 0&&r.push(n[t+0],n[t+1],n[t+2]),n[i]!==void 0&&r.push(n[i+0],n[i+1],n[i+2])},addUV:function(e,t,i){const n=this.uvs,r=this.object.geometry.uvs;r.push(n[e+0],n[e+1]),r.push(n[t+0],n[t+1]),r.push(n[i+0],n[i+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,n,r,o,a,l,c){const h=this.vertices.length;let d=this.parseVertexIndex(e,h),f=this.parseVertexIndex(t,h),p=this.parseVertexIndex(i,h);if(this.addVertex(d,f,p),this.addColor(d,f,p),a!==void 0&&a!==""){const m=this.normals.length;d=this.parseNormalIndex(a,m),f=this.parseNormalIndex(l,m),p=this.parseNormalIndex(c,m),this.addNormal(d,f,p)}else this.addFaceNormal(d,f,p);if(n!==void 0&&n!==""){const m=this.uvs.length;d=this.parseUVIndex(n,m),f=this.parseUVIndex(r,m),p=this.parseUVIndex(o,m),this.addUV(d,f,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,n=e.length;i<n;i++){const r=this.parseVertexIndex(e[i],t);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const i=this.vertices.length,n=this.uvs.length;for(let r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],i));for(let r=0,o=t.length;r<o;r++)this.addUVLine(this.parseUVIndex(t[r],n))}};return s.startObject("",!1),s}class VD extends Vn{constructor(e){super(e),this.materials=null,this.materialsLoader=new yae(e)}load(e,t,i,n){const r=this,o=new Hn(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,async function(a){try{const l=r.parse(a,!0);for(let c=0,h=l.materialLibraries.length;c<h;c++){const d=l.materialLibraries[c],f=e.startsWith("blob:")?e+"/"+d:new URL(d,e);console.debug("Loading MTL file: "+f),await new Promise((p,m)=>{r.materialsLoader.load(f.toString(),v=>{r.setMaterials(v),p()},null,m)})}t(r.createObjects(l))}catch(l){n?n(l):console.error(l),r.manager.itemError(e)}},i,n)}setMTLLoader(e){return this.materialsLoader=e,this}setMaterials(e){return this.materials=e,this}parse(e,t=!1){const i=new Sae;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let r=[];for(let o=0,a=n.length;o<a;o++){const l=n[o].trimStart();if(l.length===0)continue;const c=l.charAt(0);if(c!=="#")if(c==="v"){const h=l.split(IU);switch(h[0]){case"v":i.vertices.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])),h.length>=7?(_x.setRGB(parseFloat(h[4]),parseFloat(h[5]),parseFloat(h[6])).convertSRGBToLinear(),i.colors.push(_x.r,_x.g,_x.b)):i.colors.push(void 0,void 0,void 0);break;case"vn":i.normals.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]));break;case"vt":i.uvs.push(parseFloat(h[1]),parseFloat(h[2]));break}}else if(c==="f"){const d=l.slice(1).trim().split(IU),f=[];for(let m=0,v=d.length;m<v;m++){const y=d[m];if(y.length>0){const g=y.split("/");f.push(g)}}const p=f[0];for(let m=1,v=f.length-1;m<v;m++){const y=f[m],g=f[m+1];i.addFace(p[0],y[0],g[0],p[1],y[1],g[1],p[2],y[2],g[2])}}else if(c==="l"){const h=l.substring(1).trim().split(" ");let d=[];const f=[];if(l.indexOf("/")===-1)d=h;else for(let p=0,m=h.length;p<m;p++){const v=h[p].split("/");v[0]!==""&&d.push(v[0]),v[1]!==""&&f.push(v[1])}i.addLineGeometry(d,f)}else if(c==="p"){const d=l.slice(1).trim().split(" ");i.addPointGeometry(d)}else if((r=_ae.exec(l))!==null){const h=(" "+r[0].slice(1).trim()).slice(1);i.startObject(h)}else if(xae.test(l))i.object.startMaterial(l.substring(7).trim(),i.materialLibraries);else if(bae.test(l))i.materialLibraries.push(l.substring(7).trim());else if(wae.test(l))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(c==="s"){if(r=l.split(" "),r.length>1){const d=r[1].trim().toLowerCase();i.object.smooth=d!=="0"&&d!=="off"}else i.object.smooth=!0;const h=i.object.currentMaterial();h&&(h.smooth=i.object.smooth)}else{if(l==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+l+'"')}}return i.finalize(),t?i:this.createObjects(i)}createObjects(e){const t=new vs;if(t.materialLibraries=[].concat(e.materialLibraries),!(e.objects.length===1&&e.objects[0].geometry.vertices.length===0)===!0)for(let n=0,r=e.objects.length;n<r;n++){const o=e.objects[n],a=o.geometry,l=o.materials,c=a.type==="Line",h=a.type==="Points";let d=!1;if(a.vertices.length===0)continue;const f=new pt;f.setAttribute("position",new nt(a.vertices,3)),a.normals.length>0&&f.setAttribute("normal",new nt(a.normals,3)),a.colors.length>0&&(d=!0,f.setAttribute("color",new nt(a.colors,3))),a.hasUVIndices===!0&&f.setAttribute("uv",new nt(a.uvs,2));const p=[];for(let v=0,y=l.length;v<y;v++){const g=l[v],_=g.name+"_"+g.smooth+"_"+d;let A=e.materials[_];if(this.materials!==null){if(A=this.materials.create(g.name),c&&A&&!(A instanceof hn)){const b=new hn;Vt.prototype.copy.call(b,A),b.color.copy(A.color),A=b}else if(h&&A&&!(A instanceof cd)){const b=new cd({size:10,sizeAttenuation:!1});Vt.prototype.copy.call(b,A),b.color.copy(A.color),b.map=A.map,A=b}}A===void 0&&(c?A=new hn:h?A=new cd({size:1,sizeAttenuation:!1}):A=new up,A.name=g.name,A.flatShading=!g.smooth,A.vertexColors=d,e.materials[_]=A),p.push(A)}let m;if(p.length>1){for(let v=0,y=l.length;v<y;v++){const g=l[v];f.addGroup(g.groupStart,g.groupCount,v)}c?m=new Xr(f,p):h?m=new Mg(f,p):m=new le(f,p)}else c?m=new Xr(f,p[0]):h?m=new Mg(f,p[0]):m=new le(f,p[0]);m.name=o.name,t.add(m)}else if(e.vertices.length>0){const n=new cd({size:1,sizeAttenuation:!1}),r=new pt;r.setAttribute("position",new nt(e.vertices,3)),e.colors.length>0&&e.colors[0]!==void 0&&(r.setAttribute("color",new nt(e.colors,3)),n.vertexColors=!0);const o=new Mg(r,n);t.add(o)}return t}}typeof globalThis!==void 0&&!("OffscreenCanvas"in globalThis)&&(globalThis.OffscreenCanvas=class{constructor(e,t){u(this,"canvas");return this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.canvas.convertToBlob=(i,n)=>new Promise(r=>{this.canvas.toBlob(r,i,n)}),this.canvas}});const Cae=ie("debugprogress");function mQ(s){s=s||new Date;const e=s.getMonth()+1,t=s.getDate(),i=s.getHours(),n=s.getMinutes(),r=s.getSeconds(),o=(e<10?"0":"")+e,a=(t<10?"0":"")+t,l=(i<10?"0":"")+i,c=(n<10?"0":"")+n,h=(r<10?"0":"")+r;return s.getFullYear()+o+a+"-"+l+c+h}class gi{static start(e,t){typeof t=="string"&&(t={parentScope:t});const i=new Eae(e,t);Ky.set(e,i)}static report(e,t){const i=Ky.get(e);if(!i){console.warn("Reporting progress for non-existing scope",e);return}typeof t=="string"&&(t={message:t,autoStep:!0}),i.report(t)}static end(e){const t=Ky.get(e);t&&(t.end(),Ky.delete(e))}}const Ky=new Map;class Eae{constructor(e,t){u(this,"scopeLabel");u(this,"parentScope");u(this,"childScopes",[]);u(this,"parentDepth",0);u(this,"lastStep",0);u(this,"lastAutoStepWeight",1);u(this,"lastTotalSteps",0);u(this,"onProgress");u(this,"showLogs",!1);u(this,"selfProgress",0);u(this,"totalProgress",0);u(this,"selfReports",0);u(this,"totalReports",0);this.parentScope=t!=null&&t.parentScope?Ky.get(t.parentScope):void 0,this.parentScope&&(this.parentScope.childScopes.push(this),this.parentDepth=this.parentScope.parentDepth+1),this.scopeLabel=" ".repeat(this.parentDepth*2)+e,this.showLogs=(t==null?void 0:t.logTimings)??!!Cae,this.showLogs&&console.time(this.scopeLabel),this.onProgress=t==null?void 0:t.onProgress}report(e,t=!1){if(e){if(e.totalSteps!==void 0&&(this.lastTotalSteps=e.totalSteps),e.currentStep!==void 0&&(this.lastStep=e.currentStep),e.autoStep!==void 0){if(e.currentStep===void 0){this.lastStep===void 0&&(this.lastStep=0);const n=typeof e.autoStep=="number"?e.autoStep:1;this.lastStep+=this.lastAutoStepWeight,this.lastAutoStepWeight=n,e.currentStep=this.lastStep}e.totalSteps=this.lastTotalSteps}e.progress!==void 0?this.selfProgress=e.progress:e.currentStep!==void 0&&e.totalSteps!==void 0&&(this.selfProgress=e.currentStep/e.totalSteps)}if(this.childScopes.length>0){let n=0,r=0;for(const a of this.childScopes)n+=a.selfProgress,r+=1;r>0&&(n/=r);const o=this.lastAutoStepWeight/(this.lastTotalSteps??1);this.totalProgress=this.selfProgress+n*o}else this.totalProgress=this.selfProgress;this.selfProgress=Math.min(1,this.selfProgress),this.totalProgress=Math.min(1,this.totalProgress);let i=(this.totalProgress*100).toFixed(3)+"%";this.childScopes.length>0&&(i+=" ("+(this.selfProgress*100).toFixed(3)+"% self)"),e!=null&&e.message&&(i=e.message+" – "+i),this.lastStep!==void 0&&this.lastTotalSteps!==void 0&&(i="Step "+(this.lastStep+(this.lastAutoStepWeight!=1?"–"+(this.lastStep+this.lastAutoStepWeight):"")+"/"+this.lastTotalSteps)+" "+i),t?this.totalReports++:(this.selfReports++,this.totalReports++),this.showLogs&&console.timeLog(this.scopeLabel,i),this.onProgress&&this.onProgress(this.totalProgress),this.parentScope&&this.parentScope.report(void 0,!0)}end(){this.report({progress:1,autoStep:!0},!0),this.showLogs&&(console.timeLog(this.scopeLabel,"Total reports: "+this.totalReports,"Self reports: "+this.selfReports),console.timeEnd(this.scopeLabel));let e=!1;for(const t of this.childScopes)if(!(t.selfProgress>=1)){e=!0;break}e&&console.warn("Progress end with child scopes that are still running",this),this.onProgress=void 0}}function Ul(s){return s=s.replace(/[^a-zA-Z0-9_]/g,""),s.match(/^[a-zA-Z_]/)||(s="_"+s),s}function gQ(s){return s=s.replace('"','\\"'),s}function vQ(s){if(s.length===0)return null;const e=s.map(i=>{const n=new Array;for(;i.parent;)n.unshift(i.parent),i=i.parent;return n});return e[0].findLast(i=>e.every(n=>n.includes(i)))||null}function yQ(s){const e=vQ(s),t=new Set;for(const i of s){let n=i.parent;for(;n&&n!==e;)s.includes(n)||t.add(n),n=n.parent}return t}const Tae=new w,Mae=new xe,Iae=new w(1,1,1),Yf=class{constructor(e,t,i=null,n=null,r=null,o=null,a=null,l=null){u(this,"uuid");u(this,"name");u(this,"type");u(this,"extraSchemas",[]);u(this,"displayName");u(this,"visibility");u(this,"transform",null);u(this,"_isDynamic");u(this,"geometry");u(this,"material");u(this,"camera");u(this,"parent");u(this,"skinnedMesh");u(this,"children",[]);u(this,"animations");u(this,"_eventListeners");u(this,"needsTranslate",!1);u(this,"needsOrient",!1);u(this,"needsScale",!1);var c,h,d;this.uuid=e,this.name=Ul(t),this.displayName=t,i?this.transform={position:((c=i.position)==null?void 0:c.clone())||null,quaternion:((h=i.quaternion)==null?void 0:h.clone())||null,scale:((d=i.scale)==null?void 0:d.clone())||null}:this.transform=null,this.geometry=n,this.material=r,this.camera=o,this.parent=null,this.children=[],this._eventListeners={},this._isDynamic=!1,this.skinnedMesh=a,this.animations=l}getMatrix(){if(!this.transform)return new fe;const{position:e,quaternion:t,scale:i}=this.transform,n=new fe;return n.compose(e||Tae,t||Mae,i||Iae),n}setMatrix(e){if(!e||!(e instanceof fe)){this.transform=null;return}const t=new w,i=new xe,n=new w;e.decompose(t,i,n),this.transform={position:t,quaternion:i,scale:n}}get matrix(){return this.getMatrix()}set matrix(e){this.setMatrix(e)}get isDynamic(){return this._isDynamic}set isDynamic(e){this._isDynamic=e}static createEmptyParent(e){const t=new Yf(li.generateUUID(),e.name+"_empty_"+Yf.USDObject_export_id++,e.transform),i=e.parent;return i&&i.add(t),t.add(e),t.isDynamic=!0,e.transform=null,t}static createEmpty(){const e=new Yf(li.generateUUID(),"Empty_"+Yf.USDObject_export_id++);return e.isDynamic=!0,e}is(e){return e?this.uuid===e.uuid:!1}isEmpty(){return!this.geometry}clone(){const e=new Yf(li.generateUUID(),this.name,this.transform,this.geometry,this.material);return e.isDynamic=this.isDynamic,e}deepClone(){const e=this.clone();for(const t of this.children)t&&e.add(t.deepClone());return e}getPath(){let e=this.parent,t=this.name;for(;e;)t=(e.parent?e.name:e.name+"/Scenes/Scene")+"/"+t,e=e.parent;return"</"+t+">"}add(e){e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e)}remove(e){const t=this.children.indexOf(e);t>=0&&(e.parent===this&&(e.parent=null),this.children.splice(t,1))}addEventListener(e,t){this._eventListeners[e]||(this._eventListeners[e]=[]),this._eventListeners[e].push(t)}removeEventListener(e,t){if(!this._eventListeners[e])return;const i=this._eventListeners[e].indexOf(t);i>=0&&this._eventListeners[e].splice(i,1)}onSerialize(e,t){const i=this._eventListeners.serialize;i&&i.forEach(n=>n(e,t))}};let wr=Yf;u(wr,"USDObject_export_id",0);class QD extends wr{constructor(){super(void 0,"StageRoot",null,null,null,null);u(this,"stageLength");this.children=[],this.stageLength=200}get isDocumentRoot(){return!0}get isDynamic(){return!1}add(t){t.parent=this,this.children.push(t)}remove(t){const i=this.children.indexOf(t);i>=0&&(t.parent===this&&(t.parent=null),this.children.splice(i,1))}traverse(t,i=null){if(i!==null?t(i):i=this,i.children)for(const n of i.children)this.traverse(t,n)}findById(t){let i=!1;function n(r){if(!i){if(r.uuid===t)return i=!0,r;if(r.children)for(const o of r.children){if(!o)continue;const a=n(o);if(a)return a}}}return n(this)}buildHeader(t){var d,f,p;const i=(d=t.extensions)==null?void 0:d.find(m=>(m==null?void 0:m.extensionName)==="animation"),n=(f=t.extensions)==null?void 0:f.find(m=>(m==null?void 0:m.extensionName)==="Behaviour"),r=(p=t.extensions)==null?void 0:p.find(m=>(m==null?void 0:m.extensionName)==="Physics"),o=(i==null?void 0:i.getStartTimeCode())??0,a=(i==null?void 0:i.getEndTimeCode())??0;let l="";const c=i==null?void 0:i.registeredClips;if(c)for(const m of c)l+=`	# Animation: ${m.name}, start=${i.getStartTimeByClip(m)*60}, length=${m.duration*60}
`;const h=l;return`#usda 1.0
(
	customLayerData = {
		string creator = "Needle Engine ${ja}"
		dictionary Needle = {
			bool animations = ${i?1:0}
			bool interactive = ${n?1:0}
			bool physics = ${r?1:0}
			bool quickLookCompatible = ${t.quickLookCompatible?1:0}
		}
	}
	defaultPrim = "${Ul(this.name)}"
	metersPerUnit = 1
	upAxis = "Y"
	startTimeCode = ${o}
	endTimeCode = ${a}
	timeCodesPerSecond = 60
	framesPerSecond = 60
	doc = """Generated by Needle Engine USDZ Exporter ${ja}"""
${h}
)
`}}const Fm=`
`,io="</StageRoot/Materials";class AQ{constructor(){u(this,"str");u(this,"indent");this.str="",this.indent=0}clear(){this.str="",this.indent=0}beginBlock(e=void 0,t="{",i=!0){e!==void 0?(e=this.applyIndent(e),this.str+=e,i?(this.str+=Fm,this.str+=this.applyIndent(t)):this.str+=" "+t):this.str+=this.applyIndent(t),this.str+=Fm,this.indent+=1}closeBlock(e="}"){this.indent-=1,this.str+=this.applyIndent(e)+Fm}beginArray(e){e=this.applyIndent(e+" = ["),this.str+=e,this.str+=Fm,this.indent+=1}closeArray(){this.indent-=1,this.str+=this.applyIndent("]")+Fm}appendLine(e=""){e=this.applyIndent(e),this.str+=e,this.str+=Fm}toString(){return this.str}applyIndent(e){let t="";for(let i=0;i<this.indent;i++)t+="	";return t+e}}class Rae{constructor(e,t,i){u(this,"root");u(this,"exporter");u(this,"extensions",[]);u(this,"quickLookCompatible");u(this,"exportInvisible");u(this,"materials");u(this,"textures");u(this,"files");u(this,"document");u(this,"output");u(this,"animations");this.root=e,this.exporter=t,this.quickLookCompatible=i.quickLookCompatible,this.exportInvisible=i.exportInvisible,i.extensions&&(this.extensions=i.extensions),this.materials=new Map,this.textures={},this.files={},this.document=new QD,this.output="",this.animations=[]}}class tM{constructor(){u(this,"ar",{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}});u(this,"quickLookCompatible",!1);u(this,"extensions",[]);u(this,"maxTextureSize",4096);u(this,"exportInvisible",!1)}}let _Q=class{constructor(){u(this,"debug");u(this,"pruneUnusedNodes");u(this,"sceneAnchoringOptions",new tM);u(this,"extensions",[]);u(this,"keepObject");u(this,"beforeWritingDocument");this.debug=!1,this.pruneUnusedNodes=!0}async parse(e,t=new tM){var _,A;t=Object.assign(new tM,t),this.sceneAnchoringOptions=t;const i=new Rae(e,this,t);this.extensions=i.extensions;const n=i.files,r="model.usda";n[r]=null;const o=i.materials,a=i.textures;gi.report("export-usdz","Invoking onBeforeBuildDocument"),await Tw(i,"onBeforeBuildDocument"),gi.report("export-usdz","Done onBeforeBuildDocument"),gi.report("export-usdz","Reparent bones to common ancestor");const l=[],c=new Set;e==null||e.traverse(b=>{if(!(!t.exportInvisible&&!b.visible)&&b instanceof ga){const E=b.skeleton.bones,C=vQ(E);if(C){const T={object:b,originalParent:b.parent,newParent:C};l.push(T),c.add(T.object.uuid),T.newParent&&c.add(T.newParent.uuid),T.originalParent&&c.add(T.originalParent.uuid)}}});for(const b of l){const{object:E,originalParent:C,newParent:T}=b;T.add(E)}gi.report("export-usdz","Traversing hierarchy"),e&&bQ(e,i.document,i,this.keepObject),gi.report("export-usdz","Invoking onAfterBuildDocument"),await Tw(i,"onAfterBuildDocument");const h=i.extensions.find(b=>b.extensionName==="Behaviour"),d=(h==null?void 0:h.getAllTargetUuids())??new Set;if(this.pruneUnusedNodes){const b={allBehaviorTargets:d,debug:!1,boneReparentings:c,quickLookCompatible:i.quickLookCompatible};this.debug&&DU(i.document,"Hierarchy BEFORE pruning",b),xQ(i.document,b),this.debug&&DU(i.document,"Hierarchy AFTER pruning")}else this.debug&&console.log("Pruning of empty nodes is disabled. This may result in a larger USDZ file.");gi.report("export-usdz",{message:"Parsing document",autoStep:10}),await Pae(i,()=>(gi.report("export-usdz","Building materials"),zae(o,a,t.quickLookCompatible))),gi.report("export-usdz","Invoking onAfterSerialize"),await Tw(i,"onAfterSerialize");for(const b of l){const{object:E,originalParent:C,newParent:T}=b;C&&C.add(E)}(A=(_=i.exporter)==null?void 0:_.beforeWritingDocument)==null||A.call(_);const p=i.document.buildHeader(i)+`
`+i.output;this.debug&&console.log(p),n[r]=yS(p),i.output="",gi.report("export-usdz",{message:"Exporting textures",autoStep:10}),gi.start("export-usdz-textures",{parentScope:"export-usdz",logTimings:!1});const m=new eh({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),v=Object.keys(a).length;gi.report("export-usdz-textures",{totalSteps:v*3,currentStep:0});const y=async b=>{const E=a[b],C=E.texture,T=TQ.includes(C.format);let M={imageData:C.image};gi.report("export-usdz-textures",{message:"read back texture",autoStep:!0});const R=E.scale!==void 0&&E.scale.x!==1&&E.scale.y!==1&&E.scale.z!==1&&E.scale.w!==1;(C.isCompressedTexture||C.isRenderTargetTexture||R)&&(M=await Bae(C,t.maxTextureSize,m,E.scale)),gi.report("export-usdz-textures",{message:"convert texture to canvas",autoStep:!0});const S=await Oae(M.imageBitmap||M.imageData,t.maxTextureSize).catch(I=>{console.error("Error converting texture to canvas",C,I)});if(S){gi.report("export-usdz-textures",{message:"convert canvas to blob",autoStep:!0});const I=await S.convertToBlob({type:T?"image/png":"image/jpeg",quality:.95});n[`textures/${b}.${T?"png":"jpg"}`]=new Uint8Array(await I.arrayBuffer())}else console.warn("Can`t export texture: ",C)};for(const b in a)await y(b);m.dispose(),gi.end("export-usdz-textures");let g=0;for(const b in n){const E=n[b],C=34+b.length;g+=C;const T=g&63;if(T!==4){const M=64-T,R=new Uint8Array(M);n[b]=[E,{extra:{12345:R}}]}g=E.length}return gi.report("export-usdz","zip archive"),Aoe(n,{level:0})}};function bQ(s,e,t,i){var l;if(!t.exportInvisible&&!s.visible)return;let n,r,o;const a={position:s.position,quaternion:s.quaternion,scale:s.scale};if(s.position.x===0&&s.position.y===0&&s.position.z===0&&(a.position=null),s.quaternion.x===0&&s.quaternion.y===0&&s.quaternion.z===0&&s.quaternion.w===1&&(a.quaternion=null),s.scale.x===1&&s.scale.y===1&&s.scale.z===1&&(a.scale=null),(s instanceof le||s instanceof ga)&&(r=s.geometry,o=s.material),i&&!i(s)&&(r=void 0,o=void 0),(s instanceof le||s instanceof ga)&&o&&(o instanceof ms||o instanceof Kt||o instanceof Vt&&o.type==="MeshLineMaterial")){const c=wx(s),h=s instanceof ga?s:null;n=new wr(s.uuid,c,a,r,o,void 0,h,s.animations)}else if(s instanceof zt||s instanceof Nl){const c=wx(s);n=new wr(s.uuid,c,a,void 0,void 0,s)}else{const c=wx(s);n=new wr(s.uuid,c,a,void 0,void 0,void 0,void 0,s.animations)}if(n){if(n.displayName=((l=s.userData)==null?void 0:l.name)||s.name,n.visibility=s.visible?void 0:"invisible",e&&e.add(n),e=n,t.extensions)for(const c of t.extensions)c.onExportObject&&c.onExportObject.call(c,s,n,t)}else{const c=wx(s),h=new wr(s.uuid,c,{position:s.position,quaternion:s.quaternion,scale:s.scale});e&&e.add(h),e=h}for(const c of s.children)bQ(c,e,t,i)}function DU(s,e,...t){const i={};let n=0;function r(o,a){n++;let l=o.displayName||o.name;l+=" ("+o.uuid+")",(o.geometry||o.material||o.camera||o.skinnedMesh)&&(l+=" ("+(o.geometry?"geo, ":"")+(o.material?"mat, ":"")+(o.camera?"cam, ":"")+(o.skinnedMesh?"skin, ":"")+")"),a[l]={};const h={object:o};o.material&&(h.mat=!0),o.geometry&&(h.geo=!0),o.camera&&(h.cam=!0),o.skinnedMesh&&(h.skin=!0),a[l]._self=h;for(const d of o.children)d&&r(d,a[l])}r(s,i),console.log(e+" ("+n+" nodes)",i,...t)}function xQ(s,e){var c;let t=!0;const i=new Array,n=new Array;if(s.children.length===0)t=!0;else{const h=[...s.children];for(const d of h)if(d){const f=xQ(d,e);e.debug&&(f?i.push(d):n.push(d)),t=t&&f}}const r=e.allBehaviorTargets.has(s.uuid),o=s.geometry||s.material||s.camera&&!e.quickLookCompatible||s.skinnedMesh||!1,a=e.boneReparentings.has(s.uuid),l=t&&!r&&!o&&!a;return l?(e.debug&&console.log("Pruned object:",(s.displayName||s.name)+" ("+s.uuid+")",{isVisible:o,isBehaviorSourceOrTarget:r,allChildsWerePruned:t,isBoneReparenting:a,object:s,prunedChilds:i,keptChilds:n}),(c=s.parent)==null||c.remove(s)):e.debug&&console.log("Kept object:",(s.displayName||s.name)+" ("+s.uuid+")",{isVisible:o,isBehaviorSourceOrTarget:r,allChildsWerePruned:t,isBoneReparenting:a,object:s,prunedChilds:i,keptChilds:n}),l}async function Pae(s,e){gi.start("export-usdz-resources","export-usdz");const t=[];for(const l of s.document.children)wQ(l,s,t);const i=t.length;for(let l=0;l<i;l++)gi.report("export-usdz-resources",{totalSteps:i,currentStep:l}),await new Promise((c,h)=>{t[l](),c()});gi.end("export-usdz-resources");const n=new AQ,r=s.exporter.sceneAnchoringOptions.ar;n.beginBlock(`def Xform "${s.document.name}"`),n.beginBlock(`def Scope "Scenes" (
		kind = "sceneLibrary"
	)`),n.beginBlock('def Xform "Scene"',"(",!1),n.appendLine('apiSchemas = ["Preliminary_AnchoringAPI"]'),n.appendLine("customData = {"),n.appendLine("	bool preliminary_collidesWithEnvironment = 0"),n.appendLine('	string sceneName = "Scene"'),n.appendLine("}"),n.appendLine('sceneName = "Scene"'),n.closeBlock(")"),n.beginBlock(),n.appendLine(`token preliminary:anchoring:type = "${r.anchoring.type}"`),r.anchoring.type==="plane"&&n.appendLine(`token preliminary:planeAnchoring:alignment = "${r.planeAnchoring.alignment}"`),r.anchoring.type==="image"&&n.appendLine(`rel preliminary:imageAnchoring:referenceImage = </${s.document.name}/Scenes/Scene/AnchoringReferenceImage>`),n.appendLine();const o=l=>{if(!l)return 0;let c=1;for(const h of l.children)c+=o(h);return c},a=o(s.document);gi.start("export-usdz-xforms","export-usdz"),gi.report("export-usdz-xforms",{totalSteps:a,currentStep:1});for(const l of s.document.children)CQ(l,n,s);gi.end("export-usdz-xforms"),gi.report("export-usdz","invoke onAfterHierarchy"),Tw(s,"onAfterHierarchy",n),n.closeBlock(),n.closeBlock(),n.appendLine(e()),n.closeBlock(),gi.report("export-usdz","write to string"),s.output+=n.toString()}function wQ(s,e,t){if(!s)return;const i=s.geometry,n=s.material;if(i)if(n&&("isMeshStandardMaterial"in n&&n.isMeshStandardMaterial||"isMeshBasicMaterial"in n&&n.isMeshBasicMaterial||n.type==="MeshLineMaterial")){const r="geometries/"+QR(i,s.name)+".usda";if(!(r in e.files)){const o=()=>{var l,c;const a=Fae(i,(c=(l=s.skinnedMesh)==null?void 0:l.skeleton)==null?void 0:c.bones,e.quickLookCompatible);e.files[r]=kae(a)};t.push(o)}}else console.warn("NeedleUSDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",n==null?void 0:n.name);n&&(n.uuid in e.materials||(e.materials[n.uuid]=n));for(const r of s.children)wQ(r,e,t)}async function Tw(s,e,t=null){if(s.extensions){for(const i of s.extensions)if(i&&typeof i[e]=="function"){const r=i[e].call(i,s,t);r instanceof Promise&&await r}}}let bx=null,no=null,iM,Um,xx;async function Bae(s,e=1/0,t=null,i=void 0){iM||(iM=new _s(2,2,1,1)),Um||(Um=new Rt({uniforms:{blitTexture:new Se(s),flipY:new Se(!1),scale:new Se(new Je(1,1,1,1))},vertexShader:`
            varying vec2 vUv;
			uniform bool flipY;
            void main(){
                vUv = uv;
				if (flipY)
					vUv.y = 1. - vUv.y;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture;
			uniform vec4 scale; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
				
				gl_FragColor.rgba *= scale.rgba;
            }`}));const n=Um.uniforms;n.blitTexture.value=s,n.flipY.value=!1,n.scale.value=new Je(1,1,1,1),i!==void 0&&n.scale.value.copy(i),Um.defines.IS_SRGB=s.colorSpace==_t,Um.needsUpdate=!0,xx||(xx=new le(iM,Um),xx.frustumCulled=!1);const r=new zt,o=new Ks;o.add(xx),t||(t=bx=new eh({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}));const a=Math.min(s.image.width,e),l=Math.min(s.image.height,e);no&&(no.width!==a||no.height!==l)&&(no.dispose(),no=null),no||(no=new Yt(a,l,{format:Ti,type:Ri,minFilter:Nt,magFilter:Nt})),t.setRenderTarget(no),t.setSize(a,l),t.clear(),t.render(o,r),bx&&(bx.dispose(),bx=null);const c=new Uint8ClampedArray(no.width*no.height*4);t.readRenderTargetPixels(no,0,0,no.width,no.height,c);const h=new ImageData(c,no.width,no.height,void 0),d=await createImageBitmap(h,{premultiplyAlpha:"none"});return{imageData:h,imageBitmap:d}}function Dae(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&s instanceof ImageBitmap}async function Oae(s,e=4096){const t=e/Math.max(s.width,s.height),i=s.width*Math.min(1,t),n=s.height*Math.min(1,t),r=new OffscreenCanvas(i,n),o={premultiplyAlpha:"none"};s.width!==i&&(o.resizeWidth=i),s.height!==n&&(o.resizeHeight=n);const a=await createImageBitmap(s,o),l=r.getContext("bitmaprenderer");return l&&l.transferFromImageBitmap(a),r}async function SQ(s,e=void 0,t=!1,i=4096){if(Dae(s)){const n=i/Math.max(s.width,s.height),r=new OffscreenCanvas(s.width*Math.min(1,n),s.height*Math.min(1,n)),o=r.getContext("2d",{alpha:!0,premultipliedAlpha:!1});if(!o)throw new Error("Could not get canvas 2D context");if(t===!0&&(o.translate(0,r.height),o.scale(1,-1)),o.drawImage(s,0,0,r.width,r.height),e!==void 0){const a=e.x,l=e.y,c=e.z,h=e.w,d=o.getImageData(0,0,r.width,r.height),f=d.data;for(let p=0;p<f.length;p+=4)f[p+0]=f[p+0]*a,f[p+1]=f[p+1]*l,f[p+2]=f[p+2]*c,f[p+3]=f[p+3]*h;o.putImageData(d,0,0)}return r}else throw new Error("NeedleUSDZExporter: No valid image data found. Unable to process texture.")}const gn=7;function Lae(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Needle Engine USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)
`}function kae(s,e){let t=Lae();return t+=s,yS(t)}function wx(s){return s.name.replace(/[-<>\(\)\[\]§$%&\/\\\=\?\,\;]/g,"")+"_"+s.id}function OU(s){return Ul(s.name||"bone_"+s.uuid)}function QR(s,e){return Ul(s.name||"Geometry")+"_"+s.id}function jD(s){return Ul(s.name||"Material")+"_"+s.id}function kg(s,e){let t=OU(s),i=s.parent;for(;i&&i!==e;)t=OU(i)+"/"+t,i=i.parent;return t}function CQ(s,e,t){var p;if(s==null)return;gi.report("export-usdz-xforms",{message:"buildXform "+s.displayName||s.name,autoStep:!0});const i=s.transform,n=s.geometry,r=s.material,o=s.camera,a=s.name;if(s.animations)for(const m of s.animations)t.animations.push(m);const l=n&&n.isBufferGeometry&&n.attributes.skinIndex!==void 0&&n.attributes.skinIndex.count>0,c=l?"SkelRoot":"Xform",h=new Array,d=r&&r instanceof Kt&&r.color&&r.color.r===1&&r.color.g===1&&r.color.b===1&&!r.map&&r.opacity===1&&(n==null?void 0:n.attributes.color);if(n!=null&&n.attributes.color&&!d&&console.warn("NeedleUSDZExporter: Geometry has vertex colors. Vertex colors will only be shown in QuickLook for unlit materials with white color and no texture. Otherwise, they will be ignored.",s.displayName),e.appendLine(),n?(e.beginBlock(`def ${c} "${a}"`,"(",!1),t.quickLookCompatible&&r&&r.side===Pi&&!l?e.appendLine(`prepend references = @./geometries/${QR(n)}.usda@</Geometry_doubleSided>`):e.appendLine(`prepend references = @./geometries/${QR(n)}.usda@</Geometry>`),d||h.push("MaterialBindingAPI"),l&&h.push("SkelBindingAPI")):o&&!t.quickLookCompatible?e.beginBlock(`def Camera "${a}"`,"(",!1):s.type!==void 0?e.beginBlock(`def ${s.type} "${a}"`):e.beginBlock(`def Xform "${a}"`,"(",!1),s.type===void 0&&((p=s.extraSchemas)!=null&&p.length&&h.push(...s.extraSchemas),h.length&&e.appendLine(`prepend apiSchemas = [${h.map(m=>`"${m}"`).join(", ")}]`)),s.displayName&&e.appendLine(`displayName = "${gQ(s.displayName)}"`),(o||s.type===void 0)&&(e.closeBlock(")"),e.beginBlock()),n&&r){if(!d){const m=jD(r);e.appendLine(`rel material:binding = </StageRoot/Materials/${m}>`)}!t.quickLookCompatible&&r.side===Pi&&(e.beginBlock('over "Geometry" '),e.appendLine("uniform bool doubleSided = 1"),e.closeBlock())}let f=!1;if(l?(e.appendLine("rel skel:skeleton = <Rig>"),e.appendLine("rel skel:animationSource = <Rig/_anim>"),f=!1):s.type===void 0&&i&&(f=f||i.position!==null||i.quaternion!==null||i.scale!==null,i.position&&(s.needsTranslate=!0,e.appendLine(`double3 xformOp:translate = (${mi(i.position.x)}, ${mi(i.position.y)}, ${mi(i.position.z)})`)),i.quaternion&&(s.needsOrient=!0,e.appendLine(`quatf xformOp:orient = (${mi(i.quaternion.w)}, ${mi(i.quaternion.x)}, ${mi(i.quaternion.y)}, ${mi(i.quaternion.z)})`)),i.scale&&(s.needsScale=!0,e.appendLine(`double3 xformOp:scale = (${mi(i.scale.x)}, ${mi(i.scale.y)}, ${mi(i.scale.z)})`))),s.visibility!==void 0&&e.appendLine(`token visibility = "${s.visibility}"`),o&&!t.quickLookCompatible&&("isOrthographicCamera"in o&&o.isOrthographicCamera?(e.appendLine(`float2 clippingRange = (${o.near}, ${o.far})`),e.appendLine(`float horizontalAperture = ${((Math.abs(o.left)+Math.abs(o.right))*10).toPrecision(gn)}`),e.appendLine(`float verticalAperture = ${((Math.abs(o.top)+Math.abs(o.bottom))*10).toPrecision(gn)}`),e.appendLine('token projection = "orthographic"')):"isPerspectiveCamera"in o&&o.isPerspectiveCamera&&(e.appendLine(`float2 clippingRange = (${o.near.toPrecision(gn)}, ${o.far.toPrecision(gn)})`),e.appendLine(`float focalLength = ${o.getFocalLength().toPrecision(gn)}`),e.appendLine(`float focusDistance = ${o.focus.toPrecision(gn)}`),e.appendLine(`float horizontalAperture = ${o.getFilmWidth().toPrecision(gn)}`),e.appendLine('token projection = "perspective"'),e.appendLine(`float verticalAperture = ${o.getFilmHeight().toPrecision(gn)}`))),s.onSerialize&&s.onSerialize(e,t),s.type===void 0){const m=new Array;s.needsTranslate&&m.push('"xformOp:translate"'),s.needsOrient&&m.push('"xformOp:orient"'),s.needsScale&&m.push('"xformOp:scale"'),m.length&&e.appendLine(`uniform token[] xformOpOrder = [${m.join(", ")}]`)}if(s.children){e.appendLine();for(const m of s.children)CQ(m,e,t)}e.closeBlock()}function mi(s){return Number.isInteger(s)?s.toString():s.toFixed(10)}function LU(s){const e=s.elements;return`( ${Sx(e,0)}, ${Sx(e,4)}, ${Sx(e,8)}, ${Sx(e,12)} )`}function Sx(s,e){return`(${mi(s[e+0])}, ${mi(s[e+1])}, ${mi(s[e+2])}, ${mi(s[e+3])})`}function Fae(s,e=[],t=!0){return`
def "Geometry"
${Uae(s,e,t)}
`}function Uae(s,e=[],t=!0){const i="Geometry",n=s.attributes,r=n.position.count,o=e&&e.length>0,a=[],l=[];let c=new Array,h=n.skinIndex;if(o){const f=[];for(const v of e)v.parent.type!=="Bone"&&(a.push({bone:v,index:e.indexOf(v)}),f.push(v.uuid));for(;f.length<e.length;)for(const v of a){const y=v.bone.children;for(const g of y)f.indexOf(g.uuid)===-1&&e.indexOf(g)!==-1&&(a.push({bone:g,index:e.indexOf(g)}),f.push(g.uuid))}for(const v of yQ(e))a.push({bone:v,index:a.length});const p=a[0].bone.parent;a.sort((v,y)=>kg(v.bone,p)>kg(y.bone,p)?1:-1),a.map(v=>'"'+kg(v.bone,p)+'"').join(", ");for(const v in a)l[a[v].index]=parseInt(v);const m=n.skinIndex;c=new Array;for(let v=0;v<m.count;v++){const y=m.getX(v),g=m.getY(v),_=m.getZ(v),A=m.getW(v);c.push(l[y],l[g],l[_],l[A])}h=new ot(new Uint16Array(c),4)}const d=n.skinWeight&&n.skinIndex;return`
{	
    def Mesh "${i}" ${d?`(
        prepend apiSchemas = ["SkelBindingAPI"]
    )`:""}
    {
        int[] faceVertexCounts = [${nM(s)}]
        int[] faceVertexIndices = [${sM(s)}]
		${n.normal||t?`normal3f[] normals = [${Mw(n.normal,r)}] (
            interpolation = "vertex"
        )`:""}
        point3f[] points = [${Mw(n.position,r)}]
        ${n.uv?`texCoord2f[] primvars:st = [${EQ(n.uv,r,!0)}] (
            interpolation = "vertex"
        )`:""}
		${n.uv1?rM("st1",n.uv1):""}
		${n.uv2?rM("st2",n.uv2):""}
		${n.uv3?rM("st3",n.uv3):""}
		${d?`matrix4d primvars:skel:geomBindTransform = ( (1, 0, 0, 0), (0, 1, 0, 0), (0, 0, 1, 0), (0, 0, 0, 1) ) (
				elementSize = 1
				interpolation = "constant"
			)`:""}
		${n.skinIndex?`int[] primvars:skel:jointIndices = [${kU(h,!0)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${n.skinWeight?`float[] primvars:skel:jointWeights = [${kU(n.skinWeight)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${n.color?`color3f[] primvars:displayColor = [${Mw(n.color,r)}] (
			interpolation = "vertex"
		)`:""}
        uniform token subdivisionScheme = "none"
    }
}
${t?`
# This is a workaround for QuickLook/RealityKit not supporting the doubleSided attribute. We're adding a second
# geometry definition here, that uses the same mesh data but appends extra faces with reversed winding order.
def "${i}_doubleSided" (
	prepend references = </Geometry>
)
{
	over "Geometry"
	{
		int[] faceVertexCounts = [${nM(s)+", "+nM(s)}]
		int[] faceVertexIndices = [${sM(s)+", "+sM(s,!0)}]
	}
}
`:""}
`}function nM(s){const e=s.index!==null?s.index.count:s.attributes.position.count;return Array(Math.floor(e/3)).fill(3).join(", ")}function sM(s,e=!1){const t=s.index,i=[];if(t!==null)for(let n=0;n<t.count;n++){let r=n;e&&(r=n%3===0?n+2:n%3===2?n-2:n),i.push(t.getX(r))}else{const n=s.attributes.position.count;for(let r=0;r<n;r++){let o=r;e&&(o=r%3===0?r+2:r%3===2?r-2:r),i.push(o)}}return i.join(", ")}function rM(s,e){const t=e.itemSize;switch(t){case 2:return`texCoord2f[] primvars:${s} = [${EQ(e,t,!0)}] (
				interpolation = "vertex"
			)`;case 3:return`texCoord3f[] primvars:${s} = [${Mw(e,t)}] (
				interpolation = "vertex"
			)`;case 4:return`double4[] primvars:${s} = [${Nae(e,t)}] (
				interpolation = "vertex"
			)`;default:return console.warn("USDZExporter: Attribute with "+t+" components are currently not supported. Results may be undefined for "+s+"."),""}}function Mw(s,e){if(s===void 0)return console.warn("USDZExporter: A mesh attribute is missing and will be set with placeholder data. The result may look incorrect."),Array(e).fill("(0, 0, 1)").join(", ");const t=[];for(let i=0;i<s.count;i++){const n=s.getX(i),r=s.getY(i),o=s.getZ(i);t.push(`(${n.toPrecision(gn)}, ${r.toPrecision(gn)}, ${o.toPrecision(gn)})`)}return t.join(", ")}function Nae(s,e){if(s===void 0)return console.warn("USDZExporter: Attribute is missing. Results may be undefined."),Array(e).fill("(0, 0, 0, 0)").join(", ");const t=[];for(let i=0;i<s.count;i++){const n=s.getX(i),r=s.getY(i),o=s.getZ(i)||0,a=s.getW(i)||0;t.push(`(${n.toPrecision(gn)}, ${r.toPrecision(gn)}, ${o.toPrecision(gn)}, ${a.toPrecision(gn)})`)}return t.join(", ")}function kU(s,e=!1){const t=[];for(let i=0;i<s.count;i++){const n=s.getX(i),r=s.getY(i),o=s.getZ(i),a=s.getW(i);t.push(`${e?n:n.toPrecision(gn)}`),t.push(`${e?r:r.toPrecision(gn)}`),t.push(`${e?o:o.toPrecision(gn)}`),t.push(`${e?a:a.toPrecision(gn)}`)}return t.join(", ")}function EQ(s,e,t=!1){if(s===void 0)return console.warn("USDZExporter: UVs missing."),Array(e).fill("(0, 0)").join(", ");const i=[];for(let n=0;n<s.count;n++){const r=s.getX(n);let o=s.getY(n);t&&(o=1-o),i.push(`(${r.toPrecision(gn)}, ${o.toPrecision(gn)})`)}return i.join(", ")}function zae(s,e,t=!1){const i=[];for(const n in s){const r=s[n];i.push(Gae(r,e,t))}return`
	def "Materials"
    {
${i.join("")}
    }`}function Gae(s,e,t=!1){var m,v,y;const i=jD(s);if(console.log(s),s.colorWrite===!1||((m=s.userData)==null?void 0:m.isShadowCatcherMaterial)||((v=s.userData)==null?void 0:v.isLightBlendMaterial)){const g=s.userData.isLightBlendMaterial||s.userData.isShadowCatcherMaterial?"ND_realitykit_shadowreceiver_surfaceshader":"ND_realitykit_occlusion_surfaceshader";return`

		def Material "${i}" ${s.name?`(
			displayName = "${s.name}"
		)`:""}
		{
			token outputs:mtlx:surface.connect = ${io}/${i}/Occlusion.outputs:out>

			def Shader "Occlusion"
			{
				uniform token info:id = "${g}"
				token outputs:out
			}
		}`}const r="                ",o=[],a=[],l=new Set;function c(g){var _;return Ul(g.name)+"_"+(((_=g.source)==null?void 0:_.id)??g.id)}function h(g,_,A=void 0,b=void 0){const E=c(g),C=E+(b!==void 0&&b!==1?"_"+b:""),T=t&&b!==void 0&&b!==1,M=T?new Je(1,1,1,b):void 0;b===void 0&&(b=1),T&&(b=1),M&&M.w<=.05&&(M.w=.05),e[C]={texture:g,scale:M};const R=g.channel>0?"st"+g.channel:"st";l.add(g.channel);const S=TQ.includes(g.format),I={1e3:"repeat",1001:"clamp",1002:"mirror"},L=g.repeat.clone(),U=g.offset.clone(),D=g.rotation,V=Math.sin(D),O=Math.cos(D);U.y=1-U.y-L.y,t?(L.x===0&&(L.x=1e-4),L.y===0&&(L.y=1e-4),U.x=U.x/L.x,U.y=U.y/L.y,U.x+=V/L.x,U.y+=O-1):(U.x+=V*L.x,U.y+=(1-O)*L.y);const F=L.x!=1||L.y!=1||U.x!=0||U.y!=0||D!=0,N=`${io}/${i}/${"uvReader_"+R}.outputs:result>`,q=`${io}/${i}/Transform2d_${_}.outputs:result>`,$=_!=="normal"&&A&&(A.r!==1||A.g!==1||A.b!==1||b!==1)||!1,oe=_==="normal",ae=s instanceof ms&&s.normalScale?s.normalScale.x*2:2,Re=ae.toFixed(gn),se=(-1*(ae/2)).toFixed(gn),ye=(1-ae).toFixed(gn);return`
			${F?`def Shader "Transform2d_${_}" (
				sdrMetadata = {
					string role = "math"
				}
			)
			{
				uniform token info:id = "UsdTransform2d"
				float2 inputs:in.connect = ${N}
				float2 inputs:scale = ${UU(L)}
				float2 inputs:translation = ${UU(U)}
				float inputs:rotation = ${(D/Math.PI*180).toFixed(gn)}
				float2 outputs:result
			}
			`:""}
			def Shader "${E}_${_}"
			{
				uniform token info:id = "UsdUVTexture"
				asset inputs:file = @textures/${C}.${S?"png":"jpg"}@
				token inputs:sourceColorSpace = "${g.colorSpace==="srgb"?"sRGB":"raw"}"
				float2 inputs:st.connect = ${F?q:N}
				${$?`
				float4 inputs:scale = (${A?A.r+", "+A.g+", "+A.b:"1, 1, 1"}, ${b})
				`:""}
				${oe?`
				float4 inputs:scale = (${Re}, ${Re}, ${Re}, 1)
				float4 inputs:bias = (${se}, ${se}, ${ye}, 0)
				`:""}
				token inputs:wrapS = "${I[g.wrapS]}"
				token inputs:wrapT = "${I[g.wrapT]}"
				float outputs:r
				float outputs:g
				float outputs:b
				float3 outputs:rgb
				${s.transparent||s.alphaTest>0?"float outputs:a":""}
			}`}let d=s.transparent||s.alphaTest?s.opacity:1,f=!1,p=!1;if(s instanceof Qo&&s.transmission!==void 0&&(d*=1-s.transmission*(1-s.roughness*.5)),s.map?(o.push(`${r}color3f inputs:diffuseColor.connect = ${io}/${i}/${c(s.map)}_diffuse.outputs:rgb>`),s instanceof Kt&&s.transparent&&s.alphaTest==0&&t?(o.push(`${r}float inputs:opacity.connect = ${io}/${i}/${c(s.map)}_diffuse.outputs:a>`),f=!0,o.push(`${r}float inputs:opacityThreshold = ${1e-10}`),p=!0):s.transparent?(o.push(`${r}float inputs:opacity.connect = ${io}/${i}/${c(s.map)}_diffuse.outputs:a>`),f=!0):s.alphaTest>0&&(o.push(`${r}float inputs:opacity.connect = ${io}/${i}/${c(s.map)}_diffuse.outputs:a>`),f=!0,o.push(`${r}float inputs:opacityThreshold = ${s.alphaTest}`),p=!0),a.push(h(s.map,"diffuse",s.color,d))):o.push(`${r}color3f inputs:diffuseColor = ${FU(s.color)}`),s.alphaHash&&t&&(p?console.warn("Opacity threshold for "+s.name+" was already connected. Skipping alphaHash opacity threshold."):(o.push(`${r}float inputs:opacityThreshold = 0.0000000001`),p=!0)),s.aoMap&&(o.push(`${r}float inputs:occlusion.connect = ${io}/${i}/${c(s.aoMap)}_occlusion.outputs:r>`),a.push(h(s.aoMap,"occlusion"))),s.alphaMap?(o.push(`${r}float inputs:opacity.connect = ${io}/${i}/${c(s.alphaMap)}_opacity.outputs:r>`),o.push(`${r}float inputs:opacityThreshold = 0.0000000001`),f=!0,p=!0,a.push(h(s.alphaMap,"opacity",new me(1,1,1),d))):(f?console.warn("Opacity for "+s.name+" was already connected. Skipping default opacity."):(o.push(`${r}float inputs:opacity = ${d}`),f=!0),s.alphaTest>0&&(p?console.warn("Opacity threshold for "+s.name+" was already connected. Skipping default opacity threshold."):(o.push(`${r}float inputs:opacityThreshold = ${s.alphaTest}`),p=!0))),s instanceof ms){if(s.emissiveMap){o.push(`${r}color3f inputs:emissiveColor.connect = ${io}/${i}/${c(s.emissiveMap)}_emissive.outputs:rgb>`);const g=s.emissive.clone();g.multiplyScalar(s.emissiveIntensity),a.push(h(s.emissiveMap,"emissive",g))}else if(((y=s.emissive)==null?void 0:y.getHex())>0){const g=s.emissive.clone();g.multiplyScalar(s.emissiveIntensity),o.push(`${r}color3f inputs:emissiveColor = ${FU(g)}`)}s.normalMap&&(o.push(`${r}normal3f inputs:normal.connect = ${io}/${i}/${c(s.normalMap)}_normal.outputs:rgb>`),a.push(h(s.normalMap,"normal"))),s.roughnessMap&&s.roughness===1?(o.push(`${r}float inputs:roughness.connect = ${io}/${i}/${c(s.roughnessMap)}_roughness.outputs:g>`),a.push(h(s.roughnessMap,"roughness"))):o.push(`${r}float inputs:roughness = ${s.roughness!==void 0?s.roughness:1}`),s.metalnessMap&&s.metalness===1?(o.push(`${r}float inputs:metallic.connect = ${io}/${i}/${c(s.metalnessMap)}_metallic.outputs:b>`),a.push(h(s.metalnessMap,"metallic"))):o.push(`${r}float inputs:metallic = ${s.metalness!==void 0?s.metalness:0}`)}return s instanceof Qo&&(o.push(`${r}float inputs:clearcoat = ${s.clearcoat}`),o.push(`${r}float inputs:clearcoatRoughness = ${s.clearcoatRoughness}`),o.push(`${r}float inputs:ior = ${s.ior}`),!s.transparent&&!(s.alphaTest>0)&&s.transmissionMap&&(o.push(`${r}float inputs:opacity.connect = ${io}/${i}/${c(s.transmissionMap)}_transmission.outputs:r>`),a.push(h(s.transmissionMap,"transmission")))),l.size>2?console.warn("USDZExporter: Material "+s.name+" uses more than 2 UV channels. Currently, only UV0 and UV1 are supported."):l.size===2&&(!l.has(0)||!l.has(1))&&console.warn("USDZExporter: Material "+s.name+" uses UV channels other than 0 and 1. Currently, only UV0 and UV1 are supported."),`

		def Material "${i}" ${s.name?`(
			displayName = "${gQ(s.name)}"
		)`:""}
		{
			token outputs:surface.connect = ${io}/${i}/PreviewSurface.outputs:surface>

			def Shader "PreviewSurface"
			{
				uniform token info:id = "UsdPreviewSurface"
${o.join(`
`)}
				int inputs:useSpecularWorkflow = ${s instanceof Kt?"1":"0"}
				token outputs:surface
			}
${a.length>0?`
${l.has(0)?`
			def Shader "uvReader_st"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${l.has(1)?`
			def Shader "uvReader_st1"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st1"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${a.join(`
`)}`:""}
		}`}function FU(s){return`(${s.r}, ${s.g}, ${s.b})`}function UU(s){return`(${s.x}, ${s.y})`}const TQ=[1023,33777,33778,33779,35842,35843,37496,37808,37809,37810,37811,37812,37813,37814,37815,37816,37817,37818,37819,37820,37821,36492];ie("debugusdz");const d2=class{constructor(e,t,i){u(this,"id");u(this,"trigger");u(this,"action");u(this,"exclusive",!1);this.id="Behavior_"+Ul(e)+"_"+d2.global_id++,this.trigger=t,this.action=i}makeExclusive(e){return this.exclusive=e,this}writeTo(e,t,i){if(!this.trigger||!this.action)return;i.beginBlock(`def Preliminary_Behavior "${this.id}"`);let n="";if(Array.isArray(this.trigger)){n="[";for(let r=0;r<this.trigger.length;r++){const o=this.trigger[r];n+="<"+o.id+">",r+1<this.trigger.length&&(n+=", ")}n+="]"}else n=`<${this.trigger.id}>`;if(i.appendLine(`rel triggers = ${n}`),i.appendLine(`rel actions = <${this.action.id}>`),i.appendLine(`uniform bool exclusive = ${this.exclusive?1:0}`),i.appendLine(),Array.isArray(this.trigger))for(const r of this.trigger)r.writeTo(t,i),i.appendLine();else this.trigger.writeTo(t,i);i.appendLine(),this.action.writeTo(t,i),i.closeBlock()}};let ys=d2;u(ys,"global_id",0);const Nm=new Set;function jR(s,e){var i,n;let t="";if(Array.isArray(s)){Nm.clear();let r="[ ";for(let o=0;o<s.length;o++){let a=s[o];if(!a){console.warn("Invalid target object in behavior",s+". Is the object exported?");continue}if(typeof a=="string"){if(Nm.has(a))continue;r+=a,Nm.add(a)}else if(typeof a=="object"){if(a.isObject3D&&(a=e.findById(a.uuid),!a)){console.warn("Invalid target object in behavior",s+". Is the object exported?");continue}const l=(i=a.getPath)==null?void 0:i.call(a);if(Nm.has(l))continue;r+=l,Nm.add(l)}o+1<s.length&&(r+=", ")}r+=" ]",t=r,Nm.clear()}else if(typeof s=="object"){const r=s;if(r.isObject3D&&(s=e.findById(r.uuid)),!s)throw console.error("Invalid target object in behavior, the target object is likely missing from USDZ export. Is the object exported?",r),new Error(`Invalid target object in behavior, the target object is likely missing from USDZ export. Please report a bug. uuid: ${r.uuid}.`);t=(n=s.getPath)==null?void 0:n.call(s)}return t}const f2=class{constructor(e,t){u(this,"id");u(this,"targetId");u(this,"tokenId");u(this,"type");u(this,"distance");e&&(this.targetId=e),t?this.id=t:this.id="Trigger_"+f2.global_id++}writeTo(e,t){t.beginBlock(`def Preliminary_Trigger "${this.id}"`),this.targetId&&(typeof this.targetId!="string"&&(this.targetId=jR(this.targetId,e)),t.appendLine("rel affectedObjects = "+this.targetId)),this.tokenId&&t.appendLine(`token info:id = "${this.tokenId}"`),this.type&&t.appendLine(`token type = "${this.type}"`),typeof this.distance=="number"&&t.appendLine(`double distance = ${this.distance}`),t.closeBlock()}};let Nc=f2;u(Nc,"global_id",0);function NU(s,e={direct:!0,indirect:!0}){const t=wr.createEmpty();t.name="InputTarget_"+t.name,t.displayName=void 0,t.type="RealityKitComponent",t.onSerialize=i=>{i.appendLine("bool allowsDirectInput = "+(e.direct?1:0)),i.appendLine("bool allowsIndirectInput = "+(e.indirect?1:0)),i.appendLine('uniform token info:id = "RealityKit.InputTarget"')},s.add(t)}class Ys{static sceneStartTrigger(){const e=new Nc;return e.targetId=void 0,e.tokenId="SceneTransition",e.type="enter",e}static tapTrigger(e,t={direct:!0,indirect:!0}){const i=new Nc(e);if(Array.isArray(e)&&e.length>1)for(const n of e)n instanceof wr&&NU(n,t);else e instanceof wr&&NU(e,t);return i.tokenId="TapGesture",i}static isTapTrigger(e){return(e==null?void 0:e.tokenId)==="TapGesture"}static proximityToCameraTrigger(e,t){const i=new Nc(e);return i.tokenId="ProximityToCamera",i.distance=t,i}}class $h{constructor(e,t){u(this,"id");u(this,"actions");u(this,"loops",0);u(this,"performCount",1);u(this,"type","serial");u(this,"multiplePerformOperation");this.id=e,this.actions=t}static getId(){return this.global_id++}addAction(e){return this.actions.push(e),this}makeParallel(){return this.type="parallel",this}makeSequence(){return this.type="serial",this}makeLooping(){return this.loops=1,this.performCount=0,this}makeRepeat(e){return this.performCount=e,this}writeTo(e,t){t.beginBlock(`def Preliminary_Action "${this.id}"`),t.beginArray("rel actions");for(const i of this.actions){if(!i)continue;const n=i===this.actions[this.actions.length-1];t.appendLine("<"+i.id+">"+(n?"":", "))}t.closeArray(),t.appendLine(),t.appendLine('token info:id = "Group"'),t.appendLine(`bool loops = ${this.loops}`),t.appendLine(`int performCount = ${this.loops>0?0:Math.max(0,this.performCount)}`),t.appendLine(`token type = "${this.type}"`),typeof this.multiplePerformOperation=="string"&&t.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),t.appendLine();for(const i of this.actions)i&&(i.writeTo(e,t),t.appendLine());t.closeBlock()}}u($h,"global_id",0);const eC=class{constructor(e,t){u(this,"id");u(this,"tokenId");u(this,"affectedObjects");u(this,"easeType");u(this,"motionType");u(this,"duration");u(this,"moveDistance");u(this,"style");u(this,"type");u(this,"front");u(this,"up");u(this,"start");u(this,"animationSpeed");u(this,"reversed");u(this,"pingPong");u(this,"xFormTarget");u(this,"audio");u(this,"gain");u(this,"auralMode");u(this,"multiplePerformOperation");u(this,"velocity");u(this,"comment");u(this,"animationName");e&&(this.affectedObjects=e),t?this.id=t:this.id="Action",this.id+="_"+eC.global_id++}clone(){const e=new eC,t=e.id;return Object.assign(e,this),e.id=t,e}writeTo(e,t){t.beginBlock(`def Preliminary_Action "${this.id}"`),this.comment&&t.appendLine(`# ${this.comment}`),this.affectedObjects&&(typeof this.affectedObjects!="string"&&(this.affectedObjects=jR(this.affectedObjects,e)),t.appendLine("rel affectedObjects = "+this.affectedObjects)),typeof this.duration=="number"&&(typeof this.animationSpeed=="number"&&this.animationSpeed!==1?t.appendLine(`double duration = ${this.duration/this.animationSpeed} `):t.appendLine(`double duration = ${this.duration} `)),this.easeType&&t.appendLine(`token easeType = "${this.easeType}"`),this.tokenId&&t.appendLine(`token info:id = "${this.tokenId}"`),this.tokenId==="ChangeScene"&&t.appendLine("rel scene = </StageRoot/Scenes/Scene>"),this.motionType!==void 0&&t.appendLine(`token motionType = "${this.motionType}"`),typeof this.moveDistance=="number"&&t.appendLine(`double moveDistance = ${this.moveDistance} `),this.style&&t.appendLine(`token style = "${this.style}"`),this.type&&t.appendLine(`token type = "${this.type}"`),this.front&&t.appendLine(`vector3d front = (${this.front.x}, ${this.front.y}, ${this.front.z})`),this.up&&t.appendLine(`vector3d upVector = (${this.up.x}, ${this.up.y}, ${this.up.z})`),typeof this.start=="number"&&t.appendLine(`double start = ${this.start} `),typeof this.animationSpeed=="number"&&t.appendLine(`double animationSpeed = ${this.animationSpeed.toFixed(2)} `),typeof this.reversed=="boolean"&&t.appendLine(`bool reversed = ${this.reversed}`),typeof this.pingPong=="boolean"&&t.appendLine(`bool reverses = ${this.pingPong}`),this.xFormTarget&&(typeof this.xFormTarget!="string"&&(this.xFormTarget=jR(this.xFormTarget,e)),t.appendLine(`rel xformTarget = ${this.xFormTarget}`)),typeof this.audio=="string"&&t.appendLine(`asset audio = @${this.audio}@`),typeof this.gain=="number"&&t.appendLine(`double gain = ${this.gain}`),typeof this.auralMode=="string"&&t.appendLine(`token auralMode = "${this.auralMode}"`),typeof this.multiplePerformOperation=="string"&&t.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),typeof this.velocity=="object"&&t.appendLine(`vector3d velocity = (${this.velocity.x}, ${this.velocity.y}, ${this.velocity.z})`),t.closeBlock()}};let ho=eC;u(ho,"global_id",0);let ug=class Jm{constructor(e,t,i){u(this,"x",0);u(this,"y",0);u(this,"z",0);this.x=e,this.y=t,this.z=i}static get up(){return new Jm(0,1,0)}static get right(){return new Jm(1,0,0)}static get forward(){return new Jm(0,0,1)}static get back(){return new Jm(0,0,-1)}static get zero(){return new Jm(0,0,0)}};class wi{static sequence(...e){return new $h("Group_"+$h.getId(),e).makeSequence()}static parallel(...e){return new $h("Group_"+$h.getId(),e).makeParallel()}static fadeAction(e,t,i){const n=new ho(e);return n.tokenId="Visibility",n.type=i?"show":"hide",n.duration=t,n.style="basic",n.motionType="none",n.moveDistance=0,n.easeType="none",n}static startAnimationAction(e,t,i=!1,n=!1){const r=new ho(e);r.tokenId="StartAnimation";const o=t.start,a=t.duration,l=t.speed,c=t.clipName;if(r.comment=`Animation: ${c}, start=${o*60}, length=${a*60}, end=${(o+a)*60}`,r.animationName=c,r.start=o,r.duration=a,r.animationSpeed=l,r.reversed=i,r.pingPong=n,r.multiplePerformOperation="allow",i&&(r.start-=a),n){r.pingPong=!1;const h=r.clone();return h.reversed=!i,h.start=r.start,h.reversed&&(h.start-=a),wi.sequence(r,h)}return r}static waitAction(e){const t=new ho;return t.tokenId="Wait",t.duration=e,t.motionType=void 0,t}static lookAtCameraAction(e,t,i,n){const r=new ho(e);return r.tokenId="LookAtCamera",r.duration=t===void 0?9999999999999:t,r.front=i??ug.forward,r.up=n??ug.up,r}static emphasize(e,t,i="bounce",n=1,r="basic"){const o=new ho(e);return o.tokenId="Emphasize",o.duration=t,o.style=r??"basic",o.motionType=i,o.moveDistance=n,o}static transformAction(e,t,i,n,r="inout"){const o=new ho(e);return o.tokenId="Transform",o.duration=i,o.duration=Math.max(1e-6,i),o.type=n,o.easeType=i>0?r:"none",Array.isArray(t)&&console.error("Transform target must not be an array",t),o.xFormTarget=t,o}static playAudioAction(e,t,i="play",n=1,r="spatial"){const o=new ho(e);return o.tokenId="Audio",o.type=i,o.audio=t,o.gain=n,o.auralMode=r,o.multiplePerformOperation="allow",o}static impulseAction(e,t){const i=new ho(e);return i.tokenId="Impulse",i.velocity=t,i}}class Hae{constructor(e){u(this,"object");u(this,"model");this.object=e}get id(){return this.object.uuid}apply(e){if(!this.model&&(this.model=e.findById(this.object.uuid),!this.model)){console.error("could not find model with id "+this.object.uuid);return}this.onApply(e)}}class WD extends Hae{constructor(t,i,n,r){super(t);u(this,"matrix");u(this,"material");u(this,"geometry");u(this,"_enableAction");u(this,"_disableAction");this.matrix=i,this.material=n,this.geometry=r}onApply(t){var r,o;const i=this.model;if(!i)return;(r=i.parent)!=null&&r.isDynamic||wr.createEmptyParent(i);const n=i.clone();this.matrix&&n.setMatrix(this.matrix),this.material&&(n.material=this.material),this.geometry&&(n.geometry=this.geometry),(o=i.parent)==null||o.add(n)}enable(){return this._enableAction?this._enableAction:(this._enableAction=wi.fadeAction(this.object,0,!0),this._enableAction)}disable(){return this._disableAction?this._disableAction:(this._disableAction=wi.fadeAction(this.object,0,!1),this._disableAction)}}class qD{constructor(e){u(this,"actions");u(this,"sortedActions");this.actions=[...e]}organize(){this.sortedActions={};for(const e of this.actions){const t=e.id;this.sortedActions[t]||(this.sortedActions[t]=[]),this.sortedActions[t].push(e)}}getActions(e){return this.sortedActions||this.organize(),this.sortedActions[e.uuid]}}const Cv=function(s){return x(s)},x=function(s){if(s===void 0&&(s=null),!Array.isArray(s))s=zU(s);else for(let e=0;e<s.length;e++){const t=s[e];s[e]=zU(t)}return function(e,t){typeof t!="string"&&(t=t.name),Object.getOwnPropertyDescriptor(e,"$serializedTypes")||(e.$serializedTypes={});const i=e.$serializedTypes=e.$serializedTypes||{};i[t]=s}};function zU(s){var e,t;switch((t=(e=s==null?void 0:s.prototype)==null?void 0:e.constructor)==null?void 0:t.name){case"Number":case"String":case"Boolean":return null}return s}class ne extends ge{constructor(){super(...arguments);u(this,"guid")}static isDestroyed(t){return Up(t)}static setActive(t,i,n=!0){t&&(yA(t,i),yw(t),i&&n&&c5(Ot.Current,t))}static isActiveSelf(t){return wv(t)}static isActiveInHierarchy(t){return R5(t)}static markAsInstancedRendered(t,i){P5(t,i)}static isUsingInstancing(t){return pE(t)}static foreachComponent(t,i,n=!0){return Np(t,i,n)}static instantiateSynced(t,i){return t?ID(t,i):null}static instantiate(t,i=null){return Sv(t,i)}static destroySynced(t,i,n=!0){if(!t)return;const r=t;i=i??Ot.Current,p_(r,i.connection,n)}static destroy(t,i=!0){return ba(t,i)}static add(t,i,n){if(!(!t||!i)){if(t===i){console.warn("Can not add object to self",t);return}n||(n=Ot.Current),i.add(t),yA(t,!0),yw(t),n?ne.foreachComponent(t,r=>{TD(r,n),!r.__internalDidAwakeAndStart&&n.new_script_start.includes(r)===!1&&n.new_script_start.push(r)},!0):console.warn("Missing context")}}static remove(t){var i;t&&((i=t.parent)==null||i.remove(t),yA(t,!1),yw(t),ne.foreachComponent(t,n=>{$se(n)},!0))}static invokeOnChildren(t,i,...n){this.invoke(t,i,!0,n)}static invoke(t,i,n=!1,...r){t&&this.foreachComponent(t,o=>{const a=o[i];a&&typeof a=="function"&&(a==null||a.call(o,...r))},n)}static addNewComponent(t,i,n,r=!0){return ya(t,i,n,{callAwake:r})}static addComponent(t,i,n,r){return ya(t,i,n,r)}static moveComponent(t,i){return ya(t,i)}static removeComponent(t){return OD(t.gameObject,t),t}static getOrAddComponent(t,i){return g_(t,i)}static getComponent(t,i){return t===null?null:Xp(t,i)}static getComponents(t,i,n=null){return t===null?n??[]:v_(t,i,n)}static findByGuid(t,i){return A_(t,i)}static findObjectOfType(t,i,n=!0){return dE(t,i??Ot.Current,n)}static findObjectsOfType(t,i){const n=[];return I5(t,n,i),n}static getComponentInChildren(t,i){return y_(t,i)}static getComponentsInChildren(t,i,n=null){return xv(t,i,n??void 0)}static getComponentInParent(t,i){return _0(t,i)}static getComponentsInParent(t,i,n=null){return uE(t,i,n)}static getAllComponents(t){var r;const i=(r=t.userData)==null?void 0:r.components;return i?[...i]:[]}static*iterateComponents(t){var n;const i=(n=t==null?void 0:t.userData)==null?void 0:n.components;if(i&&Array.isArray(i))for(let r=0;r<i.length;r++)yield i[r]}}var Sc;let Te=(Sc=class{constructor(e){u(this,"__context");u(this,"__name");u(this,"gameObject");u(this,"guid","invalid");u(this,"sourceId");u(this,"__didAwake",!1);u(this,"__didStart",!1);u(this,"__didEnable",!1);u(this,"__isEnabled");u(this,"__destroyed",!1);u(this,"_eventListeners",new Map);this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(e)}get isComponent(){return!0}get context(){return this.__context??Ot.Current}set context(e){this.__context=e}get scene(){return this.context.scene}get layer(){var e,t;return(t=(e=this.gameObject)==null?void 0:e.userData)==null?void 0:t.layer}get name(){var e,t;return(e=this.gameObject)!=null&&e.name?this.gameObject.name:(t=this.gameObject)==null?void 0:t.userData.name}set name(e){this.gameObject?(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.name=e,this.__name=e):this.__name=e}get tag(){var e;return(e=this.gameObject)==null?void 0:e.userData.tag}set tag(e){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.tag=e)}get static(){var e;return(e=this.gameObject)==null?void 0:e.userData.static}set static(e){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.static=e)}get hideFlags(){var e;return(e=this.gameObject)==null?void 0:e.userData.hideFlags}get activeAndEnabled(){return!(this.destroyed||this.__isEnabled===!1||!this.__isActiveInHierarchy)}get __isActive(){return this.gameObject.visible}get __isActiveInHierarchy(){if(!this.gameObject)return!1;const e=this.gameObject[nu];return e===void 0?!0:e}set __isActiveInHierarchy(e){this.gameObject&&(this.gameObject[nu]=e)}awake(){}onEnable(){}onDisable(){}onDestroy(){this.__destroyed=!0}startCoroutine(e,t=Wt.Update){return this.context.registerCoroutineUpdate(this,e,t)}stopCoroutine(e,t=Wt.Update){this.context.unregisterCoroutineUpdate(e,t)}get destroyed(){return this.__destroyed}destroy(){this.__destroyed||this.__internalDestroy()}get __internalDidAwakeAndStart(){return this.__didAwake&&this.__didStart}__internalNewInstanceCreated(e){return this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(e),this}_internalInit(e){if(typeof e=="object")for(const t of Object.keys(e)){const i=e[t];typeof i!="function"&&(this[t]=i)}}__internalAwake(){this.__didAwake||(this.__didAwake=!0,this.awake())}__internalStart(){this.__didStart||(this.__didStart=!0,this.start&&this.start())}__internalEnable(e){return this.__destroyed?(Xe()&&console.warn("[Needle Engine Dev] Trying to enable destroyed component"),!1):this.__didAwake?this.__didEnable?(e!==!0&&(this.__isEnabled=!0),!1):(this.__didEnable=!0,this.__isEnabled=!0,this.onEnable(),!0):!1}__internalDisable(e){if(this.__didAwake){if(!this.__didEnable){e!==!0&&(this.__isEnabled=!1);return}this.__didEnable=!1,this.__isEnabled=!1,this.onDisable()}}__internalDestroy(){var e;this.__destroyed||(this.__destroyed=!0,this.__didAwake&&((e=this.onDestroy)==null||e.call(this),this.dispatchEvent(new CustomEvent("destroyed",{detail:this}))),T5(this))}get enabled(){return typeof this.__isEnabled=="boolean"?this.__isEnabled:!0}set enabled(e){if(this.__destroyed){Xe()&&console.warn(`[Needle Engine Dev] Trying to ${e?"enable":"disable"} destroyed component`);return}if(typeof e=="number"&&(e>=.5?e=!0:e=!1),!this.__didAwake){this.__isEnabled=e;return}e?this.__internalEnable():this.__internalDisable()}get worldPosition(){return Qt(this.gameObject)}set worldPosition(e){Os(this.gameObject,e)}setWorldPosition(e,t,i){kp(this.gameObject,e,t,i)}get worldQuaternion(){return qi(this.gameObject)}set worldQuaternion(e){Ka(this.gameObject,e)}setWorldQuaternion(e,t,i,n){KB(this.gameObject,e,t,i,n)}get worldEuler(){return ZB(this.gameObject)}set worldEuler(e){$B(this.gameObject,e)}get worldRotation(){return this.gameObject.worldRotation}set worldRotation(e){this.setWorldRotation(e.x,e.y,e.z,!0)}setWorldRotation(e,t,i,n=!0){c_(this.gameObject,e,t,i,n)}get forward(){return Sc._forward.set(0,0,-1).applyQuaternion(this.worldQuaternion)}get right(){return Sc._right.set(1,0,0).applyQuaternion(this.worldQuaternion)}get up(){return Sc._up.set(0,1,0).applyQuaternion(this.worldQuaternion)}addEventListener(e,t){this._eventListeners[e]=this._eventListeners[e]||[],this._eventListeners[e].push(t)}removeEventListener(e,t){if(!this._eventListeners[e])return;const i=this._eventListeners[e].indexOf(t);i>=0&&this._eventListeners[e].splice(i,1)}dispatchEvent(e){if(!e||!this._eventListeners[e.type])return!1;const t=this._eventListeners[e.type];for(let i=0;i<t.length;i++)t[i](e);return!1}},u(Sc,"_forward",new w),u(Sc,"_right",new w),u(Sc,"_up",new w),Sc);const Vae=Object.freeze(Object.defineProperty({__proto__:null,Behaviour:Te,Component:Te,GameObject:ne},Symbol.toStringTag,{value:"Module"}));var MQ=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class b_ extends Te{constructor(){super(...arguments);u(this,"from");u(this,"to");u(this,"width",0);u(this,"centered",!0);u(this,"_centerPos")}awake(){this._centerPos=new w}update(){if(!this.from||!this.to)return;const t=Qt(this.from).clone(),i=Qt(this.to).clone(),n=t.distanceTo(i);this._centerPos.copy(t),this._centerPos.add(i),this._centerPos.multiplyScalar(.5),Os(this.gameObject,this.centered?this._centerPos:t),this.gameObject.lookAt(Qt(this.to).clone()),this.gameObject.scale.set(this.width,this.width,n)}}MQ([x(ne)],b_.prototype,"from",void 0);MQ([x(ne)],b_.prototype,"to",void 0);var Kp=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Qu=ie("debuganimation");let IQ=class{constructor(){u(this,"x");u(this,"y")}};class qr extends Te{constructor(){super(...arguments);u(this,"playAutomatically",!0);u(this,"randomStartTime",!0);u(this,"minMaxSpeed");u(this,"minMaxOffsetNormalized");u(this,"loop",!0);u(this,"clampWhenFinished",!1);u(this,"_tempAnimationClipBeforeGameObjectExisted",null);u(this,"_tempAnimationsArray");u(this,"mixer");u(this,"_actions");u(this,"_handles")}get isAnimationComponent(){return!0}addClip(t){this.animations||(this.animations=[]),this.animations.push(t)}get time(){if(this.actions){for(const t of this.actions)if(t.isRunning())return t.time}return 0}set time(t){if(this.actions)for(const i of this.actions)i.time=t}get clip(){var t;return(t=this.animations)!=null&&t.length?this.animations[0]:null}set clip(t){if(!this.__didAwake){Qu&&console.warn("Assign clip during serialization",t),this._tempAnimationClipBeforeGameObjectExisted=t;return}t&&(this.gameObject.animations||(this.gameObject.animations=[]),!this.animations.includes(t)&&(this.animations.length>0?this.animations.splice(0,0,t):this.animations.push(t)))}set clips(t){this.animations=t}set animations(t){t==null||!Array.isArray(t)||(this.gameObject?this.gameObject.animations=t:this._tempAnimationsArray=t)}get animations(){return this.gameObject.animations||this._tempAnimationsArray||[]}get actions(){return this._actions}set actions(t){this._actions=t}awake(){this.mixer=void 0,Qu&&console.log("Animation Awake",this.name,this),this._tempAnimationsArray&&(this.animations=this._tempAnimationsArray,this._tempAnimationsArray=void 0),this._tempAnimationClipBeforeGameObjectExisted&&(this.clip=this._tempAnimationClipBeforeGameObjectExisted,this._tempAnimationClipBeforeGameObjectExisted=null),this.actions=[],this._handles=[]}onEnable(){var t;if(this.playAutomatically&&((t=this.animations)==null?void 0:t.length)>0){const i=Math.floor(Math.random()*this.animations.length),n=this.animations[i];this.play(i,{exclusive:!0,fadeDuration:0,startTime:this.randomStartTime?Math.random()*n.duration:0,loop:this.loop,clampWhenFinished:this.clampWhenFinished})}}update(){this.mixer&&(this.mixer.update(this.context.time.deltaTime),this._handles.forEach(t=>t.update()))}onDisable(){this.mixer&&this.mixer.stopAllAction()}onDestroy(){this.context.animations.unregisterAnimationMixer(this.mixer)}getAction(t){var i;return((i=this.actions)==null?void 0:i.find(n=>n.getClip().name===t))||null}get isPlaying(){if(this.actions){for(let t=0;t<this.actions.length;t++)if(this.actions[t].isRunning())return!0}return!1}stopAll(t){if(this.actions)for(const i of this.actions)t!=null&&t.fadeDuration?i.fadeOut(t.fadeDuration):i.stop()}stop(t,i){if(t===void 0){this.stopAll();return}else if(typeof t=="number"){if(t>=this.animations.length){Qu&&console.log("No animation at index",t);return}t=this.animations[t]}else typeof t=="string"&&(t=this.animations.find(r=>r.name===t));if(!t){console.error("Could not find clip",t);return}const n=this.actions.find(r=>r.getClip()===t);if(!n){console.error("Could not find action",t);return}i!=null&&i.fadeDuration?n.fadeOut(i.fadeDuration):n.stop()}pause(t,i=!1){if(t===void 0){for(const r of this.actions)r.paused=!i;return}else if(typeof t=="number"){if(t>=this.animations.length){Qu&&console.log("No animation at index",t);return}t=this.animations[t]}else typeof t=="string"&&(t=this.animations.find(r=>r.name===t));if(!t){console.error("Could not find clip",t);return}const n=this.actions.find(r=>r.getClip()===t);if(!n){console.error("Could not find action",t);return}n.paused=!i}resume(){for(const t of this.actions)t.paused=!1}play(t=0,i){if(Qu&&console.log("PLAY",t),this.ensureMixer(),!this.mixer){Qu&&console.warn("Missing mixer",this);return}t===void 0&&(t=0);let n=t;if(typeof t=="number"){if(t>=this.animations.length){Qu&&console.log("No animation at index",t);return}n=this.animations[t]}else typeof t=="string"&&(n=this.animations.find(o=>o.name===t));if(!n){console.error("Could not find clip",t);return}i||(i={});for(const o of this.actions)if(o.getClip()===n)return this.internalOnPlay(o,i);if(!n.tracks){console.warn("Clip is no AnimationClip",n);return}const r=this.mixer.clipAction(n);return this.actions.push(r),this.internalOnPlay(r,i)}internalOnPlay(t,i){var n=this.actions.find(a=>a===t);if(n===t&&n.isRunning()&&n.time<n.getClip().duration){const a=this.tryFindHandle(t);if(n.paused&&(n.paused=!1),a)return a.waitForFinish()}if(i.loop===void 0&&(i.loop=this.loop),i.clampWhenFinished===void 0&&(i.clampWhenFinished=this.clampWhenFinished),i.minMaxOffsetNormalized===void 0&&this.randomStartTime&&(i.minMaxOffsetNormalized=this.minMaxOffsetNormalized),i.minMaxSpeed===void 0&&(i.minMaxSpeed=this.minMaxSpeed),(i==null?void 0:i.exclusive)??!0)for(const a of this.actions)a!=n&&(i.fadeDuration?a.fadeOut(i.fadeDuration):a.stop());if(i!=null&&i.fadeDuration&&t.fadeIn(i.fadeDuration),t.enabled=!0,(i==null?void 0:i.startTime)!=null)t.time=i.startTime;else if(i!=null&&i.minMaxOffsetNormalized&&i.minMaxOffsetNormalized.x!=0&&i.minMaxOffsetNormalized.y!=0){const a=t.getClip();t.time=et.lerp(i.minMaxOffsetNormalized.x,i.minMaxOffsetNormalized.y,Math.random())*a.duration}else t.time>=t.getClip().duration&&(t.time=0);i!=null&&i.minMaxSpeed?t.timeScale=et.lerp(i.minMaxSpeed.x,i.minMaxSpeed.y,Math.random()):t.timeScale=(i==null?void 0:i.speed)??1,(i==null?void 0:i.loop)!=null?t.loop=i.loop?LP:YA:t.loop=YA,i!=null&&i.clampWhenFinished&&(t.clampWhenFinished=!0),t.paused=!1,t.play(),Qu&&console.log("PLAY",t.getClip().name,t);const o=new Qae(t,this.mixer,i,a=>{this._handles.splice(this._handles.indexOf(o),1)});return this._handles.push(o),o.waitForFinish()}tryFindHandle(t){for(const i of this._handles)if(i.action===t)return i}ensureMixer(){if(!this.mixer){const t="animationMixer";this.gameObject[t]&&(this.mixer=this.gameObject[t]),(!this.mixer||!this.mixer.clipAction)&&(this.mixer=new jC(this.gameObject),this.gameObject[t]=this.mixer)}this.context.animations.registerAnimationMixer(this.mixer)}}Kp([x()],qr.prototype,"playAutomatically",void 0);Kp([x()],qr.prototype,"randomStartTime",void 0);Kp([x(IQ)],qr.prototype,"minMaxSpeed",void 0);Kp([x(IQ)],qr.prototype,"minMaxOffsetNormalized",void 0);Kp([x()],qr.prototype,"loop",void 0);Kp([x()],qr.prototype,"clampWhenFinished",void 0);Kp([x(Ho)],qr.prototype,"clips",null);class Qae{constructor(e,t,i,n){u(this,"mixer");u(this,"action");u(this,"promise",null);u(this,"_options");u(this,"_resolveCallback",null);u(this,"_resolvedOrRejectedCallback");u(this,"onLoop",e=>{});u(this,"onFinished",e=>{e.action===this.action&&this.onResolve()});this.action=e,this.mixer=t,this._resolvedOrRejectedCallback=n,this._options=i}waitForFinish(){return this.promise?this.promise:(this.promise=new Promise(e=>{this._resolveCallback=e}),this.mixer.addEventListener("loop",this.onLoop),this.mixer.addEventListener("finished",this.onFinished),this.promise)}update(){this._options&&this._options.endTime!==void 0&&this.action.time>this._options.endTime&&(this._options.loop===!0?this.action.time=this._options.startTime??0:(this.action.time=this._options.endTime,this.action.timeScale=0,this.onResolve()))}onResolve(){var e,t;this.dispose(),(e=this._resolvedOrRejectedCallback)==null||e.call(this,this),(t=this._resolveCallback)==null||t.call(this,this.action)}dispose(){this.mixer.removeEventListener("loop",this.onLoop),this.mixer.removeEventListener("finished",this.onFinished)}}var Qd=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class Ao{constructor(e=0,t=0){u(this,"time",0);u(this,"value",0);u(this,"inTangent",1/0);u(this,"inWeight");u(this,"outTangent",1/0);u(this,"outWeight");u(this,"weightedMode");this.time=e,this.value=t}}Qd([x()],Ao.prototype,"time",void 0);Qd([x()],Ao.prototype,"value",void 0);Qd([x()],Ao.prototype,"inTangent",void 0);Qd([x()],Ao.prototype,"inWeight",void 0);Qd([x()],Ao.prototype,"outTangent",void 0);Qd([x()],Ao.prototype,"outWeight",void 0);Qd([x()],Ao.prototype,"weightedMode",void 0);class qa{constructor(){u(this,"keys",[])}static linearFromTo(e,t,i){const n=new qa,r=new Ao;r.time=0,r.value=e;const o=new Ao;return o.time=i,o.value=t,n.keys.push(r,o),n}static constant(e){const t=new qa,i=new Ao;return i.time=0,i.value=e,t.keys.push(i),t}clone(){var t;const e=new qa;return e.keys=((t=this.keys)==null?void 0:t.map(i=>{const n=new Ao;return n.time=i.time,n.value=i.value,n.inTangent=i.inTangent,n.inWeight=i.inWeight,n.outTangent=i.outTangent,n.outWeight=i.outWeight,n.weightedMode=i.weightedMode,n}))||[],e}get duration(){return!this.keys||this.keys.length==0?0:this.keys[this.keys.length-1].time}evaluate(e){if(!this.keys||this.keys.length==0)return 0;if(this.keys.length===1)return this.keys[0].value;if(this.keys[0].time>=e)return this.keys[0].value;for(let t=0;t<this.keys.length;t++){const i=this.keys[t];if(i.time<=e)if(t+1<this.keys.length){const r=this.keys[t+1];if(r.time<e)continue;return!isFinite(i.outTangent)||!isFinite(r.inTangent)?i.value:qa.interpolateValue(e,i,r)}else return i.value}return this.keys[this.keys.length-1].value}static interpolateValue(e,t,i){const n=t.time,r=t.value,o=t.outTangent,a=i.time,l=i.value,c=i.inTangent,h=a-n,d=h*h,f=d*h,p=((o+c)*h-2*(l-r))/f,m=(3*(l-r)-(c+2*o)*h)/d,v=o,y=r,g=e-n,_=g*g,A=_*g;return p*A+m*_+v*g+y}}Qd([x(Ao)],qa.prototype,"keys",void 0);const Iw=Symbol("objectIsAnimatedData");function GU(s,e,t){if(!s)return;if(s[Iw]===void 0){if(!t)return;s[Iw]=new Set}const i=s[Iw];t?i.add(e):i.has(e)&&i.delete(e)}function jae(s){if(!s)return!1;const e=s[Iw];return e!==void 0&&e.size>0}class Wae{constructor(){u(this,"_context")}get context(){return this._context??Ot.Current}get isStateMachineBehaviour(){return!0}}class Jy{constructor(e,t,i,n){u(this,"name");u(this,"nameHash");u(this,"normalizedTime");u(this,"length");u(this,"speed");u(this,"action");u(this,"hasTransitions");var r;this.name=e.name,this.nameHash=e.hash,this.normalizedTime=t,this.length=i,this.speed=n,this.action=e.motion.action||null,this.hasTransitions=((r=e.transitions)==null?void 0:r.length)>0||!1}}function RQ(s,e){return{name:"Empty",isLooping:!1,guid:(e==null?void 0:e.generateUUID())??li.generateUUID(),index:-1,clip:new Ho(s,0,[])}}var kh;(function(s){s[s.If=1]="If",s[s.IfNot=2]="IfNot",s[s.Greater=3]="Greater",s[s.Less=4]="Less",s[s.Equals=6]="Equals",s[s.NotEqual=7]="NotEqual"})(kh||(kh={}));var SS;(function(s){s[s.Float=1]="Float",s[s.Int=3]="Int",s[s.Bool=4]="Bool",s[s.Trigger=9]="Trigger"})(SS||(SS={}));const Ss=ie("debuganimatorcontroller"),Cx=ie("debugrootmotion");class Aa{constructor(e){u(this,"_speed",1);u(this,"normalizedStartOffset",0);u(this,"animator");u(this,"model");u(this,"_mixer");u(this,"_activeState");u(this,"_activeStates",[]);u(this,"_heldActions",[]);u(this,"rootMotionHandler");this.model=e,Ss&&console.log(this)}static createFromClips(e,t={looping:!1,autoTransition:!0,transitionDuration:0}){const i=[];for(let o=0;o<e.length;o++){const a=e[o],l=[];if(t.autoTransition!==!1){const h=t.transitionDuration??0,d=h/a.duration;let f=o;(t.autoTransition===void 0||t.autoTransition===!0)&&(f=(o+1)%e.length),l.push({exitTime:1-d,offset:0,duration:h,hasExitTime:!0,destinationState:f,conditions:[]})}const c={name:a.name,hash:o,motion:{name:a.name,clip:a,isLooping:(t==null?void 0:t.looping)??!1},transitions:l,behaviours:[]};i.push(c)}const n={name:"AnimatorController",guid:new Ls(Date.now()).generateUUID(),parameters:[],layers:[{name:"Base Layer",stateMachine:{defaultState:0,states:i}}]};return new Aa(n)}play(e,t=-1,i=Number.NEGATIVE_INFINITY,n=0){if(t<0)t=0;else if(t>=this.model.layers.length){console.warn("invalid layer");return}const o=this.model.layers[t].stateMachine;for(const a of o.states)if(a.name===e||a.hash===e){Ss&&console.log("transition to ",a),this.transitionTo(a,n,i);return}console.warn("Could not find "+e+" to play")}reset(){this.setStartTransition()}setBool(e,t){var n,r;const i=typeof e=="string"?"name":"hash";return(r=(n=this.model)==null?void 0:n.parameters)==null?void 0:r.filter(o=>o[i]===e).forEach(o=>o.value=t)}getBool(e){var i,n,r;const t=typeof e=="string"?"name":"hash";return((r=(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.find(o=>o[t]===e))==null?void 0:r.value)??!1}setFloat(e,t){var r,o;const i=typeof e=="string"?"name":"hash",n=(o=(r=this.model)==null?void 0:r.parameters)==null?void 0:o.filter(a=>a[i]===e);return n.forEach(a=>a.value=t),(n==null?void 0:n.length)>0}getFloat(e){var i,n,r;const t=typeof e=="string"?"name":"hash";return((r=(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.find(o=>o[t]===e))==null?void 0:r.value)??0}setInteger(e,t){var n,r;const i=typeof e=="string"?"name":"hash";return(r=(n=this.model)==null?void 0:n.parameters)==null?void 0:r.filter(o=>o[i]===e).forEach(o=>o.value=t)}getInteger(e){var i,n,r;const t=typeof e=="string"?"name":"hash";return((r=(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.find(o=>o[t]===e))==null?void 0:r.value)??0}setTrigger(e){var i,n;Ss&&console.log("SET TRIGGER",e);const t=typeof e=="string"?"name":"hash";return(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.filter(r=>r[t]===e).forEach(r=>r.value=!0)}resetTrigger(e){var i,n;const t=typeof e=="string"?"name":"hash";return(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.filter(r=>r[t]===e).forEach(r=>r.value=!1)}getTrigger(e){var i,n,r;const t=typeof e=="string"?"name":"hash";return((r=(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.find(o=>o[t]===e))==null?void 0:r.value)??!1}isInTransition(){return this._activeStates.length>1}setSpeed(e){this._speed=e}FindState(e){return this.findState(e)}findState(e){if(!e)return null;if(Array.isArray(this.model.layers)){for(const t of this.model.layers)for(const i of t.stateMachine.states)if(i.name===e||i.hash==e)return i}return null}getCurrentStateInfo(){if(!this._activeState)return null;const e=this._activeState.motion.action;if(!e)return null;const t=this._activeState.motion.clip.duration,i=t<=0?0:Math.abs(e.time/t);return new Jy(this._activeState,i,t,this._speed)}get currentAction(){if(!this._activeState)return null;const e=this._activeState.motion.action;return e||null}get context(){var e;return(e=this.animator)==null?void 0:e.context}get mixer(){return this._mixer}dispose(){var e;if(this._mixer.stopAllAction(),this.animator){this._mixer.uncacheRoot(this.animator.gameObject);for(const t of this._activeStates)t.motion.clip&&this.mixer.uncacheAction(t.motion.clip,this.animator.gameObject)}(e=this.context)==null||e.animations.unregisterAnimationMixer(this._mixer)}bind(e){var t,i;e?this.animator!==e&&(this._mixer&&(this._mixer.stopAllAction(),(t=this.context)==null||t.animations.unregisterAnimationMixer(this._mixer)),this.animator=e,this._mixer=new jC(this.animator.gameObject),(i=this.context)==null||i.animations.registerAnimationMixer(this._mixer),this.createActions(this.animator)):console.error("AnimatorController.bind: animator is null")}clone(){if(typeof this.model=="string")return console.warn("AnimatorController has not been resolved, can not create model from string",this.model),null;Ss&&console.warn("AnimatorController clone()",this.model);const e=s_(this.model,(i,n,r)=>r==null?!0:!(r.type==="Object3D"||r.isObject3D===!0||$G(r)||r.tracks!==void 0||r instanceof Aa));return console.assert(e!==this.model),new Aa(e)}update(e){var i,n;if(!this.animator)return;this.evaluateTransitions(),this.updateActiveStates(e);const t=this.animator.context.time.deltaTime;this.animator.applyRootMotion&&((i=this.rootMotionHandler)==null||i.onBeforeUpdate(e)),this._mixer.update(t),this.animator.applyRootMotion&&((n=this.rootMotionHandler)==null||n.onAfterUpdate(e))}get activeState(){return this._activeState}updateActiveStates(e){for(let t=0;t<this._activeStates.length;t++){const i=this._activeStates[t],n=i.motion;if(!n.action)this._activeStates.splice(t,1),t--;else{const r=n.action;r.weight=e,r.getEffectiveWeight()<=0&&!r.isRunning()&&(Ss&&console.debug("REMOVE",i.name,r.getEffectiveWeight(),r.isRunning(),r.isScheduled()),this._activeStates.splice(t,1),t--)}}}setStartTransition(){var e;this.model.layers.length>1&&(Ss||Xe())&&console.warn("Multiple layers are not supported yet "+((e=this.animator)==null?void 0:e.name));for(const t of this.model.layers){const i=t.stateMachine;i.defaultState===void 0&&(Ss&&console.warn("AnimatorController default state is undefined, will assign state 0 as default",t),i.defaultState=0);const n=i.states[i.defaultState];this.transitionTo(n,0,this.normalizedStartOffset);break}}evaluateTransitions(){var r;let e=!1;if(!this._activeState){if(this.setStartTransition(),!this._activeState)return;e=!0}const t=this._activeState,i=t.motion.action;for(const o of t.transitions){if(!o.hasExitTime&&o.conditions.length<=0)continue;let a=!0;for(const l of o.conditions)if(!this.evaluateCondition(l)){a=!1;break}if(a)if(i){const l=t.motion.clip.duration,c=l<=0?1:Math.abs(i.time/l);let h=o.exitTime;i.timeScale<0&&(h=1-h);let d=!1;if(o.hasExitTime?i.timeScale>0?d=c>=o.exitTime:i.timeScale<0&&(d=1-c>=o.exitTime):d=!0,d){for(const f of o.conditions){const p=this.model.parameters.find(m=>m.name===f.parameter);(p==null?void 0:p.type)===SS.Trigger&&p.value&&(p.value=!1)}if(i.clampWhenFinished=!0,Ss){const f=this.getState(o.destinationState,0);console.log(`Transition to ${o.destinationState} / ${f==null?void 0:f.name}`,o,`
Timescale: `+i.timeScale,`
Normalized time: `+c.toFixed(3),`
Exit Time: `+h,o.hasExitTime)}this.transitionTo(o.destinationState,o.duration,o.offset);return}}else{this.transitionTo(o.destinationState,o.duration,o.offset);return}}i&&this.setTimescale(i,t);let n=!1;if(t.motion.isLooping&&i&&(i.time>=i.getClip().duration?(n=!0,i.reset(),i.time=0,i.play()):i.time<=0&&i.timeScale<0&&(n=!0,i.reset(),i.time=i.getClip().duration,i.play())),!n&&t&&!e&&i&&this.animator&&t.behaviours){const o=i==null?void 0:i.getClip().duration,a=i.time/o,l=new Jy(this._activeState,a,o,this._speed);for(const c of t.behaviours)c.instance&&((r=c.instance.onStateUpdate)==null||r.call(c.instance,this.animator,l,0))}}setTimescale(e,t){let i=t.speed??1;t.speedParameter&&(i*=this.getFloat(t.speedParameter)),i!==void 0&&(e.timeScale=i*this._speed)}getState(e,t){return typeof e=="number"&&(e==-1&&(e=this.model.layers[t].stateMachine.defaultState,e===void 0&&(Ss&&console.warn("AnimatorController default state is undefined: ",this.model,"Layer: "+t),e=0)),e=this.model.layers[t].stateMachine.states[e]),e}releaseHeldActions(e){for(const t of this._heldActions)t.fadeOut(e);this._heldActions.length=0}transitionTo(e,t,i){var h,d,f,p,m,v,y,g;if(!this.animator)return;const n=0;if(e=this.getState(e,n),!(e!=null&&e.motion)||!e.motion.clip||!(e.motion.clip instanceof Ho))return;const r=this._activeState===e;if(r){const _=e.motion;if(!_.action_loopback&&_.clip){const A=this.rootMotionHandler?this.animator.gameObject.matrix.clone():null;this._mixer.uncacheAction(_.clip,this.animator.gameObject),A&&A.decompose(this.animator.gameObject.position,this.animator.gameObject.quaternion,this.animator.gameObject.scale),_.action_loopback=this.createAction(_.clip)}}if((h=this._activeState)!=null&&h.behaviours&&this._activeState.motion.action){const _=(d=this._activeState)==null?void 0:d.motion.clip.duration,A=this._activeState.motion.action.time/_,b=new Jy(this._activeState,A,_,this._speed);for(const E of this._activeState.behaviours)(p=(f=E.instance)==null?void 0:f.onStateExit)==null||p.call(E.instance,this.animator,b,n)}const o=(m=this._activeState)==null?void 0:m.motion.action;r&&(e.motion.action=e.motion.action_loopback,e.motion.action_loopback=o);const a=this._activeState;this._activeState=e;const l=(v=e.motion)==null?void 0:v.action,c=e.motion.clip;if((c==null?void 0:c.duration)<=0&&c.tracks.length<=0?o&&this._heldActions.push(o):o&&(o.fadeOut(t),this.releaseHeldActions(t)),l){if(i=Math.max(0,Math.min(1,i)),e.cycleOffsetParameter){let A=this.getFloat(e.cycleOffsetParameter);typeof A=="number"?(A<0&&(A+=1),i+=A,i%=1):Ss&&console.warn("AnimatorController cycle offset parameter is not a number",e.cycleOffsetParameter)}else typeof e.cycleOffset=="number"&&(i+=e.cycleOffset,i%=1);l.isRunning()&&l.stop(),l.reset(),l.enabled=!0,this.setTimescale(l,e);const _=e.motion.clip.duration;if(l.time=r?0:i*_,l.timeScale<0&&(l.time=_-l.time),l.clampWhenFinished=!0,l.setLoop(YA,0),t>0?l.fadeIn(t):l.weight=1,l.play(),this.rootMotionHandler&&this.rootMotionHandler.onStart(l),this._activeStates.includes(e)||this._activeStates.push(e),this._activeState.behaviours){const A=new Jy(e,i,_,this._speed);for(const b of this._activeState.behaviours)(g=(y=b.instance)==null?void 0:y.onStateEnter)==null||g.call(b.instance,this.animator,A,n)}}else Ss&&(e.__warned_no_motion||(e.__warned_no_motion=!0,console.warn("No action",e.motion,this)));Ss&&console.log("TRANSITION FROM "+(a==null?void 0:a.name)+" TO "+e.name,t,o,l,l==null?void 0:l.getEffectiveTimeScale(),l==null?void 0:l.getEffectiveWeight(),l==null?void 0:l.isRunning(),l==null?void 0:l.isScheduled(),l==null?void 0:l.paused)}createAction(e){var i,n;if(this._mixer.existingAction(e)&&this._mixer.uncacheAction(e,(i=this.animator)==null?void 0:i.gameObject),(n=this.animator)!=null&&n.applyRootMotion){this.rootMotionHandler||(this.rootMotionHandler=new qae(this));const r=this.animator.gameObject;return this.rootMotionHandler.createClip(this._mixer,r,e)}else return this._mixer.clipAction(e)}evaluateCondition(e){const t=this.model.parameters.find(i=>i.name===e.parameter);if(!t)return!1;switch(e.mode){case kh.If:return t.value===!0;case kh.IfNot:return t.value===!1;case kh.Greater:return t.value>e.threshold;case kh.Less:return t.value<e.threshold;case kh.Equals:return t.value===e.threshold;case kh.NotEqual:return t.value!==e.threshold}return!1}createActions(e){var t,i,n,r;Ss&&console.log("AnimatorController createActions",this.model);for(const o of this.model.layers){const a=o.stateMachine;for(let l=0;l<a.states.length;l++){const c=a.states[l];c.transitions||(c.transitions=[]);for(const h of c.transitions)h.conditions||(h.conditions=[]);if(c.motion||(Ss&&console.warn("No motion",c),c.motion=RQ(c.name)),this.animator&&c.motion.clips){const h=(t=c.motion.clips)==null?void 0:t.find(d=>{var f,p;return d.node.name===((p=(f=this.animator)==null?void 0:f.gameObject)==null?void 0:p.name)});h?c.motion.clip=h.clip:(Ss||Xe())&&console.warn('Could not find clip for animator "'+((n=(i=this.animator)==null?void 0:i.gameObject)==null?void 0:n.name)+'"',c.motion.clips.map(d=>d.node.name))}if(!c.motion.clip){Ss&&console.warn("No clip assigned to state",c);const h=new Ho(void 0,void 0,[]);c.motion.clip=h}if((r=c.motion)!=null&&r.clip){const h=c.motion.clip;if(h instanceof Ho){const d=this.createAction(h);c.motion.action=d}else(Ss||Xe())&&console.warn("No valid animationclip assigned",c)}if(c.behaviours&&Array.isArray(c.behaviours))for(const h of c.behaviours){if(!(h!=null&&h.typeName))continue;const d=X.get(h.typeName);if(d){const f=new d;f.isStateMachineBehaviour&&(f._context=this.context??void 0,iv(f,h.properties),h.instance=f),Ss&&console.log("Created animator controller behaviour",c.name,h.typeName,h.properties,f)}else(Ss||Xe())&&console.warn("Could not find AnimatorBehaviour type: "+h.typeName)}}}}*enumerateActions(){if(this.model.layers)for(const e of this.model.layers){const t=e.stateMachine;for(let i=0;i<t.states.length;i++){const n=t.states[i];n!=null&&n.motion&&(n.motion.action&&(yield n.motion.action),n.motion.action_loopback&&(yield n.motion.action_loopback))}}}}class HU{constructor(e,t){u(this,"track");u(this,"createdInterpolant");u(this,"originalEvaluate");u(this,"customEvaluate");this.track=e;const i=e,n=i.createInterpolant.bind(e);i.createInterpolant=()=>(i.createInterpolant=n,this.createdInterpolant=n(),this.originalEvaluate=this.createdInterpolant.evaluate.bind(this.createdInterpolant),this.customEvaluate=r=>{if(!this.originalEvaluate)return;const o=this.originalEvaluate(r);return t(r,o)},this.createdInterpolant.evaluate=this.customEvaluate,this.createdInterpolant)}dispose(){this.createdInterpolant&&this.originalEvaluate&&(this.createdInterpolant.evaluate=this.originalEvaluate),this.track=void 0,this.createdInterpolant=null,this.originalEvaluate=void 0,this.customEvaluate=void 0}}const Ms=class{constructor(e,t,i,n,r){u(this,"_action");u(this,"root");u(this,"clip");u(this,"positionWrapper",null);u(this,"rotationWrapper",null);u(this,"context");u(this,"positionChange",new w);u(this,"rotationChange",new xe);u(this,"_prevTime",0);if(this.context=e,this.root=t,this.clip=i,Ms.firstKeyframeRotation[this.cacheId]||(Ms.firstKeyframeRotation[this.cacheId]=new xe),r){const o=r.values;Ms.firstKeyframeRotation[this.cacheId].set(o[0],o[1],o[2],o[3])}Ms.spaceRotation[this.cacheId]||(Ms.spaceRotation[this.cacheId]=new xe),Ms.effectiveSpaceRotation[this.cacheId]||(Ms.effectiveSpaceRotation[this.cacheId]=new xe),Ms.clipOffsetRotation[this.cacheId]=new xe,r&&Ms.clipOffsetRotation[this.cacheId].set(r.values[0],r.values[1],r.values[2],r.values[3]).invert(),this.handlePosition(i,n),this.handleRotation(i,r)}set action(e){this._action=e}get action(){return this._action}get cacheId(){return this.root.uuid}onStart(e){if(e.getClip()!==this.clip)return;Ms.lastObjRotation[this.cacheId]||(Ms.lastObjRotation[this.cacheId]=this.root.quaternion.clone());const t=Ms.lastObjRotation[this.cacheId];if(Ms.spaceRotation[this.cacheId].copy(t),Cx){const i=new oi().setFromQuaternion(t);console.log("START",this.clip.name,et.toDegrees(i.y),this.root.position.z)}}getClipRotationOffset(){return Ms.clipOffsetRotation[this.cacheId]}handlePosition(e,t){if(t){const i=this.root;Cx&&i.add(new xo),Ms.lastObjPosition[this.cacheId]||(Ms.lastObjPosition[this.cacheId]=this.root.position.clone());const n=new w,r=new w;this.positionWrapper=new HU(t,(o,a)=>{const l=this.action.getEffectiveWeight();return Cx&&i.position.length()>8&&i.position.set(0,i.position.y,0),o>this._prevTime&&(n.set(a[0],a[1],a[2]),n.sub(r),n.multiplyScalar(l),n.applyQuaternion(this.getClipRotationOffset()),n.applyQuaternion(i.quaternion),this.positionChange.copy(n)),r.fromArray(a),this._prevTime=o,a[0]=0,a[1]=0,a[2]=0,a})}}handleRotation(e,t){if(t){if(Cx){const o=t.values,a=new oi().setFromQuaternion(new xe(o[0],o[1],o[2],o[3]));console.log(e.name,t.name,"FIRST ROTATION IN TRACK",et.toDegrees(a.y));const l=t.values.length-4,c=new xe().set(o[l],o[l+1],o[l+2],o[l+3]),h=new oi().setFromQuaternion(c);console.log(e.name,t.name,"LAST ROTATION IN TRACK",et.toDegrees(h.y))}let i=0;const n=new xe,r=new xe;this.rotationWrapper=new HU(t,(o,a)=>(o>i&&(r.set(a[0],a[1],a[2],a[3]),n.invert(),r.multiply(n),this.rotationChange.copy(r)),n.fromArray(a),i=o,a[0]=0,a[1]=0,a[2]=0,a[3]=1,a))}}onBeforeUpdate(e){this.positionChange.set(0,0,0),this.rotationChange.set(0,0,0,1)}onAfterUpdate(e){return!this.action||(e*=this.action.getEffectiveWeight(),e<=0)?!1:(this.positionChange.multiplyScalar(e),this.rotationChange.slerp(Ms.identityQuaternion,1-e),!0)}};let nc=Ms;u(nc,"lastObjPosition",{}),u(nc,"lastObjRotation",{}),u(nc,"firstKeyframeRotation",{}),u(nc,"spaceRotation",{}),u(nc,"effectiveSpaceRotation",{}),u(nc,"clipOffsetRotation",{}),u(nc,"identityQuaternion",new xe);class qae{constructor(e){u(this,"controller");u(this,"handler",[]);u(this,"root");u(this,"basePosition",new w);u(this,"baseQuaternion",new xe);u(this,"baseRotation",new oi);u(this,"summedPosition",new w);u(this,"summedRotation",new xe);this.controller=e}createClip(e,t,i){this.root=t,t&&"name"in t&&t.name;const n=this.findRootTrack(i,".position"),r=this.findRootTrack(i,".quaternion"),o=new nc(this.controller.context,t,i,n,r);this.handler.push(o);const a=e.clipAction(i);return o.action=a,a}onStart(e){for(const t of this.handler)t.onStart(e)}onBeforeUpdate(e){this.basePosition.copy(this.root.position),this.baseQuaternion.copy(this.root.quaternion);for(const t of this.handler)t.onBeforeUpdate(e)}onAfterUpdate(e){if(!(e<=0)){this.root.position.copy(this.basePosition),this.root.quaternion.copy(this.baseQuaternion),this.summedPosition.set(0,0,0),this.summedRotation.set(0,0,0,1);for(const t of this.handler)t.onAfterUpdate(e)&&(this.summedPosition.add(t.positionChange),this.summedRotation.multiply(t.rotationChange));this.root.position.add(this.summedPosition),this.root.quaternion.multiply(this.summedRotation)}}findRootTrack(e,t){const i=e.tracks;if(!i)return null;for(const n of i)if(n.name.endsWith(t))return n;return null}}class Xae extends tl{onSerialize(e,t){}onDeserialize(e,t){if(t.type===Aa&&(e==null?void 0:e.__type)==="AnimatorController")return new Aa(e)}}new Xae(Aa);var xE=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Ba=ie("debuganimator");class Cr extends Te{constructor(){super(...arguments);u(this,"applyRootMotion",!1);u(this,"hasRootMotion",!1);u(this,"keepAnimatorControllerStateOnDisable",!1);u(this,"_parametersAreDirty",!1);u(this,"_isDirty",!1);u(this,"_speed",1);u(this,"_normalizedStartOffset",0);u(this,"_animatorController",null);u(this,"_initializeWithRuntimeAnimatorController")}get isAnimationComponent(){return!0}set runtimeAnimatorController(t){var i;this._animatorController&&this._animatorController.model===t||(t?t instanceof Aa?(t.animator&&t.animator!==this&&(console.warn("AnimatorController can not be bound to multiple animators",(i=t.model)==null?void 0:i.name),t.model||console.error("AnimatorController has no model"),t=new Aa(t.model)),this._animatorController=t,this._animatorController.bind(this)):(Ba&&console.log("Assign animator controller",t,this),this._animatorController=new Aa(t),this.__didAwake&&this._animatorController.bind(this)):this._animatorController=null)}get runtimeAnimatorController(){return this._animatorController}getCurrentStateInfo(){var t;return(t=this.runtimeAnimatorController)==null?void 0:t.getCurrentStateInfo()}get currentAction(){var t;return((t=this.runtimeAnimatorController)==null?void 0:t.currentAction)||null}get parametersAreDirty(){return this._parametersAreDirty}get isDirty(){return this._isDirty}Play(t,i=-1,n=Number.NEGATIVE_INFINITY,r=0){this.play(t,i,n,r)}play(t,i=-1,n=Number.NEGATIVE_INFINITY,r=0){var o;(o=this.runtimeAnimatorController)==null||o.play(t,i,n,r),this._isDirty=!0}Reset(){this.reset()}reset(){var t;(t=this._animatorController)==null||t.reset(),this._isDirty=!0}SetBool(t,i){this.setBool(t,i)}setBool(t,i){var n,r;Ba&&console.log("setBool",t,i),((n=this.runtimeAnimatorController)==null?void 0:n.getBool(t))!==i&&(this._parametersAreDirty=!0),(r=this.runtimeAnimatorController)==null||r.setBool(t,i)}GetBool(t){return this.getBool(t)}getBool(t){var n;const i=((n=this.runtimeAnimatorController)==null?void 0:n.getBool(t))??!1;return Ba&&console.log("getBool",t,i),i}toggleBool(t){this.setBool(t,!this.getBool(t))}SetFloat(t,i){this.setFloat(t,i)}setFloat(t,i){var n,r;((n=this.runtimeAnimatorController)==null?void 0:n.getFloat(t))!==i&&(this._parametersAreDirty=!0),Ba&&console.log("setFloat",t,i),(r=this.runtimeAnimatorController)==null||r.setFloat(t,i)}GetFloat(t){return this.getFloat(t)}getFloat(t){var n;const i=((n=this.runtimeAnimatorController)==null?void 0:n.getFloat(t))??-1;return Ba&&console.log("getFloat",t,i),i}SetInteger(t,i){this.setInteger(t,i)}setInteger(t,i){var n,r;((n=this.runtimeAnimatorController)==null?void 0:n.getInteger(t))!==i&&(this._parametersAreDirty=!0),Ba&&console.log("setInteger",t,i),(r=this.runtimeAnimatorController)==null||r.setInteger(t,i)}GetInteger(t){return this.getInteger(t)}getInteger(t){var n;const i=((n=this.runtimeAnimatorController)==null?void 0:n.getInteger(t))??-1;return Ba&&console.log("getInteger",t,i),i}SetTrigger(t){this.setTrigger(t)}setTrigger(t){var i;this._parametersAreDirty=!0,Ba&&console.log("setTrigger",t),(i=this.runtimeAnimatorController)==null||i.setTrigger(t)}ResetTrigger(t){this.resetTrigger(t)}resetTrigger(t){var i;this._parametersAreDirty=!0,Ba&&console.log("resetTrigger",t),(i=this.runtimeAnimatorController)==null||i.resetTrigger(t)}GetTrigger(t){this.getTrigger(t)}getTrigger(t){var n;const i=(n=this.runtimeAnimatorController)==null?void 0:n.getTrigger(t);return Ba&&console.log("getTrigger",t,i),i}IsInTransition(){return this.isInTransition()}isInTransition(){var t;return((t=this.runtimeAnimatorController)==null?void 0:t.isInTransition())??!1}SetSpeed(t){return this.setSpeed(t)}setSpeed(t){var i;t!==this._speed&&(Ba&&console.log("setSpeed",t),this._speed=t,((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(t))}set minMaxSpeed(t){var i;this._speed=et.lerp(t.x,t.y,Math.random()),((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(this._speed)}set minMaxOffsetNormalized(t){var i;this._normalizedStartOffset=et.lerp(t.x,t.y,Math.random()),((i=this.runtimeAnimatorController)==null?void 0:i.animator)==this&&(this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset)}awake(){Ba&&console.log("ANIMATOR",this.name,this),this.gameObject&&this.initializeRuntimeAnimatorController()}initializeRuntimeAnimatorController(t=!1){const i=t||this.runtimeAnimatorController!==this._initializeWithRuntimeAnimatorController;if(this.runtimeAnimatorController&&i){const n=this.runtimeAnimatorController.clone();this._initializeWithRuntimeAnimatorController=n,n?(console.assert(this.runtimeAnimatorController!==n),this.runtimeAnimatorController=n,console.assert(this.runtimeAnimatorController===n),this.runtimeAnimatorController.bind(this),this.runtimeAnimatorController.setSpeed(this._speed),this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset):console.warn("Could not clone animator controller",this.runtimeAnimatorController)}}onDisable(){var t;this.keepAnimatorControllerStateOnDisable||(t=this._animatorController)==null||t.reset()}onBeforeRender(){this._isDirty=!1,this._parametersAreDirty=!1,!jae(this.gameObject)&&this._animatorController&&this._animatorController.update(1)}}xE([x()],Cr.prototype,"applyRootMotion",void 0);xE([x()],Cr.prototype,"hasRootMotion",void 0);xE([x()],Cr.prototype,"keepAnimatorControllerStateOnDisable",void 0);xE([x()],Cr.prototype,"runtimeAnimatorController",null);const gc=ie("debugusdzanimation"),WR=ie("debugusdzanimationserialization");class eu{constructor(e,t,i){u(this,"_start");u(this,"ext");u(this,"root");u(this,"_nearestAnimatedRoot");u(this,"clip");u(this,"speed");this.ext=e,this.root=t,this.clip=i,this._nearestAnimatedRoot=this.getNearestAnimatedRoot()}get start(){return this._start===void 0&&(this._start=this.ext.getStartTimeByClip(this.clip)),this._start}get duration(){var e;return((e=this.clip)==null?void 0:e.duration)??mn.restPoseClipDuration}get nearestAnimatedRoot(){return this._nearestAnimatedRoot}get clipName(){var e;return((e=this.clip)==null?void 0:e.name)??"rest"}static isDescendantOf(e,t){let i=t;if(!i||!e)return!1;for(;i;){if(!i)return!1;if(i===e)return!0;i=i.parent}return!1}getNearestAnimatedRoot(){var t;let e;try{for(const i of((t=this.clip)==null?void 0:t.tracks)??[]){const n=Xt.parseTrackName(i.name);let r=Xt.findNode(this.root,n.nodeName);if(r)if(!e)e=r;else{if(r===e||eu.isDescendantOf(e,r))continue;if(!eu.isDescendantOf(r,e)){for(;!eu.isDescendantOf(r,e)&&r.parent;)r=r.parent;eu.isDescendantOf(r,e)||console.error("USDZExporter: Animation clip targets multiple roots that are not parent/child. Please report a bug",this.root,this.clip,e,r)}e=r}}}catch(i){console.error("USDZExporter: Exception when trying to find nearest animated root. Please report a bug",i),e=void 0}return e}}const HA=class{constructor(e,t,i){u(this,"clip");u(this,"pos");u(this,"rot");u(this,"scale");u(this,"root");u(this,"target");u(this,"duration",0);u(this,"useRootMotion",!1);if(this.root=e,this.target=t,this.clip=i,i?this.duration=i.duration:this.duration=HA.restPoseClipDuration,i&&i.tracks){const r=Math.max(...i.tracks.map(o=>o.times[o.times.length-1]));r!==this.duration&&(console.warn("USDZExporter: Animation clip duration does not match the maximum time value in the tracks.",i,r,this.duration),this.duration=r)}const n=ne.getComponent(e,Cr);n&&(this.useRootMotion=n.applyRootMotion)}addTrack(e){var t,i;if(!this.clip){console.error("This is a rest clip but you're trying to add tracks to it – this is likely a bug");return}e.name.endsWith("position")?this.pos=e:e.name.endsWith("quaternion")?this.rot=e:e.name.endsWith("scale")?this.scale=e:(e.name.endsWith("activeSelf")?console.warn("[USDZ] Animation of enabled/disabled state is not supported for USDZ export and will NOT be exported: "+e.name+" on "+(((t=this.root)==null?void 0:t.name)??this.target.name)+". Animate scale 0/1 instead."):console.warn("[USDZ] Animation track type not supported for USDZ export and will NOT be exported: "+e.name+" on "+(((i=this.root)==null?void 0:i.name)??this.target.name)+". Only .position, .rotation, .scale are supported."),Xe()&&Yi("[USDZ] Some animations can't be exported. See console for details."))}getFrames(){var e,t,i,n,r,o;return this.clip?Math.max(((t=(e=this.pos)==null?void 0:e.times)==null?void 0:t.length)??0,((n=(i=this.rot)==null?void 0:i.times)==null?void 0:n.length)??0,((o=(r=this.scale)==null?void 0:r.times)==null?void 0:o.length)??0):2}getDuration(){return this.duration}getSortedTimesArray(e=!0,t=!0,i=!0){var l,c,h;if(!this.clip)return[0,this.duration];const n=(l=this.pos)==null?void 0:l.times,r=(c=this.rot)==null?void 0:c.times,o=(h=this.scale)==null?void 0:h.times,a=[];if(e&&n)for(const d of n)a.push(d);if(t&&r)for(const d of r)a.push(d);if(i&&o)for(const d of o)a.push(d);return a.includes(0)||a.push(0),a.sort((d,f)=>d-f),[...new Set(a)]}*getValues(e,t=!0,i=!0,n=!0){var p,m,v;const r=new w,o=new xe,a=new w(1,1,1),l=this.target,c=t?(p=this.pos)==null?void 0:p.createInterpolant():void 0,h=i?(m=this.rot)==null?void 0:m.createInterpolant():void 0,d=n?(v=this.scale)==null?void 0:v.createInterpolant():void 0;c||r.set(l.position.x,l.position.y,l.position.z),h||o.set(l.quaternion.x,l.quaternion.y,l.quaternion.z,l.quaternion.w),d||a.set(l.scale.x,l.scale.y,l.scale.z),c&&c.valueSize!==3&&(c.valueSize=3),h&&h.valueSize!==4&&(h.valueSize=4),d&&d.valueSize!==3&&(d.valueSize=3);const f=0;for(let y=0-f;y<e.length+f;y++){let g=0,_=0;if(y<0?(g=e[0],_=g-HA.animationDurationPadding/2+1/60):y>=e.length?(g=e[e.length-1],_=g+HA.animationDurationPadding/2-1/60):(g=e[y],_=g),c){const A=c.evaluate(g);r.set(A[0],A[1],A[2])}if(h){const A=h.evaluate(g);o.set(A[0],A[1],A[2],A[3])}if(d){const A=d.evaluate(g);a.set(A[0],A[1],A[2])}if(this.useRootMotion&&l===this.root){const A=new fe;A.compose(r,o,a),A.multiply(l.matrix),A.decompose(r,o,a)}yield{time:_,translation:r,rotation:o,scale:a,index:y}}}};let mn=HA;u(mn,"frameRate",60),u(mn,"animationDurationPadding",6/60),u(mn,"restPoseClipDuration",6/60);class x_{constructor(e){u(this,"dict",new Map);u(this,"rootTargetMap",new Map);u(this,"rootAndClipToRegisteredAnimationMap",new Map);u(this,"rootToRegisteredClip",new Map);u(this,"lastClipEndTime",0);u(this,"clipToStartTime",new Map);u(this,"clipToHoldClip",new Map);u(this,"serializers",[]);u(this,"injectRestPoses",!1);u(this,"injectImplicitBehaviours",!1);this.injectRestPoses=e,this.injectImplicitBehaviours=e}get extensionName(){return"animation"}get animationData(){return this.dict}get registeredClips(){return this.clipToStartTime.keys()}get animatedRoots(){return this.rootTargetMap.keys()}get holdClipMap(){return this.clipToHoldClip}getStartTimeCode(){return!this.injectRestPoses||this.rootAndClipToRegisteredAnimationMap.size===0?0:(mn.restPoseClipDuration+mn.animationDurationPadding)*60}getEndTimeCode(){let e=0;for(const[t,i]of this.rootAndClipToRegisteredAnimationMap){const n=i.start+i.duration;n>e&&(e=n)}return e*60}getClipCount(e){var i;return((i=this.rootToRegisteredClip.get(e))==null?void 0:i.length)??0??0}getStartTimeByClip(e){return e?this.clipToStartTime.has(e)?this.clipToStartTime.get(e):(console.error("USDZExporter: Missing start time for clip – please report a bug.",e),0):0}registerAnimation(e,t){var c;if(!e)return null;this.rootTargetMap.has(e)||this.rootTargetMap.set(e,[]);const i=e.uuid+((t==null?void 0:t.uuid)??"-rest");if(this.rootAndClipToRegisteredAnimationMap.has(i))return this.rootAndClipToRegisteredAnimationMap.get(i);gc&&console.log("registerAnimation",e,t);const n=this.injectRestPoses?1:0,r=(((c=this.rootToRegisteredClip.get(e))==null?void 0:c.length)??0)+n,o=this.rootTargetMap.get(e),a=new Set(o);if(t&&t.tracks)for(const h of t.tracks){const d=Xt.parseTrackName(h.name),f=Xt.findNode(e,d.nodeName);if(!f){console.warn("no object found for track",h.name,"using "+e.name+" instead");continue}this.dict.has(f)||this.dict.set(f,[]);const p=this.dict.get(f);if(!p){console.warn("no transform data found for target ",f,"at slot "+r+", this is likely a bug");continue}a.delete(f),this.injectRestPoses&&!p[0]&&(console.log("Injecting rest pose",f,t,"at slot",r),p[0]=new mn(null,f,null));let m=p[r];m||(m=new mn(e,f,t),p[r]=m),m.addTrack(h),o!=null&&o.includes(f)||o==null||o.push(f)}gc&&console.log("Unregistered nodes for this clip",a,"clip",t,"at slot",r,"for root",e,"targets",o);for(const h of a){const d=this.dict.get(h);if(!d)continue;if(this.injectRestPoses&&!d[0]){console.warn("Adding rest pose for ",h,t,"at slot",r,"This is likely a bug, should have been added earlier.");const p=new mn(null,h,null);d[0]=p}let f=d[r];f||(gc&&console.log("Adding padding clip for ",h,t,"at slot",r),f=new mn(e,h,t),d[r]=f)}const l=new eu(this,e,t);if(this.rootAndClipToRegisteredAnimationMap.set(i,l),gc&&console.log({root:e,clip:t,info:l}),t){const h=this.rootToRegisteredClip.get(e);if(h?h.push(t):this.rootToRegisteredClip.set(e,[t]),!this.clipToStartTime.get(t)){this.lastClipEndTime==null&&(this.lastClipEndTime=mn.restPoseClipDuration);let f=this.lastClipEndTime+mn.animationDurationPadding,p=f+t.duration;const m=Math.round(f*60)/60,v=Math.round(p*60)/60;Math.abs(m-f)<.01&&(f=m),Math.abs(v-p)<.01&&(p=v),f=Math.ceil(f),p=f+t.duration,this.clipToStartTime.set(t,f),this.lastClipEndTime=p}}return l}onAfterHierarchy(e){gc&&console.log("Animation clips per animation target node",this.dict)}onAfterBuildDocument(e){var t,i;gc&&console.log("Animation data",{dict:this.dict,rootTargetMap:this.rootTargetMap,rootToRegisteredClip:this.rootToRegisteredClip});for(const n of this.rootTargetMap.keys()){const r=this.rootTargetMap.get(n);if(!r)continue;let o;const a=[];for(const l of r){const c=this.dict.get(l);if(!c){console.error("No data found for target on USDZ export – please report a bug!",l);continue}o===void 0&&(o=c==null?void 0:c.length),o!==(c==null?void 0:c.length)&&console.error("Different array lengths for targets – please report a bug!",c);for(let h=0;h<c.length;h++){let d=c[h];if(!d){const p=h-(this.injectRestPoses?1:0);c[h]=new mn(null,l,this.rootToRegisteredClip.get(n)[p]),d=c[h]}const f=d.getDuration();if(a[h]===void 0)a[h]=f;else if(a[h]!==f){console.error("Error during UDSZ export: Encountered different animation durations for animated targets. Please report a bug!",{datas:c,target:l}),a[h]=f;continue}}}}for(const n of this.serializers){const r=(t=n.model)==null?void 0:t.parent,o=(r==null?void 0:r.isDynamic)===!0;WR&&console.log(o,(i=n.model)==null?void 0:i.parent),o&&n.registerCallback(r)}}onExportObject(e,t,i){ne.foreachComponent(e,r=>{const o=r;typeof o.createAnimation=="function"&&o.createAnimation(this,t,i)},!1);const n=new Yae(e,this);this.serializers.push(n),n.registerCallback(t)}}class Yae{constructor(e,t){u(this,"model");u(this,"object");u(this,"animationData");u(this,"ext");u(this,"callback");this.object=e,this.animationData=t.animationData,this.ext=t}registerCallback(e){this.model&&this.callback&&this.model.removeEventListener("serialize",this.callback),this.callback||(this.callback=this.onSerialize.bind(this)),WR&&console.log("REPARENT",e),this.model=e,this.callback&&this.model.addEventListener("serialize",this.callback)}skinnedMeshExport(e,t,i){var o;const n=this.model,r=this.animationData;if(n&&n.skinnedMesh){let f=function(L){const U=[];for(const[D,V]of L){let O=`${D} : [`;const F=[];for(const N of V)F.push(`(${mi(N.x)}, ${mi(N.y)}, ${mi(N.z)})`);O=O.concat(F.join(", ")),O=O.concat("],"),U.push(O)}return U},p=function(L){const U=[];for(const[D,V]of L){let O=`${D} : [`;const F=[];for(const N of V)F.push(`(${mi(N.w)}, ${mi(N.x)}, ${mi(N.y)}, ${mi(N.z)})`);O=O.concat(F.join(", ")),O=O.concat("],"),U.push(O)}return U},m=function(L){let U,D=!0;const V=new Map;for(const[F,N]of L){U===void 0&&(U=N.length),U!==N.length&&(D=!1);let q=0;for(const $ of N)q++,$||(V.has(F)||V.set(F,[]),V.get(F).push(q))}gc&&console.log("Bone count: ",L.size,"TransformData entries per bone: ",U,"Undefined bone entries: ",V),console.assert(D,"All bones should have the same number of TransformData entries",L),console.assert(V.size===0,"All TransformData entries should be set",V);const O=[];for(const[F,N]of L)for(let q=0;q<N.length;q++){const $=N[q],oe=i.getStartTimeByClip($.clip);O.length<=q&&O.push({pos:[],rot:[],scale:[],timeOffset:oe});const ae=O[q];ae.pos.push(...$.getSortedTimesArray(!0,!1,!1)),ae.rot.push(...$.getSortedTimesArray(!1,!0,!1)),ae.scale.push(...$.getSortedTimesArray(!1,!1,!0))}for(const F of O)F.pos.sort((N,q)=>N-q),F.rot.sort((N,q)=>N-q),F.scale.sort((N,q)=>N-q),F.pos=[...new Set(F.pos)],F.rot=[...new Set(F.rot)],F.scale=[...new Set(F.scale)];return O},v=function(L,U,D){const V=new Map,O=new Map,F=new Map,N=U.length;for(const q of D){const $=L.get(q);let oe;$?console.assert($.length===N,"We should have the same number of TransformData entries for each bone",$,U):oe=new mn(null,q,null);for(let ae=0;ae<N;ae++){const Re=$?$[ae]:oe,se=U[ae];for(const{time:ye,translation:Ae}of Re.getValues(se.pos,!0,!1,!1)){const Be=(ye+se.timeOffset)*60;V.has(Be)||V.set(Be,new Array),V.get(Be).push(Ae.clone())}for(const{time:ye,rotation:Ae}of Re.getValues(se.rot,!1,!0,!1)){const Be=(ye+se.timeOffset)*60;O.has(Be)||O.set(Be,new Array),O.get(Be).push(Ae.clone())}for(const{time:ye,scale:Ae}of Re.getValues(se.scale,!1,!1,!0)){const Be=(ye+se.timeOffset)*60;F.has(Be)||F.set(Be,new Array),F.get(Be).push(Ae.clone())}}}return{position:V.size==0?void 0:V,quaternion:O.size==0?void 0:O,scale:F.size==0?void 0:F}},y=function(L){const U=[];for(const D of L)U.push(`(${mi(D.x)}, ${mi(D.y)}, ${mi(D.z)})`);return U.join(", ")},g=function(L){const U=[];for(const D of L)U.push(`(${mi(D.w)}, ${mi(D.x)}, ${mi(D.y)}, ${mi(D.z)})`);return U.join(", ")},_=function(L){const U=new Map;if(gc){const D=new Array;for(const[V,O]of r)D.push(V.uuid+": "+O.length+" "+O.map(F=>{var N;return(N=F.clip)==null?void 0:N.uuid.substring(0,6)}).join(" "));console.log(`getPerBoneTransformData
`+D.join(`
`))}for(const D of L){const V=r.get(D);V&&U.set(D,V)}return U},A=function(L){const U=_(L),D=m(U);return v(U,D,L)};const a=n.skinnedMesh.skeleton,l=new Array,c=[],h=[];for(const L of a.bones)if(L.parent.type!=="Bone"){c.push(L);const U=a.boneInverses[a.bones.indexOf(L)];l.push({bone:L,inverse:U}),h.push(L.uuid)}for(;h.length<a.bones.length;)for(const L of c){const U=L.children;for(const D of U)if(h.indexOf(D.uuid)===-1&&a.bones.indexOf(D)!==-1){c.push(D);const V=a.boneInverses[a.bones.indexOf(D)];l.push({bone:D,inverse:V}),h.push(D.uuid)}}for(const L of yQ(a.bones))l.push({bone:L,inverse:L.matrixWorld.clone().invert()});const d=l[0].bone.parent;d||console.error("No bone parent found for skinned mesh during USDZ export",n.skinnedMesh),l.sort((L,U)=>kg(L.bone,d)>kg(U.bone,d)?1:-1);const b=t.quickLookCompatible,E=[],C=[],T=[],M=[];for(const{bone:L}of l){if(b){const U=L.scale;U.x==0&&(U.x=1e-5),U.y==0&&(U.y=1e-5),U.z==0&&(U.z=1e-5),E.push(new fe().compose(L.position,L.quaternion,L.scale))}else E.push(L.matrix.clone());C.push(L.position),T.push(L.quaternion),M.push(L.scale)}const R=l.map(L=>'"'+kg(L.bone,d)+'"').join(", "),S=l.map(L=>LU(L.inverse.clone().invert())).join(", ");e.beginBlock('def Skeleton "Rig"'),e.appendLine(`uniform matrix4d[] bindTransforms = [${S}]`),e.appendLine(`uniform token[] joints = [${R}]`),e.appendLine('uniform token purpose = "guide"'),e.appendLine(`uniform matrix4d[] restTransforms = [${E.map(L=>LU(L)).join(", ")}]`);const I=A(l.map(L=>L.bone));if(gc){let L=1e7,U=0;for(const D of((o=I.position)==null?void 0:o.keys())??[])L=Math.min(L,D),U=Math.max(U,D);console.log("Time samples",L,U,I)}if(e.beginBlock('def SkelAnimation "_anim"'),e.appendLine(`uniform token[] joints = [${R}]`),e.appendLine(`quatf[] rotations = [${g(T)}]`),I&&I.quaternion){e.beginBlock("quatf[] rotations.timeSamples = {","");const L=p(I.quaternion);for(const U of L)e.appendLine(U);e.closeBlock()}if(e.appendLine(`half3[] scales = [${y(M)}]`),I&&I.scale){e.beginBlock("half3[] scales.timeSamples = {","");const L=f(I.scale);for(const U of L)e.appendLine(U);e.closeBlock()}if(e.appendLine(`float3[] translations = [${y(C)}]`),I&&I.position){e.beginBlock("float3[] translations.timeSamples = {","");const L=f(I.position);for(const U of L)e.appendLine(U);e.closeBlock()}e.closeBlock(),e.closeBlock()}}onSerialize(e,t){if(!this.model)return;const i=this.animationData.get(this.object);if(i)for(let h=0;h<i.length;h++)i[h]===void 0&&(i[h]=new mn(null,this.object,null));const n=this.ext;this.skinnedMeshExport(e,t,n);const r=this.object,o=this.model,a=this.animationData.get(r);if(!a||r.isSkinnedMesh)return;WR&&console.log("SERIALIZE",this.model.name,this.object.type,a);const l=Intl.NumberFormat("en-US",{maximumFractionDigits:3,minimumFractionDigits:0,useGrouping:!1});function c(h,d){var p;if(h.some(m=>m&&{position:m.pos,rotation:m.rot,scale:m.scale}[d])){switch(d){case"position":o.needsTranslate=!0,e.beginBlock("double3 xformOp:translate.timeSamples = {","");break;case"rotation":o.needsOrient=!0,e.beginBlock("quatf xformOp:orient.timeSamples = {","");break;case"scale":o.needsScale=!0,e.beginBlock("double3 xformOp:scale.timeSamples = {","");break}for(let m=0;m<h.length;m++){const v=h[m];if(!v)continue;const y=n.getStartTimeByClip(v.clip),g=v.getSortedTimesArray(d==="position",d==="rotation",d==="scale");if(!g||g.length===0){console.error("got an animated object but no time values?",r,v);continue}const _=!v.clip,A=d==="position"&&(v.pos||_),b=d==="rotation"&&(v.rot||_),E=d==="scale"&&(v.scale||_);if(A||b||E){const C=((p=v.clip)==null?void 0:p.name)??"rest",T=v.getDuration();gc&&console.log("Write .timeSamples:",C,y,T,h),e.appendLine("# "+C+": start="+l.format(y*mn.frameRate)+", length="+l.format(T*mn.frameRate)+", frames="+v.getFrames())}if(A)for(const{time:C,translation:T}of v.getValues(g,!0,!1,!1)){const R=`${l.format((y+C)*mn.frameRate)}: (${mi(T.x)}, ${mi(T.y)}, ${mi(T.z)}),`;e.appendLine(R)}if(b)for(const{time:C,rotation:T}of v.getValues(g,!1,!0,!1)){const R=`${l.format((y+C)*mn.frameRate)}: (${mi(T.w)}, ${mi(T.x)}, ${mi(T.y)}, ${mi(T.z)}),`;e.appendLine(R)}if(E)for(const{time:C,scale:T}of v.getValues(g,!1,!1,!0)){const R=`${l.format((y+C)*mn.frameRate)}: (${mi(T.x)}, ${mi(T.y)}, ${mi(T.z)}),`;e.appendLine(R)}}e.closeBlock()}}c(a,"position"),c(a,"rotation"),c(a,"scale")}}class Kae extends Rn{constructor(e,t=1,i=16,n=2){const r=new pt,o=i+n*2,a=new Float32Array((o*3+3)*3);r.setAttribute("position",new ot(a,3));const l=new hn({color:65280}),c=new hn({color:16776960});super(r,[c,l]),this.audio=e,this.range=t,this.divisionsInnerAngle=i,this.divisionsOuterAngle=n,this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,t=this.range,i=this.divisionsInnerAngle,n=this.divisionsOuterAngle,r=li.degToRad(e.panner.coneInnerAngle),o=li.degToRad(e.panner.coneOuterAngle),a=r/2,l=o/2;let c=0,h=0,d,f;const p=this.geometry,m=p.attributes.position;p.clearGroups();function v(y,g,_,A){const b=(g-y)/_;for(m.setXYZ(c,0,0,0),h++,d=y;d<g;d+=b)f=c+h,m.setXYZ(f,Math.sin(d)*t,0,Math.cos(d)*t),m.setXYZ(f+1,Math.sin(Math.min(d+b,g))*t,0,Math.cos(Math.min(d+b,g))*t),m.setXYZ(f+2,0,0,0),h+=3;p.addGroup(c,h,A),c+=h,h=0}v(-l,-a,n,0),v(-a,a,i,1),v(a,l,n,0),m.needsUpdate=!0,r===o&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}const VU=Symbol("previous-visibility"),_g=class extends Yt{render(e,t,i){if(i instanceof rD)this._unsupported_effectcomposer_warning||(console.warn("RenderTexture.render() does not yet support EffectComposer"),this._unsupported_effectcomposer_warning=!0);else{this.onBeforeRender();const n=i.getRenderTarget(),r=i.xr.enabled;i.xr.enabled=!1,i.setRenderTarget(this),i.clear(!0,!0,!0),i.render(e,t),i.setRenderTarget(n),i.xr.enabled=r,this.onAfterRender()}}onBeforeRender(){_g._userSet.clear();const e=ED(this.texture,!0,null,_g._userSet);for(const t of e)t instanceof le&&(t[VU]=t.visible,t.visible=!1)}onAfterRender(){for(const e of _g._userSet)e instanceof le&&(e.visible=e[VU]);_g._userSet.clear()}};let _d=_g;u(_d,"_userSet",new Set);const QU={type:"change"},oM={type:"start"},jU={type:"end"},Ex=new jo,WU=new Ar,Jae=Math.cos(70*li.DEG2RAD);let PQ=class extends Zs{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new w,this.cursor=new w,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Lf.ROTATE,MIDDLE:Lf.DOLLY,RIGHT:Lf.PAN},this.touches={ONE:kf.ROTATE,TWO:kf.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(j){j.addEventListener("keydown",ke),this._domElementKeyEvents=j},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",ke),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(QU),i.update(),r=n.NONE},this.update=function(){const j=new w,ce=new xe().setFromUnitVectors(e.up,new w(0,1,0)),ee=ce.clone().invert(),Oe=new w,he=new xe,He=new w,Ke=2*Math.PI;return function(zi=null){const xn=i.object.getWorldPosition(e.position);j.copy(xn).sub(i.target),j.applyQuaternion(ce),a.setFromVector3(j),i.autoRotate&&r===n.NONE&&U(I(zi)),i.enableDamping?(a.theta+=l.theta*i.dampingFactor,a.phi+=l.phi*i.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let wn=i.minAzimuthAngle,pi=i.maxAzimuthAngle;isFinite(wn)&&isFinite(pi)&&(wn<-Math.PI?wn+=Ke:wn>Math.PI&&(wn-=Ke),pi<-Math.PI?pi+=Ke:pi>Math.PI&&(pi-=Ke),wn<=pi?a.theta=Math.max(wn,Math.min(pi,a.theta)):a.theta=a.theta>(wn+pi)/2?Math.max(wn,a.theta):Math.min(pi,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(d,i.dampingFactor):i.target.add(d),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor);let kn=!1;if(i.zoomToCursor&&T||i.object.isOrthographicCamera)a.radius=oe(a.radius);else{i.enableDamping?h=li.lerp(h,c,i.dampingFactor):h=c;const qn=a.radius;a.radius=oe(a.radius*h),kn=qn!=a.radius}if(j.setFromSpherical(a),j.applyQuaternion(ee),xn.copy(i.target).add(j),i.object.parent?i.object.parent.worldToLocal(xn):i.object.position.copy(xn),i.object.lookAt(i.target),i.enableDamping===!0?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,d.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),d.set(0,0,0)),i.zoomToCursor&&T){let qn=null;if(i.object.isPerspectiveCamera){const Jo=j.length();qn=oe(Jo*c);const Mu=Jo-qn;i.object.position.addScaledVector(E,Mu),i.object.updateMatrixWorld(),kn=!!Mu}else if(i.object.isOrthographicCamera){const Jo=new w(C.x,C.y,0);Jo.unproject(i.object);const Mu=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),i.object.updateProjectionMatrix(),kn=Mu!==i.object.zoom;const Zo=new w(C.x,C.y,0);Zo.unproject(i.object),i.object.position.sub(Zo).add(Jo),i.object.updateMatrixWorld(),qn=j.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;qn!==null&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(qn).add(i.object.position):(Ex.origin.copy(i.object.position),Ex.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(Ex.direction))<Jae?e.lookAt(i.target):(WU.setFromNormalAndCoplanarPoint(i.object.up,i.target),Ex.intersectPlane(WU,i.target))))}else if(i.object.isOrthographicCamera){const qn=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),qn!==i.object.zoom&&(i.object.updateProjectionMatrix(),kn=!0)}return c=1,T=!1,kn||Oe.distanceToSquared(i.object.position)>o||8*(1-he.dot(i.object.quaternion))>o||He.distanceToSquared(i.target)>o?(i.dispatchEvent(QU),Oe.copy(i.object.position),he.copy(i.object.quaternion),He.copy(i.target),!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",Fe),i.domElement.removeEventListener("pointerdown",jt),i.domElement.removeEventListener("pointercancel",k),i.domElement.removeEventListener("wheel",Pe),i.domElement.removeEventListener("pointermove",H),window.removeEventListener("pointerup",k),i.domElement.getRootNode().removeEventListener("keydown",Ct,{capture:!0}),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",ke),i._domElementKeyEvents=null)};const i=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=n.NONE;const o=1e-6,a=new UI,l=new UI;let c=1,h=1;const d=new w,f=new Z,p=new Z,m=new Z,v=new Z,y=new Z,g=new Z,_=new Z,A=new Z,b=new Z,E=new w,C=new Z;let T=!1;const M=[],R={};let S=!1;function I(j){return j!==null?2*Math.PI/60*i.autoRotateSpeed*j:2*Math.PI/60/60*i.autoRotateSpeed}function L(j){const ce=Math.abs(j*.01);return Math.pow(.95,i.zoomSpeed*ce)}function U(j){l.theta-=j}function D(j){l.phi-=j}const V=function(){const j=new w;return function(ee,Oe){j.setFromMatrixColumn(Oe,0),j.multiplyScalar(-ee),d.add(j)}}(),O=function(){const j=new w;return function(ee,Oe){i.screenSpacePanning===!0?j.setFromMatrixColumn(Oe,1):(j.setFromMatrixColumn(Oe,0),j.crossVectors(i.object.up,j)),j.multiplyScalar(ee),d.add(j)}}(),F=function(){const j=new w,ce=new w;return function(Oe,he){const He=i.domElement;if(i.object.isPerspectiveCamera){i.object.getWorldPosition(ce),j.copy(ce).sub(i.target);let Ke=j.length();Ke*=Math.tan(i.object.fov/2*Math.PI/180),V(2*Oe*Ke/He.clientHeight,i.object.matrixWorld),O(2*he*Ke/He.clientHeight,i.object.matrixWorld)}else i.object.isOrthographicCamera?(V(Oe*(i.object.right-i.object.left)/i.object.zoom/He.clientWidth,i.object.matrixWorld),O(he*(i.object.top-i.object.bottom)/i.object.zoom/He.clientHeight,i.object.matrixWorld)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function N(j){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c/=j:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function q(j){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c*=j:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function $(j,ce){if(!i.zoomToCursor)return;T=!0;const ee=i.domElement.getBoundingClientRect(),Oe=j-ee.left,he=ce-ee.top,He=ee.width,Ke=ee.height;C.x=Oe/He*2-1,C.y=-(he/Ke)*2+1,E.set(C.x,C.y,1).unproject(i.object).sub(i.object.position).normalize()}function oe(j){return Math.max(i.minDistance,Math.min(i.maxDistance,j))}function ae(j){f.set(j.clientX,j.clientY)}function Re(j){$(j.clientX,j.clientX),_.set(j.clientX,j.clientY)}function se(j){v.set(j.clientX,j.clientY)}function ye(j){p.set(j.clientX,j.clientY),m.subVectors(p,f).multiplyScalar(i.rotateSpeed);const ce=i.domElement;U(2*Math.PI*m.x/ce.clientHeight),D(2*Math.PI*m.y/ce.clientHeight),f.copy(p),i.update()}function Ae(j){A.set(j.clientX,j.clientY),b.subVectors(A,_),b.y>0?N(L(b.y)):b.y<0&&q(L(b.y)),_.copy(A),i.update()}function je(j){y.set(j.clientX,j.clientY),g.subVectors(y,v).multiplyScalar(i.panSpeed),F(g.x,g.y),v.copy(y),i.update()}function Be(j){$(j.clientX,j.clientY),j.deltaY<0?q(L(j.deltaY)):j.deltaY>0&&N(L(j.deltaY)),i.update()}function We(j){let ce=!1;switch(j.code){case i.keys.UP:j.ctrlKey||j.metaKey||j.shiftKey?D(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):F(0,i.keyPanSpeed),ce=!0;break;case i.keys.BOTTOM:j.ctrlKey||j.metaKey||j.shiftKey?D(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):F(0,-i.keyPanSpeed),ce=!0;break;case i.keys.LEFT:j.ctrlKey||j.metaKey||j.shiftKey?U(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):F(i.keyPanSpeed,0),ce=!0;break;case i.keys.RIGHT:j.ctrlKey||j.metaKey||j.shiftKey?U(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):F(-i.keyPanSpeed,0),ce=!0;break}ce&&(j.preventDefault(),i.update())}function lt(j){if(M.length===1)f.set(j.pageX,j.pageY);else{const ce=at(j),ee=.5*(j.pageX+ce.x),Oe=.5*(j.pageY+ce.y);f.set(ee,Oe)}}function rt(j){if(M.length===1)v.set(j.pageX,j.pageY);else{const ce=at(j),ee=.5*(j.pageX+ce.x),Oe=.5*(j.pageY+ce.y);v.set(ee,Oe)}}function W(j){const ce=at(j),ee=j.pageX-ce.x,Oe=j.pageY-ce.y,he=Math.sqrt(ee*ee+Oe*Oe);_.set(0,he)}function Ge(j){i.enableZoom&&W(j),i.enablePan&&rt(j)}function we(j){i.enableZoom&&W(j),i.enableRotate&&lt(j)}function Ne(j){if(M.length==1)p.set(j.pageX,j.pageY);else{const ee=at(j),Oe=.5*(j.pageX+ee.x),he=.5*(j.pageY+ee.y);p.set(Oe,he)}m.subVectors(p,f).multiplyScalar(i.rotateSpeed);const ce=i.domElement;U(2*Math.PI*m.x/ce.clientHeight),D(2*Math.PI*m.y/ce.clientHeight),f.copy(p)}function Ee(j){if(M.length===1)y.set(j.pageX,j.pageY);else{const ce=at(j),ee=.5*(j.pageX+ce.x),Oe=.5*(j.pageY+ce.y);y.set(ee,Oe)}g.subVectors(y,v).multiplyScalar(i.panSpeed),F(g.x,g.y),v.copy(y)}function st(j){const ce=at(j),ee=j.pageX-ce.x,Oe=j.pageY-ce.y,he=Math.sqrt(ee*ee+Oe*Oe);A.set(0,he),b.set(0,Math.pow(A.y/_.y,i.zoomSpeed)),N(b.y),_.copy(A);const He=(j.pageX+ce.x)*.5,Ke=(j.pageY+ce.y)*.5;$(He,Ke)}function tt(j){i.enableZoom&&st(j),i.enablePan&&Ee(j)}function ct(j){i.enableZoom&&st(j),i.enableRotate&&Ne(j)}function jt(j){i.enabled!==!1&&(M.length===0&&(i.domElement.setPointerCapture(j.pointerId),i.domElement.addEventListener("pointermove",H),window.addEventListener("pointerup",k)),!Ye(j)&&(ci(j),j.pointerType==="touch"?Ve(j):ve(j)))}function H(j){i.enabled!==!1&&(j.pointerType==="touch"?Tt(j):_e(j))}function k(j){switch(gt(j),M.length){case 0:i.domElement.releasePointerCapture(j.pointerId),i.domElement.removeEventListener("pointermove",H),i.domElement.removeEventListener("pointerup",k),i.dispatchEvent(jU),r=n.NONE;break;case 1:const ce=M[0],ee=R[ce];Ve({pointerId:ce,pageX:ee.x,pageY:ee.y});break}}function ve(j){let ce;switch(j.button){case 0:ce=i.mouseButtons.LEFT;break;case 1:ce=i.mouseButtons.MIDDLE;break;case 2:ce=i.mouseButtons.RIGHT;break;default:ce=-1}switch(ce){case Lf.DOLLY:if(i.enableZoom===!1)return;Re(j),r=n.DOLLY;break;case Lf.ROTATE:if(j.ctrlKey||j.metaKey||j.shiftKey){if(i.enablePan===!1)return;se(j),r=n.PAN}else{if(i.enableRotate===!1)return;ae(j),r=n.ROTATE}break;case Lf.PAN:if(j.ctrlKey||j.metaKey||j.shiftKey){if(i.enableRotate===!1)return;ae(j),r=n.ROTATE}else{if(i.enablePan===!1)return;se(j),r=n.PAN}break;default:r=n.NONE}r!==n.NONE&&i.dispatchEvent(oM)}function _e(j){switch(r){case n.ROTATE:if(i.enableRotate===!1)return;ye(j);break;case n.DOLLY:if(i.enableZoom===!1)return;Ae(j);break;case n.PAN:if(i.enablePan===!1)return;je(j);break}}function Pe(j){i.enabled===!1||i.enableZoom===!1||r!==n.NONE||(j.preventDefault(),i.dispatchEvent(oM),Be(Me(j)),i.dispatchEvent(jU))}function Me(j){const ce=j.deltaMode,ee={clientX:j.clientX,clientY:j.clientY,deltaY:j.deltaY};switch(ce){case 1:ee.deltaY*=16;break;case 2:ee.deltaY*=100;break}return j.ctrlKey&&!S&&(ee.deltaY*=10),ee}function Ct(j){j.key==="Control"&&(S=!0,i.domElement.getRootNode().addEventListener("keyup",mt,{passive:!0,capture:!0}))}function mt(j){j.key==="Control"&&(S=!1,i.domElement.getRootNode().removeEventListener("keyup",mt,{passive:!0,capture:!0}))}function ke(j){i.enabled===!1||i.enablePan===!1||We(j)}function Ve(j){switch(vt(j),M.length){case 1:switch(i.touches.ONE){case kf.ROTATE:if(i.enableRotate===!1)return;lt(j),r=n.TOUCH_ROTATE;break;case kf.PAN:if(i.enablePan===!1)return;rt(j),r=n.TOUCH_PAN;break;default:r=n.NONE}break;case 2:switch(i.touches.TWO){case kf.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;Ge(j),r=n.TOUCH_DOLLY_PAN;break;case kf.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;we(j),r=n.TOUCH_DOLLY_ROTATE;break;default:r=n.NONE}break;default:r=n.NONE}r!==n.NONE&&i.dispatchEvent(oM)}function Tt(j){switch(vt(j),r){case n.TOUCH_ROTATE:if(i.enableRotate===!1)return;Ne(j),i.update();break;case n.TOUCH_PAN:if(i.enablePan===!1)return;Ee(j),i.update();break;case n.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;tt(j),i.update();break;case n.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;ct(j),i.update();break;default:r=n.NONE}}function Fe(j){i.enabled!==!1&&j.preventDefault()}function ci(j){M.push(j.pointerId)}function gt(j){delete R[j.pointerId];for(let ce=0;ce<M.length;ce++)if(M[ce]==j.pointerId){M.splice(ce,1);return}}function Ye(j){for(let ce=0;ce<M.length;ce++)if(M[ce]==j.pointerId)return!0;return!1}function vt(j){let ce=R[j.pointerId];ce===void 0&&(ce=new Z,R[j.pointerId]=ce),ce.set(j.pageX,j.pageY)}function at(j){const ce=j.pointerId===M[0]?M[1]:M[0];return R[ce]}i.domElement.addEventListener("contextmenu",Fe),i.domElement.addEventListener("pointerdown",jt),i.domElement.addEventListener("pointercancel",k),i.domElement.addEventListener("wheel",Pe,{passive:!1}),i.domElement.getRootNode().addEventListener("keydown",Ct,{passive:!0,capture:!0}),this.update()}};var w_=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const aM=ie("debuggroundprojection");class ih extends Te{constructor(){super(...arguments);u(this,"applyOnAwake",!1);u(this,"autoFit",!0);u(this,"_radius",50);u(this,"_height",3);u(this,"_arblending",0);u(this,"_lastEnvironment");u(this,"_lastRadius");u(this,"_lastHeight");u(this,"_projection");u(this,"_watcher");u(this,"_needsTextureUpdate",!1);u(this,"_blurrynessShader",null);u(this,"_lastBlurriness",-1)}set radius(t){this._radius=t,this.updateProjection()}get radius(){return this._radius}set height(t){this._height=t,this.updateProjection()}get height(){return this._height}set arBlending(t){this._arblending=t,this._needsTextureUpdate=!0}get arBlending(){return this._arblending}awake(){this.applyOnAwake&&this.updateAndCreate()}onEnable(){this.context.time.frameCount>0&&this.applyOnAwake&&this.updateAndCreate(),this._watcher||(this._watcher=new iu(this.context.scene,"environment"),this._watcher.subscribeWrite(t=>{this.updateProjection()}))}onDisable(){var t,i;(t=this._watcher)==null||t.revoke(),(i=this._projection)==null||i.removeFromParent()}onEnterXR(){this.activeAndEnabled&&(this._needsTextureUpdate=!0,this.updateProjection())}async onLeaveXR(){this.activeAndEnabled&&(await qC(1),this.updateProjection())}onBeforeRender(){this._projection&&this.scene.backgroundRotation&&this._projection.rotation.copy(this.scene.backgroundRotation),this.context.scene.backgroundBlurriness!==void 0&&this._lastBlurriness!=this.context.scene.backgroundBlurriness&&this.context.scene.backgroundBlurriness>.001?this.updateProjection():this._needsTextureUpdate&&this.updateBlurriness()}updateAndCreate(){var t;this.updateProjection(),(t=this._watcher)==null||t.apply()}updateProjection(){var n,r,o,a,l;if(!this.context.scene.environment){(n=this._projection)==null||n.removeFromParent();return}if(((r=this.context.xr)!=null&&r.isPassThrough||(o=this.context.xr)!=null&&o.isAR)&&this.arBlending===0){(a=this._projection)==null||a.removeFromParent();return}if(!this.gameObject||this.destroyed)return;let t=!0;const i=0;if(!this._projection||this.context.scene.environment!==this._lastEnvironment||this._height!==this._lastHeight||this._radius!==this._lastRadius){if(aM&&console.log("Create/Update Ground Projection",this.context.scene.environment.name),(l=this._projection)==null||l.removeFromParent(),!this._projection||this.context.scene.environment!==this._lastEnvironment||this._lastHeight!==this._height||this._lastRadius!==this._radius)try{this._projection=new Kg(this.context.scene.environment,this._height,this.radius,64)}catch(c){console.error("Failed to enable GroundProjection for environment",c);return}else t=!1;this._projection.position.y=this._height-i,this._projection.name="GroundProjection",tD(this._projection,!1)}else t=!1;if(this._projection.parent||this.gameObject.add(this._projection),this.autoFit&&t){this._projection.updateWorldMatrix(!0,!0);const c=Ja(this.context.scene.children,[this._projection]),h=c.min.y;if(h<1/0){const d=yt();d.x=c.min.x+(c.max.x-c.min.x)*.5;const f=ln(this.gameObject).x;d.y=h+this._height*f-i,d.z=c.min.z+(c.max.z-c.min.z)*.5,Os(this._projection,d)}aM&&At.DrawWireBox3(c,65280,5)}this.context.scene.backgroundBlurriness>.001&&this._needsTextureUpdate&&this.updateBlurriness(),this._lastEnvironment=this.context.scene.environment,this._lastHeight=this._height,this._lastRadius=this._radius,this._needsTextureUpdate=!1}updateBlurriness(){var i;if(this._projection){if(!this.context.scene.environment)return}else return;this._needsTextureUpdate=!1,aM&&console.log("Update Blurriness",this.context.scene.backgroundBlurriness),this._blurrynessShader??(this._blurrynessShader=new Rt({name:"GroundProjectionBlurriness",uniforms:{map:{value:this.context.scene.environment},blurriness:{value:this.context.scene.backgroundBlurriness},blending:{value:0},alphaFactor:{value:1}},vertexShader:Zae,fragmentShader:$ae})),this._blurrynessShader.depthWrite=!1,this._blurrynessShader.uniforms.blurriness.value=this.context.scene.backgroundBlurriness,this._lastBlurriness=this.context.scene.backgroundBlurriness,this.context.scene.environment.needsPMREMUpdate=!0;const t=this._projection.material.transparent;this._projection.material.transparent=(((i=this.context.xr)==null?void 0:i.isAR)===!0&&this.arBlending>1e-6)??!1,this._projection.material.transparent?this._blurrynessShader.uniforms.blending.value=this.arBlending:this._blurrynessShader.uniforms.blending.value=0,this.context.isInPassThrough?this._blurrynessShader.uniforms.alphaFactor.value=.95:this._blurrynessShader.uniforms.alphaFactor.value=1,t!==this._projection.material.transparent&&(this._projection.material.needsUpdate=!0),this._projection.material.map=za.copyTexture(this.context.scene.environment,this._blurrynessShader),this._projection.material.depthTest=!0,this._projection.material.depthWrite=!1}}w_([x()],ih.prototype,"applyOnAwake",void 0);w_([x()],ih.prototype,"autoFit",void 0);w_([x()],ih.prototype,"radius",null);w_([x()],ih.prototype,"height",null);w_([x()],ih.prototype,"arBlending",null);const Zae=`
  varying vec2 vUv;

  void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,$ae=`
  uniform sampler2D map;
  uniform float blurriness;
  uniform float alphaFactor;
  uniform float blending;
  varying vec2 vUv;

  const float PI = 3.14159265359;

  // Gaussian function
  float gaussian(float x, float sigma) {
    return exp(-(x * x) / (2.0 * sigma * sigma)) / (sqrt(2.0 * PI) * sigma);
  }

  // Custom smoothstep function for desired falloff
  float customSmoothstep(float edge0, float edge1, float x) {
    float t = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return t * t * (3.0 - 2.0 * t);
  }

  void main() {
    vec2 center = vec2(0.0, 0.0);
    vec2 pos = vUv;
    pos.x = 0.0; // Only consider vertical distance
    float distance = length(pos - center);
    
    // Calculate blur amount based on custom falloff
    float blurAmount = customSmoothstep(0.5, 1.0, distance * 2.0);
    blurAmount = clamp(blurAmount, 0.0, 1.0); // Ensure blur amount is within valid range

    // Gaussian blur
    vec2 pixelSize = 1.0 / vec2(textureSize(map, 0));
    vec4 color = vec4(0.0);
    float totalWeight = 0.0;
    int blurSize = int(60.0 * min(1.0, blurriness) * blurAmount); // Adjust blur size based on distance and blurriness
    float lodLevel = log2(float(blurSize)) * 0.5; // Compute LOD level

    for (int x = -blurSize; x <= blurSize; x++) {
        for (int y = -blurSize; y <= blurSize; y++) {
            vec2 offset = vec2(float(x), float(y)) * pixelSize * blurAmount;
            float weight = gaussian(length(vec2(float(x), float(y))), 1000.0 * blurAmount); // Use a fixed sigma value
            color += textureLod(map, vUv + offset, lodLevel) * weight;
            totalWeight += weight;
        }
    }

    color = totalWeight > 0.0 ? color / totalWeight : texture2D(map, vUv);

    gl_FragColor = color;

    float brightness = dot(gl_FragColor.rgb, vec3(0.299, 0.587, 0.114));
    float stepFactor = blending - brightness * .1;
    gl_FragColor.a = pow(1.0 - blending * customSmoothstep(0.35 * stepFactor, 0.45 * stepFactor, distance), 5.);
    gl_FragColor.a *= alphaFactor;
    // gl_FragColor.rgb = vec3(1.0);

    // #include <tonemapping_fragment>
    // #include <colorspace_fragment>
    
    // Uncomment to visualize blur amount
    // gl_FragColor = vec4(blurAmount, 0.0, 0.0, 1.0);
  }
`;var XD=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class Jp extends Te{constructor(){super(...arguments);u(this,"constraintActive",!0);u(this,"locked",!1);u(this,"sources",[])}}XD([x()],Jp.prototype,"constraintActive",void 0);XD([x()],Jp.prototype,"locked",void 0);XD([x(ge)],Jp.prototype,"sources",void 0);function ele(s,e){return Gd(s,yi.ContextCreated,e),()=>Hd(s,yi.ContextCreated)}function tle(s,e){return Gd(s,yi.ContextClearing,e),()=>Hd(s,yi.ContextClearing)}function ile(s,e){return Gd(s,yi.ContextDestroying,e),()=>Hd(s,yi.ContextDestroying)}function YD(s,e){return Gd(s,Wt.Start,e),()=>Hd(s,Wt.Start)}function KD(s,e){return Gd(s,Wt.Update,e),()=>Hd(s,Wt.Update)}function BQ(s,e){return Gd(s,Wt.OnBeforeRender,e),()=>Hd(s,Wt.OnBeforeRender)}function nle(s,e){return Gd(s,Wt.OnAfterRender,e),()=>Hd(s,Wt.OnAfterRender)}class vp{constructor(){u(this,"bb",null);u(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}static sizeOf(){return 12}static createVec3(e,t,i,n){return e.prep(4,12),e.writeFloat32(n),e.writeFloat32(i),e.writeFloat32(t),e.offset()}}class DQ{constructor(){u(this,"bb",null);u(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}position(e){return(e||new vp).__init(this.bb_pos,this.bb)}rotation(e){return(e||new vp).__init(this.bb_pos+12,this.bb)}scale(e){return(e||new vp).__init(this.bb_pos+24,this.bb)}static sizeOf(){return 36}static createTransform(e,t,i,n,r,o,a,l,c,h){return e.prep(4,36),e.prep(4,12),e.writeFloat32(h),e.writeFloat32(c),e.writeFloat32(l),e.prep(4,12),e.writeFloat32(a),e.writeFloat32(o),e.writeFloat32(r),e.prep(4,12),e.writeFloat32(n),e.writeFloat32(i),e.writeFloat32(t),e.offset()}}class Wh{constructor(){u(this,"bb",null);u(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSyncedTransformModel(e,t){return(t||new Wh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedTransformModel(e,t){return e.setPosition(e.position()+fD),(t||new Wh).__init(e.readInt32(e.position())+e.position(),e)}guid(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}fast(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}transform(e){const t=this.bb.__offset(this.bb_pos,8);return t?(e||new DQ).__init(this.bb_pos+t,this.bb):null}dontSave(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startSyncedTransformModel(e){e.startObject(4)}static addGuid(e,t){e.addFieldOffset(0,t,0)}static addFast(e,t){e.addFieldInt8(1,+t,0)}static addTransform(e,t){e.addFieldStruct(2,t,0)}static addDontSave(e,t){e.addFieldInt8(3,+t,0)}static endSyncedTransformModel(e){return e.endObject()}static finishSyncedTransformModelBuffer(e,t){e.finish(t)}static finishSizePrefixedSyncedTransformModelBuffer(e,t){e.finish(t,void 0,!0)}}var Is;(function(s){s[s.Average=0]="Average",s[s.Multiply=1]="Multiply",s[s.Minimum=2]="Minimum",s[s.Maximum=3]="Maximum"})(Is||(Is={}));var w0;(function(s){s[s.Discrete=0]="Discrete",s[s.Continuous=1]="Continuous"})(w0||(w0={}));var Kn;(function(s){s[s.None=0]="None",s[s.FreezePositionX=2]="FreezePositionX",s[s.FreezePositionY=4]="FreezePositionY",s[s.FreezePositionZ=8]="FreezePositionZ",s[s.FreezePosition=14]="FreezePosition",s[s.FreezeRotationX=16]="FreezeRotationX",s[s.FreezeRotationY=32]="FreezeRotationY",s[s.FreezeRotationZ=64]="FreezeRotationZ",s[s.FreezeRotation=112]="FreezeRotation",s[s.FreezeAll=126]="FreezeAll"})(Kn||(Kn={}));var sp;(function(s){s[s.None=0]="None",s[s.X=2]="X",s[s.Y=4]="Y",s[s.Z=8]="Z",s[s.All=-1]="All"})(sp||(sp={}));const Mr=function(s,e){return function(t,i,n){sle(t,i,n,s,e)}};function sle(s,e,t,i,n){if(!n&&!i&&!s.onValidate)return;if(t!==void 0){console.error("Invalid usage of validate decorator. Only fields can be validated.",s,e,t),Pn("Invalid usage of validate decorator. Only fields can be validated. Property: "+e,os.Error);return}let r="";if(typeof e=="string"?r=e:r=e.name,s.__internalAwake){const o=Symbol(r),a=s.__internalAwake;s.__internalAwake=function(){var l;if(!this.onValidate){Xe()&&console.warn('Usage of @validate decorate detected but there is no onValidate method in your class: "'+((l=s.constructor)==null?void 0:l.name)+'"');return}if(this[o]===void 0){this[o]=this[r];const c=this[r];if(c instanceof Z||c instanceof w||c instanceof Je||c instanceof xe){const h=this[r];XC(h,()=>{this.onValidate(r)})}Object.defineProperty(this,r,{set:function(h){var d;if(this[TR]===!0)this[o]=h;else{i==null||i.call(this,h);const f=this[o];this[o]=h,(d=this.onValidate)==null||d.call(this,r,f)}},get:function(){return n==null||n.call(this),this[o]}})}a.call(this)}}}const rle=function(s){return function(e,t,i){let n="";typeof t=="string"?n=t:n=t.name;const r=s.prototype,o=Object.getOwnPropertyDescriptor(r,n);if(!(o!=null&&o.value)){console.warn("Can not apply prefix: type does not have method named",t,s);return}const a=o.value,l=e[n];Object.defineProperty(r,n,{value:function(...c){const h=l==null?void 0:l.call(this,...c);if(h instanceof Promise){h.then(d=>{if(d!==!1)return a.call(this,...c)});return}if(h!==!1)return a.call(this,...c)}})}};var Sa=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class ole{constructor(e,t){u(this,"positionChanged",!1);u(this,"rotationChanged",!1);u(this,"position");u(this,"quaternion");u(this,"_positionKeys",["x","y","z"]);u(this,"_quaternionKeys",["_x","_y","_z","_w"]);u(this,"mute",!1);u(this,"context");u(this,"obj");u(this,"_positionWatch");u(this,"_rotationWatch");this.context=t,this.obj=e}get isDirty(){return this.positionChanged||this.rotationChanged}reset(e=!1){if(this.positionChanged=!1,this.rotationChanged=!1,this.mute=!1,e){if(this.position)for(const t of this._positionKeys)delete this.position[t];if(this.quaternion)for(const t of this._quaternionKeys)delete this.quaternion[t]}}syncValues(){for(const e of this._positionKeys)this.position[e]=this.obj.position[e];for(const e of this._quaternionKeys)this.quaternion[e]=this.obj.quaternion[e]}applyValues(){if(this.positionChanged&&this.position)for(const e of this._positionKeys){const t=this.position[e];t!==void 0&&(this.obj.position[e]=t)}if(this.rotationChanged&&this.quaternion)for(const e of this._quaternionKeys){const t=this.quaternion[e];t!==void 0&&(this.obj.quaternion[e]=t)}}start(e,t){this.reset(),e&&(this._positionWatch||(this._positionWatch=new iu(this.obj.position,["x","y","z"])),this._positionWatch.apply(),this.position={},this._positionWatch.subscribeWrite((r,o)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const a=this.position[o];Math.abs(a-r)<1e-5||(this.position[o]=r,this.positionChanged=!0)})),t&&(this._rotationWatch||(this._rotationWatch=new iu(this.obj.quaternion,["_x","_y","_z","_w"])),this._rotationWatch.apply(),this.quaternion={},this._rotationWatch.subscribeWrite((r,o)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const a=this.quaternion[o];Math.abs(a-r)<1e-5||(this.quaternion[o]=r,this.rotationChanged=!0)}));const i=this.obj.matrixWorld.multiplyMatrices.bind(this.obj.matrixWorld),n=new fe;this.obj.matrixWorld.multiplyMatrices=(r,o)=>{var a;return(a=this.context.physics.engine)!=null&&a.isUpdating||this.mute||n.equals(r)||(this.positionChanged=!0,this.rotationChanged=!0,n.copy(r)),i(r,o)}}stop(){var e,t;(e=this._positionWatch)==null||e.revoke(),(t=this._rotationWatch)==null||t.revoke()}}const tC=class extends Te{constructor(){super(...arguments);u(this,"autoMass",!0);u(this,"_mass",0);u(this,"useGravity",!0);u(this,"centerOfMass",new w(0,0,0));u(this,"constraints",Kn.None);u(this,"isKinematic",!1);u(this,"drag",0);u(this,"angularDrag",1);u(this,"detectCollisions",!0);u(this,"sleepThreshold",.01);u(this,"collisionDetectionMode",w0.Discrete);u(this,"_gravityScale",1);u(this,"dominanceGroup",0);u(this,"_propertiesChanged",!1);u(this,"_currentVelocity",new w);u(this,"_smoothedVelocity",new w);u(this,"_smoothedVelocityGetter",new w);u(this,"_lastPosition",new w);u(this,"_watch")}set mass(t){t!==this._mass&&(this._mass=t,this._propertiesChanged=!0,this.__didAwake&&(this.autoMass=!1))}get mass(){var t,i;return this.autoMass?((i=(t=this.context.physics.engine)==null?void 0:t.getBody(this))==null?void 0:i.mass())??-1:this._mass}get lockPositionX(){return(this.constraints&Kn.FreezePositionX)!==0}get lockPositionY(){return(this.constraints&Kn.FreezePositionY)!==0}get lockPositionZ(){return(this.constraints&Kn.FreezePositionZ)!==0}get lockRotationX(){return(this.constraints&Kn.FreezeRotationX)!==0}get lockRotationY(){return(this.constraints&Kn.FreezeRotationY)!==0}get lockRotationZ(){return(this.constraints&Kn.FreezeRotationZ)!==0}set lockPositionX(t){t?this.constraints|=Kn.FreezePositionX:this.constraints&=~Kn.FreezePositionX}set lockPositionY(t){t?this.constraints|=Kn.FreezePositionY:this.constraints&=~Kn.FreezePositionY}set lockPositionZ(t){t?this.constraints|=Kn.FreezePositionZ:this.constraints&=~Kn.FreezePositionZ}set lockRotationX(t){t?this.constraints|=Kn.FreezeRotationX:this.constraints&=~Kn.FreezeRotationX}set lockRotationY(t){t?this.constraints|=Kn.FreezeRotationY:this.constraints&=~Kn.FreezeRotationY}set lockRotationZ(t){t?this.constraints|=Kn.FreezeRotationZ:this.constraints&=~Kn.FreezeRotationZ}set gravityScale(t){this._gravityScale=t}get gravityScale(){return this._gravityScale}awake(){this._watch=void 0,this._propertiesChanged=!1}onEnable(){var t;this._watch||(this._watch=new ole(this.gameObject,this.context)),this._watch.start(!0,!0),this.startCoroutine(this.beforePhysics(),Wt.LateUpdate),Xe()&&!((t=this.context.physics.engine)!=null&&t.getBody(this))&&(globalThis.false?console.warn(`Rigidbody could not be created. Ensure "(${this.name}" has a Collider component.`):console.warn("Rigidbody could not be created: Rapier physics are explicitly disabled."))}onDisable(){var t,i;(t=this._watch)==null||t.stop(),(i=this.context.physics.engine)==null||i.removeBody(this)}onDestroy(){var t;(t=this.context.physics.engine)==null||t.removeBody(this)}onValidate(){this._propertiesChanged=!0}*beforePhysics(){var t,i,n,r;for(;;)this._propertiesChanged&&(this._propertiesChanged=!1,(t=this.context.physics.engine)==null||t.updateProperties(this)),(i=this._watch)!=null&&i.isDirty?(this._watch.mute=!0,this._watch.applyValues(),(n=this.context.physics.engine)==null||n.updateBody(this,this._watch.positionChanged,this._watch.rotationChanged),this._watch.reset()):(r=this._watch)==null||r.syncValues(),this.captureVelocity(),yield}teleport(t,i=!0){var n;(n=this._watch)==null||n.reset(!0),i?this.gameObject.position.set(t.x,t.y,t.z):this.setWorldPosition(t.x,t.y,t.z),this.resetForcesAndTorques(),this.resetVelocities()}resetForces(t=!0){var i;(i=this.context.physics.engine)==null||i.resetForces(this,t)}resetTorques(t=!0){var i;(i=this.context.physics.engine)==null||i.resetTorques(this,t)}resetVelocities(){this.setVelocity(0,0,0),this.setAngularVelocity(0,0,0)}resetForcesAndTorques(){this.resetForces(),this.resetTorques()}wakeUp(){var t;(t=this.context.physics.engine)==null||t.wakeup(this)}get isSleeping(){var t;return(t=this.context.physics.engine)==null?void 0:t.isSleeping(this)}updateProperties(){var t;return this._propertiesChanged=!1,(t=this.context.physics.engine)==null?void 0:t.updateProperties(this)}applyForce(t,i,n=!0){var r;this._propertiesChanged&&this.updateProperties(),(r=this.context.physics.engine)==null||r.addForce(this,t,n)}applyImpulse(t,i=!0){var n;this._propertiesChanged&&this.updateProperties(),(n=this.context.physics.engine)==null||n.applyImpulse(this,t,i)}setForce(t,i,n,r=!0){var o,a,l;(o=this.context.physics.engine)==null||o.resetForces(this,r),typeof t=="number"?(i??(i=0),n??(n=0),(a=this.context.physics.engine)==null||a.addForce(this,{x:t,y:i,z:n},r)):(l=this.context.physics.engine)==null||l.addForce(this,t,r)}getVelocity(){var i;const t=(i=this.context.physics.engine)==null?void 0:i.getLinearVelocity(this);return t?(this._currentVelocity.x=t.x,this._currentVelocity.y=t.y,this._currentVelocity.z=t.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setVelocity(t,i,n,r=!0){var o,a;if(t instanceof w){const l=t;(o=this.context.physics.engine)==null||o.setLinearVelocity(this,l,r);return}i===void 0||n===void 0||(a=this.context.physics.engine)==null||a.setLinearVelocity(this,{x:t,y:i,z:n},r)}getAngularVelocity(){var i;const t=(i=this.context.physics.engine)==null?void 0:i.getAngularVelocity(this);return t?(this._currentVelocity.x=t.x,this._currentVelocity.y=t.y,this._currentVelocity.z=t.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setAngularVelocity(t,i,n,r=!0){var o,a;if(typeof t=="object"){const l=t;(o=this.context.physics.engine)==null||o.setAngularVelocity(this,l,r);return}if(i===void 0||n===void 0||typeof i=="boolean"){console.warn("setAngularVelocity expects either a Vec3 or 3 numbers");return}(a=this.context.physics.engine)==null||a.setAngularVelocity(this,{x:t,y:i,z:n},r)}setTorque(t,i,n){typeof t=="number"?this.setAngularVelocity(t,i,n):this.setAngularVelocity(t)}get smoothedVelocity(){return this._smoothedVelocityGetter.copy(this._smoothedVelocity),this._smoothedVelocityGetter.multiplyScalar(1/this.context.time.deltaTime)}setBodyFromGameObject(t=null){}captureVelocity(){const t=Qt(this.gameObject);this.gameObject.matrixWorld.decompose(tC.tempPosition,ale,lle);const i=t.sub(this._lastPosition);this._lastPosition.copy(tC.tempPosition),this._smoothedVelocity.lerp(i,this.context.time.deltaTime/.1)}};let Ci=tC;u(Ci,"tempPosition",new w);Sa([Mr()],Ci.prototype,"autoMass",void 0);Sa([x()],Ci.prototype,"mass",null);Sa([Mr(),x()],Ci.prototype,"useGravity",void 0);Sa([x(w)],Ci.prototype,"centerOfMass",void 0);Sa([Mr(),x()],Ci.prototype,"constraints",void 0);Sa([Mr(),x()],Ci.prototype,"isKinematic",void 0);Sa([Mr(),x()],Ci.prototype,"drag",void 0);Sa([Mr(),x()],Ci.prototype,"angularDrag",void 0);Sa([Mr(),x()],Ci.prototype,"detectCollisions",void 0);Sa([Mr(),x()],Ci.prototype,"sleepThreshold",void 0);Sa([Mr(),x()],Ci.prototype,"collisionDetectionMode",void 0);Sa([Mr()],Ci.prototype,"_gravityScale",void 0);Sa([Mr()],Ci.prototype,"dominanceGroup",void 0);new w;const ale=new xe,lle=new w,Ku=ie("debugsync"),S0="STRS";mD(S0,Wh.getRootAsSyncedTransformModel);const Kl=new u_;function OQ(s,e,t=!0){Kl.clear();const i=Kl.createString(s);Wh.startSyncedTransformModel(Kl),Wh.addGuid(Kl,i),Wh.addFast(Kl,t);const n=e.worldPosition,r=e.worldEuler,o=e.gameObject.scale;Wh.addTransform(Kl,DQ.createTransform(Kl,n.x,n.y,n.z,r.x,r.y,r.z,o.x,o.y,o.z));const a=Wh.endSyncedTransformModel(Kl);return Kl.finish(a,S0),Kl.asUint8Array()}let qR=0,bA=0;KD(s=>{var i;const t=((i=s.connection.currentServerUrl)==null?void 0:i.includes("glitch"))?10:40;bA=Math.floor(qR/t),qR=0,Ku&&bA>0&&console.log("Sync Transform Fast Interval",bA)});class Kc extends Te{constructor(){super(...arguments);u(this,"overridePhysics",!0);u(this,"interpolatePosition",!0);u(this,"interpolateRotation",!0);u(this,"fastMode",!1);u(this,"syncDestroy",!1);u(this,"_model",null);u(this,"_needsUpdate",!0);u(this,"rb",null);u(this,"_wasKinematic",!1);u(this,"_receivedDataBefore",!1);u(this,"_targetPosition");u(this,"_targetRotation");u(this,"_receivedFastUpdate",!1);u(this,"_shouldRequestOwnership",!1);u(this,"joinedRoomCallback",null);u(this,"receivedDataCallback",null);u(this,"tempEuler",new oi);u(this,"receivedUpdate",!1);u(this,"lastWorldPos");u(this,"lastWorldRotation")}requestOwnership(){Ku&&console.log("Request ownership"),this._model?this._model.requestOwnership():(this._shouldRequestOwnership=!0,this._needsUpdate=!0)}hasOwnership(){var t;return((t=this._model)==null?void 0:t.hasOwnership)??void 0}isOwned(){var t;return(t=this._model)==null?void 0:t.isOwned}awake(){Ku&&console.log("new instance",this.guid,this),this._receivedDataBefore=!1,this._targetPosition=new w,this._targetRotation=new xe,this.lastWorldPos=new w,this.lastWorldRotation=new xe,this.rb=ne.getComponentInChildren(this.gameObject,Ci),this.rb&&(this._wasKinematic=this.rb.isKinematic),this.receivedUpdate=!0,this._model=new bD(this.context.connection,this.guid),this.context.connection.isConnected&&this.tryGetLastState(),this.joinedRoomCallback=this.tryGetLastState.bind(this),this.context.connection.beginListen(Ut.JoinedRoom,this.joinedRoomCallback),this.receivedDataCallback=this.onReceivedData.bind(this),this.context.connection.beginListenBinary(S0,this.receivedDataCallback)}onDestroy(){this.syncDestroy&&MD(this.guid,this.context.connection),this._model=null,this.context.connection.stopListen(Ut.JoinedRoom,this.joinedRoomCallback),this.context.connection.stopListenBinary(S0,this.receivedDataCallback)}tryGetLastState(){const t=this.context.connection.tryGetState(this.guid);t&&this.onReceivedData(t)}onReceivedData(t){var i;if(!this.destroyed&&typeof t.guid=="function"&&t.guid()===this.guid){Ku&&console.log("new data",this.context.connection.connectionId,this.context.time.frameCount,this.guid,t),this.receivedUpdate=!0,this._receivedFastUpdate=t.fast();const n=t.transform();if(n){Ya.markDirty(this.gameObject,!0);const r=n.position();r&&(this.interpolatePosition&&((i=this._targetPosition)==null||i.set(r.x(),r.y(),r.z())),(!this.interpolatePosition||!this._receivedDataBefore)&&this.setWorldPosition(r.x(),r.y(),r.z()));const o=n.rotation();o&&(this.tempEuler.set(o.x(),o.y(),o.z()),this.interpolateRotation&&this._targetRotation.setFromEuler(this.tempEuler),(!this.interpolateRotation||!this._receivedDataBefore)&&$B(this.gameObject,this.tempEuler))}this._receivedDataBefore=!0}}onEnable(){this.lastWorldPos.copy(this.worldPosition),this.lastWorldRotation.copy(this.worldQuaternion),this._needsUpdate=!0,this._model&&this._model.updateIsOwned()}onDisable(){this._model&&this._model.freeOwnership()}onBeforeRender(){if(!this.activeAndEnabled||!this.context.connection.isConnected)return;if(!this.context.connection.isInRoom||!this._model){Ku&&console.log("no model or room",this.name,this.guid,this.context.connection.isInRoom);return}this._shouldRequestOwnership&&(this._shouldRequestOwnership=!1,this._model.requestOwnership());const t=this.worldPosition,i=this.worldQuaternion;if(this._model.isOwned&&!this.receivedUpdate){const o=t.distanceTo(this.lastWorldPos),a=i.angleTo(this.lastWorldRotation),l=this._model.hasOwnership||this.fastMode?1e-4:.001;(o>l||a>l)&&(this._model.hasOwnership?this._needsUpdate=!0:(Ku&&console.log(this.guid,"reset because not owned but",this.gameObject.name,this.lastWorldPos),this.worldPosition=this.lastWorldPos,t.copy(this.lastWorldPos),this.worldQuaternion=this.lastWorldRotation,i.copy(this.lastWorldRotation),Ya.markDirty(this.gameObject,!0),this._needsUpdate=!1))}if(this._model&&!this._model.hasOwnership&&this._model.isOwned&&this._receivedDataBefore){const a=this._receivedFastUpdate||this.fastMode?.5:.3;let l=!1;if(this.interpolatePosition&&this._targetPosition){const c=this.worldPosition;c.lerp(this._targetPosition,a),this.worldPosition=c,l=!0}if(this.interpolateRotation&&this._targetRotation){const c=this.worldQuaternion;c.slerp(this._targetRotation,a),this.worldQuaternion=c,l=!0}l&&Ya.markDirty(this.gameObject,!0)}if(this.receivedUpdate=!1,this.lastWorldPos.copy(t),this.lastWorldRotation.copy(i),!this._model||!this._model||this._model.hasOwnership===void 0||!this._model.hasOwnership)return;this.rb&&this.overridePhysics&&this._wasKinematic!==void 0&&(Ku&&console.log("reset kinematic",this.rb.name,this._wasKinematic),this.rb.isKinematic=this._wasKinematic);const n=10,r=this.rb||this.fastMode;if(this._needsUpdate&&(this.context.time.frameCount%n===0||r)){if(qR++,r&&bA>0&&this.context.time.frameCount%bA!==0)return;Ku&&console.log("send update",this.context.connection.connectionId,this.guid,this.gameObject.name,this.gameObject.guid),this._needsUpdate=!1;const o=OQ(this.guid,this,!!r);this.context.connection.sendBinary(o)}}}const cle=ie("debugshadowcomponents");WB.prototype.interactable={get(){return this.interactive},set(s){this.interactable=s}};const Qa=Symbol("shadowDomOwner");class $a extends Te{constructor(){super(...arguments);u(this,"_shadowComponent",null);u(this,"_controlsChildLayout",!0);u(this,"_root");u(this,"_parentComponent")}isRoot(){var t;return((t=this.Root)==null?void 0:t.gameObject)===this.gameObject}get canvas(){const t=this.Root;return t!=null&&t.isCanvas?t:null}get Canvas(){return this.canvas}markDirty(){zo.markUIDirty(this.context)}get shadowComponent(){return this._shadowComponent}set shadowComponent(t){this._shadowComponent=t}get controlsChildLayout(){return this._controlsChildLayout}set controlsChildLayout(t){this._controlsChildLayout=t,this.shadowComponent&&(this.shadowComponent.autoLayout=t)}get Root(){return this._root===void 0&&(this._root=ne.getComponentInParent(this.gameObject,S_)),this._root}__internalNewInstanceCreated(t){return super.__internalNewInstanceCreated(t),this.shadowComponent=null,this._root=void 0,this._parentComponent=void 0,this}onEnable(){super.onEnable()}addShadowComponent(t,i){var o;if(!t)return;this.removeShadowComponent();const n=this.isRoot()?this.gameObject:this.gameObject.parent;if(this._parentComponent=ne.getComponentInParent(n,$a),!this._parentComponent){console.warn(`Component "${this.name}" doesn't have a UI parent anywhere. Do you have an UI element outside a Canvas? UI components must be a child of a Canvas component`,this);return}t.name=this.name+" ("+(this.constructor.name??"UI")+")",t.autoLayout=this._parentComponent.controlsChildLayout,t[Qa]=this,this.setShadowComponentOwner(t);let r=!1;if(((o=this.Root)==null?void 0:o.gameObject)===this.gameObject)this.gameObject.add(t);else{const a=this._parentComponent.shadowComponent;a&&(a==null||a.add(t),r=!0)}this.shadowComponent=t,i&&i.shadowComponent&&this.shadowComponent&&i.shadowComponent.add(this.shadowComponent),m_&&t.add(new xo(.5)),this.onAfterAddedToScene(),r&&XG(),cle&&console.warn("Added shadow component",this.shadowComponent)}setShadowComponentOwner(t){if(t&&(t[Qa]===void 0||t[Qa]===this)&&(t[Qa]=this,t.children))for(const i of t.children)this.setShadowComponentOwner(i)}traverseOwnedShadowComponents(t,i,n){if(t&&t[Qa]===i){n(t);for(const r of t.children)this.traverseOwnedShadowComponents(r,i,n)}}removeShadowComponent(){this.shadowComponent&&this.shadowComponent.removeFromParent()}onAfterAddedToScene(){}setInteractable(t){this.shadowComponent&&(this.shadowComponent.interactable=t)}}class S_ extends $a{awake(){super.awake()}}class Ev{constructor(e,t){u(this,"event");u(this,"button");u(this,"buttonName");u(this,"_used",!1);u(this,"_propagationStopped",!1);u(this,"z__pointer_ctured",!1);u(this,"z__pointer_cture_rleased",!1);u(this,"inputSource");u(this,"object");u(this,"point");u(this,"normal");u(this,"face");u(this,"distance");u(this,"instanceId");u(this,"intersection");u(this,"isDown");u(this,"isUp");u(this,"isPressed");u(this,"isClick");u(this,"isDoubleClick");u(this,"input");this.event=t,this.input=e,this.button=t.button}get deviceIndex(){return this.event.deviceIndex}get pointerId(){return this.event.pointerId}get pressure(){return this.event.pressure}get used(){return this._used}use(){this._used||(this._used=!0,this.event.use())}get propagationStopped(){return this._propagationStopped}stopPropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}stopImmediatePropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}setPointerCapture(){this.z__pointer_ctured=!0}releasePointerCapture(){this.z__pointer_cture_rleased=!0}get mode(){return this.event.mode}clone(){const e=new Ev(this.input,this.event);return Object.assign(e,this),e}Use(){this.use()}StopPropagation(){this.event.stopImmediatePropagation()}}function CS(s,e){return ne.foreachComponent(s,i=>{if(!i.enabled)return;const n=i;if(e)switch(e){case"pointerdown":if(n.onPointerDown)return!0;break;case"pointerup":if(n.onPointerUp||n.onPointerClick)return!0;break;case"pointermove":if(n.onPointerEnter||n.onPointerExit||n.onPointerMove)return!0;break}else if(n.onPointerDown||n.onPointerUp||n.onPointerEnter||n.onPointerExit||n.onPointerClick)return!0},!1)===!0}const bh=new Array;class bc{constructor(e,t,i,n){u(this,"enabled",!0);u(this,"target");u(this,"methodName");u(this,"arguments");this.target=e,this.methodName=t||null,this.arguments=i,n!=null&&(this.enabled=n)}get canClone(){return this.target instanceof Object}invoke(...e){if(this.enabled!==!1){if(typeof this.target=="function")this.arguments?(bh.length=0,e!==void 0&&e.length>0&&bh.push(...e),bh.push(...this.arguments),this.target(...this.arguments),bh.length=0):this.target(...e);else if(this.methodName!=null){const t=this.target[this.methodName];typeof t=="function"?this.arguments?(bh.length=0,e!==void 0&&e.length>0&&bh.push(...e),bh.push(...this.arguments),t.call(this.target,...bh),bh.length=0):t.call(this.target,...e):this.arguments?this.target[this.methodName]=this.arguments[0]||e[0]:this.target[this.methodName]=e[0]}}}}const hle=s=>/^[A-Z]*$/.test(s);class wE extends Event{constructor(){super(...arguments);u(this,"args")}}class un{constructor(e){u(this,"isEventList",!0);u(this,"target");u(this,"key");u(this,"_isInvoking",!1);u(this,"methods",[]);u(this,"_methodsCopy",[]);if(this.methods=[],Array.isArray(e))for(const t of e)t instanceof bc?this.methods.push(t):typeof t=="function"&&this.methods.push(new bc(t));else typeof e=="function"&&this.methods.push(new bc(e))}__internalOnInstantiate(e){var n;const t=new Array;for(let r=0;r<this.methods.length;r++){const o=this.methods[r];if(!(o.target instanceof Function)){const a=o.target;let l=a==null?void 0:a.uuid;if(a&&(l=a.guid),l){const c=e[l];if(c){const h=(n=o.arguments)==null?void 0:n.map(d=>d instanceof Object&&d.uuid?e[d.uuid]:d!=null&&d.isComponent?e[d.guid]:d);t.push(new bc(c.clone,o.methodName,h,o.enabled))}else Xe()&&console.warn("Could not find target for event listener")}}}return new un(t)}setEventTarget(e,t){if(this.key=e,this.target=t,this.key!==void 0){let i="",n=!1;for(const r of this.key)n&&hle(r)&&(i+="-"),n=!0,i+=r.toLowerCase();this.key=i}}get listenerCount(){var e;return((e=this.methods)==null?void 0:e.length)??0}get isInvoking(){return this._isInvoking}static from(...e){return new un(e)}invoke(...e){var t;if(this._isInvoking)return console.warn("Circular event invocation detected. Please check your event listeners for circular references.",this),!1;if(((t=this.methods)==null?void 0:t.length)<=0)return!1;this._isInvoking=!0;try{this._methodsCopy.length=0,this._methodsCopy.push(...this.methods);for(const i of this._methodsCopy)i.invoke(...e);if(typeof this.target=="object"&&typeof this.key=="string"){const i=this.target.dispatchEvent;if(typeof i=="function"){const n=new wE(this.key);n.args=e,i.call(this.target,n)}}}finally{this._isInvoking=!1,this._methodsCopy.length=0}return!0}addEventListener(e){return this.methods.push(new bc(e)),e}removeEventListener(e){if(e)for(let t=this.methods.length-1;t>=0;t--)this.methods[t].target===e&&(this.methods[t].enabled=!1,this.methods.splice(t,1))}removeAllEventListeners(){this.methods.length=0}}class ule extends tl{constructor(){super([me,Vi],"ColorSerializer")}onDeserialize(e){if(e!=null)return e.a!==void 0?new Vi(e.r,e.g,e.b,e.a):e.alpha!==void 0?new Vi(e.r,e.g,e.b,e.alpha):new me(e.r,e.g,e.b)}onSerialize(e){if(e!=null)return e.a!==void 0?{r:e.r,g:e.g,b:e.b,a:e.a}:{r:e.r,g:e.g,b:e.b}}}const dle=new ule;class fle extends tl{constructor(){super([oi],"EulerSerializer")}onDeserialize(e,t){if(e!=null){if(e.order)return new oi(e.x,e.y,e.z,e.order);if(e.x!=null)return new oi(e.x,e.y,e.z)}}onSerialize(e,t){return{x:e.x,y:e.y,z:e.z,order:e.order}}}const ple=new fle;class mle extends tl{constructor(){super(ge,"ObjectSerializer")}onSerialize(e,t){if(t.objectToNode!==void 0&&e.uuid){const i=t.objectToNode[e.uuid];return qs&&console.log(i,e.name,e.uuid),{node:i}}}onDeserialize(e,t){var i,n,r;if(typeof e=="string"){if(e.endsWith(".glb")||e.endsWith(".gltf")){if(t.serializable instanceof Array&&t.serializable.includes(si))return;Xe()&&Yi("Detected wrong usage of @serializable with Object3D or GameObject. Instead you should use AssetReference here! Please see the console for details.");const o=(n=(i=t.target)==null?void 0:i.constructor)==null?void 0:n.name;console.warn(`Wrong usage of @serializable detected in your script "${o}"

It looks like you used @serializable(Object3D) or @serializable(GameObject) for a prefab or scene reference which is exported to a separate glTF file.

To fix this please change your code to:

@serializable(AssetReference)
${t.path}! : AssetReference;
\0`)}return}if(e){if(e.node!==void 0&&t.nodeToObject){const o=t.nodeToObject[e.node];return qs&&console.log("Deserialized object reference?",e,o,t==null?void 0:t.nodeToObject),o||console.warn("Did not find node: "+e.node,t.nodeToObject,t.object),o}else if(e.guid){if(!t.context){console.error("Missing context");return}let o;const a=(r=t.gltf)==null?void 0:r.scene;return a&&(o=ne.findByGuid(e.guid,a)),o||(o=ne.findByGuid(e.guid,t.context.scene)),o?(o&&o.isComponent===!0&&(qs&&console.warn("Deserialized object reference is a component"),o=o.gameObject),qs&&console.log("Deserialized object reference?",e,o,t==null?void 0:t.nodeToObject)):((Xe()||qs)&&console.warn("Could not resolve object reference",t.path,e,t.target,t.context.scene),e.could_not_resolve=!0),o}}}}const LQ=new mle;class gle extends tl{constructor(){super([Te,Te],"ComponentSerializer")}onSerialize(e,t){if(e!=null&&e.guid)return{guid:e.guid}}onDeserialize(e,t){var i;if(e!=null&&e.guid){if(e.___persistentAsset){qs&&console.log("Skipping component deserialization because it's a persistent asset",e);return}const n=t.path;qs&&console.log(e.guid,t.root,t.object,t.target);let r=this.findObjectForGuid(e.guid,t.root);if(r||t.context&&(r=this.findObjectForGuid(e.guid,(i=t.context)==null?void 0:i.scene),r))return r;(Xe()||qs)&&console.warn('Could not resolve component reference: "'+n+'" using guid '+e.guid,t.target),e.could_not_resolve=!0;return}}findObjectForGuid(e,t){if(t.guid===e)return t;const i=ne.foreachComponent(t,n=>{if(n.guid===e)return n},!1);if(i!==void 0)return i;for(let n=0;n<t.children.length;n++){const r=t.children[n],o=this.findObjectForGuid(e,r);if(o)return o}}}const Rw=new gle;class vle extends tl{constructor(){super([un])}onSerialize(e,t){console.log("TODO: SERIALIZE EVENT")}onDeserialize(e,t){var i,n,r;if(typeof e=="function")return new un([new bc(e,null,[],!0)]);if(e&&e.type==="EventList"){qs&&console.log("DESERIALIZE EVENT",e);const o=new Array;if(e.calls&&Array.isArray(e.calls))for(const c of e.calls){let f=function(p){if(typeof p=="object"){let m=LQ.onDeserialize(p,t);if(m||(m=Rw.onDeserialize(p,t)),m)return m}return p};qs&&console.log(c);let h=Rw.findObjectForGuid(c.target,t.root);!h&&((i=t.context)!=null&&i.scene)&&(h=Rw.findObjectForGuid(c.target,(n=t.context)==null?void 0:n.scene));const d=((r=c.method)==null?void 0:r.length)>0;if(h&&d){const p=()=>{const v=c.method[0].toUpperCase()+c.method.slice(1);if(typeof h[v]=="function"){console.warn(`EventList method:
Could not find method ${c.method} on object ${h.name}. Please rename ${c.method} to ${v}?
`,h[v],`
 in script: `,h),Yi("EventList methods must start with lowercase letter, see console for details");return}else console.warn(`EventList method:
Could not find method ${c.method} on object ${h.name}`,h,typeof h[c.method])};if(typeof h[c.method]!="function"){let v=!1,y=h;for(;y;){const g=Object.getOwnPropertyDescriptor(y,c.method);if(g&&(g.writable===!0||g.set)){v=!0;break}y=Object.getPrototypeOf(y)}!v&&(Xe()||qs)&&p()}}if(h){let p=c.argument;if(p!==void 0?p=f(p):c.arguments!==void 0&&(p=c.arguments.map(f)),!h[c.method])console.warn(`EventList method not found: "${c.method}" on ${h==null?void 0:h.name}`);else{p!==void 0&&!Array.isArray(p)&&(p=[p]);const v=new bc(h,c.method,p,c.enabled);o.push(v)}}else Xe()&&console.warn("[Debug] EventList: Could not find event listener in scene",c,t.object,e)}const a=new un(o);qs&&console.log(a);const l=t.target;return l!==void 0&&t.path!==void 0&&a.setEventTarget(t.path,l),a}}}const yle=new vle,ES=new WeakMap,Ale=Pt.prototype.clone;Pt.prototype.clone=function(){const s=Ale.call(this);return ES.has(s)||ES.set(s,this),s};class kQ extends tl{constructor(){super([_d,Yt])}onSerialize(e,t){}onDeserialize(e,t){if(e instanceof Pt&&t.type===_d){let i=e;ES.has(i)&&(i=ES.get(i)),i.isRenderTargetTexture=!0,i.flipY=!0,i.offset.y=1,i.repeat.y=-1,i.needsUpdate=!0,i.mipmaps=[],i instanceof Oc&&(i.isCompressedTexture=!1,i.format=Ti);const n=new _d(i.image.width,i.image.height,{colorSpace:Ui});return n.texture=i,n}}}new kQ;class FQ extends tl{constructor(){super([URL])}onSerialize(e,t){return null}onDeserialize(e,t){if(typeof e=="string"&&e.length>0)return zd(t.gltfId,e)}}new FQ;var _le=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class C_ extends Te{awake(){zo.createIfNoneExists(this.context)}onEnable(){var e;(e=zo.get(this.context))==null||e.register(this)}onDisable(){var e;(e=zo.get(this.context))==null||e.unregister(this)}}class xa extends C_{constructor(){super(...arguments);u(this,"targets",null);u(this,"raycastHits",[]);u(this,"ignoreSkinnedMeshes",!1)}start(){this.targets=[this.gameObject]}performRaycast(t=null){if(!this.targets)return null;t??(t=new Yc),t.targets=this.targets,t.results=this.raycastHits,t.useAcceleratedRaycast=!0;const i=t.testObject;this.ignoreSkinnedMeshes&&(t.testObject=r=>r instanceof ga?"continue in children":i?i(r):!0);const n=this.context.physics.raycast(t);return t.testObject=i,n}}_le([x()],xa.prototype,"ignoreSkinnedMeshes",void 0);class SE extends xa{constructor(){super(),this.ignoreSkinnedMeshes=!0}}const p2=class extends C_{performRaycast(e){if(!It.active||!p2.allow||!(e!=null&&e.ray))return null;const t=e.ray.origin,i=.015;return this.context.physics.sphereOverlap(t,i,!1,!0)}};let bd=p2;u(bd,"allow",!0);class CE{static getObject(e){const t=e[Qa];return t&&(t.isComponent===!0?e=t.gameObject:e=t),e}static isInteractable(e,t){if(t&&(t.canvasGroup=void 0,t.graphic=void 0),e==null||!e.visible||(e=this.getObject(e),!e.visible))return!1;const i=this.tryFindCanvasGroup(e);if((i==null?void 0:i.isCanvasGroup)===!0&&(t&&(t.canvasGroup=i),i.blocksRaycasts===!1||i.interactable===!1))return!1;const n=Np(e,r=>{if(r.isGraphic===!0)return r},!1);return t&&(n==null?void 0:n.isGraphic)===!0&&(t.graphic=n),!((n==null?void 0:n.raycastTarget)===!1||(n==null?void 0:n.layer)===2)}static tryFindCanvasGroup(e){if(!e)return null;const t=Np(e,i=>{const n=i;if(n.blocksRaycasts!==void 0&&n.interactable!==void 0)return n},!1);return t!==void 0?t:this.tryFindCanvasGroup(e.parent)}}function JD(s){const e=s[Qa];return e||(s.parent?JD(s.parent):null)}function ble(s){return s.isUI===!0||typeof s[Qa]=="object"}function TS(s,e){if(!s)return;const t=s.material;if((t==null?void 0:t.isMaterial)===!0){const i=s.parent;i&&i.isText,t.side=e.doubleSided??!0?Pi:As,t.shadowSide=e.doubleSided?Pi:As,s.castShadow=e.castShadows?e.castShadows:!1,s.receiveShadow=e.receiveShadows?e.receiveShadows:!1}for(const i of s.children)TS(i,e)}function Zm(s,e,t){s[e]===void 0&&console.warn("Field",e,"is undefined on",s);const i=Proxy.revocable(s[e],{set(o,a,l,c){const h=o[a],d=Reflect.set(o,a,l,c);return t(l,h),d}}),n=i.revoke,r=s[e];return i.revoke=()=>{s[e]=r,n()},s[e]=i.proxy,i}const qU=Symbol("Scheduled action");function xle(s,e,t=Wt.OnBeforeRender){let i=s[qU];i||(i=s[qU]={});const n=e.name;i[t]||(i[t]={});const r=i[t];if(r[n])return;function*a(){e==null||e.call(s),r[n]=null}const l=s.startCoroutine(a(),t);r[n]=l}const Eh=ie("debugeventsystem");var ov;(function(s){s.BeforeHandleInput="BeforeHandleInput",s.AfterHandleInput="AfterHandleInput"})(ov||(ov={}));const cc=class extends Te{constructor(){super();u(this,"raycaster",[]);u(this,"pressedByID",new Map);u(this,"hoveredByID",new Map);u(this,"onPointerEvent",t=>{if(t===void 0||t.propagationStopped||t.defaultPrevented||t.used)return;const i=new Ev(this.context.input,t);this._currentPointerEventName=t.type,i.inputSource=this.context.input,i.isClick=t.isClick,i.isDoubleClick=t.isDoubleClick,i.isDown=t.type==Ai.PointerDown,i.isUp=t.type==Ai.PointerUp,i.isPressed=this.context.input.getPointerPressed(t.pointerId),Eh&&(i.isDown?console.log("DOWN",i.pointerId):i.isUp&&console.log("UP",i.pointerId),i.isClick&&console.log("CLICK",i.pointerId));const n=new Yc;t.hasRay?n.ray=t.ray:n.screenPoint=this.context.input.getPointerPositionRC(t.pointerId);const r=this.performRaycast(n);if(r){for(const a of r)a.event=t,t.intersections.push(a);t.origin.onPointerHits&&t.origin.onPointerHits({sender:this,event:t,hits:r})}Eh&&i.isClick&&Pn("EventSystem: "+i.pointerId+" - "+this.context.time.frame+" - Up:"+i.isUp+", Down:"+i.isDown);const o={sender:this,args:i,hasActiveUI:this.currentActiveMeshUIComponents.length>0};this.dispatchEvent(new CustomEvent(ov.BeforeHandleInput,{detail:o})),this.handleIntersections(r,i),this.dispatchEvent(new CustomEvent(ov.AfterHandleInput,{detail:o}))});u(this,"_sortedHits",[]);u(this,"_testObjectsCache",new Map);u(this,"_currentlyActiveRaycaster",null);u(this,"_currentPointerEventName",null);u(this,"shouldRaycastObject",t=>{var r;let i=null;if(ble(t)&&(i=(r=t[Qa])==null?void 0:r.gameObject),this._testObjectsCache.has(t)||i&&this._testObjectsCache.has(i))return this._testObjectsCache.get(t)===!1?"continue in children":!0;{let o=CS(t,this._currentPointerEventName);if(!o&&i&&(o=CS(i,this._currentPointerEventName)),o){this._testObjectsCache.set(t,!0);for(const a of t.children)this.shouldRaycastObject_AddToYesCache(a);return!0}return this._testObjectsCache.set(t,!1),"continue in children"}});u(this,"_sortingBuffer",[]);u(this,"_noDepthTestingResults",[]);u(this,"out",{});u(this,"_capturedPointer",{});u(this,"pointerEnterSymbol",Symbol("pointerEnter"));u(this,"pointerExitSymbol",Symbol("pointerExit"));u(this,"currentActiveMeshUIComponents",[]);cc.systems.push(this)}static createIfNoneExists(t){this.didSearchEventSystem||(this.didSearchEventSystem=!0,cc.systems.length<=0&&cc.systems.push(...ne.findObjectsOfType(cc,t)));for(const n of cc.systems)if(n.context===t)return;const i=new ge;ne.addComponent(i,cc),t.scene.add(i)}static get systems(){const t=Ot.Current;return this._eventSystemMap.has(t)||this._eventSystemMap.set(t,[]),this._eventSystemMap.get(t)}static get(t){const i=this._eventSystemMap.get(t);return i&&i.length>0?i[0]:null}static get instance(){return this.systems[0]}static ensureUpdateMeshUI(t,i,n=!1){od.update(t,i,n)}static markUIDirty(t){od.markDirty()}get hasActiveUI(){return this.currentActiveMeshUIComponents.length>0}get isHoveringObjects(){return this.hoveredByID.size>0}onDestroy(){cc.systems.splice(cc.systems.indexOf(this),1)}start(){if(this.raycaster.length<=0&&!ne.findObjectOfType(C_,this.context)){const i=ne.addComponent(this.context.scene,xa);this.raycaster.push(i),(Xe()||Eh)&&console.warn("Added an ObjectRaycaster to the scene because no raycaster was found.")}}register(t){var i;t&&this.raycaster&&!this.raycaster.includes(t)&&((i=this.raycaster)==null||i.push(t))}unregister(t){var n,r;const i=(n=this.raycaster)==null?void 0:n.indexOf(t);i!==void 0&&i!==-1&&((r=this.raycaster)==null||r.splice(i,1))}onEnable(){this.context.input.addEventListener(Ai.PointerDown,this.onPointerEvent),this.context.input.addEventListener(Ai.PointerUp,this.onPointerEvent),this.context.input.addEventListener(Ai.PointerMove,this.onPointerEvent)}onDisable(){this.context.input.removeEventListener(Ai.PointerDown,this.onPointerEvent),this.context.input.removeEventListener(Ai.PointerUp,this.onPointerEvent),this.context.input.removeEventListener(Ai.PointerMove,this.onPointerEvent)}onBeforeRender(){this.resetMeshUIStates()}shouldRaycastObject_AddToYesCache(t){this._testObjectsCache.set(t,!0);for(const i of t.children)this.shouldRaycastObject_AddToYesCache(i)}performRaycast(t){if(!this.raycaster)return null;this._testObjectsCache.clear(),this._sortedHits.length=0,t||(t=new Yc),t.testObject=this.shouldRaycastObject;for(const i of this.raycaster){if(!i.activeAndEnabled)continue;this._currentlyActiveRaycaster=i;const n=i.performRaycast(t);this._currentlyActiveRaycaster=null,n&&n.length>0&&this._sortedHits.push(...n)}return this._sortedHits.sort((i,n)=>i.distance-n.distance),this._sortedHits}assignHitInformation(t,i){i?(t.intersection=i,t.point=i.point,t.normal=i.normal,t.face=i.face,t.distance=i.distance,t.instanceId=i.instanceId):(t.intersection=void 0,t.point=void 0,t.normal=void 0,t.face=void 0,t.distance=void 0,t.instanceId=void 0)}handleIntersections(t,i){var r;if(t!=null&&t.length){t=this.sortCandidates(t);for(const o of t){if(i.event.immediatePropagationStopped)return!1;if(this.assignHitInformation(i,o),this.handleEventOnObject(o.object,i))return!0}}this.assignHitInformation(i,t==null?void 0:t[0]),this.invokePointerCapture(i);const n=this.hoveredByID.get(i.pointerId);return n&&this.propagatePointerExit(n.obj,n.data,null),this.hoveredByID.delete(i.pointerId),i.isUp&&((r=this.pressedByID.get(i.pointerId))==null||r.handlers.forEach(o=>this.invokeOnPointerUp(i,o)),this.pressedByID.delete(i.pointerId)),!1}sortCandidates(t){this._sortingBuffer.length=0,this._noDepthTestingResults.length=0;for(let i=0;i<t.length;i++){const n=t[i],r=n.object;if(r.material&&r.material.depthTest===!1){this._noDepthTestingResults.push(n);continue}this._sortingBuffer.push(n)}for(const i of this._sortingBuffer)this._noDepthTestingResults.push(i);return this._noDepthTestingResults}handleEventOnObject(t,i){if(!this.testIsVisible(t))return i.isClick&&Eh&&console.log("not allowed",t),!1;if(i.pointerId===void 0)return Eh&&console.error("Event without pointer can't be handled",i),!1;i.object=t;const n=t.parent,r=i.isClick??!1;let o=null;if(n&&n.isUI){const d=(i.isPressed||i.isClick)??!1;if(n[Qa]){const f=n[Qa].gameObject;if(f){if(!CE.isInteractable(f,this.out))return!1;o=this.out.canvasGroup??null,this.handleMeshUIIntersection(t,d),t=f}}}r&&Eh&&console.log(this.context.time.frame,t);const a=this.hoveredByID.get(i.pointerId),l=a==null?void 0:a.obj;l!==t&&l&&this.propagatePointerExit(l,a.data,t);const h=this.hoveredByID.get(i.pointerId);if(h?(h.obj=t,h.data=i):this.hoveredByID.set(i.pointerId,{obj:t,data:i}),i.isDown){const d=this.pressedByID.get(i.pointerId);d?(d.obj=t,d.data=i):this.pressedByID.set(i.pointerId,{obj:t,data:i,handlers:new Set})}return(o===null||o.interactable)&&this.handleMainInteraction(t,i,l??null),!0}propagate(t,i){for(;t;)ne.foreachComponent(t,n=>{i(n)},!1),t=t.parent}handleMainInteraction(t,i,n){const r=this.pressedByID.get(i.pointerId),o=n!==t;let a=!0;switch(i.event.pointerType){case"mouse":case"touch":const l=this.context.input.getPointerPositionLastFrame(i.pointerId),c=this.context.input.getPointerPosition(i.pointerId);a=l&&!et.approximately(l,c);break}this.propagate(t,l=>{var h;const c=l;c.interactable!==!1&&(!c.activeAndEnabled||!c.enabled||(c.onPointerEnter&&o&&this.handlePointerEnter(c,i),i.isDown&&c.onPointerDown&&(c.onPointerDown(i),r==null||r.handlers.add(c),this.handlePointerCapture(i,c)),c.onPointerMove&&(a&&c.onPointerMove(i),this.handlePointerCapture(i,c)),i.isUp&&(c.onPointerUp&&(this.invokeOnPointerUp(i,c),r==null||r.handlers.delete(c)),c.onPointerExit&&((h=i.event)==null?void 0:h.pointerType)===Kh.Touch&&(this.handlePointerExit(c,i),this.hoveredByID.delete(i.pointerId))),i.isClick&&c.onPointerClick&&c.onPointerClick(i)))}),i.isUp&&(r==null||r.handlers.forEach(l=>{this.invokeOnPointerUp(i,l)}),this.pressedByID.delete(i.pointerId))}propagatePointerExit(t,i,n){this.propagate(t,r=>{if(!r.gameObject||r.destroyed)return;const o=r;if(o.onPointerExit||o.onPointerEnter){if(n&&this.isChild(n,r.gameObject))return;this.handlePointerExit(o,i)}})}invokeOnPointerUp(t,i){var n;(n=i.onPointerUp)==null||n.call(i,t),this.releasePointerCapture(t,i)}handlePointerEnter(t,i){t.onPointerEnter&&this.updatePointerState(t,i.pointerId,this.pointerEnterSymbol,!0)&&t.onPointerEnter(i),this.updatePointerState(t,i.pointerId,this.pointerExitSymbol,!1)}handlePointerExit(t,i){t.onPointerExit&&this.updatePointerState(t,i.pointerId,this.pointerExitSymbol,!0)&&t.onPointerExit(i),this.updatePointerState(t,i.pointerId,this.pointerEnterSymbol,!1)}updatePointerState(t,i,n,r){let o=t[n];if(r)return o&&o.includes(i)?!1:(o=o||[],o.push(i),t[n]=o,!0);{if(!o||!o.includes(i))return!1;const a=o.indexOf(i);return a!==-1&&o.splice(a,1),!0}}handlePointerCapture(t,i){if(t.z__pointer_ctured){t.z__pointer_ctured=!1;const n=t.pointerId;if(i.onPointerMove){const r=this._capturedPointer[n]||[];r.push(i),this._capturedPointer[n]=r}else Xe()&&!i.z__warned_no_pointermove&&(i.z__warned_no_pointermove=!0,console.warn("PointerCapture was requested but the component doesn't implement onPointerMove. It will not receive any pointer events"))}else t.z__pointer_cture_rleased&&(t.z__pointer_cture_rleased=!1,this.releasePointerCapture(t,i))}releasePointerCapture(t,i){const n=t.pointerId;if(this._capturedPointer[n]){const r=this._capturedPointer[n].indexOf(i);r!==-1&&(this._capturedPointer[n].splice(r,1),Eh&&console.log("released pointer capture",n,i,this._capturedPointer))}}invokePointerCapture(t){var i;if(t.event.type===Ai.PointerMove){const n=t.pointerId,r=this._capturedPointer[n];if(r){Eh&&console.log("Captured",n,r);for(let o=0;o<r.length;o++){const a=r[o];if(a.destroyed){r.splice(o,1),o--;continue}(i=a.onPointerMove)==null||i.call(a,t)}}}}isChild(t,i){return!t||!i?!1:t===i?!0:t.parent?this.isChild(t.parent,i):!1}handleMeshUiObjectWithoutShadowDom(t,i){return!t||!t.isUI?!0:this.handleMeshUIIntersection(t,i)}handleMeshUIIntersection(t,i){const n=od.updateState(t,i);return n&&this.currentActiveMeshUIComponents.push(n),n!==null}resetMeshUIStates(){if(this.context.input.getPointerPressedCount()>0&&od.resetLastSelected(),!(!this.currentActiveMeshUIComponents||this.currentActiveMeshUIComponents.length<=0)){for(let t=0;t<this.currentActiveMeshUIComponents.length;t++){const i=this.currentActiveMeshUIComponents[t];od.resetState(i)}this.currentActiveMeshUIComponents.length=0}}testIsVisible(t){return t?ne.isActiveSelf(t)?this.testIsVisible(t.parent):!1:!0}};let zo=cc;u(zo,"_eventSystemMap",new Map),u(zo,"didSearchEventSystem",!1);class od{static markDirty(){this.needsUpdate=!0}static update(e,t,i=!1){if(i){e.update();return}const n=t.time.frameCount;for(const r of this.lastUpdateFrame)if(r.context===t){if(n===r.frame)return;r.frame=n;let o=this.needsUpdate||n<1;r.nextUpdate<=n&&(o=!0),o&&(Eh&&console.log("Update threemeshui"),this.needsUpdate=!1,r.nextUpdate=n+60,e.update());return}this.lastUpdateFrame=[{context:t,frame:n,nextUpdate:n+60}],e.update(),this.needsUpdate=!1}static updateState(e,t){let i=null;if(e&&(i=this.findBlockInParent(e),i&&i!==this.lastSelected)){if(i.interactable===!1)return null;this.needsUpdate=!0}return i}static resetLastSelected(){const e=this.lastSelected;e&&(this.lastSelected=null,this.resetState(e))}static resetState(e){e&&(this.needsUpdate=!0)}static findBlockInParent(e){return e?e.isBlock?e:this.findBlockInParent(e.parent):null}}u(od,"lastSelected",null),u(od,"lastUpdateFrame",[]),u(od,"needsUpdate",!1);var On=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const lM=ie("debugorbit"),cM=ie("freecam"),Tx=ie("debugcamerafit"),Mx=ie("smoothcam"),wle={LEFT:"",UP:"",RIGHT:"",BOTTOM:""};let hM;var XR;(function(s){s.CameraTargetReached="target-reached"})(XR||(XR={}));class C0 extends CustomEvent{constructor(e,t){super(XR.CameraTargetReached,{detail:{controls:e,type:t}})}}class Ni extends Te{constructor(){super(...arguments);u(this,"autoTarget",!0);u(this,"autoFit",!1);u(this,"enableRotate",!0);u(this,"autoRotate",!1);u(this,"autoRotateSpeed",1);u(this,"minAzimuthAngle",1/0);u(this,"maxAzimuthAngle",1/0);u(this,"minPolarAngle",0);u(this,"maxPolarAngle",Math.PI);u(this,"enableKeys",!0);u(this,"enableDamping",!0);u(this,"dampingFactor",.1);u(this,"enableZoom",!0);u(this,"minZoom",0);u(this,"maxZoom",1/0);u(this,"zoomSpeed",1);u(this,"zoomToCursor",!1);u(this,"enablePan",!0);u(this,"lookAtConstraint",null);u(this,"lookAtConstraint01",1);u(this,"allowInterrupt",!0);u(this,"middleClickToFocus",!0);u(this,"doubleClickToFocus",!0);u(this,"clickBackgroundToFitScene",2);u(this,"debugLog",!1);u(this,"targetLerpDuration",1);u(this,"_controls",null);u(this,"_cameraObject",null);u(this,"_lookTargetLerpActive",!1);u(this,"_lookTargetStartPosition",new w);u(this,"_lookTargetEndPosition",new w);u(this,"_lookTargetLerp01",0);u(this,"_lookTargetLerpDuration",0);u(this,"_cameraLerpActive",!1);u(this,"_cameraStartPosition",new w);u(this,"_cameraEndPosition",new w);u(this,"_cameraLerp01",0);u(this,"_cameraLerpDuration",0);u(this,"_fovLerpActive",!1);u(this,"_fovLerpStartValue",0);u(this,"_fovLerpEndValue",0);u(this,"_fovLerp01",0);u(this,"_fovLerpDuration",0);u(this,"_inputs",0);u(this,"_enableTime",0);u(this,"_startedListeningToKeyEvents",!1);u(this,"_eventSystem");u(this,"_afterHandleInputFn");u(this,"_camera",null);u(this,"_syncedTransform");u(this,"_didSetTarget",0);u(this,"targetElement",null);u(this,"_activePointerEvents");u(this,"_lastTimeClickOnBackground",-1);u(this,"_clickOnBackgroundCount",0);u(this,"_onPointerDown",t=>{this._activePointerEvents.push(t)});u(this,"_onPointerUp",t=>{for(let i=this._activePointerEvents.length-1;i>=0;i--){const n=this._activePointerEvents[i];if(n.pointerId===t.pointerId&&n.button===t.button){this._activePointerEvents.splice(i,1);break}}if(this.clickBackgroundToFitScene>0&&t.isClick&&t.button===0){if(t.hasRay||t.intersections.push(...this.context.physics.raycast()),t.intersections.length<=0){const i=this.context.time.time-this._lastTimeClickOnBackground;this._lastTimeClickOnBackground=this.context.time.time,this.clickBackgroundToFitScene<=1||i<this.clickBackgroundToFitScene*.15?(this._clickOnBackgroundCount+=1,this._clickOnBackgroundCount>=this.clickBackgroundToFitScene-1&&this.fitCamera(this.context.scene.children,{immediate:!1})):this._clickOnBackgroundCount=0}lM&&console.log(this.clickBackgroundToFitScene,t.intersections.length,this._clickOnBackgroundCount)}});u(this,"_onPointerUpLate",t=>{this.doubleClickToFocus&&t.isDoubleClick&&!t.used&&this.setTargetFromRaycast()});u(this,"onControlsChangeStarted",()=>{this._syncedTransform&&this._syncedTransform.requestOwnership()});u(this,"_shouldDisable",!1);u(this,"__onPreRender",()=>{const t=this.context.pre_render_callbacks.indexOf(this.__onPreRender);t>=0&&this.context.pre_render_callbacks.splice(t,1),this.autoFit&&(this.autoFit=!1,this.fitCamera({centerCamera:"y",immediate:!0,objects:this.scene.children}))});u(this,"_haveAttachedKeyboardEvents",!1)}get isCameraController(){return!0}get controls(){return this._controls}get controllerObject(){return this._cameraObject}onStartInteraction(t){var i;(i=this.controls)==null||i.addEventListener("start",t)}get targetLerpSpeed(){return 5}set targetLerpSpeed(t){this.targetLerpDuration=1/t}awake(){this._didSetTarget=0,this._startedListeningToKeyEvents=!1}start(){this._eventSystem=zo.get(this.context)??void 0,this._eventSystem&&(this._afterHandleInputFn=this.afterHandleInput.bind(this),this._eventSystem.addEventListener(ov.AfterHandleInput,this._afterHandleInputFn))}onDestroy(){var t,i;(t=this._controls)==null||t.dispose(),(i=this._eventSystem)==null||i.removeEventListener(ov.AfterHandleInput,this._afterHandleInputFn)}onEnable(){this._didSetTarget=0,this._enableTime=this.context.time.time;const t=ne.getComponent(this.gameObject,Mi);this._camera=t;let i=t==null?void 0:t.threeCamera;if(!i&&this.gameObject instanceof zt&&(i=this.gameObject),i&&qI(i,this,!0),!this._controls&&i instanceof zt){this._cameraObject=i;const n=this.targetElement??this.context.renderer.domElement,r=i==null?void 0:i.quaternion.clone();this._controls=new PQ(i,n),i==null||i.quaternion.copy(r),hM===void 0&&(hM={...this._controls.keys})}this._controls&&(cM&&(this.enablePan=!0,this.enableZoom=!0,this.middleClickToFocus=!0,St.isMobileDevice()&&(this.doubleClickToFocus=!0)),this._controls.addEventListener("start",this.onControlsChangeStarted),this._startedListeningToKeyEvents||(this._startedListeningToKeyEvents=!0,this._controls.listenToKeyEvents(window.document.body))),this._syncedTransform=ne.getComponent(this.gameObject,Kc)??void 0,this.context.pre_render_callbacks.push(this.__onPreRender),this._activePointerEvents=[],this.context.input.addEventListener("pointerdown",this._onPointerDown,{queue:Uo.Early}),this.context.input.addEventListener("pointerup",this._onPointerUp,{queue:Uo.Early}),this.context.input.addEventListener("pointerup",this._onPointerUpLate,{queue:Uo.Late})}onDisable(){var t;(t=this._camera)!=null&&t.threeCamera&&qI(this._camera.threeCamera,this,!1),this._controls&&(this._controls.enabled=!1,this._controls.autoRotate=!1,this._controls.removeEventListener("start",this.onControlsChangeStarted)),this._activePointerEvents.length=0,this.context.input.removeEventListener("pointerdown",this._onPointerDown),this.context.input.removeEventListener("pointerup",this._onPointerUp),this.context.input.removeEventListener("pointerup",this._onPointerUpLate)}afterHandleInput(t){t.detail.args.pointerId===0&&(t.detail.args.isDown?this._controls&&this._eventSystem&&(this._shouldDisable=this._eventSystem.hasActiveUI):(!t.detail.args.isPressed||t.detail.args.isUp)&&(this._shouldDisable=!1))}onBeforeRender(){var i,n,r,o;if(!this._controls)return;if(this._cameraObject!==this.context.mainCamera){this._controls.enabled=!1;return}if(this._controls.enabled=!0,(this.context.input.getPointerDown(1)||this.context.input.getPointerDown(2)||this.context.input.mouseWheelChanged||this.context.input.getPointerPressed(0)&&((i=this.context.input.getPointerPositionDelta(0))!=null&&i.length())||0>.1)&&(this._inputs+=1),this._inputs>0&&this.allowInterrupt&&(this.enableRotate&&(this.autoRotate=!1),this._cameraLerpActive=!1,this._lookTargetLerpActive=!1),this._inputs=0,this.autoTarget&&this._didSetTarget++===0){const a=ne.getComponent(this.gameObject,Mi);if(a&&!this.setLookTargetFromConstraint()){this.debugLog&&console.log("NO TARGET");const l=Qt(a.threeCamera),c=Math.max(.01,l.length()),h=new w(0,0,-c).applyMatrix4(a.threeCamera.matrixWorld);this.setLookTargetPosition(h,!0)}if(!this.setLookTargetFromConstraint()){const l=new Yc;l.screenPoint=new Z(0,0),l.lineThreshold=.1;const c=this.context.physics.raycast(l);c.length>0&&this.setLookTargetPosition(c[0].point,!0),Tx&&console.log("OrbitControls hits",...c)}}if(this.middleClickToFocus&&this.context.input.getPointerClicked(1)&&this.setTargetFromRaycast(),this._lookTargetLerpActive||this._cameraLerpActive||this._fovLerpActive){if(this._cameraLerpActive&&this._cameraObject)if(this._cameraLerp01+=this.context.time.deltaTime/this._cameraLerpDuration,this._cameraLerp01>=1)this._cameraObject.position.copy(this._cameraEndPosition),this._cameraLerpActive=!1,this.dispatchEvent(new C0(this,"camera"));else{const a=et.easeInOutCubic(this._cameraLerp01);this._cameraObject.position.lerpVectors(this._cameraStartPosition,this._cameraEndPosition,a)}if(this._lookTargetLerpActive)if(this._lookTargetLerp01+=this.context.time.deltaTime/this._lookTargetLerpDuration,this._lookTargetLerp01>=1)this._controls.target.copy(this._lookTargetEndPosition),this._lookTargetLerpActive=!1,this.dispatchEvent(new C0(this,"lookat"));else{const a=et.easeInOutCubic(this._lookTargetLerp01);this._controls.target.lerpVectors(this._lookTargetStartPosition,this._lookTargetEndPosition,a)}if(this._fovLerpActive&&this._cameraObject){const a=this._cameraObject;if(this._fovLerp01+=this.context.time.deltaTime/this._fovLerpDuration,this._fovLerp01>=1)a.fov=this._fovLerpEndValue,this._fovLerpActive=!1;else{const l=et.easeInOutCubic(this._fovLerp01);a.fov=et.lerp(this._fovLerpStartValue,this._fovLerpEndValue,l)}a.updateProjectionMatrix()}}if(this._controls){if(this.debugLog&&(this._controls.domElement=this.context.renderer.domElement),this._controls.enabled=!this._shouldDisable&&this._camera===this.context.mainCameraComponent&&!this.context.isInXR&&!this._activePointerEvents.some(a=>a.used),this._controls.keys=this.enableKeys?hM:wle,this._controls.autoRotate=this.autoRotate,this._controls.autoRotateSpeed=this.autoRotateSpeed,this._controls.enableZoom=this.enableZoom,this._controls.zoomSpeed=this.zoomSpeed,this._controls.zoomToCursor=this.zoomToCursor,this._controls.enableDamping=this.enableDamping,this._controls.dampingFactor=this.dampingFactor,this._controls.enablePan=this.enablePan,this._controls.enableRotate=this.enableRotate,this._controls.minAzimuthAngle=this.minAzimuthAngle,this._controls.maxAzimuthAngle=this.maxAzimuthAngle,this._controls.minPolarAngle=this.minPolarAngle,this._controls.maxPolarAngle=this.maxPolarAngle,cM||(((r=(n=this._camera)==null?void 0:n.threeCamera)==null?void 0:r.type)==="PerspectiveCamera"?(this._controls.minDistance=this.minZoom,this._controls.maxDistance=this.maxZoom,this._controls.minZoom=0,this._controls.maxZoom=1/0):(this._controls.minDistance=0,this._controls.maxDistance=1/0,this._controls.minZoom=this.minZoom,this._controls.maxZoom=this.maxZoom)),typeof Mx=="number"||Mx===!0){this._controls.enableDamping=!0;const a=typeof Mx=="number"?Mx:.99;this._controls.dampingFactor=Math.max(.001,1-Math.min(1,a))}this.allowInterrupt||(this._lookTargetLerpActive&&(this._controls.enablePan=!1),this._cameraLerpActive&&(this._controls.enableRotate=!1,this._controls.autoRotate=!1),(this._lookTargetLerpActive||this._cameraLerpActive)&&(this._controls.enableZoom=!1)),this.context.isInXR||(!cM&&((o=this.lookAtConstraint)!=null&&o.locked)&&this.setLookTargetFromConstraint(0,this.lookAtConstraint01),this._controls.update(this.context.time.deltaTime),lM&&At.DrawWireSphere(this._controls.target,.1,65280))}}setCameraAndLookTarget(t){if(!t||!(t instanceof ge))return;const i=Qt(t),n=JB(t);this.setTargetFromRaycast(new jo(i,n)),this.setCameraTargetPosition(i)}setCameraTargetPosition(t,i=!1){var n;t&&(t instanceof ge&&(t=Qt(t)),this._cameraEndPosition||(this._cameraEndPosition=new w),this._cameraEndPosition.copy(t),i===!0?(this._cameraLerpActive=!1,this._cameraObject&&this._cameraObject.position.copy(this._cameraEndPosition)):this._cameraObject&&(this._cameraLerpActive=!0,this._cameraLerp01=0,this._cameraStartPosition.copy((n=this._cameraObject)==null?void 0:n.position),typeof i=="number"?this._cameraLerpDuration=i:this._cameraLerpDuration=this.targetLerpDuration))}get cameraLerpActive(){return this._cameraLerpActive}stopCameraLerp(){this._cameraLerpActive=!1}setFieldOfView(t,i=!1){var r;if(!this._controls||typeof t!="number")return;const n=(r=this._camera)==null?void 0:r.threeCamera;n&&(i===!0?n.fov=t:(this._fovLerpActive=!0,this._fovLerp01=0,this._fovLerpStartValue=n.fov,this._fovLerpEndValue=t,typeof i=="number"?this._fovLerpDuration=i:this._fovLerpDuration=this.targetLerpDuration))}setLookTargetPosition(t=null,i=!1){this._controls&&t&&(t instanceof ge&&(t=Qt(t)),this._lookTargetEndPosition.copy(t),this._didSetTarget++,lM&&(console.warn("OrbitControls: setLookTargetPosition",t,i),At.DrawWireSphere(this._lookTargetEndPosition,.2,16711680,2)),i===!0?this._controls.target.copy(this._lookTargetEndPosition):(this._lookTargetLerpActive=!0,this._lookTargetLerp01=0,this._lookTargetStartPosition.copy(this._controls.target),typeof i=="number"?this._lookTargetLerpDuration=i:this._lookTargetLerpDuration=this.targetLerpDuration))}get lookTargetLerpActive(){return this._lookTargetLerpActive}stopLookTargetLerp(){this._lookTargetLerpActive=!1}setLookTargetFromConstraint(t=0,i=1){var r;if(!this._controls)return!1;const n=(r=this.lookAtConstraint)==null?void 0:r.sources;if(n&&n.length>0){const o=n[t];if(o)return o.getWorldPosition(this._lookTargetEndPosition),this.lerpLookTarget(this._lookTargetEndPosition,i),!0}return!1}lerpTarget(t,i){return this.lerpLookTarget(t,i)}lerpLookTarget(t,i){this._controls&&(i>=1?this._controls.target.copy(t):this._controls.target.lerp(t,i))}setTargetFromRaycast(t){if(!this.controls)return;const i=t?this.context.physics.raycastFromRay(t):this.context.physics.raycast();for(const n of i)if(n.distance>0&&ne.isActiveInHierarchy(n.object)){const r=JD(n.object);if(r){const o=r.canvas;if(o!=null&&o.screenspace)break}this.setLookTargetPosition(n.point);break}}fitCamera(t,i){var L,U;if(this.context.isInXR)return;let n;if(Array.isArray(t)?n=t:t&&"type"in t?n=t.children:t&&"objects"in t&&(n=t==null?void 0:t.objects,i=t),n&&!Array.isArray(n)&&(n=n.children),(!Array.isArray(n)||n&&n.length<=0)&&(n=this.context.scene.children),!Array.isArray(n)||n.length<=0){console.warn("No objects to fit camera to...");return}const r=this._cameraObject,o=this._controls;if(!r||!o){console.warn("No camera or controls found to fit camera to objects...");return}i||(i={});const{immediate:a=!1,centerCamera:l="y",cameraNearFar:c="auto",fitOffset:h=1.1,fov:d=r==null?void 0:r.fov}=i,f=new w,p=new w,m=Ja(n,void 0,(U=(L=this._camera)==null?void 0:L.threeCamera)==null?void 0:U.layers),v=m.clone();r.updateMatrixWorld(),r.updateProjectionMatrix(),m.getCenter(p);const y=new w;if(m.getSize(y),m.applyMatrix4(r.matrixWorldInverse),m.getSize(f),m.setFromCenterAndSize(p,f),Number.isNaN(f.x)||Number.isNaN(f.y)||Number.isNaN(f.z)){console.warn("Camera fit size resultet in NaN",r,m,[...n]);return}if(f.length()<=1e-10){Tx&&console.warn("Camera fit size is zero",m,[...n]);return}const g=i.fov||r.fov,_=2*Math.atan(Math.tan(g*Math.PI/360/2)*r.aspect)/Math.PI*360,A=f.y/(2*Math.atan(Math.PI*g/360)),b=f.x/(2*Math.atan(Math.PI*_/360)),E=h*Math.max(A,b)+f.z/2;Tx&&console.log("Fit camera to objects",{fitHeightDistance:A,fitWidthDistance:b,distance:E,verticalFov:g,horizontalFov:_}),this.maxZoom=E*10,this.minZoom=E*.01;const C=.05,T=p.clone();if(T.y-=f.y*C,this.setLookTargetPosition(T,a),this.setFieldOfView(i.fov,a),this.autoTarget=!1,c==null||c=="auto"){const D=ne.findObjectOfType(ih),V=D?D.radius:0,O=Math.max(y.x,y.y,y.z,V);r.near=E/100,r.far=O+E*10,D&&(this.maxZoom=Math.max(Math.min(this.maxZoom,V*.5),E))}const M=o.getDistance();M<this.minZoom&&(this.minZoom=M*.9),M>this.maxZoom&&(this.maxZoom=M*1.1),r.updateMatrixWorld(),r.updateProjectionMatrix();const R=Qt(r),S=p.clone();S.sub(R),l==="y"&&(S.y=0),S.normalize(),S.multiplyScalar(E),l==="y"&&(S.y+=-C*4*E);let I=p.clone().sub(S);if(r.parent&&(I=r.parent.worldToLocal(I)),this.setCameraTargetPosition(I,a),Tx){const D=new yB(m);this.context.scene.add(D),eD(D,l_(r)),setTimeout(()=>{this.context.scene.remove(D)},1e4),At.DrawWireBox3(v,65280,10),this._haveAttachedKeyboardEvents||(this._haveAttachedKeyboardEvents=!0,document.body.addEventListener("keydown",V=>{if(V.code==="KeyF"){let O;this._cameraObject instanceof zt&&(O=Math.random()*Math.random()*170+10),this.fitCamera({objects:n,fitOffset:h,immediate:!1,fov:O})}V.code==="KeyV"&&this._cameraObject instanceof zt&&(this._cameraObject.fov=60)}))}o.update()}}On([x()],Ni.prototype,"autoTarget",void 0);On([x()],Ni.prototype,"autoFit",void 0);On([x()],Ni.prototype,"enableRotate",void 0);On([x()],Ni.prototype,"autoRotate",void 0);On([x()],Ni.prototype,"autoRotateSpeed",void 0);On([x()],Ni.prototype,"minAzimuthAngle",void 0);On([x()],Ni.prototype,"maxAzimuthAngle",void 0);On([x()],Ni.prototype,"minPolarAngle",void 0);On([x()],Ni.prototype,"maxPolarAngle",void 0);On([x()],Ni.prototype,"enableKeys",void 0);On([x()],Ni.prototype,"enableDamping",void 0);On([x()],Ni.prototype,"dampingFactor",void 0);On([x()],Ni.prototype,"enableZoom",void 0);On([x()],Ni.prototype,"minZoom",void 0);On([x()],Ni.prototype,"maxZoom",void 0);On([x()],Ni.prototype,"zoomSpeed",void 0);On([x()],Ni.prototype,"enablePan",void 0);On([x(Jp)],Ni.prototype,"lookAtConstraint",void 0);On([x()],Ni.prototype,"lookAtConstraint01",void 0);On([x()],Ni.prototype,"allowInterrupt",void 0);On([x()],Ni.prototype,"middleClickToFocus",void 0);On([x()],Ni.prototype,"doubleClickToFocus",void 0);On([x()],Ni.prototype,"clickBackgroundToFitScene",void 0);On([x()],Ni.prototype,"targetLerpDuration",void 0);var To=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r},uo;(function(s){s[s.None=0]="None",s[s.Skybox=1]="Skybox",s[s.SolidColor=2]="SolidColor",s[s.Uninitialized=4]="Uninitialized"})(uo||(uo={}));const Ju=ie("debugcam"),XU=ie("debugscreenpointtoray"),bg=class extends Te{constructor(){super(...arguments);u(this,"_nearClipPlane",.1);u(this,"_farClipPlane",1e3);u(this,"orthographic",!1);u(this,"orthographicSize",5);u(this,"ARBackgroundAlpha",0);u(this,"_cullingMask",4294967295);u(this,"_backgroundBlurriness");u(this,"_backgroundIntensity");u(this,"_backgroundRotation");u(this,"_environmentIntensity");u(this,"_targetTexture",null);u(this,"_backgroundColor");u(this,"_fov");u(this,"_cam",null);u(this,"_clearFlags",uo.SolidColor);u(this,"_skybox");u(this,"_frustum");u(this,"_projScreenMatrix",new fe)}get isCamera(){return!0}get aspect(){return this._cam instanceof zt?this._cam.aspect:this.context.domWidth/this.context.domHeight}set aspect(t){this._cam instanceof zt&&this._cam.aspect!==t&&(this._cam.aspect=t,this._cam.updateProjectionMatrix())}get fieldOfView(){return this._cam instanceof zt?this._cam.fov:this._fov}set fieldOfView(t){const i=this.fieldOfView!=t;if(this._fov=t,i&&this._cam&&this._cam instanceof zt){if(this._fov===void 0){console.warn("Can not set undefined fov on PerspectiveCamera");return}this._cam.fov=this._fov,this._cam.updateProjectionMatrix()}}get nearClipPlane(){return this._nearClipPlane}set nearClipPlane(t){const i=this._nearClipPlane!=t;this._nearClipPlane=t,this._cam&&(i||this._cam.near!=t)&&(this._cam.near=t,this._cam.updateProjectionMatrix())}applyClippingPlane(){this._cam&&(this._cam.near=this._nearClipPlane,this._cam.far=this._farClipPlane,this._cam.updateProjectionMatrix())}get farClipPlane(){return this._farClipPlane}set farClipPlane(t){const i=this._farClipPlane!=t;this._farClipPlane=t,this._cam&&(i||this._cam.far!=t)&&(this._cam.far=t,this._cam.updateProjectionMatrix())}get clearFlags(){return this._clearFlags}set clearFlags(t){t!==this._clearFlags&&(this._clearFlags=t,this.applyClearFlagsIfIsActiveCamera())}set cullingMask(t){this._cullingMask=t,this._cam&&(this._cam.layers.mask=t)}get cullingMask(){return this._cam?this._cam.layers.mask:this._cullingMask}set cullingLayer(t){this.cullingMask=(1<<t|0)>>>0}set backgroundBlurriness(t){t!==this._backgroundBlurriness&&(t===void 0?this._backgroundBlurriness=void 0:this._backgroundBlurriness=Math.min(Math.max(t,0),1),this.applyClearFlagsIfIsActiveCamera())}get backgroundBlurriness(){return this._backgroundBlurriness}set backgroundIntensity(t){t!==this._backgroundIntensity&&(t===void 0?this._backgroundIntensity=void 0:this._backgroundIntensity=Math.min(Math.max(t,0),10),this.applyClearFlagsIfIsActiveCamera())}get backgroundIntensity(){return this._backgroundIntensity}set backgroundRotation(t){t!==this._backgroundRotation&&(t===void 0?this._backgroundRotation=void 0:this._backgroundRotation=t,this.applyClearFlagsIfIsActiveCamera())}get backgroundRotation(){return this._backgroundRotation}set environmentIntensity(t){this._environmentIntensity=t}get environmentIntensity(){return this._environmentIntensity}get backgroundColor(){return this._backgroundColor??null}set backgroundColor(t){if(t){if(this._backgroundColor)this._backgroundColor.copy(t);else{if(!t.clone)return;this._backgroundColor=t.clone()}t.alpha===void 0&&(this._backgroundColor.alpha=1),this.applyClearFlagsIfIsActiveCamera()}}set targetTexture(t){this._targetTexture=t}get targetTexture(){return this._targetTexture}get cam(){return this.threeCamera}get threeCamera(){return this.activeAndEnabled&&this.buildCamera(),this._cam}screenPointToRay(t,i,n){const r=this.threeCamera,o=bg._origin;o.set(t,i,-1),this.context.input.convertScreenspaceToRaycastSpace(o),XU&&console.log("screenPointToRay",t.toFixed(2),i.toFixed(2),"now:",o.x.toFixed(2),o.y.toFixed(2),"isInXR:"+this.context.isInXR),o.z=-1,o.unproject(r);const a=bg._direction.set(o.x,o.y,o.z),l=Qt(r);return a.sub(l),a.normalize(),n?(n.set(l,a),n):new jo(l.clone(),a.clone())}getFrustum(){return this._frustum||(this._frustum=new Rp,this.updateFrustum()),this._frustum}updateFrustum(){this._frustum||(this._frustum=new Rp),this._frustum.setFromProjectionMatrix(this.getProjectionScreenMatrix(this._projScreenMatrix,!0),this.context.renderer.coordinateSystem)}getProjectionScreenMatrix(t,i){return i&&this._projScreenMatrix.multiplyMatrices(this.threeCamera.projectionMatrix,this.threeCamera.matrixWorldInverse),t===this._projScreenMatrix?t:t.copy(this._projScreenMatrix)}awake(){XU&&window.addEventListener("pointerdown",t=>{const i=t.clientX,n=t.clientY;console.log("touch",i.toFixed(2),n.toFixed(2));const r=this.screenPointToRay(i,n),o="#"+Math.floor(Math.random()*16777215).toString(16);At.DrawRay(r.origin,r.direction,o,10)})}onEnable(){Ju&&console.log(`Camera enabled: "${this.name}". ClearFlags=${uo[this._clearFlags]}`,this),this.buildCamera(),(this.tag=="MainCamera"||!this.context.mainCameraComponent)&&(this.context.setCurrentCamera(this),Cle(this)),this.applyClearFlagsIfIsActiveCamera({applySkybox:!0})}onDisable(){this.context.removeCamera(this)}onBeforeRender(){if(this._cam&&(this._frustum&&this.updateFrustum(),this._clearFlags===uo.SolidColor&&this.applyClearFlagsIfIsActiveCamera(),this._targetTexture)){this.context.isManagedExternally&&(this._warnedAboutExternalRenderer||(this._warnedAboutExternalRenderer=!0,console.warn("Rendering with external renderer is not supported yet. This may not work or throw errors. Please remove the the target texture from your camera: "+this.name,this.targetTexture))),this.context.composer;const t=this.context.renderer;if(t){const i=this.context.mainCameraComponent;this.applyClearFlags(),this._targetTexture.render(this.context.scene,this._cam,t),i==null||i.applyClearFlags()}}}buildCamera(){if(this._cam)return;const t=this.gameObject.isCamera;let i=null;if(t?(i=this.gameObject,i==null||i.layers.enableAll(),i instanceof zt&&(this._fov=i.fov)):i=this.gameObject.children[0],i&&i.isCamera)i instanceof zt&&(this._fov&&(i.fov=this._fov),i.near=this._nearClipPlane,i.far=this._farClipPlane,i.updateProjectionMatrix());else if(!this.orthographic)i=new zt(this.fieldOfView,window.innerWidth/window.innerHeight,this._nearClipPlane,this._farClipPlane),this.fieldOfView&&(i.fov=this.fieldOfView),this.gameObject.add(i);else{const n=this.orthographicSize*100;i=new Nl(window.innerWidth/-n,window.innerWidth/n,window.innerHeight/n,window.innerHeight/-n,this._nearClipPlane,this._farClipPlane),this.gameObject.add(i)}this._cam=i,this._cam.layers.mask=this._cullingMask,this.tag=="MainCamera"&&this.context.setCurrentCamera(this)}applyClearFlagsIfIsActiveCamera(t){this.context.mainCameraComponent===this&&this.applyClearFlags(t)}applyClearFlags(t){var i;if(!this._cam){Ju&&console.log("Camera does not exist (apply clear flags)");return}if(this.fieldOfView=this._fov,Ju){const n=`Camera "${this.name}" clear flags: ${uo[this._clearFlags]}`;console.debug(n)}switch(this._clearFlags){case uo.None:return;case uo.Skybox:if(bg.backgroundShouldBeTransparent(this.context)&&(!this.ARBackgroundAlpha||this.ARBackgroundAlpha<.001)){this.context.scene.background=null,this.context.renderer.setClearColor(0,0);return}(!this.scene.background||!this._skybox||(t==null?void 0:t.applySkybox)===!0)&&this.applySceneSkybox(),this._backgroundBlurriness!==void 0?this.context.scene.backgroundBlurriness=this._backgroundBlurriness:Ju&&console.warn(`Camera "${this.name}" has no background blurriness`),this._backgroundIntensity!==void 0&&(this.context.scene.backgroundIntensity=this._backgroundIntensity),this._backgroundRotation!==void 0?this.context.scene.backgroundRotation=this._backgroundRotation:Ju&&console.warn(`Camera "${this.name}" has no background intensity`);break;case uo.SolidColor:if(this._backgroundColor){let n=this._backgroundColor.alpha;bg.backgroundShouldBeTransparent(this.context)&&(n=this.ARBackgroundAlpha??0),this.context.scene.background=null,(i=this.context.xr)!=null&&i.isVR?this.context.renderer.setClearColor(ZG(this._backgroundColor).convertLinearToSRGB()):this.context.renderer.setClearColor(this._backgroundColor,n)}else Ju&&console.warn(`Camera "${this.name}" has no background color`,this);break;case uo.Uninitialized:this.context.scene.background=null,this.context.renderer.setClearColor(0,0);break}}applySceneSkybox(){this._skybox||(this._skybox=new Sle(this)),this._skybox.apply()}static backgroundShouldBeTransparent(t){var o,a,l,c;const i=(o=t.renderer.xr)==null?void 0:o.getSession();if(!i)return!1;if(typeof i._transparent=="boolean")return i._transparent;const n=i.environmentBlendMode;Ju&&Pn("Environment blend mode: "+n+" on "+navigator.userAgent);let r=n==="additive"||n==="alpha-blend";return t.isInAR&&n==="opaque"&&((a=navigator.userAgent)!=null&&a.includes("OculusBrowser")||(l=navigator.userAgent)!=null&&l.includes("Mozilla")&&((c=navigator.userAgent)!=null&&c.includes("Mobile WebXRViewer/v2")))&&(r=!0),i._transparent=r,r}};let Mi=bg;u(Mi,"_origin",new w),u(Mi,"_direction",new w);To([x()],Mi.prototype,"aspect",null);To([x()],Mi.prototype,"fieldOfView",null);To([x()],Mi.prototype,"nearClipPlane",null);To([x()],Mi.prototype,"farClipPlane",null);To([x()],Mi.prototype,"clearFlags",null);To([x()],Mi.prototype,"orthographic",void 0);To([x()],Mi.prototype,"orthographicSize",void 0);To([x()],Mi.prototype,"ARBackgroundAlpha",void 0);To([x()],Mi.prototype,"cullingMask",null);To([x()],Mi.prototype,"backgroundBlurriness",null);To([x()],Mi.prototype,"backgroundIntensity",null);To([x(oi)],Mi.prototype,"backgroundRotation",null);To([x()],Mi.prototype,"environmentIntensity",null);To([x(Vi)],Mi.prototype,"backgroundColor",null);To([x(_d)],Mi.prototype,"targetTexture",null);class Sle{constructor(e){u(this,"_camera");u(this,"_skybox");this._camera=e}get context(){var e;return(e=this._camera)==null?void 0:e.context}apply(){this._skybox=this.context.lightmaps.tryGetSkybox(this._camera.sourceId),this._skybox?this.context.scene.background!==this._skybox&&(Ju&&console.log(`Camera "${this._camera.name}" set skybox`,this._camera,this._skybox),this._skybox.mapping=bo,this.context.scene.background=this._skybox):this._did_log_failed_to_find_skybox||(this._did_log_failed_to_find_skybox=!0,console.warn(`Camera "${this._camera.name}" has no skybox texture. ${this._camera.sourceId}`))}}function Cle(s){ie("freecam")&&s.context.mainCameraComponent===s&&ne.getOrAddComponent(s.gameObject,Ni)}class xd extends Te{constructor(){super(...arguments);u(this,"_listener",null);u(this,"onInteraction",()=>{this.destroyed||this.listener==null||this.addListenerIfItExists()})}get listener(){return this._listener==null&&(this._listener=new k4),this._listener}onEnable(){Bl.registerWaitForInteraction(this.onInteraction),this.addListenerIfItExists()}onDisable(){Bl.unregisterWaitForInteraction(this.onInteraction),this.removeListenerIfItExists()}addListenerIfItExists(){const t=this._listener;if(!t||t!=null&&t.parent)return;const i=this.context.mainCameraComponent||ne.getComponentInParent(this.gameObject,Mi);i!=null&&i.threeCamera?i.threeCamera.add(t):this.gameObject.add(t),t.filter?(t.gain.connect(t.filter),t.filter.connect(t.context.destination)):t.gain.connect(t.context.destination)}removeListenerIfItExists(){const t=this._listener;t&&(t.removeFromParent(),t.filter&&t.filter.disconnect(),t.gain&&t.gain.disconnect())}}var Hl=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Fr=ie("debugaudio");var xA;(function(s){s[s.Logarithmic=0]="Logarithmic",s[s.Linear=1]="Linear",s[s.Custom=2]="Custom"})(xA||(xA={}));class Fi extends Te{constructor(){super(...arguments);u(this,"clip","");u(this,"playOnAwake",!1);u(this,"preload",!1);u(this,"playInBackground",!0);u(this,"_spatialBlend",0);u(this,"_minDistance",1);u(this,"_maxDistance",100);u(this,"_volume",1);u(this,"rollOffMode",0);u(this,"_loop",!1);u(this,"sound",null);u(this,"helper",null);u(this,"wasPlaying",!1);u(this,"audioLoader",null);u(this,"shouldPlay",!1);u(this,"_lastClipStartedLoading",null);u(this,"_audioElement",null);u(this,"onVisibilityChanged",()=>{switch(document.visibilityState){case"hidden":(this.playInBackground===!1||St.isMobileDevice())&&(this.wasPlaying=this.isPlaying,this.isPlaying&&this.pause());break;case"visible":Fr&&console.log("visible",this.enabled,this.playOnAwake,!this.isPlaying,Fi.userInteractionRegistered,this.wasPlaying),this.enabled&&this.playOnAwake&&!this.isPlaying&&Fi.userInteractionRegistered&&this.wasPlaying&&this.play();break}});u(this,"onApplicationMuteChanged",()=>{var t,i;this.context.application.muted?(t=this.sound)==null||t.setVolume(0):(i=this.sound)==null||i.setVolume(this.volume)});u(this,"createAudio",t=>{Fr&&console.log("AudioBuffer finished loading",t);const i=this.Sound;if(!i){Fr&&console.warn("Failed getting sound?",this.name);return}i.isPlaying&&i.stop(),t&&i.setBuffer(t),i.loop=this._loop,this.context.application.muted?i.setVolume(0):i.setVolume(this.volume),i.autoplay=this.shouldPlay&&Fi.userInteractionRegistered,this.applySpatialDistanceSettings(),i.isPlaying&&i.stop(),Fi.registerWaitForAllowAudio(this.__onAllowAudioCallback)});u(this,"__onAllowAudioCallback",()=>{this.shouldPlay&&this.play()});u(this,"_lastContextTime",0);u(this,"_hasEnded",!0);u(this,"_needUpdateSpatialDistanceSettings",!1)}static get userInteractionRegistered(){return Bl.userInteractionRegistered}static registerWaitForAllowAudio(t){Bl.registerWaitForInteraction(t)}get isPlaying(){var t;return((t=this.sound)==null?void 0:t.isPlaying)??!1}get duration(){var t,i;return(i=(t=this.sound)==null?void 0:t.buffer)==null?void 0:i.duration}get time01(){var i;const t=this.duration;return t&&this.sound?((i=this.sound)==null?void 0:i.context.currentTime)/t:0}set time01(t){const i=this.duration;i&&this.sound&&(this.time=t*i)}get time(){var t,i;return(t=this.sound)!=null&&t.source?((i=this.sound.source)==null?void 0:i.context.currentTime)-this._lastContextTime+this.sound.offset:0}set time(t){if(this.sound){if(t===this.sound.offset)return;const i=this.isPlaying;this.stop(),this.sound.offset=t,i&&this.play()}}get loop(){return this.sound&&(this._loop=this.sound.getLoop()),this._loop}set loop(t){this._loop=t,this.sound&&this.sound.setLoop(t)}get spatialBlend(){return this._spatialBlend}set spatialBlend(t){t!==this._spatialBlend&&(this._spatialBlend=t,this._needUpdateSpatialDistanceSettings=!0)}get minDistance(){return this._minDistance}set minDistance(t){this._minDistance!==t&&(this._minDistance=t,this._needUpdateSpatialDistanceSettings=!0)}get maxDistance(){return this._maxDistance}set maxDistance(t){this._maxDistance!==t&&(this._maxDistance=t,this._needUpdateSpatialDistanceSettings=!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.sound&&!this.context.application.muted&&(Fr&&console.log(this.name,"audio set volume",t),this.sound.setVolume(t))}set pitch(t){this.sound&&this.sound.setPlaybackRate(t)}get pitch(){return this.sound?this.sound.getPlaybackRate():1}get Sound(){var t;if(!this.sound&&Fi.userInteractionRegistered){let i=ne.getComponent(this.context.mainCamera,xd)??ne.findObjectOfType(xd,this.context);!i&&this.context.mainCamera&&(i=ne.addComponent(this.context.mainCamera,xd)),i!=null&&i.listener?(this.sound=new F4(i.listener),(t=this.gameObject)==null||t.add(this.sound)):Fr&&console.warn("No audio listener found in scene - can not play audio")}return this.sound}get ShouldPlay(){return this.shouldPlay}get audioContext(){var t;return(t=this.sound)==null?void 0:t.context}awake(){Fr&&console.log(this),this.audioLoader=new Kw,this.playOnAwake&&(this.shouldPlay=!0),this.preload&&typeof this.clip=="string"&&this.audioLoader.load(this.clip,this.createAudio,()=>{},console.error)}onEnable(){this.sound&&this.gameObject.add(this.sound),Fi.userInteractionRegistered?this.playOnAwake&&this.context.application.isVisible&&this.play():Fi.registerWaitForAllowAudio(()=>{this.enabled&&!this.destroyed&&this.shouldPlay&&this.onNewClip(this.clip)}),globalThis.addEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.addEventListener(vd.MuteChanged,this.onApplicationMuteChanged)}onDisable(){globalThis.removeEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.removeEventListener(vd.MuteChanged,this.onApplicationMuteChanged),this.pause()}applySpatialDistanceSettings(){const t=this.sound;if(!t)return;this._needUpdateSpatialDistanceSettings=!1;const i=et.lerp(10*this._maxDistance/Math.max(1e-4,this.spatialBlend),this._minDistance,this.spatialBlend);switch(Fr&&console.log(this.name,this._minDistance,this._maxDistance,this.spatialBlend,"Ref distance="+i),t.setRefDistance(i),t.setMaxDistance(Math.max(.01,this._maxDistance)),this.rollOffMode){case xA.Logarithmic:t.setDistanceModel("exponential");break;case xA.Linear:t.setDistanceModel("linear");break;case xA.Custom:console.warn("Custom rolloff for AudioSource is not supported: "+this.name);break}this.spatialBlend>0?Fr&&!this.helper&&(this.helper=new Kae(t,t.getRefDistance()),t.add(this.helper)):this.helper&&this.helper.parent&&this.helper.removeFromParent()}async onNewClip(t){if(t&&(this.clip=t),typeof t=="string")if(Fr&&console.log(t),t.endsWith(".mp3")||t.endsWith(".wav")){if(this.audioLoader||(this.audioLoader=new Kw),this.shouldPlay=!0,this._lastClipStartedLoading===t){Fr&&console.log("Is currently loading:",this._lastClipStartedLoading,this);return}this._lastClipStartedLoading=t,Fr&&console.log("load audio",t);const i=await this.audioLoader.loadAsync(t).catch(console.error);this._lastClipStartedLoading=null,i&&this.createAudio(i)}else console.warn("Unsupported audio clip type",t);else this.shouldPlay=!0,this.createAudio()}play(t=void 0){var n,r,o;!t&&this.clip&&(t=this.clip),t!==void 0&&typeof t!="string"&&!(t instanceof MediaStream)&&(Xe()&&console.warn("Called play on AudioSource with unknown argument type:",t+`
Using the assigned clip instead:`,this.clip),t=this.clip);let i=!this.sound||t&&t!==this.clip;if(typeof t=="string"&&!this.audioLoader&&(i=!0),(t instanceof MediaStream||typeof t=="string")&&(this.clip=t),i){this.shouldPlay=!0,this.onNewClip(t);return}if(this.shouldPlay=!0,this._hasEnded=!1,Fr&&console.log("play",(n=this.sound)==null?void 0:n.getVolume(),this.sound),this.sound&&!this.sound.isPlaying){const a=this.context.application.muted;a&&this.sound.setVolume(0),(r=this.gameObject)==null||r.add(this.sound),this.clip instanceof MediaStream?(this.sound.setMediaStreamSource(this.clip),this._audioElement||(this._audioElement=document.createElement("audio"),this._audioElement.style.display="none"),this._audioElement.parentNode||(o=this.context.domElement.shadowRoot)==null||o.append(this._audioElement),this._audioElement.srcObject=this.clip,this._audioElement.autoplay=!1):(this._audioElement&&this._audioElement.remove(),this.sound.play(a?.1:0))}}pause(){var t,i;Fr&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.isPlaying&&this.sound.source&&(this._lastContextTime=(t=this.sound)==null?void 0:t.context.currentTime,this.sound.pause()),(i=this._audioElement)==null||i.remove()}stop(){var t,i;Fr&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.source&&(this._lastContextTime=(t=this.sound)==null?void 0:t.context.currentTime,Fr&&console.log(this._lastContextTime),this.sound.stop()),(i=this._audioElement)==null||i.remove()}update(){this.helper&&(this.isPlaying&&this.helper.update(),this.helper.visible=this.isPlaying),this._needUpdateSpatialDistanceSettings&&this.applySpatialDistanceSettings(),this.sound&&!this.sound.isPlaying&&this.shouldPlay&&!this._hasEnded&&(this._hasEnded=!0,Fr&&console.log("Audio clip ended",this.clip),this.dispatchEvent(new CustomEvent("ended",{detail:this})))}}Hl([x(URL)],Fi.prototype,"clip",void 0);Hl([x()],Fi.prototype,"playOnAwake",void 0);Hl([x()],Fi.prototype,"preload",void 0);Hl([x()],Fi.prototype,"playInBackground",void 0);Hl([x()],Fi.prototype,"loop",null);Hl([x()],Fi.prototype,"spatialBlend",null);Hl([x()],Fi.prototype,"minDistance",null);Hl([x()],Fi.prototype,"maxDistance",null);Hl([x()],Fi.prototype,"volume",null);Hl([x()],Fi.prototype,"pitch",null);Hl([x()],Fi.prototype,"rollOffMode",void 0);var EE=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Ele=ie("debugsignals");class E_{constructor(){u(this,"guid")}}EE([x()],E_.prototype,"guid",void 0);class Tv{constructor(){u(this,"signal");u(this,"reaction")}}EE([x(E_)],Tv.prototype,"signal",void 0);EE([x(un)],Tv.prototype,"reaction",void 0);const hc=class extends Te{constructor(){super(...arguments);u(this,"events")}static invoke(t){if(hc.receivers[t]){const i=hc.receivers[t];if(!i)return;for(const n of i)n.invoke(t)}}awake(){Ele&&console.log("SignalReceiver awake",this)}onEnable(){if(this.events)for(const t of this.events)hc.receivers[t.signal.guid]||(hc.receivers[t.signal.guid]=[]),hc.receivers[t.signal.guid].push(this)}onDisable(){if(this.events){for(const t of this.events)if(hc.receivers[t.signal.guid]){const i=hc.receivers[t.signal.guid].indexOf(this);i>=0&&hc.receivers[t.signal.guid].splice(i,1)}}}invoke(t){if(!this.events||!Array.isArray(this.events))return;const i=typeof t=="object"?t.guid:t;for(const n of this.events)if(n.signal.guid===i)try{if(n.reaction){if(!n.reaction.invoke){console.warn("Missing invoke - possibly a serialization error",n,this);continue}}else{console.warn("Missing reaction for signal",n,this);continue}n.reaction.invoke()}catch(r){console.error(r)}}};let ou=hc;u(ou,"receivers",{});EE([x(Tv)],ou.prototype,"events",void 0);var Oo;(function(s){s.Activation="ActivationTrack",s.Animation="AnimationTrack",s.Audio="AudioTrack",s.Control="ControlTrack",s.Marker="MarkerTrack",s.Signal="SignalTrack"})(Oo||(Oo={}));var _l;(function(s){s[s.None=0]="None",s[s.Hold=1]="Hold",s[s.Loop=2]="Loop",s[s.PingPong=3]="PingPong",s[s.Continue=4]="Continue"})(_l||(_l={}));var MS;(function(s){s.Signal="SignalEmitter"})(MS||(MS={}));var UQ=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const xh=ie("debugtimeline");var dg;(function(s){s[s.Hold=0]="Hold",s[s.Loop=1]="Loop",s[s.None=2]="None"})(dg||(dg={}));var YU;(function(s){s[s.None=0]="None",s[s.Hold=1]="Hold",s[s.Loop=2]="Loop",s[s.PingPong=3]="PingPong",s[s.Continue=4]="Continue"})(YU||(YU={}));const iC=class extends Te{constructor(){super(...arguments);u(this,"playableAsset");u(this,"playOnAwake");u(this,"extrapolationMode",dg.Loop);u(this,"waitForAudio",!0);u(this,"_visibilityChangeEvt");u(this,"_clonedPlayableAsset",!1);u(this,"_speed",1);u(this,"_guidsMap");u(this,"_isPlaying",!1);u(this,"_internalUpdateRoutine");u(this,"_isPaused",!1);u(this,"_isStopping",!1);u(this,"_time",0);u(this,"_duration",0);u(this,"_weight",1);u(this,"_animationTracks",[]);u(this,"_audioTracks",[]);u(this,"_signalTracks",[]);u(this,"_controlTracks",[]);u(this,"_customTracks",[]);u(this,"_allTracks",[this._animationTracks,this._audioTracks,this._signalTracks,this._controlTracks,this._customTracks]);u(this,"animationCallbackReceivers",[])}static registerCreateTrack(t,i){this.createTrackFunctions[t]=i}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get time(){return this._time}set time(t){typeof t=="number"&&!Number.isNaN(t)?this._time=t:(xh||So())&&console.error("INVALID TIMELINE.TIME VALUE",t,this.name)}get duration(){return this._duration}set duration(t){this._duration=t}get weight(){return this._weight}set weight(t){this._weight=t}get speed(){return this._speed}set speed(t){this._speed=t}awake(){var t,i,n,r,o;xh&&console.log(this,(t=this.playableAsset)==null?void 0:t.tracks),this.rebuildGraph(),!this.isValid()&&(xh||Xe())&&(xh?console.warn("PlayableDirector is not valid","Asset?",this.playableAsset,"Tracks:",(i=this.playableAsset)==null?void 0:i.tracks,"IsArray?",Array.isArray((n=this.playableAsset)==null?void 0:n.tracks),this):(o=(r=this.playableAsset)==null?void 0:r.tracks)!=null&&o.length?console.warn("PlayableDirector is not valid"):console.warn("PlayableDirector has no tracks"))}onEnable(){var t,i,n;for(const r of this._audioTracks)(t=r.onEnable)==null||t.call(r);for(const r of this._customTracks)(i=r.onEnable)==null||i.call(r);for(const r of this._animationTracks)(n=r.onEnable)==null||n.call(r);this.playOnAwake&&this.play(),this._visibilityChangeEvt||(this._visibilityChangeEvt=()=>{switch(document.visibilityState){case"hidden":this.setAudioTracksAllowPlaying(!1);break;case"visible":this.setAudioTracksAllowPlaying(!0);break}}),window.addEventListener("visibilitychange",this._visibilityChangeEvt)}onDisable(){var t,i,n;this.stop();for(const r of this._audioTracks)(t=r.onDisable)==null||t.call(r);for(const r of this._customTracks)(i=r.onDisable)==null||i.call(r);for(const r of this._animationTracks)(n=r.onDisable)==null||n.call(r);this._visibilityChangeEvt&&window.removeEventListener("visibilitychange",this._visibilityChangeEvt)}onDestroy(){var t;for(const i of this._allTracks)for(const n of i)(t=n.onDestroy)==null||t.call(n)}rebuildGraph(){this.isValid()&&(this.resolveBindings(),this.updateTimelineDuration(),this.setupAndCreateTrackHandlers())}async play(){if(!this.isValid())return;const t=this._isPaused==!0;if(this._isPaused=!1,!this._isPlaying){if(this._isPlaying=!0,t&&this.invokePauseChangedMethodsOnTracks(),this.waitForAudio){const i=[];for(const n of this._audioTracks){const r=n.loadAudio(this._time,1,0);r&&i.push(r)}if(i.length>0&&(await Promise.all(i),!this._isPlaying))return;for(;this._audioTracks.length>0&&this._isPlaying&&!Fi.userInteractionRegistered&&this.waitForAudio;)await Xc(200)}this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine=this.startCoroutine(this.internalUpdate(),Wt.LateUpdate)}}pause(){this.isValid()&&(this._isPlaying=!1,!this._isPaused&&(this._isPaused=!0,this.internalEvaluate(),this.invokePauseChangedMethodsOnTracks(),this.invokeStateChangedMethodsOnTracks()))}stop(){this._isStopping=!0;for(const n of this._audioTracks)n.stop();const t=this._isPaused==!0,i=this._isPlaying;this._isPlaying&&(this._time=0,this._isPlaying=!1,this._isPaused=!1,this.internalEvaluate(),t&&this.invokePauseChangedMethodsOnTracks()),this._isPlaying=!1,this._isPaused=!1,t&&!i&&this.invokePauseChangedMethodsOnTracks(),i&&this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine&&this.stopCoroutine(this._internalUpdateRoutine),this._internalUpdateRoutine=null,this._isStopping=!1}evaluate(){this.internalEvaluate(!0)}isValid(){return this.playableAsset&&this.playableAsset.tracks&&Array.isArray(this.playableAsset.tracks)}*forEachTrack(){for(const t of this._allTracks)for(const i of t)yield i}get animationTracks(){return this._animationTracks}get audioTracks(){return this._audioTracks}resolveGuids(t){this._guidsMap=t}invokePauseChangedMethodsOnTracks(){var t;for(const i of this.forEachTrack())(t=i.onPauseChanged)==null||t.call(i)}invokeStateChangedMethodsOnTracks(){var t;for(const i of this.forEachTrack())(t=i.onStateChanged)==null||t.call(i,this._isPlaying)}*internalUpdate(){for(;this._isPlaying&&this.activeAndEnabled;)!this._isPaused&&this._isPlaying&&(this._time+=this.context.time.deltaTime*this.speed,this.internalEvaluate()),yield}internalEvaluate(t=!1){if(!this.isValid())return;let i=this._time;switch(this.extrapolationMode){case dg.Hold:this._speed>0?i=Math.min(i,this._duration):this._speed<0&&(i=Math.max(i,0)),this._time=i;break;case dg.Loop:i%=this._duration,this._time=i;break;case dg.None:if(i>this._duration){this.stop();return}break}const n=this._time;for(const r of this.playableAsset.tracks)if(!r.muted)switch(r.type){case Oo.Activation:if(!t&&!this._isPlaying)continue;for(let o=0;o<r.outputs.length;o++){const a=r.outputs[o];if(typeof a=="object"){let l=!1;if(r.clips)for(const h of r.clips)h.start<=n&&n<=h.end&&(l=!0);const c=a;c.visible!==void 0&&c.visible!==l&&(c.visible=l,xh&&console.warn(this.name,"set ActivationTrack-"+o,c.name,l,n))}}break}if(!this._isStopping)for(const r of this._animationTracks)r.evaluate(n);for(const r of this._audioTracks)r.evaluate(n);for(const r of this._signalTracks)r.evaluate(n);for(const r of this._controlTracks)r.evaluate(n);for(const r of this._customTracks)r.evaluate(n)}resolveBindings(){if(this._clonedPlayableAsset||(this._clonedPlayableAsset=!0,this.playableAsset=s_(this.playableAsset)),!this.playableAsset||!this.playableAsset.tracks)return;const t=this.findRoot(this.gameObject);for(const i of this.playableAsset.tracks){for(let n=i.outputs.length-1;n>=0;n--){let r=i.outputs[n];if(typeof r=="string"){this._guidsMap&&this._guidsMap[r]&&(r=this._guidsMap[r]);const o=ne.findByGuid(r,t);o===null||typeof o!="object"?(i.outputs.splice(n,1),console.warn("Failed to resolve binding",r,i.name,i.type)):(xh&&console.log("Resolved binding",r,"to",o),i.outputs[n]=o)}else if(r===null){if(i.outputs.splice(n,1),iC.createTrackFunctions[i.type])continue;i.type!==Oo.Audio&&i.type!==Oo.Control&&i.type!==Oo.Marker&&i.type!==Oo.Signal&&console.warn("Missing binding",r,i.name,i.type,this.name,this.playableAsset.name)}}if(i.type===Oo.Control&&i.clips)for(let n=0;n<i.clips.length;n++){const r=i.clips[n];let o=r.asset.sourceObject;if(typeof o=="string"){this._guidsMap&&this._guidsMap[o]&&(o=this._guidsMap[o]);const a=ne.findByGuid(o,t);a===null||typeof a!="object"?console.warn("Failed to resolve sourceObject binding",o,i.name,r):(xh&&console.log("Resolved binding",o,"to",a),r.asset.sourceObject=a)}}}}findRoot(t){return t.parent?this.findRoot(t.parent):t}updateTimelineDuration(){if(this._duration=0,!(!this.playableAsset||!this.playableAsset.tracks)){for(const t of this.playableAsset.tracks)if(t.muted!==!0){if(t.clips)for(const i of t.clips)i.end>this._duration&&(this._duration=i.end);if(t.markers)for(const i of t.markers)i.time>this._duration&&(this._duration=i.time+.001)}}}setupAndCreateTrackHandlers(){var i,n,r;if(this._animationTracks.length=0,this._audioTracks.length=0,this._signalTracks.length=0,!this.playableAsset)return;let t=ne.findObjectOfType(xd,this.context);for(const o of this.playableAsset.tracks){const a=o.type,l=iC.createTrackFunctions[a];if(l!=null){const c=l(this,o);if(typeof c.evaluate=="function"){c.director=this,c.track=o,this._customTracks.push(c);continue}}if(o.type===Oo.Animation){if(!o.clips||o.clips.length<=0){xh&&console.warn("Animation track has no clips",o);continue}for(let c=o.outputs.length-1;c>=0;c--){let h=o.outputs[c];if(h instanceof ge){const f=ne.getOrAddComponent(h,Cr);f&&(h=f)}const d=(i=h==null?void 0:h.gameObject)==null?void 0:i.animations;if(d){const f=new TE;f.trackOffset=o.trackOffset,f.director=this,f.track=o;for(let p=0;p<o.clips.length;p++){const m=o.clips[p],v=m.asset;if(!v){console.error(`Timeline ${this.name}: clip #${p} on track "${o.name}" has no animation data`);continue}const y=v.clip;let g=y;if((typeof g=="string"||typeof g=="number")&&(g=d.find(A=>A.name===y)),xh&&console.log(v,y,"→",g),!g){console.warn("Could not find animationClip for model",m,o.name,this.name,(n=this.playableAsset)==null?void 0:n.name,d,h);continue}h instanceof Cr&&h.runtimeAnimatorController&&(h.__internalDidAwakeAndStart||h.initializeRuntimeAnimatorController(),h.runtimeAnimatorController.mixer||h.runtimeAnimatorController.bind(h),f.mixer=h.runtimeAnimatorController.mixer),f.mixer||(f.mixer=new jC(h.gameObject),this.context.animations.registerAnimationMixer(f.mixer)),f.clips.push(g),f.mixer.uncacheAction(g),f.createHooks(m.asset,g);const _=f.mixer.clipAction(g);f.actions.push(_),f.models.push(m)}this._animationTracks.push(f)}}}else if(o.type===Oo.Audio){if(!o.clips||o.clips.length<=0)continue;const c=new yp;c.director=this,c.track=o,c.audioSource=o.outputs.find(h=>h instanceof Fi),this._audioTracks.push(c),t||(t=(r=this.context.mainCameraComponent)==null?void 0:r.gameObject.addComponent(xd)),c.listener=t.listener;for(let h=0;h<o.clips.length;h++){const d=o.clips[h];c.addModel(d)}}else if(o.type===Oo.Marker){const c=new E0;if(c.director=this,c.track=o,o.markers)for(const h of o.markers)switch(h.type){case MS.Signal:c.models.push(h),c.didTrigger.push(!1);break}if(c!==null&&c.models.length>0){const h=ne.getComponent(this.gameObject,ou);h&&(c.receivers.push(h),this._signalTracks.push(c))}}else if(o.type===Oo.Signal){const c=new E0;if(c.director=this,c.track=o,o.markers)for(const h of o.markers)c.models.push(h),c.didTrigger.push(!1);for(const h of o.outputs)c.receivers.push(h);this._signalTracks.push(c)}else if(o.type===Oo.Control){const c=new ME;if(c.director=this,c.track=o,o.clips)for(const h of o.clips)c.models.push(h);c.resolveSourceObjects(this.context),this._controlTracks.push(c)}}}setAudioTracksAllowPlaying(t){for(const i of this._audioTracks)i.onAllowAudioChanged(t)}registerAnimationCallback(t){this.animationCallbackReceivers.push(t)}unregisterAnimationCallback(t){const i=this.animationCallbackReceivers.indexOf(t);i!==-1&&this.animationCallbackReceivers.splice(i,1)}};let Dl=iC;u(Dl,"createTrackFunctions",{});UQ([x()],Dl.prototype,"playOnAwake",void 0);UQ([x()],Dl.prototype,"extrapolationMode",void 0);const Ic=ie("debugtimeline");class T_{constructor(){u(this,"director");u(this,"track")}get muted(){return this.track.muted}set muted(e){var t;e!==this.track.muted&&(this.track.muted=e,(t=this.onMuteChanged)==null||t.call(this))}*forEachClip(e=!1){var t;if((t=this.track)!=null&&t.clips)if(e)for(let i=this.track.clips.length-1;i>=0;i--)yield this.track.clips[i];else for(const i of this.track.clips)yield i}getClipTime(e,t){return t.clipIn+(e-t.start)*t.timeScale}getClipTimeNormalized(e,t){return(e-t.start)/t.duration}evaluateWeight(e,t,i,n=!0){if(t<0||t>=i.length)return 0;const r=i[t];if(n||e>=r.start&&e<=r.end){let o=1;const a=!1;if(r.easeInDuration>0){const l=Math.min((e-r.start)/r.easeInDuration,1);o*=l}if(r.easeOutDuration>0&&!a){const l=Math.min((r.end-e)/r.easeOutDuration,1);o*=l}return o}return 0}}class Tle{constructor(e){u(this,"clip");u(this,"rootPositionOffset");u(this,"rootQuaternionOffset");u(this,"rootStartPosition");u(this,"rootEndPosition");u(this,"rootStartQuaternion");u(this,"rootEndQuaternion");const t=e.getClip();this.clip=t;const i=e.getRoot(),n=i.name+".position",r=i.name+".quaternion";Ic&&console.log(t.name,t.tracks,n);for(const o of t.tracks)if(!(o.times.length<=0)){if(o.name.endsWith(n))this.rootStartPosition=new w().fromArray(o.values,0),this.rootEndPosition=new w().fromArray(o.values,o.values.length-3),this.rootPositionOffset=this.rootEndPosition.clone().sub(this.rootStartPosition),Ic&&console.log(this.rootPositionOffset);else if(o.name.endsWith(r)&&(this.rootStartQuaternion=new xe().fromArray(o.values,0),this.rootEndQuaternion=new xe().fromArray(o.values,o.values.length-4),this.rootQuaternionOffset=this.rootEndQuaternion.clone().multiply(this.rootStartQuaternion),Ic)){const a=new oi().setFromQuaternion(this.rootQuaternionOffset);console.log("ROT",a)}}}get hasOffsets(){return this.rootPositionOffset!==void 0||this.rootQuaternionOffset!==void 0}}class TE extends T_{constructor(){super(...arguments);u(this,"models",[]);u(this,"trackOffset");u(this,"target");u(this,"mixer");u(this,"clips",[]);u(this,"actions",[]);u(this,"weight",1);u(this,"_actionOffsets",[]);u(this,"_didBind",!1);u(this,"_animator",null);u(this,"_useclipOffsets",!0);u(this,"_totalOffsetPosition",new w);u(this,"_totalOffsetRotation",new xe);u(this,"_totalOffsetPosition2",new w);u(this,"_totalOffsetRotation2",new xe);u(this,"_summedPos",new w);u(this,"_tempPos",new w);u(this,"_summedRot",new xe);u(this,"_tempRot",new xe);u(this,"_clipRotQuat",new xe)}onDisable(){var t;(t=this.mixer)==null||t.stopAllAction()}onDestroy(){this.director.context.animations.unregisterAnimationMixer(this.mixer)}onStateChanged(){this._animator&&GU(this._animator.gameObject,this,this.director.isPlaying)}createHooks(t,i){var h,d;if(((h=i.tracks)==null?void 0:h.length)<=0){console.warn("No tracks in AnimationClip",i);return}const n=i.tracks[0].name.split("."),r=n[n.length-2],o=r+".position",a=r+".quaternion";let l=!1,c=!1;for(const f of i.tracks)f.name.endsWith(o)?(l=!0,this.createPositionInterpolant(i,t,f)):f.name.endsWith(a)&&(c=!0,this.createRotationInterpolant(i,t,f));if(!l||!c){const f=(d=this.mixer)==null?void 0:d.getRoot(),p=i.tracks[0],m=p.name.lastIndexOf("."),v=p.name.substring(0,m),y=v.substring(v.lastIndexOf(".")+1),g=f.getObjectByName(y);if(g)if(l){if(!c){const _=i.tracks[0].name.substring(0,m)+".quaternion";Ic&&console.warn("Create quaternion track",y,g);const A=g.quaternion,b=new qc(_,[0,i.duration],[A.x,A.y,A.z,A.w,A.x,A.y,A.z,A.w]);i.tracks.push(b),this.createRotationInterpolant(i,t,b)}}else{const _=v+".position";Ic&&console.warn("Create position track",y,g);const A=g.position,b=new pu(_,[0,i.duration],[A.x,A.y,A.z,A.x,A.y,A.z]);i.tracks.push(b),this.createPositionInterpolant(i,t,b)}}}bind(){if(!this._didBind){this._didBind=!0,Ic&&console.log(this.models),this.mixer?this.target=this.mixer.getRoot():console.warn("No mixer was assigned to animation track");for(const t of this.actions){const i=new Tle(t);this._actionOffsets.push(i)}this.target&&(this._animator=ne.getComponent(this.target,Cr)??null,this._animator&&GU(this._animator.gameObject,this,!0));for(const t of this.models){const i=t.asset,n=i.position,r=i.rotation;n&&n.x!==void 0&&(n.isVector3||(i.position=new w(n.x,n.y,n.z)),r.isQuaternion||(i.rotation=new xe(r.x,r.y,r.z,r.w)))}this.ensureTrackOffsets()}}ensureTrackOffsets(){if(this.trackOffset){const t=this.trackOffset.position;t&&(t.isVector3||(this.trackOffset.position=new w(t.x,t.y,t.z)));const i=this.trackOffset.rotation;i&&(i.isQuaternion||(this.trackOffset.rotation=new xe(i.x,i.y,i.z,i.w)))}}evaluate(t){var l,c,h,d,f,p,m;if(this.track.muted||!this.mixer)return;this.bind(),this._totalOffsetPosition.set(0,0,0),this._totalOffsetRotation.set(0,0,0,1),this._totalOffsetPosition2.set(0,0,0),this._totalOffsetRotation2.set(0,0,0,1);let i=0,n=0,r=!1,o=!1,a=0;for(let v=0;v<this.clips.length;v++){const y=this.models[v],g=this.actions[v],_=y.asset;g.weight=0;const A=t>=y.start&&t<=y.end,b=y.preExtrapolationMode,E=y.postExtrapolationMode,C=v<this.clips.length-1?this.models[v+1]:null;let T=A,M=!1;if(!T&&!r&&y.end<t&&E!==_l.None?(!C||C.start>t)&&(T=!0,r=!0):v==0&&!T&&!o&&y.start>t&&b!==_l.None&&(!C||C.start<t)&&(T=!0,M=!0,o=!0),T){let R=this.weight;R*=this.evaluateWeight(t,v,this.models,T),R*=this.director.weight;let S=A;if(M)switch(b){case _l.Hold:break;case _l.Loop:t+=y.start,S=!0;break;default:t+=y.start,S=!0;break}let I=this.getClipTime(t,y),L=0;const U=_.duration;if(M&&b===_l.Hold&&(I=0),S){if(_.loop)for(L+=Math.floor(I/(U+1e-6));I>U;)I-=U}else if(!A&&r)switch(E){case _l.Hold:I=this.getClipTime(y.end,y);break;case _l.Loop:I%=U;break;case _l.PingPong:const O=Math.floor(I/U)%2!==0;I%=U,O&&(I=U-I);break}y.reversed===!0?g.time=g.getClip().duration-I:g.time=I,g.timeScale=0;const D=Math.max(0,R);if(g.weight=D,a+=D,g.clampWhenFinished=!1,g.isRunning()||g.play(),this._useclipOffsets){const V=i==0?this._totalOffsetPosition:this._totalOffsetPosition2,O=i==0?this._totalOffsetRotation:this._totalOffsetRotation2;i<1&&(n=1-R),i+=1;const F=this._summedPos.set(0,0,0),N=this._tempPos.set(0,0,0),q=this._summedRot.identity(),$=this._tempRot.identity(),oe=_.rotation;oe&&(this._clipRotQuat.identity(),this._clipRotQuat.slerp(oe,R));const ae=this._actionOffsets[v];if(ae.hasOffsets)for(let Re=0;Re<L;Re++)ae.rootPositionOffset?N.copy(ae.rootPositionOffset):N.set(0,0,0),N.applyQuaternion(q),this._clipRotQuat&&N.applyQuaternion(this._clipRotQuat),ae.rootQuaternionOffset&&($.copy(ae.rootQuaternionOffset),q.multiply($)),F.add(N);this._clipRotQuat&&O.multiply(this._clipRotQuat),O.multiply(q),_.position&&F.add(_.position),V.add(F)}}}if(this._useclipOffsets&&(this._totalOffsetPosition.lerp(this._totalOffsetPosition2,n),this._totalOffsetRotation.slerp(this._totalOffsetRotation2,n)),this.__mixerError===void 0&&(Ic||Xe())&&((c=(l=this._animator)==null?void 0:l.runtimeAnimatorController)!=null&&c.mixer)&&this.mixer!==((d=(h=this._animator)==null?void 0:h.runtimeAnimatorController)==null?void 0:d.mixer)&&(this.__mixerError=!0,console.error("AnimationTrack mixer is not shared with the animator controller - this might result in the timeline to not animate properly. Please report a bug to the Needle Engine team!",this)),(f=this._animator)!=null&&f.runtimeAnimatorController){const v=Math.max(0,1-a);(m=(p=this._animator)==null?void 0:p.runtimeAnimatorController)==null||m.update(v)}else this.mixer.update(t)}createRotationInterpolant(t,i,n){var l;const r=n.createInterpolant.bind(n),o=new xe;this.ensureTrackOffsets();const a=(l=this.trackOffset)==null?void 0:l.rotation;n.createInterpolant=()=>{const c=r(),h=c.evaluate.bind(c);return c.evaluate=d=>{var p;const f=h(d);if(o.set(f[0],f[1],f[2],f[3]),o.premultiply(this._totalOffsetRotation),a&&o.premultiply(a),this.director.animationCallbackReceivers)for(const m of this.director.animationCallbackReceivers)(p=m==null?void 0:m.onTimelineRotation)==null||p.call(m,this.director,this.target,d,o);return f[0]=o.x,f[1]=o.y,f[2]=o.z,f[3]=o.w,f},c}}createPositionInterpolant(t,i,n){var h,d;const r=n.createInterpolant.bind(n),o=new w;this.ensureTrackOffsets();const a=(h=this.trackOffset)==null?void 0:h.rotation,l=(d=this.trackOffset)==null?void 0:d.position;let c;n.createInterpolant=()=>{const f=r(),p=f.evaluate.bind(f);return f.evaluate=m=>{var y,g,_;const v=p(m);if(o.set(v[0],v[1],v[2]),i.removeStartOffset&&(c===void 0?(c=null,c=(g=(y=this._actionOffsets.find(A=>A.clip===t))==null?void 0:y.rootStartPosition)==null?void 0:g.clone()):c!=null&&c.isVector3&&o.sub(c)),o.applyQuaternion(this._totalOffsetRotation),o.add(this._totalOffsetPosition),a&&o.applyQuaternion(a),l&&(o.x-=l.x,o.y+=l.y,o.z+=l.z),this.director.animationCallbackReceivers)for(const A of this.director.animationCallbackReceivers)(_=A==null?void 0:A.onTimelinePosition)==null||_.call(A,this.director,this.target,m,o);return v[0]=o.x,v[1]=o.y,v[2]=o.z,v},f}}}const Mle=ie("mutetimeline"),xg=class extends T_{constructor(){super(...arguments);u(this,"models",[]);u(this,"listener");u(this,"audio",[]);u(this,"audioContextTimeOffset",[]);u(this,"lastTime",0);u(this,"audioSource");u(this,"_audioLoader",null);u(this,"_playableDirectorResumed",!1)}getAudioFilePath(t){const i=this.director.sourceId;return zd(i,t)}onAllowAudioChanged(t){for(let i=0;i<this.models.length;i++){const n=this.models[i];this.audio[i].setVolume(t?n.asset.volume:0)}}addModel(t){const i=new pB(this.listener);this.audio.push(i);const n=t;n._didTriggerPlay=!1,this.models.push(n)}onDisable(){for(const t of this.audio)t.isPlaying&&t.stop();for(const t of this.models)t._didTriggerPlay=!1}onDestroy(){for(const t of this.audio)t.source&&(t==null||t.disconnect());this.audio.length=0}onMuteChanged(){if(this.muted)for(let t=0;t<this.audio.length;t++){const i=this.audio[t];i!=null&&i.isPlaying&&i.stop()}}stop(){for(let t=0;t<this.audio.length;t++){const i=this.audio[t];i!=null&&i.isPlaying&&i.stop()}for(const t of this.models)t._didTriggerPlay=!1}onPauseChanged(){for(let t=0;t<this.audio.length;t++){const i=this.audio[t];i!=null&&i.isPlaying&&i.stop()}this._playableDirectorResumed=this.director.isPlaying}evaluate(t){if(Mle||this.track.muted||this.director.speed<0)return;const i=this.director.context.application.muted,n=this._playableDirectorResumed;this._playableDirectorResumed=!1;const r=i?.1:0;for(let o=0;o<this.models.length;o++){const a=this.models[o],l=this.audio[o],c=a.asset;if((!l||!l.buffer)&&this.isInTimeRange(a,t-1,t+1)&&this.handleAudioLoading(a,l),Fi.userInteractionRegistered!==!1&&!(l===null||!l.buffer))if(l.playbackRate=this.director.context.time.timeScale*this.director.speed,l.loop=c.loop,t>=a.start&&t<=a.end&&t<this.director.duration){if(!l.isPlaying||!this.director.isPlaying)(n||!a._didTriggerPlay&&this.lastTime<t)&&(a.duration*a.timeScale>.3?l.offset=a.clipIn+(t-a.start)*a.timeScale:l.offset=0,Ic&&console.log("Timeline Audio ("+this.track.name+") play with offset "+l.offset+" - "+a.asset.clip),l.play(r),a._didTriggerPlay=!0);else{const d=a.clipIn+(t-a.start)*a.timeScale,f=l.context.currentTime-l._startedAt+l.offset;Math.abs(d-f)>.3&&(l.offset=d,l.stop(),l.play(r))}let h=c.volume;if(this.track.volume!==void 0&&(h*=this.track.volume),i&&(h=0),a.easeInDuration>0){const d=Math.min((t-a.start)/a.easeInDuration,1);h*=d}if(a.easeOutDuration>0){const d=Math.min((a.end-t)/a.easeOutDuration,1);h*=d}l.setVolume(h*this.director.weight)}else a._didTriggerPlay=!1,this.director.isPlaying&&l.isPlaying&&l.stop()}this.lastTime=t}loadAudio(t,i=0,n=0){let r=null;const o=t-n,a=t+i;for(const l of this.models)if(this.isInTimeRange(l,o,a)){const c=this.audio[this.models.indexOf(l)],h=this.handleAudioLoading(l,c);h!==null&&(r===null&&(r=[]),r.push(h))}return r!==null?Promise.all(r):null}isInTimeRange(t,i,n){return i<=t.start&&n>=t.end||i>=t.start&&i<=t.end||n>=t.start&&n<=t.end}static dispose(){xg._audioBuffers.clear()}handleAudioLoading(t,i){this._audioLoader||(this._audioLoader=new Kw);const n=this.getAudioFilePath(t.asset.clip);if(xg._audioBuffers.get(n)){const o=xg._audioBuffers.get(n);return o.then(a=>{a&&i.setBuffer(a)}),o}Ic&&console.warn("LOAD audio track",n,this.director.sourceId);const r=new Promise((o,a)=>{this._audioLoader.load(n,l=>{i.setBuffer(l),o(l)},void 0,l=>{console.error("Error loading audio",l),o(null)})});return xg._audioBuffers.set(n,r),r}};let yp=xg;u(yp,"_audioBuffers",new Map);class E0 extends T_{constructor(){super(...arguments);u(this,"models",[]);u(this,"didTrigger",[]);u(this,"receivers",[])}evaluate(t){var n;if(this.track.muted)return;const i=this.director.context.time.deltaTime*1.5;for(let r=0;r<this.models.length;r++){const o=this.models[r],a=this.didTrigger[r],l=o.time-t;let c=!1;if(o.retroActive)c=l<=1e-6;else{const h=Math.abs(l);(h===0||h>=1e-5&&h<i)&&(c=!0)}if(c){if(!a)if(Ic&&console.log("Trigger signal",t,o.time,o),this.didTrigger[r]=!0,((n=this.receivers)==null?void 0:n.length)<=0)ou.invoke(o.asset);else for(const h of this.receivers)h&&h.invoke(o.asset)}else o.emitOnce||(this.didTrigger[r]=!1)}}}class ME extends T_{constructor(){super(...arguments);u(this,"models",[]);u(this,"timelines",[]);u(this,"_previousActiveModel",null)}resolveSourceObjects(t){for(let i=this.models.length-1;i>=0;i--){const r=this.models[i].asset;if(!r.sourceObject||typeof r.sourceObject!="object"){console.log("no source object, removing model",i,r),this.models.splice(i,1);continue}else{const o=ne.getComponent(r.sourceObject,Dl);this.timelines.push(o),o&&r.updateDirector&&(o.playOnAwake=!1)}}}evaluate(t){var i;this._previousActiveModel=null;for(let n=0;n<this.models.length;n++){const r=this.models[n],o=r.asset;if(t>=r.start&&t<=r.end){this._previousActiveModel=r;const a=this.getClipTime(t,r);if(o.controlActivation){const l=o.sourceObject;l.visible=!0}if(o.updateDirector){const l=this.timelines[n];l&&(l.isPlaying&&l.pause(),l.time=a,l.evaluate())}}else{const a=(i=this._previousActiveModel)==null?void 0:i.asset;if(o.controlActivation){const l=o.sourceObject;(a==null?void 0:a.sourceObject)!==l&&(l.visible=!1)}}}}}const Ile=ie("debugpost");let YR=null;function Rle(s){YR=s}function NQ(s){let e=s.gameObject;for(;e;){for(const t of mE(e))if(t.isPostProcessingManager===!0)return t;e=e.parent}return null}function Ple(s){let e=NQ(s);if(!e)if(YR){Ile&&console.warn("Adding postprocessing manager to the scene.");const t=s.scene;e=ya(t,YR)}else Xe()&&console.warn("No post processing manager found");return e}var zQ=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Ble=ie("debugpost");class Ze{constructor(e){u(this,"isVolumeParameter",!0);u(this,"_isInitialized",!1);u(this,"_active",!0);u(this,"_value");u(this,"_valueRaw");u(this,"_defaultValue");u(this,"valueProcessor");u(this,"onValueChanged");e!==void 0&&this.initialize(e)}get isInitialized(){return this._isInitialized}initialize(e){e!==void 0&&(this._value=e,this._defaultValue=e,this._valueRaw=e,this._isInitialized=!0)}get overrideState(){return this._active}set overrideState(e){if(this._active===e)return;this._active=e;const t=e?this._valueRaw:this._defaultValue;this.processValue(t,!0)}get value(){return this._valueRaw}set value(e){this.isInitialized||this.initialize(e),this.processValue(e,!1)}set defaultValue(e){this._defaultValue=e}__init(){this.processValue(this._valueRaw,!0)}processValue(e,t){if(e==null||!t&&this.testIfValueChanged(e)===!1)return;const i=this._value;Ble&&typeof i=="number"&&typeof e=="number"&&(i==null||i.toFixed(4),e==null||e.toFixed(4)),!this._active&&this._defaultValue!==void 0?(this._value=this._defaultValue,e=this._defaultValue,this._valueRaw=e):(this._valueRaw=e,this._active&&this.valueProcessor&&(e=this.valueProcessor(e)),this._value=e),this.onValueChanged&&this.onValueChanged(e,i,this)}testIfValueChanged(e){return this._valueRaw!==e}}zQ([x()],Ze.prototype,"overrideState",null);zQ([x()],Ze.prototype,"value",null);class Dle extends tl{constructor(){super([Ze])}onSerialize(e,t){}onDeserialize(e,t){const i=t.target,n=t.path;let r;if(i&&n&&(r=i[n]),(typeof r!="object"||typeof r=="object"&&r.isVolumeParameter!==!0)&&(r=new Ze),typeof e=="object"&&"value"in e){const o=e.value;r.initialize(o),r.overrideState=e.overrideState}else r.value=e;return r}}new Dle;var Ole=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Lle=ie("debugpost");class er extends Te{constructor(t=void 0){super();u(this,"active",!0);u(this,"_manager",null);u(this,"_result");u(this,"_postprocessingContext",null);if(t)for(const i of Object.keys(t)){const n=t[i],r=this[i];r instanceof Ze?r.initialize(n):r!==void 0&&(this[i]=n)}}get isPostProcessingEffect(){return!0}onEnable(){super.onEnable(),this.onEffectEnabled(),this.__internalDidAwakeAndStart&&(this.active=!0)}onDisable(){var t;super.onDisable(),(t=this._manager)==null||t.removeEffect(this),this.active=!1}onEffectEnabled(t){var i;t&&t.isPostProcessingManager===!0?this._manager=t:this._manager||(this._manager=Ple(this)),(i=this._manager)==null||i.addEffect(this)}init(){}get postprocessingContext(){return this._postprocessingContext}apply(t){var i;return this._postprocessingContext=t,this._result||(this.initParameters(),this._result=(i=this.onCreateEffect)==null?void 0:i.call(this)),this._result&&this.initParameters(),this._result}unapply(){}dispose(){Lle&&console.warn("DISPOSE",this),this._result&&(Array.isArray(this._result)?this._result.forEach(t=>t.dispose()):this._result.dispose()),this._result=void 0}initParameters(){const t=Object.keys(this);for(const i of t){const n=this[i];n instanceof Ze&&n.__init()}}onEditorModification(t){const i=t.propertyName;if(this[i]instanceof Ze){const n=t.value;return this[i].value=n,!0}}}Ole([x()],er.prototype,"active",void 0);var kle=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Fle=ie("debugpost"),KR={};function il(s,e){KR[s]=e}function Ule(s){return s.__type in KR?KR[s.__type]:(Fle&&s.__type&&console.warn("Unknown postprocessing type",s.__type,s),er)}class M_{constructor(){u(this,"components",[])}init(){var e;(e=this.components)==null||e.forEach(t=>t.init())}addEffect(e){this.components.push(e)}removeEffect(e){const t=this.components.indexOf(e);t>=0&&this.components.splice(t,1)}}kle([Cv([s=>Ule(s),er])],M_.prototype,"components",void 0);var Nle=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r},KU;(function(s){s[s.LOW=0]="LOW",s[s.MEDIUM=1]="MEDIUM",s[s.HIGH=2]="HIGH",s[s.ULTRA=3]="ULTRA"})(KU||(KU={}));class I_ extends er{constructor(){super(...arguments);u(this,"preset",new Ze(Vf.HIGH))}get typeName(){return"Antialiasing"}onCreateEffect(){const t=new xH({preset:Vf.HIGH,edgeDetectionMode:lD.DEPTH});return this.preset.onValueChanged=i=>{t.applyPreset(i)},t}}Nle([x(Ze)],I_.prototype,"preset",void 0);il("Antialiasing",I_);const zle=ie("debugusdz");class jd{constructor(){u(this,"files",new Array)}static getName(e){var r;const t=e.split(".").pop();let n=(r=e.split(".").slice(0,-1).join(".").split("/").pop())==null?void 0:r.replace(".","_");return n||(n="Audio_"+Math.random().toString(36).substring(2,15)),Ul(n)+"."+t}get extensionName(){return"Audio"}onExportObject(e,t,i){const n=ne.getComponents(e,Fi);if(n.length)for(const r of n){if(!r.clip||typeof r.clip!="string"||!r.playOnAwake)continue;const o=r.clip.split("/").pop()||"Audio",a=jd.getName(r.clip),l=Ul(a);if(!this.files.some(c=>c.path===r.clip)){this.files.push({path:r.clip,name:a});const c=a.toLowerCase();i.quickLookCompatible&&!c.endsWith(".mp3")&&!c.endsWith(".wav")&&!c.endsWith(".m4a")&&console.error("Audio file "+r.clip+" from "+r.name+" is not an MP3 or WAV file. QuickLook may not support playing it.")}i.quickLookCompatible||t.addEventListener("serialize",(c,h)=>{c.appendLine(),c.beginBlock(`def SpatialAudio "${l}"`,"(",!1),c.appendLine(`displayName = "${o}"`),c.closeBlock(")"),c.beginBlock(),c.appendLine(`uniform asset filePath = @audio/${a}@`),c.appendLine(`uniform token auralMode = "${r.spatialBlend>0?"spatial":"nonSpatial"}"`),c.appendLine(`uniform token playbackMode = "${r.loop?"loopFromStage":"onceFromStart"}"`),c.appendLine(`uniform float gain = ${r.volume}`),c.closeBlock()})}}async onAfterSerialize(e){for(const t of this.files){const i="audio/"+t.name;if(e.files[i]){zle&&console.warn("Audio file with name "+i+" already exists in the context. Skipping.");continue}const o=await(await(await fetch(t.path)).blob()).arrayBuffer(),a=new Uint8Array(o);e.files[i]=a}}}const rp=ie("debugautosync"),uM=Symbol("syncerId");class Gle{constructor(){u(this,"_syncers",{})}getOrCreateSyncer(e){if(!e.guid)return null;if(this._syncers[e.guid])return this._syncers[e.guid];const t=new Hle(e);return t[uM]=e.guid,this._syncers[t[uM]]=t,t}removeSyncer(e){delete this._syncers[e[uM]]}}const ZD=new Gle;class Hle{constructor(e){u(this,"comp");u(this,"hasChanges",!1);u(this,"changedProperties",{});u(this,"data",{});u(this,"_isReceiving",!1);u(this,"_isInit",!1);u(this,"onHandleSending",()=>{if(!this.hasChanges)return;this.hasChanges=!1;const e=this.comp.context.connection;if(!e||!e.isConnected||!e.isInRoom){for(const t in this.changedProperties)delete this.changedProperties[t];return}for(const t in this.data)delete this.data[t];this.data.guid=this.comp.guid;for(const t in this.changedProperties){const i=this.changedProperties[t];delete this.changedProperties[t],this.data[t]=i}e.send(this.networkingKey,this.data,Ga.Queued)});u(this,"onHandleReceiving",e=>{if(rp&&console.log("RECEIVE",this.comp.name,this.comp.guid,e),!this._isInit||!this.comp)return;const t=e.guid;if(!(t&&t!==this.comp.guid)){rp&&console.log("RECEIVED",this.comp.name,this.comp.guid,e);try{this._isReceiving=!0;for(const i in e){if(i==="guid")continue;const n=e[i];this.comp[i]=n,rp&&console.log("SET",i,n)}}catch(i){console.error(i)}finally{this._isReceiving=!1}}});this.comp=e}get networkingKey(){return this.comp.guid}init(e){if(this._isInit)return;this._isInit=!0,this.comp=e,this.comp.context.post_render_callbacks.push(this.onHandleSending),this.comp.context.connection.beginListen(this.networkingKey,this.onHandleReceiving);const t=this.comp.context.connection.tryGetState(this.comp.guid);t&&this.onHandleReceiving(t)}destroy(){this._isInit&&(this.comp.context.post_render_callbacks.splice(this.comp.context.post_render_callbacks.indexOf(this.onHandleSending),1),this.comp.context.connection.stopListen(this.networkingKey,this.onHandleReceiving),this.comp=null,this._isInit=!1)}notifyChanged(e,t){this._isReceiving||(rp&&console.log("Property changed: "+e,t),this.hasChanges=!0,this.changedProperties[e]=t)}}function Vle(s,e){let t=e!==s;return!t&&s&&e&&(Array.isArray(s)&&Array.isArray(e)||typeof s=="object"&&typeof e=="object")&&(t=!0),t}const wA=Symbol("AutoSyncHandler");function Qle(s){if(s[wA])return s[wA];const e=ZD.getOrCreateSyncer(s);return e==null||e.init(s),s[wA]=e,e}function jle(s){const e=s[wA];e&&(ZD.removeSyncer(e),e.destroy(),delete s[wA])}const $D=function(s){return function(e,t){var h;let i="";typeof t=="string"?i=t:i=t.name;let n=null,r;typeof s=="string"?r=e[s]:typeof s=="function"&&(r=s);const o=e,a=o.__internalAwake;if(typeof a!="function"){(rp||Xe())&&console.error('@syncField can currently only used on Needle Engine Components, custom object of type "'+((h=e==null?void 0:e.constructor)==null?void 0:h.name)+'" is not supported',e);return}rp&&console.log(i);const l=Symbol(i);o.__internalAwake=function(){if(this[l]!==void 0)return;this[l]=this[i],n=ZD.getOrCreateSyncer(this);const d=Object.getOwnPropertyDescriptor(this,i);if((d==null?void 0:d.set)===void 0){let f=!1;Object.defineProperty(this,i,{set:function(p){var v;const m=this[l];if(this[l]=p,f){Xe()&&console.warn("Recursive call detected",i);return}f=!0;try{const y=Vle(p,m);rp&&console.log("SyncField assignment",i,"changed?",y,p),y&&(r==null?void 0:r.call(this,p,m))!==!1&&((v=Qle(this))==null||v.notifyChanged(i,p))}finally{f=!1}},get:function(){return this[l]},configurable:!0,enumerable:!0})}n==null||n.init(this),a.call(this)};const c=o.__internalDestroy;o.__internalDestroy=function(){jle(this),c.call(this)}}};var IE=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const aa=ie("debugplayersync");class Wd extends Te{constructor(){super(...arguments);u(this,"autoSync",!0);u(this,"asset");u(this,"onPlayerSpawned");u(this,"_localInstance");u(this,"onJoinedRoom",()=>{aa&&console.log("PlayerSync.joinedRoom. autoSync is set to "+this.autoSync),this.autoSync&&this.getInstance()});u(this,"destroyInstance",()=>{var t;(t=this._localInstance)==null||t.then(i=>{aa&&console.log("PlayerSync.destroyInstance",i),p_(i,this.context.connection,!0,{saveInRoom:!1})}),this._localInstance=void 0})}static async setupFrom(t,i){const n=si.getOrCreateFromUrl(t);if(!n.asset){const a=await n.loadAssetAsync();ne.getOrAddComponent(a,Xs)}const r=new Wd;r._internalInit(i),r.asset=n;const o=new ge;return o.guid=t,ne.addComponent(o,r),r}awake(){this.watchTabVisible(),this.onPlayerSpawned||(this.onPlayerSpawned=new un)}onEnable(){this.context.connection.beginListen(Ut.RoomStateSent,this.onJoinedRoom),this.context.connection.beginListen(Ut.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Ut.LeftRoom,this.destroyInstance),this.context.connection.isInRoom&&this.onJoinedRoom()}onDisable(){this.context.connection.stopListen(Ut.RoomStateSent,this.onJoinedRoom),this.context.connection.stopListen(Ut.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Ut.LeftRoom,this.destroyInstance)}async getInstance(){var i,n,r,o,a,l;if(this._localInstance)return this._localInstance;if(aa&&console.log("PlayerSync.createInstance",(i=this.asset)==null?void 0:i.url),!((n=this.asset)!=null&&n.asset)&&!((r=this.asset)!=null&&r.url))return console.error('PlayerSync: can not create an instance because "asset" is not set and or has no URL!'),null;this.gameObject.guid||console.warn("PlayerSync: gameObject has no guid! This might cause issues with syncing the player state."),this._localInstance=(o=this.asset)==null?void 0:o.instantiateSynced({parent:this.gameObject,deleteOnDisconnect:!0},!0);const t=await this._localInstance;if(t){const c=ne.getComponentsInChildren(t,Xs);if(c!=null&&c.length){for(const h of c)h.owner=this.context.connection.connectionId;(a=this.onPlayerSpawned)==null||a.invoke(t)}else this._localInstance=void 0,console.error("<strong>Failed finding PlayerState on "+((l=this.asset)==null?void 0:l.url)+"</strong>: please make sure the asset has a PlayerState component!"),ne.destroySynced(t)}else this._localInstance=void 0,console.warn("PlayerSync: failed instantiating asset!");return this._localInstance}watchTabVisible(){window.addEventListener("visibilitychange",t=>{if(document.visibilityState==="visible")for(let i=Xs.all.length-1;i>=0;i--){const n=Xs.all[i];(!n.owner||!this.context.connection.userIsInRoom(n.owner))&&n.doDestroy()}})}}IE([x()],Wd.prototype,"autoSync",void 0);IE([x(si)],Wd.prototype,"asset",void 0);IE([x(un)],Wd.prototype,"onPlayerSpawned",void 0);var IS;(function(s){s.OwnerChanged="ownerChanged"})(IS||(IS={}));const Qs=class extends Te{constructor(){super(...arguments);u(this,"onOwnerChangeEvent",new un);u(this,"onFirstOwnerChangeEvent",new un);u(this,"hasOwner",!1);u(this,"owner");u(this,"dontDestroy",!1);u(this,"onUserLeftRoom",t=>{if(t.userId===this.owner){aa&&console.log("PLAYERSYNC LEFT",this.owner),this.doDestroy();return}})}static get all(){return Qs._all}static get local(){return Qs._local}static getFor(t){if(t instanceof ge)return ne.getComponentInParent(t,Qs);if(t instanceof Te)return ne.getComponentInParent(t.gameObject,Qs)}static isLocalPlayer(t){const i=Qs.getFor(t);return(i==null?void 0:i.isLocalPlayer)??!1}static addEventListener(t,i){return this._callbacks[t]||(this._callbacks[t]=[]),this._callbacks[t].push(i),i}static removeEventListener(t,i){if(!this._callbacks[t])return;const n=this._callbacks[t].indexOf(i);n>=0&&this._callbacks[t].splice(n,1)}static dispatchEvent(t,i){if(this._callbacks[t])for(const n of this._callbacks[t])n(i)}get isLocalPlayer(){return this.owner===this.context.connection.connectionId}onOwnerChange(t,i){var a,l;aa&&console.log("PlayerSync.onOwnerChange",this,"newOwner",t,"oldOwner",i);const n=Qs._local.indexOf(this);n>=0&&Qs._local.splice(n,1);const r={playerState:this,oldValue:i,newValue:t};if(this.hasOwner||(this.hasOwner=!0,(a=this.onFirstOwnerChangeEvent)==null||a.invoke(r)),(l=this.onOwnerChangeEvent)==null||l.invoke(r),this.owner===this.context.connection.connectionId){Qs._local.push(this);const c=new CustomEvent("local-owner-changed",{detail:r});this.dispatchEvent(c)}const o=new CustomEvent("owner-changed",{detail:r});this.dispatchEvent(o),Qs.dispatchEvent(IS.OwnerChanged,o)}awake(){Qs.all.push(this),aa&&console.log("Registered new PlayerState",this.guid,Qs.all.length-1,Qs.all),this.context.connection.beginListen(Ut.UserLeftRoom,this.onUserLeftRoom)}async start(){aa&&console.log("PLAYERSTATE.START, owner: "+this.owner,this.context.connection.usersInRoom([])),this.owner?(this.context.connection.isInRoom||await Xc(300),this.context.connection.userIsInRoom(this.owner)==!1&&(aa&&console.log(`PlayerSync.start → doDestroy "${this.name}" because user "${this.owner}" is not in room anymore...`,"Currently in room:",...this.context.connection.usersInRoom()),this.doDestroy())):this.owner||(aa&&console.warn("PlayerState.start → owner is undefined!",this.name),setTimeout(()=>{!this.destroyed&&!this.owner?this.dontDestroy?aa&&console.warn("PlayerState.start → owner is still undefined but dontDestroy is set to true",this.name):(aa&&console.warn(`PlayerState.start → owner is still undefined: destroying "${this.name}" instance now`),this.doDestroy()):aa&&console.log("PlayerState.start → owner is assigned",this.owner)},2e3))}doDestroy(){aa&&console.log("PlayerSync.doDestroy → syncDestroy",this.name),p_(this.gameObject,this.context.connection,!0,{saveInRoom:!1})}onDestroy(){if(this.context.connection.stopListen(Ut.UserLeftRoom,this.onUserLeftRoom),Qs.all.splice(Qs.all.indexOf(this),1),this.isLocalPlayer){const t=Qs._local.indexOf(this);t>=0&&Qs._local.splice(t,1)}}};let Xs=Qs;u(Xs,"_all",[]),u(Xs,"_local",[]),u(Xs,"_callbacks",{});IE([$D(Xs.prototype.onOwnerChange)],Xs.prototype,"owner",void 0);const Wle=ie("debugavatar"),gl=class extends Te{constructor(){super(...arguments);u(this,"connectionId");u(this,"avatar")}static getAvatar(t){return t>=0&&t<gl.instances.length?gl.instances[t]:null}static onAvatarMarkerCreated(t){return gl._onNewAvatarMarkerAdded.push(t),t}static onAvatarMarkerDestroyed(t){return gl._onAvatarMarkerDestroyed.push(t),t}awake(){gl.instances.push(this),Wle&&console.log(this);for(const t of gl._onNewAvatarMarkerAdded)t({avatarMarker:this,gameObject:this.gameObject})}onDestroy(){gl.instances.splice(gl.instances.indexOf(this),1);for(const t of gl._onAvatarMarkerDestroyed)t({avatarMarker:this,gameObject:this.gameObject})}isLocalAvatar(){return this.connectionId===this.context.connection.connectionId}};let Ps=gl;u(Ps,"instances",[]),u(Ps,"_onNewAvatarMarkerAdded",[]),u(Ps,"_onAvatarMarkerDestroyed",[]);var qle=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const $m=ie("debugxrflags"),GQ=ie("disablexrflags");GQ&&console.warn("XRFlags are disabled");var da;(function(s){s[s.Never=0]="Never",s[s.Browser=1]="Browser",s[s.AR=2]="AR",s[s.VR=4]="VR",s[s.FirstPerson=8]="FirstPerson",s[s.ThirdPerson=16]="ThirdPerson",s[s.All=4294967295]="All"})(da||(da={}));const m2=class{constructor(){u(this,"Mask",da.Browser|da.ThirdPerson)}Has(e){return(this.Mask&e)!==0}Set(e){$m&&console.warn("Set XR flag state to",e),this.Mask=e,Ws.Apply()}Enable(e){this.Mask|=e,Ws.Apply()}Disable(e){this.Mask&=~e,Ws.Apply()}Toggle(e){this.Mask^=e,Ws.Apply()}EnableAll(){this.Mask=-1,Ws.Apply()}DisableAll(){this.Mask=0,Ws.Apply()}};let xr=m2;u(xr,"Global",new m2);const uc=class extends Te{constructor(){super(...arguments);u(this,"visibleIn")}static Apply(){for(const t of this.registry)t.UpdateVisible(xr.Global)}awake(){uc.registry.push(this)}onEnable(){uc.firstApply?this.UpdateVisible(xr.Global):(uc.firstApply=!0,uc.Apply())}onDestroy(){const t=uc.registry.indexOf(this);t>=0&&uc.registry.splice(t,1)}get isOn(){return this.gameObject.visible}UpdateVisible(t=null){if(GQ)return;let i;const n=t;if(n&&typeof n=="number"&&(console.assert(typeof n=="number","XRFlag.UpdateVisible: state must be a number",n),$m&&console.log(n),uc.buffer.Mask=n,t=uc.buffer),t instanceof xr?($m&&console.warn(this.name,"use passed in mask",t.Mask,this.visibleIn),i=t.Has(this.visibleIn)):($m&&console.log(this.name,"use global mask"),xr.Global.Has(this.visibleIn)),i!==void 0)if(i)$m&&console.log(this.name,"is visible",this.gameObject.uuid),ne.setActive(this.gameObject,!0);else{if($m&&console.log(this.name,"is not visible",this.gameObject.uuid),!this.gameObject.visible)return;this.gameObject.visible=!1}}};let Ws=uc;u(Ws,"registry",[]),u(Ws,"firstApply"),u(Ws,"buffer",new xr);qle([x()],Ws.prototype,"visibleIn",void 0);var eO=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const _y=ie("debugwebxr"),JU=new xe().setFromAxisAngle(new w(0,1,0),Math.PI);class Bd extends Te{constructor(){super(...arguments);u(this,"head");u(this,"leftHand");u(this,"rightHand");u(this,"_leftHandMeshes");u(this,"_rightHandMeshes");u(this,"_syncTransforms")}async onEnterXR(t){if(!this.activeAndEnabled)return;_y&&console.warn("AVATAR ENTER XR",this.guid,this.sourceId,this,this.activeAndEnabled),this._syncTransforms&&(this._syncTransforms.length=0),await this.prepareAvatar();const i=Xs.getFor(this);if(i!=null&&i.owner){const n=this.gameObject.addComponent(Ps);n.avatar=this.gameObject,n.connectionId=i.owner}else this.context.connection.isConnected?console.error("No player state found for avatar",this):i&&!this.context.connection.isConnected&&(i.dontDestroy=!0)}onLeaveXR(t){const i=this.gameObject.getComponent(Ps);i&&i.destroy()}onUpdateXR(t){var c,h;if(!this.activeAndEnabled)return;const i=Xs.isLocalPlayer(this);if(!i)return;const n=t.xr;if(n.rig&&n.rig.gameObject!==this.gameObject.parent&&(this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),this.gameObject.scale.set(1,1,1),n.rig.gameObject.add(this.gameObject)),this._syncTransforms&&i)for(const d of this._syncTransforms)d.fastMode=!0,d.isOwned()||d.requestOwnership();if(this.head&&this.context.mainCamera){const d=this.head.asset;if(d.position.copy(this.context.mainCamera.position),d.position.x*=-1,d.position.z*=-1,d.quaternion.copy(this.context.mainCamera.quaternion),d.quaternion.x*=-1,this.context.time.frameCount%10===0){const f=ne.getComponentsInChildren(this.head.asset,Ws);for(const p of f)p.enabled=!1,p.gameObject.visible=!1}}const r=t.xr.leftController,o=(c=this.leftHand)==null?void 0:c.asset;r&&o?(o.position.copy(r.gripPosition),o.quaternion.copy(r.gripQuaternion),o.quaternion.multiply(JU),o.visible=r.isTracking,this.updateHandVisibility(r,o,this._leftHandMeshes)):o&&o.visible&&(o.visible=!1);const a=t.xr.rightController,l=(h=this.rightHand)==null?void 0:h.asset;a&&l?(l.position.copy(a.gripPosition),l.quaternion.copy(a.gripQuaternion),l.quaternion.multiply(JU),l.visible=a.isTracking,this.updateHandVisibility(a,l,this._rightHandMeshes)):l&&l.visible&&(l.visible=!1)}onBeforeRender(){this.context.xr&&this.context.time.frame%10===0&&this.updateRemoteAvatarVisibility()}updateHandVisibility(t,i,n){if(n){const r=t.model&&t.model.visible&&t.model!==i;n.forEach(o=>{rd(o,!r)})}}updateRemoteAvatarVisibility(){var t,i,n;if(this.context.connection.isConnected){const r=Xs.getFor(this);if(r&&r.isLocalPlayer==!1){const o=It.getXRSync(this.context);if(o&&o.hasState(r.owner)){this.tryFindAvatarObjectsIfMissing();const a=(t=this.leftHand)==null?void 0:t.asset;a&&(a.visible=(o==null?void 0:o.isTracking(r.owner,"left"))??!1);const l=(i=this.rightHand)==null?void 0:i.asset;l&&(l.visible=(o==null?void 0:o.isTracking(r.owner,"right"))??!1)}if((n=this.head)!=null&&n.asset){const a=ne.getComponentsInChildren(this.head.asset,Ws);for(const l of a)l.enabled=!1,l.gameObject.visible=!0}}}}tryFindAvatarObjectsIfMissing(){if(!this.head||!this.leftHand||!this.rightHand){const t={head:this.head,leftHand:this.leftHand,rightHand:this.rightHand};e5.tryFindAvatarObjects(this.gameObject,this.sourceId||"",t),t.head&&(this.head=t.head),t.leftHand&&(this.leftHand=t.leftHand),t.rightHand&&(this.rightHand=t.rightHand)}}async prepareAvatar(){if(this.tryFindAvatarObjectsIfMissing(),this.head)this.head instanceof ge&&(this.head=new si("",this.sourceId,this.head));else{const t=new ge;t.name="Head";const i=Vd.createPrimitive(Wa.Cube);t.add(i),this.gameObject.add(t),this.head=new si("",this.sourceId,t),_y&&console.log("Create head",t)}if(this.rightHand)this.rightHand instanceof ge&&(this.rightHand=new si("",this.sourceId,this.rightHand));else{const t=new ge;t.name="Right Hand",this.gameObject.add(t),this.rightHand=new si("",this.sourceId,t),_y&&console.log("Create right hand",t)}if(this.leftHand)this.leftHand instanceof ge&&(this.leftHand=new si("",this.sourceId,this.leftHand));else{const t=new ge;t.name="Left Hand",this.gameObject.add(t),this.leftHand=new si("",this.sourceId,t),_y&&console.log("Create left hand",t)}await this.loadAvatarObjects(this.head,this.leftHand,this.rightHand),this._leftHandMeshes=[],this.leftHand.asset.traverse(t=>{t!=null&&t.isMesh&&this._leftHandMeshes.push(t)}),this._rightHandMeshes=[],this.rightHand.asset.traverse(t=>{t!=null&&t.isMesh&&this._rightHandMeshes.push(t)}),Xs.isLocalPlayer(this.gameObject)&&(this._syncTransforms=ne.getComponentsInChildren(this.gameObject,Kc))}async loadAvatarObjects(t,i,n){const r=t.loadAssetAsync(),o=i.loadAssetAsync(),a=n.loadAssetAsync(),l=new Array;r&&l.push(r),o&&l.push(o),a&&l.push(a);const c=await YC(l);_y&&console.log("Avatar loaded results:",c)}}eO([x(si)],Bd.prototype,"head",void 0);eO([x(si)],Bd.prototype,"leftHand",void 0);eO([x(si)],Bd.prototype,"rightHand",void 0);class zc{static Add(e,t,i=null){if(t){for(const n of this.Pois)if(n.obj===t)return;this.Pois.push({obj:t,avatar:i}),this.LastChangeTime=e.time.time}}static Remove(e,t){var i;if(t){for(const n of this.Pois)if(n.obj===t){this.Pois.splice(this.Pois.indexOf(n),1),this.LastChangeTime=(e==null?void 0:e.time.time)??((i=Ot.Current)==null?void 0:i.time.time);return}}}}u(zc,"Pois",[]),u(zc,"LastChangeTime",0);var RS;(function(s){s.TargetChanged="avatar-look-target-changed"})(RS||(RS={}));class Xle{constructor(){u(this,"guid");u(this,"position",new w)}}class T0 extends Te{constructor(){super(...arguments);u(this,"target",null);u(this,"avatar",null);u(this,"_model",null);u(this,"_targetModel",new Xle);u(this,"_currentTargetObject",null);u(this,"_lastUpdateTime",0);u(this,"_lookDuration",0);u(this,"_lastPoiChangedTime",0)}set controlledTarget(t){this.target=t;const i=X.get("MoveRandom");if(i&&this.target){const n=ne.getComponent(this.target,i);n&&n.destroy()}}awake(){if(this.avatar=ne.getComponentInParent(this.gameObject,Ps),this.avatar){const t=ne.getComponentInParent(this.gameObject,Ps);this._model=new bD(this.context.connection,this.guid),t!=null&&t.isLocalAvatar&&this._model.requestOwnership()}this.context.connection.beginListen(RS.TargetChanged,t=>{var i;this.target&&t&&t.guid===((i=this.avatar)==null?void 0:i.guid)&&Os(this.target,t.position)})}update(){var i;if((!this.context.connection.isConnected||(i=this._model)!=null&&i.hasOwnership)&&(zc.LastChangeTime!==this._lastPoiChangedTime&&(this._lastPoiChangedTime=zc.LastChangeTime,this._lookDuration=0),this.selectTarget(),this._currentTargetObject&&this.context.time.frameCount%10===0&&this.target)){const n=Qt(this._currentTargetObject);Os(this.target,n),this.context.connection.isConnected&&this.avatar&&(this.context.connection.send(RS.TargetChanged,this._targetModel),this._targetModel.guid=this.avatar.guid,this._targetModel.position.copy(n))}}selectTarget(){if(this.context.time.time-this._lastUpdateTime>this._lookDuration){this._lastUpdateTime=this.context.time.time,this._lookDuration=Math.random()*.5+.2;const i=zc.Pois;if(i.length>0){const n=i[Math.floor(Math.random()*i.length)];if(n&&n.obj){if(n.avatar&&n.avatar===this.avatar)return;this._currentTargetObject=n.obj}}}}}function HQ(s){return s&&s.isComponent}const Yle=Symbol("object"),dM=new _a(()=>new w,20);class VQ{constructor(e,t,i,n,r,o){u(this,"_point");u(this,"_normal");u(this,"_tangentVelocity");u(this,"distance");u(this,"impulse");u(this,"friction");this._point=e,this.distance=t,this._normal=i,this.impulse=n,this.friction=r,this._tangentVelocity=o}get point(){return dM.get().set(this._point.x,this._point.y,this._point.z)}get normal(){return dM.get().set(this._normal.x,this._normal.y,this._normal.z)}get tangentVelocity(){return dM.get().set(this._tangentVelocity.x,this._tangentVelocity.y,this._tangentVelocity.z)}}class QQ{constructor(e,t,i){u(this,"contacts");u(this,"me");u(this,"_collider");u(this,"_gameObject");this.me=e,this._collider=t,this._gameObject=t.gameObject,this.contacts=i}get collider(){return this._collider}get gameObject(){return this._gameObject}get rigidBody(){var e;return(e=this.collider)==null?void 0:e.attachedRigidbody}}class jQ{constructor(e,t){u(this,"object");u(this,"collider");this.object=e,this.collider=t}}const es=ie("debugnetworkingstreams");var Nn;(function(s){s.Connected="peer-user-connected",s.StreamReceived="receive-stream",s.StreamEnded="call-ended",s.Disconnected="peer-user-disconnected",s.UserJoined="user-joined"})(Nn||(Nn={}));class tO{constructor(e,t){u(this,"type",Nn.StreamEnded);u(this,"userId");u(this,"direction");this.userId=e,this.direction=t}}class WQ{constructor(e,t,i){u(this,"type",Nn.StreamReceived);u(this,"userId");u(this,"stream");u(this,"target");this.userId=e,this.stream=t,this.target=i}}class Kle{constructor(e,t){u(this,"guid");u(this,"peerId");u(this,"dontSave",!0);this.guid=e.id,this.peerId=t}}var xc;(function(s){s.Incoming="incoming",s.Outgoing="outgoing"})(xc||(xc={}));class Jle extends Zs{constructor(t,i,n,r=null){super();u(this,"peerId");u(this,"userId");u(this,"direction");u(this,"call");u(this,"_stream",null);u(this,"_isDisposed",!1);this.peerId=i.peer,this.userId=t,this.call=i,this.direction=n,this._stream=r,i.on("stream",o=>{if(es&&console.log("Receive stream",`
Audio:`,o.getAudioTracks(),`
Video:`,o.getVideoTracks()),this._stream=o,n===xc.Incoming){const a=new WQ(t,o,this);this.dispatchEvent(a)}}),i.on("close",()=>{this.dispatchEvent(new tO(t,n))})}get stream(){return this._stream}close(){this._isDisposed||(this._isDisposed=!0,this.call.close(),Rc(this._stream))}get isOpen(){var t;return((t=this.call.peerConnection)==null?void 0:t.connectionState)==="connected"}get isOpening(){var t;return((t=this.call.peerConnection)==null?void 0:t.connectionState)==="connecting"}get isClosed(){return!this.isOpen||this._isDisposed}}function ZU(s){return s=s.replace("a=fmtp:111 minptime=10;useinbandfec=1","a=fmtp:111 ptime=5;useinbandfec=1;stereo=1;maxplaybackrate=48000;maxaveragebitrat=128000;sprop-stereo=1"),s}const wg=class extends Zs{constructor(t,i){super();u(this,"updateCalls",()=>{var t;for(let i=this._incomingCalls.length-1;i>=0;i--){const n=this._incomingCalls[i];n.isClosed&&!n.isOpening&&this._incomingCalls.splice(i,1)}for(let i=this._outgoingCalls.length-1;i>=0;i--){const n=this._outgoingCalls[i];let r=!1;n.isClosed&&!n.isOpening&&((t=n.stream)!=null&&t.active?es&&console.warn("!!! Stream is still active, don't remove call",n.userId,"Your id: "+this.context.connection.connectionId):(es&&console.warn("!!! Remove closed call",n.userId),r=!0)),this.context.connection.userIsInRoom(n.userId)===!1&&(es&&console.warn("!!! User is not in room anymore, remove call",n.userId),r=!0),r&&(n.close(),this._outgoingCalls.splice(i,1))}});u(this,"id");u(this,"context");u(this,"_incomingCalls",[]);u(this,"_outgoingCalls",[]);u(this,"_peer");u(this,"_enabled",!1);u(this,"_enabledPeer",!1);u(this,"onConnectRoomFn",this.onConnectRoom.bind(this));u(this,"onPeerConnect",t=>{if(es&&console.log("PEER opened as",t),t===null){console.error("Peer connection failed",t);return}this.context.connection.send(Nn.Connected,new Kle(this,t))});u(this,"onPeerClose",()=>{es&&console.log("PEER closed"),this.updateCalls()});u(this,"onPeerDisconnected",()=>{es&&console.log("PEER disconnected"),this.updateCalls()});u(this,"onPeerError",t=>{es&&console.error("PEER error",t)});u(this,"onPeerReceivingCall",t=>{t.answer(void 0,{sdpTransform:i=>ZU(i)}),this.registerCall(t,xc.Incoming,null)});this.context=t,this.id=i,this.setupPeer(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}static getOrCreate(t,i){if(wg.instances.has(i))return wg.instances.get(i);const n=new wg(t,i);return wg.instances.set(i,n),n}getMyPeerId(){if(this.context.connection.connectionId)return this.getPeerIdFromUserId(this.context.connection.connectionId)}getPeerIdFromUserId(t){return this.id+"-"+t}getUserIdFromPeerId(t){return t.substring(this.id.length+1)}makeCall(t,i){var o;if(!(i!=null&&i.id)){es?console.warn("Can not make a call: mediastream has no id or is undefined"):console.debug("Can not make a call: mediastream has no id or is undefined");return}const n={metadata:{userId:this.context.connection.connectionId,streamId:i.id},sdpTransform:a=>ZU(a)},r=(o=this._peer)==null?void 0:o.call(t,i,n);if(r){const a=this.registerCall(r,xc.Outgoing,i);return es&&console.warn(`📞 CALL ${t}`,`
Outgoing:`,this._outgoingCalls,`
Incoming:`,this._incomingCalls),a}else es&&console.error("Failed to make call",t,i,this._peer)}closeAll(){for(const t of this._incomingCalls)t.close();for(const t of this._outgoingCalls)t.close();this.updateCalls()}get peer(){return this._peer}get incomingCalls(){return this._incomingCalls}enable(){this._enabled||(this._enabled=!0,this.context.connection.beginListen(Ut.JoinedRoom,this.onConnectRoomFn),this.subscribePeerEvents())}disable(){this._enabled&&(this._enabled=!1,this.context.connection.stopListen(Ut.JoinedRoom,this.onConnectRoomFn),this.unsubscribePeerEvents())}onConnectRoom(){this.setupPeer()}setupPeer(){if(this.context.connection.connectionId&&!this._enabledPeer){if(this._enabledPeer=!0,!this._peer){const t=this.getMyPeerId();t?this._peer=XV(t):console.error("Failed to setup peerjs because we dont have a connection id",this.context.connection.connectionId)}this._enabled&&this.subscribePeerEvents()}}subscribePeerEvents(){this._peer&&(this._peer.on("open",this.onPeerConnect),this._peer.on("close",this.onPeerClose),this._peer.on("call",this.onPeerReceivingCall),this._peer.on("disconnected",this.onPeerDisconnected),this._peer.on("error",this.onPeerError))}unsubscribePeerEvents(){this._peer&&(this._peer.off("open",this.onPeerConnect),this._peer.off("close",this.onPeerClose),this._peer.off("call",this.onPeerReceivingCall),this._peer.off("disconnected",this.onPeerDisconnected),this._peer.off("error",this.onPeerError))}registerCall(t,i,n){const r=t.metadata;(!r||!r.userId)&&console.error("Missing call metadata",t);const o=r.userId;i===xc.Incoming&&es?console.warn("← Receive call from",t.metadata,t.connectionId):es&&console.warn("→ Make call to",t.metadata);const a=i===xc.Incoming?this._incomingCalls:this._outgoingCalls,l=new Jle(o,t,i,n);return a.push(l),t.on("error",c=>{console.error("Call error",c)}),t.on("close",()=>{es&&console.log("Call ended",t.metadata);const c=a.indexOf(l);c!==-1&&a.splice(c,1),l.close(),this.dispatchEvent(new tO(o,i))}),l.addEventListener(Nn.StreamEnded,c=>{this.dispatchEvent(c)}),i===xc.Incoming&&(l.addEventListener(Nn.StreamReceived,c=>{this.dispatchEvent(c)}),t.on("stream",()=>{es&&console.log("Received stream for call",t.metadata);let c=0;const h=setInterval(()=>{const d=c===0;!l.isOpen&&d&&(es&&console.warn("Close call because stream is not active",t.metadata),c+=1,clearInterval(h),l.close())},2e3)})),l}};let Ap=wg;u(Ap,"instances",new Map);class R_ extends Zs{constructor(t,i){super();u(this,"context");u(this,"peer");u(this,"_sendingStreams",new Map);u(this,"debug",!1);u(this,"_enabled",!1);u(this,"_tickIntervalId");u(this,"tick",()=>{this.updateSendingCalls()});u(this,"onJoinedRoom",t=>{this._sendingStreams.size>0&&(this.debug&&console.warn(`${t!=null&&t.userId?`User ${t.userId}`:"You"} joined room`,t,this._sendingStreams.size),this.updateSendingCalls())});u(this,"onLeftRoom",t=>{this.debug&&console.warn(`${(t==null?void 0:t.userId)||"You"} left room`,t),this.stopCallsToUsersThatAreNotInTheRoomAnymore(),this.peer.closeAll()});u(this,"onCallStreamReceived",t=>{this.debug&&console.log("Call with "+t.userId+" started"),this.dispatchEvent({type:Nn.StreamReceived,target:this,stream:t.stream,userId:t.userId}),this.debug&&this.debugLogCurrentState()});u(this,"onCallEnded",t=>{this.debug&&console.log("Call with "+t.userId+" ended"),this.dispatchEvent(t),this.debug&&this.debugLogCurrentState()});u(this,"onUserConnected",t=>{if(this.peer.id===t.guid){this.debug&&console.log("PEER USER CONNECTED",t.guid,t,this._sendingStreams.size);const i=this._sendingStreams.keys().next().value;this.peer.makeCall(t.peerId,i)}else es&&console.log("Unknown user connected",t.guid,t.peerId)});u(this,"onUserLeft",t=>{this.debug&&console.log("User left room: "+t.userId),this.stopCallsToUsersThatAreNotInTheRoomAnymore()});if(HQ(t)){const n=t;t=n.context,i=Ap.getOrCreate(n.context,n.guid)}else typeof i=="string"&&(i=Ap.getOrCreate(t,i));if(t){if(!(t instanceof Ot))throw new Error("Failed to create NetworkedStreams because context is not an instance of Context")}else throw new Error("Failed to create NetworkedStreams because context is undefined");if(!i)throw new Error("Failed to create NetworkedStreams because peer is undefined");this.context=t,this.peer=i,es&&(this.debug=!0)}static create(t,i){const n=Ap.getOrCreate(t.context,i||t.context.connection.connectionId||t.guid);return new R_(t.context,n)}startSendingStream(t){this._sendingStreams.has(t)?console.warn("Received start sending stream with stream that is already being sent"):(this._sendingStreams.set(t,[]),this.updateSendingCalls())}stopSendingStream(t){if(t){const i=this._sendingStreams.get(t);if(i){for(const n of i)n.close();i.length=0}this._sendingStreams.delete(t),i&&this.debug&&this.debugLogCurrentState()}this.updateSendingCalls()}get enabled(){return this._enabled}enable(){this._enabled||(this._enabled=!0,this.peer.enable(),this.peer.addEventListener(Nn.StreamReceived,this.onCallStreamReceived),this.peer.addEventListener(Nn.StreamEnded,this.onCallEnded),this.context.connection.beginListen(Nn.Connected,this.onUserConnected),this.context.connection.beginListen(Ut.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Ut.UserJoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Ut.UserLeftRoom,this.onUserLeft),this.context.connection.beginListen(Ut.LeftRoom,this.onLeftRoom),this._tickIntervalId=setInterval(this.tick,5e3))}disable(){this._enabled&&(this._enabled=!1,this.peer.disable(),this.peer.removeEventListener(Nn.StreamReceived,this.onCallStreamReceived),this.peer.removeEventListener(Nn.StreamEnded,this.onCallEnded),this.context.connection.stopListen(Nn.Connected,this.onUserConnected),this.context.connection.stopListen(Ut.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Ut.UserJoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Ut.UserLeftRoom,this.onUserLeft),this.context.connection.stopListen(Ut.LeftRoom,this.onLeftRoom),this._tickIntervalId!=null&&(clearInterval(this._tickIntervalId),this._tickIntervalId=void 0))}updateSendingCalls(){const t=this.context.connection.connectionId;for(const i of this._sendingStreams.keys()){const n=this._sendingStreams.get(i)||[];for(const r of this.context.connection.usersInRoom()){if(r===t)continue;const o=this.peer.getPeerIdFromUserId(r);if(n.find(l=>{var c;return l.peerId===o&&l.direction===xc.Outgoing&&!l.isClosed&&((c=l.stream)==null?void 0:c.active)}))es&&console.debug("Already have a call with user "+r+" / peer "+o);else{const l=this.peer.makeCall(o,i);l&&n.push(l)}}this._sendingStreams.set(i,n)}this.stopCallsToUsersThatAreNotInTheRoomAnymore()}stopCallsToUsersThatAreNotInTheRoomAnymore(){for(const t of this._sendingStreams.keys()){const i=this._sendingStreams.get(t);if(i)for(let n=i.length-1;n>=0;n--){const r=i[n];this.context.connection.userIsInRoom(r.userId)?es&&(this.context.connection.connectionId===r.userId?console.warn(`You are still in the room [${n}] ${r.userId}`):console.log(`User is still in room [${n}] ${r.userId}`)):(es&&console.log(`Remove call ${[n]} to user that is not in room anymore ${r.userId}`),r.close(),i.splice(n,1))}}this.peer.updateCalls(),this.debug&&this.debugLogCurrentState()}debugLogCurrentState(){console.warn(`You (${this.context.connection.connectionId}) are currently sending ${this._sendingStreams.size} and receiving ${this.peer.incomingCalls.length} calls (${this.peer.incomingCalls.map(t=>t.userId).join(", ")})`,this.peer.incomingCalls)}}function Rc(s){if(s&&s instanceof MediaStream)for(const e of s.getTracks())e.stop()}var iO=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Zle="noVoip",$le=ie("debugvoip");class qd extends Te{constructor(){super(...arguments);u(this,"autoConnect",!0);u(this,"runInBackground",!0);u(this,"createMenuButton",!0);u(this,"debug",!1);u(this,"_net");u(this,"_menubutton");u(this,"_allowSending",!0);u(this,"_outputStream",null);u(this,"onJoinedRoom",async()=>{this.debug&&console.log("VOIP: Joined room"),await Xc(300),this.autoConnect&&!this.isSending&&this._allowSending&&this.connect()});u(this,"onLeftRoom",()=>{this.debug&&console.log("VOIP: Left room"),this.disconnect();for(const t of this._incomingStreams.values())Rc(t.srcObject);this._incomingStreams.clear()});u(this,"_incomingStreams",new Map);u(this,"onReceiveStream",t=>{const i=t.target.userId,n=t.stream;let r=this._incomingStreams.get(i);r||(r=new Audio,this._incomingStreams.set(i,r)),r.srcObject=n,r.setAttribute("autoplay","true"),Bl.registerWaitForInteraction(()=>{r==null||r.play().catch(o=>{console.error("VOIP: Failed to play audio",o)})})});u(this,"onStreamEnded",t=>{const i=this._incomingStreams.get(t.userId);Rc(i==null?void 0:i.srcObject),this._incomingStreams.delete(t.userId)});u(this,"onEnabledChanged",()=>{for(const t of this._incomingStreams){const i=t[1];i.muted=!this.enabled}});u(this,"onVisibilityChanged",()=>{if(this.runInBackground)return;const i=!(document.visibilityState==="visible");this.setMuted(i);for(const n of this._incomingStreams){const r=n[1];r.muted=i}})}awake(){$le&&(this.debug=!0),this.debug&&(console.log("VOIP debugging: press 'v' to toggle mute or 'c' to toggle connect/disconnect"),window.addEventListener("keydown",async t=>{switch(t.key.toLowerCase()){case"v":console.log("MUTE?",!this.isMuted),this.setMuted(!this.isMuted);break;case"c":this.isSending?this.disconnect():this.connect();break}}),window.addEventListener("blur",()=>{console.log("VOIP: MUTE ON BLUR"),this.setMuted(!0)}),window.addEventListener("focus",()=>{console.log("VOIP: UNMUTE ON FOCUS"),this.setMuted(!1)}))}onEnable(){this._net||(this._net=R_.create(this)),this.debug&&(this._net.debug=!0),this._net.addEventListener(Nn.StreamReceived,this.onReceiveStream),this._net.addEventListener(Nn.StreamEnded,this.onStreamEnded),this._net.enable(),this.autoConnect&&this.context.connection.isConnected&&this.connect(),this.context.connection.beginListen(Ut.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Ut.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.addEventListener("visibilitychange",this.onVisibilityChanged)}onDisable(){var t;this._net&&(this._net.stopSendingStream(this._outputStream),this._net.removeEventListener(Nn.StreamReceived,this.onReceiveStream),this._net.removeEventListener(Nn.StreamEnded,this.onStreamEnded),(t=this._net)==null||t.disable()),this.context.connection.stopListen(Ut.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Ut.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.removeEventListener("visibilitychange",this.onVisibilityChanged)}onDestroy(){var t;(t=this._menubutton)==null||t.remove(),this._menubutton=void 0}get isSending(){return this._outputStream!=null&&this._outputStream.active}async connect(t){var i,n;if(!this._net)return console.error("Cannot connect to voice chat - NetworkedStreams not initialized. Make sure the component is enabled before calling this method."),!1;if(this.context.connection.isConnected){if(!await St.microphonePermissionsGranted())return console.error("Cannot connect to voice chat - microphone permissions not granted"),this.updateButton(),!1}else return console.error("Cannot connect to voice chat - not connected to server"),this.updateButton(),!1;return this._allowSending=!0,(i=this._net)==null||i.stopSendingStream(this._outputStream),Rc(this._outputStream),this._outputStream=await this.getAudioStream(t),this._outputStream?(this.debug&&console.log("VOIP: Got audio stream"),(n=this._net)==null||n.startSendingStream(this._outputStream),this.updateButton(),!0):(this.updateButton(),await St.microphonePermissionsGranted()?console.error("VOIP: Could not get audio stream - please make sure to connect an audio device and grant microphone permissions"):eE("Microphone permissions not granted: Please grant microphone permissions to use voice chat"),(this.debug||Xe())&&console.log("VOIP: Failed to get audio stream"),!1)}disconnect(t){var i;t!=null&&t.remember&&(this._allowSending=!1),(i=this._net)==null||i.stopSendingStream(this._outputStream),Rc(this._outputStream),this._outputStream=null,this.updateButton()}setMuted(t){var n;const i=(n=this._outputStream)==null?void 0:n.getAudioTracks();if(i)for(const r of i)r.enabled=!t}get isMuted(){var i;if(this._outputStream===null)return!1;const t=(i=this._outputStream)==null?void 0:i.getAudioTracks();if(t){for(const n of t)if(!n.enabled)return!0}return!1}async updateButton(){var t;if(this.createMenuButton){if(this._menubutton||(this._menubutton=document.createElement("button"),this._menubutton.addEventListener("click",()=>{this.isSending?this.disconnect({remember:!0}):this.connect(),St.microphonePermissionsGranted().then(i=>{i||Yi("<strong>Microphone permissions not granted</strong>. Please allow your browser to use the microphone to be able to talk. Click on the button on the left side of your browser's address bar to allow microphone permissions.")})})),this._menubutton){this.context.menu.appendChild(this._menubutton),this.activeAndEnabled?this._menubutton.style.display="":this._menubutton.style.display="none",this._menubutton.title=this.isSending?"Click to disable your microphone":"Click to enable your microphone";let i=(this.isSending,""),n=this.isSending?"mic":"mic_off";await St.microphonePermissionsGranted()||(i="No Permission",n="mic_off",this._menubutton.title="Microphone permissions not granted. Please allow your browser to use the microphone to be able to talk. This can usually be done in the addressbar of the webpage."),this._menubutton.innerText=i,this._menubutton.prepend(br(n)),this.context.connection.isConnected==!1?this._menubutton.setAttribute("disabled",""):this._menubutton.removeAttribute("disabled")}}else this.activeAndEnabled||(t=this._menubutton)==null||t.remove()}getFrequency(t){return this.unsupported_getfrequency||(this.unsupported_getfrequency=!0,Xe()&&Yi("VOIP: getFrequency is currently not supported"),console.warn("VOIP: getFrequency is currently not supported")),null}async getAudioStream(t){if(!navigator.mediaDevices.getUserMedia)return console.error("No getDisplayMedia support"),null;const i=async r=>await navigator.mediaDevices.getUserMedia({audio:r??!0,video:!1}).catch(o=>(console.warn("VOIP failed getting audio stream",o),null)),n=await i(t);if(!n)return null;if(St.isiOS()&&(t==null?void 0:t.deviceId)===void 0){const o=(await navigator.mediaDevices.enumerateDevices()).find(a=>(a.kind==="audioinput"||a.kind==="audiooutput")&&!a.label.includes("iPhone"));if(o){const a=Object.assign({},t);return a.deviceId=o.deviceId,await i(a)}}return n}}iO([x()],qd.prototype,"autoConnect",void 0);iO([x()],qd.prototype,"runInBackground",void 0);iO([x()],qd.prototype,"createMenuButton",void 0);var qQ=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const ece=ie("debugmouth");class P_ extends Te{constructor(){super(...arguments);u(this,"idle",[]);u(this,"talking",[]);u(this,"marker",null);u(this,"voip",null);u(this,"lastMouthChangeTime",0);u(this,"mouthChangeLength",0)}awake(){setTimeout(()=>{this.voip=ne.findObjectOfType(qd,this.context),this.marker||(this.marker=ne.getComponentInParent(this.gameObject,Ps))},3e3)}update(){var n;if(!this.voip||this.context.time.frameCount%10!==0)return;let t=((n=this.marker)==null?void 0:n.connectionId)??null;if(!t){ece&&(t=null);return}const i=this.voip.getFrequency(t)??0;this.updateLips(i)}updateLips(t){if(this.context.time.time-this.lastMouthChangeTime>this.mouthChangeLength){if(this.mouthChangeLength=.05+Math.random()*.1,this.talking&&this.talking.length>0&&t>30){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.talking.length);this.setMouthShapeActive(this.talking,i)}else if(this.idle.length>0&&this.context.time.time-this.lastMouthChangeTime>.5){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.idle.length);this.setMouthShapeActive(this.idle,i)}}}setMouthShapeActive(t,i){if(t){t!=this.idle?this.idle.map(n=>n.visible=!1):this.talking.map(n=>n.visible=!1);for(let n=0;n<t.length;n++){const r=t[n];r&&(r.visible=n===i)}}}}qQ([x(ge)],P_.prototype,"idle",void 0);qQ([x(ge)],P_.prototype,"talking",void 0);class nO extends Te{constructor(){super(...arguments);u(this,"voip",null);u(this,"marker",null);u(this,"_startPosition",null)}awake(){this.voip=ne.findObjectOfType(qd,this.context),this.marker=ne.getComponentInParent(this.gameObject,Ps)}update(){if(!this.voip||!this.marker||this.context.time.frameCount%10!==0)return;const t=this.marker.connectionId,i=this.voip.getFrequency(t);if(i==null)return;this._startPosition||(this._startPosition=this.gameObject.position.clone());const n=i/100;this.gameObject.position.y=this._startPosition.y+n*.07}}var RE=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class Zp extends Te{constructor(){super(...arguments);u(this,"eyes",[]);u(this,"lastBlinkTime",0);u(this,"blinkLength",0);u(this,"eyesOpen",!0);u(this,"state",null)}awake(){this.state=ne.getComponentInParent(this.gameObject,Ws)}update(){if(!this.gameObject||!this.gameObject.visible||!this.eyes||!Array.isArray(this.eyes)||this.eyes.length===0)return;if(this.context.time.time-this.lastBlinkTime>this.blinkLength){if(this.lastBlinkTime=this.context.time.time,this.state&&!this.state.isOn||!this.activeAndEnabled)return;if(this.eyesOpen=!this.eyesOpen,this.blinkLength=Math.random(),this.eyesOpen?(this.blinkLength*=3,this.blinkLength+=.5,Math.random()<.1&&(this.blinkLength=.1+Math.random()*.2)):(this.blinkLength*=Math.random()*.2,this.blinkLength+=.1),Math.random()<.1&&(this.blinkLength*=3),this.blinkLength=Math.max(.2,this.blinkLength),this.blinkLength=Math.min(3,this.blinkLength),this.eyes)for(const i of this.eyes)i&&(i.visible=this.eyesOpen)}}}RE([x(ge)],Zp.prototype,"eyes",void 0);RE([x()],Zp.prototype,"lastBlinkTime",void 0);RE([x()],Zp.prototype,"blinkLength",void 0);RE([x()],Zp.prototype,"eyesOpen",void 0);var sO=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const g2=class extends Te{constructor(){super(...arguments);u(this,"head",null);u(this,"eyes",null);u(this,"target",null);u(this,"brain",null);u(this,"vec",new w);u(this,"currentTargetPoint",new w)}awake(){this.brain||(this.brain=ne.getComponentInParent(this.gameObject,T0)),this.brain||(this.brain=ne.addComponent(this.gameObject,T0)),this.brain&&this.target&&(this.brain.controlledTarget=this.target)}update(){const t=this.target;if(t&&this.head){const i=this.eyes;if(i){const n=Qt(t);this.currentTargetPoint.lerp(n,this.context.time.deltaTime/.1);const r=Qt(this.head),o=this.vec.copy(this.currentTargetPoint).sub(r).normalize();if(o.length()<.1)return;const a=g2.forward;if(a.set(0,0,1),a.applyQuaternion(qi(this.head)),a.dot(o)>.45)for(let c=0;c<i.length;c++)i[c].lookAt(this.currentTargetPoint)}}}};let au=g2;u(au,"forward",new w(0,0,1));sO([x(ge)],au.prototype,"head",void 0);sO([x(ge)],au.prototype,"eyes",void 0);sO([x(ge)],au.prototype,"target",void 0);const by=ie("debugavatar");class PE{constructor(e,t,i,n){u(this,"root");u(this,"head");u(this,"leftHand");u(this,"rigthHand");var r;this.root=e,this.head=t,this.leftHand=i,this.rigthHand=n,(r=this.root)==null||r.traverse(o=>o.layers.set(2))}get isValid(){return this.head!==null&&this.head!==void 0}}class rO{constructor(){u(this,"avatarRegistryUrl",null)}async getOrCreateNewAvatarInstance(e,t){if(!t)return console.error("Can not create avatar: failed to provide id or root object"),null;let i=null;if(typeof t=="string"){if(i=await this.loadAvatar(e,t),!i){const r=new Gl;i=ne.instantiate(qg(t,e.scene),r)}}else i=t;if(!i)return null;const n=this.findAvatar(i);return n.isValid?(by&&console.log("[Custom Avatar] valid config",t,by?n:""),n):(console.warn("[Custom Avatar] config isn't valid",t,by?n:""),null)}async loadAvatar(e,t){if(console.assert(t!=null&&typeof t=="string","Avatar id must not be null"),t.length<=0||!t)return null;if(by&&console.log("[Custom Avatar] "+t+", loading..."),t.endsWith(".glb")||(t+=".glb"),this.avatarRegistryUrl===null){const n=await fetch("./"+t);let r=null;if(n.ok){const a=await n.blob();a&&(r=await a.arrayBuffer())}if(!r&&(r=await kD(t,t,0,"no url here go away",!0),!r))return null;const o=await Fl().parseSync(e,r,null,0);return(o==null?void 0:o.scene)??null}const i=new Za;return bE(i,e),new Promise((n,r)=>{const o=this.avatarRegistryUrl+"/"+t;i.load(o,async a=>{await Fl().createBuiltinComponents(e,o,a,null,void 0),n(a.scene)},a=>{by&&console.log("[Custom Avatar] "+a.loaded/a.total*100+"% loaded of "+a.total/1024+"kB")},a=>{console.error("[Custom Avatar] Error when loading: "+a),n(null)})})}cacheModel(e,t){}findAvatar(e){const t=e;let i=t;i.children.length==1&&(i=e.children[0]);let n=this.findAvatarPart(i,["head"]);const r=this.findAvatarPart(i,["left","hand"]),o=this.findAvatarPart(i,["right","hand"]);if(!n){n=t;const l=new w;new Si().setFromObject(n).getSize(l);const c=Math.max(l.x,l.y,l.z);console.warn("[Custom Avatar] Normalizing head scale, it's too big: "+c+" meters! Should be < 0.3m"),c>.3&&n.scale.multiplyScalar(1/c*.3)}return new PE(t,n,r,o)}findAvatarPart(e,t){const i=e.name.toLowerCase();let n=!0;for(const r of t){if(!n)break;i.indexOf(r)===-1&&(n=!1)}if(n)return e;if(e.children)for(const r of e.children){const o=this.findAvatarPart(r,t);if(o)return o}return null}handleCustomAvatarErrors(e){if(!e.ok)throw Error(e.statusText);return e}}var oO=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class Mv extends Te{constructor(){super(...arguments);u(this,"length",1);u(this,"depthTest",!0);u(this,"isGizmo",!1);u(this,"_axes",null)}onEnable(){if(this.isGizmo&&!m_)return;this._axes||(this._axes=new xo(this.length)),this._axes.layers.disableAll(),this._axes.layers.set(this.layer),this.gameObject.add(this._axes);const t=this._axes.material;t&&t.depthTest!==void 0&&(t.depthTest=this.depthTest)}onDisable(){this._axes&&this.gameObject.remove(this._axes)}}oO([x()],Mv.prototype,"length",void 0);oO([x()],Mv.prototype,"depthTest",void 0);oO([x()],Mv.prototype,"isGizmo",void 0);class aO extends Te{constructor(){super(...arguments);u(this,"from");u(this,"to");u(this,"hint");u(this,"desiredDistance",1)}onEnable(){}update(){if(!this.from||!this.to||!this.hint)return;const t=Qt(this.to).clone(),i=Qt(this.from).clone(),n=t.distanceTo(i),r=t.clone();r.sub(i);const o=i.clone();o.add(t),o.multiplyScalar(.5);const a=Qt(this.hint).clone();a.sub(o);const l=new w;l.crossVectors(a,r),l.crossVectors(r,l),l.normalize();const c=n*.5,h=Math.max(this.desiredDistance,c),d=Math.sqrt(h*h-c*c),f=l.clone();f.multiplyScalar(d),f.add(o),Os(this.gameObject,f);const p=o.clone();p.sub(l),this.gameObject.lookAt(p)}}const Ix=ie("debugusdzbehaviours");class BE{constructor(){u(this,"behaviours",[]);u(this,"behaviourComponents",[]);u(this,"behaviourComponentsCopy",[]);u(this,"audioClips",[]);u(this,"audioClipsCopy",[]);u(this,"targetUuids",new Set)}get extensionName(){return"Behaviour"}addBehavior(e){this.behaviours.push(e)}addAudioClip(e){if(!e||typeof e!="string")return"";const i="audio/"+jd.getName(e);return this.audioClips.push({clipUrl:e,filesKey:i}),i}getAllTargetUuids(){return this.targetUuids}onBeforeBuildDocument(e){if(!e.root)return Promise.resolve();const t=[];return e.root.traverse(i=>{ne.foreachComponent(i,n=>{var o;const r=n;if(typeof r.createBehaviours=="function"||typeof r.beforeCreateDocument=="function"||typeof r.afterCreateDocument=="function"||typeof r.afterSerialize=="function"){this.behaviourComponents.push(r);const a=(o=r.beforeCreateDocument)==null?void 0:o.call(r,this,e);a instanceof Promise&&t.push(a)}},!1)}),Ix&&console.log("onBeforeBuildDocument: all components",this.behaviourComponents),Promise.all(t)}onExportObject(e,t,i){var n;for(const r of this.behaviourComponents)(n=r.createBehaviours)==null||n.call(r,this,t,i)}onAfterBuildDocument(e){for(const d of this.behaviourComponents)typeof d.afterCreateDocument=="function"&&d.afterCreateDocument(this,e);this.behaviourComponentsCopy=this.behaviourComponents.slice(),this.behaviourComponents.length=0,this.audioClipsCopy=this.audioClips.slice(),this.audioClips.length=0;const t=new Set,i=new Set,n=new Set,r=new Set,o=Ix;let a=`graph LR
`,l="";function c(d){if(d instanceof $h){o&&(a+=`subgraph Group_${d.id}
`);for(const f of d.actions)o&&(a+=`${d.id}[${d.id}] -- ${d.type} --> ${f.id}[${f.id}]
`),c(f);o&&(a+=`end
`)}else if(d instanceof ho){d.tokenId==="StartAnimation"&&r.add(d);const f=d.affectedObjects;if(f)if(Array.isArray(f))for(const m of f)i.add(m),o&&(l+=`${d.id}[${d.id}] -- ${d.tokenId} --> ${m.uuid}(("${m.displayName||m.name||m.uuid}"))
`);else typeof f=="object"?(i.add(f),o&&(l+=`${d.id}[${d.id}] -- ${d.tokenId} --> ${f.uuid}(("${f.displayName||f.name||f.uuid}"))
`)):typeof f=="string"&&i.add({uuid:f});const p=d.xFormTarget;p&&(typeof p=="object"?(i.add(p),o&&(l+=`${d.id}[${d.id}] -- ${d.tokenId} --> ${p.uuid}(("${p.displayName||p.name||p.uuid}"))
`)):typeof p=="string"&&i.add({uuid:p}))}}function h(d,f){if(Array.isArray(d))for(const p of d)h(p,f);else d instanceof Nc&&(typeof d.targetId=="object"&&(t.add(d.targetId),o&&(l+=`${d.targetId.uuid}(("${d.targetId.displayName}")) --> ${d.id}[${d.id}]
`)),o&&(a+=`${d.id}((${d.id})) -- ${d.tokenId}${d.type?":"+d.type:""} --> ${f.id}[${f.tokenId||f.id}]
`))}for(const d of this.behaviours)o&&(a+=`subgraph Behavior_${d.id}
`),c(d.action),h(d.trigger,d.action),o&&(a+=`end
`);o&&(a+=`
`+l),o&&(console.log("All USDZ behaviours",this.behaviours),console.warn("The Mermaid graph can be pasted into https://massive-mermaid.glitch.me/ or https://mermaid.live/edit. It should be in your clipboard already!"),console.log(a),navigator.clipboard.writeText(a));{let d=`gantt
title Animations
dateFormat X
axisFormat %s
`;const f=Array.from(r),p=new Set;for(const g of f)if(g.affectedObjects&&typeof g.affectedObjects!="string"){if(Array.isArray(g.affectedObjects))for(const _ of g.affectedObjects)p.add(_);else p.add(g.affectedObjects);o&&(d+=`section ${g.animationName} (${g.id})
`,d+=`${g.id} : ${g.start}, ${g.duration}s
`)}o&&console.log(d);const m=new Set;for(const g of p){g.getPath||console.error("USDZExporter: Animation target object has no getPath method. This is likely a bug",g);let _=g.getPath();_.startsWith("<")&&(_=_.substring(1)),_.endsWith(">")&&(_=_.substring(0,_.length-1)),m.add({path:_,obj:g})}const v=Array.from(m).sort((g,_)=>g.path.length-_.path.length),y=new Array;for(let g=0;g<v.length;g++)for(let _=g+1;_<v.length;_++)if(v[_].path.startsWith(v[g].path)){const A=v[_],b=v[g];y.push({child:A.obj.displayName+" ("+A.path+")",parent:b.obj.displayName+" ("+b.path+")"})}y.length&&console.warn("USDZExporter: There are overlapping PlayAnimation actions. This can lead to undefined runtime behaviour when playing multiple animations. Please restructure the hierarchy so that animations don't overlap.",{overlappingTargets:y,playAnimationActions:r})}for(const d of new Set([...t,...i]))if(Array.isArray(d))for(const f of d)n.add(f.uuid);else n.add(d.uuid);Ix&&console.log("All Behavior trigger sources and action targets",t,i,n),this.targetUuids=new Set(n)}onAfterHierarchy(e,t){var i;if((i=this.behaviours)!=null&&i.length){t.beginBlock('def Scope "Behaviors"');for(const n of this.behaviours)n.writeTo(this,e.document,t);t.closeBlock()}}async onAfterSerialize(e){Ix&&console.log("onAfterSerialize behaviours",this.behaviourComponentsCopy);for(const t of this.behaviourComponentsCopy)typeof t.afterSerialize=="function"&&(t.afterSerialize.constructor.name==="AsyncFunction"?await t.afterSerialize(this,e):t.afterSerialize(this,e));for(const{clipUrl:t,filesKey:i}of this.audioClipsCopy){if(e.files[i])return;const o=await(await(await fetch(t)).blob()).arrayBuffer(),a=new Uint8Array(o);e.files[i]=a}this.behaviourComponentsCopy.length=0,this.audioClipsCopy.length=0}}var lO=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const v2=class extends er{constructor(){super(...arguments);u(this,"threshold",new Ze(.9));u(this,"intensity",new Ze(1));u(this,"scatter",new Ze(.3));u(this,"selectiveBloom")}get typeName(){return"Bloom"}init(){this.threshold.valueProcessor=t=>t,this.intensity.valueProcessor=t=>t,this.scatter.valueProcessor=t=>t}onCreateEffect(){let t;if(this.selectiveBloom==null&&(this.selectiveBloom=v2.useSelectiveBloom),this.selectiveBloom){const i=t=new bH(this.context.scene,this.context.mainCamera,{blendFunction:$t.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});i.inverted=!0}else t=new aD({blendFunction:$t.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});return this.intensity.onValueChanged=i=>{t.intensity=i},this.threshold.onValueChanged=i=>{t.luminanceMaterial.threshold=Math.pow(i,2.2)},this.scatter.onValueChanged=i=>{t.luminancePass.enabled=!0,t.luminanceMaterial.smoothing=i,t.mipmapBlurPass&&(t.mipmapBlurPass.radius=li.lerp(.1,.9,i))},t}};let Gc=v2;u(Gc,"useSelectiveBloom",!1);lO([x(Ze)],Gc.prototype,"threshold",void 0);lO([x(Ze)],Gc.prototype,"intensity",void 0);lO([x(Ze)],Gc.prototype,"scatter",void 0);il("Bloom",Gc);var qo=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class Xo extends Te{constructor(){super(...arguments);u(this,"attachedRigidbody",null);u(this,"isTrigger",!1);u(this,"sharedMaterial");u(this,"membership",[0]);u(this,"filter");u(this,"updateProperties",()=>{var t;(t=this.context.physics.engine)==null||t.updateProperties(this)})}get isCollider(){return!0}awake(){super.awake(),this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Ci))}start(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Ci))}onEnable(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Ci))}onDisable(){var t;(t=this.context.physics.engine)==null||t.removeBody(this)}get body(){var t;return(t=this.context.physics.engine)==null?void 0:t.getBody(this)}updatePhysicsMaterial(){var t;(t=this.context.physics.engine)==null||t.updatePhysicsMaterial(this)}}qo([x(Ci)],Xo.prototype,"attachedRigidbody",void 0);qo([x()],Xo.prototype,"isTrigger",void 0);qo([x()],Xo.prototype,"sharedMaterial",void 0);qo([x()],Xo.prototype,"membership",void 0);qo([x()],Xo.prototype,"filter",void 0);class Iv extends Xo{constructor(){super(...arguments);u(this,"radius",.5);u(this,"center",new w(0,0,0))}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addSphereCollider(this),XC(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),xB(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}qo([Mr(),x()],Iv.prototype,"radius",void 0);qo([x(w)],Iv.prototype,"center",void 0);class Xd extends Xo{constructor(){super(...arguments);u(this,"size",new w(1,1,1));u(this,"center",new w(0,0,0))}static add(t,i){const n=new Xd;t.geometry.boundingBox||t.geometry.computeBoundingBox();const r=t.geometry.boundingBox;return n.size=r.getSize(new w)||new w(1,1,1),n.center=r.getCenter(new w)||new w(0,0,0),ya(t,n),(i==null?void 0:i.rigidbody)===!0&&ya(t,Ci,{isKinematic:!1}),n}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addBoxCollider(this,this.size),XC(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),xB(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}qo([Mr(),x(w)],Xd.prototype,"size",void 0);qo([x(w)],Xd.prototype,"center",void 0);class $p extends Xo{constructor(){super(...arguments);u(this,"sharedMesh");u(this,"convex",!1)}onEnable(){var i,n,r;if(super.onEnable(),!this.context.physics.engine)return;(i=this.sharedMesh)!=null&&i.isMesh||this.gameObject instanceof le&&(this.sharedMesh=this.gameObject);const t=0;if((n=this.sharedMesh)!=null&&n.isMesh)this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,ln(this.gameObject)),fi.assignMeshLOD(this.sharedMesh,t).then(o=>{o&&this.activeAndEnabled&&this.context.physics.engine&&this.sharedMesh&&(this.context.physics.engine.removeBody(this),this.sharedMesh.geometry=o,this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,ln(this.gameObject)))});else{const o=this.sharedMesh;if(o!=null&&o.isGroup){console.warn(`MeshCollider mesh is a group "${((r=this.sharedMesh)==null?void 0:r.name)||this.gameObject.name}", adding all children as colliders. This is currently not fully supported (colliders can not be removed from world again)`,this);const a=new Array;for(const l in o.children){const c=o.children[l];c.isMesh&&(this.context.physics.engine.addMeshCollider(this,c,this.convex,ln(this.gameObject)),a.push(fi.assignMeshLOD(c,t)))}Promise.all(a).then(l=>{var h,d;if(l.some(f=>f)==!1)return;(h=this.context.physics.engine)==null||h.removeBody(this);const c=new le;for(const f of l)f&&this.activeAndEnabled&&(c.geometry=f,(d=this.context.physics.engine)==null||d.addMeshCollider(this,c,this.convex,ln(this.gameObject)))})}}}}qo([x(le)],$p.prototype,"sharedMesh",void 0);qo([x()],$p.prototype,"convex",void 0);class mu extends Xo{constructor(){super(...arguments);u(this,"center",new w(0,0,0));u(this,"radius",.5);u(this,"height",2)}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addCapsuleCollider(this,this.height,this.radius)}}qo([x(w)],mu.prototype,"center",void 0);qo([x()],mu.prototype,"radius",void 0);qo([x()],mu.prototype,"height",void 0);var cO=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class em extends Te{constructor(){super(...arguments);u(this,"objectBounds",!1);u(this,"color");u(this,"isGizmo",!0);u(this,"_gizmoObject",null);u(this,"_boxHelper",null)}onEnable(){this.isGizmo&&!m_||(this._gizmoObject||(this.objectBounds?this._gizmoObject=new vB(this.gameObject,this.color??16776960):(this.objectBounds=!1,this._gizmoObject=wD(this.color??16776960))),this.objectBounds?(this.scene.add(this._gizmoObject),this._boxHelper=this._gizmoObject,this.startCoroutine(this.syncObjectBounds(),Wt.OnBeforeRender)):this.gameObject.add(this._gizmoObject))}onDisable(){this._gizmoObject&&this.gameObject.remove(this._gizmoObject)}*syncObjectBounds(){var t;for(;this._boxHelper;)(t=this._boxHelper)==null||t.update(),yield}}cO([x()],em.prototype,"objectBounds",void 0);cO([x(me)],em.prototype,"color",void 0);cO([x()],em.prototype,"isGizmo",void 0);const tce=ie("gizmos"),ice=ie("debugboxhelper"),vl=class extends Te{constructor(){super(...arguments);u(this,"box",null);u(this,"_lastMatrixUpdateFrame",-1);u(this,"_helper",null);u(this,"_color",null)}isInBox(t){var n;if(!t)return;if(this.box||(this.box=new Si),Ja([t],void 0,void 0,vl.testBox),vl.testBox.isEmpty()){const r=Qt(t,vl._position);vl.testBox.setFromCenterAndSize(r,vl._emptyObjectSize)}this.updateBox();const i=(n=this.box)==null?void 0:n.intersectsBox(vl.testBox);return i&&ice&&At.DrawWireBox3(vl.testBox,16711680,5),i}intersects(t){return t?this.updateBox(!1).intersectsBox(t):!1}updateBox(t=!1){if(this.box||(this.box=new Si),t||this.context.time.frameCount!=this._lastMatrixUpdateFrame){const i=this._lastMatrixUpdateFrame<0;this._lastMatrixUpdateFrame=this.context.time.frameCount;const n=i,r=Qt(this.gameObject,vl._position,n),o=ln(this.gameObject,vl._size);this.box.setFromCenterAndSize(r,o)}return this.box}awake(){this._helper=null,this._color=null,this.box=null}showHelper(t=null,i=!1){var n;if(!(!tce&&!i)){if(this._helper){t&&((n=this._color)==null||n.set(t)),this.gameObject.add(this._helper);return}this._helper=wD(t),this.gameObject.add(this._helper)}}};let No=vl;u(No,"testBox",new Si),u(No,"_position",new w),u(No,"_size",new w(.01,.01,.01)),u(No,"_emptyObjectSize",new w(.01,.01,.01));class nce extends qG{constructor(e,t={}){super(e),e._simpleState__activeStates=[],e._simpleState__normalStyles={},e._simpleState__states=t,e._simpleState__statesProperties={};for(const i in t)for(const n in t[i])e._simpleState__statesProperties[n]||(e._simpleState__statesProperties[n]=[]),e._simpleState__statesProperties[n].push(i);for(const i of e._components)e._simpleState__statesProperties[i.id]&&(e._simpleState__normalStyles[i.id]=i.inline?i.inline:i._value);e.__overridedSet=e.set,e.set=this.storeSet.bind(e),e.renderStates=this.renderStates.bind(e),e.setupState=this.setupState.bind(e),e.setState=this.setState.bind(e),e.activatePseudoState=this.activatePseudoState.bind(e),e.deactivatePseudoState=this.deactivatePseudoState.bind(e),e.togglePseudoState=this.togglePseudoState.bind(e)}act(){}attach(){}detach(){}setupState(e,t){this._simpleState__states[e]=t;const i=[];for(const n in t)this._simpleState__statesProperties[n]||(this._simpleState__statesProperties[n]=[],i.push(n)),this._simpleState__statesProperties[n].push(e);for(const n of this._components)i.indexOf(n.id)>-1&&(this._simpleState__normalStyles[n.id]=n.inline?n.inline:n._value)}renderStates(){let e={...this._simpleState__normalStyles};for(const t in this._simpleState__states)this._simpleState__activeStates.indexOf(t)>-1&&(e={...e,...this._simpleState__states[t]});this.set(e,!1)}storeSet(e,t=!0){if(t)for(const i in e)this._simpleState__statesProperties[i]&&(this._simpleState__normalStyles[i]=e[i]);this.__overridedSet(e)}activatePseudoState(e){this._simpleState__activeStates.indexOf(e)===-1&&(this._simpleState__activeStates.push(e),this.renderStates())}deactivatePseudoState(e){const t=this._simpleState__activeStates.indexOf(e);t>-1&&(this._simpleState__activeStates.splice(t,1),this.renderStates())}togglePseudoState(e){const t=this._simpleState__activeStates.indexOf(e);t>-1?this._simpleState__activeStates.splice(t,1):this._simpleState__activeStates.push(e),this.renderStates()}setState(e){Array.isArray(e)?this._simpleState__activeStates=e:this._simpleState__activeStates=[e],this.renderStates()}}var XQ=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class Rv extends Te{constructor(){super(...arguments);u(this,"effectColor");u(this,"effectDistance")}}XQ([x(Vi)],Rv.prototype,"effectColor",void 0);XQ([x(Z)],Rv.prototype,"effectDistance",void 0);var B_=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const fM=ie("debugui"),pM=ie("debuguilayout");class hO{constructor(){u(this,"width");u(this,"height")}}class uO{constructor(){u(this,"x");u(this,"y");u(this,"width");u(this,"height")}}const fl=new w,xy=new fe,Rx=new xe;class Js extends $a{constructor(){super(...arguments);u(this,"_anchoredPosition");u(this,"sizeDelta",new Z(100,100));u(this,"pivot",new Z(.5,.5));u(this,"anchorMin",new Z(0,0));u(this,"anchorMax",new Z(1,1));u(this,"minWidth");u(this,"minHeight");u(this,"lastMatrix");u(this,"rectBlock");u(this,"_transformNeedsUpdate",!1);u(this,"_initialPosition");u(this,"_parentRectTransform");u(this,"_lastUpdateFrame",-1);u(this,"_lastAnchoring");u(this,"_createdBlocks",[]);u(this,"_createdTextBlocks",[])}get parent(){return this._parentRectTransform}get translation(){return this.gameObject.position}get rotation(){return this.gameObject.quaternion}get scale(){return this.gameObject.scale}get anchoredPosition(){return this._anchoredPosition||(this._anchoredPosition=new Z),this._anchoredPosition}set anchoredPosition(t){this._anchoredPosition=t}get width(){let t=this.sizeDelta.x;if(this.anchorMin.x!==this.anchorMax.x&&this._parentRectTransform){const i=this._parentRectTransform.width,n=this.anchorMax.x-this.anchorMin.x;t=i*n,t+=this.sizeDelta.x}return this.minWidth!==void 0&&t<this.minWidth?this.minWidth:t}get height(){let t=this.sizeDelta.y;if(this.anchorMin.y!==this.anchorMax.y&&this._parentRectTransform){const i=this._parentRectTransform.height,n=this.anchorMax.y-this.anchorMin.y;t=i*n,t+=this.sizeDelta.y}return this.minHeight!==void 0&&t<this.minHeight?this.minHeight:t}awake(){super.awake(),this._anchoredPosition||(this._anchoredPosition=new Z),this.lastMatrix=new fe,this.rectBlock=new ge,this.rectBlock.name=this.name,this._initialPosition=this.gameObject.position.clone(),this._initialPosition.z=0,Zm(this,"_anchoredPosition",()=>{this.markDirty()}),Zm(this,"sizeDelta",()=>{this.markDirty()}),Zm(this,"pivot",()=>{this.markDirty()}),Zm(this,"anchorMin",()=>{this.markDirty()}),Zm(this,"anchorMax",()=>{this.markDirty()})}onEnable(){var t;super.onEnable(),this.rectBlock||(this.rectBlock=new ge),this.lastMatrix||(this.lastMatrix=new fe),this._lastAnchoring||(this._lastAnchoring=new Z),this._initialPosition||(this._initialPosition=new w),this._anchoredPosition||(this._anchoredPosition=new Z),this.addShadowComponent(this.rectBlock),this._transformNeedsUpdate=!0,(t=this.canvas)==null||t.registerTransform(this)}onDisable(){var t;super.onDisable(),this.removeShadowComponent(),(t=this.canvas)==null||t.unregisterTransform(this)}onParentRectTransformChanged(t){this._transformNeedsUpdate||this.onApplyTransform(pM?`${t.name} changed`:void 0)}get isDirty(){return this._transformNeedsUpdate||(this._transformNeedsUpdate=!this.lastMatrix.equals(this.gameObject.matrix)),this._transformNeedsUpdate}markDirty(){this._transformNeedsUpdate||(pM&&console.warn("RectTransform markDirty()",this.name),this._transformNeedsUpdate=!0,this._lastUpdateFrame=-1)}updateTransform(){(this._transformNeedsUpdate||!this.lastMatrix.equals(this.gameObject.matrix))&&this.canUpdate()&&this.onApplyTransform(this._transformNeedsUpdate?"Marked dirty":"Matrix changed")}canUpdate(){return this._transformNeedsUpdate&&this.activeAndEnabled&&this._lastUpdateFrame!==this.context.time.frame}onApplyTransform(t){var r;if(this.context.time.frameCount===this._lastUpdateFrame)return;this._lastUpdateFrame=this.context.time.frameCount;const i=this.shadowComponent;if(!i)return;this.gameObject.parent?this._parentRectTransform=ne.getComponentInParent(this.gameObject.parent,Js):this._parentRectTransform=void 0,this._transformNeedsUpdate=!1,pM&&console.warn("RectTransform → ApplyTransform",this.name+" because "+t),this.isRoot()?this.Root.screenspace||(i.rotation.y=Math.PI):(i.matrix.identity(),i.matrixAutoUpdate=!1,fl.set(0,0,0),this.applyPivot(fl),i.matrix.setPosition(fl.x,fl.y,0),(this.gameObject.quaternion.x||this.gameObject.quaternion.y||this.gameObject.quaternion.z)&&(Rx.copy(this.gameObject.quaternion),Rx.x*=-1,Rx.z*=-1,xy.makeRotationFromQuaternion(Rx),i.matrix.premultiply(xy)),fl.set(0,0,0),this.applyAnchoring(fl),(r=this.canvas)!=null&&r.screenspace?fl.z+=.1:fl.z+=.01,xy.identity(),xy.setPosition(fl.x,fl.y,fl.z),i.matrix.premultiply(xy),i.matrix.scale(this.gameObject.scale)),this.lastMatrix.copy(this.gameObject.matrix);const n=!0;for(const o of mE(this.gameObject,$a,n,1)){if(o===this||!o.activeAndEnabled)continue;const a=o;a.onParentRectTransformChanged&&a.onParentRectTransformChanged(this)}}applyAnchoring(t){this._lastAnchoring||(this._lastAnchoring=new Z);const i=this._lastAnchoring.sub(this._anchoredPosition);this.gameObject.position.x+=i.x,this.gameObject.position.y+=i.y,this._lastAnchoring.copy(this._anchoredPosition),t.x+=this._initialPosition.x-this.gameObject.position.x,t.y+=this._initialPosition.y-this.gameObject.position.y,t.z+=this._initialPosition.z-this.gameObject.position.z;const n=this._parentRectTransform;if(n){let r=0;const o=1-this.anchorMax.y-this.anchorMin.y;r-=n.height*.5*o,t.y+=r;let a=0;const l=1-this.anchorMax.x-this.anchorMin.x;a-=n.width*.5*l,t.x+=a}}applyPivot(t){if(this.pivot&&!this.isRoot()){const i=this.pivot.x-.5;t.x-=i*this.sizeDelta.x*this.gameObject.scale.x;const n=this.pivot.y-.5;t.y-=n*this.sizeDelta.y*this.gameObject.scale.y}}getBasicOptions(){const t={width:this.sizeDelta.x,height:this.sizeDelta.y,offset:0,backgroundOpacity:0,borderWidth:0,borderRadius:0,borderOpacity:0,letterSpacing:-.03};return this.ensureValidSize(t),t}ensureValidSize(t,i=1e-4){return t.width<=0&&(t.width=i),t.height<=0&&(t.height=1e-4),t}createNewBlock(t){t={...this.getBasicOptions(),...t},fM&&console.log(this.name,t);const i=new WB(t);return this._createdBlocks.push(i),i}createNewText(t){fM&&console.log(t),t={...this.getBasicOptions(),...t},fM&&console.log(this.name,t);const i=new qB(t);return this._createdTextBlocks.push(i),i}}B_([x(Z)],Js.prototype,"anchoredPosition",null);B_([x(Z)],Js.prototype,"sizeDelta",void 0);B_([x(Z)],Js.prototype,"pivot",void 0);B_([x(Z)],Js.prototype,"anchorMin",void 0);B_([x(Z)],Js.prototype,"anchorMax",void 0);var YQ=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Px={backgroundColor:new me(1,1,1),backgroundOpacity:1,borderColor:new me(1,1,1),borderOpacity:1},Sg=class extends $a{constructor(){super(...arguments);u(this,"_alphaFactor",1);u(this,"sRGBColor",new me(1,0,1));u(this,"raycastTarget",!0);u(this,"uiObject",null);u(this,"_color",null);u(this,"_rect",null);u(this,"_stateManager",null);u(this,"_currentlyCreatingPanel",!1)}get isGraphic(){return!0}get color(){return this._color||(this._color=new Vi(1,1,1,1)),this._color}set color(t){(!this._color||this._color.r!==t.r||this._color.g!==t.g||this._color.b!==t.b||this._color.alpha!==t.alpha)&&(this._color||(this._color=new Vi(1,1,1,1)),this._color.copy(t),this.onColorChanged())}setAlphaFactor(t){this._alphaFactor=t,this.onColorChanged()}get alphaFactor(){return this._alphaFactor}onColorChanged(){this.uiObject&&(this.sRGBColor.copy(this._color),this.sRGBColor.convertLinearToSRGB(),Px.backgroundColor=this.sRGBColor,Px.backgroundOpacity=this._color.alpha*this._alphaFactor,this.applyEffects(Px,this._alphaFactor),this.uiObject.set(Px),this.markDirty())}get m_Color(){return this._color}get rectTransform(){if(this._rect||(this._rect=ne.getComponent(this.gameObject,Js)),!this._rect)throw new Error("Not Supported: Make sure to add a RectTransform component before adding a UI Graphic component.");return this._rect}onParentRectTransformChanged(){var t;(t=this.uiObject)==null||t.set({width:this.rectTransform.width,height:this.rectTransform.height}),this.markDirty()}__internalNewInstanceCreated(t){return super.__internalNewInstanceCreated(t),this._rect=null,this.uiObject=null,this._color&&(this._color=this._color.clone()),this}setState(t){this.makePanel(),this.uiObject&&(this.uiObject.setState(t),this==null||this.markDirty())}setupState(t){this.makePanel(),this.uiObject&&(this._stateManager||(this._stateManager=new nce(this.uiObject)),this.uiObject.setupState(t.state,t.attributes))}setOptions(t){this.makePanel(),this.uiObject&&this.uiObject.set(t)}awake(){super.awake(),this.makePanel(),Zm(this,"_color",()=>xle(this,this.onColorChanged))}onEnable(){var t;super.onEnable(),this.uiObject&&((t=this.rectTransform.shadowComponent)==null||t.add(this.uiObject),this.addShadowComponent(this.uiObject,this.rectTransform))}onDisable(){super.onDisable(),this.uiObject&&this.removeShadowComponent()}makePanel(){if(this.uiObject||this._currentlyCreatingPanel)return;this._currentlyCreatingPanel=!0;const t=.015,i={backgroundColor:this.color,backgroundOpacity:this.color.alpha,offset:t};this.onBeforeCreate(i),this.applyEffects(i),this.onCreate(i),this.controlsChildLayout=!1,this._currentlyCreatingPanel=!1,this.onAfterCreated(),this.onColorChanged()}onBeforeCreate(t){}onCreate(t){this.uiObject=this.rectTransform.createNewBlock(t),this.uiObject.name=this.name}onAfterCreated(){}applyEffects(t,i=1){var r;const n=(r=this.gameObject)==null?void 0:r.getComponent(Rv);n&&(n.effectDistance&&(t.borderWidth=Math.max(Math.abs(n.effectDistance.x),Math.abs(n.effectDistance.y))),n.effectColor&&(t.borderColor=n.effectColor,t.borderOpacity=n.effectColor.alpha*i))}async setTexture(t){if(this.setOptions({backgroundOpacity:0}),t){if(Sg.textureCache.has(t))t=Sg.textureCache.get(t);else if(!t.isRenderTargetTexture){const i=t.clone();i.colorSpace=Ui,Sg.textureCache.set(t,i),t=i}this.setOptions({backgroundImage:t,borderRadius:0,backgroundOpacity:this.color.alpha,backgroundSize:"stretch"}),fi.assignTextureLOD(t,0).then(i=>{i instanceof Pt&&(t&&Sg.textureCache.set(t,i),this.setOptions({backgroundImage:i}),this.markDirty())})}else this.setOptions({backgroundImage:void 0,borderRadius:0,backgroundOpacity:this.color.alpha});this.markDirty()}onAfterAddedToScene(){super.onAfterAddedToScene(),this.shadowComponent&&(this.shadowComponent.offset=this.shadowComponent.position.z)}};let Hc=Sg;u(Hc,"textureCache",new Map);YQ([x(Vi)],Hc.prototype,"color",null);YQ([x()],Hc.prototype,"raycastTarget",void 0);class D_ extends Hc{constructor(){super(...arguments);u(this,"_flippedObject",!1)}onAfterCreated(){this.uiObject&&!this._flippedObject&&(this._flippedObject=!0,this.uiObject.scale.y*=-1)}}var DE=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};let dO=class{constructor(){u(this,"texture",null);u(this,"rect")}};DE([x(Pt)],dO.prototype,"texture",void 0);let Pv=class extends D_{constructor(){super(...arguments);u(this,"_sprite");u(this,"pixelsPerUnitMultiplier",1)}set image(t){this.sprite||(this.sprite=new dO),this.sprite.texture=t,this.onAfterCreated()}get image(){return this.sprite?this.sprite.texture:null}get sprite(){return this._sprite}set sprite(t){this._sprite!==t&&(this._sprite=t,this.onAfterCreated())}isBuiltinSprite(){var i,n,r,o,a,l,c;const t=this.sprite;switch((i=t==null?void 0:t.texture)==null?void 0:i.name){case"InputFieldBackground":case"UISprite":case"Background":case"Knob":return!0}return!((r=(n=t==null?void 0:t.texture)==null?void 0:n.name)!=null&&r.length)&&((a=(o=t==null?void 0:t.texture)==null?void 0:o.image)==null?void 0:a.width)===32&&((c=(l=t==null?void 0:t.texture)==null?void 0:l.image)==null?void 0:c.height)===32}onBeforeCreate(t){var i,n;super.onBeforeCreate(t),this.isBuiltinSprite()&&(t.borderRadius=5/this.pixelsPerUnitMultiplier,((n=(i=this.sprite)==null?void 0:i.texture)==null?void 0:n.name)==="Knob"&&(t.borderRadius=999))}onAfterCreated(){var t;this.__didAwake&&(super.onAfterCreated(),!this.isBuiltinSprite()&&this.setTexture((t=this.sprite)==null?void 0:t.texture))}};DE([x(dO)],Pv.prototype,"sprite",null);DE([x()],Pv.prototype,"pixelsPerUnitMultiplier",void 0);class OE extends D_{constructor(){super(...arguments);u(this,"_mainTexture")}get mainTexture(){return this._mainTexture}set mainTexture(t){this._mainTexture!==t&&(this._mainTexture=t,this.onAfterCreated())}onAfterCreated(){this.__didAwake&&(super.onAfterCreated(),this.setTexture(this.mainTexture))}}DE([x(Pt)],OE.prototype,"mainTexture",null);var Ca=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Cf=ie("debugbutton");var rc;(function(s){s[s.None=0]="None",s[s.ColorTint=1]="ColorTint",s[s.SpriteSwap=2]="SpriteSwap",s[s.Animation=3]="Animation"})(rc||(rc={}));class Yd{constructor(){u(this,"colorMultiplier");u(this,"disabledColor");u(this,"fadeDuration");u(this,"highlightedColor");u(this,"normalColor");u(this,"pressedColor");u(this,"selectedColor")}}Ca([x()],Yd.prototype,"colorMultiplier",void 0);Ca([x(Vi)],Yd.prototype,"disabledColor",void 0);Ca([x()],Yd.prototype,"fadeDuration",void 0);Ca([x(Vi)],Yd.prototype,"highlightedColor",void 0);Ca([x(Vi)],Yd.prototype,"normalColor",void 0);Ca([x(Vi)],Yd.prototype,"pressedColor",void 0);Ca([x(Vi)],Yd.prototype,"selectedColor",void 0);class sce{constructor(){u(this,"disabledTrigger");u(this,"highlightedTrigger");u(this,"normalTrigger");u(this,"pressedTrigger");u(this,"selectedTrigger")}}class Au extends Te{constructor(){super(...arguments);u(this,"onClick",new un);u(this,"_isHovered",0);u(this,"colors");u(this,"transition");u(this,"animationTriggers");u(this,"animator");u(this,"_interactable",!0);u(this,"_requestedAnimatorTrigger");u(this,"_isInit",!1);u(this,"_image")}click(){var t;(t=this.onClick)==null||t.invoke()}onPointerEnter(t){var n,r;const i=t.event.pointerType==="mouse"&&t.button===0;i&&(this._isHovered+=1),Cf&&console.warn("Button Enter",i,this._isHovered,(n=this.animationTriggers)==null?void 0:n.highlightedTrigger,this.animator),this.interactable&&(this.transition==rc.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.highlightedTrigger):this.transition===rc.ColorTint&&this.colors&&((r=this._image)==null||r.setState("hovered")),i&&this.context.input.setCursorPointer())}onPointerExit(){var t,i;this._isHovered-=1,this._isHovered<0&&(this._isHovered=0),Cf&&console.log("Button Exit",this._isHovered,(t=this.animationTriggers)==null?void 0:t.highlightedTrigger,this.animator),this.interactable&&(this._isHovered>0||(this._isHovered=0,this.transition==rc.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.normalTrigger):this.transition===rc.ColorTint&&this.colors&&((i=this._image)==null||i.setState("normal")),this.context.input.setCursorNormal()))}onPointerDown(t){var i,n;Cf&&console.log("Button Down",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this.interactable&&(this.transition==rc.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.pressedTrigger):this.transition===rc.ColorTint&&this.colors&&((n=this._image)==null||n.setState("pressed")))}onPointerUp(t){var i,n;Cf&&console.warn("Button Up",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator,this._isHovered),this.interactable&&(this.transition==rc.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this._isHovered?this.animationTriggers.highlightedTrigger:this.animationTriggers.normalTrigger):this.transition===rc.ColorTint&&this.colors&&((n=this._image)==null||n.setState(this._isHovered?"hovered":"normal")))}onPointerClick(t){if(this.interactable&&!(t.button!==0&&t.event.pointerType===Kh.Mouse)&&(Cf&&(console.warn("Button Click",this.onClick),Pn("CLICKED button "+this.name+" at "+this.context.time.frameCount)),this.onClick&&this.onClick.listenerCount>0&&(this.onClick.invoke(),t.use(),Cf))){const i=this.gameObject.worldPosition;i.add(this.gameObject.worldUp.multiplyScalar(1+Math.random()*.5)),At.DrawLabel(i,"CLICK:"+Date.now(),.1,1+Math.random()*.5)}}set interactable(t){this._interactable=t,this._image&&(this._image.setInteractable(t),t?this._image.setState("normal"):this._image.setState("disabled"))}get interactable(){return this._interactable}set_interactable(t){this.interactable=t}awake(){super.awake(),Cf&&console.log(this),this._isInit=!1,this.init()}start(){var t;(t=this._image)==null||t.setInteractable(this.interactable),this.gameObject.getComponentInParent(C_)||this.gameObject.addComponent(SE)}onEnable(){super.onEnable()}onDestroy(){this._isHovered&&this.context.input.setCursorNormal()}*setAnimatorTriggerAtEndOfFrame(t){var i;this._requestedAnimatorTrigger=t,yield,yield,this._requestedAnimatorTrigger==t&&((i=this.animator)==null||i.setTrigger(t))}init(){this._isInit||(this._isInit=!0,this._image=ne.getComponent(this.gameObject,Pv),this._image&&(this.stateSetup(this._image),this.interactable?this._image.setState("normal"):this._image.setState("disabled")))}stateSetup(t){var p,m,v,y,g;t.setInteractable(this.interactable);const i=this.getFinalColor(t.color,(p=this.colors)==null?void 0:p.normalColor),n={state:"normal",attributes:{backgroundColor:i,backgroundOpacity:i.alpha}};t.setupState(n);const r=this.getFinalColor(t.color,(m=this.colors)==null?void 0:m.highlightedColor),o={state:"hovered",attributes:{backgroundColor:r,backgroundOpacity:r.alpha}};t.setupState(o);const a=this.getFinalColor(t.color,(v=this.colors)==null?void 0:v.pressedColor),l={state:"pressed",attributes:{backgroundColor:a,backgroundOpacity:a.alpha}};t.setupState(l);const c=this.getFinalColor(t.color,(y=this.colors)==null?void 0:y.selectedColor),h={state:"selected",attributes:{backgroundColor:c,backgroundOpacity:c.alpha}};t.setupState(h);const d=this.getFinalColor(t.color,(g=this.colors)==null?void 0:g.disabledColor),f={state:"disabled",attributes:{backgroundColor:d,backgroundOpacity:d.alpha}};t.setupState(f)}getFinalColor(t,i){return i?t.clone().multiply(i).convertLinearToSRGB():t.clone().convertLinearToSRGB()}}Ca([x(un)],Au.prototype,"onClick",void 0);Ca([x(Yd)],Au.prototype,"colors",void 0);Ca([x()],Au.prototype,"transition",void 0);Ca([x(sce)],Au.prototype,"animationTriggers",void 0);Ca([x(Cr)],Au.prototype,"animator",void 0);Ca([x()],Au.prototype,"interactable",null);var xs=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const $U=ie("debuguilayout");class Kd{constructor(){u(this,"left",0);u(this,"right",0);u(this,"top",0);u(this,"bottom",0)}get vertical(){return this.top+this.bottom}get horizontal(){return this.left+this.right}}xs([x()],Kd.prototype,"left",void 0);xs([x()],Kd.prototype,"right",void 0);xs([x()],Kd.prototype,"top",void 0);xs([x()],Kd.prototype,"bottom",void 0);var JR;(function(s){s[s.UpperLeft=0]="UpperLeft",s[s.UpperCenter=1]="UpperCenter",s[s.UpperRight=2]="UpperRight",s[s.MiddleLeft=3]="MiddleLeft",s[s.MiddleCenter=4]="MiddleCenter",s[s.MiddleRight=5]="MiddleRight",s[s.LowerLeft=6]="LowerLeft",s[s.LowerCenter=7]="LowerCenter",s[s.LowerRight=8]="LowerRight",s[s.Custom=9]="Custom"})(JR||(JR={}));var _p;(function(s){s.Horizontal="x",s.Vertical="y"})(_p||(_p={}));class Ea extends Te{constructor(){super(...arguments);u(this,"_rectTransform",null);u(this,"_needsUpdate",!1);u(this,"childAlignment",JR.UpperLeft);u(this,"reverseArrangement",!1);u(this,"spacing",0);u(this,"padding");u(this,"minWidth",0);u(this,"minHeight",0);u(this,"flexibleHeight",0);u(this,"flexibleWidth",0);u(this,"preferredHeight",0);u(this,"preferredWidth",0)}get rectTransform(){return this._rectTransform}onParentRectTransformChanged(t){this._needsUpdate=!0}get isDirty(){return this._needsUpdate}get isLayoutGroup(){return!0}updateLayout(){this._rectTransform&&($U&&console.warn("Layout Update",this.context.time.frame,this.name),this._needsUpdate=!1,this.onCalculateLayout(this._rectTransform))}start(){this._needsUpdate=!0}onEnable(){$U&&console.log(this.name,this),this._rectTransform=this.gameObject.getComponent(Js);const t=this.gameObject.getComponentInParent(Us);t&&t.registerLayoutGroup(this),this._needsUpdate=!0}onDisable(){const t=this.gameObject.getComponentInParent(Us);t&&t.unregisterLayoutGroup(this)}set m_Spacing(t){t!==this.spacing&&(this._needsUpdate=!0,this.spacing=t)}get m_Spacing(){return this.spacing}}xs([x()],Ea.prototype,"childAlignment",void 0);xs([x()],Ea.prototype,"reverseArrangement",void 0);xs([x()],Ea.prototype,"spacing",void 0);xs([x(Kd)],Ea.prototype,"padding",void 0);xs([x()],Ea.prototype,"minWidth",void 0);xs([x()],Ea.prototype,"minHeight",void 0);xs([x()],Ea.prototype,"flexibleHeight",void 0);xs([x()],Ea.prototype,"flexibleWidth",void 0);xs([x()],Ea.prototype,"preferredHeight",void 0);xs([x()],Ea.prototype,"preferredWidth",void 0);class Jd extends Ea{constructor(){super(...arguments);u(this,"childControlHeight",!0);u(this,"childControlWidth",!0);u(this,"childForceExpandHeight",!1);u(this,"childForceExpandWidth",!1);u(this,"childScaleHeight",!1);u(this,"childScaleWidth",!1)}onCalculateLayout(t){var M;const i=this.primaryAxis,n=t.width;let r=n;const o=t.height;let a=o;r-=this.padding.horizontal,a-=this.padding.vertical,i===_p.Horizontal?this.padding.horizontal:this.padding.vertical;const l=i===_p.Horizontal,c=l?"y":"x",h=l?this.childControlWidth:this.childControlHeight,d=l?this.childControlHeight:this.childControlWidth,f=l?this.childForceExpandWidth:this.childForceExpandHeight,p=l?this.childForceExpandHeight:this.childForceExpandWidth,m=l?a:r,v=l?n:o,y=.5*(l?this.childAlignment%3:Math.floor(this.childAlignment/3));let g=0;l?g+=this.padding.left:g+=this.padding.top;let _=0,A=0;for(let R=0;R<this.gameObject.children.length;R++){const S=this.gameObject.children[R],I=ne.getComponent(S,Js);I!=null&&I.activeAndEnabled&&(A+=1,l?_+=I.width:_+=I.height)}let b=0;const E=this.spacing*(A-1);if(f||h){let R=0;l?R=r-=E:R=a-=E,A>0&&(b=R/A)}let C=0;C+=this.padding.left,C-=this.padding.right,y!==0&&(g=v-_,g*=y,g-=E*y,l?(g-=this.padding.right*y,g+=this.padding.left*(1-y),g<this.padding.left&&(g=this.padding.left)):(g-=this.padding.bottom*y,g+=this.padding.top*(1-y),g<this.padding.top&&(g=this.padding.top)));let T=1;for(let R=0;R<this.gameObject.children.length;R++){const S=this.gameObject.children[R],I=ne.getComponent(S,Js);if(I!=null&&I.activeAndEnabled){(M=I.pivot)==null||M.set(.5,.5),I.anchorMin.set(0,1),I.anchorMax.set(0,1);const L=n*.5+C*.5;I.anchoredPosition.x!==L&&(I.anchoredPosition.x=L);const U=o*-.5;I.anchoredPosition.y!==U&&(I.anchoredPosition.y=U),p&&d&&I.sizeDelta[c]!==m&&(I.sizeDelta[c]=m),f&&h&&I.sizeDelta[i]!==b&&(I.sizeDelta[i]=b);const D=l?I.width:I.height,V=D*.5;if(g+=V,f){const F=b*T-b*.5;F>g&&(g=F-b*.5+D+this.padding.left,g-=V)}let O=g;i===_p.Vertical&&(O=-O),I.anchoredPosition[i]!==O&&(I.anchoredPosition[i]=O),g+=V,g+=this.spacing,T+=1}}}}xs([x()],Jd.prototype,"childControlHeight",void 0);xs([x()],Jd.prototype,"childControlWidth",void 0);xs([x()],Jd.prototype,"childForceExpandHeight",void 0);xs([x()],Jd.prototype,"childForceExpandWidth",void 0);xs([x()],Jd.prototype,"childScaleHeight",void 0);xs([x()],Jd.prototype,"childScaleWidth",void 0);class fO extends Jd{get primaryAxis(){return _p.Vertical}}class pO extends Jd{get primaryAxis(){return _p.Horizontal}}class mO extends Ea{onCalculateLayout(){}}var nh=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r},fc;(function(s){s[s.ScreenSpaceOverlay=0]="ScreenSpaceOverlay",s[s.ScreenSpaceCamera=1]="ScreenSpaceCamera",s[s.WorldSpace=2]="WorldSpace",s[s.Undefined=-1]="Undefined"})(fc||(fc={}));const mM=ie("debuguilayout");class Us extends S_{constructor(){super(...arguments);u(this,"_renderOnTop");u(this,"_depthWrite",!1);u(this,"_doubleSided",!0);u(this,"_castShadows",!1);u(this,"_receiveShadows",!1);u(this,"_renderMode",fc.Undefined);u(this,"_rootCanvas");u(this,"_scaleFactor",1);u(this,"worldCamera");u(this,"planeDistance",-1);u(this,"_boundRenderSettingsChanged",this.onRenderSettingsChanged.bind(this));u(this,"previousParent",null);u(this,"_lastMatrixWorld",null);u(this,"_rectTransforms",[]);u(this,"_layoutGroups",new Map);u(this,"_receivers",[]);u(this,"onBeforeRenderRoutine",()=>{var t,i,n,r;if(this.previousParent=this.gameObject.parent,((t=this.context.xr)!=null&&t.isVR||(i=this.context.xr)!=null&&i.isPassThrough)&&this.screenspace){this.gameObject.visible=!1,this.gameObject.removeFromParent();return}this.renderOnTop||this.screenspace?this.gameObject.removeFromParent():(this.onUpdateRenderMode(),this.handleLayoutUpdates(),(n=this.shadowComponent)==null||n.updateMatrixWorld(!0),(r=this.shadowComponent)==null||r.updateWorldMatrix(!0,!0),this.invokeBeforeRenderEvents(),zo.ensureUpdateMeshUI(yk,this.context))});u(this,"onAfterRenderRoutine",()=>{var t,i,n,r,o;if(((t=this.context.xr)!=null&&t.isVR||(i=this.context.xr)!=null&&i.isPassThrough)&&this.screenspace){(n=this.previousParent)==null||n.add(this.gameObject);return}if((this.screenspace||this.renderOnTop)&&this.previousParent&&this.context.mainCamera){if(this.screenspace){const c=this.context.mainCamera;c==null||c.add(this.gameObject)}else this.previousParent.add(this.gameObject);const a=this.context.renderer.autoClear,l=this.context.renderer.autoClearColor;this.context.renderer.autoClear=!1,this.context.renderer.autoClearColor=!1,this.context.renderer.clearDepth(),this.onUpdateRenderMode(!0),this.handleLayoutUpdates(),(r=this.shadowComponent)==null||r.updateMatrixWorld(!0),this.invokeBeforeRenderEvents(),zo.ensureUpdateMeshUI(yk,this.context,!0),this.context.renderer.render(this.gameObject,this.context.mainCamera),this.context.renderer.autoClear=a,this.context.renderer.autoClearColor=l,this.previousParent.add(this.gameObject)}(o=this._lastMatrixWorld)==null||o.copy(this.gameObject.matrixWorld)});u(this,"_updateRenderSettingsRoutine");u(this,"_activeRenderMode",-1);u(this,"_lastWidth",-1);u(this,"_lastHeight",-1)}get isCanvas(){return!0}get screenspace(){return this.renderMode!==fc.WorldSpace}set renderOnTop(t){t!==this._renderOnTop&&(this._renderOnTop=t,this.onRenderSettingsChanged())}get renderOnTop(){return this._renderOnTop!==void 0?this._renderOnTop:!!(this.screenspace&&this._renderMode===fc.ScreenSpaceOverlay)}set depthWrite(t){this._depthWrite!==t&&(this._depthWrite=t,this.onRenderSettingsChanged())}get depthWrite(){return this._depthWrite}set doubleSided(t){this._doubleSided!==t&&(this._doubleSided=t,this.onRenderSettingsChanged())}get doubleSided(){return this._doubleSided}set castShadows(t){this._castShadows!==t&&(this._castShadows=t,this.onRenderSettingsChanged())}get castShadows(){return this._castShadows}set receiveShadows(t){this._receiveShadows!==t&&(this._receiveShadows=t,this.onRenderSettingsChanged())}get receiveShadows(){return this._receiveShadows}get renderMode(){return this._renderMode}set renderMode(t){this._renderMode!==t&&(this._renderMode=t,this.onRenderSettingsChanged())}set rootCanvas(t){this._rootCanvas instanceof Us||(this._rootCanvas=t)}get rootCanvas(){return this._rootCanvas}get scaleFactor(){return this._scaleFactor}set scaleFactor(t){this._scaleFactor=t}awake(){var t;this.shadowComponent=this.gameObject,this.previousParent=this.gameObject.parent,mM&&console.log("Canvas.Awake()",((t=this.previousParent)==null?void 0:t.name)+"/"+this.gameObject.name),super.awake()}start(){this.onUpdateRenderMode()}onEnable(){super.onEnable(),this._updateRenderSettingsRoutine=void 0,this._lastMatrixWorld=new fe,this.onUpdateRenderMode(),document.addEventListener("resize",this._boundRenderSettingsChanged),this.context.pre_render_callbacks.push(this.onBeforeRenderRoutine),this.context.post_render_callbacks.push(this.onAfterRenderRoutine)}onDisable(){super.onDisable(),document.removeEventListener("resize",this._boundRenderSettingsChanged);const t=this.context.pre_render_callbacks.indexOf(this.onBeforeRenderRoutine);t!==-1&&this.context.pre_render_callbacks.splice(t,1);const i=this.context.post_render_callbacks.indexOf(this.onAfterRenderRoutine);i!==-1&&this.context.post_render_callbacks.splice(i,1)}registerTransform(t){this._rectTransforms.push(t)}unregisterTransform(t){const i=this._rectTransforms.indexOf(t);i!==-1&&this._rectTransforms.splice(i,1)}registerLayoutGroup(t){const i=t.gameObject;this._layoutGroups.set(i,t)}unregisterLayoutGroup(t){const i=t.gameObject;this._layoutGroups.delete(i)}registerEventReceiver(t){this._receivers.push(t)}unregisterEventReceiver(t){const i=this._receivers.indexOf(t);i!==-1&&this._receivers.splice(i,1)}async onEnterXR(t){this.screenspace?(t.xr.isVR||t.xr.isPassThrough)&&(this.gameObject.visible=!1):(this.gameObject.visible=!1,await qC(1).then(()=>{this.gameObject.visible=!0}))}onLeaveXR(t){this.screenspace&&(t.xr.isVR||t.xr.isPassThrough)&&(this.gameObject.visible=!0)}invokeBeforeRenderEvents(){var t;for(const i of this._receivers)(t=i.onBeforeCanvasRender)==null||t.call(i,this)}handleLayoutUpdates(){this._lastMatrixWorld===null&&(this._lastMatrixWorld=new fe);const t=!this._lastMatrixWorld.equals(this.gameObject.matrixWorld);mM&&t&&console.log("Canvas Layout changed",this.context.time.frameCount,this.name);const i=!1;for(const n of this._rectTransforms){t&&n.markDirty();let r=this._layoutGroups.get(n.gameObject);n.isDirty&&!r&&(r=n.gameObject.getComponentInParent(Ea)),(n.isDirty||r!=null&&r.isDirty)&&(mM&&!i&&console.log("CANVAS UPDATE ### "+n.name+" ##################################### "+this.context.time.frame),r==null||r.updateLayout(),n.updateTransform())}}applyRenderSettings(){this.onRenderSettingsChanged()}onRenderSettingsChanged(){this._updateRenderSettingsRoutine||(this._updateRenderSettingsRoutine=this.startCoroutine(this._updateRenderSettingsDelayed(),Wt.OnBeforeRender))}*_updateRenderSettingsDelayed(){if(yield,this._updateRenderSettingsRoutine=void 0,this.shadowComponent){this.onUpdateRenderMode(),TS(this.shadowComponent,this);for(const t of ne.getComponentsInChildren(this.gameObject,$a))TS(t.shadowComponent,this)}}onUpdateRenderMode(t=!1){if(!t&&this._renderMode===this._activeRenderMode&&this._lastWidth===this.context.domWidth&&this._lastHeight===this.context.domHeight)return;this._activeRenderMode=this._renderMode;let i=this.context.mainCameraComponent,n=10;switch(i&&i.nearClipPlane>0&&i.farClipPlane>0&&(n=et.lerp(i.nearClipPlane,i.farClipPlane,.01)),this._renderMode===fc.ScreenSpaceCamera&&(this.worldCamera&&(i=this.worldCamera),this.planeDistance>0&&(n=this.planeDistance)),this._renderMode){case fc.ScreenSpaceOverlay:case fc.ScreenSpaceCamera:if(this._lastWidth=this.context.domWidth,this._lastHeight=this.context.domHeight,!i)return;const r=n+.01;this.gameObject.position.x=0,this.gameObject.position.y=0,this.gameObject.position.z=-r,this.gameObject.quaternion.identity();const o=this.gameObject.getComponent(Js);let a=!1;o.sizeDelta.x!==this.context.domWidth&&(a=!0),o.sizeDelta.y!==this.context.domHeight&&(a=!0);const l=i.fieldOfView*Math.PI/180,c=2*Math.tan(l/2)*Math.abs(r);this.gameObject.scale.x=c/this.context.domHeight,this.gameObject.scale.y=c/this.context.domHeight,this.gameObject.scale.z=.01,a&&(o.sizeDelta.x=this.context.domWidth,o.sizeDelta.y=this.context.domHeight,o==null||o.markDirty());break;case fc.WorldSpace:this._lastWidth=-1,this._lastHeight=-1;break}}}nh([x()],Us.prototype,"renderOnTop",null);nh([x()],Us.prototype,"depthWrite",null);nh([x()],Us.prototype,"doubleSided",null);nh([x()],Us.prototype,"castShadows",null);nh([x()],Us.prototype,"receiveShadows",null);nh([x()],Us.prototype,"renderMode",null);nh([x(Us)],Us.prototype,"rootCanvas",null);nh([x()],Us.prototype,"scaleFactor",null);nh([x(Mi)],Us.prototype,"worldCamera",void 0);nh([x()],Us.prototype,"planeDistance",void 0);var gO=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class Dd extends Te{constructor(){super(...arguments);u(this,"_alpha",1);u(this,"interactable",!0);u(this,"blocksRaycasts",!0);u(this,"_isDirty",!1);u(this,"_buffer",[])}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.markDirty())}get isCanvasGroup(){return!0}markDirty(){this._isDirty||(this._isDirty=!0,this.startCoroutine(this.applyChangesDelayed(),Wt.OnBeforeRender))}*applyChangesDelayed(){this._isDirty=!1,this.applyChangesNow()}applyChangesNow(){this._buffer.length=0;for(const t of ne.getComponentsInChildren(this.gameObject,$a,this._buffer)){const i=t;i.setAlphaFactor&&i.setAlphaFactor(this._alpha)}}}gO([x()],Dd.prototype,"alpha",null);gO([x()],Dd.prototype,"interactable",void 0);gO([x()],Dd.prototype,"blocksRaycasts",void 0);var Qn=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const e3=ie("debugusdzbehaviours");function O_(s){s&&(s.getComponentInParent(C_)||(Xe()&&console.debug('Raycaster on "'+s.name+'" was automatically added, because no raycaster was found in the parent hierarchy.'),s.addComponent(xa)))}class tm extends Te{constructor(){super(...arguments);u(this,"object");u(this,"target");u(this,"duration",1);u(this,"relativeMotion",!1);u(this,"coroutine",null);u(this,"targetPos",new w);u(this,"targetRot",new xe);u(this,"targetScale",new w)}start(){O_(this.gameObject)}onPointerClick(t){t.use(),this.coroutine&&this.stopCoroutine(this.coroutine),this.relativeMotion?this.coroutine=this.startCoroutine(this.moveRelative()):this.coroutine=this.startCoroutine(this.moveToTarget())}*moveToTarget(){if(!this.target||!this.object)return;const t=Qt(this.object).clone(),i=Qt(this.target).clone(),n=qi(this.object).clone(),r=qi(this.target).clone(),o=ln(this.object).clone(),a=ln(this.target).clone(),l=t.distanceTo(i),c=n.angleTo(r),h=o.distanceTo(a);if(l<.01&&c<.01&&h<.01){Os(this.object,i),Ka(this.object,r),Jg(this.object,a),this.coroutine=null;return}let d=0,f=0;for(;d<1;)d+=this.context.time.deltaTime/this.duration,d>1&&(d=1),f=d<.5?4*d*d*d:1-Math.pow(-2*d+2,3)/2,this.targetPos.lerpVectors(t,i,f),this.targetRot.slerpQuaternions(n,r,f),this.targetScale.lerpVectors(o,a,f),Os(this.object,this.targetPos),Ka(this.object,this.targetRot),Jg(this.object,this.targetScale),yield;this.coroutine=null}*moveRelative(){if(!this.target||!this.object)return;const t=this.object.position.clone(),i=this.object.quaternion.clone(),n=this.object.scale.clone(),r=this.target.position.clone(),o=this.target.quaternion.clone(),a=this.target.scale.clone();r.applyQuaternion(this.object.quaternion),this.targetPos.copy(this.object.position).add(r),this.targetRot.copy(this.object.quaternion).multiply(o),this.targetScale.copy(this.object.scale).multiply(a);let l=0,c=0;for(;l<1;)l+=this.context.time.deltaTime/this.duration,l>1&&(l=1),c=l<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2,this.object.position.lerpVectors(t,this.targetPos,c),this.object.quaternion.slerpQuaternions(i,this.targetRot,c),this.object.scale.lerpVectors(n,this.targetScale,c),yield;this.coroutine=null}beforeCreateDocument(t){var i;if(this.target&&this.object&&this.gameObject){const n=new ys("Move to "+((i=this.target)==null?void 0:i.name),Ys.tapTrigger(this.gameObject),wi.transformAction(this.object,this.target,this.duration,this.relativeMotion?"relative":"absolute"));t.addBehavior(n)}}}Qn([x(ge)],tm.prototype,"object",void 0);Qn([x(ge)],tm.prototype,"target",void 0);Qn([x()],tm.prototype,"duration",void 0);Qn([x()],tm.prototype,"relativeMotion",void 0);const yl=class extends Te{constructor(){super(...arguments);u(this,"materialToSwitch");u(this,"variantMaterial");u(this,"fadeDuration",0);u(this,"_objectsWithThisMaterial",null);u(this,"selfModel");u(this,"targetModels")}start(){var t;this._objectsWithThisMaterial=this.objectsWithThisMaterial,O_(this.gameObject),Xe()&&this._objectsWithThisMaterial.length<=0&&console.warn('ChangeMaterialOnClick: No objects found with material "'+((t=this.materialToSwitch)==null?void 0:t.name)+'"')}onPointerEnter(t){this.context.input.setCursorPointer()}onPointerExit(t){this.context.input.setCursorNormal()}onPointerClick(t){if(t.use(),!!this.variantMaterial)for(let i=0;i<this.objectsWithThisMaterial.length;i++){const n=this.objectsWithThisMaterial[i];n.material=this.variantMaterial}}get objectsWithThisMaterial(){return this._objectsWithThisMaterial!=null?this._objectsWithThisMaterial:(this._objectsWithThisMaterial=[],this.variantMaterial&&this.materialToSwitch&&this.context.scene.traverse(t=>{if(t instanceof le)if(Array.isArray(t.material)){for(const i of t.material)if(i===this.materialToSwitch){this.objectsWithThisMaterial.push(t);break}}else t.material===this.materialToSwitch?this.objectsWithThisMaterial.push(t):y5(t.material,this.materialToSwitch)&&this.objectsWithThisMaterial.push(t)}),this._objectsWithThisMaterial)}async beforeCreateDocument(t,i){this.targetModels=[],yl._materialTriggersPerId={},yl.variantSwitchIndex=0,this.materialToSwitch&&await fi.assignTextureLOD(this.materialToSwitch,0),this.variantMaterial&&await fi.assignTextureLOD(this.variantMaterial,0)}createBehaviours(t,i,n){this.objectsWithThisMaterial.find(o=>o.uuid===i.uuid)&&this.targetModels.push(i),this.gameObject.uuid===i.uuid&&(this.selfModel=i,this.materialToSwitch&&(yl._materialTriggersPerId[this.materialToSwitch.uuid]||(yl._materialTriggersPerId[this.materialToSwitch.uuid]=[]),yl._materialTriggersPerId[this.materialToSwitch.uuid].push(this)))}afterCreateDocument(t,i){if(!this.materialToSwitch)return;const n=yl._materialTriggersPerId[this.materialToSwitch.uuid];if(n){const r={};for(const o of n){const a=o.createVariants();a&&a.length>0&&(r[o.selfModel.uuid]=a)}for(const o of n){const a=[];for(const l in r)l!==o.selfModel.uuid&&a.push(...r[l]);o.createAndAttachBehaviors(t,r[o.selfModel.uuid],a)}}delete yl._materialTriggersPerId[this.materialToSwitch.uuid]}createAndAttachBehaviors(t,i,n){const r=[],o=[],a=Math.max(0,this.fadeDuration);o.push(wi.fadeAction([...this.targetModels,...n],a,!1)),r.push(wi.fadeAction(i,a,!1)),o.push(wi.fadeAction(i,a,!0)),t.addBehavior(new ys("Select_"+this.selfModel.name,Ys.tapTrigger(this.selfModel),wi.parallel(...o))),t.addBehavior(new ys("StartHidden_"+this.selfModel.name,Ys.sceneStartTrigger(),wi.parallel(...r)))}static getMaterialName(t){return Ul(t.name||"Material")+"_"+t.id}createVariants(){if(!this.variantMaterial)return null;const t=[];for(const i of this.targetModels){const n=i.clone();n.name+="_Variant_"+yl.variantSwitchIndex+++"_"+yl.getMaterialName(this.variantMaterial),n.displayName=n.displayName+": Variant with material "+this.variantMaterial.name,n.material=this.variantMaterial,n.geometry=i.geometry,n.transform=i.transform,(!i.parent||!i.parent.isEmpty())&&wr.createEmptyParent(i),i.parent&&i.parent.add(n),t.push(n)}return t}};let Pc=yl;u(Pc,"_materialTriggersPerId",{}),u(Pc,"variantSwitchIndex",0);Qn([x(Vt)],Pc.prototype,"materialToSwitch",void 0);Qn([x(Vt)],Pc.prototype,"variantMaterial",void 0);Qn([x()],Pc.prototype,"fadeDuration",void 0);const En=class extends Te{constructor(){super(...arguments);u(this,"target");u(this,"toggleOnClick",!1);u(this,"targetState",!0);u(this,"hideSelf",!0);u(this,"selfModel");u(this,"selfModelClone");u(this,"targetModel");u(this,"toggleModel");u(this,"stateBeforeCreatingDocument",!1);u(this,"targetStateBeforeCreatingDocument",!1)}start(){O_(this.gameObject)}onPointerClick(t){t.use(),!this.toggleOnClick&&this.hideSelf&&(this.gameObject.visible=!1),this.target&&(this.target.visible=this.toggleOnClick?!this.target.visible:this.targetState)}createBehaviours(t,i,n){i.uuid===this.gameObject.uuid&&(this.selfModel=i,this.selfModelClone=i.clone())}beforeCreateDocument(){this.target&&(this.gameObject[En.wasVisible]===void 0&&(this.gameObject[En.wasVisible]=this.gameObject.activeSelf),this.target[En.wasVisible]===void 0&&(this.target[En.wasVisible]=this.target.activeSelf),this.stateBeforeCreatingDocument=this.gameObject[En.wasVisible],this.targetStateBeforeCreatingDocument=this.target[En.wasVisible],this.gameObject.visible=!0,this.target.visible=!0)}afterCreateDocument(t,i){if(!this.target)return;this.targetModel=i.document.findById(this.target.uuid);const n=this.selfModel;if(this.selfModel&&this.targetModel){let r=this.selfModel,o=this.targetState;if(this.toggleOnClick)if(o=!this.targetStateBeforeCreatingDocument,!this.selfModelClone.geometry)(!this.selfModel.parent||this.selfModel.parent.isEmpty())&&QD.createEmptyParent(this.selfModel),this.toggleModel=this.selfModel.deepClone(),this.toggleModel.name+="_toggle",this.selfModel.parent.add(this.toggleModel);else{if(!this.gameObject[En.toggleClone]){const c=this.selfModelClone.clone();c.setMatrix(new fe),c.name+="_toggle"+En.clonedToggleIndex++,n.add(c),this.gameObject[En.toggleClone]=c,console.warn("USDZExport: Toggle "+this.gameObject.name+" doesn't have geometry. It will be deep cloned and nested behaviours will likely not work.")}const l=this.gameObject[En.toggleClone];if(!this.gameObject[En.reverseToggleClone]){const c=this.selfModelClone.clone();c.setMatrix(new fe),c.name+="_toggleReverse"+En.clonedToggleIndex++,n.add(c),this.gameObject[En.reverseToggleClone]=c}this.toggleModel=this.gameObject[En.reverseToggleClone],(!this.toggleModel.geometry||!l.geometry)&&console.error("triggers without childs and without geometry won't work!",this,n.geometry),r=l,n.geometry=null,n.material=null}if(this.toggleModel){if(this.toggleOnClick){const l=[];l.push(wi.fadeAction(r,0,!1)),l.push(wi.fadeAction(this.toggleModel,0,!0)),l.push(wi.fadeAction(this.targetModel,0,o)),t.addBehavior(new ys("Toggle_"+r.name+"_toggleTo"+(o?"On":"Off"),Ys.tapTrigger(r),wi.parallel(...l)));const c=[];c.push(wi.fadeAction(this.toggleModel,0,!1)),c.push(wi.fadeAction(r,0,!0)),c.push(wi.fadeAction(this.targetModel,0,!o)),t.addBehavior(new ys("Toggle_"+r.name+"_toggleTo"+(o?"Off":"On"),Ys.tapTrigger(this.toggleModel),wi.parallel(...c)))}}else{const l=[];this.hideSelf&&l.push(wi.fadeAction(r,0,!1)),l.push(wi.fadeAction(this.targetModel,0,o)),t.addBehavior(new ys("Toggle_"+r.name+"_toggleTo"+(o?"On":"Off"),Ys.tapTrigger(r),wi.parallel(...l)))}const a=new Array;this.targetStateBeforeCreatingDocument||a.push(this.targetModel),this.stateBeforeCreatingDocument||a.push(n),this.toggleModel&&a.push(this.toggleModel),t.addBehavior(new ys("HideOnStart_"+this.gameObject.name,Ys.sceneStartTrigger(),wi.fadeAction(a,0,!1)))}}afterSerialize(t,i){this.gameObject[En.wasVisible]!==void 0&&(this.gameObject.visible=this.gameObject[En.wasVisible],delete this.gameObject[En.wasVisible]),this.target&&this.target[En.wasVisible]!==void 0&&(this.target.visible=this.target[En.wasVisible],delete this.target[En.wasVisible]),delete this.gameObject[En.toggleClone],delete this.gameObject[En.reverseToggleClone]}};let ha=En;u(ha,"clonedToggleIndex",0),u(ha,"wasVisible",Symbol("usdz_SetActiveOnClick_wasVisible")),u(ha,"toggleClone",Symbol("clone for toggling")),u(ha,"reverseToggleClone",Symbol("clone for reverse toggling"));Qn([x(ge)],ha.prototype,"target",void 0);Qn([x()],ha.prototype,"toggleOnClick",void 0);Qn([x()],ha.prototype,"targetState",void 0);Qn([x()],ha.prototype,"hideSelf",void 0);class vO extends Te{constructor(){super(...arguments);u(this,"wasVisible",!1)}start(){ne.setActive(this.gameObject,!1)}createBehaviours(t,i,n){i.uuid===this.gameObject.uuid&&(this.wasVisible||t.addBehavior(new ys("HideOnStart_"+this.gameObject.name,Ys.sceneStartTrigger(),wi.fadeAction(i,0,!1))))}beforeCreateDocument(){this.wasVisible=ne.isActiveSelf(this.gameObject)}}class Bv extends Te{constructor(){super(...arguments);u(this,"target");u(this,"duration",.5);u(this,"motionType","bounce")}beforeCreateDocument(){}createBehaviours(t,i,n){if(this.target&&i.uuid===this.gameObject.uuid){const r=new ys("emphasize "+this.name,Ys.tapTrigger(this.gameObject),wi.emphasize(this.target,this.duration,this.motionType,void 0,"basic"));t.addBehavior(r)}}afterCreateDocument(t,i){}}Qn([x()],Bv.prototype,"target",void 0);Qn([x()],Bv.prototype,"duration",void 0);Qn([x()],Bv.prototype,"motionType",void 0);class Od extends Te{constructor(){super(...arguments);u(this,"target");u(this,"clip","");u(this,"toggleOnClick",!1);u(this,"trigger","tap")}start(){O_(this.gameObject)}ensureAudioSource(){if(!this.target){const t=this.gameObject.addComponent(Fi);t&&(this.target=t,t.spatialBlend=1,t.volume=1,t.loop=!1,t.preload=!0)}}onPointerClick(t){var i;t.use(),!(!((i=this.target)!=null&&i.clip)&&!this.clip)&&(this.ensureAudioSource(),this.target&&(this.target.isPlaying&&this.toggleOnClick?this.target.stop():(!this.toggleOnClick&&this.target.isPlaying&&this.target.stop(),this.clip?this.target.play(this.clip):this.target.play())))}createBehaviours(t,i,n){if(!(!this.target&&!this.clip)&&i.uuid===this.gameObject.uuid){const r=this.clip?this.clip:this.target?this.target.clip:void 0;if(!r||typeof r!="string")return;const o=this.target?this.target.gameObject:this.gameObject;jd.getName(r);const a=this.target?this.target.volume:1,l=this.target&&this.target.spatialBlend==0?"nonSpatial":"spatial";let c=!1;this.gameObject.traverse(p=>{p instanceof le&&p.visible&&(c=!0)}),c=!0;const h=t.addAudioClip(r);let d=wi.playAudioAction(o,h,"play",a,l);this.target&&this.target.loop&&(d=wi.sequence(d).makeLooping());const f=this.name?"_"+this.name:"";if(c&&this.trigger==="tap"){this.toggleOnClick&&(d.multiplePerformOperation="stop");const p=new ys("playAudio"+f,Ys.tapTrigger(i),d);t.addBehavior(p)}if(this.target&&this.target.playOnAwake&&this.target.enabled)if(c&&this.trigger==="tap")console.warn("USDZExport: Audio sources that are played on tap can't also auto-play at scene start due to a QuickLook bug.");else{const p=new ys("playAudioOnStart"+f,Ys.sceneStartTrigger(),d);t.addBehavior(p)}}}}Qn([x(Fi)],Od.prototype,"target",void 0);Qn([x(URL)],Od.prototype,"clip",void 0);Qn([x()],Od.prototype,"toggleOnClick",void 0);const Al=class extends Te{constructor(){super(...arguments);u(this,"animator");u(this,"stateName");u(this,"trigger","tap");u(this,"animation");u(this,"selfModel");u(this,"stateAnimationModel");u(this,"animationSequence",new Array);u(this,"animationLoopAfterSequence",new Array);u(this,"randomOffsetNormalized",0)}get target(){var t,i;return((t=this.animator)==null?void 0:t.gameObject)||((i=this.animation)==null?void 0:i.gameObject)}start(){O_(this.gameObject)}onPointerClick(t){var i;t.use(),this.target&&this.stateName&&((i=this.animator)==null||i.play(this.stateName,0,0,.1))}createBehaviours(t,i,n){i.uuid===this.gameObject.uuid&&(this.selfModel=i)}afterSerialize(){if(Al.rootsWithExclusivePlayback.size>1){const t='Multiple root objects targeted by more than one animation. To work around QuickLook bug FB13410767, animations will be set as "exclusive" and activating them will stop other animations being marked as exclusive.';Xe()&&Yi(t),console.warn(t,...Al.rootsWithExclusivePlayback)}Al.animationActions=[],Al.rootsWithExclusivePlayback=new Set}afterCreateDocument(t,i){if(this.animationSequence===void 0&&this.animationLoopAfterSequence===void 0||!this.stateAnimationModel||!this.target)return;const n=i.document,r=i.extensions.find(l=>l instanceof x_);if(!r)return;const o=r.getClipCount(this.target)>1;o&&(Xe()&&console.warn("Setting exclusive playback for "+this.target.name+"@"+this.stateName+" because it has "+r.getClipCount(this.target)+" animations. This works around QuickLook bug FB13410767."),Al.rootsWithExclusivePlayback.add(this.target));const a=this.name?this.name:"";n.traverse(l=>{var c,h;if(l.uuid===((c=this.target)==null?void 0:c.uuid)){const d=Al.getActionForSequences(n,l,this.animationSequence,this.animationLoopAfterSequence,this.randomOffsetNormalized),f=new ys(this.trigger+"_"+a+"_toPlayAnimation_"+this.stateName+"_on_"+((h=this.target)==null?void 0:h.name),this.trigger=="tap"?Ys.tapTrigger(this.selfModel):Ys.sceneStartTrigger(),d);o&&f.makeExclusive(!0),t.addBehavior(f)}})}static getActionForSequences(t,i,n,r,o){const a=(c,h)=>{let d=Al.animationActions.find(f=>f.affectedObjects==c&&f.start==h.start&&f.duration==h.duration&&f.animationSpeed==h.speed);return d||(d=wi.startAnimationAction(c,h),Al.animationActions.push(d)),d},l=wi.sequence();if(n&&n.length>0)for(const c of n)l.addAction(a(i,c));if(r&&r.length>0){const c=l.actions.length==0?l:wi.sequence();for(const h of r)c.addAction(a(i,h));c.makeLooping(),l!==c&&l.addAction(c)}return o&&o>0&&l.actions.unshift(wi.waitAction(o)),l}static getAndRegisterAnimationSequences(t,i,n){var v,y,g,_,A,b,E,C;if(!i)return;const r=i.getComponent(Cr),o=i.getComponent(qr);if(!r&&!o)return;if(r&&!n)throw new Error("PlayAnimationOnClick: No stateName specified for animator "+r.name+" on "+i.name);let a=[],l=[];if(o){const T=t.registerAnimation(i,o.clip);T&&(o.loop?l.push(T):a.push(T));let M=0;if(o.minMaxOffsetNormalized){const R=o.minMaxOffsetNormalized.x,S=o.minMaxOffsetNormalized.y;M=(((v=o.clip)==null?void 0:v.duration)||1)*(R+Math.random()*(S-R))}return{animationSequence:a,animationLoopAfterSequence:l,randomTimeOffset:M}}const c=r==null?void 0:r.runtimeAnimatorController;let h=c==null?void 0:c.findState(n),d=[],f=[];if(c&&h){const T=new Array;T.push(h);let M=!1;for(;T.length<100;){if(!h||h===null||!h.transitions||h.transitions.length===0){(y=h.motion)!=null&&y.isLooping&&(M=!0);break}const R=h.transitions.find(I=>I.conditions.length===0),S=R?c.getState(R.destinationState,0):null;if(S&&T.includes(S)){h=S,M=!0;break}else if(R){if(h=S,!h)break;T.push(h)}else{M=((g=h.motion)==null?void 0:g.isLooping)??!1;break}}if(M&&h){const R=T.indexOf(h);d=T.slice(0,R),f=T.slice(R),e3&&console.log("found loop from "+n,"states until loop",d,"states looping",f)}else d=T,f=[],e3&&console.log("found no loop from "+n,"states",d);if(!f.length){const R=d[d.length-1],S=(_=R.motion)==null?void 0:_.clip;if(S){let I;if(t.holdClipMap.has(S))I=t.holdClipMap.get(S);else{const L=R.name+"_hold";I=S.clone(),I.duration=1,I.name=L;const U=S.duration;I.tracks=S.tracks.map(D=>{const V=D.clone();V.times=new Float32Array([0,U]);const O=D.values.length,F=D.getValueSize(),N=D.values.slice(O-F,O);return V.values=new Float32Array(2*F),V.values.set(N,0),V.values.set(N,F),V}),I.name=L,t.holdClipMap.set(S,I)}if(I){const L={name:I.name,motion:{clip:I,isLooping:!1,name:I.name},speed:1,transitions:[],behaviours:[],hash:R.hash+1};f.push(L)}}}}if(d.length===1&&(!((A=d[0].motion)!=null&&A.clip)||((E=(b=d[0].motion)==null?void 0:b.clip.tracks)==null?void 0:E.length)===0)){a=new Array;const T=t.registerAnimation(i,null);T&&a.push(T);return}if(d=d.filter(T=>{var M,R,S;return((M=T.motion)==null?void 0:M.clip)&&((S=(R=T.motion)==null?void 0:R.clip.tracks)==null?void 0:S.length)>0}),f=f.filter(T=>{var M,R,S;return((M=T.motion)==null?void 0:M.clip)&&((S=(R=T.motion)==null?void 0:R.clip.tracks)==null?void 0:S.length)>0}),d.length===0&&f.length===0){console.warn("No clips found for state "+n+" on "+(r==null?void 0:r.name)+", can't export animation data");return}const p=(T,M)=>{if(!i)return;const R=t.registerAnimation(i,T.motion.clip??null);R?(R.speed=T.speed,M.push(R)):console.warn("Couldn't register animation for state "+T.name+" on "+(r==null?void 0:r.name))};if(d.length>0){a=new Array;for(const T of d)p(T,a)}if(f.length>0){l=new Array;for(const T of f)p(T,l)}let m=0;if(r&&c&&r.minMaxOffsetNormalized){const T=r.minMaxOffsetNormalized.x,M=r.minMaxOffsetNormalized.y,R=d.length?d[0]:f.length?f[0]:null;m=(((C=R==null?void 0:R.motion.clip)==null?void 0:C.duration)||1)*(T+Math.random()*(M-T))}return{animationSequence:a,animationLoopAfterSequence:l,randomTimeOffset:m}}createAnimation(t,i,n){if(!this.target||!this.animator&&!this.animation)return;const r=Al.getAndRegisterAnimationSequences(t,this.target,this.stateName);r&&(this.animationSequence=r.animationSequence,this.animationLoopAfterSequence=r.animationLoopAfterSequence,this.randomOffsetNormalized=r.randomTimeOffset,this.stateAnimationModel=i)}};let Il=Al;u(Il,"animationActions",[]),u(Il,"rootsWithExclusivePlayback",new Set);Qn([x(Cr)],Il.prototype,"animator",void 0);Qn([x()],Il.prototype,"stateName",void 0);class Dv extends Te{constructor(){super(...arguments);u(this,"target")}getType(){}getDuration(){}}Qn([x(ge)],Dv.prototype,"target",void 0);class L_ extends Te{constructor(){super(...arguments);u(this,"target")}}Qn([x(Dv)],L_.prototype,"target",void 0);class k_ extends Dv{constructor(){super(...arguments);u(this,"type",SA.Hide);u(this,"duration",1)}getType(){switch(this.type){case SA.Hide:return"hide";case SA.Show:return"show"}}getDuration(){return this.duration}}Qn([x()],k_.prototype,"type",void 0);Qn([x()],k_.prototype,"duration",void 0);class yO extends L_{}var SA;(function(s){s[s.Show=0]="Show",s[s.Hide=1]="Hide"})(SA||(SA={}));var _u=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const t3=ie("debugcharactercontroller");class im extends Te{constructor(){super(...arguments);u(this,"center",new w(0,0,0));u(this,"radius",.5);u(this,"height",2);u(this,"_rigidbody",null);u(this,"_activeGroundCollisions");u(this,"_contactVelocity",new w)}get rigidbody(){return this._rigidbody?this._rigidbody:(this._rigidbody=this.gameObject.getComponent(Ci),this._rigidbody||(this._rigidbody=this.gameObject.addComponent(Ci)),this.rigidbody)}awake(){this._activeGroundCollisions=new Set}onEnable(){const t=this.rigidbody;let i=this.gameObject.getComponent(mu);i||(i=this.gameObject.addComponent(mu)),i.center.copy(this.center),i.radius=this.radius,i.height=this.height;const n=new w(0,0,1),r=new w(1,0,0),o=new w(0,1,0),a=this.gameObject.getWorldDirection(new w);a.y=0;const l=r.dot(a)<0?-1:1,c=n.angleTo(a)*l;this.gameObject.setRotationFromAxisAngle(o,c),t.lockRotationX=!0,t.lockRotationY=!0,t.lockRotationZ=!0}move(t){this.gameObject.position.add(t)}onCollisionEnter(t){(t.contacts.length==0||t.contacts.some(i=>i.normal.y>.2))&&(this._activeGroundCollisions.add(t),t3&&console.log(`Collision(${this._activeGroundCollisions.size}): ${t.contacts.map(i=>i.normal.y.toFixed(2)).join(", ")} - ${this.isGrounded}`))}onCollisionExit(t){this._activeGroundCollisions.delete(t),t3&&console.log(`Collision(${this._activeGroundCollisions.size}) - ${this.isGrounded}`)}get isGrounded(){return this._activeGroundCollisions.size>0}get contactVelocity(){var t;this._contactVelocity.set(0,0,0);for(const i of this._activeGroundCollisions){const n=(t=this.context.physics.engine)==null?void 0:t.getLinearVelocity(i.collider);n&&(this._contactVelocity.x+=n.x,this._contactVelocity.y+=n.y,this._contactVelocity.z+=n.z)}return this._contactVelocity}}_u([x(w)],im.prototype,"center",void 0);_u([x()],im.prototype,"radius",void 0);_u([x()],im.prototype,"height",void 0);class bu extends Te{constructor(){super(...arguments);u(this,"controller");u(this,"movementSpeed",2);u(this,"rotationSpeed",2);u(this,"jumpForce",1);u(this,"doubleJumpForce",2);u(this,"animator");u(this,"lookForward",!0);u(this,"lookInput",new Z(0,0));u(this,"moveInput",new Z(0,0));u(this,"jumpInput",!1);u(this,"_currentSpeed",new w(0,0,0));u(this,"_currentAngularSpeed",new w(0,0,0));u(this,"_temp",new w(0,0,0));u(this,"_jumpCount",0);u(this,"_currentRotation");u(this,"_raycastOptions",new Yc)}awake(){this._currentRotation=new xe}update(){const t=this.context.input;t.isKeyPressed("KeyW")?this.moveInput.y+=1:t.isKeyPressed("KeyS")&&(this.moveInput.y-=1),t.isKeyPressed("KeyD")?this.lookInput.x+=1:t.isKeyPressed("KeyA")&&(this.lookInput.x-=1),this.jumpInput||(this.jumpInput=t.isKeyDown("Space"))}move(t){this.moveInput.add(t)}look(t){this.lookInput.add(t)}jump(){this.jumpInput=!0}onBeforeRender(){this.handleInput(this.moveInput,this.lookInput,this.jumpInput),this.lookInput.set(0,0),this.moveInput.set(0,0),this.jumpInput=!1}handleInput(t,i,n){var r,o,a,l,c,h,d,f,p,m,v;if((r=this.controller)!=null&&r.isGrounded&&(this._jumpCount=0,this.doubleJumpForce>0&&((o=this.animator)==null||o.setBool("doubleJump",!1))),this._currentSpeed.z+=t.y*this.movementSpeed*this.context.time.deltaTime,(a=this.animator)==null||a.setBool("running",t.length()>.01),(c=this.animator)==null||c.setBool("jumping",((l=this.controller)==null?void 0:l.isGrounded)===!0&&n),this._temp.copy(this._currentSpeed),this._temp.applyQuaternion(this.gameObject.quaternion),this.controller?this.controller.move(this._temp):this.gameObject.position.add(this._temp),this._currentAngularSpeed.y+=et.toRadians(-i.x*this.rotationSpeed)*this.context.time.deltaTime,this.lookForward&&Math.abs(this._currentAngularSpeed.y)<.01){const y=this.context.mainCameraComponent.forward;y.y=0,y.normalize(),this._currentRotation.setFromUnitVectors(new w(0,0,1),y),this.gameObject.quaternion.slerp(this._currentRotation,this.context.time.deltaTime*10)}if(this.gameObject.rotateY(this._currentAngularSpeed.y),this._currentSpeed.multiplyScalar(1-this.context.time.deltaTime*10),this._currentAngularSpeed.y*=1-this.context.time.deltaTime*10,this.controller&&n&&this.jumpForce>0){let y=(h=this.controller)==null?void 0:h.isGrounded;if(this.doubleJumpForce>0&&!((d=this.controller)!=null&&d.isGrounded)&&this._jumpCount===1&&(y=!0,(f=this.animator)==null||f.setBool("doubleJump",!0)),y){this._jumpCount+=1;const g=this.controller.rigidbody,_=this._jumpCount===2?this.doubleJumpForce:this.jumpForce;g.applyImpulse(new w(0,1,0).multiplyScalar(_))}}if(this.controller){const y=(p=this.controller)==null?void 0:p.rigidbody.getVelocity().y;if(y<-1){this._raycastOptions.ray||(this._raycastOptions.ray=new jo),this._raycastOptions.ray.origin.copy(Qt(this.gameObject)),this._raycastOptions.ray.direction.set(0,-1,0);const g=this.layer;this.gameObject.layers.disableAll(),this.gameObject.layers.set(2);const _=this.context.physics.raycast(this._raycastOptions);this.gameObject.layers.set(g),(_.length&&_[0].distance>2||y<-10)&&((m=this.animator)==null||m.setBool("falling",!0))}else(v=this.animator)==null||v.setBool("falling",!1)}}}_u([x(im)],bu.prototype,"controller",void 0);_u([x()],bu.prototype,"movementSpeed",void 0);_u([x()],bu.prototype,"rotationSpeed",void 0);_u([x()],bu.prototype,"jumpForce",void 0);_u([x()],bu.prototype,"doubleJumpForce",void 0);_u([x(Cr)],bu.prototype,"animator",void 0);var rce=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class F_ extends er{constructor(){super(...arguments);u(this,"intensity",new Ze(0))}get typeName(){return"ChromaticAberration"}onCreateEffect(){const t=new mH;return t.offset=new Z(0,0),t.radialModulation=!0,t.modulationOffset=.15,this.intensity.valueProcessor=i=>i*.02,this.intensity.onValueChanged=i=>{t.offset.x=-i,t.offset.y=i},t}}rce([x(Ze)],F_.prototype,"intensity",void 0);il("ChromaticAberration",F_);var KQ=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const i3=ie("debugpost");var Qr;(function(s){s[s.None=0]="None",s[s.Neutral=1]="Neutral",s[s.ACES=2]="ACES",s[s.AgX=3]="AgX",s[s.KhronosNeutral=4]="KhronosNeutral"})(Qr||(Qr={}));function gM(s){switch(s){case Qr.None:return uv;case Qr.Neutral:return W0;case Qr.ACES:return q0;case Qr.AgX:return dv;case Qr.KhronosNeutral:return Mp;default:return Mp}}function oce(s){switch(s){case uv:return Qr.None;case q0:return Qr.ACES;case dv:return Qr.AgX;case Mp:return Qr.Neutral;case W0:return Qr.Neutral;default:return Qr.None}}function n3(s){switch(s){case uv:return Rs.LINEAR;case q0:return Rs.ACES_FILMIC;case dv:return Rs.AGX;case Mp:return Rs.NEUTRAL;case W0:return Rs.REINHARD;default:return Rs.LINEAR}}class Jc extends er{constructor(){super(...arguments);u(this,"mode",new Ze(void 0));u(this,"exposure",new Ze(1))}get typeName(){return"ToneMapping"}setMode(t){const i=Qr[t];return i===void 0?(console.error("Invalid ToneMapping mode",t),this):(this.mode.value=i,this)}get isToneMapping(){return!0}onEffectEnabled(){const t=NQ(this);t&&super.onEffectEnabled(t)}onCreateEffect(){if(this.postprocessingContext)for(const n of this.postprocessingContext.components){if(n===this)break;if(n!=this&&n instanceof Jc){console.warn("Multiple tonemapping effects found in the same postprocessing stack: Please check your scene setup.",{activeEffect:n,ignoredEffect:this});return}}if(this.mode.isInitialized==!1){const n=oce(this.context.renderer.toneMapping);this.mode.initialize(n)}const t=gM(this.mode.value),i=new oS({mode:n3(t)});return this.mode.onValueChanged=n=>{const r=gM(n);i.mode=n3(r),i3&&console.log("ToneMapping mode changed to",Qr[n],r,i.mode)},i3&&console.log("Use ToneMapping",Qr[this.mode.value],t,i.mode,"renderer.tonemapping: "+this.context.renderer.toneMapping),this.exposure.onValueChanged=n=>{this.context.renderer.toneMappingExposure=n},i}onBeforeRender(){this.mode.overrideState&&(this.context.renderer.toneMapping=gM(this.mode.value)),this.exposure.overrideState&&(this.context.renderer.toneMappingExposure=this.exposure.value)}}KQ([x(Ze)],Jc.prototype,"mode",void 0);KQ([x(Ze)],Jc.prototype,"exposure",void 0);il("Tonemapping",Jc);var LE=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class Zd extends er{constructor(){super(...arguments);u(this,"postExposure",new Ze(0));u(this,"contrast",new Ze(0));u(this,"hueShift",new Ze(0));u(this,"saturation",new Ze(0))}get typeName(){return"ColorAdjustments"}init(){this.postExposure.valueProcessor=t=>(t=Math.pow(2,t),t),this.contrast.valueProcessor=t=>{let i=1;return t>0?i=200:t<0&&(i=100),t/i},this.contrast.defaultValue=0,this.hueShift.valueProcessor=t=>Math.PI*t/180,this.hueShift.defaultValue=0,this.saturation.valueProcessor=t=>t<0?t/100:t/(100*Math.PI),this.saturation.defaultValue=0}onCreateEffect(){var o,a;const t=[];this.context.renderer.toneMapping!==_o&&this.postExposure.overrideState&&(this.context.renderer.toneMapping=_o);let i=(o=this.postprocessingContext)==null?void 0:o.components.find(l=>l instanceof Jc);i||(i=new Jc,(a=this.postprocessingContext)==null||a.components.push(i)),this.postExposure.onValueChanged=l=>{this.postExposure.overrideState&&(i.exposure.value=l)};const n=new pH;this.contrast.onValueChanged=l=>n.contrast=l;const r=new AH;return t.push(n),t.push(r),this.hueShift.onValueChanged=l=>r.hue=l,this.saturation.onValueChanged=l=>r.saturation=l,t}}LE([x(Ze)],Zd.prototype,"postExposure",void 0);LE([x(Ze)],Zd.prototype,"contrast",void 0);LE([x(Ze)],Zd.prototype,"hueShift",void 0);LE([x(Ze)],Zd.prototype,"saturation",void 0);il("ColorAdjustments",Zd);const JQ=Math.sqrt(5),ace=(JQ-1)/4,rr=(5-JQ)/20,Bx=s=>Math.floor(s)|0,Dx=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function lce(s=Math.random){const e=cce(s),t=new Float64Array(e).map(o=>Dx[o%32*4]),i=new Float64Array(e).map(o=>Dx[o%32*4+1]),n=new Float64Array(e).map(o=>Dx[o%32*4+2]),r=new Float64Array(e).map(o=>Dx[o%32*4+3]);return function(a,l,c,h){let d,f,p,m,v;const y=(a+l+c+h)*ace,g=Bx(a+y),_=Bx(l+y),A=Bx(c+y),b=Bx(h+y),E=(g+_+A+b)*rr,C=g-E,T=_-E,M=A-E,R=b-E,S=a-C,I=l-T,L=c-M,U=h-R;let D=0,V=0,O=0,F=0;S>I?D++:V++,S>L?D++:O++,S>U?D++:F++,I>L?V++:O++,I>U?V++:F++,L>U?O++:F++;const N=D>=3?1:0,q=V>=3?1:0,$=O>=3?1:0,oe=F>=3?1:0,ae=D>=2?1:0,Re=V>=2?1:0,se=O>=2?1:0,ye=F>=2?1:0,Ae=D>=1?1:0,je=V>=1?1:0,Be=O>=1?1:0,We=F>=1?1:0,lt=S-N+rr,rt=I-q+rr,W=L-$+rr,Ge=U-oe+rr,we=S-ae+2*rr,Ne=I-Re+2*rr,Ee=L-se+2*rr,st=U-ye+2*rr,tt=S-Ae+3*rr,ct=I-je+3*rr,jt=L-Be+3*rr,H=U-We+3*rr,k=S-1+4*rr,ve=I-1+4*rr,_e=L-1+4*rr,Pe=U-1+4*rr,Me=g&255,Ct=_&255,mt=A&255,ke=b&255;let Ve=.6-S*S-I*I-L*L-U*U;if(Ve<0)d=0;else{const Ye=Me+e[Ct+e[mt+e[ke]]];Ve*=Ve,d=Ve*Ve*(t[Ye]*S+i[Ye]*I+n[Ye]*L+r[Ye]*U)}let Tt=.6-lt*lt-rt*rt-W*W-Ge*Ge;if(Tt<0)f=0;else{const Ye=Me+N+e[Ct+q+e[mt+$+e[ke+oe]]];Tt*=Tt,f=Tt*Tt*(t[Ye]*lt+i[Ye]*rt+n[Ye]*W+r[Ye]*Ge)}let Fe=.6-we*we-Ne*Ne-Ee*Ee-st*st;if(Fe<0)p=0;else{const Ye=Me+ae+e[Ct+Re+e[mt+se+e[ke+ye]]];Fe*=Fe,p=Fe*Fe*(t[Ye]*we+i[Ye]*Ne+n[Ye]*Ee+r[Ye]*st)}let ci=.6-tt*tt-ct*ct-jt*jt-H*H;if(ci<0)m=0;else{const Ye=Me+Ae+e[Ct+je+e[mt+Be+e[ke+We]]];ci*=ci,m=ci*ci*(t[Ye]*tt+i[Ye]*ct+n[Ye]*jt+r[Ye]*H)}let gt=.6-k*k-ve*ve-_e*_e-Pe*Pe;if(gt<0)v=0;else{const Ye=Me+1+e[Ct+1+e[mt+1+e[ke+1]]];gt*=gt,v=gt*gt*(t[Ye]*k+i[Ye]*ve+n[Ye]*_e+r[Ye]*Pe)}return 27*(d+f+p+m+v)}}function cce(s){const t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){const n=i+~~(s()*(256-i)),r=t[i];t[i]=t[n],t[n]=r}for(let i=256;i<512;i++)t[i]=t[i-256];return t}const vM=ie("debugstencil");function hce(s,e){return(s&1<<e.layer)!=0}const uce=Symbol("stencils"),Kf=class{constructor(e,t){u(this,"parser");u(this,"source");this.parser=e,this.source=t}get name(){return"NEEDLE_render_objects"}static applyStencil(e){if(!e)return;const t=e.sourceId;if(vM&&console.log(t,Kf.stencils),!t)return;const i=Kf.stencils[t];if(i)for(let n=i.length-1;n>=0;n--){const r=i[n];if(hce(r.layer,e)){vM&&console.log(r),setTimeout(()=>{So()&&pE(e.gameObject)&&(Yi("Stencil not supported on instanced objects"),console.warn("Stencil not supported on instanced objects",e))},500);for(let o=0;o<e.sharedMaterials.length;o++){let a=e.sharedMaterials[o];a&&(a=a.clone(),a[uce]=!0,a.stencilWrite=!0,a.stencilWriteMask=255,a.stencilFuncMask=255,a.stencilRef=r.value,a.stencilFunc=r.compareFunc,a.stencilZPass=r.passOp,a.stencilFail=r.failOp,a.stencilZFail=r.zFailOp,e.sharedMaterials[o]=a)}e.gameObject.renderOrder=r.event*1e3+r.index*50;break}}}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[fce];if(i){vM&&console.log(i);const n=i.stencil;if(n&&Array.isArray(n))for(const r of n){const o={...r};o.compareFunc=dce(o.compareFunc),o.passOp=yM(o.passOp),o.failOp=yM(o.failOp),o.zFailOp=yM(o.zFailOp),Kf.stencils[this.source]||(Kf.stencils[this.source]=[]),Kf.stencils[this.source].push(o)}}}return null}};let CA=Kf;u(CA,"stencils",{});var oc;(function(s){s[s.Keep=0]="Keep",s[s.Zero=1]="Zero",s[s.Replace=2]="Replace",s[s.IncrementSaturate=3]="IncrementSaturate",s[s.DecrementSaturate=4]="DecrementSaturate",s[s.Invert=5]="Invert",s[s.IncrementWrap=6]="IncrementWrap",s[s.DecrementWrap=7]="DecrementWrap"})(oc||(oc={}));var ac;(function(s){s[s.Disabled=0]="Disabled",s[s.Never=1]="Never",s[s.Less=2]="Less",s[s.Equal=3]="Equal",s[s.LessEqual=4]="LessEqual",s[s.Greater=5]="Greater",s[s.NotEqual=6]="NotEqual",s[s.GreaterEqual=7]="GreaterEqual",s[s.Always=8]="Always"})(ac||(ac={}));function yM(s){switch(s){case oc.Keep:return $u;case oc.Zero:return Rz;case oc.Replace:return Pz;case oc.IncrementSaturate:return Bz;case oc.DecrementSaturate:return Dz;case oc.IncrementWrap:return Oz;case oc.DecrementWrap:return Lz;case oc.Invert:return kz}return 0}function dce(s){switch(s){case ac.Never:return II;case ac.Less:return Fz;case ac.Equal:return Uz;case ac.LessEqual:return Nz;case ac.Greater:return zz;case ac.NotEqual:return Gz;case ac.GreaterEqual:return Hz;case ac.Always:return Qw}return II}const fce="NEEDLE_render_objects";var ZQ=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Ox=ie("debugreflectionprobe"),s3=ie("noreflectionprobe"),pce=Symbol("reflectionProbeKey"),mce=Symbol("original material"),dc=class extends Te{constructor(){var t;super();u(this,"_texture");u(this,"center");u(this,"size");u(this,"_boxHelper");dc._probes.has(this.context)||dc._probes.set(this.context,[]),(t=dc._probes.get(this.context))==null||t.push(this)}static get(t,i,n,r){if(!t||t.isObject3D!==!0||s3)return null;const o=dc._probes.get(i);if(o){for(const a of o)if(a.__didAwake||a.__internalAwake(),a.enabled&&r&&a.gameObject===r)return a}return Ox&&console.debug("Did not find reflection probe",t.name,n,t),null}set texture(t){if(t&&!(t instanceof Pt)){console.error("ReflectionProbe.texture must be a Texture",t);return}this._texture=t,t&&(t.mapping=bo,t.colorSpace=_t,t.needsUpdate=!0)}get texture(){return this._texture}isInBox(t){var i;return(i=this._boxHelper)==null?void 0:i.isInBox(t)}awake(){this._boxHelper=this.gameObject.addComponent(No),this._boxHelper.updateBox(!0),Ox&&this._boxHelper.showHelper(5592320,!0),this.texture&&(this.texture.mapping=bo,this.texture.colorSpace=_t,this.texture.needsUpdate=!0)}onDestroy(){const t=dc._probes.get(this.context);if(t){const i=t.indexOf(this);i>=0&&t.splice(i,1)}}onSet(t){var n;if(s3||!this.enabled||((n=t.sharedMaterials)==null?void 0:n.length)<=0||!this.texture)return;let i=dc._rendererMaterialsCache.get(t);i||(i=[],dc._rendererMaterialsCache.set(t,i));for(let r=0;r<t.sharedMaterials.length;r++){const o=t.sharedMaterials[r];if(!o||o.envMap===void 0||o instanceof Kt)continue;let a=i[r];const l=o===(a==null?void 0:a.copy),c=!a||a.material.uuid!==o.uuid||a.copy.version!==o.version;if(!l&&c){if(Ox){let f="";a?a.material!==o?f="reference changed; cached instance?: "+l:a.copy.version!==o.version&&(f="version changed"):f="not cached",console.warn("Cloning material",o.name,o.version,"Reason:",f,`
`,o.uuid,`
`,a==null?void 0:a.copy.uuid,`
`,t.name)}const d=o.clone();d.version=o.version,a?(a.copy=d,a.material=o):(a={material:o,copy:d},i.push(a)),d[pce]=this,d[mce]=o,Ox&&console.log("Set reflection",t.name,t.guid)}a&&a.copy&&(a.copy.onBeforeCompile=o.onBeforeCompile);const h=a==null?void 0:a.copy;h.envMap=this.texture,t.sharedMaterials[r]=h}}onUnset(t){const i=dc._rendererMaterialsCache.get(t);if(i)for(let n=0;n<i.length;n++){const r=i[n];t.sharedMaterials[n]=r.material}}};let Bc=dc;u(Bc,"_probes",new Map),u(Bc,"_rendererMaterialsCache",new Map);ZQ([x(w)],Bc.prototype,"center",void 0);ZQ([x(w)],Bc.prototype,"size",void 0);const AM=ie("debugexr");class gce{constructor(e){u(this,"parser");this.parser=e,AM&&console.log(e)}get name(){return"EXT_texture_exr"}loadTexture(e){const t=this.name,i=this.parser,r=i.json.textures[e];if(AM&&console.log("EXT_texture_exr.loadTexture",e,r),!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=new x0(i.options.manager);return AM&&console.log("EXT_texture_exr.loadTexture",o),i.loadTextureImage(e,o.source,a)}}typeof window<"u"&&window.addEventListener("unhandledrejection",s=>{});const wh=qs,Lx="$___Export_Components",vce="NEEDLE_components";var bpe;class yce{constructor(){u(this,bpe)}}bpe=Hf;class Ace{constructor(e,t,i){u(this,"node");u(this,"nodeIndex");u(this,"nodeDef");this.node=e,this.nodeIndex=t,this.nodeDef=i}}class _ce{constructor(){u(this,"parser");u(this,"nodeToObjectMap",{});u(this,"exportContext");u(this,"objectToNodeMap",{});u(this,"context");u(this,"writer")}get name(){return vce}registerExport(e){e.register(t=>{if("serializeUserData"in t){const i=t.serializeUserData.bind(t);this.writer=t,t.serializeUserData=(n,r)=>{try{this.serializeUserData(n,r),i(n,r)}finally{this.afterSerializeUserData(n,r)}}}return this})}beforeParse(){this.exportContext={},this.objectToNodeMap={}}serializeUserData(e,t){var n;const i=(n=e.userData)==null?void 0:n.components;!i||i.length<=0||(delete e.userData.components,e[Lx]=i)}afterSerializeUserData(e,t){if(e.type==="Scene"&&wh&&console.log("DONE",JSON.stringify(t)),e[Lx]===void 0)return;const i=e[Lx];delete e[Lx],i!==null&&(e.userData.components=i)}writeNode(e,t){const i=this.writer.json.nodes.length;wh&&console.log(e.name,i,e.uuid);const n=new Ace(e,i,t);this.exportContext[i]=n,this.objectToNodeMap[e.uuid]=i}afterParse(e){var t;wh&&console.log("AFTER",e);for(const i in this.exportContext){const n=this.exportContext[i],r=n.node,o=n.nodeDef,a=n.nodeIndex,l=(t=r.userData)==null?void 0:t.components;if(!l||l.length<=0)continue;const c=new yce;o.extensions=o.extensions||{},o.extensions[this.name]=c,this.context.object=r,this.context.nodeId=a,this.context.objectToNode=this.objectToNodeMap;const h=[];for(const d of l){this.context.target=d;const f=Fl().writeBuiltinComponentData(d,this.context);f!==null&&h.push(f)}h.length>0&&(c[Hf]=h,wh&&console.log("DID WRITE",r,"nodeIndex",a,h))}}beforeRoot(){return wh&&console.log("BEGIN LOAD"),this.nodeToObjectMap={},null}async afterRoot(e){const t=e.parser,i=t==null?void 0:t.extensions;if(!i)return;const n=i[this.name];wh&&console.log("After root",e,this.parser,i);const r=[];if(n===!0){const o=t.json.nodes;if(o){for(let a=0;a<o.length;a++){const l=await t.getDependency("node",a);this.nodeToObjectMap[a]=l}for(let a=0;a<o.length;a++){const l=o[a],c=a,h=l.extensions;if(!h)continue;const d=h[this.name];if(!d)continue;wh&&console.log("NODE",l);const f=this.nodeToObjectMap[c];if(!f){console.error("Could not find object for node index: "+c,l,t);continue}fE(f),r.push(this.createComponents(f,d))}}}await Promise.all(r);for(const o of t.associations.keys()){const a=t.associations.get(o);if((a==null?void 0:a.materials)!=null){const l="/materials/"+a.materials;wre(o,l)}}}async createComponents(e,t){if(!t)return;const i=t[Hf];if(i){const n=new Array;wh&&console.log(e.name,i);for(const r in i){const o=i[r];wh&&console.log("Serialized data",JSON.parse(JSON.stringify(o))),o&&this.parser&&n.push(PD(this.parser,o).catch(a=>console.error(`Error while resolving references (see console for details)
`,a,e,o))),e.userData=e.userData||{},e.userData[Hf]=e.userData[Hf]||[],e.userData[Hf].push(o)}await Promise.all(n).catch(r=>{console.error("Error while loading components",r)})}}}const r3="NEEDLE_gameobject_data";class bce{constructor(e){u(this,"parser");this.parser=e}get name(){return r3}afterRoot(e){var i;const t=[];for(let n=0;n<((i=this.parser.json.nodes)==null?void 0:i.length);n++){const r=this.parser.json.nodes[n];if(r&&r.extensions){const o=r.extensions[r3];if(o){const a=this.findAndApplyExtensionData(n,o);t.push(a)}}}return Promise.all(t).then(()=>null)}async findAndApplyExtensionData(e,t){const i=await this.parser.getDependency("node",e);i&&this.applyExtensionData(i,t)}applyExtensionData(e,t){t.layers===void 0&&(t.layers=0),e.userData.layer=t.layers,e.layers.disableAll(),e.layers.set(t.layers),e.userData.tag=t.tag??"none",e.userData.hideFlags=t.hideFlags??0,e.userData.static=t.static??!1,e.visible=t.activeSelf??!0,e.guid=t.guid}}const o3="NEEDLE_lighting_settings",eg=ie("debugenvlight");class xce{constructor(e,t,i){u(this,"parser");u(this,"sourceId");u(this,"context");this.parser=e,this.sourceId=t,this.context=i}get name(){return o3}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[o3];if(i){eg&&console.log('Loaded "'+this.name+'", src: "'+this.sourceId+'"',i);let n;if(e.scene.children.length===1){const r=e.scene.children[0];n=ne.addComponent(r,PS,{},{callAwake:!1})}else{const r=new ge;r.name="LightSettings "+this.sourceId,e.scene.add(r),n=ne.addComponent(r,PS,{},{callAwake:!1})}n.sourceId=this.sourceId,n.ambientIntensity=i.ambientIntensity,n.ambientLight=new me().fromArray(i.ambientLight),Array.isArray(i.ambientTrilight)&&(n.ambientTrilight=i.ambientTrilight.map(r=>new me().fromArray(r))),n.ambientMode=i.ambientMode,n.environmentReflectionSource=i.environmentReflectionSource}}return null}}xi.registerCallback(yi.ContextCreated,s=>{const e=s.context,t=ne.findObjectOfType(PS,e);t!=null&&t.sourceId&&(t.enabled=!0)});class PS extends Te{constructor(){super(...arguments);u(this,"ambientMode",Sl.Skybox);u(this,"ambientLight");u(this,"ambientTrilight");u(this,"ambientIntensity",1);u(this,"environmentReflectionSource",rv.Skybox);u(this,"_hasReflection",!1);u(this,"_ambientLightObj");u(this,"_hemisphereLightObj")}awake(){var i;if(this.sourceId){const n=this.environmentReflectionSource===rv.Skybox?Zh.Skybox:Zh.Reflection,r=this.context.lightmaps.tryGet(this.sourceId,n,0);this._hasReflection=r!=null,r&&this.context.sceneLighting.internalRegisterReflection(this.sourceId,r)}this.enabled=!1,this.context.sceneLighting.internalRegisterSceneLightSettings(this),eg&&window.addEventListener("keydown",n=>{if(!this.destroyed)switch(n.key){case"l":this.enabled=!this.enabled;break}});const t=(i=this.gameObject.userData)==null?void 0:i.components;if(t){const n=t.indexOf(this);t.splice(n,1),t.push(this)}}onDestroy(){this.context.sceneLighting.internalUnregisterSceneLightSettings(this)}calculateIntensityFactor(t){const i=Math.max(t.r,t.g,t.b);return 2.2*et.lerp(0,1.33,i)}onEnable(){if(eg&&console.warn("💡🟡 >>> Enable lighting",this.sourceId,this.enabled,this),this.ambientMode==Sl.Flat){if(this.ambientLight&&!this._ambientLightObj){const t=this.calculateIntensityFactor(this.ambientLight);this._ambientLightObj=new GC(this.ambientLight,this.ambientIntensity*t),eg&&console.log("Created ambient light",this.sourceId,this._ambientLightObj,this.ambientIntensity,t)}this._ambientLightObj&&this.gameObject.add(this._ambientLightObj)}else if(this.ambientMode===Sl.Trilight){if(this.ambientTrilight){const t=this.ambientTrilight[0],i=this.ambientTrilight[this.ambientTrilight.length-1],n=this.calculateIntensityFactor(i);this._hemisphereLightObj=new dB(i,t,this.ambientIntensity*n),this.gameObject.add(this._hemisphereLightObj),eg&&console.log("Created hemisphere ambient light",this.sourceId,this._hemisphereLightObj,this.ambientIntensity,n)}}else this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent();this.sourceId&&this.context.sceneLighting.internalEnableReflection(this.sourceId)}onDisable(){eg&&console.warn("💡⚫ <<< Disable lighting:",this.sourceId,this),this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent(),this.sourceId&&this.context.sceneLighting.internalDisableReflection(this.sourceId)}}var a3;(function(s){s[s.Fragment=35632]="Fragment",s[s.Vertex=35633]="Vertex"})(a3||(a3={}));var ZR;(function(s){s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_VEC2=35664]="FLOAT_VEC2",s[s.FLOAT_VEC3=35665]="FLOAT_VEC3",s[s.FLOAT_VEC4=35666]="FLOAT_VEC4",s[s.INT_VEC2=35667]="INT_VEC2",s[s.INT_VEC3=35668]="INT_VEC3",s[s.INT_VEC4=35669]="INT_VEC4",s[s.BOOL=35670]="BOOL",s[s.BOOL_VEC2=35671]="BOOL_VEC2",s[s.BOOL_VEC3=35672]="BOOL_VEC3",s[s.BOOL_VEC4=35673]="BOOL_VEC4",s[s.FLOAT_MAT2=35674]="FLOAT_MAT2",s[s.FLOAT_MAT3=35675]="FLOAT_MAT3",s[s.FLOAT_MAT4=35676]="FLOAT_MAT4",s[s.SAMPLER_2D=35678]="SAMPLER_2D",s[s.SAMPLER_3D=35680]="SAMPLER_3D",s[s.SAMPLER_CUBE=35681]="SAMPLER_CUBE",s[s.UNKNOWN=0]="UNKNOWN"})(ZR||(ZR={}));const lc=ie("debugcustomshader"),zm="NEEDLE_techniques_webgl";var l3;(function(s){s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_VEC2=35664]="FLOAT_VEC2",s[s.FLOAT_VEC3=35665]="FLOAT_VEC3",s[s.FLOAT_VEC4=35666]="FLOAT_VEC4",s[s.INT_VEC2=35667]="INT_VEC2",s[s.INT_VEC3=35668]="INT_VEC3",s[s.INT_VEC4=35669]="INT_VEC4",s[s.BOOL=35670]="BOOL",s[s.BOOL_VEC2=35671]="BOOL_VEC2",s[s.BOOL_VEC3=35672]="BOOL_VEC3",s[s.BOOL_VEC4=35673]="BOOL_VEC4",s[s.FLOAT_MAT2=35674]="FLOAT_MAT2",s[s.FLOAT_MAT3=35675]="FLOAT_MAT3",s[s.FLOAT_MAT4=35676]="FLOAT_MAT4",s[s.SAMPLER_2D=35678]="SAMPLER_2D",s[s.SAMPLER_3D=35680]="SAMPLER_3D",s[s.SAMPLER_CUBE=35681]="SAMPLER_CUBE",s[s.UNKNOWN=0]="UNKNOWN"})(l3||(l3={}));class wce{constructor(){u(this,"objectToWorldMatrix",new fe);u(this,"worldToObjectMatrix",new fe);u(this,"objectToWorld",new Array);u(this,"worldToObject",new Array)}updateFrom(e){this.objectToWorldMatrix.copy(e.matrixWorld),_S(this.objectToWorldMatrix,this.objectToWorld),this.worldToObjectMatrix.copy(e.matrixWorld).invert(),_S(this.worldToObjectMatrix,this.worldToObject)}}var EA;(function(s){s[s.Off=0]="Off",s[s.Front=1]="Front",s[s.Back=2]="Back"})(EA||(EA={}));var Ih;(function(s){s[s.Never=1]="Never",s[s.Less=2]="Less",s[s.Equal=3]="Equal",s[s.LEqual=4]="LEqual",s[s.Greater=5]="Greater",s[s.NotEqual=6]="NotEqual",s[s.GEqual=7]="GEqual",s[s.Always=8]="Always"})(Ih||(Ih={}));const Tn=class extends UC{constructor(t,...i){super(...i);u(this,"identifier");u(this,"onBeforeRenderSceneCallback",this.onBeforeRenderScene.bind(this));u(this,"_sphericalHarmonicsName","unity_SpecCube0");u(this,"_objToWorldName","hlslcc_mtx4x4unity_ObjectToWorld");u(this,"_worldToObjectName","hlslcc_mtx4x4unity_WorldToObject");u(this,"_viewProjectionName","hlslcc_mtx4x4unity_MatrixVP");u(this,"_viewMatrixName","hlslcc_mtx4x4unity_MatrixV");u(this,"_rendererData",new wce);this.identifier=t,lc&&console.log(this),this.type="NEEDLE_CUSTOM_SHADER",this.uniforms[this._objToWorldName]||(this.uniforms[this._objToWorldName]={value:[]}),this.uniforms[this._worldToObjectName]||(this.uniforms[this._worldToObjectName]={value:[]}),this.uniforms[this._viewProjectionName]||(this.uniforms[this._viewProjectionName]={value:[]}),this.uniforms[this._sphericalHarmonicsName],(this.depthTextureUniform||this.opaqueTextureUniform)&&Ot.Current.pre_render_callbacks.push(this.onBeforeRenderSceneCallback)}clone(){const t=super.clone();return $Q(t),t}dispose(){super.dispose();const t=Ot.Current.pre_render_callbacks.indexOf(this.onBeforeRenderSceneCallback);t>=0&&Ot.Current.pre_render_callbacks.splice(t,1)}get depthTextureUniform(){if(this.uniforms)return this.uniforms._CameraDepthTexture}get opaqueTextureUniform(){if(this.uniforms)return this.uniforms._CameraOpaqueTexture}onBeforeRenderScene(){this.opaqueTextureUniform&&Ot.Current.setRequireColor(!0),this.depthTextureUniform&&Ot.Current.setRequireDepth(!0)}onBeforeRender(t,i,n,r,o,a){r.attributes.tangent||r.computeTangents(),this.onUpdateUniforms(n,o)}onUpdateUniforms(t,i){const n=Ot.Current;if(t&&(Tn.viewProjection&&this.uniforms[this._viewProjectionName]&&(Tn.viewProjection.copy(t.projectionMatrix).multiply(t.matrixWorldInverse),_S(Tn.viewProjection,Tn._viewProjectionValues)),Tn.viewMatrix&&this.uniforms[this._viewMatrixName]&&(Tn.viewMatrix.copy(t.matrixWorldInverse),_S(Tn.viewMatrix,Tn._viewMatrixValues)),this.uniforms[Tn._worldSpaceCameraPosName]&&Tn._worldSpaceCameraPos.setFromMatrixPosition(t.matrixWorld)),this.uniforms._TimeParameters&&(this.uniforms._TimeParameters.value=n.sceneLighting.timeVec4),this.uniforms._Time){const l=this.uniforms._Time.value;l.x=n.sceneLighting.timeVec4.x/20,l.y=n.sceneLighting.timeVec4.x,l.z=n.sceneLighting.timeVec4.x*2,l.w=n.sceneLighting.timeVec4.x*3}if(this.uniforms._SinTime){const l=this.uniforms._SinTime.value;l.x=Math.sin(n.sceneLighting.timeVec4.x/8),l.y=Math.sin(n.sceneLighting.timeVec4.x/4),l.z=Math.sin(n.sceneLighting.timeVec4.x/2),l.w=Math.sin(n.sceneLighting.timeVec4.x)}if(this.uniforms._CosTime){const l=this.uniforms._CosTime.value;l.x=Math.cos(n.sceneLighting.timeVec4.x/8),l.y=Math.cos(n.sceneLighting.timeVec4.x/4),l.z=Math.cos(n.sceneLighting.timeVec4.x/2),l.w=Math.cos(n.sceneLighting.timeVec4.x)}if(this.uniforms.unity_DeltaTime){const l=this.uniforms.unity_DeltaTime.value;l.x=n.time.deltaTime,l.y=1/n.time.deltaTime,l.z=n.time.smoothedDeltaTime,l.w=1/n.time.smoothedDeltaTime}const r=n.mainLight;if(r){const l=Qt(r.gameObject,Tn._mainLightPosition);this.uniforms._MainLightPosition={value:l.normalize()},Tn._mainLightColor.set(r.color.r,r.color.g,r.color.b,0),this.uniforms._MainLightColor={value:Tn._mainLightColor};const c=r.intensity;Tn._lightData.z=c,this.uniforms.unity_LightData={value:Tn._lightData}}if(t&&(Tn.viewProjection&&this.uniforms[this._viewProjectionName]&&(this.uniforms[this._viewProjectionName].value=Tn._viewProjectionValues),Tn.viewMatrix&&this.uniforms[this._viewMatrixName]&&(this.uniforms[this._viewMatrixName].value=Tn._viewMatrixValues),this.uniforms[Tn._worldSpaceCameraPosName]&&(this.uniforms[Tn._worldSpaceCameraPosName]={value:Tn._worldSpaceCameraPos}),n.mainCameraComponent)){if(this.uniforms._ProjectionParams){const l=this.uniforms._ProjectionParams.value;l.x=1,l.y=n.mainCameraComponent.nearClipPlane,l.z=n.mainCameraComponent.farClipPlane,l.w=1/l.z,this.uniforms._ProjectionParams.value=l}if(this.uniforms._ZBufferParams){const l=this.uniforms._ZBufferParams.value,c=n.mainCameraComponent;l.x=1-c.farClipPlane/c.nearClipPlane,l.y=c.farClipPlane/c.nearClipPlane,l.z=l.x/c.farClipPlane,l.w=l.y/c.farClipPlane,this.uniforms._ZBufferParams.value=l}if(this.uniforms._ScreenParams){const l=this.uniforms._ScreenParams.value;l.x=n.domWidth,l.y=n.domHeight,l.z=1+1/l.x,l.w=1+1/l.y,this.uniforms._ScreenParams.value=l}if(this.uniforms._ScaledScreenParams){const l=this.uniforms._ScaledScreenParams.value;l.x=n.domWidth,l.y=n.domHeight,l.z=1+1/l.x,l.w=1+1/l.y,this.uniforms._ScaledScreenParams.value=l}}const o=this.depthTextureUniform;o&&(o.value=n.depthTexture);const a=this.opaqueTextureUniform;if(a&&(a.value=n.opaqueColorTexture),i){const l=this._rendererData;l.updateFrom(i),this.uniforms[this._worldToObjectName].value=l.worldToObject,this.uniforms[this._objToWorldName].value=l.objectToWorld}this.uniformsNeedUpdate=!0}};let na=Tn;u(na,"viewProjection",new fe),u(na,"_viewProjectionValues",[]),u(na,"viewMatrix",new fe),u(na,"_viewMatrixValues",[]),u(na,"_worldSpaceCameraPosName","_WorldSpaceCameraPos"),u(na,"_worldSpaceCameraPos",new w),u(na,"_mainLightColor",new Je),u(na,"_mainLightPosition",new w),u(na,"_lightData",new Je);class Sce{constructor(e,t){u(this,"parser");u(this,"identifier");this.parser=e,this.identifier=t}get name(){return zm}loadMaterial(e){const t=this.parser.json.materials[e];if(!t)return lc&&console.log(e,this.parser.json.materials),null;if(!t.extensions||!t.extensions[zm])return lc&&console.log(`Material ${e} does not use NEEDLE_techniques_webgl`),null;lc&&console.log(`Material ${e} uses NEEDLE_techniques_webgl`,t);const i=t.extensions[zm].technique;if(i<0)return console.debug(`Material ${e} does not have a valid technique index`),null;const n=this.parser.json.extensions[zm];if(!n)return lc?console.error("Missing shader data",this.parser.json.extensions):console.debug("Missing custom shader data in parser.json.extensions"),null;lc&&console.log(n);const r=n.techniques[i];return r?new Promise(async(o,a)=>{var g,_,A;const l=await Roe(n,r.program),c=l==null?void 0:l.fragmentShader,h=l==null?void 0:l.vertexShader;if(!c||!h)return a();lc&&console.log("loadMaterial",t,l);const d={},f=r.uniforms;(h.includes("_Time")||c.includes("_Time"))&&(d._Time={value:new Je(0,0,0,0)}),(h.includes("_SinTime")||c.includes("_SinTime"))&&(d._SinTime={value:new Je(0,0,0,0)}),(h.includes("_CosTime")||c.includes("_CosTime"))&&(d._CosTime={value:new Je(0,0,0,0)}),(h.includes("unity_DeltaTime")||c.includes("unity_DeltaTime"))&&(d.unity_DeltaTime={value:new Je(0,0,0,0)});for(const b in f){const E=b;switch(E){case"_TimeParameters":const C=new Je;d[E]={value:C};break;case"hlslcc_mtx4x4unity_MatrixV":case"hlslcc_mtx4x4unity_MatrixVP":d[E]={value:[]};break;case"_MainLightPosition":case"_MainLightColor":case"_WorldSpaceCameraPos":d[E]={value:[0,0,0,1]};break;case"unity_OrthoParams":break;case"unity_SpecCube0":d[E]={value:null};break;default:case"_ScreenParams":case"_ZBufferParams":case"_ProjectionParams":d[E]={value:[0,0,0,0]};break;case"_CameraOpaqueTexture":case"_CameraDepthTexture":d[E]={value:null};break}}let p=!1;if(t.extensions&&t.extensions[zm]){const b=t.extensions[zm];if(b.technique===i){lc&&console.log(t.name,"Material Properties",b);for(const E in b.values){const C=b.values[E];if(typeof C=="string"){if(C.startsWith("/textures/")){const T=C.substring(10),M=Number.parseInt(T);if(M>=0){const R=await this.parser.getDependency("texture",M);R instanceof Pt&&(R.colorSpace=Ui,R.needsUpdate=!0),d[E]={value:R};continue}}switch(E){case"alphaMode":C==="BLEND"&&(p=!0);continue}}if(Array.isArray(C)&&C.length===4){d[E]={value:new Je(C[0],C[1],C[2],C[3])};continue}d[E]={value:C}}}}const m=new na(this.identifier,{name:t.name??"",uniforms:d,vertexShader:h,fragmentShader:c,lights:!1});switch(m.glslVersion=jw,m.vertexShader=m.vertexShader.replace("#version 300 es",""),m.fragmentShader=m.fragmentShader.replace("#version 300 es",""),(g=d._Cull)==null?void 0:g.value){case EA.Off:m.side=Pi;break;case EA.Front:m.side=Gn;break;case EA.Back:m.side=As;break;default:m.side=As;break}switch((_=d._ZTest)==null?void 0:_.value){case Ih.Equal:m.depthTest=!0,m.depthFunc=Hg;break;case Ih.NotEqual:m.depthTest=!0,m.depthFunc=Q0;break;case Ih.Less:m.depthTest=!0,m.depthFunc=qA;break;case Ih.LEqual:m.depthTest=!0,m.depthFunc=Tp;break;case Ih.Greater:m.depthTest=!0,m.depthFunc=dC;break;case Ih.GEqual:m.depthTest=!0,m.depthFunc=uC;break;case Ih.Always:m.depthTest=!1,m.depthFunc=hC;break}m.transparent=p,p&&(m.depthWrite=!1),Moe(d),m.onUpdateUniforms();for(const b in f){const E=b,C=f[b].type;if(((A=d[E])==null?void 0:A.value)===void 0)switch(C){case ZR.SAMPLER_2D:d[E]={value:Eoe},console.warn("Missing/unassigned texture, fallback to white: "+E);break;default:E==="unity_OrthoParams"||console.warn("TODO: EXPECTED UNIFORM / fallback NOT SET: "+E,f[b]);break}}lc&&console.log(m.uuid,d),$Q(m),o(m)}):null}}function $Q(s){if(s.uniforms){lc&&console.log("Uniforms:",s.uniforms);for(const t in s.uniforms)switch(e(t,t),t){case"_Color":e("color",t);break}}function e(t,i){Object.getOwnPropertyDescriptor(s,t)||Object.defineProperty(s,t,{get:()=>s.uniforms[i].value,set:n=>{s.uniforms[i].value=n,s.needsUpdate=!0}})}}const Cce=ie("debugextensions");let BS;const Ece=jc(()=>import("./GLTFLoaderAnimationPointer-291cedcb.js"),[],import.meta.url).then(async s=>(BS=s.GLTFAnimationPointerExtension,BS)).catch(s=>{console.warn("Failed to import GLTFLoaderAnimationPointer. Please use @needle-tools/three for full KHR_animation support",s)}),zp=new Array;function Tce(s){zp.includes(s)||zp.push(s)}function Mce(s){const e=zp.indexOf(s);e>=0&&zp.splice(e,1)}function AO(s){const e=new _ce;return s.register(t=>(e.parser=t,e)),e}class Ice{resolvePath(e){return e.includes("/extensions/builtin_components/")?e.replace("/extensions/builtin_components/","/userData/components/"):e.includes("extensions/builtin_components/")?e.replace("extensions/builtin_components/","/userData/components/"):e}}async function _O(s,e,t){const i=t.indexOf("?");i>=0&&(t=t.substring(0,i)),s.register(n=>new bce(n)),s.register(n=>new Cre(n)),s.register(n=>new xoe(n,e.lightmaps,t)),s.register(n=>new xce(n,t,e)),s.register(n=>new Sce(n,t)),s.register(n=>new CA(n,t)),s.register(n=>new fi(n,t)),s.register(n=>new gce(n)),n5()&&s.register(n=>new gA(n)),await Ece.catch(n=>{}),s.register(n=>{if(BS){const r=new BS(n);return r.setAnimationPointerResolver.bind(r)(new Ice),r}else return(Cce||Xe())&&console.error("Missing KHR_animation_pointer extension..."),{name:"KHR_animation_pointer_NOT_AVAILABLE"}});for(const n of zp)n.onImport&&n.onImport(s,t,e)}function bO(s,e){for(const t of zp)t.onExport&&t.onExport(s,e)}function xO(s,e,t){for(const i of zp)i.onLoaded&&i.onLoaded(s,e,t)}const pl=ie("debuginstancing"),y2=class{constructor(){u(this,"objs",[])}setup(e,t,i,n,r,o=0){e.applySettings(t);const a=this.tryCreateOrAddInstance(t,i,r);if(a){n===null&&(n=[]),n.push(a),fi.assignTextureLOD(a.renderer.material,0);for(const l of e.sharedMeshes){const c=l.geometry;fi.assignMeshLOD(l,0).then(h=>{h&&e.activeAndEnabled&&c!=h&&a.setGeometry(h)})}}else if(o<=0&&t.type!=="Mesh"){const l=o+1;for(const c of t.children)n=this.setup(e,c,i,n,r,l)}return o===0&&r.useMatrixWorldAutoUpdate&&n&&n.length>=0&&this.autoUpdateInstanceMatrix(t),n}tryCreateOrAddInstance(e,t,i){if(e.type==="Mesh"){const n=i.foundMeshes;if(i.foundMeshes+=1,!i.rend.enableInstancing)return null;if(i.rend.enableInstancing!==!0){if(n>=i.rend.enableInstancing.length)return pl&&console.error("Something is wrong with instance setup",e,i.rend.enableInstancing,n),null;if(!i.rend.enableInstancing[n])return null}const r=e,o=r.material;for(const d of this.objs){if(!d.canAdd(r.geometry,o))continue;return d.addInstance(r)}const a=16;let l=e.name;l!=null&&l.length||(l=X4());const c=new e8(l,r.geometry,o,a,t);return this.objs.push(c),c.addInstance(r)}return null}autoUpdateInstanceMatrix(e){const t=e.matrixWorld.multiplyMatrices.bind(e.matrixWorld),i=e.matrixWorld.clone(),n=(r,o)=>{const a=t(r,o);return(e[A0]||i.equals(a)===!1)&&(i.copy(a),e[A0]=!0),a};e.matrixWorld.multiplyMatrices=n}};let wd=y2;u(wd,"instance",new y2);const VA=class{constructor(e,t){u(this,"object");u(this,"renderer");u(this,"__instanceIndex",-1);u(this,"__reservedVertexRange",0);u(this,"__reservedIndexRange",0);u(this,"meshInformation");this.__instanceIndex=-1,this.object=e,this.renderer=t,e[l5]=t,this.meshInformation=tg(e.geometry),VA.all.push(this)}get name(){return this.object.name}get isActive(){return this.__instanceIndex>=0}get vertexCount(){return this.object.geometry.attributes.position.count}get maxVertexCount(){return this.meshInformation.vertexCount}get reservedVertexCount(){return this.__reservedVertexRange}get indexCount(){return this.object.geometry.index?this.object.geometry.index.count:0}get maxIndexCount(){return this.meshInformation.indexCount}get reservedIndexCount(){return this.__reservedIndexRange}updateInstanceMatrix(e=!1,t=!0){this.__instanceIndex<0||(t&&this.object.updateWorldMatrix(!0,e),this.renderer.updateInstance(this.object.matrixWorld,this.__instanceIndex))}setMatrix(e){this.__instanceIndex<0||this.renderer.updateInstance(e,this.__instanceIndex)}setGeometry(e){return this.__instanceIndex<0?!1:this.vertexCount>this.__reservedVertexRange?(console.error(`Cannot update geometry, reserved vertex range is too small: ${this.__reservedVertexRange} < ${this.vertexCount} vertices for ${this.name}`),!1):this.indexCount>this.__reservedIndexRange?(console.error(`Cannot update geometry, reserved index range is too small: ${this.__reservedIndexRange} < ${this.indexCount} indices for ${this.name}`),!1):this.renderer.updateGeometry(e,this.__instanceIndex)}add(){this.__instanceIndex>=0||(this.renderer.add(this),ne.markAsInstancedRendered(this.object,!0))}remove(e){if(!(this.__instanceIndex<0)&&(this.renderer.remove(this,e),ne.markAsInstancedRendered(this.object,!1),e)){const t=VA.all.indexOf(this);t>=0&&VA.all.splice(t,1)}}};let bp=VA;u(bp,"all",[]);class e8{constructor(e,t,i,n,r){u(this,"allowResize",!0);u(this,"name","");u(this,"geometry");u(this,"material");u(this,"_context");u(this,"_batchedMesh");u(this,"_handles",[]);u(this,"_maxInstanceCount");u(this,"_currentInstanceCount",0);u(this,"_currentVertexCount",0);u(this,"_currentIndexCount",0);u(this,"_maxVertexCount");u(this,"_maxIndexCount");u(this,"_needUpdateBounds",!1);u(this,"_debugMaterial",null);u(this,"onBeforeRender",()=>{this._batchedMesh.layers.enableAll(),this._needUpdateBounds&&this._batchedMesh[jy]===!0&&(pl&&console.log("Update instancing bounds",this.name,this._batchedMesh.matrixWorldNeedsUpdate),this.updateBounds())});u(this,"onAfterRender",()=>{this._batchedMesh.layers.disableAll()});u(this,"_availableBuckets",new Array);u(this,"_usedBuckets",new Array);this.name=e,this.geometry=t,this.material=i,this._context=r,this._maxInstanceCount=Math.max(2,n),pl&&(this._debugMaterial=c3());const o=this.tryEstimateVertexCountSize(this._maxInstanceCount,[t],n);this._maxVertexCount=o.vertexCount,this._maxIndexCount=o.indexCount,this._batchedMesh=new Xw(this._maxInstanceCount,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material),this._batchedMesh[jy]=!0,this._batchedMesh.visible=!0,this._context.scene.add(this._batchedMesh),i instanceof UC&&(i.defines.USE_INSTANCING=!0,i.needsUpdate=!0),r.pre_render_callbacks.push(this.onBeforeRender),r.post_render_callbacks.push(this.onAfterRender),pl&&console.log(`Instanced renderer created with ${this._maxInstanceCount} instances, ${this._maxVertexCount} max vertices and ${this._maxIndexCount} max indices for "${e}"`)}get batchedMesh(){return this._batchedMesh}get visible(){return this._batchedMesh.visible}set visible(e){this._batchedMesh.visible=e}get castShadow(){return this._batchedMesh.castShadow}set castShadow(e){this._batchedMesh.castShadow=e}set receiveShadow(e){this._batchedMesh.receiveShadow=e}get count(){return this._currentInstanceCount}updateBounds(e=!0,t=!0){this._needUpdateBounds=!1,e&&this._batchedMesh.computeBoundingBox(),t&&this._batchedMesh.computeBoundingSphere()}canAdd(e,t){return this._maxVertexCount>1e7||t!==this.material||!this.validateGeometry(e)?!1:!!(!this.mustGrow(e)||this.allowResize)}dispose(){pl&&console.warn("Dispose instanced renderer",this.name),this._context.scene.remove(this._batchedMesh),this._batchedMesh.dispose(),this._batchedMesh=null,this._handles=[]}addInstance(e){const t=new bp(e,this);e.castShadow===!0&&this._batchedMesh.castShadow===!1&&(this._batchedMesh.castShadow=!0),e.receiveShadow===!0&&this._batchedMesh.receiveShadow===!1&&(this._batchedMesh.receiveShadow=!0);try{this.add(t)}catch(i){return console.error(`Failed adding mesh to instancing
`,i),Xe()&&eE("Failed instancing mesh. See the browser console for details."),null}return t}add(e){const t=e.object.geometry;if(this.mustGrow(t))if(this.allowResize)this.grow(t);else return console.error("Cannot add instance, max count reached",this.name,this.count,this._maxInstanceCount),!1;return e.object.updateWorldMatrix(!0,!0),this.addGeometry(e),this._handles[e.__instanceIndex]=e,this._currentInstanceCount+=1,this.markNeedsUpdate(),this._currentInstanceCount>0&&(this._batchedMesh.visible=!0),!0}remove(e,t){e&&(e.__instanceIndex<0||this._handles[e.__instanceIndex]!=e||this._currentInstanceCount<=0||(this.removeGeometry(e,t),this._handles[e.__instanceIndex]=null,e.__instanceIndex=-1,this._currentInstanceCount>0&&(this._currentInstanceCount-=1),this._currentInstanceCount<=0&&(this._batchedMesh.visible=!1),this.markNeedsUpdate()))}updateInstance(e,t){this._batchedMesh.setMatrixAt(t,e),this.markNeedsUpdate()}updateGeometry(e,t){return this.validateGeometry(e)?(this.mustGrow()&&this.grow(e),pl&&console.debug("UPDATE MESH",t,e.name,tg(e),e.attributes.position.count,e.index?e.index.count:0),this._batchedMesh.setGeometryAt(t,e),this.markNeedsUpdate(),!0):!1}validateGeometry(e){const t=this.geometry;for(const i in t.attributes)if(i!=="batchId"&&!e.hasAttribute(i))return Xe()&&console.warn(`BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`),!1;return!0}markNeedsUpdate(){pl&&console.warn("Marking instanced mesh dirty",this.name),this._needUpdateBounds=!0}mustGrow(e){if(this.count>=this._maxInstanceCount)return!0;if(!e)return!1;const t=tg(e),i=t.vertexCount,n=t.indexCount;return this._currentVertexCount+i>this._maxVertexCount||this._currentIndexCount+n>this._maxIndexCount}grow(e){const t=this._maxInstanceCount*2,i=this.tryEstimateVertexCountSize(t,[e]),n=Math.max(this._maxVertexCount,i.vertexCount),r=Math.max(this._maxIndexCount,i.indexCount,this._maxVertexCount*2);if(pl){const a=tg(e);console.warn(`Growing batched mesh for "${this.name}/${e.name}" ${a.vertexCount} vertices, ${a.indexCount} indices
Max count ${this._maxInstanceCount} → ${t}
Max vertex count ${this._maxVertexCount} -> ${n}
Max index count ${this._maxIndexCount} -> ${r}`),this._debugMaterial=c3()}this._maxVertexCount=n,this._maxIndexCount=r;const o=new Xw(t,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material);o.layers=this._batchedMesh.layers,o.castShadow=this._batchedMesh.castShadow,o.receiveShadow=this._batchedMesh.receiveShadow,o.visible=this._batchedMesh.visible,o[jy]=this._batchedMesh[jy],o.matrixAutoUpdate=this._batchedMesh.matrixAutoUpdate,o.matrixWorldNeedsUpdate=this._batchedMesh.matrixWorldNeedsUpdate,o.matrixAutoUpdate=this._batchedMesh.matrixAutoUpdate,o.matrixWorld.copy(this._batchedMesh.matrixWorld),o.matrix.copy(this._batchedMesh.matrix),this._batchedMesh.dispose(),this._batchedMesh.removeFromParent(),this._batchedMesh=o,this._maxInstanceCount=t,this._usedBuckets.length=0,this._availableBuckets.length=0;for(const a of this._handles)a&&a.__instanceIndex>=0&&this.addGeometry(a);this._context.scene.add(o)}tryEstimateVertexCountSize(e,t,i=1){const n=new Map;for(const d of this._handles)if(d&&d.__instanceIndex>=0)if(n.has(d.object.geometry)){const f=n.get(d.object.geometry);f.count+=1}else{const f={count:1,...tg(d.object.geometry)};n.set(d.object.geometry,f)}let r=0,o=0;for(const[d,f]of n)r+=f.vertexCount*f.count,o+=f.indexCount*f.count;let l=Math.ceil(r/Math.max(1,this._currentInstanceCount))*e,h=Math.ceil(o/Math.max(1,this._currentInstanceCount))*e*2;if(t)for(const d of t){const f=tg(d);l+=f.vertexCount*i,h+=f.indexCount*i}return{vertexCount:l,indexCount:h}}addGeometry(e){let t=null,i=-1;for(let o=this._availableBuckets.length-1;o>=0;o--){const a=this._availableBuckets[o];a.vertexCount>=e.maxVertexCount&&a.indexCount>=e.maxIndexCount&&(t==null||a.vertexCount<t.vertexCount)&&(t=a,i=o)}if(t!=null){const o=t;pl&&console.debug(`RE-USE SPACE #${o.index}, ${e.maxVertexCount} vertices, ${e.maxIndexCount} indices, ${e.name}`),this._batchedMesh.setGeometryAt(o.index,e.object.geometry),this._batchedMesh.setMatrixAt(o.index,e.object.matrixWorld),this._batchedMesh.setVisibleAt(o.index,!0),e.__instanceIndex=o.index,this._usedBuckets[o.index]=o,this._availableBuckets.splice(i,1);return}const n=e.object.geometry;pl&&console.debug("ADD GEOMETRY",n.name,`
vertex:`,`${this._currentVertexCount} + ${e.maxVertexCount} < ${this._maxVertexCount}?`,`
index:`,e.maxIndexCount,this._currentIndexCount,this._maxIndexCount);const r=this._batchedMesh.addGeometry(n,e.maxVertexCount,e.maxIndexCount);e.__instanceIndex=r,e.__reservedVertexRange=e.maxVertexCount,e.__reservedIndexRange=e.maxIndexCount,this._currentVertexCount+=e.maxVertexCount,this._currentIndexCount+=e.maxIndexCount,this._usedBuckets[r]={index:r,vertexCount:e.maxVertexCount,indexCount:e.maxIndexCount},this._batchedMesh.setMatrixAt(r,e.object.matrixWorld),pl&&console.debug(`ADD MESH & RESERVE SPACE #${r}, ${e.maxVertexCount} vertices, ${e.maxIndexCount} indices, ${e.name} ${e.object.uuid}`)}removeGeometry(e,t){e.__instanceIndex<0||(this._usedBuckets.splice(e.__instanceIndex,1),this._batchedMesh.setVisibleAt(e.__instanceIndex,!1),this._availableBuckets.push({index:e.__instanceIndex,vertexCount:e.reservedVertexCount,indexCount:e.reservedIndexCount}))}}u(e8,"nullMatrix",new fe);function tg(s){let e=s.attributes.position.count,t=s.index?s.index.count:0;const i=fi.getMeshLODInformation(s);if(i){const n=i.lods[0];let r=n.vertexCount,o=n.indexCount;const a=Math.min(128,Math.ceil(r*.15));r+=a,o+=20,e=Math.max(e,r),t=Math.max(t,o)}return e=Math.ceil(e),t=Math.ceil(t),{vertexCount:e,indexCount:t}}function c3(){const s=new ms({color:new me(Math.random(),Math.random(),Math.random())});return s.emissive=s.color,s.emissiveIntensity=.3,ie("wireframe")&&(s.wireframe=!0),s}const Gm=ie("debuglightmaps");class M0{constructor(e,t){u(this,"lightmapIndex",-1);u(this,"lightmapScaleOffset",new Je(1,1,0,0));u(this,"context");u(this,"gameObject");u(this,"lightmapTexture",null);u(this,"lightmapScaleOffsetUniform",{value:new Je(1,1,0,0)});u(this,"lightmapUniform",{value:null});u(this,"onBeforeCompile",(e,t)=>{Gm&&console.log(`Lightmaps, before compile
`,e),this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,this.lightmapUniform.value=this.lightmapTexture,e.uniforms.lightmapScaleOffset=this.lightmapScaleOffsetUniform});this.gameObject=e,this.context=t}get lightmap(){return this.lightmapTexture}set lightmap(e){e!==this.lightmapTexture&&(this.lightmapTexture=e,this.applyLightmap(),this.lightmapTexture&&fi.assignTextureLOD(this.lightmapTexture,0).then(t=>{t!=null&&t.isTexture&&(this.lightmapTexture=t)}))}init(e,t,i){console.assert(this.gameObject!==void 0&&this.gameObject!==null,"Missing gameobject",this),this.lightmapIndex=e,!(this.lightmapIndex<0)&&(this.lightmapScaleOffset=t,this.lightmapTexture=i,fi.assignTextureLOD(i,0).then(n=>{n!=null&&n.isTexture&&(this.lightmapTexture=n)}),Gm=="show"?(console.log("Lightmap:",this.gameObject.name,e,`
ScaleOffset:`,t,`
Texture:`,i),this.setLightmapDebugMaterial()):Gm&&console.log("Use debuglightmaps=show to render lightmaps only in the scene."),this.applyLightmap())}updateLightmapUniforms(e){const t=e.uniforms;t&&t.lightmap&&(this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,t.lightmapScaleOffset=this.lightmapScaleOffsetUniform)}applyLightmap(){if(this.gameObject.type==="Object3D"){Gm&&console.warn("Can not add lightmap. Is this object missing a renderer?",this.gameObject.name);return}if(this.gameObject.type==="Group"){this.gameObject["Needle:Multimaterial-LightmapWarning"]===void 0&&(this.gameObject["Needle:Multimaterial-LightmapWarning"]=!0,console.warn("Lightmap on multimaterial object is not supported yet... please open a feature request on https://github.com/needle-tools/needle-engine-support if your project requires it"));return}console.assert(this.gameObject.type==="Mesh","Lightmap only works on meshes",this);const e=this.gameObject;if(e.geometry.getAttribute("uv1")||e.geometry.setAttribute("uv1",e.geometry.getAttribute("uv")),Array.isArray(this.gameObject.material)){const t=this.gameObject.material;for(let i=0;i<t.length;i++)t[i]=this.ensureLightmapMaterial(t[i])}else this.gameObject.material=this.ensureLightmapMaterial(this.gameObject.material);if(this.lightmapIndex>=0&&this.lightmapTexture){this.lightmapTexture.channel=1;const t=this.gameObject.material;if(Array.isArray(t))for(const i of t)this.assignLightmapTexture(i);else t&&this.assignLightmapTexture(t)}}ensureLightmapMaterial(e){return e.userData||(e.userData={}),e["NEEDLE:lightmap-material-version"]!=e.version&&e["NEEDLE:lightmap-material-version"]==null&&(Gm&&console.warn("Cloning material for lightmap "+e.name),e=e.clone(),e.onBeforeCompile=this.onBeforeCompile),e}assignLightmapTexture(e){!e||e instanceof Qo&&e.transmission>0||!(e.lightMap!==this.lightmapTexture||e["NEEDLE:lightmap-material-version"]!==e.version)||(Gm&&console.log("Assigning lightmap",e.name,e.version),e.lightMap=this.lightmapTexture,e["NEEDLE:lightmap-material-version"]=e.version)}setLightmapDebugMaterial(){this.gameObject.material=new Rt({vertexShader:`
                varying vec2 vUv1;
                void main()
                {
                    vUv1 = uv1;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
                }
                `,fragmentShader:`
                uniform sampler2D lightMap;
                uniform float lightMapIntensity;
                uniform vec4 lightmapScaleOffset;
                varying vec2 vUv1;

                // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
                vec4 conv_sRGBToLinear( in vec4 value ) {
                    return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
                }

                void main() {
                    vec2 lUv = vUv1.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
                    
                    vec4 lightMapTexel = texture2D( lightMap, lUv);
                    gl_FragColor = lightMapTexel;
                    gl_FragColor.a = 1.;
                }
                `,defines:{USE_LIGHTMAP:""}})}}var xu=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Zy=ie("debugrenderer"),h3=ie("debugskinnedmesh"),u3=ie("noinstancing"),Rce=ie("wireframe");var fg;(function(s){s[s.Off=0]="Off",s[s.BlendProbes=1]="BlendProbes",s[s.BlendProbesAndSkybox=2]="BlendProbesAndSkybox",s[s.Simple=3]="Simple"})(fg||(fg={}));class wO{constructor(){u(this,"path",null);u(this,"asset",null);u(this,"default")}}var d3;(function(s){s[s.Both=0]="Both",s[s.Back=1]="Back",s[s.Front=2]="Front"})(d3||(d3={}));class Pce{constructor(e,t){u(this,"_renderer");u(this,"_targets",[]);u(this,"_indexMapMaxIndex");u(this,"_indexMap");u(this,"_changed",!1);this._renderer=e;const i=this.setMaterial.bind(this),n=this.getMaterial.bind(this),r=e.gameObject;if(this._targets=[],r)switch(r.type){case"Group":this._targets=[...r.children];break;case"SkinnedMesh":case"Mesh":this._targets.push(r);break}let o=!1,a,l=0;for(let c=0;c<this._targets.length;c++){const h=this._targets[c];if(!h)continue;const d=h.material;if(d){d.shadowSide=d.side;for(let f=0;f<t.length;f++){const p=t[f];if(!p){o=!0;continue}if(d.name===p.name){a===void 0&&(a=new Map),a.set(f,c),l=Math.max(l,f);break}}}}if(o){this._indexMapMaxIndex=l,this._indexMap=a;const c=`Renderer ${e.name} was initialized with missing materials - this may lead to unexpected behaviour when trying to access sharedMaterials by index.`;console.warn(c),So()&&Yi("Found renderer with missing materials: please check the console for details.")}return new Proxy(this,{get(c,h){if(typeof h=="string"){const d=parseInt(h);if(!isNaN(d))return n(d)}return c[h]},set(c,h,d){return typeof h=="string"&&i(d,Number.parseInt(h)),Reflect.set(c,h,d)?(d instanceof Vt&&(c.changed=!0),!0):!1}})}get changed(){return this._changed}set changed(e){e===!0&&Zy&&console.warn("SharedMaterials have changed: "+this._renderer.name,this),this._changed=e}is(e){return this._renderer===e}get length(){return this._indexMapMaxIndex!==void 0?this._indexMapMaxIndex+1:this._targets.length}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.getMaterial(e)}resolveIndex(e){const t=this._indexMap;return t&&t.has(e)?t.get(e):e}setMaterial(e,t){if(t=this.resolveIndex(t),t<0||t>=this._targets.length)return;const i=this._targets[t];!i||i.material===void 0||(i.material=e,this.changed=!0)}getMaterial(e){if(e=this.resolveIndex(e),e<0)return null;const t=this._targets;if(e>=t.length)return null;const i=t[e];return i?i.material:null}}class dn extends Te{constructor(){super(...arguments);u(this,"receiveShadows",!1);u(this,"shadowCastingMode",DS.Off);u(this,"lightmapIndex",-1);u(this,"lightmapScaleOffset",new Je(1,1,0,0));u(this,"enableInstancing");u(this,"renderOrder");u(this,"allowOcclusionWhenDynamic",!0);u(this,"probeAnchor");u(this,"reflectionProbeUsage",fg.Off);u(this,"_lightmaps");u(this,"_sharedMeshes",[]);u(this,"_sharedMaterials");u(this,"_originalMaterials");u(this,"_probeAnchorLastFrame");u(this,"_lightmapTextureOverride");u(this,"allowProgressiveLoading",!0);u(this,"_firstFrame",-1);u(this,"_isInstancingEnabled",!1);u(this,"_handles");u(this,"_handlesTempArray",[]);u(this,"onBeforeRenderThree",(t,i,n,r,o,a)=>{var l;if(o.envMapIntensity!==void 0){const c=this.hasLightmap?Math.PI:1,h=((l=this.context.mainCameraComponent)==null?void 0:l.environmentIntensity)??1;o.envMapIntensity=Math.max(0,h*this.context.sceneLighting.environmentIntensity/c)}if(this._lightmaps)for(const c of this._lightmaps)c.updateLightmapUniforms(o),c.applyLightmap()});u(this,"_reflectionProbe",null)}static setInstanced(t,i){const n=g_(t,dn);return n.setInstancingEnabled(i),n}static isInstanced(t){const i=Xp(t,dn);return i?i.isInstancingActive:Ya.isUsingInstancing(t)}static setVisible(t,i){rd(t,i)}get sharedMesh(){if(this.gameObject.type==="Mesh")return this.gameObject;if(this.gameObject.type==="SkinnesMesh")return this.gameObject;if(this.gameObject.type==="Group")return this.gameObject.children[0]}get sharedMeshes(){if(this.destroyed||!this.gameObject)return this._sharedMeshes;if(this._sharedMeshes.length=0,this.gameObject.type==="Group")for(const t of this.gameObject.children)(t.type==="Mesh"||t.type==="SkinnedMesh")&&this._sharedMeshes.push(t);else(this.gameObject.type==="Mesh"||this.gameObject.type==="SkinnedMesh")&&this._sharedMeshes.push(this.gameObject);return this._sharedMeshes}get sharedMaterial(){return this.sharedMaterials[0]}set sharedMaterial(t){this.sharedMaterials[0]!==t&&(this.sharedMaterials[0]=t,this.applyLightmapping())}get material(){return this.sharedMaterials[0]}set material(t){this.sharedMaterial=t}set sharedMaterials(t){if(!this._originalMaterials)this._originalMaterials=t;else if(t){let i=!1;for(let n=0;n<this._sharedMaterials.length;n++){const r=n<t.length?t[n]:null;r&&r instanceof Vt?this.sharedMaterials[n]=r:i||(i=!0,console.warn("Can not assign null as material: "+this.name,r))}}}get sharedMaterials(){return(!this._sharedMaterials||!this._sharedMaterials.is(this))&&(this._originalMaterials||(this._originalMaterials=[]),this._sharedMaterials=new Pce(this,this._originalMaterials)),this._sharedMaterials}static get shouldSuppressInstancing(){return u3}get lightmap(){var t;return(t=this._lightmaps)!=null&&t.length?this._lightmaps[0].lightmap:null}set lightmap(t){var i;if(this._lightmapTextureOverride=t,t===void 0&&(t=this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex)),(i=this._lightmaps)!=null&&i.length)for(const n of this._lightmaps)n.lightmap=t}get hasLightmap(){const t=this.lightmap;return t!=null}registering(){this.enabled||this.setVisibility(!1)}awake(){if(this._firstFrame=this.context.time.frame,Zy&&console.log("Renderer ",this.name,this),this.clearInstancingState(),this.probeAnchor&&Zy&&this.probeAnchor.add(new xo(.2)),this._reflectionProbe=null,this.isMultiMaterialObject(this.gameObject)){for(const t of this.gameObject.children)this.context.addBeforeRenderListener(t,this.onBeforeRenderThree),t.layers.mask=this.gameObject.layers.mask;if(this.renderOrder!==void 0){let t=0;for(let i=0;i<this.gameObject.children.length;i++){const n=this.gameObject.children[i];if(!(!this.isMeshOrSkinnedMesh(n)||ne.getComponent(n,dn))){if(this.renderOrder.length<=t){console.warn("Incorrect renderOrder element count",this,this.renderOrder.length+" but expected "+this.gameObject.children.length,"Index: "+t,"ChildElement:",n);continue}n.renderOrder=this.renderOrder[t],t+=1}}}}else this.isMeshOrSkinnedMesh(this.gameObject)?(this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree),this.renderOrder!==void 0&&this.renderOrder.length>0&&(this.gameObject.renderOrder=this.renderOrder[0])):this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree);if(this.applyLightmapping(),Rce)for(let t=0;t<this.sharedMaterials.length;t++){const i=this.sharedMaterials[t];i&&(i.wireframe=!0)}}applyLightmapping(){var t;if(this.lightmapIndex>=0){const i=this.gameObject.type,n=this._lightmapTextureOverride!==void 0?this._lightmapTextureOverride:this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex);if(n){if(this._lightmaps||(this._lightmaps=[]),i==="Mesh"){const r=this.gameObject.material;if(r!=null&&r.isMeshBasicMaterial)r&&console.warn("Lightmapping is not supported on MeshBasicMaterial",r.name);else{if(this._lightmaps.length<=0){const a=new M0(this.gameObject,this.context);this._lightmaps.push(a)}this._lightmaps[0].init(this.lightmapIndex,this.lightmapScaleOffset,n)}}else if(this.isMultiMaterialObject(this.gameObject)&&this.sharedMaterials.length>0)for(let r=0;r<this.gameObject.children.length;r++){const o=this.gameObject.children[r];if(!((t=o.material)!=null&&t.isMeshBasicMaterial)){let a;r>=this._lightmaps.length?(a=new M0(o,this.context),this._lightmaps.push(a)):a=this._lightmaps[r],a.init(this.lightmapIndex,this.lightmapScaleOffset,n)}}}else Zy&&console.warn("Lightmap not found",this.sourceId,this.lightmapIndex)}}get isInstancingActive(){return this._handles!=null&&this._handles.length>0&&this._isInstancingEnabled}get instances(){if(!this._handles||this._handles.length<=0)return null;if(this._handlesTempArray.length=0,this._handles)for(const t of this._handles)this._handlesTempArray.push(t);return this._handlesTempArray}setInstancingEnabled(t){if(this._isInstancingEnabled===t)return t&&(this._handles===void 0||this._handles!=null&&this._handles.length>0);if(this._isInstancingEnabled=t,t){if(this.enableInstancing===void 0&&(this.enableInstancing=!0),this._handles===void 0){if(this._handles=wd.instance.setup(this,this.gameObject,this.context,null,{rend:this,foundMeshes:0,useMatrixWorldAutoUpdate:this.useInstanceMatrixWorldAutoUpdate()}),this._handles)return ne.markAsInstancedRendered(this.gameObject,!0),!0}else if(this._handles!==null){for(const i of this._handles)i.updateInstanceMatrix(!0),i.add();return ne.markAsInstancedRendered(this.gameObject,!0),!0}}else{if(this._handles)for(const i of this._handles)i.remove(this.destroyed);return!0}return!1}clearInstancingState(){this._isInstancingEnabled=!1,this._handles=void 0}useInstanceMatrixWorldAutoUpdate(){return!0}start(){if(this.enableInstancing&&!u3&&(this.setInstancingEnabled(!0),Ya.markDirty(this.gameObject)),this.gameObject.frustumCulled=this.allowOcclusionWhenDynamic,this.isMultiMaterialObject(this.gameObject))for(let t=0;t<this.gameObject.children.length;t++){const i=this.gameObject.children[t];i.frustumCulled=this.allowOcclusionWhenDynamic}}onEnable(){this.sharedMeshes,this.setVisibility(!0),this._isInstancingEnabled||this.enableInstancing==!0||Array.isArray(this.enableInstancing)&&this.enableInstancing.some(i=>i)?this.__internalDidAwakeAndStart&&this.setInstancingEnabled(!0):this.enabled&&this.applyStencil(),this.updateReflectionProbe()}onDisable(){this.setVisibility(!1),this._handles&&this._handles.length>0&&this.setInstancingEnabled(!1)}onDestroy(){if(this._handles=null,this.isMultiMaterialObject(this.gameObject))for(const t of this.gameObject.children)this.context.removeBeforeRenderListener(t,this.onBeforeRenderThree);else this.context.removeBeforeRenderListener(this.gameObject,this.onBeforeRenderThree)}onBeforeRender(){var t,i,n;if(this.gameObject){if(this._probeAnchorLastFrame!==this.probeAnchor&&((t=this._reflectionProbe)==null||t.onUnset(this),this.updateReflectionProbe()),Zy==this.name&&this.gameObject instanceof le){this.gameObject.geometry.computeBoundingSphere();const r=yt(this.gameObject.geometry.boundingSphere.center).applyMatrix4(this.gameObject.matrixWorld);At.DrawWireSphere(r,this.gameObject.geometry.boundingSphere.radius,56831)}if(this.isMultiMaterialObject(this.gameObject)&&((i=this.gameObject.children)==null?void 0:i.length)>0)for(const r of this.gameObject.children)this.applySettings(r);else this.applySettings(this.gameObject);if(this.sharedMaterials.changed&&(this.sharedMaterials.changed=!1,this.applyLightmapping()),(n=this._handles)!=null&&n.length&&this.gameObject[A0]===!0){this.gameObject[A0]=!1;for(let o=this._handles.length-1;o>=0;o--)this._handles[o].updateInstanceMatrix();this.gameObject.matrixWorldNeedsUpdate=!1}if(this._handles&&this._handles.length<=0&&ne.markAsInstancedRendered(this.gameObject,!1),this._isInstancingEnabled&&this._handles)for(let r=0;r<this._handles.length;r++){const o=this._handles[r];rd(o.object,!1)}this.reflectionProbeUsage!==fg.Off&&this._reflectionProbe&&this._reflectionProbe.onSet(this)}}onAfterRender(){if(this._isInstancingEnabled&&this._handles)for(let t=0;t<this._handles.length;t++){const i=this._handles[t];rd(i.object,!0)}this.reflectionProbeUsage!==fg.Off&&this._reflectionProbe&&this._reflectionProbe.onUnset(this),this.static&&this.gameObject.matrixAutoUpdate&&(this.gameObject.matrixAutoUpdate=!1)}applyStencil(){CA.applyStencil(this)}applySettings(t){t.receiveShadow=this.receiveShadows,this.shadowCastingMode==DS.On?t.castShadow=!0:t.castShadow=!1}updateReflectionProbe(){this._reflectionProbe=null,this.reflectionProbeUsage!==fg.Off&&(this.startCoroutine(this._updateReflectionProbe(),Wt.LateUpdate),this._probeAnchorLastFrame=this.probeAnchor)}*_updateReflectionProbe(){const t=this.probeAnchor||this.gameObject,i=!!this.probeAnchor;this._reflectionProbe=Bc.get(t,this.context,i,this.probeAnchor)}setVisibility(t){if(!this.isMultiMaterialObject(this.gameObject))rd(this.gameObject,t);else for(const i of this.gameObject.children)this.isMeshOrSkinnedMesh(i)&&rd(i,t)}isMultiMaterialObject(t){return t.type==="Group"}isMeshOrSkinnedMesh(t){return t.type==="Mesh"||t.type==="SkinnedMesh"}}xu([x()],dn.prototype,"receiveShadows",void 0);xu([x()],dn.prototype,"shadowCastingMode",void 0);xu([x()],dn.prototype,"lightmapIndex",void 0);xu([x(Je)],dn.prototype,"lightmapScaleOffset",void 0);xu([x()],dn.prototype,"enableInstancing",void 0);xu([x()],dn.prototype,"renderOrder",void 0);xu([x()],dn.prototype,"allowOcclusionWhenDynamic",void 0);xu([x(ge)],dn.prototype,"probeAnchor",void 0);xu([x()],dn.prototype,"reflectionProbeUsage",void 0);class U_ extends dn{}class SO extends U_{constructor(){super(...arguments);u(this,"_needUpdateBoundingSphere",!1)}awake(){var t;super.awake(),h3&&console.log('SkinnedMeshRenderer for "'+this.name+'"',this),this.allowOcclusionWhenDynamic=!1;for(const i of this.sharedMeshes)(t=i.parent)==null||t.updateWorldMatrix(!1,!0),this.markBoundsDirty()}onAfterRender(){if(super.onAfterRender(),this._needUpdateBoundingSphere){for(const t of this.sharedMeshes)if(t instanceof ga){this._needUpdateBoundingSphere=!1;const i=t.geometry,n=Wp(t);n&&(t.geometry=n),t.computeBoundingSphere(),t.geometry=i}}if(h3){for(const t of this.sharedMeshes)if(t instanceof ga&&t.boundingSphere){const i=yt(t.boundingSphere.center).applyMatrix4(t.matrixWorld);At.DrawWireSphere(i,t.boundingSphere.radius,"red")}}}markBoundsDirty(){this._needUpdateBoundingSphere=!0}}var DS;(function(s){s[s.Off=0]="Off",s[s.On=1]="On",s[s.TwoSided=2]="TwoSided",s[s.ShadowsOnly=3]="ShadowsOnly"})(DS||(DS={}));var re=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const kx=ie("debugparticles");var vc;(function(s){s[s.Billboard=0]="Billboard",s[s.Stretch=1]="Stretch",s[s.HorizontalBillboard=2]="HorizontalBillboard",s[s.VerticalBillboard=3]="VerticalBillboard",s[s.Mesh=4]="Mesh"})(vc||(vc={}));let $d=class{constructor(){u(this,"alphaKeys",[]);u(this,"colorKeys",[])}get duration(){return 1}evaluate(e,t){let i,n=0,r=null,o=0;for(let a=0;a<this.alphaKeys.length;a++){const l=this.alphaKeys[a];(l.time<e||!i)&&(i=l,n=a)}for(let a=0;a<this.colorKeys.length;a++){const l=this.colorKeys[a];(l.time<e||!r)&&(r=l,o=a)}if(r)if(o+1<this.colorKeys.length){const l=this.colorKeys[o+1],c=et.remap(e,r.time,l.time,0,1);t.r=et.lerp(r.color.r,l.color.r,c),t.g=et.lerp(r.color.g,l.color.g,c),t.b=et.lerp(r.color.b,l.color.b,c)}else t.r=r.color.r,t.g=r.color.g,t.b=r.color.b;if(i)if(n+1<this.alphaKeys.length){const l=this.alphaKeys[n+1],c=et.remap(e,i.time,l.time,0,1);t.alpha=et.lerp(i.alpha,l.alpha,c)}else t.alpha=i.alpha;return t}};re([x()],$d.prototype,"alphaKeys",void 0);re([x()],$d.prototype,"colorKeys",void 0);var ss;(function(s){s[s.Constant=0]="Constant",s[s.Curve=1]="Curve",s[s.TwoCurves=2]="TwoCurves",s[s.TwoConstants=3]="TwoConstants"})(ss||(ss={}));var Rh;(function(s){s[s.Color=0]="Color",s[s.Gradient=1]="Gradient",s[s.TwoColors=2]="TwoColors",s[s.TwoGradients=3]="TwoGradients",s[s.RandomColor=4]="RandomColor"})(Rh||(Rh={}));var Ol;(function(s){s[s.Local=0]="Local",s[s.World=1]="World",s[s.Custom=2]="Custom"})(Ol||(Ol={}));var Nr;(function(s){s[s.Sphere=0]="Sphere",s[s.SphereShell=1]="SphereShell",s[s.Hemisphere=2]="Hemisphere",s[s.HemisphereShell=3]="HemisphereShell",s[s.Cone=4]="Cone",s[s.Box=5]="Box",s[s.Mesh=6]="Mesh",s[s.ConeShell=7]="ConeShell",s[s.ConeVolume=8]="ConeVolume",s[s.ConeVolumeShell=9]="ConeVolumeShell",s[s.Circle=10]="Circle",s[s.CircleEdge=11]="CircleEdge",s[s.SingleSidedEdge=12]="SingleSidedEdge",s[s.MeshRenderer=13]="MeshRenderer",s[s.SkinnedMeshRenderer=14]="SkinnedMeshRenderer",s[s.BoxShell=15]="BoxShell",s[s.BoxEdge=16]="BoxEdge",s[s.Donut=17]="Donut",s[s.Rectangle=18]="Rectangle",s[s.Sprite=19]="Sprite",s[s.SpriteRenderer=20]="SpriteRenderer"})(Nr||(Nr={}));var Wf;(function(s){s[s.Random=0]="Random",s[s.Loop=1]="Loop",s[s.PingPong=2]="PingPong",s[s.BurstSpread=3]="BurstSpread"})(Wf||(Wf={}));class ut{constructor(){u(this,"mode","Constant");u(this,"constant");u(this,"constantMin");u(this,"constantMax");u(this,"curve");u(this,"curveMin");u(this,"curveMax");u(this,"curveMultiplier")}static constant(e){const t=new ut;return t.setConstant(e),t}static betweenTwoConstants(e,t){const i=new ut;return i.setMinMaxConstant(e,t),i}static curve(e,t=1){const i=new ut;return i.setCurve(e,t),i}setConstant(e){this.mode=ss.Constant,this.constant=e}setMinMaxConstant(e,t){this.mode=ss.TwoConstants,this.constantMin=e,this.constantMax=t}setCurve(e,t=1){this.mode=ss.Curve,this.curve=e,this.curveMultiplier=t}clone(){var t,i,n;const e=new ut;return e.mode=this.mode,e.constant=this.constant,e.constantMin=this.constantMin,e.constantMax=this.constantMax,e.curve=(t=this.curve)==null?void 0:t.clone(),e.curveMin=(i=this.curveMin)==null?void 0:i.clone(),e.curveMax=(n=this.curveMax)==null?void 0:n.clone(),e.curveMultiplier=this.curveMultiplier,e}evaluate(e,t){const i=t===void 0?Math.random():t;switch(this.mode){case ss.Constant:case"Constant":return this.constant;case ss.Curve:case"Curve":return e=et.clamp01(e),this.curve.evaluate(e)*this.curveMultiplier;case ss.TwoCurves:case"TwoCurves":const n=e*this.curveMin.duration,r=e*this.curveMax.duration;return et.lerp(this.curveMin.evaluate(n),this.curveMax.evaluate(r),i%1)*this.curveMultiplier;case ss.TwoConstants:case"TwoConstants":return et.lerp(this.constantMin,this.constantMax,i%1);default:this.curveMax.evaluate(e)*this.curveMultiplier;break}return 0}getMax(){switch(this.mode){case ss.Constant:case"Constant":return this.constant;case ss.Curve:case"Curve":return this.getMaxFromCurve(this.curve)*this.curveMultiplier;case ss.TwoCurves:case"TwoCurves":return Math.max(this.getMaxFromCurve(this.curveMin),this.getMaxFromCurve(this.curveMax))*this.curveMultiplier;case ss.TwoConstants:case"TwoConstants":return Math.max(this.constantMin,this.constantMax);default:return 0}}getMaxFromCurve(e){if(!e)return 0;let t=Number.MIN_VALUE;for(let i=0;i<e.keys.length;i++){const n=e.keys[i];n.value>t&&(t=n.value)}return t}}re([x()],ut.prototype,"mode",void 0);re([x()],ut.prototype,"constant",void 0);re([x()],ut.prototype,"constantMin",void 0);re([x()],ut.prototype,"constantMax",void 0);re([x(qa)],ut.prototype,"curve",void 0);re([x(qa)],ut.prototype,"curveMin",void 0);re([x(qa)],ut.prototype,"curveMax",void 0);re([x()],ut.prototype,"curveMultiplier",void 0);const Do=class{constructor(){u(this,"mode",Rh.Color);u(this,"color");u(this,"colorMin");u(this,"colorMax");u(this,"gradient");u(this,"gradientMin");u(this,"gradientMax")}static constant(e){const t=new Do;return t.constant(e),t}static betweenTwoColors(e,t){const i=new Do;return i.betweenTwoColors(e,t),i}constant(e){return this.mode=Rh.Color,this.color=e,this}betweenTwoColors(e,t){return this.mode=Rh.TwoColors,this.colorMin=e,this.colorMax=t,this}evaluate(e,t){const i=t===void 0?Math.random():t;switch(this.mode){case Rh.Color:case"Color":return this.color;case Rh.Gradient:case"Gradient":return this.gradient.evaluate(e,Do._temp),Do._temp;case Rh.TwoColors:case"TwoColors":return Do._temp.lerpColors(this.colorMin,this.colorMax,i);case Rh.TwoGradients:case"TwoGradients":return this.gradientMin.evaluate(e,Do._temp),this.gradientMax.evaluate(e,Do._temp2),Do._temp.lerp(Do._temp2,i)}return Do._temp.set(16711935),Do._temp.alpha=1,Do._temp}};let Ds=Do;u(Ds,"_temp",new Vi(0,0,0,1)),u(Ds,"_temp2",new Vi(0,0,0,1));re([x()],Ds.prototype,"mode",void 0);re([x(Vi)],Ds.prototype,"color",void 0);re([x(Vi)],Ds.prototype,"colorMin",void 0);re([x(Vi)],Ds.prototype,"colorMax",void 0);re([x($d)],Ds.prototype,"gradient",void 0);re([x($d)],Ds.prototype,"gradientMin",void 0);re([x($d)],Ds.prototype,"gradientMax",void 0);var OS;(function(s){s[s.Hierarchy=0]="Hierarchy",s[s.Local=1]="Local",s[s.Shape=2]="Shape"})(OS||(OS={}));class Ir{constructor(){u(this,"cullingMode");u(this,"duration");u(this,"emitterVelocityMode");u(this,"flipRotation");u(this,"gravityModifier");u(this,"gravityModifierMultiplier");u(this,"loop");u(this,"maxParticles");u(this,"playOnAwake");u(this,"prewarm");u(this,"ringBufferLoopRange");u(this,"ringBufferMode");u(this,"scalingMode");u(this,"simulationSpace");u(this,"simulationSpeed");u(this,"startColor");u(this,"startDelay");u(this,"startDelayMultiplier");u(this,"startLifetime");u(this,"startLifetimeMultiplier");u(this,"startRotation");u(this,"startRotationMultiplier");u(this,"startRotation3D");u(this,"startRotationX");u(this,"startRotationXMultiplier");u(this,"startRotationY");u(this,"startRotationYMultiplier");u(this,"startRotationZ");u(this,"startRotationZMultiplier");u(this,"startSize");u(this,"startSize3D");u(this,"startSizeMultiplier");u(this,"startSizeX");u(this,"startSizeXMultiplier");u(this,"startSizeY");u(this,"startSizeYMultiplier");u(this,"startSizeZ");u(this,"startSizeZMultiplier");u(this,"startSpeed");u(this,"startSpeedMultiplier");u(this,"stopAction");u(this,"useUnscaledTime")}}re([x(ut)],Ir.prototype,"gravityModifier",void 0);re([x(Ds)],Ir.prototype,"startColor",void 0);re([x(ut)],Ir.prototype,"startDelay",void 0);re([x(ut)],Ir.prototype,"startLifetime",void 0);re([x(ut)],Ir.prototype,"startRotation",void 0);re([x(ut)],Ir.prototype,"startRotationX",void 0);re([x(ut)],Ir.prototype,"startRotationY",void 0);re([x(ut)],Ir.prototype,"startRotationZ",void 0);re([x(ut)],Ir.prototype,"startSize",void 0);re([x(ut)],Ir.prototype,"startSizeX",void 0);re([x(ut)],Ir.prototype,"startSizeY",void 0);re([x(ut)],Ir.prototype,"startSizeZ",void 0);re([x(ut)],Ir.prototype,"startSpeed",void 0);class I0{constructor(){u(this,"cycleCount");u(this,"maxCount");u(this,"minCount");u(this,"probability");u(this,"repeatInterval");u(this,"time");u(this,"count");u(this,"_performed",0)}reset(){this._performed=0}run(e){if(e<=this.time)return 0;let t=0;if(this.cycleCount===0||this._performed<this.cycleCount){const i=this.time+this.repeatInterval*this._performed;if(e>=i&&(this._performed+=1,Math.random()<this.probability))switch(this.count.mode){case ss.Constant:t=this.count.constant;break;case ss.TwoConstants:t=et.lerp(this.count.constantMin,this.count.constantMax,Math.random());break;case ss.Curve:t=this.count.curve.evaluate(Math.random());break;case ss.TwoCurves:const n=Math.random();t=et.lerp(this.count.curveMin.evaluate(n),this.count.curveMax.evaluate(n),Math.random());break}}return t}}class sh{constructor(){u(this,"enabled");u(this,"bursts");u(this,"rateOverTime");u(this,"rateOverTimeMultiplier");u(this,"rateOverDistance");u(this,"rateOverDistanceMultiplier");u(this,"system")}get burstCount(){var e;return((e=this.bursts)==null?void 0:e.length)??0}reset(){var e;(e=this.bursts)==null||e.forEach(t=>t.reset())}getBurst(){let e=0;if(this.burstCount>0)for(let t=0;t<this.burstCount;t++){const i=this.bursts[t];this.system.main.loop&&i.time>=this.system.time&&i.reset(),e+=Math.round(i.run(this.system.time))}return e}}re([x()],sh.prototype,"enabled",void 0);re([x()],sh.prototype,"bursts",void 0);re([x(ut)],sh.prototype,"rateOverTime",void 0);re([x()],sh.prototype,"rateOverTimeMultiplier",void 0);re([x(ut)],sh.prototype,"rateOverDistance",void 0);re([x()],sh.prototype,"rateOverDistanceMultiplier",void 0);class N_{constructor(){u(this,"enabled");u(this,"color")}}re([x(Ds)],N_.prototype,"color",void 0);class ef{constructor(){u(this,"enabled");u(this,"separateAxes");u(this,"size");u(this,"sizeMultiplier");u(this,"x");u(this,"xMultiplier");u(this,"y");u(this,"yMultiplier");u(this,"z");u(this,"zMultiplier");u(this,"_time",0);u(this,"_temp",new w)}evaluate(e,t,i){if(t||(t=this._temp),!this.enabled)return t.x=t.y=t.z=1,t;if(this.separateAxes)t.x=this.x.evaluate(e,i)*this.xMultiplier,t.y=this.y.evaluate(e,i)*this.yMultiplier,t.z=this.z.evaluate(e,i)*this.zMultiplier;else{const n=this.size.evaluate(e,i)*this.sizeMultiplier;t.x=n}return t}}re([x(ut)],ef.prototype,"size",void 0);re([x(ut)],ef.prototype,"x",void 0);re([x(ut)],ef.prototype,"y",void 0);re([x(ut)],ef.prototype,"z",void 0);var nd;(function(s){s[s.Vertex=0]="Vertex",s[s.Edge=1]="Edge",s[s.Triangle=2]="Triangle"})(nd||(nd={}));const Cg=class{constructor(){u(this,"shapeType",Nr.Box);u(this,"enabled",!0);u(this,"alignToDirection",!1);u(this,"angle",0);u(this,"arc",360);u(this,"arcSpread");u(this,"arcSpeedMultiplier");u(this,"arcMode");u(this,"boxThickness");u(this,"position");u(this,"rotation");u(this,"_rotation",new oi);u(this,"scale");u(this,"radius");u(this,"radiusThickness");u(this,"sphericalDirectionAmount");u(this,"randomDirectionAmount");u(this,"randomPositionAmount");u(this,"meshShapeType");u(this,"meshRenderer");u(this,"_meshObj");u(this,"_meshGeometry");u(this,"system");u(this,"_space");u(this,"_worldSpaceMatrix",new fe);u(this,"_worldSpaceMatrixInverse",new fe);u(this,"_vector",new w(0,0,0));u(this,"_temp",new w(0,0,0));u(this,"_triangle",new mo);u(this,"_dir",new w);u(this,"_loopTime",0);u(this,"_loopDirection",1);kx&&console.log(this)}get type(){return Nr[this.shapeType]}initialize(e){this.onInitialize(e),e.position.copy(this._vector)}toJSON(){return this}clone(){return new Cg}setMesh(e){this.meshRenderer=e,e?(this._meshObj=e.sharedMeshes[Math.floor(Math.random()*e.sharedMeshes.length)],this._meshGeometry=this._meshObj.geometry):(this._meshObj=void 0,this._meshGeometry=void 0)}update(e,t,i,n){this.system=e,this._space=i,i===Ol.World&&(this._worldSpaceMatrix.copy(n.matrixWorld),this._worldSpaceMatrix.elements[0]=1,this._worldSpaceMatrix.elements[5]=1,this._worldSpaceMatrix.elements[10]=1,this._worldSpaceMatrixInverse.copy(this._worldSpaceMatrix).invert())}applyRotation(e){const t=this.rotation.x!==0||this.rotation.y!==0||this.rotation.z!==0;return t&&(this._rotation.x=et.toRadians(this.rotation.x),this._rotation.y=et.toRadians(this.rotation.y),this._rotation.z=et.toRadians(this.rotation.z),this._rotation.order="ZYX",e.applyEuler(this._rotation)),t}onInitialize(e){this._vector.set(0,0,0),e.mesh=void 0,e.mesh_geometry=void 0;const t=this._temp.copy(this.position),i=this._space===Ol.World;i&&t.applyQuaternion(this.system.worldQuaternion);let n=this.radius;if(i&&(n*=this.system.worldScale.x),this.enabled){switch(this.shapeType){case Nr.Box:kx&&At.DrawWireBox(this.position,this.scale,14540253,1),this._vector.x=Math.random()*this.scale.x-this.scale.x/2,this._vector.y=Math.random()*this.scale.y-this.scale.y/2,this._vector.z=Math.random()*this.scale.z-this.scale.z/2,this._vector.add(t);break;case Nr.Cone:this.randomConePoint(this.position,this.angle,n,this.radiusThickness,this.arc,this.arcMode,this._vector);break;case Nr.Sphere:this.randomSpherePoint(this.position,n,this.radiusThickness,this.arc,this._vector);break;case Nr.Circle:this.randomCirclePoint(this.position,n,this.radiusThickness,this.arc,this._vector);break;case Nr.MeshRenderer:const r=this.meshRenderer;(r==null?void 0:r.destroyed)==!1&&this.setMesh(r);const o=e.mesh=this._meshObj,a=e.mesh_geometry=this._meshGeometry;if(o&&a)switch(this.meshShapeType){case nd.Vertex:{const l=a.getAttribute("position"),c=Math.floor(Math.random()*l.count);this._vector.fromBufferAttribute(l,c),this._vector.applyMatrix4(o.matrixWorld),e.mesh_normal=c}break;case nd.Edge:break;case nd.Triangle:{const l=a.index;if(l){let c=Math.random(),h=Math.random();c+h>1&&(c=1-c,h=1-h);const d=Math.floor(Math.random()*(l.count/3));let f=d*3,p=d*3+1,m=d*3+2;f=l.getX(f),p=l.getX(p),m=l.getX(m);const v=a.getAttribute("position");this._triangle.a.fromBufferAttribute(v,f),this._triangle.b.fromBufferAttribute(v,p),this._triangle.c.fromBufferAttribute(v,m),this._vector.set(0,0,0).addScaledVector(this._triangle.a,c).addScaledVector(this._triangle.b,h).addScaledVector(this._triangle.c,1-(c+h)),this._vector.applyMatrix4(o.matrixWorld),e.mesh_normal=d}}break}break;default:this._vector.set(0,0,0),Xe()&&!globalThis.__particlesystem_shapetype_unsupported&&(console.warn("ParticleSystem ShapeType is not supported:",Nr[this.shapeType]),globalThis.__particlesystem_shapetype_unsupported=!0);break}this.randomizePosition(this._vector,this.randomPositionAmount)}this.applyRotation(this._vector),i&&(this._vector.applyQuaternion(this.system.worldQuaternion),this._vector.add(this.system.worldPos)),kx&&At.DrawSphere(this._vector,.03,16711680,.5,!0)}getDirection(e,t){var i;if(!this.enabled)return this._dir.set(0,0,1),this._dir;switch(this.shapeType){case Nr.Box:this._dir.set(0,0,1);break;case Nr.Cone:this._dir.set(0,0,1);break;case Nr.Circle:case Nr.Sphere:const n=t.x,r=t.y,o=t.z;this._dir.set(n,r,o),(i=this.system)!=null&&i.worldspace?this._dir.sub(this.system.worldPos):this._dir.sub(this.position);break;case Nr.MeshRenderer:const a=e.mesh,l=e.mesh_geometry;if(a&&l)switch(this.meshShapeType){case nd.Vertex:{const c=l.getAttribute("normal"),h=e.mesh_normal;this._dir.fromBufferAttribute(c,h)}break;case nd.Edge:break;case nd.Triangle:{const c=l.index;if(c){const h=e.mesh_normal,d=c.getX(h*3),f=c.getX(h*3+1),p=c.getX(h*3+2),m=l.getAttribute("position"),v=yt(),y=yt(),g=yt();v.fromBufferAttribute(m,d),y.fromBufferAttribute(m,f),g.fromBufferAttribute(m,p),v.sub(y),g.sub(y),v.cross(g),this._dir.copy(v).multiplyScalar(-1);const _=qi(a);this._dir.applyQuaternion(_)}}break}break;default:this._dir.set(0,0,1);break}return this._space===Ol.World&&this._dir.applyQuaternion(this.system.worldQuaternion),this.applyRotation(this._dir),this._dir.normalize(),this.spherizeDirection(this._dir,this.sphericalDirectionAmount),this.randomizeDirection(this._dir,this.randomDirectionAmount),kx&&(At.DrawSphere(t,.01,8925952,.5,!0),At.DrawDirection(t,this._dir,8925952,.5,!0)),this._dir}randomizePosition(e,t){if(t<=0)return;const i=Cg._tempVec;i.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1),i.x*=t*this.scale.x,i.y*=t*this.scale.y,i.z*=t*this.scale.z,e.add(i)}randomizeDirection(e,t){if(t===0)return;const i=Cg._randomQuat,n=Cg._tempVec;n.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize(),i.setFromAxisAngle(n,t*Math.random()*Math.PI),e.applyQuaternion(i)}spherizeDirection(e,t){if(t===0)return;const i=Math.random()*Math.PI*2,n=Math.acos(1-Math.random()*2),r=Math.sin(n)*Math.cos(i),o=Math.sin(n)*Math.sin(i),a=Math.cos(n),l=new w(r,o,a);e.lerp(l,t)}randomSpherePoint(e,t,i,n,r){const o=Math.random(),a=Math.random(),l=2*Math.PI*o*(n/360),c=Math.acos(2*a-1),h=et.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*t,d=e.x+this.scale.x*(-h*Math.sin(c)*Math.cos(l)),f=e.y+this.scale.y*(h*Math.sin(c)*Math.sin(l)),p=e.z+this.scale.z*(h*Math.cos(c));r.x=d,r.y=f,r.z=p}randomCirclePoint(e,t,i,n,r){const o=Math.random(),a=2*Math.PI*o*(n/360),l=et.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*t,c=e.x+this.scale.x*l*Math.cos(a),h=e.y+this.scale.y*l*Math.sin(a),d=e.z;r.x=c,r.y=h,r.z=d}randomConePoint(e,t,i,n,r,o,a){let l=0,c=0;switch(o){case Wf.Random:l=Math.random(),c=Math.random();break;case Wf.PingPong:this._loopTime>1&&(this._loopDirection=-1),this._loopTime<0&&(this._loopDirection=1);case Wf.Loop:l=.5,c=Math.random(),this._loopTime+=this.system.deltaTime*this._loopDirection;break}let h=2*Math.PI*l*(r/360);switch(o){case Wf.PingPong:case Wf.Loop:h+=Math.PI+.5,h+=this._loopTime*Math.PI*2,h%=et.toRadians(r);break}const d=Math.acos(2*c-1),f=et.lerp(1,1-Math.pow(1-Math.random(),Math.PI),n)*i,p=e.x+-f*Math.sin(d)*Math.cos(h),m=e.y+f*Math.sin(d)*Math.sin(h),v=e.z;a.x=p*this.scale.x,a.y=m*this.scale.y,a.z=v*this.scale.z}};let en=Cg;u(en,"_randomQuat",new xe),u(en,"_tempVec",new w);re([x()],en.prototype,"shapeType",void 0);re([x()],en.prototype,"enabled",void 0);re([x()],en.prototype,"alignToDirection",void 0);re([x()],en.prototype,"angle",void 0);re([x()],en.prototype,"arc",void 0);re([x()],en.prototype,"arcSpread",void 0);re([x()],en.prototype,"arcSpeedMultiplier",void 0);re([x()],en.prototype,"arcMode",void 0);re([x(w)],en.prototype,"boxThickness",void 0);re([x(w)],en.prototype,"position",void 0);re([x(w)],en.prototype,"rotation",void 0);re([x(w)],en.prototype,"scale",void 0);re([x()],en.prototype,"radius",void 0);re([x()],en.prototype,"radiusThickness",void 0);re([x()],en.prototype,"sphericalDirectionAmount",void 0);re([x()],en.prototype,"randomDirectionAmount",void 0);re([x()],en.prototype,"randomPositionAmount",void 0);re([x()],en.prototype,"meshShapeType",void 0);re([x(U_)],en.prototype,"meshRenderer",void 0);class ji{constructor(){u(this,"damping");u(this,"enabled");u(this,"frequency");u(this,"octaveCount");u(this,"octaveMultiplier");u(this,"octaveScale");u(this,"positionAmount");u(this,"quality");u(this,"remap");u(this,"remapEnabled");u(this,"remapMultiplier");u(this,"remapX");u(this,"remapXMultiplier");u(this,"remapY");u(this,"remapYMultiplier");u(this,"remapZ");u(this,"remapZMultiplier");u(this,"scrollSpeedMultiplier");u(this,"separateAxes");u(this,"strengthMultiplier");u(this,"strengthX");u(this,"strengthXMultiplier");u(this,"strengthY");u(this,"strengthYMultiplier");u(this,"strengthZ");u(this,"strengthZMultiplier");u(this,"_noise");u(this,"_time",0);u(this,"_temp",new w)}update(e){this._time+=e.time.deltaTime*this.scrollSpeedMultiplier}apply(e,t,i,n,r,o){if(!this.enabled)return;this._noise||(this._noise=lce(()=>0));const a=this._temp.set(t.x,t.y,t.z).multiplyScalar(this.frequency),l=this._noise(a.x,a.y,a.z,this._time),c=this._noise(a.x,a.y,a.z,this._time+1e3*this.frequency),h=this._noise(a.x,a.y,a.z,this._time+2e3*this.frequency);this._temp.set(l,c,h).normalize();const d=r/o;let f=this.positionAmount.evaluate(d);this.separateAxes?(this._temp.x*=f*this.strengthXMultiplier,this._temp.y*=f*this.strengthYMultiplier,this._temp.z*=f*this.strengthZMultiplier):(this.strengthX&&(f*=this.strengthX.evaluate(d)*1.5),this._temp.multiplyScalar(f)),i.x+=this._temp.x,i.y+=this._temp.y,i.z+=this._temp.z}}re([x()],ji.prototype,"damping",void 0);re([x()],ji.prototype,"enabled",void 0);re([x()],ji.prototype,"frequency",void 0);re([x()],ji.prototype,"octaveCount",void 0);re([x()],ji.prototype,"octaveMultiplier",void 0);re([x()],ji.prototype,"octaveScale",void 0);re([x(ut)],ji.prototype,"positionAmount",void 0);re([x()],ji.prototype,"quality",void 0);re([x(ut)],ji.prototype,"remap",void 0);re([x()],ji.prototype,"remapEnabled",void 0);re([x()],ji.prototype,"remapMultiplier",void 0);re([x(ut)],ji.prototype,"remapX",void 0);re([x()],ji.prototype,"remapXMultiplier",void 0);re([x(ut)],ji.prototype,"remapY",void 0);re([x()],ji.prototype,"remapYMultiplier",void 0);re([x(ut)],ji.prototype,"remapZ",void 0);re([x()],ji.prototype,"remapZMultiplier",void 0);re([x()],ji.prototype,"scrollSpeedMultiplier",void 0);re([x()],ji.prototype,"separateAxes",void 0);re([x()],ji.prototype,"strengthMultiplier",void 0);re([x(ut)],ji.prototype,"strengthX",void 0);re([x()],ji.prototype,"strengthXMultiplier",void 0);re([x(ut)],ji.prototype,"strengthY",void 0);re([x()],ji.prototype,"strengthYMultiplier",void 0);re([x(ut)],ji.prototype,"strengthZ",void 0);re([x()],ji.prototype,"strengthZMultiplier",void 0);var $R;(function(s){s[s.PerParticle=0]="PerParticle",s[s.Ribbon=1]="Ribbon"})($R||($R={}));var eP;(function(s){s[s.Stretch=0]="Stretch",s[s.Tile=1]="Tile",s[s.DistributePerSegment=2]="DistributePerSegment",s[s.RepeatPerSegment=3]="RepeatPerSegment"})(eP||(eP={}));class Ln{constructor(){u(this,"enabled");u(this,"attachRibbonToTransform",!1);u(this,"colorOverLifetime");u(this,"colorOverTrail");u(this,"dieWithParticles",!0);u(this,"inheritParticleColor",!0);u(this,"lifetime");u(this,"lifetimeMultiplier");u(this,"minVertexDistance",.2);u(this,"mode",$R.PerParticle);u(this,"ratio",1);u(this,"ribbonCount",1);u(this,"shadowBias",0);u(this,"sizeAffectsLifetime",!1);u(this,"sizeAffectsWidth",!1);u(this,"splitSubEmitterRibbons",!1);u(this,"textureMode",eP.Stretch);u(this,"widthOverTrail");u(this,"widthOverTrailMultiplier");u(this,"worldSpace",!1)}getWidth(e,t,i,n){const r=this.widthOverTrail.evaluate(i,n);return e*=r,e}getColor(e,t,i){const n=this.colorOverTrail.evaluate(i),r=this.colorOverLifetime.evaluate(t);e.x*=n.r*r.r,e.y*=n.g*r.g,e.z*=n.b*r.b,"alpha"in n&&"alpha"in r&&(e.w*=n.alpha*r.alpha)}}re([x()],Ln.prototype,"enabled",void 0);re([x()],Ln.prototype,"attachRibbonToTransform",void 0);re([x(Ds)],Ln.prototype,"colorOverLifetime",void 0);re([x(Ds)],Ln.prototype,"colorOverTrail",void 0);re([x()],Ln.prototype,"dieWithParticles",void 0);re([x()],Ln.prototype,"inheritParticleColor",void 0);re([x(ut)],Ln.prototype,"lifetime",void 0);re([x()],Ln.prototype,"lifetimeMultiplier",void 0);re([x()],Ln.prototype,"minVertexDistance",void 0);re([x()],Ln.prototype,"mode",void 0);re([x()],Ln.prototype,"ratio",void 0);re([x()],Ln.prototype,"ribbonCount",void 0);re([x()],Ln.prototype,"shadowBias",void 0);re([x()],Ln.prototype,"sizeAffectsLifetime",void 0);re([x()],Ln.prototype,"sizeAffectsWidth",void 0);re([x()],Ln.prototype,"splitSubEmitterRibbons",void 0);re([x()],Ln.prototype,"textureMode",void 0);re([x(ut)],Ln.prototype,"widthOverTrail",void 0);re([x()],Ln.prototype,"widthOverTrailMultiplier",void 0);re([x()],Ln.prototype,"worldSpace",void 0);class jn{constructor(){u(this,"enabled");u(this,"space",Ol.Local);u(this,"orbitalX");u(this,"orbitalY");u(this,"orbitalZ");u(this,"orbitalXMultiplier");u(this,"orbitalYMultiplier");u(this,"orbitalZMultiplier");u(this,"orbitalOffsetX");u(this,"orbitalOffsetY");u(this,"orbitalOffsetZ");u(this,"speedModifier");u(this,"speedModifierMultiplier");u(this,"x");u(this,"xMultiplier");u(this,"y");u(this,"yMultiplier");u(this,"z");u(this,"zMultiplier");u(this,"_system");u(this,"_temp",new w);u(this,"_temp2",new w);u(this,"_temp3",new w);u(this,"_hasOrbital",!1);u(this,"_index",0);u(this,"_orbitalMatrix",new fe)}update(e){this._system=e}init(e){this._index==0&&(e.debug=!0),this._index+=1,e.orbitx=this.orbitalX.evaluate(Math.random()),e.orbity=this.orbitalY.evaluate(Math.random()),e.orbitz=this.orbitalZ.evaluate(Math.random()),this._hasOrbital=e.orbitx!=0||e.orbity!=0||e.orbitz!=0}apply(e,t,i,n,r,o,a){var p;if(!this.enabled)return;const l=o/a,c=this.speedModifier.evaluate(l)*this.speedModifierMultiplier,h=this.x.evaluate(l),d=this.y.evaluate(l),f=this.z.evaluate(l);if(this._temp.set(-h,d,f),this._system&&this._system.main.simulationSpace===Ol.World&&this._temp.applyQuaternion(this._system.worldQuaternion),this._hasOrbital&&((p=this._system)==null?void 0:p.worldPos)){const v=this._temp2.set(i.x,i.y,i.z),y=this.orbitalXMultiplier,g=this.orbitalYMultiplier,_=this.orbitalZMultiplier,A=c*Math.PI*2*10,b=Math.cos(A*y),E=Math.sin(A*y),C=Math.cos(A*g),T=Math.sin(A*g),M=Math.cos(A*_),R=Math.sin(A*_),S=v.x*(C*M)+v.y*(C*R)+v.z*-T,I=v.x*(E*T*M-b*R)+v.y*(E*T*R+b*M)+v.z*(E*C),L=v.x*(b*T*M+E*R)+v.y*(b*T*R-E*M)+v.z*(b*C),U=this._temp3.set(v.x-S,v.y-I,v.z-L);U.normalize(),U.multiplyScalar(.2/r*Math.max(this.orbitalXMultiplier,this.orbitalYMultiplier,this.orbitalZMultiplier)),n.x+=U.x,n.y+=U.y,n.z+=U.z}n.x+=this._temp.x,n.y+=this._temp.y,n.z+=this._temp.z,n.x*=c,n.y*=c,n.z*=c}}re([x()],jn.prototype,"enabled",void 0);re([x()],jn.prototype,"space",void 0);re([x(ut)],jn.prototype,"orbitalX",void 0);re([x(ut)],jn.prototype,"orbitalY",void 0);re([x(ut)],jn.prototype,"orbitalZ",void 0);re([x()],jn.prototype,"orbitalXMultiplier",void 0);re([x()],jn.prototype,"orbitalYMultiplier",void 0);re([x()],jn.prototype,"orbitalZMultiplier",void 0);re([x()],jn.prototype,"orbitalOffsetX",void 0);re([x()],jn.prototype,"orbitalOffsetY",void 0);re([x()],jn.prototype,"orbitalOffsetZ",void 0);re([x(ut)],jn.prototype,"speedModifier",void 0);re([x()],jn.prototype,"speedModifierMultiplier",void 0);re([x(ut)],jn.prototype,"x",void 0);re([x()],jn.prototype,"xMultiplier",void 0);re([x(ut)],jn.prototype,"y",void 0);re([x()],jn.prototype,"yMultiplier",void 0);re([x(ut)],jn.prototype,"z",void 0);re([x()],jn.prototype,"zMultiplier",void 0);var tP;(function(s){s[s.Lifetime=0]="Lifetime",s[s.Speed=1]="Speed",s[s.FPS=2]="FPS"})(tP||(tP={}));var f3;(function(s){s[s.Grid=0]="Grid",s[s.Sprites=1]="Sprites"})(f3||(f3={}));var p3;(function(s){s[s.Custom=0]="Custom",s[s.Random=1]="Random",s[s.MeshIndex=2]="MeshIndex"})(p3||(p3={}));var m3;(function(s){s[s.WholeSheet=0]="WholeSheet",s[s.SingleRow=1]="SingleRow"})(m3||(m3={}));class Rr{constructor(){u(this,"animation");u(this,"enabled");u(this,"cycleCount");u(this,"frameOverTime");u(this,"frameOverTimeMultiplier");u(this,"numTilesX");u(this,"numTilesY");u(this,"startFrame");u(this,"startFrameMultiplier");u(this,"rowMode");u(this,"rowIndex");u(this,"spriteCount");u(this,"timeMode")}sampleOnceAtStart(){if(this.timeMode===tP.Lifetime)switch(this.frameOverTime.mode){case ss.Constant:case ss.TwoConstants:case ss.TwoCurves:case ss.Curve:return!0}return!1}getStartIndex(){return this.sampleOnceAtStart()?Math.random()*(this.numTilesX*this.numTilesY):0}evaluate(e){if(!this.sampleOnceAtStart())return this.getIndex(e)}getIndex(e){const t=this.numTilesX*this.numTilesY;e=e*this.cycleCount;let i=this.frameOverTime.evaluate(e%1);return i*=this.frameOverTimeMultiplier,i*=t,i=i%t,i=Math.floor(i),i}}re([x()],Rr.prototype,"animation",void 0);re([x()],Rr.prototype,"enabled",void 0);re([x()],Rr.prototype,"cycleCount",void 0);re([x(ut)],Rr.prototype,"frameOverTime",void 0);re([x()],Rr.prototype,"frameOverTimeMultiplier",void 0);re([x()],Rr.prototype,"numTilesX",void 0);re([x()],Rr.prototype,"numTilesY",void 0);re([x(ut)],Rr.prototype,"startFrame",void 0);re([x()],Rr.prototype,"startFrameMultiplier",void 0);re([x()],Rr.prototype,"rowMode",void 0);re([x()],Rr.prototype,"rowIndex",void 0);re([x()],Rr.prototype,"spriteCount",void 0);re([x()],Rr.prototype,"timeMode",void 0);class nl{constructor(){u(this,"enabled");u(this,"separateAxes");u(this,"x");u(this,"xMultiplier");u(this,"y");u(this,"yMultiplier");u(this,"z");u(this,"zMultiplier")}evaluate(e,t){return this.enabled?this.separateAxes?0:this.z.evaluate(e,t)*-1:0}}re([x()],nl.prototype,"enabled",void 0);re([x()],nl.prototype,"separateAxes",void 0);re([x(ut)],nl.prototype,"x",void 0);re([x()],nl.prototype,"xMultiplier",void 0);re([x(ut)],nl.prototype,"y",void 0);re([x()],nl.prototype,"yMultiplier",void 0);re([x(ut)],nl.prototype,"z",void 0);re([x()],nl.prototype,"zMultiplier",void 0);class Ta{constructor(){u(this,"enabled");u(this,"range");u(this,"separateAxes");u(this,"x");u(this,"xMultiplier");u(this,"y");u(this,"yMultiplier");u(this,"z");u(this,"zMultiplier")}evaluate(e,t){if(!this.enabled)return 0;if(!this.separateAxes){const i=et.lerp(this.range.x,this.range.y,t);return this.z.evaluate(i)*-1}return 0}}re([x()],Ta.prototype,"enabled",void 0);re([x()],Ta.prototype,"range",void 0);re([x()],Ta.prototype,"separateAxes",void 0);re([x(ut)],Ta.prototype,"x",void 0);re([x()],Ta.prototype,"xMultiplier",void 0);re([x(ut)],Ta.prototype,"y",void 0);re([x()],Ta.prototype,"yMultiplier",void 0);re([x(ut)],Ta.prototype,"z",void 0);re([x()],Ta.prototype,"zMultiplier",void 0);class ws{constructor(){u(this,"enabled");u(this,"dampen");u(this,"drag");u(this,"dragMultiplier");u(this,"limit");u(this,"limitMultiplier");u(this,"separateAxes");u(this,"limitX");u(this,"limitXMultiplier");u(this,"limitY");u(this,"limitYMultiplier");u(this,"limitZ");u(this,"limitZMultiplier");u(this,"multiplyDragByParticleSize",!1);u(this,"multiplyDragByParticleVelocity",!1);u(this,"space");u(this,"_temp",new w);u(this,"_temp2",new w)}apply(e,t,i,n,r,o,a){if(this.enabled){const l=this.limit.evaluate(r)*this.limitMultiplier;if(t.length()>l){this._temp.copy(t).normalize().multiplyScalar(l);const h=this.dampen*.5;t.x=et.lerp(t.x,this._temp.x,h),t.y=et.lerp(t.y,this._temp.y,h),t.z=et.lerp(t.z,this._temp.z,h),i.x=et.lerp(i.x,this._temp.x,h),i.y=et.lerp(i.y,this._temp.y,h),i.z=et.lerp(i.z,this._temp.z,h)}}}}re([x()],ws.prototype,"enabled",void 0);re([x()],ws.prototype,"dampen",void 0);re([x(ut)],ws.prototype,"drag",void 0);re([x()],ws.prototype,"dragMultiplier",void 0);re([x(ut)],ws.prototype,"limit",void 0);re([x()],ws.prototype,"limitMultiplier",void 0);re([x()],ws.prototype,"separateAxes",void 0);re([x(ut)],ws.prototype,"limitX",void 0);re([x()],ws.prototype,"limitXMultiplier",void 0);re([x(ut)],ws.prototype,"limitY",void 0);re([x()],ws.prototype,"limitYMultiplier",void 0);re([x(ut)],ws.prototype,"limitZ",void 0);re([x()],ws.prototype,"limitZMultiplier",void 0);re([x()],ws.prototype,"multiplyDragByParticleSize",void 0);re([x()],ws.prototype,"multiplyDragByParticleVelocity",void 0);re([x()],ws.prototype,"space",void 0);var LS;(function(s){s[s.Initial=0]="Initial",s[s.Current=1]="Current"})(LS||(LS={}));class rh{constructor(){u(this,"enabled");u(this,"curve");u(this,"curveMultiplier");u(this,"mode");u(this,"system");u(this,"_temp",new w);u(this,"_firstUpdate",!0);u(this,"_frames",0)}clone(){var t;const e=new rh;return e.enabled=this.enabled,e.curve=(t=this.curve)==null?void 0:t.clone(),e.curveMultiplier=this.curveMultiplier,e.mode=this.mode,e}get _lastWorldPosition(){return this.system._iv_lastWorldPosition||(this.system._iv_lastWorldPosition=new w),this.system._iv_lastWorldPosition}get _velocity(){return this.system._iv_velocity||(this.system._iv_velocity=new w),this.system._iv_velocity}awake(e){this.system=e,this.reset()}reset(){this._firstUpdate=!0}update(e){this.enabled&&this.system.worldspace!==!1&&(this._firstUpdate?(this._firstUpdate=!1,this._velocity.set(0,0,0),this._lastWorldPosition.copy(this.system.worldPos)):this._lastWorldPosition&&(this._velocity.copy(this.system.worldPos).sub(this._lastWorldPosition).multiplyScalar(1/this.system.deltaTime),this._lastWorldPosition.copy(this.system.worldPos)))}applyInitial(e){if(this.enabled&&this.system.worldspace!==!1&&this.mode===LS.Initial){const t=this.curve.evaluate(Math.random(),Math.random());this._temp.copy(this._velocity).multiplyScalar(t),e.add(this._temp)}}applyCurrent(e,t,i){if(this.enabled&&this.system&&this.system.worldspace!==!1&&this.mode===LS.Current){const n=this.curve.evaluate(t,i);this._temp.copy(this._velocity).multiplyScalar(n),e.add(this._temp)}}}re([x()],rh.prototype,"enabled",void 0);re([x(ut)],rh.prototype,"curve",void 0);re([x()],rh.prototype,"curveMultiplier",void 0);re([x()],rh.prototype,"mode",void 0);class Mo{constructor(){u(this,"enabled");u(this,"range");u(this,"separateAxes");u(this,"size");u(this,"sizeMultiplier");u(this,"x");u(this,"xMultiplier");u(this,"y");u(this,"yMultiplier");u(this,"z");u(this,"zMultiplier")}evaluate(e,t,i,n){const r=e.length(),o=et.remap(r,this.range.x,this.range.y,0,1),a=this.size.evaluate(o,i);return n*a}}re([x()],Mo.prototype,"enabled",void 0);re([x(Z)],Mo.prototype,"range",void 0);re([x()],Mo.prototype,"separateAxes",void 0);re([x(ut)],Mo.prototype,"size",void 0);re([x()],Mo.prototype,"sizeMultiplier",void 0);re([x(ut)],Mo.prototype,"x",void 0);re([x()],Mo.prototype,"xMultiplier",void 0);re([x(ut)],Mo.prototype,"y",void 0);re([x()],Mo.prototype,"yMultiplier",void 0);re([x(ut)],Mo.prototype,"z",void 0);re([x()],Mo.prototype,"zMultiplier",void 0);class nm{constructor(){u(this,"enabled");u(this,"range");u(this,"color")}evaluate(e,t,i){const n=e.length(),r=et.remap(n,this.range.x,this.range.y,0,1),o=this.color.evaluate(r,t);i.x*=o.r,i.y*=o.g,i.z*=o.b,"alpha"in o&&(i.w*=o.alpha)}}re([x()],nm.prototype,"enabled",void 0);re([x(Z)],nm.prototype,"range",void 0);re([x(Ds)],nm.prototype,"color",void 0);const Bce={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},Dce={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};var Ov=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const wy=ie("debugcontactshadows");YD(s=>{const e=s.domElement.getAttribute("contactshadows");e!=null&&e!="0"&&e!="false"&&Vo.auto(s)});const A2=class extends Te{constructor(){super(...arguments);u(this,"autoFit",!1);u(this,"darkness",.5);u(this,"opacity",.5);u(this,"blur",4);u(this,"occludeBelowGround",!1);u(this,"backfaceShadows",!0);u(this,"minSize");u(this,"shadowsRoot",new ge);u(this,"shadowCamera");u(this,"shadowGroup",new vs);u(this,"renderTarget");u(this,"renderTargetBlur");u(this,"plane");u(this,"occluderMesh");u(this,"blurPlane");u(this,"depthMaterial");u(this,"horizontalBlurMaterial");u(this,"verticalBlurMaterial");u(this,"textureSize",512)}static auto(t){if(t||(t=Ot.Current),!t)throw new Error("No context provided and no current context set.");let i=this._instances.get(t);if(!i||i.destroyed){const n=new ge;i=ya(n,A2,{autoFit:!1,occludeBelowGround:!1}),this._instances.set(t,i)}return t.scene.add(i.gameObject),i.fitShadows(),i}fitShadows(){wy&&console.warn("Fitting shadows to scene"),YI(this.shadowsRoot,!1);const t=Ja(this.context.scene.children,[this.shadowsRoot]),i=Math.max(1,this.blur/32),n=t.max.x-t.min.x,r=t.max.z-t.min.z;t.expandByVector(new w(i*n,0,i*r)),wy&&At.DrawWireBox3(t,16776960,60),this.gameObject.parent&&t.applyMatrix4(this.gameObject.parent.matrixWorld.clone().invert());const o=t.min,a=Math.max(1e-5,(t.max.y-o.y)*.002);t.max.y+=a,this.shadowsRoot.position.set((o.x+t.max.x)/2,o.y-a,(o.z+t.max.z)/2),this.shadowsRoot.scale.set(t.max.x-o.x,t.max.y-o.y,t.max.z-o.z),this.applyMinSize(),this.shadowsRoot.matrixWorldNeedsUpdate=!0,wy&&console.log("Fitted shadows to scene",this.shadowsRoot.scale.clone())}awake(){YI(this.shadowsRoot,!1)}start(){wy&&console.log("Create ContactShadows on "+this.gameObject.name,this),this.gameObject.add(this.shadowsRoot),this.shadowsRoot.add(this.shadowGroup),this.renderTarget=new Yt(this.textureSize,this.textureSize),this.renderTarget.texture.generateMipmaps=!1,this.renderTargetBlur=new Yt(this.textureSize,this.textureSize),this.renderTargetBlur.texture.generateMipmaps=!1;const t=new _s(1,1).rotateX(Math.PI/2);this.gameObject instanceof le&&(console.warn("ContactShadows can not be added to a Mesh. Please add it to a Group or an empty Object"),rd(this.gameObject,!1));const i=new Kt({map:this.renderTarget.texture,opacity:this.opacity,color:0,transparent:!0,depthWrite:!1,side:As});this.plane=new le(t,i),this.plane.scale.y=-1,this.plane.layers.set(2),this.shadowsRoot.add(this.plane),this.plane&&(this.plane.renderOrder=1),this.occluderMesh=new le(this.plane.geometry,new Kt({depthWrite:!0,stencilWrite:!0,colorWrite:!1,side:Gn})).translateY(-1e-4),this.occluderMesh.renderOrder=-100,this.occluderMesh.layers.set(2),this.shadowsRoot.add(this.occluderMesh),this.blurPlane=new le(t),this.blurPlane.visible=!1,this.shadowGroup.add(this.blurPlane);const n=0,r=1;this.shadowCamera=new Nl(-1/2,1/2,1/2,-1/2,n,r),this.shadowCamera.layers.enableAll(),this.shadowCamera.rotation.x=Math.PI/2,this.shadowGroup.add(this.shadowCamera),this.depthMaterial=new J0,this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.blending=TP,this.depthMaterial.blendEquation=Lw,this.depthMaterial.onBeforeCompile=o=>{this.depthMaterial&&(o.uniforms.darkness=this.depthMaterial.userData.darkness,o.fragmentShader=`
                uniform float darkness;
                ${o.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 ), ( 1.0 - fragCoordZ ) * darkness * opacity * (gl_FrontFacing ? 1.0 : 0.66) );")}
            `)},this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1,this.horizontalBlurMaterial=new Rt(Bce),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial=new Rt(Dce),this.verticalBlurMaterial.depthTest=!1,this.shadowGroup.visible=!1,this.autoFit?this.fitShadows():this.applyMinSize()}onDestroy(){var t,i,n,r,o,a,l,c;(t=this.renderTarget)==null||t.dispose(),(i=this.renderTargetBlur)==null||i.dispose(),(n=this.depthMaterial)==null||n.dispose(),(r=this.horizontalBlurMaterial)==null||r.dispose(),(o=this.verticalBlurMaterial)==null||o.dispose(),(a=this.blurPlane)==null||a.geometry.dispose(),(l=this.plane)==null||l.geometry.dispose(),(c=this.occluderMesh)==null||c.geometry.dispose()}onBeforeRender(t){if(!this.renderTarget||!this.renderTargetBlur||!this.depthMaterial||!this.shadowCamera||!this.blurPlane||!this.shadowGroup||!this.plane||!this.horizontalBlurMaterial||!this.verticalBlurMaterial){wy&&console.error("ContactShadows: not initialized yet");return}const i=this.context.scene,n=this.context.renderer,r=n.getRenderTarget();this.shadowGroup.visible=!0,this.occluderMesh&&(this.occluderMesh.visible=!1);const o=this.plane.visible;this.plane.visible=!1,this.gameObject instanceof le&&rd(this.gameObject,!1);const a=i.background;i.background=null,i.overrideMaterial=this.depthMaterial,this.backfaceShadows?this.depthMaterial.side=Pi:this.depthMaterial.side=As;const l=n.getClearAlpha();n.setClearAlpha(0);const c=n.xr.enabled;n.xr.enabled=!1;const h=this.context.scene.matrixWorldAutoUpdate;this.context.scene.matrixWorldAutoUpdate=!1;const d=n.renderLists.get(i,0),f=d.transparent;g3.length=0,d.transparent=g3,_M.length=0;for(const m of d.opaque){if(!m.object.visible)continue;const v=m.material;let y=m.material.colorWrite==!1||v.wireframe===!0||tH(m.object)===!1;!y&&m.material.linewidth!=null&&(y=!0),y&&(_M.push(m.object),m.object["needle:visible"]=m.object.visible,m.object.visible=!1)}n.setRenderTarget(this.renderTarget),n.clear(),n.render(i,this.shadowCamera),d.transparent=f;for(const m of _M)m["needle:visible"]!=null&&(m.visible=m["needle:visible"]);i.overrideMaterial=null;const p=Math.max(this.blur,.05);this.blurShadow(p*2),this.blurShadow(p*.5),this.shadowGroup.visible=!1,this.occluderMesh&&(this.occluderMesh.visible=this.occludeBelowGround),this.plane.visible=o,n.setRenderTarget(r),n.setClearAlpha(l),i.background=a,n.xr.enabled=c,this.context.scene.matrixWorldAutoUpdate=h}blurShadow(t){if(!this.blurPlane||!this.shadowCamera||!this.renderTarget||!this.renderTargetBlur||!this.horizontalBlurMaterial||!this.verticalBlurMaterial)return;this.blurPlane.visible=!0;const i=this.shadowsRoot.worldScale,n=(i.x+i.z)/2,r=i.z/n,o=i.x/n;this.blurPlane.material=this.horizontalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=t*1/this.textureSize*r;const a=this.context.renderer,l=a.getRenderTarget();a.setRenderTarget(this.renderTargetBlur),a.render(this.blurPlane,this.shadowCamera),this.blurPlane.material=this.verticalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=t*1/this.textureSize*o,a.setRenderTarget(this.renderTarget),a.render(this.blurPlane,this.shadowCamera),this.blurPlane.visible=!1,a.setRenderTarget(l)}applyMinSize(){this.minSize&&this.shadowsRoot.scale.set(Math.max(this.minSize.x||0,this.shadowsRoot.scale.x),Math.max(this.minSize.y||0,this.shadowsRoot.scale.y),Math.max(this.minSize.z||0,this.shadowsRoot.scale.z))}};let Vo=A2;u(Vo,"_instances",new Map);Ov([x()],Vo.prototype,"autoFit",void 0);Ov([x()],Vo.prototype,"darkness",void 0);Ov([x()],Vo.prototype,"opacity",void 0);Ov([x()],Vo.prototype,"blur",void 0);Ov([x()],Vo.prototype,"occludeBelowGround",void 0);Ov([x()],Vo.prototype,"backfaceShadows",void 0);const g3=[],_M=new Array,_2=class{constructor(){u(this,"_quicklookButton");u(this,"_arButton");u(this,"_vrButton");u(this,"_sendToQuestButton")}static create(){return new _2}static getOrCreate(){return this._instance||(this._instance=this.create()),this._instance}get isSecureConnection(){return window.location.protocol==="https:"}get quicklookButton(){return this._quicklookButton}get arButton(){return this._arButton}get vrButton(){return this._vrButton}get sendToQuestButton(){return this._sendToQuestButton}get qrButton(){return Ml.getOrCreate().createQRCode()}createQuicklookButton(){if(this._quicklookButton)return this._quicklookButton;const e=document.createElement("button");this._quicklookButton=e,e.dataset.needle="quicklook-button";const t=St.supportsQuickLookAR();e.innerText="View in AR",e.prepend(br("view_in_ar"));let i=!1,n=null;return e.addEventListener("click",()=>{n=dE(tn),n||(i=!0,n=new tn),i&&(n.objectToExport=Ot.Current.scene),n?(e.classList.add("this-mode-is-requested"),n.exportAndOpen().then(()=>{e.classList.remove("this-mode-is-requested")}).catch(r=>{e.classList.remove("this-mode-is-requested"),console.error(r)})):console.warn("No USDZExporter component found in the scene")}),this.hideElementDuringXRSession(e),e}createARButton(e){var n;if(this._arButton)return this._arButton;const t="immersive-ar",i=document.createElement("button");return this._arButton=i,i.classList.add("webxr-button"),i.dataset.needle="webxr-ar-button",i.innerText="Enter AR",i.prepend(br("view_in_ar")),i.title="Click to start an AR session",i.addEventListener("click",()=>It.start(t,e)),this.updateSessionSupported(i,t),this.listenToXRSessionState(i,t),this.hideElementDuringXRSession(i),this.isSecureConnection||(i.disabled=!0,i.title="WebXR requires a secure connection (HTTPS)"),St.isMozillaXR()||(n=navigator.xr)==null||n.addEventListener("devicechange",()=>this.updateSessionSupported(i,t)),i}createVRButton(e){var n;if(this._vrButton)return this._vrButton;const t="immersive-vr",i=document.createElement("button");return this._vrButton=i,i.classList.add("webxr-button"),i.dataset.needle="webxr-vr-button",i.innerText="Enter VR",i.prepend(br("panorama_photosphere")),i.title="Click to start a VR session",i.addEventListener("click",()=>It.start(t,e)),this.updateSessionSupported(i,t),this.listenToXRSessionState(i,t),this.hideElementDuringXRSession(i),this.isSecureConnection||(i.disabled=!0,i.title="WebXR requires a secure connection (HTTPS)"),St.isMozillaXR()||(n=navigator.xr)==null||n.addEventListener("devicechange",()=>this.updateSessionSupported(i,t)),i}createSendToQuestButton(){var i;if(this._sendToQuestButton)return this._sendToQuestButton;const e="https://oculus.com/open_url/?url=",t=document.createElement("button");return this._sendToQuestButton=t,t.dataset.needle="webxr-sendtoquest-button",t.innerText="Open on Quest",t.prepend(br("share_windows")),t.title="Click to send this page to the Oculus Browser on your Quest",t.addEventListener("click",()=>{const n=encodeURIComponent(window.location.href),r=e+n;window.open(r)==null&&Pn("This page doesn't allow popups. Please paste "+r+" into your browser.")}),this.listenToXRSessionState(t),this.hideElementDuringXRSession(t),St.isMozillaXR()||(i=navigator.xr)==null||i.addEventListener("devicechange",()=>{var n;(n=navigator.xr)!=null&&n.isSessionSupported("immersive-vr")?t.style.display="none":t.style.display=""}),t}createQRCode(){return Ml.getOrCreate().createQRCode()}updateSessionSupported(e,t){if(!("xr"in navigator)){e.style.display="none";return}It.isSessionSupported(t).then(i=>{e.style.display=i?"":"none",Xe()&&!i&&console.log('[WebXR] "'+t+'" is not supported on this device – make sure your server runs using HTTPS and you have a device connected that supports '+t)})}hideElementDuringXRSession(e){oE(t=>{e["previous-display"]=e.style.display,e.style.display="none"}),uD(t=>{e["previous-display"]!=null&&(e.style.display=e["previous-display"])})}listenToXRSessionState(e,t){t&&(It.onSessionRequestStart(i=>{i.mode===t?e.classList.add("this-mode-is-requested"):(e["was-disabled"]=e.disabled,e.disabled=!0,e.classList.add("other-mode-is-requested"))}),It.onSessionRequestEnd(i=>{e.classList.remove("this-mode-is-requested"),e.classList.remove("other-mode-is-requested"),e.disabled=e["was-disabled"]}))}};let lu=_2;u(lu,"_instance");var tr=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const kS=ie("debugspriterenderer"),Oce=ie("wireframe"),nC=class{static getOrCreateGeometry(e){if(e.__cached_geometry)return e.__cached_geometry;if(e.guid&&nC.cache[e.guid])return kS&&console.log("Take cached geometry for sprite",e.guid),nC.cache[e.guid];const t=new pt;e.__cached_geometry=t;const i=new Float32Array(e.triangles.length*3),n=new Float32Array(e.triangles.length*2);for(let r=0;r<e.triangles.length;r+=1){const o=e.triangles[r];i[r*3]=-e.vertices[o].x,i[r*3+1]=e.vertices[o].y,i[r*3+2]=0;const a=e.uv[o];n[r*2]=a.x,n[r*2+1]=1-a.y}return t.setAttribute("position",new ot(i,3)),t.setAttribute("uv",new ot(n,2)),e.guid&&(this.cache[e.guid]=t),kS&&console.log("Built sprite geometry",e,t),t}};let xp=nC;u(xp,"cache",{});var FS;(function(s){s[s.Simple=0]="Simple",s[s.Sliced=1]="Sliced",s[s.Tiled=2]="Tiled"})(FS||(FS={}));class Lce{constructor(){u(this,"x");u(this,"y")}}function t8(s){s&&(s.colorSpace!=_t&&(s.colorSpace=_t,s.needsUpdate=!0),s.minFilter==ei&&s.magFilter==ei&&(s.anisotropy=1,s.needsUpdate=!0))}class oh{constructor(e){u(this,"guid");u(this,"texture");u(this,"triangles");u(this,"uv");u(this,"vertices");u(this,"__cached_geometry");u(this,"_mesh");u(this,"_material");e&&(this.texture=e,this.triangles=[0,1,2,0,2,3],this.uv=[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],this.vertices=[{x:-.5,y:-.5},{x:.5,y:-.5},{x:.5,y:.5},{x:-.5,y:.5}])}get mesh(){return this._mesh||(this._mesh=new le(xp.getOrCreateGeometry(this),this.material)),this._mesh}get material(){return this._material||(this.texture&&t8(this.texture),this._material=new Kt({map:this.texture,color:16777215,side:Pi,transparent:!0})),this._material}getGeometry(){return xp.getOrCreateGeometry(this)}}tr([x()],oh.prototype,"guid",void 0);tr([x(Pt)],oh.prototype,"texture",void 0);tr([Cv()],oh.prototype,"triangles",void 0);tr([Cv()],oh.prototype,"uv",void 0);tr([Cv()],oh.prototype,"vertices",void 0);const bM=Symbol("spriteOwner");class Ld{constructor(){u(this,"sprites")}}tr([x(oh)],Ld.prototype,"sprites",void 0);class Ll{constructor(){u(this,"spriteSheet");u(this,"index",0)}static create(){const e=new Ll;return e.spriteSheet=new Ld,e}set sprite(e){e&&(this.spriteSheet?((this.index===null||this.index===void 0)&&(this.index=0),this.spriteSheet.sprites[this.index]=e):(this.spriteSheet=new Ld,this.spriteSheet.sprites=[e],this.index=0))}get sprite(){if(this.spriteSheet)return this.spriteSheet.sprites[this.index]}update(e){if(!this.spriteSheet)return;const t=this.index;if(t<0||t>=this.spriteSheet.sprites.length)return;const i=this.spriteSheet.sprites[t],n=i==null?void 0:i.texture;if(n&&(t8(n),!i.__hasLoadedProgressive)){i.__hasLoadedProgressive=!0;const r=n;fi.assignTextureLOD(n,0).then(o=>{o instanceof Pt&&(i.texture=o,(e==null?void 0:e.map)===r&&(e.map=o,e.needsUpdate=!0))})}}}tr([x(Ld)],Ll.prototype,"spriteSheet",void 0);tr([x()],Ll.prototype,"index",void 0);class Yo extends Te{constructor(){super(...arguments);u(this,"drawMode",FS.Simple);u(this,"size",{x:1,y:1});u(this,"color");u(this,"sharedMaterial");u(this,"transparent",!0);u(this,"cutoutThreshold",0);u(this,"castShadows",!1);u(this,"renderOrder",0);u(this,"toneMapped",!0);u(this,"_spriteSheet");u(this,"_currentSprite")}set texture(t){var n;if(!this._spriteSheet)return;const i=(n=this._spriteSheet.spriteSheet)==null?void 0:n.sprites[this.spriteIndex];i&&(i.texture=t,this.updateSprite())}addSprite(t,i=!1){var r,o;if(this._spriteSheet||(this._spriteSheet=Ll.create()),!this._spriteSheet.spriteSheet)return-1;(r=this._spriteSheet.spriteSheet)==null||r.sprites.push(t);const n=((o=this._spriteSheet.spriteSheet)==null?void 0:o.sprites.length)-1;return i&&(this.spriteIndex=n),n}get sprite(){return this._spriteSheet}set sprite(t){if(t!==this._spriteSheet)if(typeof t=="number"){const i=Math.floor(t);this.spriteIndex=i;return}else t instanceof oh?(this._spriteSheet||(this._spriteSheet=Ll.create()),this._spriteSheet.sprite!=t&&(this._spriteSheet.sprite=t,this.updateSprite())):t!=this._spriteSheet&&(this._spriteSheet=t,this.updateSprite())}set spriteIndex(t){this._spriteSheet&&t!==this.spriteIndex&&(this._spriteSheet.index=t,this.updateSprite())}get spriteIndex(){var t;return((t=this._spriteSheet)==null?void 0:t.index)??0}get spriteFrames(){var t,i;return((i=(t=this._spriteSheet)==null?void 0:t.spriteSheet)==null?void 0:i.sprites.length)??0}awake(){this._currentSprite=void 0,this._spriteSheet||(this._spriteSheet=new Ll,this._spriteSheet.spriteSheet=new Ld),kS&&console.log("Awake",this.name,this,this.sprite)}start(){this._currentSprite?this.gameObject&&this.gameObject.add(this._currentSprite):this.updateSprite()}updateSprite(t=!1){var r;if(!this.__didAwake&&!t)return!1;const i=this._spriteSheet;if(!((r=i==null?void 0:i.spriteSheet)!=null&&r.sprites))return console.warn("SpriteRenderer has no data or spritesheet assigned..."),!1;const n=i.spriteSheet.sprites[this.spriteIndex];if(!n)return kS&&console.warn("Sprite not found",this.spriteIndex,i.spriteSheet.sprites),!1;if(this._currentSprite)this._currentSprite.geometry=xp.getOrCreateGeometry(n),this._currentSprite.material.map=n.texture;else{const o=new Kt({color:16777215,side:Pi});if(Oce&&(o.wireframe=!0),this.color&&(o.color||(o.color=new me),o.color.copy(this.color),o.opacity=this.color.alpha),o.transparent=!0,o.toneMapped=this.toneMapped,n.texture&&!o.wireframe){let a=n.texture;a[bM]!==void 0&&a[bM]!==this&&this.spriteFrames>1&&(a=n.texture=a.clone()),a[bM]=this,o.map=a}this.sharedMaterial=o,this._currentSprite=new le(xp.getOrCreateGeometry(n),o),this._currentSprite.renderOrder=Math.round(this.renderOrder),fi.assignTextureLOD(o,0)}return this._currentSprite.parent!==this.gameObject&&(this.drawMode===FS.Tiled&&this._currentSprite.scale.set(this.size.x,this.size.y,1),this.gameObject&&this.gameObject.add(this._currentSprite)),this._currentSprite&&this._currentSprite.layers.set(this.layer),this.sharedMaterial&&(this.sharedMaterial.alphaTest=this.cutoutThreshold,this.sharedMaterial.transparent=this.transparent),this._currentSprite.castShadow=this.castShadows,i==null||i.update(this.sharedMaterial),!0}}tr([x()],Yo.prototype,"drawMode",void 0);tr([x(Lce)],Yo.prototype,"size",void 0);tr([x(Vi)],Yo.prototype,"color",void 0);tr([x(Vt)],Yo.prototype,"sharedMaterial",void 0);tr([x()],Yo.prototype,"transparent",void 0);tr([x()],Yo.prototype,"cutoutThreshold",void 0);tr([x()],Yo.prototype,"castShadows",void 0);tr([x()],Yo.prototype,"renderOrder",void 0);tr([x()],Yo.prototype,"toneMapped",void 0);tr([x(Ll)],Yo.prototype,"sprite",null);const v3=ie("debugwebxr"),kce=new fe().makeRotationY(Math.PI);class gu extends Te{constructor(){super(...arguments);u(this,"_arScale",1);u(this,"invertForward",!1);u(this,"customReticle");u(this,"arTouchTransform",!0);u(this,"autoPlace",!1);u(this,"autoCenter",!1);u(this,"useXRAnchor",!1);u(this,"_isPlacing",!0);u(this,"_startOffset",new fe);u(this,"_createdPlacementObject",null);u(this,"_reparentedComponents",[]);u(this,"_placementScene",new Ks);u(this,"_reticle",[]);u(this,"_hits",[]);u(this,"_placementStartTime",-1);u(this,"_rigPlacementMatrix");u(this,"_anchor",null);u(this,"userInput");u(this,"onPlaceScene",t=>{var r;if(this._isPlacing==!1||t!=null&&t.used)return;let i=this._reticle[0];if(!i){console.warn("No reticle to place...");return}if(!i.visible&&!this.autoPlace){console.warn("Reticle is not visible (can not place)");return}if((r=It.active)!=null&&r.isTrackingImages){console.warn("Scene Placement is disabled while images are being tracked");return}let n=this._hits[0];if(t&&t.origin instanceof dD){const o=this._reticle[t.origin.index];o&&(i=o,n=this._hits[t.origin.index])}if(t&&(t.stopImmediatePropagation(),t.stopPropagation(),t.use()),this._isPlacing=!1,this.context.input.removeEventListener("pointerup",this.onPlaceScene),this.onRevertSceneChanges(),i.position.copy(i.lastPos),i.quaternion.copy(i.lastQuat),this.onApplyPose(i),this.useXRAnchor&&this.onCreateAnchor(It.active,n),this.context.xr)for(const o of this.context.xr.controllers)o.cancelHitTestSource()});u(this,"upVec",new w(0,1,0));u(this,"lookPoint",new w);u(this,"worldUpVec",new w(0,1,0))}static onPlaced(t){const i="placed";return this._eventListeners[i]||(this._eventListeners[i]=[]),this._eventListeners[i].push(t),()=>{const n=this._eventListeners[i].indexOf(t);n>=0&&this._eventListeners[i].splice(n,1)}}get arScale(){return this._arScale}set arScale(t){t!==this._arScale&&(this._arScale=t,this.onScaleChanged())}onEnable(){var t;(t=this.customReticle)==null||t.preload()}supportsXR(t){return t==="immersive-ar"}onEnterXR(t){v3&&console.log("ENTER WEBXR: SessionRoot start..."),this._anchor=null,this.gameObject.updateMatrixWorld(),this._startOffset.copy(this.gameObject.matrixWorld);const i=new ge;this._createdPlacementObject=i,i.name="AR Session Root",this._placementScene.name="AR Placement Scene",this._placementScene.children.length=0;for(let n=this.context.scene.children.length-1;n>=0;n--){const r=this.context.scene.children[n];this._placementScene.add(r)}if(this.context.scene.add(i),this.autoCenter){const n=Ja(this._placementScene.children),r=n.getCenter(new w),o=n.getSize(new w),a=new fe;a.makeTranslation(r.x,r.y-o.y*.5,r.z),this._startOffset.multiply(a)}this._reparentedComponents.length=0,this._reparentedComponents.push({comp:this,originalObject:this.gameObject}),ne.addComponent(i,this);for(const n of this._reticle)ba(n);this._reticle.length=0,this._isPlacing=!0,this.context.input.addEventListener("pointerup",this.onPlaceScene,{queue:Uo.Early})}onLeaveXR(){this.context.input.removeEventListener("pointerup",this.onPlaceScene,{queue:Uo.Early}),this.onRevertSceneChanges(),this._anchor=null,this._rigPlacementMatrix=void 0}onUpdateXR(t){var i,n,r,o;if(t.xr.isTrackingImages){for(const a of this._reticle)a.visible=!1;return}if(this._isPlacing){const a=(i=t.xr.rig)==null?void 0:i.gameObject;a&&a.parent!==this.context.scene&&this.context.scene.add(a);let l=!1;if(t.xr.isPassThrough&&t.xr.controllers.length>0&&!this.autoPlace)for(const c of t.xr.controllers){const h=c.getHitTest();h&&(l=!0,this.updateReticleAndHits(t.xr,c.index,h,t.xr.rigScale))}if(!l){const c=t.xr.getHitTest();c&&this.updateReticleAndHits(t.xr,0,c,t.xr.rigScale)}}else{if(this._anchor&&t.xr.referenceSpace){const a=t.xr.frame.getPose(this._anchor.anchorSpace,t.xr.referenceSpace);if(a&&this.context.time.frame%20===0){const l=t.xr.convertSpace(a.transform),c=this._reticle[0];c&&(c.position.copy(l.position),c.quaternion.copy(l.quaternion),this.onApplyPose(c))}}if(this.arTouchTransform?(this.userInput||(this.userInput=new ig(this.context)),(n=this.userInput)==null||n.enable()):(r=this.userInput)==null||r.disable(),this.arTouchTransform&&((o=this.userInput)!=null&&o.hasChanged)){if(t.xr.rig){const a=t.xr.rig.gameObject;this.userInput.applyMatrixTo(a.matrix,!0),a.matrix.decompose(a.position,a.quaternion,a.scale),this.userInput.factor=a.scale.x}this.userInput.reset()}}}updateReticleAndHits(t,i,n,r){this._hits[i]=n.hit;let o=this._reticle[i];if(!o){if(this.customReticle)if(this.customReticle.asset)o=Sv(this.customReticle.asset);else{this.customReticle.loadAssetAsync();return}else o=new le(new e_(.07,.09,32).rotateX(-Math.PI/2),new Kt({side:Pi,depthTest:!1,depthWrite:!1,transparent:!0,opacity:1,color:15658734})),o.name="AR Placement Reticle";if(v3){const a=new xo(1);a.position.y+=.01,o.add(a)}this._reticle[i]=o,o.matrixAutoUpdate=!1,o.visible=!1}if(o.lastPos=o.lastPos||n.position.clone(),o.lastQuat=o.lastQuat||n.quaternion.clone(),o.position.copy(o.lastPos.lerp(n.position,this.context.time.deltaTime/.1)),o.lastPos.copy(o.position),o.quaternion.copy(o.lastQuat.slerp(n.quaternion,this.context.time.deltaTime/.05)),o.lastQuat.copy(o.quaternion),o.scale.set(r,r,r),this.customReticle&&this.applyViewBasedTransform(o),o.updateMatrix(),o.visible=!0,o.parent!==this.context.scene&&this.context.scene.add(o),this._placementStartTime<0&&(this._placementStartTime=this.context.time.realtimeSinceStartup),this.autoPlace)if(this.upVec.set(0,1,0).applyQuaternion(o.quaternion),this.upVec.dot(yt(0,1,0))>.9){let l=o["autoplace:timer"]||0;l>=1?(o.visible=!1,this.onPlaceScene(null)):(l+=this.context.time.deltaTime,o["autoplace:timer"]=l)}else o["autoplace:timer"]=0}onScaleChanged(){}onRevertSceneChanges(){var t;for(const i of this._reticle)i&&(i.visible=!1,i==null||i.removeFromParent());this._reticle.length=0;for(let i=this._placementScene.children.length-1;i>=0;i--){const n=this._placementScene.children[i];this.context.scene.add(n)}(t=this._createdPlacementObject)==null||t.removeFromParent();for(const i of this._reparentedComponents)ne.addComponent(i.originalObject,i.comp)}async onCreateAnchor(t,i){if(i.createAnchor===void 0){console.warn("Hit does not support creating an anchor",i),Xe()&&Yi("Hit does not support creating an anchor");return}else{const n=await i.createAnchor(t.viewerPose.transform);t.running&&n&&(this._anchor=n)}}applyViewBasedTransform(t){const i=this.context.mainCamera,n=t,r=i.worldPosition,o=n.worldPosition;this.upVec.set(0,1,0).applyQuaternion(t.quaternion);const a=i.worldPosition;a&&t.position.clone().sub(a).angleTo(this.upVec)<Math.PI/2&&this.upVec.negate();const l=this.upVec.angleTo(this.worldUpVec)*180/Math.PI,c=30;l>c&&l<180-c||l<-c&&l>-180+c?(this.lookPoint.copy(t.position).add(this.upVec),this.lookPoint.y=t.position.y,t.lookAt(this.lookPoint)):(r.y=o.y,t.lookAt(r))}onApplyPose(t){var r,o,a,l;const i=(o=(r=It.active)==null?void 0:r.rig)==null?void 0:o.gameObject;if(!i){console.warn("No rig object to place");return}(a=It.active)!=null&&a.rigScale;const n=i.parent||this.context.scene;this._rigPlacementMatrix?(l=this._rigPlacementMatrix)==null||l.decompose(i.position,i.quaternion,i.scale):this._rigPlacementMatrix=i.matrix.clone(),this.applyViewBasedTransform(t),t.updateMatrix(),this.context.scene.add(t),t.attach(i),t.removeFromParent(),i.scale.set(this.arScale,this.arScale,this.arScale),i.position.multiplyScalar(this.arScale),i.updateMatrix(),this.invertForward&&i.matrix.premultiply(kce),i.matrix.premultiply(this._startOffset),i.matrix.decompose(i.position,i.quaternion,i.scale),n.add(i)}}u(gu,"_eventListeners",{});const sC=class{constructor(e){u(this,"oneFingerDrag",!0);u(this,"twoFingerRotate",!0);u(this,"twoFingerScale",!0);u(this,"factor",1);u(this,"context");u(this,"offset");u(this,"plane");u(this,"_scale",1);u(this,"_hasChanged",!1);u(this,"_enabled",!1);u(this,"currentlyUsedPointerIds",new Set);u(this,"currentlyUnusedPointerIds",new Set);u(this,"onPointerDownEarly",e=>{this.isActive&&e.stopPropagation()});u(this,"onPointerDownLate",e=>{e.used?this.currentlyUsedPointerIds.add(e.pointerId):this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.add(e.pointerId)});u(this,"onPointerUpEarly",e=>{this.currentlyUsedPointerIds.delete(e.pointerId),this.currentlyUnusedPointerIds.delete(e.pointerId)});u(this,"prev",new Map);u(this,"_didMultitouch",!1);u(this,"touchStart",e=>{if(!e.defaultPrevented)for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],n=St.isAndroidDevice()&&i.clientY<window.innerHeight*.1;this.prev.has(i.identifier)||this.prev.set(i.identifier,{ignore:n,x:0,z:0,screenx:0,screeny:0});const r=this.prev.get(i.identifier);if(r){const o=this.getPositionOnPlane(i.clientX,i.clientY);r.x=o.x,r.z=o.z,r.screenx=i.clientX,r.screeny=i.clientY}}});u(this,"touchEnd",e=>{e.touches.length<=0&&(this._didMultitouch=!1);for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t];this.prev.delete(i.identifier)}});u(this,"touchMove",e=>{if(!e.defaultPrevented&&this.isActive){if(e.touches.length===1){if(this._didMultitouch)return;const t=e.touches[0],i=this.prev.get(t.identifier);if(!i||i.ignore)return;const n=this.getPositionOnPlane(t.clientX,t.clientY),r=n.x-i.x,o=n.z-i.z;if(r===0&&o===0)return;this.oneFingerDrag&&this.addMovement(r,o),i.x=n.x,i.z=n.z,i.screenx=t.clientX,i.screeny=t.clientY;return}else if(e.touches.length===2){this._didMultitouch=!0;const t=e.touches[0],i=e.touches[1],n=this.prev.get(t.identifier),r=this.prev.get(i.identifier);if(!n||!r)return;if(this.twoFingerRotate){const o=Math.atan2(t.clientY-i.clientY,t.clientX-i.clientX),a=Math.atan2(n.screeny-r.screeny,n.screenx-r.screenx),l=o-a;Math.abs(l)>.001&&this.addRotation(l)}if(this.twoFingerScale){const o=t.clientX-i.clientX,a=t.clientY-i.clientY,l=Math.sqrt(o*o+a*a),c=n.screenx-r.screenx,h=n.screeny-r.screeny,d=Math.sqrt(c*c+h*h),f=l-d;Math.abs(f)>2&&this.addScale(f)}n.screenx=t.clientX,n.screeny=t.clientY,r.screenx=i.clientX,r.screeny=i.clientY}}});u(this,"_raycaster",new Nd);u(this,"_intersection",new w);u(this,"_screenPos",new w);u(this,"_tempMatrix",new fe);this.context=e,this.offset=new fe,this.plane=new Ar,this.plane.setFromNormalAndCoplanarPoint(sC.up,sC.zero)}reset(){this._scale=1,this.offset.identity()}get hasChanged(){return this._hasChanged}applyMatrixTo(e,t){this._hasChanged=!1,t?(this.offset.invert(),e.premultiply(this.offset)):e.multiply(this.offset)}get isActive(){return this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.size>0}enable(){this._enabled||(this._enabled=!0,this.context.input.addEventListener("pointerdown",this.onPointerDownEarly,{queue:Uo.Early}),this.context.input.addEventListener("pointerdown",this.onPointerDownLate,{queue:Uo.Late}),this.context.input.addEventListener("pointerup",this.onPointerUpEarly,{queue:Uo.Early}),window.addEventListener("touchstart",this.touchStart,{passive:!1}),window.addEventListener("touchmove",this.touchMove,{passive:!1}),window.addEventListener("touchend",this.touchEnd,{passive:!1}))}disable(){this._enabled&&(this._enabled=!1,this.context.input.removeEventListener("pointerdown",this.onPointerDownEarly,{queue:Uo.Early}),this.context.input.removeEventListener("pointerdown",this.onPointerDownLate,{queue:Uo.Late}),this.context.input.removeEventListener("pointerup",this.onPointerUpEarly,{queue:Uo.Early}),window.removeEventListener("touchstart",this.touchStart),window.removeEventListener("touchmove",this.touchMove),window.removeEventListener("touchend",this.touchEnd))}getPositionOnPlane(e,t){const i=this.context.mainCamera;return this._screenPos.x=e/window.innerWidth*2-1,this._screenPos.y=-(t/window.innerHeight)*2+1,this._screenPos.z=1,this._screenPos.unproject(i),this._raycaster.set(i.position,this._screenPos.sub(i.position)),this._raycaster.ray.intersectPlane(this.plane,this._intersection),this._intersection}addMovement(e,t){e/=this._scale,t/=this._scale,e*=this.factor,t*=this.factor,this.offset.elements[12]+=e,this.offset.elements[14]+=t,(e!==0||t!==0)&&(this._hasChanged=!0)}addScale(e){e/=window.innerWidth,e*=-1,this._scale*=1+e,this._tempMatrix.makeScale(1-e,1-e,1-e),this.offset.premultiply(this._tempMatrix),e!==0&&(this._hasChanged=!0)}addRotation(e){e*=-1,this._tempMatrix.makeRotationY(e),this.offset.premultiply(this._tempMatrix),e!==0&&(this._hasChanged=!0)}};let ig=sC;u(ig,"up",new w(0,1,0)),u(ig,"zero",new w(0,0,0)),u(ig,"one",new w(1,1,1));var Lv=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class ah extends Te{constructor(){super(...arguments);u(this,"position","bottom");u(this,"showNeedleLogo",!0);u(this,"showSpatialMenu");u(this,"createFullscreenButton");u(this,"createMuteButton");u(this,"createQRCodeButton")}onEnable(){this.applyOptions()}applyOptions(){this.context.menu.setPosition(this.position),this.context.menu.showNeedleLogo(this.showNeedleLogo),this.createFullscreenButton===!0&&this.context.menu.showFullscreenOption(!0),this.createMuteButton===!0&&this.context.menu.showAudioPlaybackOption(!0),this.showSpatialMenu===!0&&this.context.menu.showSpatialMenu(this.showSpatialMenu),this.createQRCodeButton===!0&&(St.isMobileDevice()||this.context.menu.showQRCodeButton(!0))}}Lv([x()],ah.prototype,"position",void 0);Lv([x()],ah.prototype,"showNeedleLogo",void 0);Lv([x()],ah.prototype,"showSpatialMenu",void 0);Lv([x()],ah.prototype,"createFullscreenButton",void 0);Lv([x()],ah.prototype,"createMuteButton",void 0);Lv([x()],ah.prototype,"createQRCodeButton",void 0);const Jn={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function i8(s){const e=await fetch(s);if(e.ok)return e.json();throw new Error(e.statusText)}async function Fce(s){if(!s)throw new Error("No basePath supplied");return await i8(`${s}/profilesList.json`)}async function Uce(s,e,t=null,i=!0){if(!s)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const n=await Fce(e);let r;if(s.profiles.some(l=>{const c=n[l];return c&&(r={profileId:l,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}),!!r}),!r){if(!t)throw new Error("No matching profile name found");const l=n[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);r={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}const o=await i8(r.profilePath);let a;if(i){let l;if(s.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[s.handedness],!l)throw new Error(`No matching handedness, ${s.handedness}, in profile ${r.profileId}`);l.assetPath&&(a=r.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const Nce={xAxis:0,yAxis:0,button:0,state:Jn.ComponentState.DEFAULT};function zce(s=0,e=0){let t=s,i=e;if(Math.sqrt(s*s+e*e)>1){const o=Math.atan2(e,s);t=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:i*.5+.5}}class Gce{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Jn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(Nce)}updateFromComponent({xAxis:e,yAxis:t,button:i,state:n}){const{normalizedXAxis:r,normalizedYAxis:o}=zce(e,t);switch(this.componentProperty){case Jn.ComponentProperty.X_AXIS:this.value=this.states.includes(n)?r:.5;break;case Jn.ComponentProperty.Y_AXIS:this.value=this.states.includes(n)?o:.5;break;case Jn.ComponentProperty.BUTTON:this.value=this.states.includes(n)?i:0;break;case Jn.ComponentProperty.STATE:this.valueNodeProperty===Jn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(n):this.value=this.states.includes(n)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Hce{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(i=>{const n=new Gce(t.visualResponses[i]);this.visualResponses[i]=n}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Jn.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Jn.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=Jn.ComponentState.PRESSED:(t.touched||this.values.button>Jn.ButtonTouchThreshold)&&(this.values.state=Jn.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Jn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Jn.AxisTouchThreshold&&(this.values.state=Jn.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Jn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Jn.AxisTouchThreshold&&(this.values.state=Jn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class Vce{constructor(e,t,i){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=i,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(n=>{const r=this.layoutDescription.components[n];this.components[n]=new Hce(n,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const Qce="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",jce="generic-trigger";let Wce=class extends ge{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(i=>{const{valueNode:n,minNode:r,maxNode:o,value:a,valueNodeProperty:l}=i;n&&(l===Jn.VisualResponseProperty.VISIBILITY?n.visible=a:l===Jn.VisualResponseProperty.TRANSFORM&&(n.quaternion.slerpQuaternions(r.quaternion,o.quaternion,a),n.position.lerpVectors(r.position,o.position,a)))})}))}};function qce(s,e){Object.values(s.components).forEach(t=>{const{type:i,touchPointNodeName:n,visualResponses:r}=t;if(i===Jn.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(n),t.touchPointNode){const o=new Wo(.001),a=new Kt({color:255}),l=new le(o,a);t.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(r).forEach(o=>{const{valueNodeName:a,minNodeName:l,maxNodeName:c,valueNodeProperty:h}=o;if(h===Jn.VisualResponseProperty.TRANSFORM){if(o.minNode=e.getObjectByName(l),o.maxNode=e.getObjectByName(c),!o.minNode){console.warn(`Could not find ${l} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${c} in the model`);return}}o.valueNode=e.getObjectByName(a),o.valueNode||console.warn(`Could not find ${a} in the model`)})})}function y3(s,e){qce(s.motionController,e),s.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=s.envMap,t.material.needsUpdate=!0)}),s.layers.mask!=0&&e.traverse(t=>{t.layers.mask=s.layers.mask}),s.add(e)}class Xce{constructor(e=null,t=null){this.gltfLoader=e,this.path=Qce,this._assetCache={},this.onLoad=t,this.gltfLoader||(this.gltfLoader=new Za)}setPath(e){return this.path=e,this}createControllerModel(e){const t=new Wce;let i=null;return e.addEventListener("connected",n=>{const r=n.data;r.targetRayMode!=="tracked-pointer"||!r.gamepad||Uce(r,this.path,jce).then(({profile:o,assetPath:a})=>{t.motionController=new Vce(r,o,a);const l=this._assetCache[t.motionController.assetUrl];if(l)i=l.scene.clone(),y3(t,i),this.onLoad&&this.onLoad(i);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,c=>{this._assetCache[t.motionController.assetUrl]=c,i=c.scene.clone(),y3(t,i),this.onLoad&&this.onLoad(i)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(o=>{console.warn(o)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(i),i=null}),t}}const Yce="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class Kce{constructor(e,t,i,n,r=null,o=null){this.controller=t,this.handModel=e,this.bones=[],r===null&&(r=new Za,r.setPath(i||Yce)),r.load(`${n}.glb`,a=>{const l=a.scene.children[0];this.handModel.add(l),l.layers.mask=this.handModel.layers.mask;const c=l.getObjectByProperty("type","SkinnedMesh");c.frustumCulled=!1,c.castShadow=!0,c.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(d=>{const f=l.getObjectByName(d);f!==void 0?f.jointName=d:console.warn(`Couldn't find ${d} in ${n} hand mesh`),this.bones.push(f)}),o&&o(l)})}updateMesh(){const e=this.controller.joints;for(let t=0;t<this.bones.length;t++){const i=this.bones[t];if(i){const n=e[i.jointName];if(n.visible){const r=n.position;i.position.copy(r),i.quaternion.copy(n.quaternion)}}}}}var kE=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Jl=ie("debugwebxr"),ju=new Array;class Zc extends Te{constructor(){super(...arguments);u(this,"createControllerModel",!0);u(this,"createHandModel",!0);u(this,"customLeftHand");u(this,"customRightHand");u(this,"_models",new Array)}supportsXR(t){return t==="immersive-vr"||t==="immersive-ar"}async onXRControllerAdded(t){var r,o,a;if(!(t.xr.isVR||t.xr.isPassThrough))return;const{controller:n}=t;if(Jl&&console.warn("Add Controller Model for",n.side,n.index),this.createControllerModel||this.createHandModel){if(n.hand){if(this.createHandModel){const l=await this.loadHandModel(n);if(!l||!n.connected||!n.isHand){(r=l==null?void 0:l.handObject)==null||r.removeFromParent(),(a=(o=l==null?void 0:l.handmesh)==null?void 0:o.controller)==null||a.removeFromParent();return}this._models.push({controller:n,model:l.handObject,handmesh:l.handmesh}),this._models.sort((c,h)=>c.controller.index-h.controller.index),this.scene.add(l.handObject),n.model=l.handObject}}else if(this.createControllerModel){const l=await n.getModelUrl();if(l){const c=await this.loadModel(n,l);if(!c||!n.connected||n.isHand)return;this._models.push({controller:n,model:c}),this._models.sort((h,d)=>h.controller.index-d.controller.index),this.scene.add(c),c.traverse(h=>{h.layers.set(2),h.matrixWorldAutoUpdate=!1,h.matrixAutoUpdate=!1,h.updateMatrix()}),n.model=c}else n.targetRayMode!=="transient-pointer"&&console.warn("XRControllerModel: no model found for "+n.side)}}}onXRControllerRemoved(t){var r;const i=this._models.findIndex(o=>o.controller===t.controller),n=this._models[i];n&&(this._models.splice(i,1),n.handmesh&&((r=n.handmesh.handModel)==null||r.removeFromParent(),n.handmesh=void 0),n.model&&(n.model.removeFromParent(),n.model=void 0))}onBeforeRender(){if(It.active&&(Jl&&(ju[0]=Date.now()),this.updateRendering(It.active),Jl)){const t=Date.now()-ju[0];ju.push(t),ju.length>=30&&(ju[0]=0,ju.reduce((i,n)=>i+n,0)/ju.length,ju.length=0)}}onLeaveXR(t){var i;for(const n of this._models)n&&((i=n.model)==null||i.removeFromParent(),n.controller.model===n.model&&(n.controller.model=null));this._models.length=0}updateRendering(t){var i,n,r,o,a;for(let l=0;l<this._models.length;l++){const c=this._models[l];if(!c)continue;const h=c.controller;if(!h.connected){Jl&&console.warn("XRControllerModel.onUpdateXR: controller is not connected anymore",h.side,h.hand);continue}if(c.model&&!c.handmesh)c.model.matrixAutoUpdate=!1,c.model.matrixWorldAutoUpdate=!1,c.model.matrix.copy(h.gripMatrix),c.model.visible=h.isTracking,(i=t.rig)==null||i.gameObject.add(c.model);else if(h.inputSource.hand&&c.handmesh){const d=t.referenceSpace,f=this.context.renderer.xr.getHand(h.index);if(d&&t.frame.getJointPose){for(const p of h.inputSource.hand.values()){const m=f.joints[p.jointName];if(m){const v=h.getHandJointPose(p);if(v){const y=v.transform.position,g=v.transform.orientation;m.position.copy(y),m.quaternion.copy(g),m.matrixAutoUpdate=!1,m.matrixWorldAutoUpdate=!1}m.visible=v!=null}}c.model&&(c.model.visible=h.isTracking,c.model.visible&&c.model.parent!==((n=t.rig)==null?void 0:n.gameObject)&&((r=t.rig)==null||r.gameObject.add(c.model))),(o=c.model)!=null&&o.visible&&((a=c.handmesh)==null||a.updateMesh(),c.model.matrixWorldAutoUpdate=!1,c.model.matrixAutoUpdate=!1,c.model.matrix.identity(),c.model.applyMatrix4(Rg))}}}}async loadModel(t,i){var o;if(!t.connected)return console.warn("XRControllerModel.onXRControllerAdded: controller is not connected anymore",t.side),null;const r=await si.getOrCreate("",i).instantiate();return RR(r),(o=It.active)!=null&&o.isPassThrough&&r.traverseVisible(a=>{this.makeOccluder(a)}),r}async loadHandModel(t){const i=this.context,n=i.renderer.xr.getHand(t.index);n||(Jl?At.DrawLabel(t.rayWorldPosition,"No hand found for index "+t.index,.05,5):console.warn("No hand found for index "+t.index));const r=new Za;bE(r,i),await _O(r,i,this.sourceId??""),r.setPath("https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/");const o=t.side==="left"?"left.":"right.",a=t.side==="left"?this.customLeftHand:this.customRightHand;if(a)if(!a.url.includes(o))console.warn("XRControllerModel: custom hand model must be named "+o),Yi("Custom Hand: unexpected name, please see the console for details");else{const h=a.url.substring(0,a.url.indexOf(o));r.setPath(h),Jl&&console.log("XRControllerModel: loading custom hand model from "+h)}const l=new ge;RR(l);const c=new Kce(l,n,r.path,t.inputSource.handedness,r,h=>{h.traverse(d=>{var f;d.layers.set(2),(f=It.active)!=null&&f.isPassThrough&&!a&&this.makeOccluder(d),d instanceof le&&fi.assignMeshLOD(d,0)}),t.connected||(Jl&&At.DrawLabel(t.rayWorldPosition,"Hand is loaded but not connected anymore",.05,5),h.removeFromParent())});if(Jl&&l.add(new xo(.5)),t.inputSource.hand){Jl&&console.log(t.inputSource.hand);for(const h of t.inputSource.hand.values())if(n.joints[h.jointName]===void 0){const d=new vs;d.matrixAutoUpdate=!1,d.visible=!0,n.joints[h.jointName]=d,n.add(d)}}else Jl&&At.DrawLabel(t.rayWorldPosition,"No inputSource.hand found for index "+t.index,.05,5);return{handObject:l,handmesh:c}}makeOccluder(t){if(t instanceof le){let i=t.material;i instanceof Vt&&(i=t.material=i.clone(),i.depthWrite=!0,i.depthTest=!0,i.colorWrite=!1,t.receiveShadow=!1,t.renderOrder=-100)}}}u(Zc,"factory",new Xce);kE([x()],Zc.prototype,"createControllerModel",void 0);kE([x()],Zc.prototype,"createHandModel",void 0);kE([x(si)],Zc.prototype,"customLeftHand",void 0);kE([x(si)],Zc.prototype,"customRightHand",void 0);const A3=new Si,Fx=new w;class n8 extends VC{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new nt(e,3)),this.setAttribute("uv",new nt(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new Jw(t,6,1);return this.setAttribute("instanceStart",new vo(i,3,0)),this.setAttribute("instanceEnd",new vo(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new Jw(t,6,1);return this.setAttribute("instanceColorStart",new vo(i,3,0)),this.setAttribute("instanceColorEnd",new vo(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new rB(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Si);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),A3.setFromBufferAttribute(t),this.boundingBox.union(A3))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new _n),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let n=0;for(let r=0,o=e.count;r<o;r++)Fx.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(Fx)),Fx.fromBufferAttribute(t,r),n=Math.max(n,i.distanceToSquared(Fx));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}ze.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Z(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};_r.line={uniforms:fu.merge([ze.common,ze.fog,ze.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class CO extends Rt{constructor(e){super({type:"LineMaterial",uniforms:fu.clone(_r.line.uniforms),vertexShader:_r.line.vertexShader,fragmentShader:_r.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const _3=new w,b3=new w,or=new Je,ar=new Je,Zl=new Je,xM=new w,wM=new fe,mr=new WC,x3=new w,Ux=new Si,Nx=new _n,$l=new Je;let wc,wp;function w3(s,e,t){return $l.set(0,0,-e,1).applyMatrix4(s.projectionMatrix),$l.multiplyScalar(1/$l.w),$l.x=wp/t.width,$l.y=wp/t.height,$l.applyMatrix4(s.projectionMatrixInverse),$l.multiplyScalar(1/$l.w),Math.abs(Math.max($l.x,$l.y))}function Jce(s,e){const t=s.matrixWorld,i=s.geometry,n=i.attributes.instanceStart,r=i.attributes.instanceEnd,o=Math.min(i.instanceCount,n.count);for(let a=0,l=o;a<l;a++){mr.start.fromBufferAttribute(n,a),mr.end.fromBufferAttribute(r,a),mr.applyMatrix4(t);const c=new w,h=new w;wc.distanceSqToSegment(mr.start,mr.end,h,c),h.distanceTo(c)<wp*.5&&e.push({point:h,pointOnLine:c,distance:wc.origin.distanceTo(h),object:s,face:null,faceIndex:a,uv:null,uv1:null})}}function Zce(s,e,t){const i=e.projectionMatrix,r=s.material.resolution,o=s.matrixWorld,a=s.geometry,l=a.attributes.instanceStart,c=a.attributes.instanceEnd,h=Math.min(a.instanceCount,l.count),d=-e.near;wc.at(1,Zl),Zl.w=1,Zl.applyMatrix4(e.matrixWorldInverse),Zl.applyMatrix4(i),Zl.multiplyScalar(1/Zl.w),Zl.x*=r.x/2,Zl.y*=r.y/2,Zl.z=0,xM.copy(Zl),wM.multiplyMatrices(e.matrixWorldInverse,o);for(let f=0,p=h;f<p;f++){if(or.fromBufferAttribute(l,f),ar.fromBufferAttribute(c,f),or.w=1,ar.w=1,or.applyMatrix4(wM),ar.applyMatrix4(wM),or.z>d&&ar.z>d)continue;if(or.z>d){const A=or.z-ar.z,b=(or.z-d)/A;or.lerp(ar,b)}else if(ar.z>d){const A=ar.z-or.z,b=(ar.z-d)/A;ar.lerp(or,b)}or.applyMatrix4(i),ar.applyMatrix4(i),or.multiplyScalar(1/or.w),ar.multiplyScalar(1/ar.w),or.x*=r.x/2,or.y*=r.y/2,ar.x*=r.x/2,ar.y*=r.y/2,mr.start.copy(or),mr.start.z=0,mr.end.copy(ar),mr.end.z=0;const v=mr.closestPointToPointParameter(xM,!0);mr.at(v,x3);const y=li.lerp(or.z,ar.z,v),g=y>=-1&&y<=1,_=xM.distanceTo(x3)<wp*.5;if(g&&_){mr.start.fromBufferAttribute(l,f),mr.end.fromBufferAttribute(c,f),mr.start.applyMatrix4(o),mr.end.applyMatrix4(o);const A=new w,b=new w;wc.distanceSqToSegment(mr.start,mr.end,b,A),t.push({point:b,pointOnLine:A,distance:wc.origin.distanceTo(b),object:s,face:null,faceIndex:f,uv:null,uv1:null})}}}class $ce extends le{constructor(e=new n8,t=new CO({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let o=0,a=0,l=t.count;o<l;o++,a+=2)_3.fromBufferAttribute(t,o),b3.fromBufferAttribute(i,o),n[a]=a===0?0:n[a-1],n[a+1]=n[a]+_3.distanceTo(b3);const r=new Jw(n,2,1);return e.setAttribute("instanceDistanceStart",new vo(r,1,0)),e.setAttribute("instanceDistanceEnd",new vo(r,1,1)),this}raycast(e,t){const i=this.material.worldUnits,n=e.camera;n===null&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=e.params.Line2!==void 0&&e.params.Line2.threshold||0;wc=e.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;wp=l.linewidth+r,a.boundingSphere===null&&a.computeBoundingSphere(),Nx.copy(a.boundingSphere).applyMatrix4(o);let c;if(i)c=wp*.5;else{const d=Math.max(n.near,Nx.distanceToPoint(wc.origin));c=w3(n,d,l.resolution)}if(Nx.radius+=c,wc.intersectsSphere(Nx)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),Ux.copy(a.boundingBox).applyMatrix4(o);let h;if(i)h=wp*.5;else{const d=Math.max(n.near,Ux.distanceToPoint(wc.origin));h=w3(n,d,l.resolution)}Ux.expandByScalar(h),wc.intersectsBox(Ux)!==!1&&(i?Jce(this,t):Zce(this,n,t))}}class s8 extends n8{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return super.setPositions(i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return super.setColors(i),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class ehe extends $ce{constructor(e=new s8,t=new CO({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}class FE extends Te{}var tf=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const SM=ie("debugwebxr");class wa extends Te{constructor(){super(...arguments);u(this,"movementSpeed",1.5);u(this,"rotationStep",30);u(this,"useTeleport",!0);u(this,"usePinchToTeleport",!0);u(this,"useTeleportTarget",!1);u(this,"useTeleportFade",!1);u(this,"showRays",!0);u(this,"showHits",!0);u(this,"isXRMovementHandler",!0);u(this,"xrSessionMode","immersive-vr");u(this,"_didApplyRotation",!1);u(this,"_didTeleport",!1);u(this,"_teleportBuffer",new Array);u(this,"_plane",null);u(this,"_lines",[]);u(this,"_hitDiscs",[]);u(this,"_hitDistances",[]);u(this,"_lastHitDistances",[]);u(this,"hitPointRaycastFilter",t=>t.type==="SkinnedMesh"?"continue in children":!0)}onUpdateXR(t){const i=t.xr.rig;if(!(i!=null&&i.gameObject)||t.xr.isPassThrough)return;const n=t.xr.leftController,r=t.xr.rightController;n&&this.onHandleMovement(n,i.gameObject),r&&(this.onHandleRotation(r,i.gameObject),this.useTeleport&&this.onHandleTeleport(r,i.gameObject))}onLeaveXR(t){for(const i of this._lines)i.removeFromParent();for(const i of this._hitDiscs)i==null||i.removeFromParent()}onBeforeRender(){var t;(t=this.context.xr)!=null&&t.running&&(this.showRays&&this.renderRays(this.context.xr),this.showHits&&this.renderHits(this.context.xr))}onHandleMovement(t,i){const n=t.getStick("xr-standard-thumbstick");if(n.x!=0||n.y!=0){const r=yt(n.x,0,n.y);r.multiplyScalar(this.context.time.deltaTimeUnscaled*this.movementSpeed);const o=ln(i);r.multiplyScalar(o.x),r.applyQuaternion(t.xr.poseOrientation),r.y=0,r.applyQuaternion(i.worldQuaternion),i.position.add(r),i.updateWorldMatrix(!1,!1);for(const a of i.children)a.updateWorldMatrix(!1,!1)}}onHandleRotation(t,i){if(t._isMxInk)return;const r=t.getStick("xr-standard-thumbstick").x;if(this._didApplyRotation)Math.abs(r)<.3&&(this._didApplyRotation=!1);else if(Math.abs(r)>.5){this._didApplyRotation=!0;const o=r>0?1:-1,a=Qt(this.context.mainCamera).clone();i.rotateY(o*et.toRadians(this.rotationStep));const c=Qt(this.context.mainCamera).clone().sub(a);c.y=0,i.position.sub(c)}}onHandleTeleport(t,i){var r,o,a,l,c;let n=0;if(t.hand&&this.usePinchToTeleport&&t.isTeleportGesture){const h=t.getPointerId("primary");if(h!=null&&this.context.input.getIsPointerIdInUse(h))return;const d=t.getGesture("pinch");d&&(n=d.value)}else n=(r=t.getStick("xr-standard-thumbstick"))==null?void 0:r.y;if(this._didTeleport)n>=0&&n<.4?this._didTeleport=!1:n<0&&n>-.4&&(this._didTeleport=!1);else if(n>.8){this._didTeleport=!0;const h=this.context.physics.raycastFromRay(t.ray)[0];if(h&&h.object instanceof Kg){const f=(o=h.normal)==null?void 0:o.dot(yt(0,1,0));if(f!==void 0&&f<.4)return}let d=h==null?void 0:h.point;if(!d&&!this.useTeleportTarget){this._plane||(this._plane=new Ar(new w(0,1,0),0));const f=i.worldPosition;this._plane.setFromNormalAndCoplanarPoint(new w(0,1,0),f);const p=t.ray;d=f.clone(),this._plane.intersectLine(new WC(p.origin,yt(p.direction).multiplyScalar(1e4).add(p.origin)),d),d.distanceTo(f)>i.scale.x*10&&(d=null)}if(d){if(this.useTeleportTarget&&!ne.getComponentInParent(h.object,FE))return;const f=d.clone();if(SM&&At.DrawSphere(d,.025,16711680,5),(a=this.context.mainCamera)==null?void 0:a.position){const m=(l=this.context.xr)==null?void 0:l.getUserOffsetInRig();m&&(m.y=0,f.sub(m),SM&&At.DrawWireSphere(m.add(f),.025,65280,5))}this._teleportBuffer.push(i.matrix.clone()),this._teleportBuffer.length>10&&this._teleportBuffer.shift(),this.useTeleportFade?(c=t.xr.fadeTransition())==null||c.then(()=>{i.worldPosition=f}):i.worldPosition=f}}else if(n<-.8&&(this._didTeleport=!0,this._teleportBuffer.length>0)){const h=this._teleportBuffer.pop();h&&h.decompose(i.position,i.quaternion,i.scale)}}renderRays(t){var i;for(let n=0;n<this._lines.length;n++){const r=this._lines[n];r&&(r.visible=!1)}for(let n=0;n<t.controllers.length;n++){const r=t.controllers[n];let o=this._lines[n];if(!r.connected||!r.isTracking||!r.ray||r.targetRayMode==="transient-pointer"||!r.hasSelectEvent){o&&(o.visible=!1);continue}o||(o=this.createRayLineObject(),o.scale.z=.5,this._lines[n]=o),r.updateRayWorldPosition(),r.updateRayWorldQuaternion();const a=r.rayWorldPosition,l=r.rayWorldQuaternion;o.position.copy(a),o.quaternion.copy(l);const c=t.rigScale,h=this.usePinchToTeleport&&r.isTeleportGesture,d=this._lastHitDistances[n],f=this._hitDistances[n]!=null,p=d??c;o.scale.set(c,c,p),o.visible=!0,o.layers.disableAll(),o.layers.enable(2);let m=o.material.opacity;h?m=1:this.showHits&&p<t.rigScale*.5?m=0:(i=r.getButton("primary"))!=null&&i.pressed?m=.5:m=f?.2:.1,o.material.opacity=et.lerp(o.material.opacity,m,this.context.time.deltaTimeUnscaled/.1),o.parent!==this.context.scene&&this.context.scene.add(o)}}renderHits(t){var i;for(const n of this._hitDiscs){if(!n)continue;const r=n.controller;if(!r||!r.connected||!r.isTracking){n.visible=!1;continue}}for(let n=0;n<t.controllers.length;n++){const r=t.controllers[n];if(!r.connected||!r.isTracking||!r.ray||!r.hasSelectEvent)continue;let o=this._hitDiscs[n],a=!0;const l=r.getPointerId("primary");l!=null&&this.context.input.getIsPointerIdInUse(l)&&(o&&(o.visible=!1),this._hitDistances[n]=null,this._lastHitDistances[n]=0,a=!1);const c=this.context.time.smoothedFps>=59?1:10;if((this.context.time.frame+r.index)%c!==0&&(a=!1),!a){const f=this._hitDiscs[n];f&&f.visible&&f.hit&&this.updateHitPointerPosition(r,f,f.hit.distance);continue}const h=this.context.physics.raycastFromRay(r.ray,{testObject:this.hitPointRaycastFilter,precise:!1});let d=h.find(f=>this.usePinchToTeleport&&r.isTeleportGesture?!0:this.isObjectWithInteractiveComponent(f.object));if(d||(d=h[0]),o&&(o.controller=r,o.hit=d),this._hitDistances[n]=(d==null?void 0:d.distance)||null,d){this._lastHitDistances[n]=d.distance;const f=t.rigScale??1;SM&&(At.DrawWireSphere(d.point,.025*f,16711680),At.DrawLabel(yt(0,.2,0).add(d.point),d.object.name,.02,0)),o||(o=this.createHitPointObject(),this._hitDiscs[n]=o),o.hit=d,o.visible=d.distance>f*.05;let p=.01*(f+d.distance);const m=(i=r.getButton("primary"))==null?void 0:i.pressed;m&&(p*=1.1),o.scale.set(p,p,p),o.layers.set(2);let v=o.material.opacity;if(m?v=1:v=d.distance<.15*f?.2:.6,o.material.opacity=et.lerp(o.material.opacity,v,this.context.time.deltaTimeUnscaled/.1),o.visible){if(d.normal){this.updateHitPointerPosition(r,o,d.distance);const y=d.normal.applyQuaternion(qi(d.object));o.quaternion.setFromUnitVectors(the,y)}else this.updateHitPointerPosition(r,o,d.distance);o.parent!==this.context.scene&&this.context.scene.add(o)}}else this._hitDiscs[n]&&(this._hitDiscs[n].visible=!1)}}isObjectWithInteractiveComponent(t,i=0){return CS(t)||t.isUI===!0?!0:t.isScene?!1:t.parent?this.isObjectWithInteractiveComponent(t.parent,i+1):!1}updateHitPointerPosition(t,i,n){const r=yt(t.rayWorldPosition);r.add(yt(0,0,n-.01).applyQuaternion(t.rayWorldQuaternion)),i.position.lerp(r,this.context.time.deltaTimeUnscaled/.05)}createHitPointObject(){const t=new le(new Wo(.3,6,6),new Kt({color:15658734,opacity:.7,transparent:!0,depthTest:!1,depthWrite:!1,side:Pi}));return t.layers.disableAll(),t.layers.enable(2),t}createRayLineObject(){const t=new ehe;t.layers.disableAll(),t.layers.enable(2);const i=new s8;t.geometry=i;const n=new Float32Array(9);n.set([0,0,.02,0,0,.4,0,0,1]),i.setPositions(n);const r=new Float32Array(9);r.set([1,1,1,.1,.1,.1,0,0,0]),i.setColors(r);const o=new CO({color:16777215,vertexColors:!0,worldUnits:!0,linewidth:.004,transparent:!0,depthWrite:!1,blending:Ed,dashed:!1});return t.material=o,t}}tf([x()],wa.prototype,"movementSpeed",void 0);tf([x()],wa.prototype,"rotationStep",void 0);tf([x()],wa.prototype,"useTeleport",void 0);tf([x()],wa.prototype,"usePinchToTeleport",void 0);tf([x()],wa.prototype,"useTeleportTarget",void 0);tf([x()],wa.prototype,"useTeleportFade",void 0);tf([x()],wa.prototype,"showRays",void 0);tf([x()],wa.prototype,"showHits",void 0);const the=new w(0,1,0);var ir=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const zx=ie("debugwebxr"),ihe=ie("debugusdz"),Jf=class extends Te{constructor(){super(...arguments);u(this,"createVRButton",!0);u(this,"createARButton",!0);u(this,"createSendToQuestButton",!0);u(this,"createQRCode",!0);u(this,"useDefaultControls",!0);u(this,"showControllerModels",!0);u(this,"showHandModels",!0);u(this,"usePlacementReticle",!0);u(this,"customARPlacementReticle");u(this,"usePlacementAdjustment",!0);u(this,"arScale",1);u(this,"useXRAnchor",!1);u(this,"autoPlace",!0);u(this,"autoCenter",!0);u(this,"useQuicklookExport",!1);u(this,"useDepthSensing",!1);u(this,"useSpatialGrab",!0);u(this,"defaultAvatar");u(this,"_playerSync");u(this,"_createdComponentsInSession",[]);u(this,"_usdzExporter");u(this,"_exitXRMenuButton");u(this,"_previousXRState",0);u(this,"_spatialGrabRaycaster");u(this,"onAvatarSpawned",t=>{zx&&console.log("WebXR.onAvatarSpawned",t),ne.getComponentInChildren(t,Bd)??(i=ne.addComponent(t,Bd))});u(this,"_buttonFactory");u(this,"_buttons",[])}awake(){It.getXRSync(this.context)}onEnable(){var t,i;window.location.protocol!=="https:"&&Yi('<a href="https://developer.mozilla.org/en-US/docs/Web/API/WebXR_Device_API" target="_blank">WebXR</a> only works on secure connections (https).'),this.useQuicklookExport&&(ne.findObjectOfType(tn)||(zx&&console.log("WebXR: Adding USDZExporter"),this._usdzExporter=ne.addComponent(this.gameObject,tn),this._usdzExporter.objectToExport=this.context.scene,this._usdzExporter.autoExportAnimations=!0,this._usdzExporter.autoExportAudioSources=!0)),this.handleCreatingHTML(),this.handleOfferSession(),this.defaultAvatar===!0&&(zx&&console.warn("WebXR: No default avatar set, using static default avatar"),this.defaultAvatar=new si("https://cdn.needle.tools/static/avatars/DefaultAvatar.glb")),this.defaultAvatar&&(this._playerSync=this.gameObject.getOrAddComponent(Wd),this._playerSync.autoSync=!1),this._playerSync&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,(t=this._playerSync.onPlayerSpawned)==null||t.removeEventListener(this.onAvatarSpawned),(i=this._playerSync.onPlayerSpawned)==null||i.addEventListener(this.onAvatarSpawned))}onDisable(){var t;(t=this._usdzExporter)==null||t.destroy(),this.removeButtons()}async handleOfferSession(){return this.createVRButton&&await It.isVRSupported()&&this.createVRButton?It.offerSession("immersive-vr","default",this.context):this.createARButton&&await It.isARSupported()&&this.createARButton?It.offerSession("immersive-ar","default",this.context):!1}get session(){return It.active??null}get sessionMode(){return It.activeMode??null}async enterVR(t){return It.start("immersive-vr",t,this.context)}async enterAR(t){return It.start("immersive-ar",t,this.context)}exitXR(){It.stop()}get isActiveWebXR(){return!Jf.activeWebXRComponent||Jf.activeWebXRComponent===this}onBeforeXR(t,i){var n;if(!this.isActiveWebXR){console.warn(`WebXR: another WebXR component is already active (${(n=Jf.activeWebXRComponent)==null?void 0:n.name}). This is ignored: ${this.name}`);return}Jf.activeWebXRComponent=this,t=="immersive-ar"&&this.useDepthSensing&&(i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push("depth-sensing"))}async onEnterXR(t){if(!this.isActiveWebXR)return;zx&&console.log("WebXR onEnterXR"),this._previousXRState=xr.Global.Mask;const i=t.xr.isVR;if(xr.Global.Set(i?da.VR:da.AR),this.usePlacementReticle&&t.xr.isAR){let n=ne.findObjectOfType(gu);if(!n){const r=new ge;for(const o of this.context.scene.children)r.add(o);this.context.scene.add(r),n=ne.addComponent(r,gu),this._createdComponentsInSession.push(n)}n.customReticle=this.customARPlacementReticle,n.arScale=this.arScale,n.arTouchTransform=this.usePlacementAdjustment,n.autoPlace=this.autoPlace,n.autoCenter=this.autoCenter,n.useXRAnchor=this.useXRAnchor}this.useDefaultControls&&this.setDefaultMovementEnabled(!0),(this.showControllerModels||this.showHandModels)&&this.setDefaultControllerRenderingEnabled(!0),this.useSpatialGrab&&(this._spatialGrabRaycaster=ne.findObjectOfType(bd)??void 0,this._spatialGrabRaycaster||(this._spatialGrabRaycaster=this.gameObject.addComponent(bd))),this.createLocalAvatar(t.xr),t.xr.isScreenBasedAR||(this._exitXRMenuButton=this.context.menu.appendChild({label:"Quit XR",onClick:()=>this.exitXR(),icon:"exit_to_app",priority:2e4}))}onUpdateXR(t){this.isActiveWebXR&&this._spatialGrabRaycaster&&(this._spatialGrabRaycaster.enabled=this.useSpatialGrab)}onLeaveXR(t){var i,n;if((i=this._exitXRMenuButton)==null||i.remove(),!!this.isActiveWebXR){xr.Global.Set(this._previousXRState),(n=this._playerSync)==null||n.destroyInstance();for(const r of this._createdComponentsInSession)r.destroy();this._createdComponentsInSession.length=0,this.handleOfferSession(),qC(1).then(()=>Jf.activeWebXRComponent=null)}}setDefaultMovementEnabled(t){let i=this.gameObject.getComponent(wa);return!i&&t&&(i=this.gameObject.addComponent(wa),this._createdComponentsInSession.push(i)),i&&(i.enabled=t),i}setDefaultControllerRenderingEnabled(t){let i=this.gameObject.getComponent(Zc);return!i&&t&&(i=this.gameObject.addComponent(Zc),this._createdComponentsInSession.push(i),i.createControllerModel=this.showControllerModels,i.createHandModel==this.showHandModels),i&&(i.enabled=t),i}async createLocalAvatar(t){this._playerSync&&t.running&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,await this._playerSync.getInstance())}getButtonsContainer(){return this.getButtonsFactory()}getButtonsFactory(){return this._buttonFactory||(this._buttonFactory=lu.getOrCreate()),this._buttonFactory}handleCreatingHTML(){if(this.createARButton||this.createVRButton||this.useQuicklookExport){if((St.isiOS()&&St.isSafari()||ihe)&&this.useQuicklookExport){const i=ne.findObjectOfType(tn);if(!i||i&&i.allowCreateQuicklookButton){const n=this.getButtonsFactory().createQuicklookButton();this.addButton(n,50)}}if(this.createARButton){const i=this.getButtonsFactory().createARButton();this.addButton(i,50)}if(this.createVRButton){const i=this.getButtonsFactory().createVRButton();this.addButton(i,50)}}if(this.createSendToQuestButton&&!St.isQuest()&&It.isVRSupported().then(i=>{if(!i){const n=this.getButtonsFactory().createSendToQuestButton();this.addButton(n,50)}}),this.createQRCode){const i=dE(ah);if(i&&i.createQRCodeButton===!1)Xe()&&console.warn("WebXR: QRCode button is disabled in the Needle Menu component");else if(!St.isMobileDevice()){const n=Ml.getOrCreate().createQRCode();this.addButton(n,50)}}}addButton(t,i){this._buttons.push(t),t.setAttribute("priority",i.toString()),this.context.menu.appendChild(t)}removeButtons(){for(const t of this._buttons)t.remove();this._buttons.length=0}};let bn=Jf;u(bn,"activeWebXRComponent",null);ir([x()],bn.prototype,"createVRButton",void 0);ir([x()],bn.prototype,"createARButton",void 0);ir([x()],bn.prototype,"createSendToQuestButton",void 0);ir([x()],bn.prototype,"createQRCode",void 0);ir([x()],bn.prototype,"useDefaultControls",void 0);ir([x()],bn.prototype,"showControllerModels",void 0);ir([x()],bn.prototype,"showHandModels",void 0);ir([x()],bn.prototype,"usePlacementReticle",void 0);ir([x(si)],bn.prototype,"customARPlacementReticle",void 0);ir([x()],bn.prototype,"usePlacementAdjustment",void 0);ir([x()],bn.prototype,"arScale",void 0);ir([x()],bn.prototype,"useXRAnchor",void 0);ir([x()],bn.prototype,"autoPlace",void 0);ir([x()],bn.prototype,"autoCenter",void 0);ir([x()],bn.prototype,"useQuicklookExport",void 0);ir([x()],bn.prototype,"useDepthSensing",void 0);ir([x()],bn.prototype,"useSpatialGrab",void 0);ir([x(si)],bn.prototype,"defaultAvatar",void 0);class UE{get extensionName(){return"Physics"}onExportObject(e,t,i){const n=ne.getComponents(e,Ci).filter(l=>l.enabled),r=ne.getComponents(e,Xo).filter(l=>l.enabled&&!l.isTrigger);let o=n.length>0?n[0]:null;const a=r.length>0?r[0]:null;a&&!o&&(o=new Ci,o.isKinematic=!0),o&&t.addEventListener("serialize",(l,c)=>{var h,d,f;if(o){if(l.appendLine(),l.beginBlock('def RealityKitComponent "RigidBody"',"{",!0),o.useGravity||l.appendLine("bool gravityEnabled = 0"),l.appendLine('uniform token info:id = "RealityKit.RigidBody"'),o.isKinematic&&l.appendLine('token motionType = "Kinematic"'),l.beginBlock('def RealityKitStruct "massFrame"',"{",!0),l.appendLine(`float m_mass = ${o.mass}`),l.beginBlock('def RealityKitStruct "m_pose"',"{",!0),l.appendLine(`float3 position = (${o.centerOfMass.x}, ${o.centerOfMass.y}, ${o.centerOfMass.z})`),l.closeBlock("}"),l.closeBlock("}"),r.length>0){const p=r[0];l.beginBlock('def RealityKitStruct "material"',"{",!0);const m=p.sharedMaterial;m&&m.dynamicFriction!==void 0&&l.appendLine(`double dynamicFriction = ${(h=p.sharedMaterial)==null?void 0:h.dynamicFriction}`),m&&m.bounciness!==void 0&&l.appendLine(`double restitution = ${(d=p.sharedMaterial)==null?void 0:d.bounciness}`),m&&m.staticFriction!==void 0&&l.appendLine(`double staticFriction = ${(f=p.sharedMaterial)==null?void 0:f.staticFriction}`),l.closeBlock("}")}l.closeBlock("}")}}),a&&(t.addEventListener("serialize",(l,c)=>{var f;l.beginBlock('def RealityKitComponent "Collider"',"{",!0),l.appendLine("uint group = 1"),l.appendLine('uniform token info:id = "RealityKit.Collider"'),l.appendLine("uint mask = 4294967295");const d=a.isTrigger?"Trigger":"Default";if(l.appendLine(`token type = "${d}"`),l.beginBlock('def RealityKitStruct "Shape"',"{",!0),a instanceof Iv){const p=a;l.appendLine('token shapeType = "Sphere"'),l.appendLine(`float radius = ${p.radius}`)}else if(a instanceof Xd){const p=a;l.appendLine('token shapeType = "Box"'),l.appendLine(`float3 extent = (${p.size.x}, ${p.size.y}, ${p.size.z})`)}else if(a instanceof mu){const p=a;l.appendLine('token shapeType = "Capsule"'),l.appendLine(`float radius = ${p.radius}`),l.appendLine(`float height = ${p.height}`)}else if(a instanceof $p&&((f=a.sharedMesh)!=null&&f.geometry)){const p=a.sharedMesh.geometry;p.boundingBox||p.computeBoundingBox();const m=a.sharedMesh.geometry.boundingBox;m&&(l.appendLine('token shapeType = "Box"'),l.appendLine(`float3 extent = (${m.max.x-m.min.x}, ${m.max.y-m.min.y}, ${m.max.z-m.min.z})`),console.log("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. MeshCollider will be exported as Box",a))}else console.warn("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. Ignoring collider:",a);l.beginBlock('def RealityKitStruct "pose"',"{",!0),l.closeBlock("}"),l.closeBlock("}"),l.closeBlock("}")}),r.length>1&&console.log("WARNING: Multiple colliders detected. visionOS / iOS can only support objects with a single collider, only exporting the first collider: ",a))}}var wu=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Ef=ie("debugtext");var di;(function(s){s[s.UpperLeft=0]="UpperLeft",s[s.UpperCenter=1]="UpperCenter",s[s.UpperRight=2]="UpperRight",s[s.MiddleLeft=3]="MiddleLeft",s[s.MiddleCenter=4]="MiddleCenter",s[s.MiddleRight=5]="MiddleRight",s[s.LowerLeft=6]="LowerLeft",s[s.LowerCenter=7]="LowerCenter",s[s.LowerRight=8]="LowerRight"})(di||(di={}));var TA;(function(s){s[s.Truncate=0]="Truncate",s[s.Overflow=1]="Overflow"})(TA||(TA={}));var MA;(function(s){s[s.Wrap=0]="Wrap",s[s.Overflow=1]="Overflow"})(MA||(MA={}));var Po;(function(s){s[s.Normal=0]="Normal",s[s.Bold=1]="Bold",s[s.Italic=2]="Italic",s[s.BoldAndItalic=3]="BoldAndItalic"})(Po||(Po={}));class Kr extends Hc{constructor(){super(...arguments);u(this,"alignment",di.UpperLeft);u(this,"verticalOverflow",TA.Truncate);u(this,"horizontalOverflow",MA.Wrap);u(this,"lineSpacing",1);u(this,"supportRichText",!1);u(this,"font");u(this,"fontStyle",Po.Normal);u(this,"sRGBTextColor",new me(1,0,1));u(this,"_text","");u(this,"_fontSize",12);u(this,"_textMeshUi",null);u(this,"_didHandleTextRenderOnTop",!1)}setAlphaFactor(t){var i;super.setAlphaFactor(t),(i=this.uiObject)==null||i.set({fontOpacity:this.color.alpha*this.alphaFactor}),this.markDirty()}get text(){return this._text}set text(t){t!==this._text&&(this._text=t,this.feedText(this.text,this.supportRichText),this.markDirty())}set_text(t){this.text=t}get fontSize(){return this._fontSize}set fontSize(t){var i;this._fontSize=t,(i=this.uiObject)==null||i.set({fontSize:t})}onColorChanged(){var t;this.sRGBTextColor.copy(this.color),this.sRGBTextColor.convertLinearToSRGB(),(t=this.uiObject)==null||t.set({color:this.sRGBTextColor,fontOpacity:this.color.alpha})}onParentRectTransformChanged(){super.onParentRectTransformChanged(),this.uiObject&&this.updateOverflow()}onBeforeCanvasRender(t){this.updateOverflow()}updateOverflow(){var i;const t=(i=this.uiObject)==null?void 0:i._overflow;t&&(t._needsUpdate=!0)}onCreate(t){Ef&&console.log(this),this.horizontalOverflow==MA.Overflow&&(t.whiteSpace="pre"),this.verticalOverflow==TA.Truncate&&(this.context.renderer.localClippingEnabled=!0,t.overflow="hidden"),this.horizontalOverflow==MA.Overflow&&this.verticalOverflow==TA.Truncate,t.lineHeight=this.lineSpacing,delete t.backgroundOpacity,delete t.backgroundColor,Ef&&(t.backgroundColor=16750848,t.backgroundOpacity=.5);const i=this.rectTransform;t={...t,...this.getTextOpts()},this.getAlignment(t),Ef&&(t.backgroundColor=Math.random()*16777215,t.backgroundOpacity=.1),this.uiObject=i.createNewText(t),this.feedText(this.text,this.supportRichText)}onAfterAddedToScene(){super.onAfterAddedToScene(),this.handleTextRenderOnTop()}getTextOpts(){const t=this.fontSize,i={color:this.color,fontOpacity:this.color.alpha,fontSize:t,fontKerning:"normal"};return this.setFont(i,this.fontStyle),i}onEnable(){var t;super.onEnable(),this._didHandleTextRenderOnTop=!1,this.uiObject&&this.uiObject.addAfterUpdate(()=>{this.setShadowComponentOwner(this.uiObject),this.markDirty()}),setTimeout(()=>this.markDirty(),10),(t=this.canvas)==null||t.registerEventReceiver(this)}onDisable(){var t;super.onDisable(),(t=this.canvas)==null||t.unregisterEventReceiver(this)}getAlignment(t){switch(t.flexDirection="column",this.alignment){case di.UpperLeft:case di.MiddleLeft:case di.LowerLeft:t.textAlign="left";break;case di.UpperCenter:case di.MiddleCenter:case di.LowerCenter:t.textAlign="center";break;case di.UpperRight:case di.MiddleRight:case di.LowerRight:t.textAlign="right";break}switch(this.alignment){default:case di.UpperLeft:case di.UpperCenter:case di.UpperRight:t.alignItems="start";break;case di.MiddleLeft:case di.MiddleCenter:case di.MiddleRight:t.alignItems="center";break;case di.LowerLeft:case di.LowerCenter:case di.LowerRight:t.alignItems="end";break}return t}feedText(t,i){var n,r,o;if(Ef&&console.log("feedText",this.uiObject,t,i),!!this.uiObject)if(this._textMeshUi||(this._textMeshUi=[]),this.uiObject.children.length=0,!i||t.length===0)this.uiObject.textContent=t;else{let a=this.getNextTag(t);if(a){if(a.startIndex>0){for(let h=this.uiObject.children.length-1;h>=0;h--){const d=this.uiObject.children[h];d.isUI&&(this.uiObject.remove(d),d.clear())}const c=new hw({textContent:t.substring(0,a.startIndex),color:"inherit"});this.uiObject.add(c)}}else{this.uiObject.textContent="",this.setOptions({textContent:t});return}const l=[];for(;a;){const c=this.getNextTag(t,a.endIndex),h={fontFamily:(n=this.uiObject)==null?void 0:n.get("fontFamily"),color:"inherit",textContent:""};if(c){h.textContent=this.getText(t,a,c),this.handleTag(a,h,l);const d=new hw(h);(r=this.uiObject)==null||r.add(d)}else{h.textContent=t.substring(a.endIndex),this.handleTag(a,h,l);const d=new hw(h);(o=this.uiObject)==null||o.add(d)}a=c}}}handleTextRenderOnTop(){this._didHandleTextRenderOnTop||(this._didHandleTextRenderOnTop=!0,this.startCoroutine(this.renderOnTopCoroutine()))}*renderOnTopCoroutine(){if(!this.canvas)return;const t=[],i=this.canvas,n={renderOnTop:i.renderOnTop,depthWrite:i.depthWrite,doubleSided:i.doubleSided};for(;;){let r=!1;if(this._textMeshUi)for(let o=0;o<this._textMeshUi.length;o++){if(t[o]===!0)continue;r=!0;const a=this._textMeshUi[o];a.textContent&&(TS(a,n),t[o]=!0)}if(!r)break;yield}}handleTag(t,i,n){if(!t.isEndTag){if(t.type.includes("color")){const r=new CM(t,{color:i.color});if(n.push(r),t.type.length>6){const o=parseInt("0x"+t.type.substring(7));i.color=o}else i.color=new me(1,1,1)}else if(t.type=="b"){this.setFont(i,Po.Bold);const r=new CM(t,{fontWeight:700});n.push(r)}else if(t.type=="i"){this.setFont(i,Po.Italic);const r=new CM(t,{fontStyle:"italic"});n.push(r)}}}getText(t,i,n){return t.substring(i.endIndex,n.startIndex)}getNextTag(t,i=0){const n=t.indexOf("<",i),r=t.indexOf(">",n);if(n>=0&&r>=0){const o=t.substring(n+1,r);return{type:o,startIndex:n,endIndex:r+1,isEndTag:o.startsWith("/")}}return null}setFont(t,i){if(!this.font)return;const n=this.font,r=this.getFamilyNameWithCorrectSuffix(n,i);Ef&&console.log("Selected font family:"+r);let o=WI.getFontFamily(r);switch(o||(o=WI.addFontFamily(r)),t.fontFamily=o,i){default:case Po.Normal:t.fontWeight=400,t.fontStyle="normal";break;case Po.Bold:t.fontWeight=700,t.fontStyle="normal";break;case Po.Italic:t.fontWeight=400,t.fontStyle="italic";break;case Po.BoldAndItalic:t.fontStyle="italic",t.fontWeight=400}let a=o.getVariant(t.fontWeight,t.fontStyle);if(!a){let l=r;l!=null&&l.endsWith("-msdf.json")||(l+="-msdf.json");let c=r;c!=null&&c.endsWith(".png")||(c+=".png"),a=o.addVariant(t.fontWeight,t.fontStyle,l,c),a==null||a.addEventListener("ready",()=>{this.markDirty()})}}getFamilyNameWithCorrectSuffix(t,i){var h;const n=t.lastIndexOf("-");if(n<0)return t;const r=(h=t.substring(n+1))==null?void 0:h.toLowerCase();if(nhe.includes(r))return Ef&&console.warn("Unsupported font style: "+r),t;const o=t.lastIndexOf("/");let a=t;o>=0&&(a=a.substring(o+1));const l=a[0]===a[0].toUpperCase(),c=t.substring(0,n);switch(Ef&&console.log("Select font: ",t,Po[i],a,l,c),i){case Po.Normal:return l?c+"-Regular":c+"-regular";case Po.Bold:return l?c+"-Bold":c+"-bold";case Po.Italic:return l?c+"-Italic":c+"-italic";case Po.BoldAndItalic:return l?c+"-BoldItalic":c+"-bolditalic";default:return t}}}wu([x()],Kr.prototype,"alignment",void 0);wu([x()],Kr.prototype,"verticalOverflow",void 0);wu([x()],Kr.prototype,"horizontalOverflow",void 0);wu([x()],Kr.prototype,"lineSpacing",void 0);wu([x()],Kr.prototype,"supportRichText",void 0);wu([x(URL)],Kr.prototype,"font",void 0);wu([x()],Kr.prototype,"fontStyle",void 0);wu([x()],Kr.prototype,"text",null);wu([x()],Kr.prototype,"fontSize",null);class CM{constructor(e,t){u(this,"tag");u(this,"previousValues");this.tag=e,this.previousValues=t}}const nhe=["medium","mediumitalic","black","blackitalic","thin","thinitalic","extrabold","light","lightitalic","semibold"];var IA;(function(s){s.singleLine="singleLine",s.hardBreaks="hardBreaks",s.flowing="flowing"})(IA||(IA={}));var pg;(function(s){s.left="left",s.center="center",s.right="right",s.justified="justified"})(pg||(pg={}));var mg;(function(s){s.top="top",s.middle="middle",s.lowerMiddle="lowerMiddle",s.baseline="baseline",s.bottom="bottom"})(mg||(mg={}));class dd{constructor(e){u(this,"id");u(this,"content","");u(this,"font",[]);u(this,"pointSize",144);u(this,"width");u(this,"height");u(this,"depth");u(this,"wrapMode");u(this,"horizontalAlignment");u(this,"verticalAlignment");u(this,"material");this.id=e}static getId(){return this.global_id++}setDepth(e){return this.depth=e,this}setPointSize(e){return this.pointSize=e,this}setHorizontalAlignment(e){return this.horizontalAlignment=e,this}setVerticalAlignment(e){return this.verticalAlignment=e,this}writeTo(e,t){var n;t.beginBlock(`def Preliminary_Text "${this.id}"`,"(",!1),t.appendLine('prepend apiSchemas = ["MaterialBindingAPI"]'),t.closeBlock(")"),t.beginBlock(),this.content&&t.appendLine(`string content = "${this.content}"`),(!this.font||this.font.length<=0)&&(this.font||(this.font=[]),(n=this.font)==null||n.push("sans-serif"));const i=this.font.map(r=>`"${r}"`).join(", ");t.appendLine(`string[] font = [ ${i} ]`),t.appendLine(`double pointSize = ${this.pointSize}`),typeof this.width=="number"&&t.appendLine(`double width = ${this.width}`),typeof this.height=="number"&&t.appendLine(`double height = ${this.height}`),typeof this.depth=="number"&&t.appendLine(`double depth = ${this.depth}`),this.wrapMode&&t.appendLine(`token wrapMode = "${this.wrapMode}"`),this.horizontalAlignment&&t.appendLine(`token horizontalAlignment = "${this.horizontalAlignment}"`),this.verticalAlignment&&t.appendLine(`token verticalAlignment = "${this.verticalAlignment}"`),this.material!==void 0&&t.appendLine(`rel material:binding = </StageRoot/Materials/${jD(this.material)}>`),t.closeBlock()}}u(dd,"global_id",0);class NE{static singleLine(e,t,i){const n=new dd("text_"+dd.getId());return n.content=e,t&&(n.pointSize=t),i&&(n.depth=i),n}static multiLine(e,t,i,n,r,o){const a=new dd("text_"+dd.getId());return a.content=e,a.width=t,a.height=i,a.horizontalAlignment=n,a.verticalAlignment=r,o!==void 0&&(a.wrapMode=o),a}}const she=new fe().makeRotationY(Math.PI),rhe=new fe().makeScale(-1,1,-1);class z_{get extensionName(){return"text"}exportText(e,t,i){const n=ne.getComponent(e,Kr);if(!n)return;const r=ne.getComponent(e,Js);let o=100,a=100;r&&(o=r.width,a=r.height);const l=she.clone();r&&l.premultiply(rhe),t.setMatrix(l);const c=n.color.clone();t.material=new ms({color:c,emissive:c}),t.addEventListener("serialize",(h,d)=>{let f=n.text;f=f.replace(/\r/g,""),f=f.replace(/\n/g,"\\n");const p=NE.multiLine(f,o,a,pg.center,mg.bottom,IA.flowing);this.setTextAlignment(p,n.alignment),this.setOverflow(p,n),t.material&&(p.material=t.material),p.pointSize=this.convertToTextSize(n.fontSize),p.depth=.001,p.writeTo(void 0,h)})}convertToTextSize(e){return 1/.0502*144*e}setOverflow(e,t){t.horizontalOverflow?e.wrapMode=IA.singleLine:e.wrapMode=IA.flowing}setTextAlignment(e,t){switch(t){case di.LowerLeft:case di.MiddleLeft:case di.UpperLeft:e.horizontalAlignment=pg.left;break;case di.LowerCenter:case di.MiddleCenter:case di.UpperCenter:e.horizontalAlignment=pg.center;break;case di.LowerRight:case di.MiddleRight:case di.UpperRight:e.horizontalAlignment=pg.right;break}switch(t){case di.LowerLeft:case di.LowerCenter:case di.LowerRight:e.verticalAlignment=mg.bottom;break;case di.MiddleLeft:case di.MiddleCenter:case di.MiddleRight:e.verticalAlignment=mg.middle;break;case di.UpperLeft:case di.UpperCenter:case di.UpperRight:e.verticalAlignment=mg.top;break}}}class zE{get extensionName(){return"tmui"}onExportObject(e,t,i){const n=ne.getComponent(e,Us);if(n&&n.enabled&&n.renderMode===fc.WorldSpace){const r=new z_,o=ne.getComponent(e,Js),a=ne.getComponent(e,Dd),l=new Array;if(o){if(!ne.isActiveSelf(e)){const d=ne.isActiveSelf(e);ne.setActive(e,!0),o.onEnable(),o.updateTransform(),l.push(()=>{o.onDisable(),ne.setActive(e,d)})}e.traverse(d=>{if(!ne.isActiveInHierarchy(d)){const f=ne.isActiveSelf(d);ne.setActive(d,!0);const p=ne.getComponent(d,$a);p&&(p.onEnable(),l.push(()=>{p.onDisable()}));const m=ne.getComponent(d,Js);m&&(m.onEnable(),m.updateTransform(),m.onApplyTransform(),l.push(()=>{m.onDisable()}));const v=ne.getComponent(d,Kr);v&&(v.onEnable(),l.push(()=>{v.onDisable()})),l.push(()=>{ne.setActive(d,f)})}}),o.width,o.height;const c=wr.createEmpty(),h=o.shadowComponent;if(t.add(c),h){const d=h.matrix;c.setMatrix(d);const f=new Map,p=new Map;f.set(h,c),p.set(h,a?a.alpha:1),h.traverse(m=>{if(m===h)return;const v=wr.createEmpty();v.setMatrix(m.matrix);const y=m.parent,g=!!y&&typeof y.textContent=="string"&&y.textContent.length>0;let _=p.get(y)||1;const A=ne.getComponent(m,Dd);if(A&&(_*=A.alpha),m instanceof le&&g){const E=m[Qa];E?r.exportText(E.gameObject,v,i):console.error("Error when exporting UI: shadow component owner not found. This is likely a bug.",m)}if(m instanceof le&&!g){const E=m.geometry.clone();E.scale(1,1,-1),this.flipWindingOrder(E),v.geometry=E;const C=new me,T=m.material.opacity;C.copy(m.material.color),v.material=new Kt({color:C,opacity:T*_,map:m.material.map,transparent:!0})}f.set(m,v),p.set(m,_);const b=f.get(y);if(!b){console.error("Error when exporting UI: shadow component parent not found!",m,m.parent);return}b.add(v)})}}for(const c of l)c()}}flipWindingOrder(e){const t=e.index.array;for(let i=0,n=t.length/3;i<n;i++){const r=t[i*3];t[i*3]=t[i*3+2],t[i*3+2]=r}e.index.needsUpdate=!0}}const $y=ie("debugusdz");function ohe(s,e){var a;const t=[],i=ne.getComponentsInChildren(s,Cr),n=ne.getComponentsInChildren(s,qr),r=new Array,o=new Array;if(e.injectImplicitBehaviours)for(const l of i){if(!l||!l.runtimeAnimatorController||!l.enabled)continue;const c=l.runtimeAnimatorController.activeState;if(!c||!c.motion||!c.motion.clip||((a=c.motion.clip.tracks)==null?void 0:a.length)<1||r.includes(l))continue;const h=new Il;h.animator=l,h.stateName=c.name,h.trigger="start",h.name="PlayAnimationOnClick_implicitAtStart_"+h.stateName;const d=new ge;ne.addComponent(d,h),o.push(d),r.push(l),s.add(d)}else for(const l of i){if(!l||!l.runtimeAnimatorController||!l.enabled)continue;$y&&console.log(l);const c=[];for(const h of l.runtimeAnimatorController.enumerateActions()){$y&&console.log(h);const d=h.getClip();c.includes(d)||c.push(d)}t.push({root:l.gameObject,clips:c})}if(e.injectImplicitBehaviours)for(const l of n){if(!l||!l.clip||!l.enabled||!l.playAutomatically||r.includes(l))continue;const c=new Il;c.animation=l,c.stateName=l.clip.name,c.trigger="start",c.name="PlayAnimationOnClick_implicitAtStart_"+c.stateName;const h=new ge;ne.addComponent(h,c),o.push(h),r.push(l),s.add(h)}else for(const l of n){$y&&console.log(l);const c=[];for(const h of l.animations)c.includes(h)||c.push(h);t.push({root:l.gameObject,clips:c})}$y&&(t==null?void 0:t.length)>0&&console.log("USDZ Animation Clips without behaviours",t);for(const l of t)for(const c of l.clips)e.registerAnimation(l.root,c);return o}function ahe(s,e){const t=ne.getComponentsInChildren(s,Fi),i=ne.getComponentsInChildren(s,Od),n=new Array,r=new Array;$y&&console.log({audioSources:t,playAudioOnClicks:i});for(const o of i){if(!o.target)continue;const a=t.indexOf(o.target);a>-1&&t.splice(a,1)}for(const o of t){if(!o||!o.clip||o.volume<=0||n.includes(o))continue;const a=new Od;a.target=o,a.name="PlayAudioOnClick_implicitAtStart_",a.trigger="start";const l=new ge;ne.addComponent(l,a),console.log("implicit PlayAudioOnStart",l,a),r.push(l),n.push(o),s.add(l)}return r}function lhe(s){return new ys("DisableAtStart",Ys.sceneStartTrigger(),wi.fadeAction(s,0,!1))}function S3(s,e){const t=s.domElement.shadowRoot.querySelector("link[rel='ar']");if(t)return t;const i=document.createElement("div");i.classList.add("menu"),i.classList.add("quicklook-menu"),i.style.display="none",i.style.visibility="hidden";const n=document.createElement("button");n.id="open-in-ar",e?(n.innerText="View in AR",n.title="View this scene in AR. The scene will be exported to USDZ and opened with Apple's QuickLook."):(n.innerText="View in AR",n.title="Download this scene for AR. Open the downloaded USDZ file to view it in AR using Apple's QuickLook."),i.appendChild(n);const r=document.createElement("a");r.id="needle-usdz-link",r.style.display="none",r.rel="ar",r.href="",r.target="_blank",i.appendChild(r);const o=document.createElement("img");return o.id="button",r.appendChild(o),s.domElement.shadowRoot.appendChild(i),r}var Pr=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const ta=ie("debugusdz"),che=ie("debugusdzpruning");class nf{constructor(){u(this,"callToAction");u(this,"checkoutTitle");u(this,"checkoutSubtitle");u(this,"callToActionURL")}}Pr([x()],nf.prototype,"callToAction",void 0);Pr([x()],nf.prototype,"checkoutTitle",void 0);Pr([x()],nf.prototype,"checkoutSubtitle",void 0);Pr([x()],nf.prototype,"callToActionURL",void 0);const rC=class extends Te{constructor(){super(...arguments);u(this,"objectToExport");u(this,"autoExportAnimations",!0);u(this,"autoExportAudioSources",!0);u(this,"exportFileName");u(this,"customUsdzFile");u(this,"customBranding");u(this,"anchoringType","plane");u(this,"maxTextureSize",2048);u(this,"planeAnchoringAlignment","horizontal");u(this,"interactive",!0);u(this,"physics",!0);u(this,"allowCreateQuicklookButton",!0);u(this,"quickLookCompatible",!0);u(this,"extensions",[]);u(this,"link");u(this,"button");u(this,"onClickedOpenInARElement",t=>{t.preventDefault(),this.exportAndOpen()});u(this,"_currentExportTasks",new Map);u(this,"_previousTimeScale",1);u(this,"lastCallback");u(this,"_rootSessionRootWasAppliedTo",null);u(this,"_rootPositionBeforeExport",new w);u(this,"_rootRotationBeforeExport",new xe);u(this,"_rootScaleBeforeExport",new w)}start(){var t,i,n;ta&&(console.log("USDZExporter",this),console.log("Debug USDZ Mode. Press 'T' to export"),window.addEventListener("keydown",r=>{switch(r.key){case"t":this.exportAndOpen();break}})),this.objectToExport||(this.objectToExport=this.gameObject),!((i=(t=this.objectToExport)==null?void 0:t.children)!=null&&i.length)&&!((n=this.objectToExport)!=null&&n.isMesh)&&(this.objectToExport=this.context.scene)}onEnable(){var n;const t=St.supportsQuickLookAR(),i=St.isiOS()||St.isiPad();!this.button&&(ta||t||i)&&(this.allowCreateQuicklookButton&&(this.button=this.createQuicklookButton()),this.lastCallback=this.quicklookCallback.bind(this),this.link=S3(this.context,t),this.link.addEventListener("message",this.lastCallback)),ta&&Pn("USDZ Exporter enabled: "+this.name),(n=document.getElementById("open-in-ar"))==null||n.addEventListener("click",this.onClickedOpenInARElement),v0.registerExporter(this)}onDisable(){var t,i,n;(t=this.button)==null||t.remove(),(i=this.link)==null||i.removeEventListener("message",this.lastCallback),ta&&Pn("USDZ Exporter disabled: "+this.name),(n=document.getElementById("open-in-ar"))==null||n.removeEventListener("click",this.onClickedOpenInARElement),v0.unregisterExporter(this)}async exportAsync(){return this.exportAndOpen()}async exportAndOpen(){var n;let t=this.exportFileName??((n=this.objectToExport)==null?void 0:n.name)??this.name;if(t+="-"+mQ(),yd()||(t!==""&&(t+="-"),t+="MadeWithNeedle"),this.link||(this.link=S3(this.context,St.supportsQuickLookAR())),this.customUsdzFile)return ta&&console.log("Exporting custom usdz",this.customUsdzFile),this.openInQuickLook(this.customUsdzFile,t),null;if(!this.objectToExport)return console.warn("No object to export",this),null;const i=await this.export(this.objectToExport);return i?(ta&&console.log("USDZ generation done. Downloading as "+t),this.openInQuickLook(i,t),i):(console.error("USDZ generation failed. Please report a bug",this),null)}async export(t){if(!t)return console.warn("No object to export"),null;const i=this._currentExportTasks.get(t);if(i)return i;const n=this.internalExport(t);return n instanceof Promise?(this._currentExportTasks.set(t,n),n.then(r=>(this._currentExportTasks.delete(t),r)).catch(r=>(this._currentExportTasks.delete(t),console.error("Error during USDZ export – please report a bug!",r),null))):n}async internalExport(t){gi.start("export-usdz",{onProgress:C=>{this.dispatchEvent(new CustomEvent("export-progress",{detail:{progress:C}}))}}),gi.report("export-usdz",{message:"Starting export",totalSteps:40,currentStep:0}),gi.report("export-usdz",{message:"Load progressive textures",autoStep:5}),gi.start("export-usdz-textures","export-usdz");const i=ne.getComponentsInChildren(t,Yo);for(const C of i)C&&C.enabled&&C.updateSprite(!0);const n=ne.getComponentsInChildren(t,dn),r=new Array;let o=0;for(const C of n){for(const T of C.sharedMeshes)if(T){const M=fi.assignMeshLOD(T,0);M instanceof Promise&&r.push(new Promise((R,S)=>{M.then(()=>{o++,gi.report("export-usdz-textures",{message:"Loaded progressive mesh",currentStep:o,totalSteps:r.length}),R()}).catch(I=>S(I))}))}for(const T of C.sharedMaterials)if(T){const M=fi.assignTextureLOD(T,0);M instanceof Promise&&r.push(new Promise((R,S)=>{M.then(()=>{o++,gi.report("export-usdz-textures",{message:"Loaded progressive texture",currentStep:o,totalSteps:r.length}),R()}).catch(I=>S(I))}))}}ta&&Pn("Progressive Loading: "+r.length),await Promise.all(r),ta&&Pn("Progressive Loading: done"),gi.end("export-usdz-textures");const a=xr.Global.Mask;xr.Global.Set(da.AR);const l=new _Q,c=new x_(this.quickLookCompatible);let h;const d=[];this.interactive&&(d.push(new BE),d.push(new jd),globalThis.false&&ne.getComponentsInChildren(t,Ci).length>0&&(this.physics?(h=new UE,d.push(h)):Xe()&&console.warn("USDZExporter: Physics export is disabled, but there are active Rigidbody components in the scene. They will not be exported.")),d.push(new z_),d.push(new zE));const f=[c,...d,...this.extensions],p={self:this,exporter:l,extensions:f,object:t};gi.report("export-usdz","Invoking before-export"),this.dispatchEvent(new CustomEvent("before-export",{detail:p})),this.applyWebARSessionRoot(),this._previousTimeScale=this.context.time.timeScale,this.context.time.timeScale=0,gi.report("export-usdz","auto export animations and audio sources");const m=new Array;this.autoExportAnimations&&m.push(...ohe(t,c)),this.extensions.find(C=>C.extensionName==="Audio")&&this.autoExportAudioSources&&m.push(...ahe(t)),l.debug=ta,l.pruneUnusedNodes=!che;const y=wd.instance.objs.map(C=>C.batchedMesh);l.keepObject=C=>{let T=!0;const M=ne.getComponent(C,dn);return M&&!M.enabled&&(T=!1),T&&y.includes(C)&&(T=!1),T&&ne.getComponentInParent(C,Vo)&&(T=!1),T&&ne.getComponentInParent(C,ih)&&(T=!1),ta&&!T&&console.log("USDZExporter: Discarding object",C),T},l.beforeWritingDocument=()=>{if(Xe()&&c&&h){const C=c.animatedRoots;for(const T of C){const M=ne.getComponentsInChildren(T,Ci).filter(S=>S.enabled),R=ne.getComponents(T,Xo).filter(S=>S.enabled&&!S.isTrigger);(M.length>0||R.length>0)&&console.error("An animated object has physics components in its child hierarchy. This can lead to undefined behaviour due to a bug in Apple's QuickLook (FB15925487). Remove the physics components from child objects or verify that you get the expected results.",T)}}};const g=new Array;this.objectToExport&&this.quickLookCompatible&&this.interactive&&this.objectToExport.traverse(C=>{C.visible||g.push(C)});const _=this.extensions.find(C=>C.extensionName==="Behaviour");this.interactive&&_&&g.length>0&&_.addBehavior(lhe(g));let A=!0;this.quickLookCompatible&&!this.interactive&&(A=!1),this.anchoringType!=="plane"&&this.anchoringType!=="none"&&this.anchoringType!=="image"&&this.anchoringType!=="face"&&(this.anchoringType="plane"),this.planeAnchoringAlignment!=="horizontal"&&this.planeAnchoringAlignment!=="vertical"&&this.planeAnchoringAlignment!=="any"&&(this.planeAnchoringAlignment="horizontal"),gi.report("export-usdz","Invoking exporter.parse");const b=await l.parse(this.objectToExport,{ar:{anchoring:{type:this.anchoringType},planeAnchoring:{alignment:this.planeAnchoringAlignment}},extensions:f,quickLookCompatible:this.quickLookCompatible,maxTextureSize:this.maxTextureSize,exportInvisible:A}),E=new Blob([b],{type:"model/vnd.usdz+zip"});this.revertWebARSessionRoot(),this.context.time.timeScale=this._previousTimeScale,gi.report("export-usdz","Invoking after-export"),this.dispatchEvent(new CustomEvent("after-export",{detail:p}));for(const C of m)ne.destroy(C);return xr.Global.Set(a),gi.end("export-usdz"),E}openInQuickLook(t,i){const n=t instanceof Blob?URL.createObjectURL(t):t,r=this.buildQuicklookOverlay();ta&&console.log("QuickLook Overlay",r);const o=r.callToAction?encodeURIComponent(r.callToAction):"",a=r.checkoutTitle?encodeURIComponent(r.checkoutTitle):"",l=r.checkoutSubtitle?encodeURIComponent(r.checkoutSubtitle):"";this.link.href=n+`#callToAction=${o}&checkoutTitle=${a}&checkoutSubtitle=${l}&callToActionURL=${r.callToActionURL}`,this.lastCallback||(this.lastCallback=this.quicklookCallback.bind(this),this.link.addEventListener("message",this.lastCallback)),this.link.download=i+".usdz",this.link.click()}download(t,i){rC.save(t,i)}static save(t,i){const n=document.createElement("a");n.style.display="none",document.body.appendChild(n),typeof t=="string"?n.href=t:n.href=URL.createObjectURL(t),n.download=i,n.click(),n.remove()}quicklookCallback(t){if((t==null?void 0:t.data)=="_apple_ar_quicklook_button_tapped"){ta&&Yi("Quicklook closed via call to action button");var i=new CustomEvent("quicklook-button-tapped",{detail:this});if(this.dispatchEvent(i),!i.defaultPrevented){const n=new URLSearchParams(this.link.href);if(n){const r=n.get("callToActionURL");ta&&Pn("Quicklook url: "+r),r&&(yd()?globalThis.open(r,"_blank"):console.warn("Quicklook closed: custom redirects require a Needle Engine Pro license: https://needle.tools/pricing",r))}}}}buildQuicklookOverlay(){var n,r,o,a,l,c;const t={};return this.customBranding&&Object.assign(t,this.customBranding),yd()||(console.log("Custom Quicklook banner text requires pro license: https://needle.tools/pricing"),t.callToAction="Close",t.checkoutTitle="🌵 Made with Needle",t.checkoutSubtitle="_"),(((n=t.callToAction)==null?void 0:n.length)||((r=t.checkoutTitle)==null?void 0:r.length)||((o=t.checkoutSubtitle)==null?void 0:o.length))&&((a=t.callToAction)!=null&&a.length||(t.callToAction="\0"),(l=t.checkoutTitle)!=null&&l.length||(t.checkoutTitle="\0"),(c=t.checkoutSubtitle)!=null&&c.length||(t.checkoutSubtitle="\0")),this.dispatchEvent(new CustomEvent("quicklook-overlay",{detail:t})),t}getARScaleAndTarget(){if(!this.objectToExport)return{scale:1,_invertForward:!1,target:this.gameObject,sessionRoot:null};const t=ne.findObjectOfType(bn);let i=ne.getComponentInParent(this.objectToExport,gu);i||(i=ne.getComponentInChildren(this.objectToExport,gu));let n=1,r=!1;const o=this.objectToExport;return t?n=t.arScale:i&&(n=i.arScale,r=i.invertForward),{scale:1/n,_invertForward:r,target:o,sessionRoot:(i==null?void 0:i.gameObject)??null}}applyWebARSessionRoot(){if(!this.objectToExport)return;const{scale:t,_invertForward:i,target:n,sessionRoot:r}=this.getARScaleAndTarget(),o=r==null?void 0:r.matrixWorld.clone().invert();this._rootSessionRootWasAppliedTo=n,this._rootPositionBeforeExport.copy(n.position),this._rootRotationBeforeExport.copy(n.quaternion),this._rootScaleBeforeExport.copy(n.scale),n.scale.multiplyScalar(t),i&&n.quaternion.multiply(rC.invertForwardQuaternion),n.updateMatrix(),n.updateMatrixWorld(!0),r&&o&&n.matrix.premultiply(o)}revertWebARSessionRoot(){if(!this.objectToExport||!this._rootSessionRootWasAppliedTo)return;const t=this._rootSessionRootWasAppliedTo;t.position.copy(this._rootPositionBeforeExport),t.quaternion.copy(this._rootRotationBeforeExport),t.scale.copy(this._rootScaleBeforeExport),t.updateMatrix(),t.updateMatrixWorld(!0),this._rootSessionRootWasAppliedTo=null}createQuicklookButton(){const i=lu.getOrCreate().createQuicklookButton();return i.parentNode||this.context.menu.appendChild(i),i}};let tn=rC;u(tn,"invertForwardMatrix",new fe().makeRotationY(Math.PI)),u(tn,"invertForwardQuaternion",new xe().setFromEuler(new oi(0,Math.PI,0)));Pr([x(ge)],tn.prototype,"objectToExport",void 0);Pr([x()],tn.prototype,"autoExportAnimations",void 0);Pr([x()],tn.prototype,"autoExportAudioSources",void 0);Pr([x()],tn.prototype,"exportFileName",void 0);Pr([x(URL)],tn.prototype,"customUsdzFile",void 0);Pr([x(nf)],tn.prototype,"customBranding",void 0);Pr([x()],tn.prototype,"anchoringType",void 0);Pr([x()],tn.prototype,"maxTextureSize",void 0);Pr([x()],tn.prototype,"planeAnchoringAlignment",void 0);Pr([x()],tn.prototype,"interactive",void 0);Pr([x()],tn.prototype,"physics",void 0);Pr([x()],tn.prototype,"allowCreateQuicklookButton",void 0);Pr([x()],tn.prototype,"quickLookCompatible",void 0);class G_ extends Te{constructor(){super(...arguments);u(this,"isUsed",!0);u(this,"usedBy",null)}}class EO extends Te{}const C3=ie("debugdeletable"),QA=class extends No{onEnable(){QA._instances.push(this)}onDisable(){const e=QA._instances.indexOf(this);e>=0&&QA._instances.splice(e,1)}};let Sp=QA;u(Sp,"_instances",[]);class TO extends Te{update(){for(const e of Sp._instances){const t=this.gameObject;if(e.isInBox(t)===!0){const n=ne.getComponentInParent(this.gameObject,G_);if(n)C3&&console.warn("DeleteBox: Not deleting object with usage marker",this.guid,n);else{if(C3)try{if(e.box){const r=e.box,o=No.testBox;At.DrawWireBox3(r,16711680,5),At.DrawWireBox3(o,255,5),console.log("DeleteBox: Destroying",this.gameObject,{deleteBoxArea:r,deletedObjectArea:o})}else console.log("DeleteBox: Destroying",this.gameObject)}catch{}p_(this.gameObject,this.context.connection)}}}}}var sm=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r},iP;(function(s){s[s.Off=0]="Off",s[s.Gaussian=1]="Gaussian",s[s.Bokeh=2]="Bokeh"})(iP||(iP={}));const hhe=ie("debugpost");class Vl extends er{constructor(){super(...arguments);u(this,"mode");u(this,"focusDistance",new Ze(1));u(this,"focalLength",new Ze(.2));u(this,"aperture",new Ze(20));u(this,"gaussianMaxRadius",new Ze);u(this,"resolutionScale",new Ze(1*1/window.devicePixelRatio));u(this,"bokehScale",new Ze)}get typeName(){return"DepthOfField"}init(){this.focalLength.valueProcessor=i=>{const n=i/300,r=2;return et.lerp(r,.01,n)};const t=20;this.aperture.valueProcessor=i=>{const n=1-i/32;return et.lerp(1,t,n)}}onCreateEffect(){if(this.mode===iP.Off){hhe&&console.warn("DepthOfField: Mode is set to Off");return}const t=new yH(this.context.mainCamera,{worldFocusRange:.2,focalLength:1,bokehScale:20,resolutionScale:this.resolutionScale.value});return this.focusDistance.onValueChanged=i=>{t.cocMaterial.worldFocusDistance=i},this.focalLength.onValueChanged=i=>t.cocMaterial.worldFocusRange=i,this.aperture.onValueChanged=i=>t.bokehScale=i,this.resolutionScale&&(this.resolutionScale.onValueChanged=i=>t.resolution.scale=i),[t]}unapply(){}}sm([x()],Vl.prototype,"mode",void 0);sm([x(Ze)],Vl.prototype,"focusDistance",void 0);sm([x(Ze)],Vl.prototype,"focalLength",void 0);sm([x(Ze)],Vl.prototype,"aperture",void 0);sm([x(Ze)],Vl.prototype,"gaussianMaxRadius",void 0);sm([x(Ze)],Vl.prototype,"resolutionScale",void 0);sm([x(Ze)],Vl.prototype,"bokehScale",void 0);il("DepthOfField",Vl);var uhe=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r},US;(function(s){s[s.Never=0]="Never",s[s.Desktop=1]="Desktop",s[s.Mobile=2]="Mobile"})(US||(US={}));class GE extends Te{constructor(){super(...arguments);u(this,"visibleOn")}onEnable(){this.apply()}apply(){this.test()||ne.setActive(this.gameObject,!1)}test(){return this.visibleOn<0?!0:St.isMobileDevice()?(this.visibleOn&US.Mobile)!==0:(this.visibleOn&US.Desktop)!==0}}uhe([x()],GE.prototype,"visibleOn",void 0);class MO{get extensionName(){return"DocumentExtension"}onAfterBuildDocument(e){}}var rm=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Dc=ie("debugdrag"),EM=[];var vr;(function(s){s[s.XZPlane=0]="XZPlane",s[s.Attached=1]="Attached",s[s.HitNormal=2]="HitNormal",s[s.DynamicViewAngle=3]="DynamicViewAngle",s[s.SnapToSurfaces=4]="SnapToSurfaces",s[s.None=5]="None"})(vr||(vr={}));const oa=class extends Te{constructor(){super(...arguments);u(this,"dragMode",vr.DynamicViewAngle);u(this,"snapGridResolution",0);u(this,"keepRotation",!0);u(this,"xrDragMode",vr.Attached);u(this,"xrKeepRotation",!1);u(this,"xrDistanceDragFactor",1);u(this,"showGizmo",!1);u(this,"_rigidbody",null);u(this,"_targetObject",null);u(this,"_dragHelper",null);u(this,"_draggingRigidbodies",[]);u(this,"_potentialDragStartEvt",null);u(this,"_dragHandlers",new Map);u(this,"_totalMovement",new w);u(this,"_marker",null);u(this,"_isDragging",!1);u(this,"_didDrag",!1)}static get HasAnySelected(){return this._active>0}static get CurrentlySelected(){EM.length=0;for(const t of this._instances)t._isDragging&&EM.push(t);return EM}get draggedObject(){return this._targetObject}setTargetObject(t){var n,r;this._targetObject=t;for(const o of this._dragHandlers.values())o.setTargetObject(t);const i="_rigidbody-was-kinematic";((n=this._rigidbody)==null?void 0:n[i])===!1&&(this._rigidbody.isKinematic=!1,this._rigidbody[i]=void 0),this._rigidbody=null,t&&(this._rigidbody=ne.getComponentInChildren(t,Ci),((r=this._rigidbody)==null?void 0:r.isKinematic)===!1&&(this._rigidbody.isKinematic=!0,this._rigidbody[i]=!1))}awake(){this._potentialDragStartEvt=null,this._dragHandlers=new Map,this._totalMovement=new w,this._marker=null,this._isDragging=!1,this._didDrag=!1,this._dragHelper=null,this._draggingRigidbodies=[]}start(){this.gameObject.getComponentInParent(xa)||this.gameObject.addComponent(xa)}onEnable(){oa._instances.push(this)}onDisable(){oa._instances=oa._instances.filter(t=>t!==this)}allowEdit(t=null){return this.context.connection.allowEditing}onPointerEnter(t){if(!this.allowEdit(this.gameObject)||t.mode!=="screen"||(t.event.mode==="tracked-pointer"||t.event.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===vr.None)return;const r=ne.getComponentInParent(t.object,oa);!r||r!==this||(oa.lastHovered=t.object,this.context.domElement.style.cursor="pointer")}onPointerExit(t){this.allowEdit(this.gameObject)&&t.mode==="screen"&&oa.lastHovered===t.object&&(this.context.domElement.style.cursor="auto")}onPointerDown(t){if(!(!this.allowEdit(this.gameObject)||t.used||(t.mode==="tracked-pointer"||t.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===vr.None)&&(oa.lastHovered=t.object,t.button===0)){this._dragHandlers.size===0&&(this._didDrag=!1,this._totalMovement.set(0,0,0),this._potentialDragStartEvt=t),this._targetObject||this.setTargetObject(this.gameObject),oa._active+=1;const r=new fhe(this,this._targetObject);if(this._dragHandlers.set(t.event.space,r),r.onDragStart(t),this._dragHandlers.size===2){const o=this._dragHandlers.values(),a=o.next().value,l=o.next().value,c=new dhe(this,this._targetObject,a,l);this._dragHandlers.set(this.gameObject,c),c.onDragStart(t)}t.use()}}onPointerMove(t){(this._isDragging||this._potentialDragStartEvt!==null)&&t.use()}onPointerUp(t){if(Dc&&At.DrawLabel(t.point??this.gameObject.worldPosition,"POINTERUP:"+t.pointerId+", "+t.button,.03,3),!this.allowEdit(this.gameObject)||t.button!==0)return;this._potentialDragStartEvt=null;const i=this._dragHandlers.get(t.event.space),n=this._dragHandlers.get(this.gameObject);n&&(n.handlerA===i||n.handlerB===i)&&(this._dragHandlers.delete(this.gameObject),n.onDragEnd(t)),i&&(oa._active>0&&(oa._active-=1),this.setTargetObject(null),i.onDragEnd&&i.onDragEnd(t),this._dragHandlers.delete(t.event.space),this._dragHandlers.size===0&&this.onLastDragEnd(t),t.use())}update(){for(const t of this._dragHandlers.values())t.collectMovementInfo&&t.collectMovementInfo(),t.getTotalMovement&&this._totalMovement.add(t.getTotalMovement());if(this._potentialDragStartEvt){if(!this._didDrag)if(this._totalMovement.length()>3e-4)this._didDrag=!0;else return;const t=this._potentialDragStartEvt;this._potentialDragStartEvt=null,this.onFirstDragStart(t)}for(const t of this._dragHandlers.values())t.onDragUpdate&&t.onDragUpdate(this._dragHandlers.size);this._dragHelper&&this._dragHelper.hasSelected&&this.onAnyDragUpdate()}onFirstDragStart(t){if(!t||!t.object)return;const i=ne.getComponentInParent(t.object,oa);if(!i||i!==this&&i._isDragging)return;const n=this._targetObject||this.gameObject;if(!n)return;this._isDragging=!0;const r=ne.getComponentInChildren(n,Kc);Dc&&console.log("DRAG START",r,n),r&&(r.fastMode=!0,r==null||r.requestOwnership()),this._marker=ne.addComponent(n,G_),this._draggingRigidbodies.length=0;const o=ne.getComponentsInChildren(n,Ci);o&&this._draggingRigidbodies.push(...o)}onAnyDragUpdate(){if(!this._dragHelper)return;this._dragHelper.showGizmo=this.showGizmo,this._dragHelper.onUpdate(this.context);for(const i of this._draggingRigidbodies)i.wakeUp(),i.resetVelocities(),i.resetForcesAndTorques();const t=this._targetObject||this.gameObject;Ya.markDirty(t)}onLastDragEnd(t){if(!this||!this._isDragging)return;this._isDragging=!1;for(const n of this._draggingRigidbodies)n.setVelocity(n.smoothedVelocity);if(this._draggingRigidbodies.length=0,this._targetObject=null,t!=null&&t.object){const n=ne.getComponentInChildren(t.object,Kc);n&&(n.fastMode=!1)}if(this._marker&&this._marker.destroy(),!this._dragHelper)return;const i=this._dragHelper.selected;Dc&&console.log("DRAG END",i,i==null?void 0:i.visible),this._dragHelper.setSelected(null,this.context)}};let Bs=oa;u(Bs,"_active",0),u(Bs,"_instances",[]),u(Bs,"lastHovered");rm([x()],Bs.prototype,"dragMode",void 0);rm([x()],Bs.prototype,"snapGridResolution",void 0);rm([x()],Bs.prototype,"keepRotation",void 0);rm([x()],Bs.prototype,"xrDragMode",void 0);rm([x()],Bs.prototype,"xrKeepRotation",void 0);rm([x()],Bs.prototype,"xrDistanceDragFactor",void 0);rm([x()],Bs.prototype,"showGizmo",void 0);class dhe{constructor(e,t,i,n){u(this,"handlerA");u(this,"handlerB");u(this,"context");u(this,"settings");u(this,"gameObject");u(this,"_handlerAAttachmentPoint",new w);u(this,"_handlerBAttachmentPoint",new w);u(this,"_followObject");u(this,"_manipulatorObject");u(this,"_deviceMode");u(this,"_followObjectStartWorldQuaternion",new xe);u(this,"_manipulatorPosOffset",new w);u(this,"_manipulatorRotOffset",new xe);u(this,"_manipulatorScaleOffset",new w);u(this,"_tempVec1",new w);u(this,"_tempVec2",new w);u(this,"_tempVec3",new w);u(this,"tempLookMatrix",new fe);u(this,"_initialScale",new w);u(this,"_initialDistance",0);var o,a;this.context=e.context,this.settings=e,this.gameObject=t,this.handlerA=i,this.handlerB=n,this._followObject=new ge,this._manipulatorObject=new ge,this.context.scene.add(this._manipulatorObject);const r=(a=(o=It.active)==null?void 0:o.rig)==null?void 0:a.gameObject;if(!this.handlerA||!this.handlerB||!this.handlerA.hitPointInLocalSpace||!this.handlerB.hitPointInLocalSpace){console.error("Invalid: MultiTouchDragHandler needs two valid DragPointerHandlers with hitPointInLocalSpace set.");return}if(this._tempVec1.copy(this.handlerA.hitPointInLocalSpace),this._tempVec2.copy(this.handlerB.hitPointInLocalSpace),this.gameObject.localToWorld(this._tempVec1),this.gameObject.localToWorld(this._tempVec2),r&&(r.worldToLocal(this._tempVec1),r.worldToLocal(this._tempVec2)),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.02?(Dc&&console.log("Finding alternative drag attachment points since initial distance is too low: "+this._initialDistance.toFixed(2)),this.handlerA.followObject.parent.getWorldPosition(this._tempVec1),this.handlerB.followObject.parent.getWorldPosition(this._tempVec2),this._handlerAAttachmentPoint.copy(this._tempVec1),this._handlerBAttachmentPoint.copy(this._tempVec2),this.gameObject.worldToLocal(this._handlerAAttachmentPoint),this.gameObject.worldToLocal(this._handlerBAttachmentPoint),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.001&&(console.warn("Not supported right now – controller drag points for multitouch are too close!"),this._initialDistance=1)):(this._handlerAAttachmentPoint.copy(this.handlerA.hitPointInLocalSpace),this._handlerBAttachmentPoint.copy(this.handlerB.hitPointInLocalSpace)),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._initialScale.copy(t.scale),Dc){this._followObject.add(new xo(2)),this._manipulatorObject.add(new xo(5));const l=c=>`${c.x.toFixed(2)}, ${c.y.toFixed(2)}, ${c.z.toFixed(2)}`;At.DrawLine(this._tempVec1,this._tempVec2,65535,0,!1),At.DrawLabel(this._tempVec3,"A:B "+this._initialDistance.toFixed(2)+`
`+l(this._tempVec1)+`
`+l(this._tempVec2),.03,5)}}onDragStart(e){this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.matrix.identity(),this._deviceMode=e.mode,this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this.alignManipulator(),this._manipulatorObject.attach(this._followObject),this._manipulatorPosOffset.copy(this._followObject.position),this._manipulatorRotOffset.copy(this._followObject.quaternion),this._manipulatorScaleOffset.copy(this._followObject.scale)}onDragEnd(e){if(!this.handlerA||!this.handlerB){console.error("onDragEnd called on MultiTouchDragHandler without valid handlers. This is likely a bug.");return}this.handlerA.recenter(),this.handlerB.recenter(),this._manipulatorObject.removeFromParent(),this._followObject.removeFromParent(),this._manipulatorObject.destroy(),this._followObject.destroy()}alignManipulator(){if(!this.handlerA||!this.handlerB){console.error("alignManipulator called on MultiTouchDragHandler without valid handlers. This is likely a bug.",this);return}if(!this.handlerA.followObject||!this.handlerB.followObject){console.error("alignManipulator called on MultiTouchDragHandler without valid follow objects. This is likely a bug.",this.handlerA,this.handlerB);return}this._tempVec1.copy(this._handlerAAttachmentPoint),this._tempVec2.copy(this._handlerBAttachmentPoint),this.handlerA.followObject.localToWorld(this._tempVec1),this.handlerB.followObject.localToWorld(this._tempVec2),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._manipulatorObject.position.copy(this._tempVec3);const e=this.context.mainCamera;this.tempLookMatrix.lookAt(this._tempVec3,this._tempVec2,e.worldUp),this._manipulatorObject.quaternion.setFromRotationMatrix(this.tempLookMatrix);const t=this._tempVec1.distanceTo(this._tempVec2);this._manipulatorObject.scale.copy(this._initialScale).multiplyScalar(t/this._initialDistance),this._manipulatorObject.updateMatrix(),this._manipulatorObject.updateMatrixWorld(!0),Dc&&(At.DrawLabel(this._tempVec3.clone().add(new w(0,.2,0)),"A:B "+t.toFixed(2),.03),At.DrawLine(this._tempVec1,this._tempVec2,65280,0,!1))}onDragUpdate(){this.alignManipulator();const e=30,t=1;this._followObject.position.copy(this._manipulatorPosOffset),this._followObject.quaternion.copy(this._manipulatorRotOffset),this._followObject.scale.copy(this._manipulatorScaleOffset);const i=this.gameObject,n=this._followObject;n.updateMatrix(),n.updateMatrixWorld(!0);const o=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrKeepRotation:this.settings.keepRotation;if(this.settings.snapGridResolution>0){const d=this._followObject.worldPosition,f=this.settings.snapGridResolution;d.x=Math.round(d.x/f)*f,d.y=Math.round(d.y/f)*f,d.z=Math.round(d.z/f)*f,this._followObject.worldPosition=d,this._followObject.updateMatrix()}o&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const a=et.clamp01(this.context.time.deltaTime*e*t),l=i.worldPosition;l.lerp(n.worldPosition,a),i.worldPosition=l;const c=i.worldQuaternion;c.slerp(n.worldQuaternion,a),i.worldQuaternion=c;const h=i.worldScale;h.lerp(n.worldScale,a),i.worldScale=h}setTargetObject(e){this.gameObject=e}}class fhe{constructor(e,t){u(this,"context");u(this,"gameObject");u(this,"settings");u(this,"_lastRig");u(this,"_followObject");u(this,"_totalMovement",new w);u(this,"_totalMovementAlongRayDirection",0);u(this,"_grabStartDistance",0);u(this,"_deviceMode");u(this,"_followObjectStartPosition",new w);u(this,"_followObjectStartQuaternion",new xe);u(this,"_followObjectStartWorldQuaternion",new xe);u(this,"_lastDragPosRigSpace");u(this,"_tempVec",new w);u(this,"_tempMat",new fe);u(this,"_hitPointInLocalSpace",new w);u(this,"_hitNormalInLocalSpace",new w);u(this,"_bottomCenter",new w);u(this,"_backCenter",new w);u(this,"_backBottomCenter",new w);u(this,"_bounds",new Si);u(this,"_dragPlane",new Ar(new w(0,1,0)));u(this,"_draggedOverObject",null);u(this,"_draggedOverObjectLastSetUp",null);u(this,"_draggedOverObjectLastNormal",new w);u(this,"_draggedOverObjectDuration",0);u(this,"_hasLastSurfaceHitPoint",!1);u(this,"_lastSurfaceHitPoint",new w);this.settings=e,this.context=e.context,this.gameObject=t,this._followObject=new ge}getTotalMovement(){return this._totalMovement}get followObject(){return this._followObject}get hitPointInLocalSpace(){return this._hitPointInLocalSpace}setTargetObject(e){this.gameObject=e}recenter(){var r,o;if(!this._followObject.parent){console.warn("Error: space follow object doesn't have parent but recenter() is called. This is likely a bug");return}if(!this.gameObject){console.warn("Error: space follow object doesn't have a gameObject");return}const e=this._followObject.parent;this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.position.set(0,0,0),this._followObject.quaternion.set(0,0,0,1),this._followObject.scale.set(1,1,1),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0),e.attach(this._followObject),this._followObjectStartPosition.copy(this._followObject.position),this._followObjectStartQuaternion.copy(this._followObject.quaternion),this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const t=this._hitPointInLocalSpace.clone();this.gameObject.localToWorld(t),this._grabStartDistance=t.distanceTo(e.worldPosition);const i=(o=(r=It.active)==null?void 0:r.rig)==null?void 0:o.gameObject,n=(i==null?void 0:i.worldScale.x)||1;this._grabStartDistance/=n,this._totalMovementAlongRayDirection=0,this._lastDragPosRigSpace=void 0,Dc&&(At.DrawLine(t,e.worldPosition,65280,.5,!1),At.DrawLabel(e.worldPosition.add(new w(0,.1,0)),this._grabStartDistance.toFixed(2),.03,.5))}onDragStart(e){if(!this.gameObject){console.warn("Error: space follow object doesn't have a gameObject");return}if(e.event.space.add(this._followObject),this._lastDragPosRigSpace=void 0,e.point&&e.normal)this._hitPointInLocalSpace.copy(e.point),this.gameObject.worldToLocal(this._hitPointInLocalSpace),this._hitNormalInLocalSpace.copy(e.normal);else if(e){const v=e.event.space,y=v.worldPosition;this.gameObject.worldToLocal(y),this._hitPointInLocalSpace.copy(y);const g=v.worldUp;this._tempMat.copy(this.gameObject.matrixWorld).invert(),g.transformDirection(this._tempMat),this._hitNormalInLocalSpace.copy(g)}this.recenter(),this._totalMovement.set(0,0,0),this._deviceMode=e.mode;const i=this._followObject.parent.worldForward,r=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrDragMode:this.settings.dragMode,o=this._hitPointInLocalSpace.clone();switch(this.gameObject.localToWorld(o),r){case vr.XZPlane:const v=new w(0,1,0);this.gameObject.parent&&v.transformDirection(this.gameObject.parent.matrixWorld.clone().invert()),this._dragPlane.setFromNormalAndCoplanarPoint(v,o);break;case vr.HitNormal:const y=this._hitNormalInLocalSpace.clone();y.transformDirection(this.gameObject.matrixWorld),this._dragPlane.setFromNormalAndCoplanarPoint(y,o);break;case vr.Attached:this._dragPlane.setFromNormalAndCoplanarPoint(i,o);break;case vr.DynamicViewAngle:this.setPlaneViewAligned(o,!0);break;case vr.SnapToSurfaces:this.setPlaneViewAligned(o,!1);break;case vr.None:break}const a=this.gameObject.parent,l=this.gameObject.position.clone(),c=this.gameObject.quaternion.clone(),h=this.gameObject.scale.clone(),d=this.gameObject.matrixWorld.clone();a&&a.remove(this.gameObject),this.gameObject.position.set(0,0,0),this.gameObject.quaternion.set(0,0,0,1),this.gameObject.scale.set(1,1,1);const f=Ja([this.gameObject]);f.expandByPoint(this.gameObject.worldPosition);const p=new w;f.getCenter(p);const m=new w;f.getSize(m),this._bottomCenter.copy(p.clone().add(new w(0,-m.y/2,0))),this._backCenter.copy(p.clone().add(new w(0,0,m.z/2))),this._backBottomCenter.copy(p.clone().add(new w(0,-m.y/2,m.z/2))),this._bounds.copy(f),a&&a.add(this.gameObject),this.gameObject.position.copy(l),this.gameObject.quaternion.copy(c),this.gameObject.scale.copy(h),this.gameObject.matrixWorld.copy(d),this._draggedOverObject=null,this._draggedOverObjectLastSetUp=null,this._draggedOverObjectLastNormal.set(0,1,0),this._draggedOverObjectDuration=0}collectMovementInfo(){var r,o;if(!this._followObject.parent)return;const e=this._followObject.parent;this._followObject.updateMatrix();const t=e.worldPosition,i=(o=(r=It.active)==null?void 0:r.rig)==null?void 0:o.gameObject;i&&i.worldToLocal(t),(this._lastDragPosRigSpace===void 0||i!=this._lastRig)&&(this._lastDragPosRigSpace=t.clone(),this._lastRig=i),this._tempVec.copy(t).sub(this._lastDragPosRigSpace);const n=e.worldForward;if(i&&(this._tempMat.copy(i.matrixWorld).invert(),n.transformDirection(this._tempMat)),this._totalMovementAlongRayDirection+=n.dot(this._tempVec),this._tempVec.x=Math.abs(this._tempVec.x),this._tempVec.y=Math.abs(this._tempVec.y),this._tempVec.z=Math.abs(this._tempVec.z),this._totalMovement.add(this._tempVec),this._lastDragPosRigSpace.copy(t),Dc){let a=t;i&&(a=a.clone(),a.transformDirection(i.matrixWorld)),At.DrawRay(a,n,255)}}onDragUpdate(e){if(e>1)return;const t=this.gameObject;if(!t||!this._followObject){console.warn("Warning: DragPointerHandler doesn't have a dragged object. This is likely a bug.");return}const i=this._followObject.parent;if(!i){console.warn("Warning: DragPointerHandler doesn't have a drag source. This is likely a bug.");return}this._followObject.updateMatrix();const n=i.worldPosition,r=i.worldForward,o=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer",a=o?this.settings.xrKeepRotation:this.settings.keepRotation,l=o?this.settings.xrDragMode:this.settings.dragMode;if(l===vr.None)return;const c=10;a&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);let h=1,d=2;if(o&&this._grabStartDistance>.5){const _=1+this._totalMovementAlongRayDirection*(2*this.settings.xrDistanceDragFactor);h=Math.max(0,_),h=h*h*h}else this._grabStartDistance<=.5&&(d=3);this._followObject.position.copy(this._followObjectStartPosition),a||this._followObject.quaternion.copy(this._followObjectStartQuaternion),this._followObject.position.multiplyScalar(h),this._followObject.updateMatrix();const f=this._hasLastSurfaceHitPoint;this._hasLastSurfaceHitPoint=!1;const p=new jo(n,r);if(l==vr.SnapToSurfaces){const _=this.context.physics.raycastFromRay(p,{testObject:A=>A!==this.followObject&&A!==i&&A!==t});if(_.length>0){const A=_[0];if(this._draggedOverObject===A.object?this._draggedOverObjectDuration+=this.context.time.deltaTime:(this._draggedOverObject=A.object,this._draggedOverObjectDuration=0),A.face){this._hasLastSurfaceHitPoint=!0,this._lastSurfaceHitPoint.copy(A.point);const b=.15,E=this._draggedOverObjectDuration>=b,C=.001,T=this._totalMovement.length()>=C,M=yt(A.normal||A.face.normal).applyQuaternion(A.object.worldQuaternion);if((E||T)&&(this._draggedOverObjectLastSetUp!==this._draggedOverObject||this._draggedOverObjectLastNormal.dot(M)<.999999||this.context.time.frame%60===0)){this._draggedOverObjectLastSetUp=this._draggedOverObject,this._draggedOverObjectLastNormal.copy(A.face.normal);const R=yt(),S=yt();this._bounds.getCenter(R),this._bounds.getSize(S),R.sub(S.multiplyScalar(.5).multiply(M)),this._hitPointInLocalSpace.copy(R),this._hitNormalInLocalSpace.copy(A.face.normal),this._bounds.getCenter(R),this._bounds.getSize(S),R.add(S.multiplyScalar(.5).multiply(A.face.normal));const I=yt(this._hitPointInLocalSpace).add(R);this._followObject.localToWorld(I);const L=A.point;this._dragPlane.setFromNormalAndCoplanarPoint(M,L)}else if(!(E||T))return}}else f&&this.gameObject&&this.setPlaneViewAligned(this.gameObject.worldPosition,!1)}if(l!==vr.Attached&&p.intersectPlane(this._dragPlane,this._tempVec)){this._followObject.worldPosition=this._tempVec,this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const _=yt(this._hitPointInLocalSpace);this._followObject.localToWorld(_),Dc&&At.DrawLine(_,this._tempVec,65535,0,!1),this._followObject.worldPosition=this._tempVec.multiplyScalar(2).sub(_),this._followObject.updateMatrix(),this._followObject.updateMatrix()}if(this.settings.snapGridResolution>0){const _=this._followObject.worldPosition,A=this.settings.snapGridResolution;_.x=Math.round(_.x/A)*A,_.y=Math.round(_.y/A)*A,_.z=Math.round(_.z/A)*A,this._followObject.worldPosition=_,this._followObject.updateMatrix()}a&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const m=et.clamp01(this.context.time.deltaTime*c*d),v=et.clamp01(this.context.time.deltaTime*c*.5*d),y=t.worldPosition;y.lerp(this._followObject.worldPosition,m),t.worldPosition=y;const g=t.worldQuaternion;if(g.slerp(this._followObject.worldQuaternion,v),t.worldQuaternion=g,Dc){const _=this._hitPointInLocalSpace.clone();t.localToWorld(_),At.DrawSphere(_,.02,16711680);const A=this._hitNormalInLocalSpace.clone();A.applyQuaternion(g),At.DrawRay(_,A,16711680),At.DrawLabel(y.add(new w(0,.25,0)),`Distance: ${this._totalMovement.length().toFixed(2)}

                Along Ray: ${this._totalMovementAlongRayDirection.toFixed(2)}

                Session: ${!!It.active}

                Device: ${this._deviceMode}

                `,.03);const b=this._bottomCenter.clone(),E=this._backCenter.clone(),C=this._backBottomCenter.clone();t.localToWorld(b),t.localToWorld(E),t.localToWorld(C),At.DrawSphere(b,.01,65280,0,!1),At.DrawSphere(E,.01,255,0,!1),At.DrawSphere(C,.01,16711935,0,!1),At.DrawLine(b,C,65535,0,!1),At.DrawLine(C,E,65535,0,!1)}}onDragEnd(e){console.assert(this._followObject.parent===e.event.space,"Drag end: _followObject is not parented to the space object"),this._followObject.removeFromParent(),this._followObject.destroy(),this._lastDragPosRigSpace=void 0}setPlaneViewAligned(e,t){if(!this._followObject.parent)return!1;const i=this._followObject.parent.worldForward,n=yt(0,1,0),r=i,o=n.angleTo(r),a=.5;return t&&(o>Math.PI/2+a||o<Math.PI/2-a)?this._dragPlane.setFromNormalAndCoplanarPoint(n,e):this._dragPlane.setFromNormalAndCoplanarPoint(i,e),!0}}const b2=class{constructor(e){u(this,"showGizmo",!0);u(this,"useViewAngle",!0);u(this,"_selected",null);u(this,"_context",null);u(this,"_camera");u(this,"_cameraPlane",new Ar);u(this,"_hasGroundPlane",!1);u(this,"_groundPlane",new Ar);u(this,"_groundOffset",new w);u(this,"_groundOffsetFactor",0);u(this,"_groundDistance",0);u(this,"_groundPlanePoint",new w);u(this,"_raycaster",new Nd);u(this,"_cameraPlaneOffset",new w);u(this,"_intersection",new w);u(this,"_worldPosition",new w);u(this,"_inverseMatrix",new fe);u(this,"_rbs",[]);u(this,"_groundLine");u(this,"_groundMarker");u(this,"_groundOffsetVector",new w(0,1,0));u(this,"_requireUpdateGroundPlane",!0);u(this,"_didDragOnGroundPlaneLastFrame",!1);this._camera=e;const t=new Rn(b2.geometry),i=t.material;i.color=new me(.4,.4,.4),t.layers.set(2),t.name="line",t.scale.y=1,this._groundLine=t;const n=new Wo(.5,22,22),r=new Kt({color:i.color}),o=new le(n,r);o.visible=!1,o.layers.set(2),this._groundMarker=o}get hasSelected(){return this._selected!==null&&this._selected!==void 0}get selected(){return this._selected}setSelected(e,t){if(this._selected&&t)for(const i of this._rbs)i.wakeUp(),i.setVelocity(0,0,0);if(this._selected&&zc.Remove(t,this._selected),this._selected=e,this._context=t,this._rbs.length=0,e?(t.scene.add(this._groundLine),t.scene.add(this._groundMarker)):(this._groundLine.removeFromParent(),this._groundMarker.removeFromParent()),this._selected){if(!t){console.error("DragHelper: no context");return}zc.Add(t,this._selected,null),this._groundOffsetFactor=0,this._hasGroundPlane=!0,this._groundOffset.set(0,0,0),this._requireUpdateGroundPlane=!0,this.onUpdateScreenSpacePlane()}}onUpdate(e){this._selected}onUpdateWorldPosition(e,t,i){if(this._selected){if(i){const n=Qt(this._selected);n.y=e.y,e=n}if(Os(this._selected,e),Os(this._groundLine,e),this._hasGroundPlane?this._groundLine.scale.y=this._groundDistance:this._groundLine.scale.y=1e3,this._groundLine.visible=this.showGizmo,this._groundMarker.visible=t!==null&&this.showGizmo,t){const n=Qt(this._camera).distanceTo(t)*.01;this._groundMarker.scale.set(n,n,n),Os(this._groundMarker,t)}}}onUpdateScreenSpacePlane(){if(!this._selected||!this._context)return;const e=this._context.input.getPointerPositionRC(0);e&&(this._raycaster.setFromCamera(e,this._camera),this._cameraPlane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._cameraPlane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._cameraPlaneOffset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))))}onUpdateGroundPlane(){if(!this._selected||!this._context)return;const e=Qt(this._selected),t=new jo(yt(0,.1,0).add(e),yt(0,-1,0)),i=new Yc;i.testObject=r=>r!==this._selected;const n=this._context.physics.raycastFromRay(t,i);for(let r=0;r<n.length;r++){const o=n[r];if(!o.face||this.contains(this._selected,o.object))continue;const a=yt(0,1,0);this._groundPlane.setFromNormalAndCoplanarPoint(a,o.point);break}this._hasGroundPlane=!0,this._groundPlane.setFromNormalAndCoplanarPoint(t.direction.multiplyScalar(-1),t.origin),this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection),this._groundDistance=this._intersection.distanceTo(e),this._groundOffset.copy(this._intersection).sub(e)}contains(e,t){if(e===t)return!0;if(e.children){for(const i of e.children)if(this.contains(i,t))return!0}return!1}};let TM=b2;u(TM,"geometry",new pt().setFromPoints([new w(0,0,0),new w(0,-1,0)]));var R0;(function(s){s.File_Spawned="file-spawned"})(R0||(R0={}));class r8{constructor(e,t,i,n,r,o,a,l){u(this,"guid");u(this,"file_name");u(this,"file_hash");u(this,"file_size");u(this,"position");u(this,"seed");u(this,"sender");u(this,"serverUrl");u(this,"parentGuid");u(this,"boundsSize");this.seed=t,this.guid=i,this.file_name=n,this.file_hash=r,this.file_size=o,this.position=a,this.sender=e,this.serverUrl=l}}async function o8(s,e,t){const i=s.name;return i.endsWith(".gltf")||i.endsWith(".glb")||s.type==="model/gltf+json"||s.type==="model/gltf-binary"?new Promise((n,r)=>{const o=new FileReader;o.readAsArrayBuffer(s),o.onloadend=async a=>{const l=o.result,c=hE(),h=new Ls(c),d=await Fl().parseSync(e,l,s.name,h);if(d&&d.scene){const f=d.scene;if(!f.guid){const p=new Ls(c);f.guid=p.generateUUID()}t&&phe(e.connection,s,c,f,t),n(d)}}}):(console.warn("Unsupported file type: "+i,s),null)}async function a8(s,e){return new Promise(async(t,i)=>{const n=hE(),r=new Ls(n),o=s.toString(),a=await Fl().loadSync(e,o,o,r);a&&a.scene?(a.scene,t(a)):console.warn("Unsupported file type: "+s.toString())})}xi.registerCallback(yi.ContextCreated,s=>{l8(s.context)});function l8(s){s.connection.beginListen(R0.File_Spawned,async e=>{if(e.sender!==s.connection.connectionId){console.log("received file event",e),mhe(e,s);let t=null;try{t=await kD(e.file_name,e.file_hash,e.file_size,e.serverUrl)}finally{ghe(e)}if(t){const i=new Ls(e.seed),n=await Fl().parseSync(s,t,e.file_name,i);if(n&&n.scene){const r=n.scene;if(e.parentGuid){const o=A_(e.parentGuid,s.scene);o&&"add"in o&&o.add(r)}r.parent||s.scene.add(r),e.position!==null&&r.position.copy(e.position)}}else console.error("download didnt return file")}})}async function phe(s,e,t,i,n){if(!s.connectionId){console.error("Can not upload file - no connection id");return}if(!i.guid){console.error("Can not upload file - no guid",i,i.guid);return}const r=await N5(e,n);if(!r)return;if(!r.filename){console.error("Can not send upload event - no filename",e.name);return}if(!r.hash){console.error("Can not send upload event - no hash",e.name);return}const o=new r8(s.connectionId,t,i.guid,r.filename,r.hash,e.size,i.position,r.url??n);i.parent&&(o.parentGuid=i.parent.guid),s.send(R0.File_Spawned,o)}const nP={};function mhe(s,e){const t=new Xi,i=new le(t,new Kt({color:65280})),n=new vB(i,5592405);if(nP[s.guid]=n,e.scene.add(n),s.parentGuid){const r=A_(s.parentGuid,e.scene);r&&r.add(n)}s.position&&n.position.copy(s.position)}function ghe(s,e){const t=s.guid,i=nP[t];i&&(delete nP[t],i.removeFromParent())}var H_=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Wu=ie("debugdroplistener");var NS;(function(s){s.FileDropped="file-dropped",s.ObjectAdded="object-added"})(NS||(NS={}));class sf extends Te{constructor(){super(...arguments);u(this,"dropArea");u(this,"fitIntoVolume",!1);u(this,"fitVolumeSize",new w(1,1,1));u(this,"placeAtHitPosition",!0);u(this,"onDropped",new un);u(this,"onNetworkEvent",t=>{var i;if((i=t.guid)!=null&&i.startsWith(this.guid)){const n=t.url;if(n)if(Array.isArray(n))for(const r of n)this.addFromUrl(r,{screenposition:new Z},!0).then(o=>{o==null||o.position.set(t.point.x,t.point.y,t.point.z)});else this.addFromUrl(n,{screenposition:new Z},!0).then(r=>{r==null||r.position.set(t.point.x,t.point.y,t.point.z)})}});u(this,"handlePaste",async t=>{if(this.context.connection.allowEditing===!1)return;if((t.ctrlKey||t.metaKey)&&t.key==="v"){const r=await navigator.clipboard.readText().catch(console.warn);if(r&&(r.startsWith("http")||r.startsWith("https")||r.startsWith("blob"))){const a={screenposition:new Z(this.context.input.mousePosition.x,this.context.input.mousePosition.y)};this.testIfIsInDropArea(a)&&this.addFromUrl(r,a,!1)}}});u(this,"onDrag",t=>{this.context.connection.allowEditing!==!1&&t.preventDefault()});u(this,"onDrop",async t=>{if(this.context.connection.allowEditing===!1||(Wu&&console.log(t),!(t!=null&&t.dataTransfer))||t["droplistener:handled"])return;t.preventDefault();const i={screenposition:new Z(t.offsetX,t.offsetY)};if(this.dropArea&&this.testIfIsInDropArea(i)===!1)return;t["droplistener:handled"]=!0;const n=t.dataTransfer.items;if(n)for(const r in n){const o=n[r];if(o.kind==="file"){const a=o.getAsFile();if(!a)continue;await this.addFiles([a],i)}else o.kind==="string"&&o.type=="text/plain"&&o.getAsString(a=>{this.addFromUrl(a,i,!1)})}});u(this,"_addedObjects",new Array)}onEnable(){this.context.renderer.domElement.addEventListener("dragover",this.onDrag),this.context.renderer.domElement.addEventListener("drop",this.onDrop),window.addEventListener("keyup",this.handlePaste),this.context.connection.beginListen("droplistener",this.onNetworkEvent)}onDisable(){this.context.renderer.domElement.removeEventListener("dragover",this.onDrag),this.context.renderer.domElement.removeEventListener("drop",this.onDrop),window.removeEventListener("keyup",this.handlePaste),this.context.connection.stopListen("droplistener",this.onNetworkEvent)}async addFromUrl(t,i,n){Wu&&console.log("dropped url",t);try{if(t.startsWith("https://github.com/")){const a=t.split("/"),l=a[3],c=a[4],h=a[6],d=a.slice(7).join("/");t=`https://raw.githubusercontent.com/${l}/${c}/${h}/${d}`}else t.startsWith("https://polyhaven.com/a")&&(t=vhe(t));if(!t)return null;const r=t.toLowerCase();if(r.endsWith(".hdr")||r.endsWith(".hdri")||r.endsWith(".exr")||r.endsWith(".png")||r.endsWith(".jpg")||r.endsWith(".jpeg"))return null;const o=await a8(new URL(t),this.context);if(o)return i.url=t,this.addObject(o,i,n)}catch{console.warn("String is not a valid URL",t)}return null}async addFiles(t,i){if(Wu&&console.log("Add files",t),!!Array.isArray(t)&&t.length)for(const n of t){if(!n)continue;Wu&&console.log("Register file "+n.name,n);const r=await o8(n,this.context);this.dispatchEvent(new CustomEvent(NS.FileDropped,{detail:n})),r&&this.addObject(r,i,!1)}}addObject(t,i,n){var a,l;if(Wu&&console.log(`Dropped ${this.gameObject.name}`,t),!(t!=null&&t.scene))return console.warn("No object specified to add to scene",t),null;for(const c of this._addedObjects)c.parent===this.gameObject&&ba(c,!0,!0);this._addedObjects.length=0;const r=t.scene;this.gameObject.attach(r),r.position.set(0,0,0),r.quaternion.identity(),this._addedObjects.push(r),Wu&&r.add(new xo(1));const o=new Si().setFromCenterAndSize(new w(0,this.fitVolumeSize.y*.5,0).add(this.gameObject.worldPosition),this.fitVolumeSize);if(Wu&&At.DrawWireBox3(o,255,5),this.fitIntoVolume&&iH(r,o,{position:!this.placeAtHitPosition}),this.placeAtHitPosition&&i&&i.screenposition){r.visible=!1;const c=this.context.physics.raycast({screenPoint:this.context.input.convertScreenspaceToRaycastSpace(i.screenposition.clone())});if(r.visible=!0,c&&c.length>0)for(const h of c){const d=h.point.clone();Wu&&console.log("Place object at hit",h),nH(r,d);break}}if(nv.assignAnimationsFromFile(t,{createAnimationComponent:c=>ya(c,qr)}),this.dispatchEvent(new CustomEvent(NS.ObjectAdded,{detail:t})),(a=this.onDropped)==null||a.invoke({sender:this,gltf:t}),!n&&((l=i.url)!=null&&l.startsWith("http"))&&this.context.connection.isConnected&&r){const c={guid:this.guid,url:i.url,point:r.position.clone()};this.context.connection.send("droplistener",c)}return r}testIfIsInDropArea(t){if(this.dropArea){const i=this.context.input.convertScreenspaceToRaycastSpace(t.screenposition.clone());if(!this.context.physics.raycast({targets:[this.dropArea],screenPoint:i,recursive:!0,testObject:r=>!this._addedObjects.includes(r)}).length)return Xe()&&console.log(`Dropped outside of drop area for DropListener "${this.name}".`),!1}return!0}}H_([x(ge)],sf.prototype,"dropArea",void 0);H_([x()],sf.prototype,"fitIntoVolume",void 0);H_([x(w)],sf.prototype,"fitVolumeSize",void 0);H_([x()],sf.prototype,"placeAtHitPosition",void 0);H_([x(un)],sf.prototype,"onDropped",void 0);function vhe(s){if(!s.startsWith("https://polyhaven.com/"))return s;const e="https://dl.polyhaven.org/file/ph-assets/Models/gltf/4k/",n=new URL(s).pathname.split("/").pop(),r=`${e}${n}/${n}_4k.gltf`;return console.log("Resolved polyhaven asset url",s,"→",r),r}var HE=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class Su extends Te{constructor(){super(...arguments);u(this,"parent",null);u(this,"object",null);u(this,"limitCount",10);u(this,"limitInterval",60);u(this,"_currentCount",0);u(this,"_startPosition",null);u(this,"_startQuaternion",null);u(this,"_forwardPointerEvents",new Map)}start(){var t,i;if(this._currentCount=0,this._startPosition=null,this._startQuaternion=null,this.object||(this.object=this.gameObject),this.object){if(this.object===this.gameObject){const r=new Ls(this.guid);this.object=ne.instantiate(this.object,{idProvider:r,keepWorldPosition:!1});const o=ne.getComponent(this.object,Su);o==null||o.destroy();let a=this.object.getComponentInChildren(Bs);a||(a=this.object.addComponent(Bs,{dragMode:vr.SnapToSurfaces}),a.guid=r.generateUUID());let l=ne.getComponent(a.gameObject,Kc);l||(l=a.gameObject.addComponent(Kc),l.guid=r.generateUUID())}this.object.visible=!1;const n=this.gameObject.getComponent(Bs);n&&(n.enabled=!1),this._startPosition=((t=this.object.position)==null?void 0:t.clone())??new w(0,0,0),this._startQuaternion=((i=this.object.quaternion)==null?void 0:i.clone())??new xe(0,0,0,1)}this.gameObject.getComponentInParent(xa)||this.gameObject.addComponent(xa),this.cloneLimitIntervalFn()}onPointerEnter(t){t.used||this.object&&this.context.connection.allowEditing&&t.button===0&&this.context.input.setCursorPointer()}onPointerExit(t){t.used||this.object&&this.context.connection.allowEditing&&t.button===0&&this.context.input.setCursorNormal()}onPointerDown(t){if(t.used||!this.object||!this.context.connection.allowEditing||t.button!==0)return;const i=this.handleDuplication();if(i){const n=ne.getComponent(i,Bs);n?(n.onPointerDown(t),this._forwardPointerEvents.set(t.event.space,n)):console.warn("Duplicated object does not have DragControls",i)}else console.warn("Could not duplicate object. Has the target object been destroyed?",this)}onPointerUp(t){if(t.used)return;const i=this._forwardPointerEvents.get(t.event.space);i&&(i.onPointerUp(t),this._forwardPointerEvents.delete(t.event.space))}cloneLimitIntervalFn(){this.destroyed||(this._currentCount>0&&(this._currentCount-=1),setTimeout(()=>{this.cloneLimitIntervalFn()},this.limitInterval/this.limitCount*1e3))}handleDuplication(){var n;if(!this.object||this._currentCount>=this.limitCount||this.object===this.gameObject)return null;if(ne.isDestroyed(this.object))return this.object=null,null;this.object.visible=!0,this._startPosition&&this.object.position.copy(this._startPosition),this._startQuaternion&&this.object.quaternion.copy(this._startQuaternion);const t=new Gl;this.parent||(this.parent=this.gameObject.parent),this.parent&&(t.parent=this.parent.guid??((n=this.parent.userData)==null?void 0:n.guid),t.keepWorldPosition=!0),t.position=this.worldPosition,t.rotation=this.worldQuaternion,t.context=this.context,this._currentCount+=1;const i=ne.instantiateSynced(this.object,t);return console.assert(i!==this.object,"Duplicated object is original"),this.object.visible=!1,this._startPosition&&this.object.position.clone().copy(this._startPosition),this._startQuaternion&&this.object.quaternion.clone().copy(this._startQuaternion),i}}HE([x(ge)],Su.prototype,"parent",void 0);HE([x(ge)],Su.prototype,"object",void 0);HE([x()],Su.prototype,"limitCount",void 0);HE([x()],Su.prototype,"limitInterval",void 0);class P0 extends er{constructor(t){super();u(this,"effect");this.effect=t}get typeName(){return this.effect.constructor.name}onCreateEffect(){return this.effect}}var qf;(function(s){s[s.PointerEnter=0]="PointerEnter",s[s.PointerExit=1]="PointerExit",s[s.PointerDown=2]="PointerDown",s[s.PointerUp=3]="PointerUp",s[s.PointerClick=4]="PointerClick",s[s.Drag=5]="Drag",s[s.Drop=6]="Drop",s[s.Scroll=7]="Scroll",s[s.UpdateSelected=8]="UpdateSelected",s[s.Select=9]="Select",s[s.Deselect=10]="Deselect",s[s.Move=11]="Move",s[s.InitializePotentialDrag=12]="InitializePotentialDrag",s[s.BeginDrag=13]="BeginDrag",s[s.EndDrag=14]="EndDrag",s[s.Submit=15]="Submit",s[s.Cancel=16]="Cancel"})(qf||(qf={}));var IO=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class RO{constructor(){u(this,"eventID");u(this,"callback")}}IO([x()],RO.prototype,"eventID",void 0);IO([x(un)],RO.prototype,"callback",void 0);class VE extends Te{constructor(){super(...arguments);u(this,"triggers",[])}invoke(t){var i;if(this.triggers)for(const n of this.triggers)n.eventID===t&&((i=n.callback)==null||i.invoke())}onPointerClick(t){this.invoke(qf.PointerClick)}onPointerEnter(t){this.invoke(qf.PointerEnter)}onPointerExit(t){this.invoke(qf.PointerExit)}onPointerDown(t){this.invoke(qf.PointerDown)}onPointerUp(t){this.invoke(qf.PointerUp)}}IO([x(RO)],VE.prototype,"triggers",void 0);var PO=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class BO extends Te{constructor(){super(...arguments);u(this,"connectedBody");u(this,"_rigidBody",null)}get rigidBody(){return this._rigidBody}onEnable(){this._rigidBody||(this._rigidBody=this.gameObject.getComponent(Ci)),this.rigidBody&&this.connectedBody&&this.startCoroutine(this.create())}*create(){yield,this.rigidBody&&this.connectedBody&&this.activeAndEnabled&&this.createJoint(this.rigidBody,this.connectedBody)}}PO([x(Ci)],BO.prototype,"connectedBody",void 0);class DO extends BO{createJoint(e,t){var i;(i=this.context.physics.engine)==null||i.addFixedJoint(e,t)}}class V_ extends BO{constructor(){super(...arguments);u(this,"anchor");u(this,"axis")}createJoint(t,i){var n;this.axis&&this.anchor&&((n=this.context.physics.engine)==null||n.addHingeJoint(t,i,this.anchor,this.axis))}}PO([x(w)],V_.prototype,"anchor",void 0);PO([x(w)],V_.prototype,"axis",void 0);const yhe={type:"change"};let Ahe=class extends Zs{constructor(e,t){super(),this.object=e,this.domElement=t,this.enabled=!0,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const i=this,n=1e-6,r=new xe,o=new w;this.tmpQuaternion=new xe,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new w(0,0,0),this.rotationVector=new w(0,0,0),this.keydown=function(m){if(!(m.altKey||this.enabled===!1)){switch(m.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(m){if(this.enabled!==!1){switch(m.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()}},this.pointerdown=function(m){if(this.enabled!==!1)if(this.dragToLook)this.status++;else{switch(m.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(m){if(this.enabled!==!1&&(!this.dragToLook||this.status>0)){const v=this.getContainerDimensions(),y=v.size[0]/2,g=v.size[1]/2;this.moveState.yawLeft=-(m.pageX-v.offset[0]-y)/y,this.moveState.pitchDown=(m.pageY-v.offset[1]-g)/g,this.updateRotationVector()}},this.pointerup=function(m){if(this.enabled!==!1){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(m.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()}},this.pointercancel=function(){this.enabled!==!1&&(this.dragToLook?(this.status=0,this.moveState.yawLeft=this.moveState.pitchDown=0):(this.moveState.forward=0,this.moveState.back=0,this.updateMovementVector()),this.updateRotationVector())},this.contextMenu=function(m){this.enabled!==!1&&m.preventDefault()},this.update=function(m){if(this.enabled===!1)return;const v=m*i.movementSpeed,y=m*i.rollSpeed;i.object.translateX(i.moveVector.x*v),i.object.translateY(i.moveVector.y*v),i.object.translateZ(i.moveVector.z*v),i.tmpQuaternion.set(i.rotationVector.x*y,i.rotationVector.y*y,i.rotationVector.z*y,1).normalize(),i.object.quaternion.multiply(i.tmpQuaternion),(o.distanceToSquared(i.object.position)>n||8*(1-r.dot(i.object.quaternion))>n)&&(i.dispatchEvent(yhe),r.copy(i.object.quaternion),o.copy(i.object.position))},this.updateMovementVector=function(){const m=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-m+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",a),this.domElement.removeEventListener("pointerdown",c),this.domElement.removeEventListener("pointermove",l),this.domElement.removeEventListener("pointerup",h),this.domElement.removeEventListener("pointercancel",d),window.removeEventListener("keydown",f),window.removeEventListener("keyup",p)};const a=this.contextMenu.bind(this),l=this.pointermove.bind(this),c=this.pointerdown.bind(this),h=this.pointerup.bind(this),d=this.pointercancel.bind(this),f=this.keydown.bind(this),p=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",a),this.domElement.addEventListener("pointerdown",c),this.domElement.addEventListener("pointermove",l),this.domElement.addEventListener("pointerup",h),this.domElement.addEventListener("pointercancel",d),window.addEventListener("keydown",f),window.addEventListener("keyup",p),this.updateMovementVector(),this.updateRotationVector()}};class OO extends Te{constructor(){super(...arguments);u(this,"_controls",null)}onEnable(){var i;const t=(i=ne.getComponent(this.gameObject,Mi))==null?void 0:i.threeCamera;if(!t){console.warn("FlyControls: Requires a Camera component on the same object as this component.");return}this._controls=new Ahe(t,this.context.renderer.domElement),this._controls.rollSpeed=.5,this._controls.movementSpeed=3,this._controls.dragToLook=!0}onDisable(){var t;(t=this._controls)==null||t.dispose(),this._controls=null}update(){this._controls&&this._controls.update(this.context.time.deltaTime)}}var LO=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r},sP;(function(s){s[s.Linear=1]="Linear",s[s.Exponential=2]="Exponential",s[s.ExponentialSquared=3]="ExponentialSquared"})(sP||(sP={}));class kv extends Te{constructor(){super(...arguments);u(this,"_fog")}get fog(){return this._fog||(this._fog=new SC(0,0,50)),this._fog}get mode(){return sP.Linear}set near(t){this.fog.near=t}get near(){return this.fog.near}set far(t){this.fog.far=t}get far(){return this.fog.far}set color(t){this.fog.color.copy(t)}get color(){return this.fog.color}onEnable(){this.scene.fog=this.fog}onDisable(){this.scene.fog===this._fog&&(this.scene.fog=null)}}LO([x()],kv.prototype,"near",null);LO([x()],kv.prototype,"far",null);LO([x(me)],kv.prototype,"color",null);let Sy,MM,Hm,Gx;function IM(s,e=1/0,t=null){MM||(MM=new _s(2,2,1,1)),Hm||(Hm=new Rt({uniforms:{blitTexture:new Se(s)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),Hm.uniforms.blitTexture.value=s,Hm.defines.IS_SRGB=s.colorSpace==_t,Hm.needsUpdate=!0,Gx||(Gx=new le(MM,Hm),Gx.frustrumCulled=!1);const i=new zt,n=new Ks;n.add(Gx),t===null&&(t=Sy=new eh({antialias:!1}));const r=Math.min(s.image.width,e),o=Math.min(s.image.height,e);t.setSize(r,o),t.clear(),t.render(n,i);const a=document.createElement("canvas"),l=a.getContext("2d");a.width=r,a.height=o,l.drawImage(t.domElement,0,0,r,o);const c=new JP(a);return c.minFilter=s.minFilter,c.magFilter=s.magFilter,c.wrapS=s.wrapS,c.wrapT=s.wrapT,c.name=s.name,Sy&&(Sy.forceContextLoss(),Sy.dispose(),Sy=null),c}const E3={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class QE{constructor(){this.pluginCallbacks=[],this.register(function(e){return new Ihe(e)}),this.register(function(e){return new Rhe(e)}),this.register(function(e){return new Dhe(e)}),this.register(function(e){return new Ohe(e)}),this.register(function(e){return new Lhe(e)}),this.register(function(e){return new khe(e)}),this.register(function(e){return new Phe(e)}),this.register(function(e){return new Bhe(e)}),this.register(function(e){return new Fhe(e)}),this.register(function(e){return new Uhe(e)}),this.register(function(e){return new Nhe(e)}),this.register(function(e){return new zhe(e)}),this.register(function(e){return new Ghe(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){const r=new Mhe,o=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)o.push(this.pluginCallbacks[a](r));r.setPlugins(o),r.write(e,t,n).catch(i)}parseAsync(e,t){const i=this;return new Promise(function(n,r){i.parse(e,n,r,t)})}}const _i={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},RM="KHR_mesh_quantization",pa={};pa[ei]=_i.NEAREST;pa[Qg]=_i.NEAREST_MIPMAP_NEAREST;pa[zh]=_i.NEAREST_MIPMAP_LINEAR;pa[Nt]=_i.LINEAR;pa[cp]=_i.LINEAR_MIPMAP_NEAREST;pa[go]=_i.LINEAR_MIPMAP_LINEAR;pa[ps]=_i.CLAMP_TO_EDGE;pa[wo]=_i.REPEAT;pa[du]=_i.MIRRORED_REPEAT;const T3={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},_he=new me,M3=12,bhe=1179937895,xhe=2,I3=8,whe=1313821514,She=5130562;function eA(s,e){return s.length===e.length&&s.every(function(t,i){return t===e[i]})}function Che(s){return new TextEncoder().encode(s).buffer}function Ehe(s){return eA(s.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function The(s,e,t){const i={min:new Array(s.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(s.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=e;n<e+t;n++)for(let r=0;r<s.itemSize;r++){let o;s.itemSize>4?o=s.array[n*s.itemSize+r]:(r===0?o=s.getX(n):r===1?o=s.getY(n):r===2?o=s.getZ(n):r===3&&(o=s.getW(n)),s.normalized===!0&&(o=li.normalize(o,s.array))),i.min[r]=Math.min(i.min[r],o),i.max[r]=Math.max(i.max[r],o)}return i}function c8(s){return Math.ceil(s/4)*4}function PM(s,e=0){const t=c8(s.byteLength);if(t!==s.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(s)),e!==0)for(let n=s.byteLength;n<t;n++)i[n]=e;return i.buffer}return s}function R3(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function P3(s,e){if(s.toBlob!==void 0)return new Promise(i=>s.toBlob(i,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),s.convertToBlob({type:e,quality:t})}class Mhe{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const n=this,r=n.buffers,o=n.json;i=n.options;const a=n.extensionsUsed,l=n.extensionsRequired,c=new Blob(r,{type:"application/octet-stream"}),h=Object.keys(a),d=Object.keys(l);if(h.length>0&&(o.extensionsUsed=h),d.length>0&&(o.extensionsRequired=d),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=c.size),i.binary===!0){const f=new FileReader;f.readAsArrayBuffer(c),f.onloadend=function(){const p=PM(f.result),m=new DataView(new ArrayBuffer(I3));m.setUint32(0,p.byteLength,!0),m.setUint32(4,She,!0);const v=PM(Che(JSON.stringify(o)),32),y=new DataView(new ArrayBuffer(I3));y.setUint32(0,v.byteLength,!0),y.setUint32(4,whe,!0);const g=new ArrayBuffer(M3),_=new DataView(g);_.setUint32(0,bhe,!0),_.setUint32(4,xhe,!0);const A=M3+y.byteLength+v.byteLength+m.byteLength+p.byteLength;_.setUint32(8,A,!0);const b=new Blob([g,y,v,m,p],{type:"application/octet-stream"}),E=new FileReader;E.readAsArrayBuffer(b),E.onloadend=function(){t(E.result)}}}else if(o.buffers&&o.buffers.length>0){const f=new FileReader;f.readAsDataURL(c),f.onloadend=function(){const p=f.result;o.buffers[0].uri=p,t(o)}}else t(o)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const i=this.options,n=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&r.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in r.gltfExtensions)t.extensions[o]=r.gltfExtensions[o],n[o]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(e,n)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new w;for(let n=0,r=e.count;n<r;n++)if(Math.abs(i.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),n=new w;for(let r=0,o=i.count;r<o;r++)n.fromBufferAttribute(i,r),n.x===0&&n.y===0&&n.z===0?n.setX(1):n.normalize(),i.setXYZ(r,n.x,n.y,n.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const n={};(t.offset.x!==0||t.offset.y!==0)&&(n.offset=t.offset.toArray(),i=!0),t.rotation!==0&&(n.rotation=t.rotation,i=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(n.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(p){return p.colorSpace===_t?function(v){return v<.04045?v*.0773993808:Math.pow(v*.9478672986+.0521327014,2.4)}:function(v){return v}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof Oc&&(e=IM(e)),t instanceof Oc&&(t=IM(t));const n=e?e.image:null,r=t?t.image:null,o=Math.max(n?n.width:0,r?r.width:0),a=Math.max(n?n.height:0,r?r.height:0),l=R3();l.width=o,l.height=a;const c=l.getContext("2d");c.fillStyle="#00ffff",c.fillRect(0,0,o,a);const h=c.getImageData(0,0,o,a);if(n){c.drawImage(n,0,0,o,a);const p=i(e),m=c.getImageData(0,0,o,a).data;for(let v=2;v<m.length;v+=4)h.data[v]=p(m[v]/256)*256}if(r){c.drawImage(r,0,0,o,a);const p=i(t),m=c.getImageData(0,0,o,a).data;for(let v=1;v<m.length;v+=4)h.data[v]=p(m[v]/256)*256}c.putImageData(h,0,0);const f=(e||t).clone();return f.source=new qh(l),f.colorSpace=jr,f.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),f}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,n,r){const o=this.json;o.bufferViews||(o.bufferViews=[]);let a;switch(t){case _i.BYTE:case _i.UNSIGNED_BYTE:a=1;break;case _i.SHORT:case _i.UNSIGNED_SHORT:a=2;break;default:a=4}const l=c8(n*e.itemSize*a),c=new DataView(new ArrayBuffer(l));let h=0;for(let p=i;p<i+n;p++)for(let m=0;m<e.itemSize;m++){let v;e.itemSize>4?v=e.array[p*e.itemSize+m]:(m===0?v=e.getX(p):m===1?v=e.getY(p):m===2?v=e.getZ(p):m===3&&(v=e.getW(p)),e.normalized===!0&&(v=li.normalize(v,e.array))),t===_i.FLOAT?c.setFloat32(h,v,!0):t===_i.INT?c.setInt32(h,v,!0):t===_i.UNSIGNED_INT?c.setUint32(h,v,!0):t===_i.SHORT?c.setInt16(h,v,!0):t===_i.UNSIGNED_SHORT?c.setUint16(h,v,!0):t===_i.BYTE?c.setInt8(h,v):t===_i.UNSIGNED_BYTE&&c.setUint8(h,v),h+=a}const d={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};return r!==void 0&&(d.target=r),r===_i.ARRAY_BUFFER&&(d.byteStride=e.itemSize*a),this.byteOffset+=l,o.bufferViews.push(d),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(n){const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){const o=PM(r.result),a={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,n(i.bufferViews.push(a)-1)}})}processAccessor(e,t,i,n){const r=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=_i.FLOAT;else if(e.array.constructor===Int32Array)a=_i.INT;else if(e.array.constructor===Uint32Array)a=_i.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=_i.SHORT;else if(e.array.constructor===Uint16Array)a=_i.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=_i.BYTE;else if(e.array.constructor===Uint8Array)a=_i.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(i===void 0&&(i=0),(n===void 0||n===1/0)&&(n=e.count),n===0)return null;const l=The(e,i,n);let c;t!==void 0&&(c=e===t.index?_i.ELEMENT_ARRAY_BUFFER:_i.ARRAY_BUFFER);const h=this.processBufferView(e,a,i,n,c),d={bufferView:h.id,byteOffset:h.byteOffset,componentType:a,count:n,max:l.max,min:l.min,type:o[e.itemSize]};return e.normalized===!0&&(d.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(d)-1}processImage(e,t,i,n="image/png"){if(e!==null){const r=this,o=r.cache,a=r.json,l=r.options,c=r.pending;o.images.has(e)||o.images.set(e,{});const h=o.images.get(e),d=n+":flipY/"+i.toString();if(h[d]!==void 0)return h[d];a.images||(a.images=[]);const f={mimeType:n},p=R3();p.width=Math.min(e.width,l.maxTextureSize),p.height=Math.min(e.height,l.maxTextureSize);const m=p.getContext("2d");if(i===!0&&(m.translate(0,p.height),m.scale(1,-1)),e.data!==void 0){t!==Ti&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const y=new Uint8ClampedArray(e.height*e.width*4);for(let g=0;g<y.length;g+=4)y[g+0]=e.data[g+0],y[g+1]=e.data[g+1],y[g+2]=e.data[g+2],y[g+3]=e.data[g+3];m.putImageData(new ImageData(y,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)m.drawImage(e,0,0,p.width,p.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");l.binary===!0?c.push(P3(p,n).then(y=>r.processBufferViewImage(y)).then(y=>{f.bufferView=y})):p.toDataURL!==void 0?f.uri=p.toDataURL(n):c.push(P3(p,n).then(y=>new FileReader().readAsDataURL(y)).then(y=>{f.uri=y}));const v=a.images.push(f)-1;return h[d]=v,v}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:pa[e.magFilter],minFilter:pa[e.minFilter],wrapS:pa[e.wrapS],wrapT:pa[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const i=this.options,n=this.cache,r=this.json;if(n.textures.has(e))return n.textures.get(e);const o={keep:!0,newTexture:null};if(this._invokeAll(function(h){h.beforeWriteTexture&&h.beforeWriteTexture(e,o)}),o.keep===!1)return null;o.newTexture!=null&&(e=o.newTexture),r.textures||(r.textures=[]),e instanceof Oc&&(e=IM(e,i.maxTextureSize));let a=e.userData.mimeType;a==="image/webp"&&(a="image/png");const l={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,a)};e.name&&(l.name=e.name),this._invokeAll(function(h){h.writeTexture&&h.writeTexture(e,l)});const c=r.textures.push(l)-1;return n.textures.set(e,c),c}processMaterial(e){var c,h,d,f,p;const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const n={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);eA(r,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=.5,n.pbrMetallicRoughness.roughnessFactor=.5);const o=(c=e.metalnessMap)!=null&&c.image?e.metalnessMap:void 0,a=(h=e.roughnessMap)!=null&&h.image?e.roughnessMap:void 0;if(o||a){const m=this.buildMetalRoughTexture(o,a),v={index:this.processTexture(m),channel:m.channel};this.applyTextureTransform(v,m),n.pbrMetallicRoughness.metallicRoughnessTexture=v}if(e.map){const m={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(m,e.map),n.pbrMetallicRoughness.baseColorTexture=m}if(e.emissive){const m=e.emissive;if(Math.max(m.r,m.g,m.b)>0&&(n.emissiveFactor=e.emissive.toArray()),(d=e.emissiveMap)!=null&&d.image){const y={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(y,e.emissiveMap),n.emissiveTexture=y}}if((f=e.normalMap)!=null&&f.image){const m={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(m.scale=e.normalScale.x),this.applyTextureTransform(m,e.normalMap),n.normalTexture=m}if((p=e.aoMap)!=null&&p.image){const m={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(m.strength=e.aoMapIntensity),this.applyTextureTransform(m,e.aoMap),n.occlusionTexture=m}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===Pi&&(n.doubleSided=!0),e.name!==""&&(n.name=e.name),this.serializeUserData(e,n),this._invokeAll(function(m){m.writeMaterial&&m.writeMaterial(e,n)});const l=i.materials.push(n)-1;return t.materials.set(e,l),l}processMesh(e){const t={keep:!0};if(this._invokeAll(function(E){E.beforeWriteMesh&&E.beforeWriteMesh(e,t)}),t.keep!=!0)return null;const i=this.cache,n=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let E=0,C=e.material.length;E<C;E++)r.push(e.material[E].uuid);else r.push(e.material.uuid);const o=r.join(":");if(i.meshes.has(o))return i.meshes.get(o);const a=e.geometry;let l;e.isLineSegments?l=_i.LINES:e.isLineLoop?l=_i.LINE_LOOP:e.isLine?l=_i.LINE_STRIP:e.isPoints?l=_i.POINTS:l=e.material.wireframe?_i.LINES:_i.TRIANGLES;const c={},h={},d=[],f=[],p={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},m=a.getAttribute("normal");m!==void 0&&!this.isNormalizedNormalAttribute(m)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),a.setAttribute("normal",this.createNormalizedNormalAttribute(m)));let v=null;for(let E in a.attributes){if(E.slice(0,5)==="morph")continue;const C=a.attributes[E];if(E=p[E]||E.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(E)||(E="_"+E),i.attributes.has(this.getUID(C))){h[E]=i.attributes.get(this.getUID(C));continue}v=null;const M=C.array;E==="JOINTS_0"&&!(M instanceof Uint16Array)&&!(M instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),v=new ot(new Uint16Array(M),C.itemSize,C.normalized));const R=this.processAccessor(v||C,a);R!==null&&(E.startsWith("_")||this.detectMeshQuantization(E,C),h[E]=R,i.attributes.set(this.getUID(C),R))}if(m!==void 0&&a.setAttribute("normal",m),Object.keys(h).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const E=[],C=[],T={};if(e.morphTargetDictionary!==void 0)for(const M in e.morphTargetDictionary)T[e.morphTargetDictionary[M]]=M;for(let M=0;M<e.morphTargetInfluences.length;++M){const R={};let S=!1;for(const I in a.morphAttributes){if(I!=="position"&&I!=="normal"){S||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),S=!0);continue}const L=a.morphAttributes[I][M],U=I.toUpperCase(),D=a.attributes[I];if(i.attributes.has(this.getUID(L,!0))){R[U]=i.attributes.get(this.getUID(L,!0));continue}const V=L.clone();if(!a.morphTargetsRelative)for(let O=0,F=L.count;O<F;O++)for(let N=0;N<L.itemSize;N++)N===0&&V.setX(O,L.getX(O)-D.getX(O)),N===1&&V.setY(O,L.getY(O)-D.getY(O)),N===2&&V.setZ(O,L.getZ(O)-D.getZ(O)),N===3&&V.setW(O,L.getW(O)-D.getW(O));R[U]=this.processAccessor(V,a),i.attributes.set(this.getUID(D,!0),R[U])}f.push(R),E.push(e.morphTargetInfluences[M]),e.morphTargetDictionary!==void 0&&C.push(T[M])}c.weights=E,C.length>0&&(c.extras={},c.extras.targetNames=C)}const y=Array.isArray(e.material);if(y&&a.groups.length===0)return null;let g=!1;if(y&&a.index===null){const E=[];for(let C=0,T=a.attributes.position.count;C<T;C++)E[C]=C;a.setIndex(E),g=!0}const _=y?e.material:[e.material],A=y?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let E=0,C=A.length;E<C;E++){const T={mode:l,attributes:h};if(this.serializeUserData(a,T),f.length>0&&(T.targets=f),a.index!==null){let R=this.getUID(a.index);(A[E].start!==void 0||A[E].count!==void 0)&&(R+=":"+A[E].start+":"+A[E].count),i.attributes.has(R)?T.indices=i.attributes.get(R):(T.indices=this.processAccessor(a.index,a,A[E].start,A[E].count),i.attributes.set(R,T.indices)),T.indices===null&&delete T.indices}const M=this.processMaterial(_[A[E].materialIndex]);M!==null&&(T.material=M),d.push(T)}g===!0&&a.setIndex(null),c.primitives=d,n.meshes||(n.meshes=[]),this._invokeAll(function(E){E.writeMesh&&E.writeMesh(e,c)});const b=n.meshes.push(c)-1;return i.meshes.set(o,b),b}detectMeshQuantization(e,t){if(this.extensionsUsed[RM])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const n=e.split("_",1)[0];E3[n]&&E3[n].includes(i)&&(this.extensionsUsed[RM]=!0,this.extensionsRequired[RM]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,n={type:i?"orthographic":"perspective"};return i?n.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:li.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(n.name=e.type),t.cameras.push(n)-1}processAnimation(e,t){const i=this.json,n=this.nodeMap;i.animations||(i.animations=[]),e=QE.Utils.mergeMorphTargetTracks(e.clone(),t);const r=e.tracks,o=[],a=[];for(let l=0;l<r.length;++l){const c=r[l],h=Xt.parseTrackName(c.name);let d=Xt.findNode(t,h.nodeName);const f=T3[h.propertyName];if(h.objectName==="bones"&&(d.isSkinnedMesh===!0?d=d.skeleton.getBoneByName(h.objectIndex):d=void 0),!d||!f)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name),null;const p=1;let m=c.values.length/c.times.length;f===T3.morphTargetInfluences&&(m/=d.morphTargetInfluences.length);let v;c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(v="CUBICSPLINE",m/=3):c.getInterpolation()===Ip?v="STEP":v="LINEAR",a.push({input:this.processAccessor(new ot(c.times,p)),output:this.processAccessor(new ot(c.values,m)),interpolation:v}),o.push({sampler:a.length-1,target:{node:n.get(d),path:f}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:a,channels:o}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,n=t.nodes[i.get(e)],r=e.skeleton;if(r===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const a=[],l=new Float32Array(r.bones.length*16),c=new fe;for(let d=0;d<r.bones.length;++d)a.push(i.get(r.bones[d])),c.copy(r.boneInverses[d]),c.multiply(e.bindMatrix).toArray(l,d*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new ot(l,16)),joints:a,skeleton:i.get(o)}),n.skin=t.skins.length-1}processNode(e){const t={keep:!0};if(this._invokeAll(function(l){l.beforeWriteNode&&l.beforeWriteNode(e,t)}),t.keep!=!0)return null;const i=this.json,n=this.options,r=this.nodeMap;i.nodes||(i.nodes=[]);const o={};if(n.trs){const l=e.quaternion.toArray(),c=e.position.toArray(),h=e.scale.toArray();eA(l,[0,0,0,1])||(o.rotation=l),eA(c,[0,0,0])||(o.translation=c),eA(h,[1,1,1])||(o.scale=h)}else e.matrixAutoUpdate&&e.updateMatrix(),Ehe(e.matrix)===!1&&(o.matrix=e.matrix.elements);if(e.name!==""&&(o.name=String(e.name)),this.serializeUserData(e,o),e.isMesh||e.isLine||e.isPoints){const l=this.processMesh(e);l!==null&&(o.mesh=l)}else e.isCamera&&(o.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const l=[];for(let c=0,h=e.children.length;c<h;c++){const d=e.children[c];if(d.visible||n.onlyVisible===!1){const f=this.processNode(d);f!==null&&l.push(f)}}l.length>0&&(o.children=l)}this._invokeAll(function(l){l.writeNode&&l.writeNode(e,o)});const a=i.nodes.push(o)-1;return r.set(e,a),a}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const n={};e.name!==""&&(n.name=e.name),t.scenes.push(n);const r=[];for(let o=0,a=e.children.length;o<a;o++){const l=e.children[o];if(l.visible||i.onlyVisible===!1){const c=this.processNode(l);c!==null&&r.push(c)}}r.length>0&&(n.nodes=r),this.serializeUserData(e,n)}processObjects(e){const t=new Ks;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(n){n.beforeParse&&n.beforeParse(e)});const i=[];for(let n=0;n<e.length;n++)e[n]instanceof Ks?this.processScene(e[n]):i.push(e[n]);i.length>0&&this.processObjects(i);for(let n=0;n<this.skins.length;++n)this.processSkin(this.skins[n]);for(let n=0;n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);this._invokeAll(function(n){n.afterParse&&n.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class Ihe{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const i=this.writer,n=i.json,r=i.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(1-e.penumbra)*e.angle,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(n.extensions=n.extensions||{},n.extensions[this.name]={lights:[]},r[this.name]=!0);const a=n.extensions[this.name].lights;a.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class Rhe{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Phe{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(o,e.clearcoatMap),r.clearcoatTexture=o}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(o,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};i.applyTextureTransform(o,e.clearcoatNormalMap),r.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Bhe{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(o,e.iridescenceMap),r.iridescenceTexture=o}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(o,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Dhe{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const o={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(o,e.transmissionMap),r.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Ohe{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const o={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(o,e.thicknessMap),r.thicknessTexture=o}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Lhe{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const n=this.writer.extensionsUsed,r={};r.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class khe{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(_he)&&!e.specularIntensityMap&&!e.specularColorMap)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.specularIntensityMap){const o={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(o,e.specularIntensityMap),r.specularTexture=o}if(e.specularColorMap){const o={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(o,e.specularColorMap),r.specularColorTexture=o}r.specularFactor=e.specularIntensity,r.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Fhe{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.sheenRoughnessMap){const o={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(o,e.sheenRoughnessMap),r.sheenRoughnessTexture=o}if(e.sheenColorMap){const o={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(o,e.sheenColorMap),r.sheenColorTexture=o}r.sheenRoughnessFactor=e.sheenRoughness,r.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Uhe{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.anisotropyMap){const o={index:i.processTexture(e.anisotropyMap)};i.applyTextureTransform(o,e.anisotropyMap),r.anisotropyTexture=o}r.anisotropyStrength=e.anisotropy,r.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Nhe{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const n=this.writer.extensionsUsed,r={};r.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class zhe{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.bumpMap){const o={index:i.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};i.applyTextureTransform(o,e.bumpMap),r.bumpTexture=o}r.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Ghe{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const i=this.writer,n=e,r=new Float32Array(n.count*3),o=new Float32Array(n.count*4),a=new Float32Array(n.count*3),l=new fe,c=new w,h=new xe,d=new w;for(let p=0;p<n.count;p++)n.getMatrixAt(p,l),l.decompose(c,h,d),c.toArray(r,p*3),h.toArray(o,p*4),d.toArray(a,p*3);const f={TRANSLATION:i.processAccessor(new ot(r,3)),ROTATION:i.processAccessor(new ot(o,4)),SCALE:i.processAccessor(new ot(a,3))};n.instanceColor&&(f._COLOR_0=i.processAccessor(n.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:f},i.extensionsUsed[this.name]=!0,i.extensionsRequired[this.name]=!0}}QE.Utils={insertKeyframe:function(s,e){const i=s.getValueSize(),n=new s.TimeBufferType(s.times.length+1),r=new s.ValueBufferType(s.values.length+i),o=s.createInterpolant(new s.ValueBufferType(i));let a;if(s.times.length===0){n[0]=e;for(let l=0;l<i;l++)r[l]=0;a=0}else if(e<s.times[0]){if(Math.abs(s.times[0]-e)<.001)return 0;n[0]=e,n.set(s.times,1),r.set(o.evaluate(e),0),r.set(s.values,i),a=0}else if(e>s.times[s.times.length-1]){if(Math.abs(s.times[s.times.length-1]-e)<.001)return s.times.length-1;n[n.length-1]=e,n.set(s.times,0),r.set(s.values,0),r.set(o.evaluate(e),s.values.length),a=n.length-1}else for(let l=0;l<s.times.length;l++){if(Math.abs(s.times[l]-e)<.001)return l;if(s.times[l]<e&&s.times[l+1]>e){n.set(s.times.slice(0,l+1),0),n[l+1]=e,n.set(s.times.slice(l+1),l+2),r.set(s.values.slice(0,(l+1)*i),0),r.set(o.evaluate(e),(l+1)*i),r.set(s.values.slice((l+1)*i),(l+2)*i),a=l+1;break}}return s.times=n,s.values=r,a},mergeMorphTargetTracks:function(s,e){const t=[],i={},n=s.tracks;for(let r=0;r<n.length;++r){let o=n[r];const a=Xt.parseTrackName(o.name),l=Xt.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(Id)}const c=l.morphTargetInfluences.length,h=l.morphTargetDictionary[a.propertyIndex];if(h===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let d;if(i[l.uuid]===void 0){d=o.clone();const p=new d.ValueBufferType(c*d.times.length);for(let m=0;m<d.times.length;m++)p[m*c+h]=d.values[m];d.name=(a.nodeName||"")+".morphTargetInfluences",d.values=p,i[l.uuid]=d,t.push(d);continue}const f=o.createInterpolant(new o.ValueBufferType(1));d=i[l.uuid];for(let p=0;p<d.times.length;p++)d.values[p*c+h]=f.evaluate(d.times[p]);for(let p=0;p<o.times.length;p++){const m=this.insertKeyframe(d,o.times[p]);d.values[m*c+h]=o.values[p]}}return s.tracks=t,s}};class h8{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(e.constructor.name!=="InstancedMesh")return;const i=this.writer,n=i.extensionsUsed,r={};t.extensions=t.extensions||{},t.extensions[this.name]=r;let o=new fe;const a=new Array,l=new Array,c=new Array;for(let p=0;p<e.count;p++){e.getMatrixAt(p,o);let m=new w,v=new xe,y=new w;o.decompose(m,v,y),a.push(m.x,m.y,m.z),l.push(v.x,v.y,v.z,v.w),c.push(y.x,y.y,y.z)}const h=new Float32Array(a),d=new Float32Array(l),f=new Float32Array(c);r.attributes={TRANSLATION:i.processAccessor(new ot(h,3)),ROTATION:i.processAccessor(new ot(d,4)),SCALE:i.processAccessor(new ot(f,3))},n[this.name]=!0}}var u8=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Hx=ie("debuggltfexport");class kO extends No{constructor(){super(...arguments);u(this,"sceneRoot")}}class Cl extends Te{constructor(){super(...arguments);u(this,"binary",!0);u(this,"objects",[]);u(this,"ext")}async exportNow(t){Hx&&console.log("Exporting objects as glTF",this.objects),t||(t="scene"),(!this.objects||this.objects.length<=0)&&(this.objects=[this.context.scene]);const i={binary:this.binary,pivot:Cl.calculateCenter(this.objects)},n=await this.export(this.objects,i).catch(r=>(console.error(r),!1));return n===!1?!1:(this.binary?t.endsWith(".glb")||(t+=".glb"):t.endsWith(".gltf")||(t+=".gltf"),this.binary?Cl.saveArrayBuffer(n,t):Cl.saveJson(n,t),!0)}async export(t,i){if(!t||t.length<=0){console.warn("No objects set to export");return}const n=new QE;n.register(c=>new h8(c)),bO(n,this.context),Cl.filterTopmostParent(t);const r={trs:!1,onlyVisible:!0,truncateDrawRange:!1,binary:!0,maxTextureSize:1/0,embedImages:!0,includeCustomExtensions:!0,animations:(i==null?void 0:i.animations)||Cl.collectAnimations(t),...i},o=new ge;i!=null&&i.pivot&&o.position.sub(i.pivot),Hx&&console.log("EXPORT",t),t.forEach(c=>{c&&(o.children.push(c),c.matrixAutoUpdate=!1,c.matrix.copy(c.matrixWorld),ne.getComponentsInChildren(c,dn).forEach(h=>{ne.isActiveInHierarchy(h.gameObject)&&h.setInstancingEnabled(!1)}))});const a=new BD(o);return this.ext&&(this.ext.context=a),new Promise((c,h)=>{Hx&&console.log("Starting glTF export.");try{n==null||n.parse(o,d=>{l(),c(d)},d=>{l(),h(d)},r)}catch(d){console.error(d),h(d)}finally{Hx&&console.log("Finished glTF export.")}});function l(){t.forEach(c=>{c&&(c.matrixAutoUpdate=!0,ne.getComponentsInChildren(c,dn).forEach(h=>{ne.isActiveInHierarchy(h.gameObject)&&h.setInstancingEnabled(!1)}))})}}static saveArrayBuffer(t,i){this.save(new Blob([t],{type:"application/octet-stream"}),i)}static saveJson(t,i){this.save("data: text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),i)}static save(t,i){const n=document.createElement("a");n.style.display="none",document.body.appendChild(n),typeof t=="string"?n.href=t:n.href=URL.createObjectURL(t),n.download=i,n.click(),n.remove()}static collectAnimations(t,i){i=i||[];for(const n of t)n&&n.traverseVisible(r=>{r.animations&&r.animations.length>0&&i.push(...r.animations)});return i}static calculateCenter(t,i){const n=i||new w;return n.set(0,0,0),t.forEach(r=>{n.add(Qt(r))}),console.log(n),n.divideScalar(t.length),n}static filterTopmostParent(t){if(!(t.length<=0))for(let i=0;i<t.length;i++){let n=t[i];if(!n){t.splice(i,1),i--;continue}for(;n.parent;){if(t.includes(n.parent)){t.splice(i,1),i--;break}n=n.parent}}}}u8([x()],Cl.prototype,"binary",void 0);u8([x(ge)],Cl.prototype,"objects",void 0);var FO=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class Fv extends Te{constructor(){super(...arguments);u(this,"isGizmo",!1);u(this,"color0");u(this,"color1");u(this,"gridHelper");u(this,"size");u(this,"divisions");u(this,"offset")}onEnable(){if(this.isGizmo&&!m_)return;const t=this.size,i=this.divisions;this.gridHelper||(this.gridHelper=new Av(t,i,this.color0??new me(.4,.4,.4),this.color1??new me(.6,.6,.6)),this.offset!==void 0&&(this.gridHelper.position.y+=this.offset)),this.gridHelper&&this.gameObject.add(this.gridHelper)}onDisable(){this.gridHelper&&(this.gameObject.remove(this.gridHelper),this.gridHelper=null)}}FO([x()],Fv.prototype,"isGizmo",void 0);FO([x(me)],Fv.prototype,"color0",void 0);FO([x(me)],Fv.prototype,"color1",void 0);var jE=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const qu=ie("debuginputfield"),Et=class extends Te{constructor(){super(...arguments);u(this,"textComponent");u(this,"placeholder");u(this,"onValueChanged");u(this,"onEndEdit");u(this,"inputEventFn");u(this,"_iosEventFn")}get text(){var t;return((t=this.textComponent)==null?void 0:t.text)??""}get isFocused(){return Et.active===this}start(){qu&&console.log(this.name,this)}onEnable(){var t;Et.htmlField||(Et.htmlField=document.createElement("input"),Et.htmlField.style.width="0px",Et.htmlField.style.height="0px",Et.htmlField.style.padding="0px",Et.htmlField.style.border="none",Et.htmlField.style.overflow="hidden",Et.htmlField.style.caretColor="transparent",Et.htmlField.style.outline="none",Et.htmlField.classList.add("ar"),Et.htmlField.onfocus=()=>Et.htmlFieldFocused=!0,Et.htmlField.onblur=()=>Et.htmlFieldFocused=!1,document.body.append(Et.htmlField)),this.inputEventFn||(this.inputEventFn=this.onInput.bind(this)),Et.htmlField.addEventListener("keyup",this.inputEventFn),this.placeholder&&((t=this.textComponent)!=null&&t.text.length)&&ne.setActive(this.placeholder.gameObject,!1),St.isiOS()&&(this._iosEventFn=this.processInputOniOS.bind(this),window.addEventListener("click",this._iosEventFn))}onDisable(){var t;(t=Et.htmlField)==null||t.removeEventListener("keyup",this.inputEventFn),this.onDeselected(),this._iosEventFn&&window.removeEventListener("click",this._iosEventFn)}clear(){Et.active===this&&Et.htmlField?(Et.htmlField.value="",this.setTextFromInputField()):(this.textComponent&&(this.textComponent.text=""),this.placeholder&&ne.setActive(this.placeholder.gameObject,!0))}select(){this.onSelected()}deselect(){this.onDeselected()}onPointerClick(t){qu&&console.log("CLICK",t,Et.active),Et.activeTime=this.context.time.time,Et.active!==this&&this.startCoroutine(this.activeLoop(),Wt.LateUpdate),this.selectInputField()}*activeLoop(){for(this.onSelected();Et.active===this&&!(this.context.input.getPointerClicked(0)&&this.context.time.time-Et.activeTime>.2);)this.setTextFromInputField(),yield;this.onDeselected()}onSelected(){var t,i,n,r;if(Et.active!==this&&(qu&&console.log("Select",this.name,this,Et.htmlField,this.context.isInXR,this.context.arOverlayElement,(t=this.textComponent)==null?void 0:t.text,(i=Et.htmlField)==null?void 0:i.value),(n=Et.active)==null||n.onDeselected(),Et.active=this,this.placeholder&&ne.setActive(this.placeholder.gameObject,!1),Et.htmlField)){if(Et.htmlField.value=((r=this.textComponent)==null?void 0:r.text)||"",qu&&console.log("set input field value",Et.htmlField.value),this.context.isInXR){const o=this.context.arOverlayElement;o&&o.append(Et.htmlField)}this.selectInputField()}}onDeselected(){var t;Et.active===this&&(Et.active=null,qu&&console.log("Deselect",this.name,this),Et.htmlField&&(Et.htmlField.blur(),document.body.append(Et.htmlField)),this.placeholder&&(!this.textComponent||this.textComponent.text.length<=0)&&ne.setActive(this.placeholder.gameObject,!0),Et.htmlField&&((t=this.onEndEdit)==null||t.invoke(Et.htmlField.value)))}update(){var t;Et.active===this&&((t=this.textComponent)==null||t.markDirty())}onInput(t){var i,n;if(Et.active===this){if(qu&&console.log(t.code,t,(i=Et.htmlField)==null?void 0:i.value,(n=this.textComponent)==null?void 0:n.text),t.code==="Escape"||t.code==="Enter"){this.onDeselected();return}Et.htmlField&&(this.textComponent&&(this.setTextFromInputField(),this.placeholder&&ne.setActive(this.placeholder.gameObject,this.textComponent.text.length<=0)),this.selectInputField())}}setTextFromInputField(){var t;if(this.textComponent&&Et.htmlField){if(this.textComponent.text!==Et.htmlField.value){qu&&console.log("VALUE CHANGED");const i=this.textComponent.text,n=Et.htmlField.value;(t=this.onValueChanged)==null||t.invoke(n,i)}this.textComponent.text=Et.htmlField.value}}selectInputField(){Et.htmlField&&(qu&&console.log("Focus Inputfield",Et.htmlFieldFocused),Et.htmlField.setSelectionRange(Et.htmlField.value.length,Et.htmlField.value.length),St.isiOS()?Et.htmlField.focus({preventScroll:!0}):setTimeout(()=>{var t;return(t=Et.htmlField)==null?void 0:t.focus()},1))}processInputOniOS(){const t=this.context.physics.raycast();if(!t.length)return;const n=t[0].object,r=JD(n);((r==null?void 0:r.gameObject)===this.gameObject||(r==null?void 0:r.gameObject.parent)===this.gameObject)&&this.selectInputField()}};let ua=Et;u(ua,"active",null),u(ua,"activeTime",-1),u(ua,"htmlField",null),u(ua,"htmlFieldFocused",!1);jE([x(Kr)],ua.prototype,"textComponent",void 0);jE([x(Kr)],ua.prototype,"placeholder",void 0);jE([x(un)],ua.prototype,"onValueChanged",void 0);jE([x(un)],ua.prototype,"onEndEdit",void 0);var lh=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};function BM(s){return s*Math.PI/180}const B3=300,Xu=ie("debuglights");var Ph;(function(s){s[s.Spot=0]="Spot",s[s.Directional=1]="Directional",s[s.Point=2]="Point",s[s.Area=3]="Area",s[s.Rectangle=3]="Rectangle",s[s.Disc=4]="Disc"})(Ph||(Ph={}));var zS;(function(s){s[s.Realtime=4]="Realtime",s[s.Baked=2]="Baked",s[s.Mixed=1]="Mixed"})(zS||(zS={}));var RA;(function(s){s[s.None=0]="None",s[s.Hard=1]="Hard",s[s.Soft=2]="Soft"})(RA||(RA={}));class Ko extends Te{constructor(){super(...arguments);u(this,"type",0);u(this,"range",1);u(this,"spotAngle",1);u(this,"innerSpotAngle",1);u(this,"_color",new me(16777215));u(this,"_shadowNearPlane",.1);u(this,"_shadowBias",0);u(this,"_shadowNormalBias",0);u(this,"_overrideShadowBiasSettings",!1);u(this,"_shadows",1);u(this,"lightmapBakeType",zS.Realtime);u(this,"_intensity",-1);u(this,"_shadowDistance");u(this,"shadowWidth");u(this,"shadowHeight");u(this,"_shadowResolution");u(this,"light");u(this,"_webXRStartedListener");u(this,"_webXREndedListener");u(this,"_webARRoot")}set color(t){this._color=t,this.light!==void 0&&(this.light.color=t)}get color(){return this.light?this.light.color:this._color}set shadowNearPlane(t){var i,n;if(t!==this._shadowNearPlane&&(this._shadowNearPlane=t,((n=(i=this.light)==null?void 0:i.shadow)==null?void 0:n.camera)!==void 0)){const r=this.light.shadow.camera;r.near=t}}get shadowNearPlane(){return this._shadowNearPlane}set shadowBias(t){var i,n;t!==this._shadowBias&&(this._shadowBias=t,((n=(i=this.light)==null?void 0:i.shadow)==null?void 0:n.bias)!==void 0&&(this.light.shadow.bias=t,this.light.shadow.needsUpdate=!0))}get shadowBias(){return this._shadowBias}set shadowNormalBias(t){var i,n;t!==this._shadowNormalBias&&(this._shadowNormalBias=t,((n=(i=this.light)==null?void 0:i.shadow)==null?void 0:n.normalBias)!==void 0&&(this.light.shadow.normalBias=t,this.light.shadow.needsUpdate=!0))}get shadowNormalBias(){return this._shadowNormalBias}set shadows(t){this._shadows=t,this.light&&(this.light.castShadow=t!==RA.None,this.updateShadowSoftHard())}get shadows(){return this._shadows}set intensity(t){var i;if(this._intensity=t,this.light){let n=1;if(this.context.isInXR&&this._webARRoot){const r=(i=this._webARRoot)==null?void 0:i.arScale;typeof r=="number"&&r>0&&(n/=r)}this.light.intensity=t*n}Xu&&console.log("Set light intensity to "+this._intensity,t,this)}get intensity(){return this._intensity}get shadowDistance(){const t=this.light;return t!=null&&t.shadow?t.shadow.camera.far:-1}set shadowDistance(t){this._shadowDistance=t;const i=this.light;if(i!=null&&i.shadow){const n=i.shadow.camera;n.far=t,n.updateProjectionMatrix()}}get shadowResolution(){const t=this.light;return t!=null&&t.shadow?t.shadow.mapSize.x:-1}set shadowResolution(t){if(t===this._shadowResolution)return;this._shadowResolution=t;const i=this.light;i!=null&&i.shadow&&(i.shadow.mapSize.set(t,t),i.shadow.needsUpdate=!0)}get isBaked(){return this.lightmapBakeType===zS.Baked}get selfIsLight(){if(this.gameObject.isLight===!0)return!0;switch(this.gameObject.type){case"SpotLight":case"PointLight":case"DirectionalLight":return!0}return!1}getWorldPosition(t){return this.light?this.type===Ph.Directional?this.light.getWorldPosition(t).multiplyScalar(1):this.light.getWorldPosition(t):t}awake(){this.color=new me(this.color??16777215),Xu&&console.log(this.name,this)}onEnable(){Xu&&console.log("ENABLE LIGHT",this.name),this.createLight(),!this.isBaked&&(this.light&&(this.light.visible=!0,this.light.intensity=this._intensity,Xu&&console.log("Set light intensity to "+this.light.intensity,this.name),this.selfIsLight||this.light.parent!==this.gameObject&&this.gameObject.add(this.light)),this.type===Ph.Directional&&this.startCoroutine(this.updateMainLightRoutine(),Wt.LateUpdate))}onDisable(){Xu&&console.log("DISABLE LIGHT",this.name),this.light&&(this.selfIsLight?this.light.intensity=0:this.light.visible=!1)}onEnterXR(t){this._webARRoot=ne.getComponentInParent(this.gameObject,gu)??void 0}onLeaveXR(t){}createLight(){const t=this.selfIsLight;if(t&&!this.light)switch(this.light=this.gameObject,this.light.name=this.name,this._intensity=this.light.intensity,this.type){case Ph.Directional:this.setDirectionalLight(this.light);break}else if(!this.light)switch(this.type){case Ph.Directional:const i=new Op(this.color,this.intensity*Math.PI);if(i.position.set(0,0,-B3*.5).applyQuaternion(this.gameObject.quaternion),this.gameObject.add(i.target),kp(i.target,0,0,0),this.light=i,this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),Xu){const a=new G4(this.light,.2,this.color);this.context.scene.add(a)}break;case Ph.Spot:const n=new t_(this.color,this.intensity*Math.PI,this.range,BM(this.spotAngle/2),1-BM(this.innerSpotAngle/2)/BM(this.spotAngle/2),2);n.position.set(0,0,0),n.rotation.set(0,0,0),this.light=n;const r=n.target;n.add(r),r.position.set(0,0,this.range),r.rotation.set(0,0,0);break;case Ph.Point:const o=new Dp(this.color,this.intensity*Math.PI,this.range);this.light=o;break}if(this.light){if(this._intensity>=0?this.light.intensity=this._intensity:this._intensity=this.light.intensity,this.shadows!==RA.None?this.light.castShadow=!0:this.light.castShadow=!1,this.light.shadow){this._shadowResolution!==void 0&&this._shadowResolution>4?(this.light.shadow.mapSize.width=this._shadowResolution,this.light.shadow.mapSize.height=this._shadowResolution):(this.light.shadow.mapSize.width=2048,this.light.shadow.mapSize.height=2048),Xu&&console.log("Override shadow bias?",this._overrideShadowBiasSettings,this.shadowBias,this.shadowNormalBias),this.light.shadow.bias=this.shadowBias,this.light.shadow.normalBias=this.shadowNormalBias,this.updateShadowSoftHard();const i=this.light.shadow.camera;if(i.near=this.shadowNearPlane,this._shadowDistance!==void 0&&typeof this._shadowDistance=="number"?i.far=this._shadowDistance:i.far=B3*Math.abs(this.gameObject.scale.z),this.gameObject.scale.set(1,1,1),this.shadowWidth!==void 0)i.left=-this.shadowWidth/2,i.right=this.shadowWidth/2;else{const n=this.gameObject.scale.x;i.left*=n,i.right*=n}if(this.shadowHeight!==void 0)i.top=this.shadowHeight/2,i.bottom=-this.shadowHeight/2;else{const n=this.gameObject.scale.y;i.top*=n,i.bottom*=n}this.light.shadow.needsUpdate=!0,Xu&&this.context.scene.add(new H4(i))}this.isBaked?this.light.removeFromParent():t||this.gameObject.add(this.light)}}*updateMainLightRoutine(){for(;;){this.type===Ph.Directional&&((!this.context.mainLight||this.intensity>this.context.mainLight.intensity)&&(this.context.mainLight=this),yield);break}}updateShadowSoftHard(){this.light&&this.light.shadow&&(this.shadows===RA.Soft||(this.light.shadow.radius=1,this.light.shadow.blurSamples=1))}setDirectionalLight(t){t.add(t.target),t.target.position.set(0,0,-1)}}u(Ko,"allowChangingRendererShadowMapType",!0);lh([x()],Ko.prototype,"type",void 0);lh([x(me)],Ko.prototype,"color",null);lh([x()],Ko.prototype,"shadowNearPlane",null);lh([x()],Ko.prototype,"shadowBias",null);lh([x()],Ko.prototype,"shadowNormalBias",null);lh([x()],Ko.prototype,"shadows",null);lh([x()],Ko.prototype,"lightmapBakeType",void 0);lh([x()],Ko.prototype,"intensity",null);lh([x()],Ko.prototype,"shadowDistance",null);lh([x()],Ko.prototype,"shadowResolution",null);new w(0,0,0);var Q_=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const DM=ie("debuglods"),Hhe=ie("nolods");var rP;(function(s){s[s.None=0]="None",s[s.CrossFade=1]="CrossFade",s[s.SpeedTree=2]="SpeedTree"})(rP||(rP={}));class om{constructor(){u(this,"screenRelativeTransitionHeight");u(this,"distance");u(this,"renderers")}}Q_([x()],om.prototype,"screenRelativeTransitionHeight",void 0);Q_([x()],om.prototype,"distance",void 0);Q_([x(dn)],om.prototype,"renderers",void 0);class Vhe{constructor(e){u(this,"model");this.model=e}get renderers(){return this.model.renderers}}class j_ extends Te{constructor(){super(...arguments);u(this,"fadeMode",rP.None);u(this,"localReferencePoint");u(this,"lodCount",0);u(this,"size",0);u(this,"animateCrossFading",!1);u(this,"lodModels");u(this,"_lods",[]);u(this,"_settings",[]);u(this,"_lodsHandler");u(this,"_distanceFactor",1)}start(){if(DM&&console.log("LODGROUP",this.name,this.lodModels,this),!Hhe&&!this._lodsHandler&&this.gameObject&&this.lodModels&&Array.isArray(this.lodModels)){const t=[];for(const n of this.lodModels){const r=new Vhe(n);this._lods.push(r);for(const o of r.renderers)t.includes(o)||t.push(o)}this._lodsHandler=new Array;for(let n=0;n<t.length;n++){const r=new XP;this._lodsHandler.push(r),this.gameObject.add(r)}const i=new ge;i.name="Cull "+this.name;for(let n=0;n<t.length;n++){const r=t[n],o=this._lodsHandler[n],a=r.gameObject;DM&&console.log(n,a.name);for(const l of this._lods){const c=l.model.distance;let h=null;if(l.renderers.includes(r)?h=a:h=i,h.type==="Group"){console.warn(`LODGroup ${this.name}: Group or MultiMaterial object's are not supported as LOD object: ${h.name}`);continue}DM&&console.log("LEVEL",h.name,c),o.autoUpdate=!1,this.onAddLodLevel(o,h,l.model.distance)}}}}onAfterRender(){if(!this.gameObject||!this._lodsHandler)return;const t=this.context.mainCamera;if(t)for(const i of this._lodsHandler){i.update(t);const n=i.getCurrentLevel(),r=i.levels[n];i.layers.mask=r.object.layers.mask}}onAddLodLevel(t,i,n){if(i===this.gameObject){console.warn("LODGroup component must be on parent object and not mesh directly at the moment",i.name,i);return}t.addLevel(i,n*this._distanceFactor,.01);const r={lod:t,levelIndex:t.levels.length-1,distance:n};this._settings.push(r)}distanceFactor(t){if(t!==this._distanceFactor){this._distanceFactor=t;for(const i of this._settings){const n=i.lod.levels[i.levelIndex];n.distance=i.distance*t}}}}Q_([x(w)],j_.prototype,"localReferencePoint",void 0);Q_([x(om)],j_.prototype,"lodModels",void 0);const Qhe=ie("logstats");class UO extends Te{onEnable(){console.log(this),Qhe&&this.startCoroutine(this.run(),Wt.OnAfterRender)}*run(){for(;this.enabled;){const e=this.context.renderer.info;console.log(e.memory,e.render,e.programs),yield}}}var WE=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const x2=class extends Te{constructor(){super(...arguments);u(this,"target");u(this,"invertForward",!1);u(this,"keepUpDirection",!0);u(this,"copyTargetRotation",!1)}onBeforeRender(){let t=this.target;if(t||(t=this.context.mainCamera),!t)return;let i=this.copyTargetRotation;(this.context.isInVR||this.context.isInPassThrough)&&(i=!1),a_(this.gameObject,t,this.keepUpDirection,i),this.invertForward&&this.gameObject.quaternion.multiply(x2.flipYQuat)}createBehaviours(t,i,n){if(i.uuid===this.gameObject.uuid){let r=i;if(this.keepUpDirection){const a=wr.createEmptyParent(i);r=a;const l=this.invertForward?-1:1;a.setMatrix(a.getMatrix().multiply(new fe().makeRotationZ(Math.PI/2*l))),i.setMatrix(i.getMatrix().multiply(new fe().makeRotationZ(-Math.PI/2*l)))}const o=new ys("lookat "+this.name,Ys.sceneStartTrigger(),wi.lookAtCameraAction(r,void 0,this.invertForward?ug.back:ug.forward,this.keepUpDirection?ug.up:ug.zero));t.addBehavior(o)}}};let Vc=x2;u(Vc,"flipYQuat",new xe().setFromAxisAngle(new w(0,1,0),Math.PI));WE([x(ge)],Vc.prototype,"target",void 0);WE([x()],Vc.prototype,"invertForward",void 0);WE([x()],Vc.prototype,"keepUpDirection",void 0);WE([x()],Vc.prototype,"copyTargetRotation",void 0);var jhe=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Vx=ie("debugnestedgltf");class qE extends Te{constructor(){super(...arguments);u(this,"filePath");u(this,"_isLoadingOrDoneLoading",!1)}listenToProgress(t){var i;(i=this.filePath)==null||i.beginListenDownload(t)}preload(){var t;(t=this.filePath)==null||t.preload()}async start(){var i,n,r,o,a;if(this._isLoadingOrDoneLoading)return;Vx&&console.log(this,this.guid);const t=this.gameObject.parent;if(t){this._isLoadingOrDoneLoading=!0;const l=new Gl;l.idProvider=new Ls(this.hash(this.guid)),l.parent=t,this.gameObject.updateMatrix();const c=this.gameObject.matrix;Vx&&console.log("Load nested:",((i=this.filePath)==null?void 0:i.url)??this.filePath,this.gameObject.position);const h=await((r=(n=this.filePath)==null?void 0:n.instantiate)==null?void 0:r.call(this.filePath,l));Vx&&console.log("Nested loaded:",((o=this.filePath)==null?void 0:o.url)??this.filePath,h),h&&(h.matrixAutoUpdate=!1,h.matrix.identity(),h.applyMatrix4(c),h.matrixAutoUpdate=!0,h.layers.disableAll(),h.layers.set(this.layer),this.dispatchEvent(new CustomEvent("loaded",{detail:{instance:h,assetReference:this.filePath}}))),Vx&&console.log("Nested loading done:",((a=this.filePath)==null?void 0:a.url)??this.filePath,h)}}onDestroy(){var t;(t=this.filePath)==null||t.unload()}hash(t){let i=0;for(let n=0;n<t.length;n++)i=t.charCodeAt(n)+((i<<5)-i);return i}}jhe([x(si)],qE.prototype,"filePath",void 0);var NO=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Whe=ie("debugnet");class vu extends Te{constructor(){super(...arguments);u(this,"url",null);u(this,"urlParameterName",null);u(this,"localhost",null)}awake(){Whe&&console.log(this),this.context.connection.registerProvider(this)}getWebsocketUrl(){let t=this.url?vu.GetUrl(this.url,this.localhost):null;if(this.urlParameterName){const o=ie(this.urlParameterName);o&&typeof o=="string"&&(t=o)}if(!t)return null;const n=new RegExp("(((https?)|(?<socket_prefix>wss?))://)?(www.)?(?<url>.+)","gm").exec(t);return n!=null&&n.groups?(n==null?void 0:n.groups.socket_prefix)?t:"wss://"+(n==null?void 0:n.groups.url):null}static GetUrl(t,i){let n=t;const r=vu.IsLocalNetwork()&&i;if(r&&(n=i),t!=null&&t.startsWith("/")){const o=r?n:window.location.origin;o!=null&&o.endsWith("/")&&t.startsWith("/")&&(t=t.substring(1)),n=o+t}return n}static IsLocalNetwork(t=window.location.hostname){return So(t)}}NO([x()],vu.prototype,"url",void 0);NO([x()],vu.prototype,"urlParameterName",void 0);NO([x()],vu.prototype,"localhost",void 0);var XE=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class am extends Te{constructor(){super(...arguments);u(this,"referenceSpace");u(this,"from");u(this,"affectPosition",!1);u(this,"affectRotation",!1);u(this,"alignLookDirection",!1);u(this,"levelLookDirection",!1);u(this,"levelPosition",!1);u(this,"positionOffset",new w(0,0,0));u(this,"rotationOffset",new w(0,0,0));u(this,"offset",new w(0,0,0))}update(){if(!this.from)return;var t=Qt(this.from),i=qi(this.from);this.offset.copy(this.positionOffset);const n=this.offset.length();if(this.referenceSpace&&this.offset.transformDirection(this.referenceSpace.matrixWorld).multiplyScalar(n),t.add(this.offset),this.levelPosition&&this.referenceSpace){const l=new Ar(this.gameObject.up,0),c=Qt(this.referenceSpace);l.setFromNormalAndCoplanarPoint(this.gameObject.up,c);const h=new w(0,0,0);l.projectPoint(t,h),t.copy(h)}this.affectPosition&&Os(this.gameObject,t);const r=new oi(this.rotationOffset.x,this.rotationOffset.y,this.rotationOffset.z),o=new xe().setFromEuler(r);this.affectRotation&&Ka(this.gameObject,i.multiply(o));const a=new w;this.from.getWorldDirection(a).multiplyScalar(50),this.levelLookDirection&&(a.y=0),this.alignLookDirection&&this.gameObject.lookAt(a)}}XE([x(ne)],am.prototype,"referenceSpace",void 0);XE([x(ne)],am.prototype,"from",void 0);XE([x(w)],am.prototype,"positionOffset",void 0);XE([x(w)],am.prototype,"rotationOffset",void 0);var zO=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r},gg;(function(s){s[s.NewTab=0]="NewTab",s[s.SameTab=1]="SameTab",s[s.NewWindow=2]="NewWindow"})(gg||(gg={}));class Uv extends Te{constructor(){super(...arguments);u(this,"url");u(this,"mode",gg.NewTab);u(this,"clickable",!0)}async open(){if(!this.url){console.warn("OpenURL: URL is not set, can't open.",this);return}this._validateUrl();let t=this.url;switch(!t.startsWith("mailto:")&&t.includes("@")&&(t="mailto:"+t),Xe()&&Pn("Open URL: "+t),this.mode){case gg.NewTab:St.isSafari(),globalThis.open(t,"_blank");break;case gg.SameTab:St.isSafari()&&St.isiOS()?globalThis.open(t,"_top"):globalThis.open(t,"_self");break;case gg.NewWindow:St.isSafari()?globalThis.open(t,"_top"):globalThis.open(t,"_new");break}}start(){this.gameObject.getComponentInParent(xa)||this.gameObject.addComponent(xa)}onPointerEnter(t){!t.used&&this.clickable&&this.context.input.setCursorPointer()}onPointerExit(){this.clickable&&this.context.input.setCursorNormal()}onPointerClick(t){var i;this.clickable&&!t.used&&((i=this.url)!=null&&i.length)&&this.open()}_validateUrl(){this.url&&this.url.startsWith("www.")&&(Xe()&&console.warn("URL is not valid, adding https:// to the start of the URL",this.url),this.url="https://"+this.url)}}zO([x()],Uv.prototype,"url",void 0);zO([x()],Uv.prototype,"mode",void 0);zO([x()],Uv.prototype,"clickable",void 0);function qhe(s,e){var t=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(t!=null){var i,n,r,o,a=[],l=!0,c=!1;try{if(r=(t=t.call(s)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(i=r.call(t)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(h){c=!0,n=h}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw n}}return a}}function oP(){oP=function(){return e};var s,e={},t=Object.prototype,i=t.hasOwnProperty,n=Object.defineProperty||function(O,F,N){O[F]=N.value},r=typeof Symbol=="function"?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(O,F,N){return Object.defineProperty(O,F,{value:N,enumerable:!0,configurable:!0,writable:!0}),O[F]}try{c({},"")}catch{c=function(F,N,q){return F[N]=q}}function h(O,F,N,q){var $=F&&F.prototype instanceof g?F:g,oe=Object.create($.prototype),ae=new D(q||[]);return n(oe,"_invoke",{value:S(O,N,ae)}),oe}function d(O,F,N){try{return{type:"normal",arg:O.call(F,N)}}catch(q){return{type:"throw",arg:q}}}e.wrap=h;var f="suspendedStart",p="suspendedYield",m="executing",v="completed",y={};function g(){}function _(){}function A(){}var b={};c(b,o,function(){return this});var E=Object.getPrototypeOf,C=E&&E(E(V([])));C&&C!==t&&i.call(C,o)&&(b=C);var T=A.prototype=g.prototype=Object.create(b);function M(O){["next","throw","return"].forEach(function(F){c(O,F,function(N){return this._invoke(F,N)})})}function R(O,F){function N($,oe,ae,Re){var se=d(O[$],O,oe);if(se.type!=="throw"){var ye=se.arg,Ae=ye.value;return Ae&&typeof Ae=="object"&&i.call(Ae,"__await")?F.resolve(Ae.__await).then(function(je){N("next",je,ae,Re)},function(je){N("throw",je,ae,Re)}):F.resolve(Ae).then(function(je){ye.value=je,ae(ye)},function(je){return N("throw",je,ae,Re)})}Re(se.arg)}var q;n(this,"_invoke",{value:function($,oe){function ae(){return new F(function(Re,se){N($,oe,Re,se)})}return q=q?q.then(ae,ae):ae()}})}function S(O,F,N){var q=f;return function($,oe){if(q===m)throw new Error("Generator is already running");if(q===v){if($==="throw")throw oe;return{value:s,done:!0}}for(N.method=$,N.arg=oe;;){var ae=N.delegate;if(ae){var Re=I(ae,N);if(Re){if(Re===y)continue;return Re}}if(N.method==="next")N.sent=N._sent=N.arg;else if(N.method==="throw"){if(q===f)throw q=v,N.arg;N.dispatchException(N.arg)}else N.method==="return"&&N.abrupt("return",N.arg);q=m;var se=d(O,F,N);if(se.type==="normal"){if(q=N.done?v:p,se.arg===y)continue;return{value:se.arg,done:N.done}}se.type==="throw"&&(q=v,N.method="throw",N.arg=se.arg)}}}function I(O,F){var N=F.method,q=O.iterator[N];if(q===s)return F.delegate=null,N==="throw"&&O.iterator.return&&(F.method="return",F.arg=s,I(O,F),F.method==="throw")||N!=="return"&&(F.method="throw",F.arg=new TypeError("The iterator does not provide a '"+N+"' method")),y;var $=d(q,O.iterator,F.arg);if($.type==="throw")return F.method="throw",F.arg=$.arg,F.delegate=null,y;var oe=$.arg;return oe?oe.done?(F[O.resultName]=oe.value,F.next=O.nextLoc,F.method!=="return"&&(F.method="next",F.arg=s),F.delegate=null,y):oe:(F.method="throw",F.arg=new TypeError("iterator result is not an object"),F.delegate=null,y)}function L(O){var F={tryLoc:O[0]};1 in O&&(F.catchLoc=O[1]),2 in O&&(F.finallyLoc=O[2],F.afterLoc=O[3]),this.tryEntries.push(F)}function U(O){var F=O.completion||{};F.type="normal",delete F.arg,O.completion=F}function D(O){this.tryEntries=[{tryLoc:"root"}],O.forEach(L,this),this.reset(!0)}function V(O){if(O||O===""){var F=O[o];if(F)return F.call(O);if(typeof O.next=="function")return O;if(!isNaN(O.length)){var N=-1,q=function $(){for(;++N<O.length;)if(i.call(O,N))return $.value=O[N],$.done=!1,$;return $.value=s,$.done=!0,$};return q.next=q}}throw new TypeError(typeof O+" is not iterable")}return _.prototype=A,n(T,"constructor",{value:A,configurable:!0}),n(A,"constructor",{value:_,configurable:!0}),_.displayName=c(A,l,"GeneratorFunction"),e.isGeneratorFunction=function(O){var F=typeof O=="function"&&O.constructor;return!!F&&(F===_||(F.displayName||F.name)==="GeneratorFunction")},e.mark=function(O){return Object.setPrototypeOf?Object.setPrototypeOf(O,A):(O.__proto__=A,c(O,l,"GeneratorFunction")),O.prototype=Object.create(T),O},e.awrap=function(O){return{__await:O}},M(R.prototype),c(R.prototype,a,function(){return this}),e.AsyncIterator=R,e.async=function(O,F,N,q,$){$===void 0&&($=Promise);var oe=new R(h(O,F,N,q),$);return e.isGeneratorFunction(F)?oe:oe.next().then(function(ae){return ae.done?ae.value:oe.next()})},M(T),c(T,l,"Generator"),c(T,o,function(){return this}),c(T,"toString",function(){return"[object Generator]"}),e.keys=function(O){var F=Object(O),N=[];for(var q in F)N.push(q);return N.reverse(),function $(){for(;N.length;){var oe=N.pop();if(oe in F)return $.value=oe,$.done=!1,$}return $.done=!0,$}},e.values=V,D.prototype={constructor:D,reset:function(O){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(U),!O)for(var F in this)F.charAt(0)==="t"&&i.call(this,F)&&!isNaN(+F.slice(1))&&(this[F]=s)},stop:function(){this.done=!0;var O=this.tryEntries[0].completion;if(O.type==="throw")throw O.arg;return this.rval},dispatchException:function(O){if(this.done)throw O;var F=this;function N(se,ye){return oe.type="throw",oe.arg=O,F.next=se,ye&&(F.method="next",F.arg=s),!!ye}for(var q=this.tryEntries.length-1;q>=0;--q){var $=this.tryEntries[q],oe=$.completion;if($.tryLoc==="root")return N("end");if($.tryLoc<=this.prev){var ae=i.call($,"catchLoc"),Re=i.call($,"finallyLoc");if(ae&&Re){if(this.prev<$.catchLoc)return N($.catchLoc,!0);if(this.prev<$.finallyLoc)return N($.finallyLoc)}else if(ae){if(this.prev<$.catchLoc)return N($.catchLoc,!0)}else{if(!Re)throw new Error("try statement without catch or finally");if(this.prev<$.finallyLoc)return N($.finallyLoc)}}}},abrupt:function(O,F){for(var N=this.tryEntries.length-1;N>=0;--N){var q=this.tryEntries[N];if(q.tryLoc<=this.prev&&i.call(q,"finallyLoc")&&this.prev<q.finallyLoc){var $=q;break}}$&&(O==="break"||O==="continue")&&$.tryLoc<=F&&F<=$.finallyLoc&&($=null);var oe=$?$.completion:{};return oe.type=O,oe.arg=F,$?(this.method="next",this.next=$.finallyLoc,y):this.complete(oe)},complete:function(O,F){if(O.type==="throw")throw O.arg;return O.type==="break"||O.type==="continue"?this.next=O.arg:O.type==="return"?(this.rval=this.arg=O.arg,this.method="return",this.next="end"):O.type==="normal"&&F&&(this.next=F),y},finish:function(O){for(var F=this.tryEntries.length-1;F>=0;--F){var N=this.tryEntries[F];if(N.finallyLoc===O)return this.complete(N.completion,N.afterLoc),U(N),y}},catch:function(O){for(var F=this.tryEntries.length-1;F>=0;--F){var N=this.tryEntries[F];if(N.tryLoc===O){var q=N.completion;if(q.type==="throw"){var $=q.arg;U(N)}return $}}throw new Error("illegal catch attempt")},delegateYield:function(O,F,N){return this.delegate={iterator:V(O),resultName:F,nextLoc:N},this.method==="next"&&(this.arg=s),y}},e}function Lt(s,e){if(!(s instanceof e))throw new TypeError("Cannot call a class as a function")}function D3(s,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(s,f8(i.key),i)}}function kt(s,e,t){return e&&D3(s.prototype,e),t&&D3(s,t),Object.defineProperty(s,"prototype",{writable:!1}),s}function te(s,e,t){return e=f8(e),e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function Nv(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(e&&e.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),e&&aP(s,e)}function GS(s){return GS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},GS(s)}function aP(s,e){return aP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},aP(s,e)}function Xhe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function vi(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function Yhe(s,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vi(s)}function zv(s){var e=Xhe();return function(){var i=GS(s),n;if(e){var r=GS(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Yhe(this,n)}}function Fg(s,e){return Khe(s)||qhe(s,e)||d8(s,e)||Jhe()}function Khe(s){if(Array.isArray(s))return s}function d8(s,e){if(s){if(typeof s=="string")return O3(s,e);var t=Object.prototype.toString.call(s).slice(8,-1);if(t==="Object"&&s.constructor&&(t=s.constructor.name),t==="Map"||t==="Set")return Array.from(s);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return O3(s,e)}}function O3(s,e){(e==null||e>s.length)&&(e=s.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=s[t];return i}function Jhe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function L3(s,e){var t=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(!t){if(Array.isArray(s)||(t=d8(s))||e&&s&&typeof s.length=="number"){t&&(s=t);var i=0,n=function(){};return{s:n,n:function(){return i>=s.length?{done:!0}:{done:!1,value:s[i++]}},e:function(l){throw l},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r=!0,o=!1,a;return{s:function(){t=t.call(s)},n:function(){var l=t.next();return r=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!r&&t.return!=null&&t.return()}finally{if(o)throw a}}}}function Zhe(s,e){if(typeof s!="object"||s===null)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var i=t.call(s,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function f8(s){var e=Zhe(s,"string");return typeof e=="symbol"?e:String(e)}var $he=function(s){Nv(t,s);var e=zv(t);function t(i){var n;return Lt(this,t),n=e.call(this),te(vi(n),"type","ParticleEmitter"),te(vi(n),"system",void 0),n.system=i,n}return kt(t,[{key:"clone",value:function(){var n=this.system.clone();return n.emitter.copy(this,!0),n.emitter}},{key:"dispose",value:function(){}},{key:"extractFromCache",value:function(n){var r=[];for(var o in n){var a=n[o];delete a.metadata,r.push(a)}return r}},{key:"toJSON",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=n===void 0||typeof n=="string",a={};o&&(n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},a.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var l={};if(l.uuid=this.uuid,l.type=this.type,this.name!==""&&(l.name=this.name),this.castShadow===!0&&(l.castShadow=!0),this.receiveShadow===!0&&(l.receiveShadow=!0),this.visible===!1&&(l.visible=!1),this.frustumCulled===!1&&(l.frustumCulled=!1),this.renderOrder!==0&&(l.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(l.matrixAutoUpdate=!1),this.system!==null&&(l.ps=this.system.toJSON(n,r)),this.children.length>0){l.children=[];for(var c=0;c<this.children.length;c++)this.children[c].type!=="ParticleSystemPreview"&&l.children.push(this.children[c].toJSON(n).object)}if(o){var h=this.extractFromCache(n.geometries),d=this.extractFromCache(n.materials),f=this.extractFromCache(n.textures),p=this.extractFromCache(n.images);h.length>0&&(a.geometries=h),d.length>0&&(a.materials=d),f.length>0&&(a.textures=f),p.length>0&&(a.images=p)}return a.object=l,a}}]),t}(ge),OM=function(){function s(e){Lt(this,s),te(this,"data",void 0),te(this,"next",void 0),te(this,"prev",void 0),this.data=e,this.next=null,this.prev=null}return kt(s,[{key:"hasPrev",value:function(){return this.prev!==null}},{key:"hasNext",value:function(){return this.next!==null}}]),s}(),eue=function(){function s(){Lt(this,s),te(this,"length",void 0),te(this,"head",void 0),te(this,"tail",void 0),this.length=0,this.head=this.tail=null}return kt(s,[{key:"isEmpty",value:function(){return this.head===null}},{key:"clear",value:function(){this.length=0,this.head=this.tail=null}},{key:"front",value:function(){return this.head===null?null:this.head.data}},{key:"back",value:function(){return this.tail===null?null:this.tail.data}},{key:"dequeue",value:function(){if(this.head){var t=this.head.data;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}}},{key:"pop",value:function(){if(this.tail){var t=this.tail.data;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}}},{key:"queue",value:function(t){var i=new OM(t);this.tail||(this.tail=i),this.head&&(this.head.prev=i,i.next=this.head),this.head=i,this.length++}},{key:"push",value:function(t){var i=new OM(t);this.head||(this.head=i),this.tail&&(this.tail.next=i,i.prev=this.tail),this.tail=i,this.length++}},{key:"insertBefore",value:function(t,i){var n=new OM(i);n.next=t,n.prev=t.prev,n.prev!==null&&(n.prev.next=n),n.next.prev=n,t==this.head&&(this.head=n),this.length++}},{key:"remove",value:function(t){if(!(this.head===null||this.tail===null)){var i=this.head;for(t===this.head.data&&(this.head=this.head.next),t===this.tail.data&&(this.tail=this.tail.prev);i.next!==null&&i.data!==t;)i=i.next;i.data===t&&(i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.length--)}}},{key:"values",value:oP().mark(function e(){var t;return oP().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:t=this.head;case 1:if(t===null){n.next=7;break}return n.next=4,t.data;case 4:t=t.next,n.next=1;break;case 7:case"end":return n.stop()}},e,this)})}]),s}(),B0=function(){function s(){Lt(this,s),te(this,"parentMatrix",void 0),te(this,"startSpeed",0),te(this,"startColor",new Je),te(this,"startSize",1),te(this,"position",new w),te(this,"velocity",new w),te(this,"age",0),te(this,"life",1),te(this,"size",1),te(this,"angularVelocity",void 0),te(this,"rotation",0),te(this,"color",new Je),te(this,"uvTile",0)}return kt(s,[{key:"died",get:function(){return this.age>=this.life}}]),s}(),tue=kt(function s(e,t,i){Lt(this,s),this.position=e,this.size=t,this.color=i}),D0=function(){function s(){Lt(this,s),te(this,"parentMatrix",void 0),te(this,"startSpeed",0),te(this,"startColor",new Je),te(this,"startSize",1),te(this,"position",new w),te(this,"localPosition",void 0),te(this,"velocity",new w),te(this,"age",0),te(this,"life",1),te(this,"size",1),te(this,"length",100),te(this,"color",new Je),te(this,"previous",new eue),te(this,"uvTile",0)}return kt(s,[{key:"update",value:function(){for(this.age<=this.life?this.previous.push(new tue(this.position.clone(),this.size,this.color.clone())):this.previous.length>0&&this.previous.dequeue();this.previous.length>this.length;)this.previous.dequeue()}},{key:"died",get:function(){return this.age>=this.life}},{key:"reset",value:function(){this.previous.clear()}}]),s}(),Gr=function(){function s(e){Lt(this,s),te(this,"type",void 0),this.value=e,this.type="value"}return kt(s,[{key:"genValue",value:function(){return this.value}},{key:"toJSON",value:function(){return{type:"ConstantValue",value:this.value}}},{key:"clone",value:function(){return new s(this.value)}}],[{key:"fromJSON",value:function(t){return new s(t.value)}}]),s}(),YE=function(){function s(e,t){Lt(this,s),te(this,"type",void 0),this.a=e,this.b=t,this.type="value"}return kt(s,[{key:"genValue",value:function(){return li.lerp(this.a,this.b,Math.random())}},{key:"toJSON",value:function(){return{type:"IntervalValue",a:this.a,b:this.b}}},{key:"clone",value:function(){return new s(this.a,this.b)}}],[{key:"fromJSON",value:function(t){return new s(t.a,t.b)}}]),s}(),iue=function(){function s(){Lt(this,s),te(this,"functions",void 0),this.functions=new Array}return kt(s,[{key:"findFunction",value:function(t){for(var i=0,n=0,r=this.functions.length-1;n+1<r;)if(i=Math.floor((n+r)/2),t<this.getStartX(i))r=i-1;else if(t>this.getEndX(i))n=i+1;else return i;for(var o=n;o<=r;o++)if(t>=this.functions[o][1]&&t<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(t){return this.functions[t][1]}},{key:"setStartX",value:function(t,i){t>0&&(this.functions[t][1]=i)}},{key:"getEndX",value:function(t){return t+1<this.functions.length?this.functions[t+1][1]:1}},{key:"setEndX",value:function(t,i){t+1<this.functions.length&&(this.functions[t+1][1]=i)}},{key:"insertFunction",value:function(t,i){var n=this.findFunction(t);this.functions.splice(n+1,0,[i,t])}},{key:"removeFunction",value:function(t){return this.functions.splice(t,1)[0][0]}},{key:"getFunction",value:function(t){return this.functions[t][0]}},{key:"setFunction",value:function(t,i){this.functions[t][0]=i}},{key:"numOfFunctions",get:function(){return this.functions.length}}]),s}(),lP=function(){function s(e,t,i,n){Lt(this,s),te(this,"p",void 0),this.p=[e,t,i,n]}return kt(s,[{key:"genValue",value:function(t){var i=t*t,n=t*t*t,r=1-t,o=r*r,a=o*r;return this.p[0]*a+this.p[1]*o*t*3+this.p[2]*r*i*3+this.p[3]*n}},{key:"derivativeCoefficients",value:function(t){for(var i=[],n=t,r=n.length-1;r>0;r--){for(var o=[],a=0;a<r;a++){var l=r*(n[a+1]-n[a]);o.push(l)}i.push(o),n=o}return i}},{key:"getSlope",value:function(t){var i=this.derivativeCoefficients(this.p)[0],n=1-t,r=n*n,o=n*t*2,a=t*t;return r*i[0]+o*i[1]+a*i[2]}},{key:"controlCurve",value:function(t,i){this.p[1]=t/3+this.p[0],this.p[2]=this.p[3]-i/3}},{key:"hull",value:function(t){var i=this.p,n=[],r,o=0,a=0,l=0,c=[];for(c[o++]=i[0],c[o++]=i[1],c[o++]=i[2],c[o++]=i[3];i.length>1;){for(n=[],a=0,l=i.length-1;a<l;a++)r=t*i[a]+(1-t)*i[a+1],c[o++]=r,n.push(r);i=n}return c}},{key:"split",value:function(t){var i=this.hull(t),n={left:new s(i[0],i[4],i[7],i[9]),right:new s(i[9],i[8],i[6],i[3]),span:i};return n}},{key:"clone",value:function(){return new s(this.p[0],this.p[1],this.p[2],this.p[3])}},{key:"toJSON",value:function(){return{p0:this.p[0],p1:this.p[1],p2:this.p[2],p3:this.p[3]}}}],[{key:"fromJSON",value:function(t){return new s(t.p0,t.p1,t.p2,t.p3)}}]),s}(),nue=function(s){Nv(t,s);var e=zv(t);function t(){var i,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new lP(0,.3333333333333333,.6666666666666666,1),0]];return Lt(this,t),i=e.call(this),te(vi(i),"type",void 0),i.type="function",i.functions=n,i}return kt(t,[{key:"genValue",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=this.findFunction(n);return r===-1?0:this.functions[r][0].genValue((n-this.getStartX(r))/(this.getEndX(r)-this.getStartX(r)))}},{key:"toSVG",value:function(n,r){if(r<1)return"";for(var o=["M",0,this.functions[0][0].p[0]].join(" "),a=1/r;a<=1;a+=1/r)o=[o,"L",a*n,this.genValue(a)].join(" ");return o}},{key:"toJSON",value:function(){return{type:"PiecewiseBezier",functions:this.functions.map(function(n){var r=Fg(n,2),o=r[0],a=r[1];return{function:o.toJSON(),start:a}})}}},{key:"clone",value:function(){return new t(this.functions.map(function(n){var r=Fg(n,2),o=r[0],a=r[1];return[o.clone(),a]}))}}],[{key:"fromJSON",value:function(n){return new t(n.functions.map(function(r){return[lP.fromJSON(r.function),r.start]}))}}]),t}(iue);function cn(s){switch(s.type){case"ConstantValue":return Gr.fromJSON(s);case"IntervalValue":return YE.fromJSON(s);case"PiecewiseBezier":return nue.fromJSON(s);default:return new Gr(0)}}var O0=function(e){return{r:e.x,g:e.y,b:e.z,a:e.w}},L0=function(e){return new Je(e.r,e.g,e.b,e.a)},sue=function(e,t){switch(t){case"Vector3":return new w(e.x,e.y,e.z);case"Vector4":return new Je(e.x,e.y,e.z,e.w);case"Color":return new w(e.r,e.g,e.b);case"Number":return e;default:return e}},rue=function(e,t){switch(t){case"Vector3":return{x:e.x,y:e.y,z:e.z};case"Vector4":return{x:e.x,y:e.y,z:e.z,w:e.w};case"Color":return{r:e.x,g:e.y,b:e.z};case"Number":return e;default:return e}},oue=function(){function s(e,t){Lt(this,s),te(this,"type",void 0),this.a=e,this.b=t,this.type="value"}return kt(s,[{key:"genColor",value:function(t){var i=Math.random();return t.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"RandomColor",a:O0(this.a),b:O0(this.b)}}},{key:"clone",value:function(){return new s(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(t){return new s(L0(t.a),L0(t.b))}}]),s}(),cP=function(){function s(e,t){Lt(this,s),te(this,"type",void 0),this.a=e,this.b=t,this.type="function"}return kt(s,[{key:"genColor",value:function(t,i){return t.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"ColorRange",a:O0(this.a),b:O0(this.b)}}},{key:"clone",value:function(){return new s(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(t){return new s(L0(t.a),L0(t.b))}}]),s}(),Qx=function(){function s(e,t){Lt(this,s),te(this,"keys",void 0),te(this,"type",void 0),te(this,"subType",void 0),this.subType=t,this.type="function",this.keys=e}return kt(s,[{key:"findKey",value:function(t){for(var i=0,n=0,r=this.keys.length-1;n+1<r;)if(i=Math.floor((n+r)/2),t<this.getStartX(i))r=i-1;else if(t>this.getEndX(i))n=i+1;else return i;for(var o=n;o<=r;o++)if(t>=this.getStartX(o)&&t<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(t){return this.keys[t][1]}},{key:"getEndX",value:function(t){return t+1<this.keys.length?this.keys[t+1][1]:1}},{key:"genValue",value:function(t,i){var n=this.findKey(i);return this.subType==="Number"?n===-1?this.keys[0][0]:n+1>=this.keys.length?this.keys[this.keys.length-1][0]:(this.keys[n+1][0]-this.keys[n][0])*((i-this.getStartX(n))/(this.getEndX(n)-this.getStartX(n)))+this.keys[n][0]:n===-1?t.copy(this.keys[0][0]):n+1>=this.keys.length?t.copy(this.keys[this.keys.length-1][0]):t.copy(this.keys[n][0]).lerp(this.keys[n+1][0],(i-this.getStartX(n))/(this.getEndX(n)-this.getStartX(n)))}},{key:"toJSON",value:function(){var t=this;return this.keys[0][0].constructor.name,{type:"CLinearFunction",subType:this.subType,keys:this.keys.map(function(i){var n=Fg(i,2),r=n[0],o=n[1];return{value:rue(r,t.subType),pos:o}})}}},{key:"clone",value:function(){return this.subType==="Number"?new s(this.keys.map(function(t){var i=Fg(t,2),n=i[0],r=i[1];return[n,r]}),this.subType):new s(this.keys.map(function(t){var i=Fg(t,2),n=i[0],r=i[1];return[n.clone(),r]}),this.subType)}}],[{key:"fromJSON",value:function(t){return new s(t.keys.map(function(i){return[sue(i.value,t.subType),i.pos]}),t.subType)}}]),s}(),jx=new w,hP=function(){function s(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new w(0,0,0),0],[new w(1,1,1),0]],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[[1,0],[1,1]];Lt(this,s),te(this,"type",void 0),te(this,"color",void 0),te(this,"alpha",void 0),this.type="function",this.color=new Qx(e,"Color"),this.alpha=new Qx(t,"Number")}return kt(s,[{key:"genColor",value:function(t,i){return this.color.genValue(jx,i),t.set(jx.x,jx.y,jx.z,this.alpha.genValue(1,i))}},{key:"toJSON",value:function(){return{type:"Gradient",color:this.color.toJSON(),alpha:this.alpha.toJSON()}}},{key:"clone",value:function(){var t=new s;return t.alpha=this.alpha.clone(),t.color=this.color.clone(),t}}],[{key:"fromJSON",value:function(t){if(t.functions){var i=t.functions.map(function(r){return[cP.fromJSON(r.function).a,r.start]});return t.functions.length>0&&i.push([cP.fromJSON(t.functions[t.functions.length-1].function).b,1]),new s(i.map(function(r){return[new w(r[0].x,r[0].y,r[0].z),r[1]]}),i.map(function(r){return[r[0].w,r[1]]}))}else{var n=new s;return n.alpha=Qx.fromJSON(t.alpha),n.color=Qx.fromJSON(t.color),n}}}]),s}(),LM=new Je,aue=function(){function s(e,t){Lt(this,s),te(this,"gradient1",void 0),te(this,"gradient2",void 0),te(this,"type",void 0),this.type="memorizedFunction",this.gradient1=e,this.gradient2=t}return kt(s,[{key:"startGen",value:function(t){t.rand=Math.random()}},{key:"genColor",value:function(t,i,n){return this.gradient1.genColor(t,i),this.gradient2.genColor(LM,i),n&&n.rand?t.lerp(LM,n.rand):t.lerp(LM,Math.random()),t}},{key:"toJSON",value:function(){return{type:"RandomColorBetweenGradient",gradient1:this.gradient1.toJSON(),gradient2:this.gradient2.toJSON()}}},{key:"clone",value:function(){return new s(this.gradient1.clone(),this.gradient2.clone())}}],[{key:"fromJSON",value:function(t){return new s(hP.fromJSON(t.gradient1),hP.fromJSON(t.gradient2))}}]),s}(),HS=function(){function s(e){Lt(this,s),te(this,"type",void 0),this.color=e,this.type="value"}return kt(s,[{key:"genColor",value:function(t){return t.copy(this.color)}},{key:"toJSON",value:function(){return{type:"ConstantColor",color:O0(this.color)}}},{key:"clone",value:function(){return new s(this.color.clone())}}],[{key:"fromJSON",value:function(t){return new s(L0(t.color))}}]),s}();function GO(s){switch(s.type){case"ConstantColor":return HS.fromJSON(s);case"ColorRange":return cP.fromJSON(s);case"RandomColor":return oue.fromJSON(s);case"Gradient":return hP.fromJSON(s);case"RandomColorBetweenGradient":return aue.fromJSON(s);default:return new HS(new Je(1,1,1,1))}}var k3=function(){function s(){Lt(this,s),te(this,"type",void 0),this.type="rotation"}return kt(s,[{key:"genValue",value:function(t,i){var n,r,o,a,l,c;do n=Math.random()*2-1,r=Math.random()*2-1,o=n*n+r*r;while(o>1);do a=Math.random()*2-1,l=Math.random()*2-1,c=a*a+l*l;while(c>1);var h=Math.sqrt((1-o)/c);return t.set(n,r,h*a,h*l),t}},{key:"toJSON",value:function(){return{type:"RandomQuat"}}},{key:"clone",value:function(){return new s}}],[{key:"fromJSON",value:function(t){return new s}}]),s}(),p8=function(){function s(e,t){Lt(this,s),te(this,"type",void 0),this.axis=e,this.angle=t,this.type="rotation"}return kt(s,[{key:"genValue",value:function(t,i){return t.setFromAxisAngle(this.axis,this.angle.genValue(i))}},{key:"toJSON",value:function(){return{type:"AxisAngle",axis:{x:this.axis.x,y:this.axis.y,z:this.axis.z},angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new s(this.axis.clone(),this.angle.clone())}}],[{key:"fromJSON",value:function(t){return new s(t.axis,cn(t.angle))}}]),s}(),lue=function(){function s(e,t,i){Lt(this,s),te(this,"type",void 0),this.angleX=e,this.angleY=t,this.angleZ=i,this.type="rotation"}return kt(s,[{key:"genValue",value:function(t,i){return t.setFromEuler(new oi(this.angleX.genValue(i),this.angleY.genValue(i),this.angleZ.genValue(i)))}},{key:"toJSON",value:function(){return{type:"Euler",angleX:this.angleX.toJSON(),angleY:this.angleY.toJSON(),angleZ:this.angleZ.toJSON()}}},{key:"clone",value:function(){return new s(this.angleX,this.angleY,this.angleZ)}}],[{key:"fromJSON",value:function(t){return new s(cn(t.angleX),cn(t.angleY),cn(t.angleZ))}}]),s}();function m8(s){switch(s.type){case"AxisAngle":return p8.fromJSON(s);case"Euler":return lue.fromJSON(s);case"RandomQuat":return k3.fromJSON(s);default:return new k3}}function cue(s){switch(s.type){case"ConstantValue":case"IntervalValue":case"PiecewiseBezier":return cn(s);case"AxisAngle":case"RandomQuat":case"Euler":return m8(s);default:return new Gr(0)}}var F3=function(){function s(e){Lt(this,s),te(this,"type","ColorOverLife"),this.color=e}return kt(s,[{key:"initialize",value:function(t){this.color.type==="memorizedFunction"&&(t.colorOverLifeMemory={},this.color.startGen(t.colorOverLifeMemory))}},{key:"update",value:function(t,i){this.color.type==="memorizedFunction"?this.color.genColor(t.color,t.age/t.life,t.colorOverLifeMemory):this.color.genColor(t.color,t.age/t.life),t.color.x*=t.startColor.x,t.color.y*=t.startColor.y,t.color.z*=t.startColor.z,t.color.w*=t.startColor.w}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON()}}},{key:"clone",value:function(){return new s(this.color.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(GO(t.color))}}]),s}(),U3=function(){function s(e,t){Lt(this,s),te(this,"type","RotationOverLife"),te(this,"tempQuat",new xe),this.angularVelocity=e,this.dynamic=t}return kt(s,[{key:"initialize",value:function(t){!this.dynamic&&t instanceof B0&&(t.angularVelocity=this.angularVelocity.genValue())}},{key:"update",value:function(t,i){this.dynamic?t.rotation+=i*this.angularVelocity.genValue(t.age/t.life):t instanceof B0&&(t.rotation+=i*t.angularVelocity)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(cn(t.angularVelocity),t.dynamic)}}]),s}(),N3=function(){function s(e){Lt(this,s),te(this,"type","SizeOverLife"),this.size=e}return kt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){t.size=t.startSize*this.size.genValue(t.age/t.life)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.size.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(cn(t.size))}}]),s}(),z3=function(){function s(e){Lt(this,s),te(this,"type","SpeedOverLife"),this.speed=e}return kt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){t.velocity.normalize().multiplyScalar(t.startSpeed*this.speed.genValue(t.age/t.life))}},{key:"toJSON",value:function(){return{type:this.type,speed:this.speed.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.speed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(cn(t.speed))}}]),s}(),G3=function(){function s(e,t){Lt(this,s),te(this,"type","RotationBySpeed"),te(this,"tempQuat",new xe),this.angularVelocity=e,this.speedRange=t}return kt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){var n=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);t.rotation+=i*this.angularVelocity.genValue(n)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.angularVelocity.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(cn(t.angularVelocity),YE.fromJSON(t.speedRange))}}]),s}(),H3=function(){function s(e,t){Lt(this,s),te(this,"type","SizeBySpeed"),this.size=e,this.speedRange=t}return kt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){var i=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);t.size=t.startSize*this.size.genValue(i)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.size.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(cn(t.size),YE.fromJSON(t.speedRange))}}]),s}(),V3=function(){function s(e,t){Lt(this,s),te(this,"type","ColorBySpeed"),this.color=e,this.speedRange=t}return kt(s,[{key:"initialize",value:function(t){this.color.type==="memorizedFunction"&&(t.colorOverLifeMemory={},this.color.startGen(t.colorOverLifeMemory))}},{key:"update",value:function(t,i){var n=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.color.type==="memorizedFunction"?this.color.genColor(t.color,n,t.colorOverLifeMemory):this.color.genColor(t.color,n),t.color.x*=t.startColor.x,t.color.y*=t.startColor.y,t.color.z*=t.startColor.z,t.color.w*=t.startColor.w}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"clone",value:function(){return new s(this.color.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(GO(t.color),YE.fromJSON(t.speedRange))}}]),s}(),Q3=function(){function s(e){Lt(this,s),te(this,"type","FrameOverLife"),this.frame=e}return kt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){t.uvTile=Math.floor(this.frame.genValue(t.age/t.life))}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,frame:this.frame.toJSON()}}},{key:"clone",value:function(){return new s(this.frame.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(cn(t.frame))}}]),s}();new w(0,0,1);var j3=function(){function s(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new w(0,1,0);Lt(this,s),te(this,"type","OrbitOverLife"),te(this,"rotation",void 0),te(this,"line",void 0),te(this,"temp",new w),this.orbitSpeed=e,this.axis=t,this.rotation=new xe,this.line=new WC}return kt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){this.line.set(new w(0,0,0),this.axis),this.line.closestPointToPoint(t.position,!1,this.temp),this.rotation.setFromAxisAngle(this.axis,this.orbitSpeed.genValue(t.age/t.life)*i),t.position.sub(this.temp),t.position.applyQuaternion(this.rotation),t.position.add(this.temp)}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,orbitSpeed:this.orbitSpeed.toJSON(),axis:[this.axis.x,this.axis.y,this.axis.z]}}},{key:"clone",value:function(){return new s(this.orbitSpeed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(cn(t.orbitSpeed),t.axis?new w(t.axis[0],t.axis[1],t.axis[2]):void 0)}}]),s}(),W3=function(){function s(e,t){Lt(this,s),te(this,"type","ApplyForce"),te(this,"magnitudeValue",void 0),this.direction=e,this.magnitude=t,this.magnitudeValue=this.magnitude.genValue()}return kt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){t.velocity.addScaledVector(this.direction,this.magnitudeValue*i)}},{key:"frameUpdate",value:function(t){this.magnitudeValue=this.magnitude.genValue()}},{key:"toJSON",value:function(){return{type:this.type,direction:[this.direction.x,this.direction.y,this.direction.z],magnitude:this.magnitude.toJSON()}}},{key:"clone",value:function(){return new s(this.direction.clone(),this.magnitude.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){var i;return new s(new w(t.direction[0],t.direction[1],t.direction[2]),cn((i=t.magnitude)!==null&&i!==void 0?i:t.force))}}]),s}(),q3=function(){function s(e,t){Lt(this,s),te(this,"type","GravityForce"),te(this,"temp",new w),this.center=e,this.magnitude=t}return kt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){this.temp.copy(this.center).sub(t.position).normalize(),t.velocity.addScaledVector(this.temp,this.magnitude/t.position.distanceToSquared(this.center)*i)}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,center:[this.center.x,this.center.y,this.center.z],magnitude:this.magnitude}}},{key:"clone",value:function(){return new s(this.center.clone(),this.magnitude)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(new w(t.center[0],t.center[1],t.center[2]),t.magnitude)}}]),s}(),X3=function(){function s(e){Lt(this,s),te(this,"type","WidthOverLength"),this.width=e}return kt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){if(t instanceof D0)for(var i=t.previous.values(),n=0;n<t.previous.length;n++){var r=i.next();r.value.size=this.width.genValue((t.previous.length-n)/t.length)}}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,width:this.width.toJSON()}}},{key:"clone",value:function(){return new s(this.width.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(cn(t.width))}}]),s}();new w(0,0,1);var Y3=function(){function s(e){Lt(this,s),te(this,"type","ChangeEmitDirection"),te(this,"_temp",new w),te(this,"_q",new xe),this.angle=e}return kt(s,[{key:"initialize",value:function(t){var i=t.velocity.length();i!=0&&(t.velocity.normalize(),t.velocity.x===0&&t.velocity.y===0?this._temp.set(0,t.velocity.z,0):this._temp.set(-t.velocity.y,t.velocity.x,0),this._q.setFromAxisAngle(this._temp.normalize(),this.angle.genValue()),this._temp.copy(t.velocity),t.velocity.applyQuaternion(this._q),this._q.setFromAxisAngle(this._temp,Math.random()*Math.PI*2),t.velocity.applyQuaternion(this._q),t.velocity.setLength(i))}},{key:"update",value:function(t,i){}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new s(this.angle)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(cn(t.angle))}}]),s}(),hue=new w(1,1,1),K3=new w(0,0,1),J3=function(){function s(e,t,i){Lt(this,s),te(this,"type","EmitSubParticleSystem"),te(this,"q_",new xe),te(this,"v_",new w),te(this,"v2_",new w),this.particleSystem=e,this.useVelocityAsBasis=t,this.subParticleSystem=i,this.subParticleSystem&&this.subParticleSystem.system&&(this.subParticleSystem.system.onlyUsedByOther=!0)}return kt(s,[{key:"initialize",value:function(t){t.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,matrix:new fe}}},{key:"update",value:function(t,i){if(!(!this.subParticleSystem||!t.emissionState)){var n=t.emissionState.matrix,r;if(t.rotation===void 0||this.useVelocityAsBasis)if(t.velocity.x===0&&t.velocity.y===0&&(t.velocity.z===1||t.velocity.z===0))n.set(1,0,0,t.position.x,0,1,0,t.position.y,0,0,1,t.position.z,0,0,0,1);else{this.v_.copy(K3).cross(t.velocity),this.v2_.copy(t.velocity).cross(this.v_);var o=this.v_.length(),a=this.v2_.length();n.set(this.v_.x/o,this.v2_.x/a,t.velocity.x,t.position.x,this.v_.y/o,this.v2_.y/a,t.velocity.y,t.position.y,this.v_.z/o,this.v2_.z/a,t.velocity.z,t.position.z,0,0,0,1)}else t.rotation instanceof xe?r=t.rotation:(this.q_.setFromAxisAngle(K3,t.rotation),r=this.q_),n.compose(t.position,r,hue);this.particleSystem.worldSpace||n.multiplyMatrices(this.particleSystem.emitter.matrixWorld,n),this.subParticleSystem.system.emit(i,t.emissionState,n)}}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,subParticleSystem:this.subParticleSystem?this.subParticleSystem.uuid:"",useVelocityAsBasis:this.useVelocityAsBasis}}},{key:"clone",value:function(){return new s(this.particleSystem,this.useVelocityAsBasis,this.subParticleSystem)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t,i){return new s(i,t.useVelocityAsBasis,t.subParticleSystem)}}]),s}(),uue=.5*(Math.sqrt(3)-1),Cy=(3-Math.sqrt(3))/6,due=1/3,ec=1/6,fue=(Math.sqrt(5)-1)/4,lr=(5-Math.sqrt(5))/20,Hs=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),ds=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),g8=function(){function s(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Math.random;Lt(this,s),te(this,"p",void 0),te(this,"perm",void 0),te(this,"permMod12",void 0);var t=typeof e=="function"?e:mue(e);this.p=pue(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var i=0;i<512;i++)this.perm[i]=this.p[i&255],this.permMod12[i]=this.perm[i]%12}return kt(s,[{key:"noise2D",value:function(t,i){var n=this.permMod12,r=this.perm,o=0,a=0,l=0,c=(t+i)*uue,h=Math.floor(t+c),d=Math.floor(i+c),f=(h+d)*Cy,p=h-f,m=d-f,v=t-p,y=i-m,g,_;v>y?(g=1,_=0):(g=0,_=1);var A=v-g+Cy,b=y-_+Cy,E=v-1+2*Cy,C=y-1+2*Cy,T=h&255,M=d&255,R=.5-v*v-y*y;if(R>=0){var S=n[T+r[M]]*3;R*=R,o=R*R*(Hs[S]*v+Hs[S+1]*y)}var I=.5-A*A-b*b;if(I>=0){var L=n[T+g+r[M+_]]*3;I*=I,a=I*I*(Hs[L]*A+Hs[L+1]*b)}var U=.5-E*E-C*C;if(U>=0){var D=n[T+1+r[M+1]]*3;U*=U,l=U*U*(Hs[D]*E+Hs[D+1]*C)}return 70*(o+a+l)}},{key:"noise3D",value:function(t,i,n){var r=this.permMod12,o=this.perm,a,l,c,h,d=(t+i+n)*due,f=Math.floor(t+d),p=Math.floor(i+d),m=Math.floor(n+d),v=(f+p+m)*ec,y=f-v,g=p-v,_=m-v,A=t-y,b=i-g,E=n-_,C,T,M,R,S,I;A>=b?b>=E?(C=1,T=0,M=0,R=1,S=1,I=0):A>=E?(C=1,T=0,M=0,R=1,S=0,I=1):(C=0,T=0,M=1,R=1,S=0,I=1):b<E?(C=0,T=0,M=1,R=0,S=1,I=1):A<E?(C=0,T=1,M=0,R=0,S=1,I=1):(C=0,T=1,M=0,R=1,S=1,I=0);var L=A-C+ec,U=b-T+ec,D=E-M+ec,V=A-R+2*ec,O=b-S+2*ec,F=E-I+2*ec,N=A-1+3*ec,q=b-1+3*ec,$=E-1+3*ec,oe=f&255,ae=p&255,Re=m&255,se=.6-A*A-b*b-E*E;if(se<0)a=0;else{var ye=r[oe+o[ae+o[Re]]]*3;se*=se,a=se*se*(Hs[ye]*A+Hs[ye+1]*b+Hs[ye+2]*E)}var Ae=.6-L*L-U*U-D*D;if(Ae<0)l=0;else{var je=r[oe+C+o[ae+T+o[Re+M]]]*3;Ae*=Ae,l=Ae*Ae*(Hs[je]*L+Hs[je+1]*U+Hs[je+2]*D)}var Be=.6-V*V-O*O-F*F;if(Be<0)c=0;else{var We=r[oe+R+o[ae+S+o[Re+I]]]*3;Be*=Be,c=Be*Be*(Hs[We]*V+Hs[We+1]*O+Hs[We+2]*F)}var lt=.6-N*N-q*q-$*$;if(lt<0)h=0;else{var rt=r[oe+1+o[ae+1+o[Re+1]]]*3;lt*=lt,h=lt*lt*(Hs[rt]*N+Hs[rt+1]*q+Hs[rt+2]*$)}return 32*(a+l+c+h)}},{key:"noise4D",value:function(t,i,n,r){var o=this.perm,a,l,c,h,d,f=(t+i+n+r)*fue,p=Math.floor(t+f),m=Math.floor(i+f),v=Math.floor(n+f),y=Math.floor(r+f),g=(p+m+v+y)*lr,_=p-g,A=m-g,b=v-g,E=y-g,C=t-_,T=i-A,M=n-b,R=r-E,S=0,I=0,L=0,U=0;C>T?S++:I++,C>M?S++:L++,C>R?S++:U++,T>M?I++:L++,T>R?I++:U++,M>R?L++:U++;var D=S>=3?1:0,V=I>=3?1:0,O=L>=3?1:0,F=U>=3?1:0,N=S>=2?1:0,q=I>=2?1:0,$=L>=2?1:0,oe=U>=2?1:0,ae=S>=1?1:0,Re=I>=1?1:0,se=L>=1?1:0,ye=U>=1?1:0,Ae=C-D+lr,je=T-V+lr,Be=M-O+lr,We=R-F+lr,lt=C-N+2*lr,rt=T-q+2*lr,W=M-$+2*lr,Ge=R-oe+2*lr,we=C-ae+3*lr,Ne=T-Re+3*lr,Ee=M-se+3*lr,st=R-ye+3*lr,tt=C-1+4*lr,ct=T-1+4*lr,jt=M-1+4*lr,H=R-1+4*lr,k=p&255,ve=m&255,_e=v&255,Pe=y&255,Me=.6-C*C-T*T-M*M-R*R;if(Me<0)a=0;else{var Ct=o[k+o[ve+o[_e+o[Pe]]]]%32*4;Me*=Me,a=Me*Me*(ds[Ct]*C+ds[Ct+1]*T+ds[Ct+2]*M+ds[Ct+3]*R)}var mt=.6-Ae*Ae-je*je-Be*Be-We*We;if(mt<0)l=0;else{var ke=o[k+D+o[ve+V+o[_e+O+o[Pe+F]]]]%32*4;mt*=mt,l=mt*mt*(ds[ke]*Ae+ds[ke+1]*je+ds[ke+2]*Be+ds[ke+3]*We)}var Ve=.6-lt*lt-rt*rt-W*W-Ge*Ge;if(Ve<0)c=0;else{var Tt=o[k+N+o[ve+q+o[_e+$+o[Pe+oe]]]]%32*4;Ve*=Ve,c=Ve*Ve*(ds[Tt]*lt+ds[Tt+1]*rt+ds[Tt+2]*W+ds[Tt+3]*Ge)}var Fe=.6-we*we-Ne*Ne-Ee*Ee-st*st;if(Fe<0)h=0;else{var ci=o[k+ae+o[ve+Re+o[_e+se+o[Pe+ye]]]]%32*4;Fe*=Fe,h=Fe*Fe*(ds[ci]*we+ds[ci+1]*Ne+ds[ci+2]*Ee+ds[ci+3]*st)}var gt=.6-tt*tt-ct*ct-jt*jt-H*H;if(gt<0)d=0;else{var Ye=o[k+1+o[ve+1+o[_e+1+o[Pe+1]]]]%32*4;gt*=gt,d=gt*gt*(ds[Ye]*tt+ds[Ye+1]*ct+ds[Ye+2]*jt+ds[Ye+3]*H)}return 27*(a+l+c+h+d)}}]),s}();function pue(s){for(var e=new Uint8Array(256),t=0;t<256;t++)e[t]=t;for(var i=0;i<255;i++){var n=i+~~(s()*(256-i)),r=e[i];e[i]=e[n],e[n]=r}return e}function mue(s){var e=0,t=0,i=0,n=1,r=gue();return e=r(" "),t=r(" "),i=r(" "),e-=r(s),e<0&&(e+=1),t-=r(s),t<0&&(t+=1),i-=r(s),i<0&&(i+=1),function(){var o=2091639*e+n*23283064365386963e-26;return e=t,t=i,i=o-(n=o|0)}}function gue(){var s=4022871197;return function(e){e=e.toString();for(var t=0;t<e.length;t++){s+=e.charCodeAt(t);var i=.02519603282416938*s;s=i>>>0,i-=s,i*=s,s=i>>>0,i-=s,s+=i*4294967296}return(s>>>0)*23283064365386963e-26}}var Z3=function(){function s(e,t,i,n){Lt(this,s),te(this,"type","TurbulenceField"),te(this,"generator",new g8),te(this,"timeOffset",new w),te(this,"temp",new w),te(this,"temp2",new w),this.scale=e,this.octaves=t,this.velocityMultiplier=i,this.timeScale=n,this.timeOffset.x=Math.random()/this.scale.x*this.timeScale.x,this.timeOffset.y=Math.random()/this.scale.y*this.timeScale.y,this.timeOffset.z=Math.random()/this.scale.z*this.timeScale.z}return kt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){var n=t.position.x/this.scale.x,r=t.position.y/this.scale.y,o=t.position.z/this.scale.z;this.temp.set(0,0,0);for(var a=1,l=0;l<this.octaves;l++)this.temp2.set(this.generator.noise4D(n*a,r*a,o*a,this.timeOffset.x*a)/a,this.generator.noise4D(n*a,r*a,o*a,this.timeOffset.y*a)/a,this.generator.noise4D(n*a,r*a,o*a,this.timeOffset.z*a)/a),this.temp.add(this.temp2),a*=2;this.temp.multiply(this.velocityMultiplier),t.velocity.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,scale:[this.scale.x,this.scale.y,this.scale.z],octaves:this.octaves,velocityMultiplier:[this.velocityMultiplier.x,this.velocityMultiplier.y,this.velocityMultiplier.z],timeScale:[this.timeScale.x,this.timeScale.y,this.timeScale.z]}}},{key:"frameUpdate",value:function(t){this.timeOffset.x+=t*this.timeScale.x,this.timeOffset.y+=t*this.timeScale.y,this.timeOffset.z+=t*this.timeScale.z}},{key:"clone",value:function(){return new s(this.scale.clone(),this.octaves,this.velocityMultiplier.clone(),this.timeScale.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(new w(t.scale[0],t.scale[1],t.scale[2]),t.octaves,new w(t.velocityMultiplier[0],t.velocityMultiplier[1],t.velocityMultiplier[2]),new w(t.timeScale[0],t.timeScale[1],t.timeScale[2]))}}]),s}(),$3=new xe,eN=function(){function s(e,t){Lt(this,s),te(this,"type","Rotation3DOverLife"),te(this,"tempQuat",new xe),this.angularVelocity=e,this.dynamic=t}return kt(s,[{key:"initialize",value:function(t){!this.dynamic&&t instanceof B0&&(t.angularVelocity=new xe,this.angularVelocity.genValue(t.angularVelocity))}},{key:"update",value:function(t,i){this.dynamic?(this.angularVelocity.genValue(this.tempQuat,t.age/t.life),this.tempQuat.slerpQuaternions($3,this.tempQuat,i),t.rotation.multiply(this.tempQuat)):t instanceof B0&&(this.tempQuat.slerpQuaternions($3,t.angularVelocity,i),t.rotation.multiply(this.tempQuat))}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(m8(t.angularVelocity),t.dynamic)}}]),s}(),tN=function(){function s(e,t,i){Lt(this,s),te(this,"type","ForceOverLife"),te(this,"_temp",new w),this.x=e,this.y=t,this.z=i}return kt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){this._temp.set(this.x.genValue(t.age/t.life),this.y.genValue(t.age/t.life),this.z.genValue(t.age/t.life)),t.velocity.add(this._temp)}},{key:"toJSON",value:function(){return{type:this.type,x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.x.clone(),this.y.clone(),this.z.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(cn(t.x),cn(t.y),cn(t.z))}}]),s}(),iN=function(){function s(e,t){Lt(this,s),te(this,"type","Noise"),te(this,"generator",new g8),te(this,"duration",0),te(this,"temp",new w),this.frequency=e,this.power=t}return kt(s,[{key:"initialize",value:function(t){t.startTime=this.duration}},{key:"update",value:function(t,i){this.temp.set(this.generator.noise2D(t.startTime*this.frequency.x,t.life/t.age*this.frequency.x),this.generator.noise2D(t.startTime*this.frequency.y+100.25,t.life/t.age*this.frequency.y+100.154),this.generator.noise2D(t.startTime*this.frequency.z+200.89,t.life/t.age*this.frequency.z+200.1)).multiply(this.power),t.position.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,frequency:[this.frequency.x,this.frequency.y,this.frequency.z],power:[this.power.x,this.power.y,this.power.z]}}},{key:"frameUpdate",value:function(t){this.duration+=t}},{key:"clone",value:function(){return new s(this.frequency.clone(),this.power.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(new w(t.frequency[0],t.frequency[1],t.frequency[2]),new w(t.power[0],t.power[1],t.power[2]))}}]),s}(),vue={ApplyForce:{type:"ApplyForce",constructor:W3,params:[["direction","vec3"],["magnitude","value"]],loadJSON:W3.fromJSON},Noise:{type:"Noise",constructor:iN,params:[["frequency","vec3"],["power","vec3"]],loadJSON:iN.fromJSON},TurbulenceField:{type:"TurbulenceField",constructor:Z3,params:[["scale","vec3"],["octaves","number"],["velocityMultiplier","vec3"],["timeScale","vec3"]],loadJSON:Z3.fromJSON},GravityForce:{type:"GravityForce",constructor:q3,params:[["center","vec3"],["magnitude","number"]],loadJSON:q3.fromJSON},ColorOverLife:{type:"ColorOverLife",constructor:F3,params:[["color","colorFunc"]],loadJSON:F3.fromJSON},RotationOverLife:{type:"RotationOverLife",constructor:U3,params:[["angularVelocity","valueFunc"],["dynamic","boolean"]],loadJSON:U3.fromJSON},Rotation3DOverLife:{type:"Rotation3DOverLife",constructor:eN,params:[["angularVelocity","rotationFunc"],["dynamic","boolean"]],loadJSON:eN.fromJSON},SizeOverLife:{type:"SizeOverLife",constructor:N3,params:[["size","valueFunc"]],loadJSON:N3.fromJSON},ColorBySpeed:{type:"ColorBySpeed",constructor:V3,params:[["color","colorFunc"],["speedRange","range"]],loadJSON:V3.fromJSON},RotationBySpeed:{type:"RotationBySpeed",constructor:G3,params:[["angularVelocity","valueFunc"],["speedRange","range"]],loadJSON:G3.fromJSON},SizeBySpeed:{type:"SizeBySpeed",constructor:H3,params:[["size","valueFunc"],["speedRange","range"]],loadJSON:H3.fromJSON},SpeedOverLife:{type:"SpeedOverLife",constructor:z3,params:[["speed","valueFunc"]],loadJSON:z3.fromJSON},FrameOverLife:{type:"FrameOverLife",constructor:Q3,params:[["frame","valueFunc"]],loadJSON:Q3.fromJSON},ForceOverLife:{type:"ForceOverLife",constructor:tN,params:[["x","valueFunc"],["y","valueFunc"],["z","valueFunc"]],loadJSON:tN.fromJSON},OrbitOverLife:{type:"OrbitOverLife",constructor:j3,params:[["orbitSpeed","valueFunc"],["axis","vec3"]],loadJSON:j3.fromJSON},WidthOverLength:{type:"WidthOverLength",constructor:X3,params:[["width","valueFunc"]],loadJSON:X3.fromJSON},ChangeEmitDirection:{type:"ChangeEmitDirection",constructor:Y3,params:[["angle","value"]],loadJSON:Y3.fromJSON},EmitSubParticleSystem:{type:"EmitSubParticleSystem",constructor:J3,params:[["particleSystem","self"],["useVelocityAsBasis","boolean"],["subParticleSystem","particleSystem"]],loadJSON:J3.fromJSON}};function yue(s,e){return vue[s.type].loadJSON(s,e)}var nN=function(){function s(){var e,t,i,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Lt(this,s),te(this,"type","cone"),te(this,"radius",void 0),te(this,"arc",void 0),te(this,"thickness",void 0),te(this,"angle",void 0),this.radius=(e=r.radius)!==null&&e!==void 0?e:10,this.arc=(t=r.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(i=r.thickness)!==null&&i!==void 0?i:1,this.angle=(n=r.angle)!==null&&n!==void 0?n:Math.PI/6}return kt(s,[{key:"initialize",value:function(t){var i=Math.random(),n=li.lerp(1-this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(n),a=Math.sin(r),l=Math.cos(r);t.position.x=o*l,t.position.y=o*a,t.position.z=0;var c=this.angle*o;t.velocity.set(0,0,Math.cos(c)).addScaledVector(t.position,Math.sin(c)).multiplyScalar(t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"cone",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new s({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(t){return new s(t)}}]),s}(),sN=function(){function s(){var e,t,i,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Lt(this,s),te(this,"type","donut"),te(this,"radius",void 0),te(this,"arc",void 0),te(this,"thickness",void 0),te(this,"angle",void 0),this.radius=(e=r.radius)!==null&&e!==void 0?e:10,this.arc=(t=r.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(i=r.thickness)!==null&&i!==void 0?i:1,this.angle=(n=r.angle)!==null&&n!==void 0?n:Math.PI/6}return kt(s,[{key:"initialize",value:function(t){var i=Math.random(),n=li.lerp(this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(n),a=Math.sin(r),l=Math.cos(r);t.position.x=o*l,t.position.y=o*a,t.position.z=0;var c=this.angle*o;t.velocity.set(0,0,Math.cos(c)).addScaledVector(t.position,Math.sin(c)).multiplyScalar(t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"donut",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new s({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(t){return new s(t)}}]),s}(),rN=function(){function s(){Lt(this,s),te(this,"type","point")}return kt(s,[{key:"initialize",value:function(t){var i=Math.random(),n=Math.random(),r=i*Math.PI*2,o=Math.acos(2*n-1),a=Math.cbrt(Math.random()),l=Math.sin(r),c=Math.cos(r),h=Math.sin(o),d=Math.cos(o);t.velocity.x=a*h*c,t.velocity.y=a*h*l,t.velocity.z=a*d,t.velocity.multiplyScalar(t.startSpeed),t.position.setScalar(0)}},{key:"toJSON",value:function(){return{type:"point"}}},{key:"clone",value:function(){return new s}}],[{key:"fromJSON",value:function(t){return new s}}]),s}(),uP=function(){function s(){var e,t,i,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Lt(this,s),te(this,"type","sphere"),te(this,"radius",void 0),te(this,"arc",void 0),te(this,"thickness",void 0),this.radius=(e=n.radius)!==null&&e!==void 0?e:10,this.arc=(t=n.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(i=n.thickness)!==null&&i!==void 0?i:1}return kt(s,[{key:"initialize",value:function(t){var i=Math.random(),n=Math.random(),r=li.lerp(1-this.thickness,1,Math.random()),o=i*this.arc,a=Math.acos(2*n-1),l=Math.cbrt(r),c=Math.sin(o),h=Math.cos(o),d=Math.sin(a),f=Math.cos(a);t.position.x=l*d*h,t.position.y=l*d*c,t.position.z=l*f,t.velocity.setScalar(0).addScaledVector(t.position,t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"sphere",radius:this.radius,arc:this.arc,thickness:this.thickness}}},{key:"clone",value:function(){return new s({radius:this.radius,arc:this.arc,thickness:this.thickness})}}],[{key:"fromJSON",value:function(t){return new s(t)}}]),s}(),oN=function(){function s(e){Lt(this,s),te(this,"type","mesh_surface"),te(this,"_triangleIndexToArea",[]),te(this,"_geometry",void 0),te(this,"_tempA",new w),te(this,"_tempB",new w),te(this,"_tempC",new w),e&&(this.geometry=e)}return kt(s,[{key:"geometry",get:function(){return this._geometry},set:function(t){if(this._geometry=t,t!==void 0&&typeof t!="string"){var i=new mo;this._triangleIndexToArea.length=0;var n=0;if(t.getIndex()){var r=t.getIndex().array,o=r.length/3;this._triangleIndexToArea.push(0);for(var a=0;a<o;a++)i.setFromAttributeAndIndices(t.getAttribute("position"),r[a*3],r[a*3+1],r[a*3+2]),n+=i.getArea(),this._triangleIndexToArea.push(n);t.userData.triangleIndexToArea=this._triangleIndexToArea}}}},{key:"initialize",value:function(t){var i=this._geometry;if(!i||i.getIndex()===null){t.position.set(0,0,0),t.velocity.set(0,0,1).multiplyScalar(t.startSpeed);return}for(var n=this._triangleIndexToArea.length-1,r=0,o=n,a=Math.random()*this._triangleIndexToArea[n];r+1<o;){var l=Math.floor((r+o)/2);a<this._triangleIndexToArea[l]?o=l:r=l}var c=Math.random(),h=Math.random();c+h>1&&(c=1-c,h=1-h);var d=i.getIndex().array[r*3],f=i.getIndex().array[r*3+1],p=i.getIndex().array[r*3+2],m=i.getAttribute("position");this._tempA.fromBufferAttribute(m,d),this._tempB.fromBufferAttribute(m,f),this._tempC.fromBufferAttribute(m,p),this._tempB.sub(this._tempA),this._tempC.sub(this._tempA),this._tempA.addScaledVector(this._tempB,c).addScaledVector(this._tempC,h),t.position.copy(this._tempA),this._tempA.copy(this._tempB).cross(this._tempC).normalize(),t.velocity.copy(this._tempA).normalize().multiplyScalar(t.startSpeed)}},{key:"toJSON",value:function(){return{type:"mesh_surface",mesh:this._geometry?this._geometry.uuid:""}}},{key:"clone",value:function(){return new s(this._geometry)}}],[{key:"fromJSON",value:function(t,i){return new s(i.geometries[t.geometry])}}]),s}(),aN=function(){function s(){var e,t,i,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Lt(this,s),te(this,"type","grid"),te(this,"width",void 0),te(this,"height",void 0),te(this,"column",void 0),te(this,"row",void 0),this.width=(e=r.width)!==null&&e!==void 0?e:1,this.height=(t=r.height)!==null&&t!==void 0?t:1,this.column=(i=r.column)!==null&&i!==void 0?i:10,this.row=(n=r.row)!==null&&n!==void 0?n:10}return kt(s,[{key:"initialize",value:function(t){var i=Math.floor(Math.random()*this.row),n=Math.floor(Math.random()*this.column);t.position.x=n*this.width/this.column-this.width/2,t.position.y=i*this.height/this.row-this.height/2,t.position.z=0,t.velocity.set(0,0,t.startSpeed)}},{key:"toJSON",value:function(){return{type:"grid",width:this.width,height:this.height,column:this.column,row:this.row}}},{key:"clone",value:function(){return new s({width:this.width,height:this.height,column:this.column,row:this.row})}}],[{key:"fromJSON",value:function(t){return new s(t)}}]),s}(),Aue={cone:{type:"cone",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:nN,loadJSON:nN.fromJSON},donut:{type:"donut",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:sN,loadJSON:sN.fromJSON},point:{type:"point",params:[],constructor:rN,loadJSON:rN.fromJSON},sphere:{type:"sphere",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:uP,loadJSON:uP.fromJSON},grid:{type:"grid",params:[["width","number"],["height","number"],["rows","number"],["column","number"]],constructor:aN,loadJSON:aN.fromJSON},mesh_surface:{type:"mesh_surface",params:[["geometry","geometry"]],constructor:oN,loadJSON:oN.fromJSON}};function _ue(s,e){return Aue[s.type].loadJSON(s,e)}var ht=function(s){return s[s.BillBoard=0]="BillBoard",s[s.StretchedBillBoard=1]="StretchedBillBoard",s[s.Mesh=2]="Mesh",s[s.Trail=3]="Trail",s[s.HorizontalBillBoard=4]="HorizontalBillBoard",s[s.VerticalBillBoard=5]="VerticalBillBoard",s}({}),v8=function(s){Nv(t,s);var e=zv(t);function t(i){var n;Lt(this,t),n=e.call(this),te(vi(n),"type","VFXBatch"),te(vi(n),"systems",void 0),te(vi(n),"settings",void 0),te(vi(n),"maxParticles",void 0),n.maxParticles=1e3,n.systems=new Set;var r=new Wr;return r.mask=i.layers.mask,n.settings={instancingGeometry:i.instancingGeometry,renderMode:i.renderMode,renderOrder:i.renderOrder,material:i.material.clone(),uTileCount:i.uTileCount,vTileCount:i.vTileCount,layers:r},n.frustumCulled=!1,n.renderOrder=n.settings.renderOrder,n}return kt(t,[{key:"addSystem",value:function(n){this.systems.add(n)}},{key:"removeSystem",value:function(n){this.systems.delete(n)}}]),t}(le),bue=new w(0,0,1),kM=new xe,xue=new w,wue=new w;new w;var lN=60,Sue=new _s(1,1,1,1),Cue=function(){function s(e){var t,i,n,r,o,a,l,c,h,d,f,p,m,v,y,g,_,A,b,E,C;Lt(this,s),te(this,"autoDestroy",void 0),te(this,"prewarm",void 0),te(this,"looping",void 0),te(this,"duration",void 0),te(this,"startLife",void 0),te(this,"startSpeed",void 0),te(this,"startRotation",void 0),te(this,"startSize",void 0),te(this,"startColor",void 0),te(this,"startTileIndex",void 0),te(this,"rendererEmitterSettings",void 0),te(this,"emissionOverTime",void 0),te(this,"emissionOverDistance",void 0),te(this,"emissionBursts",void 0),te(this,"onlyUsedByOther",void 0),te(this,"worldSpace",void 0),te(this,"speedFactor",void 0),te(this,"particleNum",void 0),te(this,"paused",void 0),te(this,"particles",void 0),te(this,"emitterShape",void 0),te(this,"emitter",void 0),te(this,"rendererSettings",void 0),te(this,"neededToUpdateRender",void 0),te(this,"behaviors",void 0),te(this,"prewarmed",void 0),te(this,"emissionState",void 0),te(this,"emitEnded",void 0),te(this,"markForDestroy",void 0),te(this,"previousWorldPos",void 0),te(this,"temp",new w),te(this,"travelDistance",0),te(this,"normalMatrix",new Ht),te(this,"_renderer",void 0),this.autoDestroy=e.autoDestroy===void 0?!1:e.autoDestroy,this.duration=(t=e.duration)!==null&&t!==void 0?t:1,this.looping=e.looping===void 0?!0:e.looping,this.prewarm=e.prewarm===void 0?!1:e.prewarm,this.startLife=(i=e.startLife)!==null&&i!==void 0?i:new Gr(5),this.startSpeed=(n=e.startSpeed)!==null&&n!==void 0?n:new Gr(0),this.startRotation=(r=e.startRotation)!==null&&r!==void 0?r:new Gr(0),this.startSize=(o=e.startSize)!==null&&o!==void 0?o:new Gr(1),this.startColor=(a=e.startColor)!==null&&a!==void 0?a:new HS(new Je(1,1,1,1)),this.emissionOverTime=(l=e.emissionOverTime)!==null&&l!==void 0?l:new Gr(10),this.emissionOverDistance=(c=e.emissionOverDistance)!==null&&c!==void 0?c:new Gr(0),this.emissionBursts=(h=e.emissionBursts)!==null&&h!==void 0?h:[],this.onlyUsedByOther=(d=e.onlyUsedByOther)!==null&&d!==void 0?d:!1,this.emitterShape=(f=e.shape)!==null&&f!==void 0?f:new uP,this.behaviors=(p=e.behaviors)!==null&&p!==void 0?p:new Array,this.worldSpace=(m=e.worldSpace)!==null&&m!==void 0?m:!1,this.speedFactor=(v=e.speedFactor)!==null&&v!==void 0?v:0,this.rendererEmitterSettings=(y=e.rendererEmitterSettings)!==null&&y!==void 0?y:{},this.rendererSettings={instancingGeometry:(g=e.instancingGeometry)!==null&&g!==void 0?g:Sue,renderMode:(_=e.renderMode)!==null&&_!==void 0?_:ht.BillBoard,renderOrder:(A=e.renderOrder)!==null&&A!==void 0?A:0,material:e.material,uTileCount:(b=e.uTileCount)!==null&&b!==void 0?b:1,vTileCount:(E=e.vTileCount)!==null&&E!==void 0?E:1,layers:(C=e.layers)!==null&&C!==void 0?C:new Wr},this.neededToUpdateRender=!0,this.particles=new Array,this.startTileIndex=e.startTileIndex||new Gr(0),this.emitter=new $he(this),this.paused=!1,this.particleNum=0,this.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}return kt(s,[{key:"time",get:function(){return this.emissionState.time},set:function(t){this.emissionState.time=t}},{key:"layers",get:function(){return this.rendererSettings.layers}},{key:"texture",get:function(){return this.rendererSettings.material.map},set:function(t){this.rendererSettings.material.map=t,this.neededToUpdateRender=!0}},{key:"material",get:function(){return this.rendererSettings.material},set:function(t){this.rendererSettings.material=t,this.neededToUpdateRender=!0}},{key:"uTileCount",get:function(){return this.rendererSettings.uTileCount},set:function(t){this.rendererSettings.uTileCount=t,this.neededToUpdateRender=!0}},{key:"vTileCount",get:function(){return this.rendererSettings.vTileCount},set:function(t){this.rendererSettings.vTileCount=t,this.neededToUpdateRender=!0}},{key:"instancingGeometry",get:function(){return this.rendererSettings.instancingGeometry},set:function(t){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=t,this.neededToUpdateRender=!0}},{key:"renderMode",get:function(){return this.rendererSettings.renderMode},set:function(t){if((this.rendererSettings.renderMode!=ht.Trail&&t===ht.Trail||this.rendererSettings.renderMode==ht.Trail&&t!==ht.Trail)&&(this.restart(),this.particles.length=0),this.rendererSettings.renderMode!==t)switch(t){case ht.Trail:this.rendererEmitterSettings={startLength:new Gr(30),followLocalOrigin:!1};break;case ht.Mesh:this.rendererEmitterSettings={geometry:new _s(1,1)},this.startRotation=new p8(new w(0,1,0),new Gr(0));break;case ht.BillBoard:case ht.VerticalBillBoard:case ht.HorizontalBillBoard:case ht.StretchedBillBoard:this.rendererEmitterSettings={},this.rendererSettings.renderMode===ht.Mesh&&(this.startRotation=new Gr(0));break}this.rendererSettings.renderMode=t,this.neededToUpdateRender=!0}},{key:"renderOrder",get:function(){return this.rendererSettings.renderOrder},set:function(t){this.rendererSettings.renderOrder=t,this.neededToUpdateRender=!0}},{key:"blending",get:function(){return this.rendererSettings.material.blending},set:function(t){this.rendererSettings.material.blending=t,this.neededToUpdateRender=!0}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"spawn",value:function(t,i,n){kM.setFromRotationMatrix(n);var r=xue,o=kM,a=wue;n.decompose(r,o,a);for(var l=0;l<t;l++){for(this.particleNum++;this.particles.length<this.particleNum;)this.rendererSettings.renderMode===ht.Trail?this.particles.push(new D0):this.particles.push(new B0);var c=this.particles[this.particleNum-1];if(this.startColor.genColor(c.startColor,this.emissionState.time,{}),c.color.copy(c.startColor),c.startSpeed=this.startSpeed.genValue(i.time/this.duration),c.life=this.startLife.genValue(i.time/this.duration),c.age=0,c.startSize=this.startSize.genValue(i.time/this.duration),c.uvTile=Math.floor(this.startTileIndex.genValue()),c.size=c.startSize,this.rendererSettings.renderMode===ht.Mesh||this.rendererSettings.renderMode===ht.BillBoard||this.rendererSettings.renderMode===ht.VerticalBillBoard||this.rendererSettings.renderMode===ht.HorizontalBillBoard||this.rendererSettings.renderMode===ht.StretchedBillBoard){var h=c;this.rendererSettings.renderMode===ht.Mesh?(h.rotation instanceof xe||(h.rotation=new xe),this.startRotation.type==="rotation"?this.startRotation.genValue(h.rotation,i.time/this.duration):h.rotation.setFromAxisAngle(bue,this.startRotation.genValue(i.time/this.duration))):this.startRotation.type==="rotation"?h.rotation=0:h.rotation=this.startRotation.genValue(i.time/this.duration)}else if(this.rendererSettings.renderMode===ht.Trail){var d=c;d.length=this.rendererEmitterSettings.startLength.genValue(i.time/this.duration),d.reset()}if(this.emitterShape.initialize(c),this.rendererSettings.renderMode===ht.Trail&&this.rendererEmitterSettings.followLocalOrigin){var f=c;f.localPosition=new w().copy(f.position)}this.worldSpace?(c.position.applyMatrix4(n),c.startSize=c.startSize*(Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z))/3,c.size=c.startSize,c.velocity.multiply(a).applyMatrix3(this.normalMatrix),c.rotation&&c.rotation instanceof xe&&c.rotation.multiplyQuaternions(kM,c.rotation)):this.onlyUsedByOther&&(c.parentMatrix=n);for(var p=0;p<this.behaviors.length;p++)this.behaviors[p].initialize(c)}}},{key:"endEmit",value:function(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0)}},{key:"dispose",value:function(){this._renderer&&this._renderer.deleteSystem(this),this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter)}},{key:"restart",value:function(){this.paused=!1,this.particleNum=0,this.emissionState.burstIndex=0,this.emissionState.burstWaveIndex=0,this.emissionState.time=0,this.emissionState.waitEmiting=0,this.behaviors.forEach(function(t){t.reset()}),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}},{key:"update",value:function(t){if(!this.paused){for(var i=this.emitter;i.parent;)i=i.parent;if(i.type!=="Scene"){this.dispose();return}if(this.emitEnded&&this.particleNum===0){this.markForDestroy&&this.emitter.parent&&this.dispose();return}if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(var n=0;n<this.duration*lN;n++)this.update(1/lN)}t>.1&&(t=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.onlyUsedByOther||this.emit(t,this.emissionState,this.emitter.matrixWorld);for(var r=0;r<this.behaviors.length;r++){for(var o=0;o<this.particleNum;o++)this.particles[o].died||this.behaviors[r].update(this.particles[o],t);this.behaviors[r].frameUpdate(t)}for(var a=0;a<this.particleNum;a++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[a].localPosition?(this.particles[a].position.copy(this.particles[a].localPosition),this.particles[a].parentMatrix?this.particles[a].position.applyMatrix4(this.particles[a].parentMatrix):this.particles[a].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[a].position.addScaledVector(this.particles[a].velocity,t),this.particles[a].age+=t;if(this.rendererSettings.renderMode===ht.Trail)for(var l=0;l<this.particleNum;l++){var c=this.particles[l];c.update()}for(var h=0;h<this.particleNum;h++){var d=this.particles[h];d.died&&(!(d instanceof D0)||d.previous.length===0)&&(this.particles[h]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=d,this.particleNum--,h--)}}}},{key:"emit",value:function(t,i,n){i.time>this.duration&&(this.looping?(i.time-=this.duration,i.burstIndex=0,this.behaviors.forEach(function(c){c.reset()})):!this.emitEnded&&!this.onlyUsedByOther&&this.endEmit()),this.normalMatrix.getNormalMatrix(n);var r=Math.ceil(i.waitEmiting);for(this.spawn(r,i,n),i.waitEmiting-=r;i.burstIndex<this.emissionBursts.length&&this.emissionBursts[i.burstIndex].time<=i.time;){if(Math.random()<this.emissionBursts[i.burstIndex].probability){var o=this.emissionBursts[i.burstIndex].count;this.spawn(o,i,n)}i.burstIndex++}if(!this.emitEnded&&(i.waitEmiting+=t*this.emissionOverTime.genValue(i.time/this.duration),this.previousWorldPos!=null)){this.emitter.getWorldPosition(this.temp),this.travelDistance+=this.previousWorldPos.distanceTo(this.temp);var a=this.emissionOverDistance.genValue(i.time/this.duration);if(this.travelDistance*a>0){var l=Math.floor(this.travelDistance*a);this.travelDistance-=l/a,i.waitEmiting+=l}}this.previousWorldPos===void 0&&(this.previousWorldPos=new w),this.emitter.getWorldPosition(this.previousWorldPos),i.time+=t}},{key:"toJSON",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t===void 0||typeof t=="string";if(n&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}}),t.materials[this.rendererSettings.material.uuid]=this.rendererSettings.material.toJSON(t),i.useUrlForImage&&this.texture.source!==void 0){var r=this.texture.source;t.images[r.uuid]={uuid:r.uuid,url:this.texture.image.url}}var o;this.renderMode===ht.Trail?o={startLength:this.rendererEmitterSettings.startLength.toJSON(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===ht.Mesh?o={}:o={};var a=this.rendererSettings.instancingGeometry;return t.geometries&&!t.geometries[a.uuid]&&(t.geometries[a.uuid]=a.toJSON()),{version:"2.0",autoDestroy:this.autoDestroy,looping:this.looping,prewarm:this.prewarm,duration:this.duration,shape:this.emitterShape.toJSON(),startLife:this.startLife.toJSON(),startSpeed:this.startSpeed.toJSON(),startRotation:this.startRotation.toJSON(),startSize:this.startSize.toJSON(),startColor:this.startColor.toJSON(),emissionOverTime:this.emissionOverTime.toJSON(),emissionOverDistance:this.emissionOverDistance.toJSON(),emissionBursts:this.emissionBursts,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry.uuid,renderOrder:this.renderOrder,renderMode:this.renderMode,rendererEmitterSettings:o,speedFactor:this.renderMode===ht.StretchedBillBoard?this.speedFactor:0,material:this.rendererSettings.material.uuid,layers:this.layers.mask,startTileIndex:this.startTileIndex.toJSON(),uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:this.behaviors.map(function(l){return l.toJSON()}),worldSpace:this.worldSpace}}},{key:"addBehavior",value:function(t){this.behaviors.push(t)}},{key:"getRendererSettings",value:function(){return this.rendererSettings}},{key:"clone",value:function(){var t=[],i=L3(this.emissionBursts),n;try{for(i.s();!(n=i.n()).done;){var r=n.value,o={};Object.assign(o,r),t.push(o)}}catch(p){i.e(p)}finally{i.f()}var a=[],l=L3(this.behaviors),c;try{for(l.s();!(c=l.n()).done;){var h=c.value;a.push(h.clone())}}catch(p){l.e(p)}finally{l.f()}var d;this.renderMode===ht.Trail?d={startLength:this.rendererEmitterSettings.startLength.clone(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:d={};var f=new Wr;return f.mask=this.layers.mask,new s({autoDestroy:this.autoDestroy,looping:this.looping,duration:this.duration,shape:this.emitterShape.clone(),startLife:this.startLife.clone(),startSpeed:this.startSpeed.clone(),startRotation:this.startRotation.clone(),startSize:this.startSize.clone(),startColor:this.startColor.clone(),emissionOverTime:this.emissionOverTime.clone(),emissionOverDistance:this.emissionOverDistance.clone(),emissionBursts:t,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry,renderMode:this.renderMode,renderOrder:this.renderOrder,rendererEmitterSettings:d,speedFactor:this.speedFactor,material:this.rendererSettings.material,startTileIndex:this.startTileIndex,uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:a,worldSpace:this.worldSpace,layers:f})}}],[{key:"fromJSON",value:function(t,i,n){var r,o=_ue(t.shape,i),a;t.renderMode===ht.Trail?a={startLength:t.rendererEmitterSettings.startLength!=null?cn(t.rendererEmitterSettings.startLength):new Gr(30),followLocalOrigin:t.rendererEmitterSettings.followLocalOrigin}:t.renderMode===ht.Mesh?a={}:a={};var l=new Wr;t.layers&&(l.mask=t.layers);var c=new s({autoDestroy:t.autoDestroy,looping:t.looping,prewarm:t.prewarm,duration:t.duration,shape:o,startLife:cn(t.startLife),startSpeed:cn(t.startSpeed),startRotation:cue(t.startRotation),startSize:cn(t.startSize),startColor:GO(t.startColor),emissionOverTime:cn(t.emissionOverTime),emissionOverDistance:cn(t.emissionOverDistance),emissionBursts:t.emissionBursts,onlyUsedByOther:t.onlyUsedByOther,instancingGeometry:i.geometries[t.instancingGeometry],renderMode:t.renderMode,rendererEmitterSettings:a,renderOrder:t.renderOrder,speedFactor:t.speedFactor,layers:l,material:t.material?i.materials[t.material]:t.texture?new Kt({map:i.textures[t.texture],transparent:(r=t.transparent)!==null&&r!==void 0?r:!0,blending:t.blending,side:Pi}):new Kt({color:16777215,transparent:!0,blending:Ed,side:Pi}),startTileIndex:typeof t.startTileIndex=="number"?new Gr(t.startTileIndex):cn(t.startTileIndex),uTileCount:t.uTileCount,vTileCount:t.vTileCount,behaviors:[],worldSpace:t.worldSpace});return c.behaviors=t.behaviors.map(function(h){var d=yue(h,c);return d.type==="EmitSubParticleSystem"&&(n[h.subParticleSystem]=d),d}),c}}]),s}(),FM=`

#include <common>
#include <uv_pars_fragment>
#include <color_pars_fragment>
#include <map_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <alphatest_pars_fragment>

void main() {

    #include <clipping_planes_fragment>
    
    vec3 outgoingLight = vec3( 0.0 );
    vec4 diffuseColor = vColor;
    
    #include <logdepthbuf_fragment>
    
    #ifdef USE_MAP
    diffuseColor *= texture2D( map, vMapUv);
    #endif
    
    #include <alphatest_fragment>

    outgoingLight = diffuseColor.rgb;
    
    gl_FragColor = vec4( outgoingLight, diffuseColor.a );
    
    #include <tonemapping_fragment>

}
`,Eue=`
#define STANDARD
#ifdef PHYSICAL
#define IOR
#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
uniform float ior;
#endif
#ifdef SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULARINTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#ifdef USE_SPECULARCOLORMAP
uniform sampler2D specularColorMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;
#ifdef USE_SHEENCOLORMAP
uniform sampler2D sheenColorMap;
#endif
#ifdef USE_SHEENROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif

varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
    #include <clipping_planes_fragment>
    vec4 diffuseColor = vec4( diffuse, opacity );
    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
    vec3 totalEmissiveRadiance = emissive;
    #include <logdepthbuf_fragment>
    #include <map_fragment>
    #include <color_fragment>
    #include <alphamap_fragment>
    #include <alphatest_fragment>
    #include <roughnessmap_fragment>
    #include <metalnessmap_fragment>
    #include <normal_fragment_begin>
    #include <normal_fragment_maps>
    #include <clearcoat_normal_fragment_begin>
    #include <clearcoat_normal_fragment_maps>
    #include <emissivemap_fragment>
    // accumulation
    #include <lights_physical_fragment>
    #include <lights_fragment_begin>
    #include <lights_fragment_maps>
    #include <lights_fragment_end>
    // modulation
    #include <aomap_fragment>
    vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
    vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
    #include <transmission_fragment>
    vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
    #ifdef USE_SHEEN
    // Sheen energy compensation approximation calculation can be found at the end of
        // https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
        float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
        outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
    #endif
    #ifdef USE_CLEARCOAT
        float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
        vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
        outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
    #endif
    #include <output_fragment>
    #include <tonemapping_fragment>
    #include <encodings_fragment>
    #include <fog_fragment>
    #include <premultiplied_alpha_fragment>
    #include <dithering_fragment>
}`,W_=`

    #ifdef UV_TILE
        float col = mod(uvTile, tileCount.x);
        float row = (tileCount.y - floor(uvTile / tileCount.x) - 1.0);
        
        mat3 tileTransform = mat3(
          1.0 / tileCount.x, 0.0, 0.0,
          0.0, 1.0 / tileCount.y, 0.0, 
          col / tileCount.x, row / tileCount.y, 1.0);
    #else
        mat3 tileTransform = mat3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0);
    #endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

vUv = (tileTransform *vec3( uv, 1 )).xy;

#endif
#ifdef USE_MAP

vMapUv = ( tileTransform * (mapTransform * vec3( MAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ALPHAMAP

vAlphaMapUv = ( tileTransform * (alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_LIGHTMAP

vLightMapUv = ( tileTransform * (lightMapTransform * vec3( LIGHTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_AOMAP

vAoMapUv = ( tileTransform * (aoMapTransform * vec3( AOMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_BUMPMAP

vBumpMapUv = ( tileTransform * (bumpMapTransform * vec3( BUMPMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_NORMALMAP

vNormalMapUv = ( tileTransform * (normalMapTransform * vec3( NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_DISPLACEMENTMAP

vDisplacementMapUv = ( tileTransform * (displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_EMISSIVEMAP

vEmissiveMapUv = ( tileTransform * (emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_METALNESSMAP

vMetalnessMapUv = ( tileTransform * (metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ROUGHNESSMAP

vRoughnessMapUv = ( tileTransform * (roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ANISOTROPYMAP

vAnisotropyMapUv = ( tileTransform * (anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOATMAP

vClearcoatMapUv = ( tileTransform * (clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

vClearcoatNormalMapUv = ( tileTransform * (clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

vClearcoatRoughnessMapUv = ( tileTransform * (clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCEMAP

vIridescenceMapUv = ( tileTransform * (iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

vIridescenceThicknessMapUv = ( tileTransform * (iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_COLORMAP

vSheenColorMapUv = ( tileTransform * (sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

vSheenRoughnessMapUv = ( tileTransform * (sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULARMAP

vSpecularMapUv = ( tileTransform * (specularMapTransform * vec3( SPECULARMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_COLORMAP

vSpecularColorMapUv = ( tileTransform * (specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

vSpecularIntensityMapUv = ( tileTransform * (specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_TRANSMISSIONMAP

vTransmissionMapUv = ( tileTransform * transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_THICKNESSMAP

vThicknessMapUv = ( tileTransform * thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) )).xy;

#endif
`,Tue=`
#include <common>
#include <color_pars_vertex>
#include <uv_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(W_,`
	
    vec2 alignedPosition = ( position.xy ) * size;
    
    vec2 rotatedPosition;
    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
#ifdef HORIZONTAL
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.x += rotatedPosition.x;
    mvPosition.z -= rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
#elif defined(VERTICAL)
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.y += rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
    mvPosition.x += rotatedPosition.x;
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    mvPosition.xy += rotatedPosition;
#endif

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),Mue=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
// attribute vec4 color;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(W_,`
    
    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;
    
    mat4 matrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);
    
    vec4 mvPosition = modelViewMatrix * (matrix * vec4( position, 1.0 ));

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),Iue=`
#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {
    `.concat(W_,`

    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;

    mat4 particleMatrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);

	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>

	// replace defaultnormal_vertex
	vec3 transformedNormal = objectNormal;
    mat3 m = mat3( particleMatrix );
    transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
    transformedNormal = m * transformedNormal;
    transformedNormal = normalMatrix * transformedNormal;
    #ifdef FLIP_SIDED
        transformedNormal = - transformedNormal;
    #endif
    #ifdef USE_TANGENT
        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
        #ifdef FLIP_SIDED
        transformedTangent = - transformedTangent;
        #endif
    #endif

	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>

	// replace include <project_vertex>
  vec4 mvPosition = vec4( transformed, 1.0 );
  mvPosition = modelViewMatrix * (particleMatrix * mvPosition);
	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
	vViewPosition = - mvPosition.xyz;
	
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}
`),Rue=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute vec3 velocity;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

uniform float speedFactor;

void main() {

    `.concat(W_,`
	
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity;

    vec3 scaledPos = vec3(position.xy * size, position.z);
    mvPosition.xyz += scaledPos + dot(scaledPos, viewVelocity) * viewVelocity / length(viewVelocity) * speedFactor;

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`);function dP(s){return s===0?"uv":"uv".concat(s)}new w(0,0,1);var Pue=function(s){Nv(t,s);var e=zv(t);function t(i){var n;return Lt(this,t),n=e.call(this,i),te(vi(n),"offsetBuffer",void 0),te(vi(n),"rotationBuffer",void 0),te(vi(n),"sizeBuffer",void 0),te(vi(n),"colorBuffer",void 0),te(vi(n),"uvTileBuffer",void 0),te(vi(n),"velocityBuffer",void 0),te(vi(n),"vector_",new w),te(vi(n),"vector2_",new w),te(vi(n),"vector3_",new w),te(vi(n),"quaternion_",new xe),te(vi(n),"quaternion2_",new xe),te(vi(n),"quaternion3_",new xe),te(vi(n),"rotationMat_",new Ht),te(vi(n),"rotationMat2_",new Ht),n.maxParticles=1e3,n.setupBuffers(),n.rebuildMaterial(),n}return kt(t,[{key:"buildExpandableBuffers",value:function(){this.offsetBuffer=new Fo(new Float32Array(this.maxParticles*3),3),this.offsetBuffer.setUsage(Hr),this.geometry.setAttribute("offset",this.offsetBuffer),this.colorBuffer=new Fo(new Float32Array(this.maxParticles*4),4),this.colorBuffer.setUsage(Hr),this.geometry.setAttribute("color",this.colorBuffer),this.settings.renderMode===ht.Mesh?(this.rotationBuffer=new Fo(new Float32Array(this.maxParticles*4),4),this.rotationBuffer.setUsage(Hr),this.geometry.setAttribute("rotation",this.rotationBuffer)):(this.settings.renderMode===ht.BillBoard||this.settings.renderMode===ht.HorizontalBillBoard||this.settings.renderMode===ht.VerticalBillBoard||this.settings.renderMode===ht.StretchedBillBoard)&&(this.rotationBuffer=new Fo(new Float32Array(this.maxParticles),1),this.rotationBuffer.setUsage(Hr),this.geometry.setAttribute("rotation",this.rotationBuffer)),this.sizeBuffer=new Fo(new Float32Array(this.maxParticles),1),this.sizeBuffer.setUsage(Hr),this.geometry.setAttribute("size",this.sizeBuffer),this.uvTileBuffer=new Fo(new Float32Array(this.maxParticles),1),this.uvTileBuffer.setUsage(Hr),this.geometry.setAttribute("uvTile",this.uvTileBuffer),this.settings.renderMode===ht.StretchedBillBoard&&(this.velocityBuffer=new Fo(new Float32Array(this.maxParticles*3),3),this.velocityBuffer.setUsage(Hr),this.geometry.setAttribute("velocity",this.velocityBuffer))}},{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new VC,this.geometry.setIndex(this.settings.instancingGeometry.getIndex()),this.settings.instancingGeometry.hasAttribute("normal")&&this.geometry.setAttribute("normal",this.settings.instancingGeometry.getAttribute("normal")),this.geometry.setAttribute("position",this.settings.instancingGeometry.getAttribute("position")),this.geometry.setAttribute("uv",this.settings.instancingGeometry.getAttribute("uv")),this.buildExpandableBuffers()}},{key:"expandBuffers",value:function(n){for(;n>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var n,r={};if(this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"){var o=this.settings.material;n=fu.merge([ze.common,ze.envmap,ze.aomap,ze.lightmap,ze.emissivemap,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.roughnessmap,ze.metalnessmap,ze.fog,ze.lights,{emissive:{value:new me(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),n.diffuse.value=o.color,n.opacity.value=o.opacity,n.emissive.value=o.emissive,n.roughness.value=o.roughness,n.metalness.value=o.metalness,o.envMap&&(n.envMap.value=o.envMap,n.envMapIntensity.value=o.envMapIntensity),o.normalMap&&(n.normalMap.value=o.normalMap,n.normalScale.value=o.normalScale),o.roughnessMap&&(n.roughnessMap.value=o.roughnessMap),o.metalnessMap&&(n.metalnessMap.value=o.metalnessMap),o.map&&(n.map=new Se(o.map))}else n={},n.map=new Se(this.settings.material.map);this.settings.material.alphaTest&&(r.USE_ALPHATEST="",n.alphaTest=new Se(this.settings.material.alphaTest)),r.USE_UV="";var a=this.settings.uTileCount,l=this.settings.vTileCount;(a>1||l>1)&&(r.UV_TILE="",n.tileCount=new Se(new Z(a,l))),this.settings.material.normalMap&&(r.USE_NORMALMAP="",r.NORMALMAP_UV=dP(this.settings.material.normalMap.channel),n.normalMapTransform=new Se(new Ht().copy(this.settings.material.normalMap.matrix))),this.settings.material.map&&(r.USE_MAP="",r.MAP_UV=dP(this.settings.material.map.channel),n.mapTransform=new Se(new Ht().copy(this.settings.material.map.matrix))),r.USE_COLOR_ALPHA="";var c=!1;if(this.settings.renderMode===ht.BillBoard||this.settings.renderMode===ht.VerticalBillBoard||this.settings.renderMode===ht.HorizontalBillBoard||this.settings.renderMode===ht.Mesh){var h,d;this.settings.renderMode===ht.Mesh?this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"?(r.USE_COLOR="",h=Iue,d=Eue,c=!0):(h=Mue,d=FM):(h=Tue,d=FM),this.settings.renderMode===ht.VerticalBillBoard?r.VERTICAL="":this.settings.renderMode===ht.HorizontalBillBoard&&(r.HORIZONTAL=""),this.material=new Rt({uniforms:n,defines:r,vertexShader:h,fragmentShader:d,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,lights:c})}else if(this.settings.renderMode===ht.StretchedBillBoard)n.speedFactor=new Se(1),this.material=new Rt({uniforms:n,defines:r,vertexShader:Rue,fragmentShader:FM,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var n=this,r=0,o=0;this.systems.forEach(function(a){o+=a.particleNum}),o>this.maxParticles&&this.expandBuffers(o),this.systems.forEach(function(a){var l=a.particles,c=a.particleNum,h=n.quaternion2_,d=n.vector2_,f=n.vector3_;a.emitter.matrixWorld.decompose(d,h,f),n.rotationMat_.setFromMatrix4(a.emitter.matrixWorld);for(var p=0;p<c;p++,r++){var m=l[p];if(n.settings.renderMode===ht.Mesh){var v=void 0;if(a.worldSpace)v=m.rotation;else{var y=void 0;m.parentMatrix?y=n.quaternion3_.setFromRotationMatrix(m.parentMatrix):y=h,v=n.quaternion_,v.copy(m.rotation).multiply(y)}n.rotationBuffer.setXYZW(r,v.x,v.y,v.z,v.w)}else(n.settings.renderMode===ht.StretchedBillBoard||n.settings.renderMode===ht.VerticalBillBoard||n.settings.renderMode===ht.HorizontalBillBoard||n.settings.renderMode===ht.BillBoard)&&n.rotationBuffer.setX(r,m.rotation);var g=void 0;if(a.worldSpace?g=m.position:(g=n.vector_,m.parentMatrix?g.copy(m.position).applyMatrix4(m.parentMatrix):g.copy(m.position).applyMatrix4(a.emitter.matrixWorld)),n.offsetBuffer.setXYZ(r,g.x,g.y,g.z),n.colorBuffer.setXYZW(r,m.color.x,m.color.y,m.color.z,m.color.w),a.worldSpace||m.parentMatrix?n.sizeBuffer.setX(r,m.size):n.sizeBuffer.setX(r,m.size*(Math.abs(f.x)+Math.abs(f.y)+Math.abs(f.z))/3),n.uvTileBuffer.setX(r,m.uvTile),n.settings.renderMode===ht.StretchedBillBoard&&n.velocityBuffer){var _=a.speedFactor,A=void 0;a.worldSpace?A=m.velocity:(A=n.vector_,m.parentMatrix?(n.rotationMat2_.setFromMatrix4(m.parentMatrix),A.copy(m.velocity).applyMatrix3(n.rotationMat2_)):A.copy(m.velocity).applyMatrix3(n.rotationMat_)),n.velocityBuffer.setXYZ(r,A.x*_,A.y*_,A.z*_)}}}),this.geometry.instanceCount=r,r>0&&(this.offsetBuffer.updateRange.count=r*3,this.offsetBuffer.needsUpdate=!0,this.sizeBuffer.updateRange.count=r,this.sizeBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=r*4,this.colorBuffer.needsUpdate=!0,this.uvTileBuffer.updateRange.count=r,this.uvTileBuffer.needsUpdate=!0,this.settings.renderMode===ht.StretchedBillBoard&&this.velocityBuffer&&(this.velocityBuffer.updateRange.count=r*3,this.velocityBuffer.needsUpdate=!0),this.settings.renderMode===ht.Mesh?(this.rotationBuffer.updateRange.count=r*4,this.rotationBuffer.needsUpdate=!0):(this.settings.renderMode===ht.StretchedBillBoard||this.settings.renderMode===ht.HorizontalBillBoard||this.settings.renderMode===ht.VerticalBillBoard||this.settings.renderMode===ht.BillBoard)&&(this.rotationBuffer.updateRange.count=r,this.rotationBuffer.needsUpdate=!0))}},{key:"dispose",value:function(){this.geometry.dispose()}}]),t}(v8),Bue=`

#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

uniform sampler2D alphaMap;
uniform float useAlphaMap;
uniform float visibility;
uniform float alphaTest;
uniform vec2 repeat;

varying vec4 vColor;
    
void main() {
    #include <clipping_planes_fragment>
    #include <logdepthbuf_fragment>

    vec4 c = vColor;
    
    #ifdef USE_MAP
    c *= texture2D( map, vUv * repeat );
    #endif
    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUv * repeat ).a;
    if( c.a < alphaTest ) discard;
    gl_FragColor = c;

    #include <fog_fragment>
    #include <tonemapping_fragment>
}`,Due=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <fog_pars_vertex>

attribute vec3 previous;
attribute vec3 next;
attribute float side;
attribute float width;

uniform vec2 resolution;
uniform float lineWidth;
uniform float sizeAttenuation;
    
vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
}
    
void main() {

    `.concat(W_,`
    
    float aspect = resolution.x / resolution.y;

    vColor = color;

    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4( position, 1.0 );
    vec4 prevPos = m * vec4( previous, 1.0 );
    vec4 nextPos = m * vec4( next, 1.0 );

    vec2 currentP = fix( finalPosition, aspect );
    vec2 prevP = fix( prevPos, aspect );
    vec2 nextP = fix( nextPos, aspect );

    float w = lineWidth * width;

    vec2 dir;
    if( nextP == currentP ) dir = normalize( currentP - prevP );
    else if( prevP == currentP ) dir = normalize( nextP - currentP );
    else {
        vec2 dir1 = normalize( currentP - prevP );
        vec2 dir2 = normalize( nextP - currentP );
        dir = normalize( dir1 + dir2 );

        vec2 perp = vec2( -dir1.y, dir1.x );
        vec2 miter = vec2( -dir.y, dir.x );
        //w = clamp( w / dot( miter, perp ), 0., 4., * lineWidth * width );

    }

    //vec2 normal = ( cross( vec3( dir, 0. ) vec3( 0., 0., 1. ) ) ).xy;
    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );
    normal.xy *= .5 * w;
    normal *= projectionMatrix;
    if( sizeAttenuation == 0. ) {
        normal.xy *= finalPosition.w;
        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;
    }

    finalPosition.xy += normal.xy * side;

    gl_Position = finalPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    
	#include <fog_vertex>
}`);new w(0,0,1);var Oue=function(s){Nv(t,s);var e=zv(t);function t(i){var n;return Lt(this,t),n=e.call(this,i),te(vi(n),"positionBuffer",void 0),te(vi(n),"previousBuffer",void 0),te(vi(n),"nextBuffer",void 0),te(vi(n),"uvBuffer",void 0),te(vi(n),"sideBuffer",void 0),te(vi(n),"widthBuffer",void 0),te(vi(n),"colorBuffer",void 0),te(vi(n),"indexBuffer",void 0),te(vi(n),"vector_",new w),te(vi(n),"vector2_",new w),te(vi(n),"vector3_",new w),te(vi(n),"quaternion_",new xe),n.maxParticles=1e4,n.setupBuffers(),n.rebuildMaterial(),n}return kt(t,[{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new pt,this.indexBuffer=new ot(new Uint32Array(this.maxParticles*6),1),this.indexBuffer.setUsage(Hr),this.geometry.setIndex(this.indexBuffer),this.positionBuffer=new ot(new Float32Array(this.maxParticles*6),3),this.positionBuffer.setUsage(Hr),this.geometry.setAttribute("position",this.positionBuffer),this.previousBuffer=new ot(new Float32Array(this.maxParticles*6),3),this.previousBuffer.setUsage(Hr),this.geometry.setAttribute("previous",this.previousBuffer),this.nextBuffer=new ot(new Float32Array(this.maxParticles*6),3),this.nextBuffer.setUsage(Hr),this.geometry.setAttribute("next",this.nextBuffer),this.widthBuffer=new ot(new Float32Array(this.maxParticles*2),1),this.widthBuffer.setUsage(Hr),this.geometry.setAttribute("width",this.widthBuffer),this.sideBuffer=new ot(new Float32Array(this.maxParticles*2),1),this.sideBuffer.setUsage(Hr),this.geometry.setAttribute("side",this.sideBuffer),this.uvBuffer=new ot(new Float32Array(this.maxParticles*4),2),this.uvBuffer.setUsage(Hr),this.geometry.setAttribute("uv",this.uvBuffer),this.colorBuffer=new ot(new Float32Array(this.maxParticles*8),4),this.colorBuffer.setUsage(Hr),this.geometry.setAttribute("color",this.colorBuffer)}},{key:"expandBuffers",value:function(n){for(;n>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var n={lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},resolution:{value:new Z(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0},repeat:{value:new Z(1,1)}},r={};if(r.USE_UV="",r.USE_COLOR_ALPHA="",this.settings.material.map&&(r.USE_MAP="",r.MAP_UV=dP(this.settings.material.map.channel),n.map=new Se(this.settings.material.map),n.mapTransform=new Se(new Ht().copy(this.settings.material.map.matrix))),this.settings.renderMode===ht.Trail)this.material=new Rt({uniforms:n,defines:r,vertexShader:Due,fragmentShader:Bue,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,side:this.settings.material.side,blending:this.settings.material.blending||Ed});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var n=this,r=0,o=0,a=0;this.systems.forEach(function(l){for(var c=0;c<l.particleNum;c++)a+=l.particles[c].previous.length*2}),a>this.maxParticles&&this.expandBuffers(a),this.systems.forEach(function(l){var c=n.quaternion_,h=n.vector2_,d=n.vector3_;l.emitter.matrixWorld.decompose(h,c,d);for(var f=l.particles,p=l.particleNum,m=n.settings.uTileCount,v=n.settings.vTileCount,y=1/m,g=1/v,_=0;_<p;_++){var A=f[_],b=A.uvTile%v,E=Math.floor(A.uvTile/v),C=A.previous.values(),T=C.next(),M=T.value,R=M;T.done||(T=C.next());var S=void 0;T.value!==void 0?S=T.value:S=R;for(var I=0;I<A.previous.length;I++,r+=2){if(n.positionBuffer.setXYZ(r,R.position.x,R.position.y,R.position.z),n.positionBuffer.setXYZ(r+1,R.position.x,R.position.y,R.position.z),l.worldSpace?(n.positionBuffer.setXYZ(r,R.position.x,R.position.y,R.position.z),n.positionBuffer.setXYZ(r+1,R.position.x,R.position.y,R.position.z)):(A.parentMatrix?n.vector_.copy(R.position).applyMatrix4(A.parentMatrix):n.vector_.copy(R.position).applyMatrix4(l.emitter.matrixWorld),n.positionBuffer.setXYZ(r,n.vector_.x,n.vector_.y,n.vector_.z),n.positionBuffer.setXYZ(r+1,n.vector_.x,n.vector_.y,n.vector_.z)),l.worldSpace?(n.previousBuffer.setXYZ(r,M.position.x,M.position.y,M.position.z),n.previousBuffer.setXYZ(r+1,M.position.x,M.position.y,M.position.z)):(A.parentMatrix?n.vector_.copy(M.position).applyMatrix4(A.parentMatrix):n.vector_.copy(M.position).applyMatrix4(l.emitter.matrixWorld),n.previousBuffer.setXYZ(r,n.vector_.x,n.vector_.y,n.vector_.z),n.previousBuffer.setXYZ(r+1,n.vector_.x,n.vector_.y,n.vector_.z)),l.worldSpace?(n.nextBuffer.setXYZ(r,S.position.x,S.position.y,S.position.z),n.nextBuffer.setXYZ(r+1,S.position.x,S.position.y,S.position.z)):(A.parentMatrix?n.vector_.copy(S.position).applyMatrix4(A.parentMatrix):n.vector_.copy(S.position).applyMatrix4(l.emitter.matrixWorld),n.nextBuffer.setXYZ(r,n.vector_.x,n.vector_.y,n.vector_.z),n.nextBuffer.setXYZ(r+1,n.vector_.x,n.vector_.y,n.vector_.z)),n.sideBuffer.setX(r,-1),n.sideBuffer.setX(r+1,1),l.worldSpace)n.widthBuffer.setX(r,R.size),n.widthBuffer.setX(r+1,R.size);else if(A.parentMatrix)n.widthBuffer.setX(r,R.size),n.widthBuffer.setX(r+1,R.size);else{var L=(Math.abs(d.x)+Math.abs(d.y)+Math.abs(d.z))/3;n.widthBuffer.setX(r,R.size*L),n.widthBuffer.setX(r+1,R.size*L)}n.uvBuffer.setXY(r,(I/A.previous.length+b)*y,(v-E-1)*g),n.uvBuffer.setXY(r+1,(I/A.previous.length+b)*y,(v-E)*g),n.colorBuffer.setXYZW(r,R.color.x,R.color.y,R.color.z,R.color.w),n.colorBuffer.setXYZW(r+1,R.color.x,R.color.y,R.color.z,R.color.w),I+1<A.previous.length&&(n.indexBuffer.setX(o*3,r),n.indexBuffer.setX(o*3+1,r+1),n.indexBuffer.setX(o*3+2,r+2),o++,n.indexBuffer.setX(o*3,r+2),n.indexBuffer.setX(o*3+1,r+1),n.indexBuffer.setX(o*3+2,r+3),o++),M=R,R=S,T.done||(T=C.next(),T.value!==void 0&&(S=T.value))}}}),this.positionBuffer.updateRange.count=r*3,this.positionBuffer.needsUpdate=!0,this.previousBuffer.updateRange.count=r*3,this.previousBuffer.needsUpdate=!0,this.nextBuffer.updateRange.count=r*3,this.nextBuffer.needsUpdate=!0,this.sideBuffer.updateRange.count=r,this.sideBuffer.needsUpdate=!0,this.widthBuffer.updateRange.count=r,this.widthBuffer.needsUpdate=!0,this.uvBuffer.updateRange.count=r*2,this.uvBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=r*4,this.colorBuffer.needsUpdate=!0,this.indexBuffer.updateRange.count=o*3,this.indexBuffer.needsUpdate=!0,this.geometry.setDrawRange(0,o*3)}},{key:"dispose",value:function(){this.geometry.dispose()}}]),t}(v8),Lue=function(s){Nv(t,s);var e=zv(t);function t(){var i;return Lt(this,t),i=e.call(this),te(vi(i),"batches",[]),te(vi(i),"systemToBatchIndex",new Map),te(vi(i),"type","BatchedRenderer"),i}return kt(t,[{key:"addSystem",value:function(n){n._renderer=this;for(var r=n.getRendererSettings(),o=0;o<this.batches.length;o++)if(t.equals(this.batches[o].settings,r)){this.batches[o].addSystem(n),this.systemToBatchIndex.set(n,o);return}var a;switch(r.renderMode){case ht.Trail:a=new Oue(r);break;case ht.Mesh:case ht.BillBoard:case ht.VerticalBillBoard:case ht.HorizontalBillBoard:case ht.StretchedBillBoard:a=new Pue(r);break}a.addSystem(n),this.batches.push(a),this.systemToBatchIndex.set(n,this.batches.length-1),this.add(a)}},{key:"deleteSystem",value:function(n){var r=this.systemToBatchIndex.get(n);r!=null&&(this.batches[r].removeSystem(n),this.systemToBatchIndex.delete(n))}},{key:"updateSystem",value:function(n){this.deleteSystem(n),this.addSystem(n)}},{key:"update",value:function(n){this.systemToBatchIndex.forEach(function(o,a){a.update(n)});for(var r=0;r<this.batches.length;r++)this.batches[r].update()}}],[{key:"equals",value:function(n,r){return n.material.side===r.material.side&&n.material.blending===r.material.blending&&n.material.transparent===r.material.transparent&&n.material.type===r.material.type&&n.material.alphaTest===r.material.alphaTest&&n.material.map===r.material.map&&n.renderMode===r.renderMode&&n.uTileCount===r.uTileCount&&n.vTileCount===r.vTileCount&&n.instancingGeometry===r.instancingGeometry&&n.renderOrder===r.renderOrder&&n.layers.mask===r.layers.mask}}]),t}(ge),kue=Lue,cN=function(){function s(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new w;Lt(this,s),te(this,"locations",[]),this.scaleX=e,this.scaleY=t,this.position=i}return kt(s,[{key:"transform",value:function(t,i){t.x=this.locations[i%this.locations.length].x*this.scaleX+this.position.x,t.y=this.locations[i%this.locations.length].y*this.scaleY+this.position.y,t.z=this.position.z}},{key:"clone",value:function(){var t=new s(this.scaleX,this.scaleY,this.position.clone());return t.locations=this.locations.map(function(i){return i.clone()}),t}},{key:"toJSON",value:function(){return{scaleX:this.scaleX,scaleY:this.scaleY,position:this.position,locations:this.locations.map(function(t){return{x:t.x,y:t.y}})}}},{key:"fromImage",value:function(t,i){var n=document.createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d");if(r){r.drawImage(t,0,0);var o=r.getImageData(0,0,n.width,n.height,{colorSpace:"srgb"});n.remove(),this.locations.length=0;for(var a=0;a<o.height;a++)for(var l=0;l<o.width;l++)o.data[(a*o.width+l)*4+3]>i&&this.locations.push(new Z(l,o.height-a))}}}],[{key:"fromJSON",value:function(t){var i=new s(t.scaleX,t.scaleY,new w(t.position[0],t.position[1],t.position[2]));return i.locations=t.locations.map(function(n){return new Z(n.x,n.y)}),i}}]),s}();function Fue(s){switch(s.type){case"TextureSequencer":return cN.fromJSON(s);default:return new cN}}var Uue=function(){function s(e){Lt(this,s),te(this,"type","ApplySequences"),te(this,"sequencers",[]),te(this,"time",0),te(this,"index",0),te(this,"pCount",0),te(this,"delay",void 0),te(this,"tempV",new w),this.delay=e}return kt(s,[{key:"initialize",value:function(t){t.id=this.pCount,t.dst=new w,t.begin=new w,t.inMotion=!1,this.pCount++}},{key:"reset",value:function(){this.time=0,this.index=0,this.pCount=0}},{key:"update",value:function(t,i){var n=this.sequencers[this.index],r=t.id*this.delay;this.time>=n[0].a+r&&this.time<=n[0].b+r?(t.inMotion||(t.inMotion=!0,t.begin.copy(t.position),n[1].transform(t.dst,t.id)),t.position.lerpVectors(t.begin,t.dst,s.BEZIER.genValue((this.time-n[0].a-r)/(n[0].b-n[0].a)))):this.time>n[0].b+r&&(t.inMotion=!1)}},{key:"frameUpdate",value:function(t){for(;this.index+1<this.sequencers.length&&this.time>=this.sequencers[this.index+1][0].a;)this.index++;this.time+=t}},{key:"appendSequencer",value:function(t,i){this.sequencers.push([t,i])}},{key:"toJSON",value:function(){return{type:this.type,delay:this.delay,sequencers:this.sequencers.map(function(t){var i=Fg(t,2),n=i[0],r=i[1];return{range:n.toJSON(),sequencer:r.toJSON()}})}}},{key:"clone",value:function(){var t=new s(this.delay);return t.sequencers=this.sequencers.map(function(i){return[i[0].clone(),i[1].clone()]}),t}}],[{key:"fromJSON",value:function(t){var i=new s(t.delay);return t.sequencers.forEach(function(n){i.sequencers.push([cn(n.range),Fue(n.sequencer)])}),i}}]),s}();te(Uue,"BEZIER",new lP(0,0,1,1));var de=function(s){return s[s.Number=0]="Number",s[s.Vec2=1]="Vec2",s[s.Vec3=2]="Vec3",s[s.Vec4=3]="Vec4",s[s.Boolean=4]="Boolean",s[s.AnyType=5]="AnyType",s}({}),hN=kt(function s(e,t,i,n){Lt(this,s),te(this,"input",void 0),te(this,"inputIndex",void 0),te(this,"output",void 0),te(this,"outputIndex",void 0),this.input=e,this.inputIndex=t,this.input.outputs[t].push(this),this.output=i,this.outputIndex=n,this.output.inputs[n]=this}),Nue=function(){function s(){Lt(this,s),te(this,"visited",new Set),te(this,"graph_",void 0),te(this,"context_",void 0),s.Instance=this}return kt(s,[{key:"traverse",value:function(t){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");this.visited.add(t.id);for(var i=[],n=0;n<t.inputs.length;n++)if(t.inputs[n]instanceof hN){var r=t.inputs[n].input;this.visited.has(r.id)||this.traverse(r),i.push(r.outputValues[t.inputs[n].inputIndex])}else i.push(t.inputs[n].getValue(this.context_));t.func(this.context_,i,t.outputValues),this.graph_.nodesInOrder.push(t)}},{key:"executeCompiledGraph",value:function(){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");for(var t=this.graph_.nodesInOrder,i=0;i<t.length;i++){for(var n=[],r=t[i],o=0;o<r.inputs.length;o++)if(r.inputs[o]instanceof hN)n.push(r.inputs[o].input.outputValues[r.inputs[o].inputIndex]);else if(r.inputs[o]!==void 0)n.push(r.inputs[o].getValue(this.context_));else throw new Error("miss input for node ".concat(r.id));r.func(this.context_,n,r.outputValues)}}},{key:"run",value:function(t,i){if(this.graph_=t,this.context_=i,t.compiled)this.executeCompiledGraph();else{t.nodesInOrder.length=0,this.visited.clear();for(var n=0;n<t.outputNodes.length;n++){var r=t.outputNodes[n];this.traverse(r)}t.compiled=!0}}}]),s}();te(Nue,"Instance",void 0);var Ei=function(){function s(e){Lt(this,s),te(this,"name",void 0),te(this,"nodeTypeSignatures",[]),this.name=e}return kt(s,[{key:"addSignature",value:function(t,i,n){this.nodeTypeSignatures.push({inputTypes:t,outputTypes:i,func:n})}}]),s}(),KE=new Ei("add");KE.addSignature([de.Number,de.Number],[de.Number],function(s,e,t,i){i[0]=t[0]+t[1]});KE.addSignature([de.Vec2,de.Vec2],[de.Vec2],function(s,e,t,i){i[0].addVectors(t[0],t[1])});KE.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(s,e,t,i){i[0].addVectors(t[0],t[1])});KE.addSignature([de.Vec4,de.Vec4],[de.Vec4],function(s,e,t,i){i[0].addVectors(t[0],t[1])});var JE=new Ei("sub");JE.addSignature([de.Number,de.Number],[de.Number],function(s,e,t,i){i[0]=t[0]-t[1]});JE.addSignature([de.Vec2,de.Vec2],[de.Vec2],function(s,e,t,i){i[0].subVectors(t[0],t[1])});JE.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(s,e,t,i){i[0].subVectors(t[0],t[1])});JE.addSignature([de.Vec4,de.Vec4],[de.Vec4],function(s,e,t,i){i[0].subVectors(t[0],t[1])});var ZE=new Ei("mul");ZE.addSignature([de.Number,de.Number],[de.Number],function(s,e,t,i){i[0]=t[0]*t[1]});ZE.addSignature([de.Vec2,de.Number],[de.Vec2],function(s,e,t,i){i[0].copy(t[0]).multiplyScalar(t[1])});ZE.addSignature([de.Vec3,de.Number],[de.Vec3],function(s,e,t,i){i[0].copy(t[0]).multiplyScalar(t[1])});ZE.addSignature([de.Vec4,de.Number],[de.Vec4],function(s,e,t,i){i[0].copy(t[0]).multiplyScalar(t[1])});var $E=new Ei("div");$E.addSignature([de.Number,de.Number],[de.Number],function(s,e,t,i){i[0]=t[0]/t[1]});$E.addSignature([de.Vec2,de.Number],[de.Vec2],function(s,e,t,i){i[0].copy(t[0]).divideScalar(t[1])});$E.addSignature([de.Vec3,de.Number],[de.Vec3],function(s,e,t,i){i[0].copy(t[0]).divideScalar(t[1])});$E.addSignature([de.Vec4,de.Number],[de.Vec4],function(s,e,t,i){i[0].copy(t[0]).divideScalar(t[1])});var zue=new Ei("sin");zue.addSignature([de.Number],[de.Number],function(s,e,t,i){i[0]=Math.sin(t[0])});var Gue=new Ei("cos");Gue.addSignature([de.Number],[de.Number],function(s,e,t,i){i[0]=Math.cos(t[0])});var Hue=new Ei("tan");Hue.addSignature([de.Number],[de.Number],function(s,e,t,i){i[0]=Math.tan(t[0])});var Vue=new Ei("abs");Vue.addSignature([de.Number],[de.Number],function(s,e,t,i){i[0]=Math.abs(t[0])});var Que=new Ei("min");Que.addSignature([de.Number,de.Number],[de.Number],function(s,e,t,i){i[0]=Math.min(t[0],t[1])});var jue=new Ei("max");jue.addSignature([de.Number,de.Number],[de.Number],function(s,e,t,i){i[0]=Math.max(t[0],t[1])});var HO=new Ei("dot");HO.addSignature([de.Vec2,de.Vec2],[de.Number],function(s,e,t,i){i[0]=t[0].dot(t[1])});HO.addSignature([de.Vec3,de.Vec3],[de.Number],function(s,e,t,i){i[0]=t[0].dot(t[1])});HO.addSignature([de.Vec4,de.Vec4],[de.Number],function(s,e,t,i){i[0]=t[0].dot(t[1])});var Wue=new Ei("cross");Wue.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(s,e,t,i){i[0].crossVectors(t[0],t[1])});var VO=new Ei("length");VO.addSignature([de.Vec2],[de.Number],function(s,e,t,i){i[0]=t[0].length()});VO.addSignature([de.Vec3],[de.Number],function(s,e,t,i){i[0]=t[0].length()});VO.addSignature([de.Vec4],[de.Number],function(s,e,t,i){i[0]=t[0].length()});var QO=new Ei("lengthSq");QO.addSignature([de.Vec2],[de.Number],function(s,e,t,i){i[0]=t[0].lengthSq()});QO.addSignature([de.Vec3],[de.Number],function(s,e,t,i){i[0]=t[0].lengthSq()});QO.addSignature([de.Vec4],[de.Number],function(s,e,t,i){i[0]=t[0].lengthSq()});var jO=new Ei("normalize");jO.addSignature([de.Vec2],[de.Vec2],function(s,e,t,i){i[0].copy(t[0]).normalize()});jO.addSignature([de.Vec3],[de.Vec3],function(s,e,t,i){i[0].copy(t[0]).normalize()});jO.addSignature([de.Vec4],[de.Vec4],function(s,e,t,i){i[0].copy(t[0]).normalize()});var y8=new Ei("distance");y8.addSignature([de.Vec2,de.Vec2],[de.Number],function(s,e,t,i){i[0]=t[0].distanceTo(t[1])});y8.addSignature([de.Vec3,de.Vec3],[de.Number],function(s,e,t,i){i[0]=t[0].distanceTo(t[1])});var que=new Ei("and");que.addSignature([de.Boolean,de.Boolean],[de.Boolean],function(s,e,t,i){i[0]=t[0]&&t[1]});var Xue=new Ei("or");Xue.addSignature([de.Boolean,de.Boolean],[de.Boolean],function(s,e,t,i){i[0]=t[0]||t[1]});var Yue=new Ei("not");Yue.addSignature([de.Boolean],[de.Boolean],function(s,e,t,i){i[0]=!t[0]});var e1=new Ei("equal");e1.addSignature([de.Number,de.Number],[de.Boolean],function(s,e,t,i){i[0]=t[0]===t[1]});e1.addSignature([de.Vec2,de.Vec2],[de.Boolean],function(s,e,t,i){i[0]=t[0].equals(t[1])});e1.addSignature([de.Vec3,de.Vec3],[de.Boolean],function(s,e,t,i){i[0]=t[0].equals(t[1])});e1.addSignature([de.Vec4,de.Vec4],[de.Boolean],function(s,e,t,i){i[0]=t[0].equals(t[1])});var Kue=new Ei("lessThan");Kue.addSignature([de.Number,de.Number],[de.Boolean],function(s,e,t,i){i[0]=t[0]<t[1]});var Jue=new Ei("greaterThan");Jue.addSignature([de.Number,de.Number],[de.Boolean],function(s,e,t,i){i[0]=t[0]>t[1]});var Zue=new Ei("lessThanOrEqual");Zue.addSignature([de.Number,de.Number],[de.Boolean],function(s,e,t,i){i[0]=t[0]<=t[1]});var $ue=new Ei("greaterThanOrEqual");$ue.addSignature([de.Number,de.Number],[de.Boolean],function(s,e,t,i){i[0]=t[0]>=t[1]});var ede=new Ei("if");ede.addSignature([de.Boolean,de.AnyType,de.AnyType],[de.AnyType],function(s,e,t,i){i[0]=t[0]?t[1]:t[2]});var tde=new Ei("number");tde.addSignature([],[de.Number],function(s,e,t,i){i[0]=e.value});var ide=new Ei("vec2");ide.addSignature([],[de.Vec2],function(s,e,t,i){i[0]=e.value});var nde=new Ei("vec3");nde.addSignature([],[de.Vec3],function(s,e,t,i){i[0]=e.value});var sde=new Ei("vec4");sde.addSignature([],[de.Vec4],function(s,e,t,i){i[0]=e.value});var rde=new Ei("bool");rde.addSignature([],[de.Boolean],function(s,e,t,i){i[0]=e.value});var ode=new Ei("particlePosition");ode.addSignature([],[de.Vec3],function(s,e,t,i){i[0]=s.particle[e.property]});var ade=new Ei("particleVelocity");ade.addSignature([],[de.Vec3],function(s,e,t,i){i[0]=s.particle[e.property]});var lde=new Ei("particleRotation");lde.addSignature([],[de.Number],function(s,e,t,i){i[0]=s.particle[e.property]});var cde=new Ei("particleAge");cde.addSignature([],[de.Number],function(s,e,t,i){i[0]=s.particle[e.property]});var q_=new Ei("output");q_.addSignature([de.Number],[de.Number],function(s,e,t,i){i[0]=t[0]});q_.addSignature([de.Vec2],[de.Vec2],function(s,e,t,i){i[0]=t[0]});q_.addSignature([de.Vec3],[de.Vec3],function(s,e,t,i){i[0]=t[0]});q_.addSignature([de.Vec4],[de.Vec4],function(s,e,t,i){i[0]=t[0]});q_.addSignature([de.Boolean],[de.Boolean],function(s,e,t,i){i[0]=t[0]});setTimeout(()=>console.log("Particle system powered by three.quarks. https://quarks.art/"),100);var Wn=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const tA=ie("debugparticles"),hde=ie("noprogressive"),ude=ie("debugprogressive");var VS;(function(s){s[s.Birth=0]="Birth",s[s.Collision=1]="Collision",s[s.Death=2]="Death",s[s.Trigger=3]="Trigger",s[s.Manual=4]="Manual"})(VS||(VS={}));class sl extends Te{constructor(){super(...arguments);u(this,"renderMode");u(this,"particleMaterial");u(this,"trailMaterial");u(this,"particleMesh");u(this,"maxParticleSize");u(this,"minParticleSize");u(this,"velocityScale");u(this,"cameraVelocityScale");u(this,"lengthScale")}start(){if(this.maxParticleSize!==.5&&this.minParticleSize!==0&&Xe()){const t=`ParticleSystem "${this.name}" has non-default min/max particle size. This may not render correctly. Please set min size to 0 and the max size to 0.5 and use the "StartSize" setting instead`;console.warn(t)}}get transparent(){var i;return((i=this.particleMaterial)==null?void 0:i.transparent)??!1}getMaterial(t=!1){let i=t===!0&&this.trailMaterial?this.trailMaterial:this.particleMaterial;return i&&t&&i.side===As&&(i=i.clone(),i.side=Gn,t?this.trailMaterial=i:this.particleMaterial=i),i&&!hde&&i._didRequestTextureLOD===void 0&&(i._didRequestTextureLOD=0,ude&&console.log("Load material LOD",i.name),fi.assignTextureLOD(i,0)),i}getMesh(t){let i=null;if(!i&&(this.particleMesh instanceof le&&(i=this.particleMesh.geometry),i===null)){i=new _s(1,1);const r=i.attributes.uv;for(let o=0;o<r.count;o++)r.setX(o,1-r.getX(o))}return new le(i,this.getMaterial())}}Wn([x()],sl.prototype,"renderMode",void 0);Wn([x(Vt)],sl.prototype,"particleMaterial",void 0);Wn([x(Vt)],sl.prototype,"trailMaterial",void 0);Wn([x()],sl.prototype,"maxParticleSize",void 0);Wn([x()],sl.prototype,"minParticleSize",void 0);Wn([x()],sl.prototype,"velocityScale",void 0);Wn([x()],sl.prototype,"cameraVelocityScale",void 0);Wn([x()],sl.prototype,"lengthScale",void 0);class Wx{constructor(e,t=1){u(this,"_curve");u(this,"_factor");u(this,"type","function");this._curve=e,this._factor=t}genValue(e){return this._curve.evaluate(e,Math.random())*this._factor}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class WO{constructor(e){u(this,"type","value");u(this,"system");this.system=e}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class dde extends WO{genValue(){return this.system.textureSheetAnimation.getStartIndex()}}class fde extends WO{constructor(){super(...arguments);u(this,"_lastPosition",new w);u(this,"_lastDistance",0)}update(){const t=Qt(this.system.gameObject);this._lastDistance=this._lastPosition.distanceTo(t),this._lastPosition.copy(t)}genValue(){if(!this.system.isPlaying||!this.system.emission.enabled||this.system.currentParticles>=this.system.maxParticles)return 0;let t=this.system.emission.rateOverTime.evaluate(this.system.time/this.system.duration,Math.random());if(this.system.deltaTime>0){const r=this.system.emission.rateOverDistance.evaluate(this.system.time/this.system.duration,Math.random());let a=this._lastDistance/this.system.deltaTime*r;Number.isFinite(a)||(a=0),t+=a}const i=this.system.emission.getBurst();i>0&&(t+=i/this.system.deltaTime);const n=this.system.maxParticles-this.system.currentParticles;return et.clamp(t,0,n/this.system.deltaTime)}}class pde extends WO{genValue(){return this.system.isPlaying,0}}class rf{constructor(e){u(this,"system");u(this,"type");this.type=Object.getPrototypeOf(this).constructor.name||"ParticleSystemBaseBehaviour",e&&(this.system=e)}get context(){return this.system.context}initialize(e){}update(e,t){}frameUpdate(e){}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}reset(){}}class mde extends rf{constructor(){super(...arguments);u(this,"type","NeedleTextureSheet")}update(t,i){const n=this.system.textureSheetAnimation;if(n.enabled){const r=t.age/t.life,o=n.evaluate(r);o!==void 0&&(t.uvTile=o)}}}const uN=Symbol("particleRotation");class gde extends rf{constructor(){super(...arguments);u(this,"type","NeedleRotation")}initialize(t){t[uN]=Math.random()}update(t,i){if(t.rotation===void 0)return;const n=t.age/t.life;if(typeof t.rotation=="number"&&(this.system.rotationOverLifetime.enabled?t.rotation+=this.system.rotationOverLifetime.evaluate(n,t[uN])*i:this.system.renderer.renderMode===vc.Billboard&&(t.rotation=Math.PI),this.system.rotationBySpeed.enabled)){const r=t.velocity.length();t.rotation+=this.system.rotationBySpeed.evaluate(n,r)*i}}}const dN=Symbol("sizeLerpFactor"),vde=new w;class yde extends rf{constructor(){super(...arguments);u(this,"type","NeedleSize");u(this,"_minSize",0);u(this,"_maxSize",1)}initialize(t){t[dN]=Math.random(),this._minSize=this.system.renderer.minParticleSize,this._maxSize=this.system.renderer.maxParticleSize}update(t,i){const n=t.age/t.life;let r=1;this.system.sizeOverLifetime.enabled&&(r*=this.system.sizeOverLifetime.evaluate(n,void 0,t[dN]).x);let o=1;if(this.system.renderer.renderMode!==vc.Mesh&&(o=this.system.worldScale.x/this.system.cameraScale),t.size=t.startSize*r*o,this.system.localspace){const a=A8(this.system,vde);t.size*=a.x}}}const vg=Symbol("particleLife"),UM=Symbol("trailLifetime"),fN=Symbol("trailStartLength"),NM=Symbol("trailWidthRandom");class Ade extends rf{constructor(){super(...arguments);u(this,"type","NeedleTrail")}initialize(t){t instanceof D0&&(t[vg]=t.life,this.system.trails.enabled&&this.system.trails.dieWithParticles===!1&&(t[UM]=this.system.trails.lifetime.evaluate(Math.random(),Math.random()),t.life+=t[UM]),t[fN]=t.length,t[NM]=Math.random())}update(t){var i;if((i=this.system.trails)!=null&&i.enabled&&t instanceof D0){const n=t,r=t.age/t[vg],o=t.previous.values(),a=t.previous.length;for(let l=0;l<a;l++){const h=o.next().value,d=1-l/(a-1);let f=t.size;f<=0&&!this.system.trails.sizeAffectsWidth&&(f=20*this.system.trails.widthOverTrail.evaluate(.5,n[NM])),h.size=this.system.trails.getWidth(f,r,d,n[NM]),h.color.copy(t.color),this.system.trails.getColor(h.color,r,d)}if(t.age>t[vg]){t.velocity.set(0,0,0);const l=(t.age-t[vg])/t[UM];n.length=et.lerp(t[fN],0,l)}}}}const qx=Symbol("startVelocity"),pN=Symbol("gravityModifier"),zM=Symbol("gravitySpeed"),Xx=Symbol("velocity lerp factor"),fP=new w;class _de extends rf{constructor(){super(...arguments);u(this,"type","NeedleVelocity");u(this,"_gravityDirection",new w)}initialize(t){var r,o;const i=this.system.main.simulationSpeed;t.startSpeed=this.system.main.startSpeed.evaluate(Math.random(),Math.random()),t.velocity.copy(this.system.shape.getDirection(t,t.position)).multiplyScalar(t.startSpeed),(r=this.system.inheritVelocity)!=null&&r.enabled&&this.system.inheritVelocity.applyInitial(t.velocity),t[qx]?t[qx].copy(t.velocity):t[qx]=t.velocity.clone();const n=this.system.main.gravityModifier.evaluate(Math.random(),Math.random());t[pN]=n*i,t[zM]=n*i*.5,t[Xx]=Math.random(),(o=this.system.velocityOverLifetime)==null||o.init(t),this._gravityDirection.set(0,-1,0),this.system.main.simulationSpace===Ol.Local&&this._gravityDirection.applyQuaternion(this.system.worldQuaternionInverted).normalize()}update(t,i){var f;const n=t[qx],r=t[pN];if(r!==0){const p=r*t[zM];fP.copy(this._gravityDirection).multiplyScalar(p),t[zM]+=i*.05,n.add(fP)}t.velocity.copy(n);const o=t.age/t.life;(f=this.system.inheritVelocity)!=null&&f.enabled&&this.system.inheritVelocity.applyCurrent(t.velocity,o,t[Xx]);const a=this.system.noise;a.enabled&&a.apply(0,t.position,t.velocity,i,t.age,t.life);const l=this.system.sizeBySpeed;l!=null&&l.enabled&&(t.size=l.evaluate(t.velocity,o,t[Xx],t.size));const c=this.system.colorBySpeed;c!=null&&c.enabled&&c.evaluate(t.velocity,t[Xx],t.color);const h=this.system.velocityOverLifetime;h.enabled&&h.apply(t,0,t.position,t.velocity,i,t.age,t.life);const d=this.system.limitVelocityOverLifetime;d.enabled&&d.apply(t.position,n,t.velocity,t.size,o,i,1),this.system.worldspace&&t.velocity.multiply(this.system.worldScale)}}const mN=Symbol("colorLerpFactor"),gN=new Vi(1,1,1,1),Tf=new Vi(1,1,1,1);class bde extends rf{constructor(){super(...arguments);u(this,"type","NeedleColor")}initialize(t){}_init(t){const i=this.system.renderer.particleMaterial;Tf.copy(this.system.main.startColor.evaluate(Math.random())),i!=null&&i.color&&(gN.copy(i.color),Tf.multiply(gN)),Tf.convertLinearToSRGB(),t.startColor.set(Tf.r,Tf.g,Tf.b,Tf.alpha),t.color.copy(t.startColor),t[mN]=Math.random()}update(t,i){if(t.age===0&&this._init(t),this.system.colorOverLifetime.enabled){const n=t.age/t.life,r=this.system.colorOverLifetime.color.evaluate(n,t[mN]);t.color.set(r.r,r.g,r.b,"alpha"in r?r.alpha:1).multiply(t.startColor)}else t.color.copy(t.startColor)}}class xde{constructor(e){u(this,"system");u(this,"emission");u(this,"autoDestroy");u(this,"startLength");u(this,"emissionBursts");u(this,"onlyUsedByOther");u(this,"behaviors",[]);u(this,"rendererEmitterSettings",{startLength:new Gr(220),followLocalOrigin:!1});u(this,"flatWhiteTexture");u(this,"clonedTexture",{original:void 0,clone:void 0});this.system=e,this.emission=new fde(this.system)}get anim(){return this.system.textureSheetAnimation}get prewarm(){return!1}get material(){return this.system.renderer.getMaterial(this.system.trails.enabled)}get layers(){return this.system.gameObject.layers}update(){this.emission.update()}get looping(){return this.system.main.loop}get duration(){return this.system.duration}get shape(){return this.system.shape}get startLife(){return new Wx(this.system.main.startLifetime)}get startSpeed(){return new Wx(this.system.main.startSpeed)}get startRotation(){return new Wx(this.system.main.startRotation)}get startSize(){return new Wx(this.system.main.startSize)}get startColor(){return new HS(new Je(1,1,1,1))}get emissionOverTime(){return this.emission}get emissionOverDistance(){return new pde(this.system)}get instancingGeometry(){return this.system.renderer.getMesh(this.system.renderer.renderMode).geometry}get renderMode(){if(this.system.trails.enabled===!0)return ht.Trail;switch(this.system.renderer.renderMode){case vc.Billboard:return ht.BillBoard;case vc.Stretch:return ht.StretchedBillBoard;case vc.HorizontalBillboard:return ht.HorizontalBillBoard;case vc.VerticalBillboard:return ht.VerticalBillBoard;case vc.Mesh:return ht.Mesh}return ht.BillBoard}get speedFactor(){var t;let e=this.system.main.simulationSpeed;return((t=this.system.renderer)==null?void 0:t.renderMode)===vc.Stretch&&(e*=this.system.renderer.velocityScale??1),e}get texture(){const e=this.material;if(e&&e.map){const t=e.map;if(this.clonedTexture.original!==t||!this.clonedTexture.clone){const i=t.clone();i.premultiplyAlpha=!1,i.colorSpace=Ui,this.clonedTexture.original=t,this.clonedTexture.clone=i}return this.clonedTexture.clone}return this.flatWhiteTexture||(this.flatWhiteTexture=zD(new Vi(1,1,1,1),1)),this.flatWhiteTexture}get startTileIndex(){return new dde(this.system)}get uTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesX:void 0}get vTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesY:void 0}get renderOrder(){return 1}get blending(){var e;return((e=this.system.renderer.particleMaterial)==null?void 0:e.blending)??pd}get transparent(){return this.system.renderer.transparent}get worldSpace(){return this.system.main.simulationSpace===Ol.World}}class wde{constructor(){u(this,"burstIndex",0);u(this,"burstWaveIndex",0);u(this,"time",0);u(this,"waitEmiting",0)}}class Bn extends Te{constructor(){super(...arguments);u(this,"_state");u(this,"colorOverLifetime");u(this,"main");u(this,"emission");u(this,"sizeOverLifetime");u(this,"shape");u(this,"noise");u(this,"trails");u(this,"velocityOverLifetime");u(this,"limitVelocityOverLifetime");u(this,"inheritVelocity");u(this,"colorBySpeed");u(this,"textureSheetAnimation");u(this,"rotationOverLifetime");u(this,"rotationBySpeed");u(this,"sizeBySpeed");u(this,"_cameraScale",1);u(this,"__worldQuaternion",new xe);u(this,"_worldQuaternionInverted",new xe);u(this,"_worldScale",new w);u(this,"_worldPositionFrame",-1);u(this,"_worldPos",new w);u(this,"_renderer");u(this,"_batchSystem");u(this,"_particleSystem");u(this,"_interface");u(this,"_container");u(this,"_time",0);u(this,"_isPlaying",!0);u(this,"_isUsedAsSubsystem",!1);u(this,"_didPreWarm",!1);u(this,"_bursts");u(this,"_subEmitterSystems");u(this,"_lastBatchesCount",-1);u(this,"lastMaterialVersion",-1)}play(t=!1){var i;t&&ne.foreachComponent(this.gameObject,n=>{n instanceof Bn&&n!==this&&n.play(!1)},!0),this._isPlaying=!0,this._particleSystem&&(this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1),(i=this.emission)==null||i.reset()}pause(t=!0){t&&ne.foreachComponent(this.gameObject,i=>{i instanceof Bn&&i!==this&&i.pause(!1)},!0),this._isPlaying=!1}stop(t=!0,i=!1){t&&ne.foreachComponent(this.gameObject,n=>{n instanceof Bn&&n!==this&&n.stop(!1,i)},!0),this._isPlaying=!1,this._time=0,i&&this.reset()}reset(){var t;this._time=0,this._particleSystem&&(this._particleSystem.particleNum=0,this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1,(t=this.emission)==null||t.reset())}emit(t){if(this._particleSystem){this.onUpdate(),t=Math.min(t,this.maxParticles-this.currentParticles),this._state||(this._state=new wde),this._state.waitEmiting=t,this._state.time=0;const i=this._particleSystem.emitEnded;this._particleSystem.emitEnded=!1,this._particleSystem.emit(this.deltaTime,this._state,this._particleSystem.emitter.matrixWorld),this._particleSystem.emitEnded=i}}get playOnAwake(){return this.main.playOnAwake}set playOnAwake(t){this.main.playOnAwake=t}get renderer(){return this._renderer}get isPlaying(){return this._isPlaying}get currentParticles(){var t;return((t=this._particleSystem)==null?void 0:t.particleNum)??0}get maxParticles(){return this.main.maxParticles}get time(){return this._time}get duration(){return this.main.duration}get deltaTime(){return this.context.time.deltaTime*this.main.simulationSpeed}get scale(){return this.gameObject.scale.x}get cameraScale(){return this._cameraScale}get container(){return this._container}get worldspace(){return this.main.simulationSpace===Ol.World}get localspace(){return this.main.simulationSpace===Ol.Local}get worldQuaternion(){return this.__worldQuaternion}get worldQuaternionInverted(){return this._worldQuaternionInverted}get worldScale(){return this._worldScale}get worldPos(){return this._worldPositionFrame!==this.context.time.frame&&(this._worldPositionFrame=this.context.time.frame,Qt(this.gameObject,this._worldPos)),this._worldPos}get matrixWorld(){return this._container.matrixWorld}get isSubsystem(){return this._isUsedAsSubsystem}addBehaviour(t){return this._particleSystem?(t instanceof rf&&(t.system=this),Xe()&&console.log("add behaviour",t),this._particleSystem.addBehavior(t),!0):!1}removeBehaviour(t){if(!this._particleSystem)return!1;const i=this._particleSystem.behaviors,n=i.indexOf(t);return n!==-1&&i.splice(n,1),!0}removeAllBehaviours(){return this._particleSystem?(this._particleSystem.behaviors.length=0,!0):!1}get behaviours(){return this._particleSystem?this._particleSystem.behaviors:null}get particleSystem(){return this._particleSystem??null}set bursts(t){for(let i=0;i<t.length;i++){const n=t[i];if(!(n instanceof I0)){const r=new I0;iv(r,n),t[i]=r}}this._bursts=t}set subEmitterSystems(t){for(let i=0;i<t.length;i++){const n=t[i];if(!(n instanceof k0)){const r=new k0;iv(r,n),t[i]=r}}tA&&t.length>0&&console.log("SubEmitters: ",t,this),this._subEmitterSystems=t}onAfterDeserialize(t){if(this._subEmitterSystems&&Array.isArray(this._subEmitterSystems))for(const i of this._subEmitterSystems)i._deserialize(this.context,this.gameObject)}awake(){if(this._worldPositionFrame=-1,this._renderer=this.gameObject.getComponent(sl),!this.main)throw new Error("Not Supported: ParticleSystem needs a serialized MainModule. Creating new particle systems at runtime is currently not supported.");this._container=new ge,this._container.matrixAutoUpdate=!1,this.context.scene.add(this._container),this._batchSystem=new kue,this._batchSystem.name=this.gameObject.name,this._container.add(this._batchSystem),this._interface=new xde(this),this._particleSystem=new Cue(this._interface),this._particleSystem.addBehavior(new yde(this)),this._particleSystem.addBehavior(new bde(this)),this._particleSystem.addBehavior(new mde(this)),this._particleSystem.addBehavior(new gde(this)),this._particleSystem.addBehavior(new _de(this)),this._particleSystem.addBehavior(new Ade(this)),this._batchSystem.addSystem(this._particleSystem);const t=this._particleSystem.emitter;this.context.scene.add(t),this.inheritVelocity.system&&this.inheritVelocity.system!==this&&(this.inheritVelocity=this.inheritVelocity.clone()),this.inheritVelocity.awake(this),tA&&(console.log(this),this.gameObject.add(new xo(1)))}start(){this.addSubParticleSystems(),this.updateLayers(),this.renderer.particleMesh instanceof le&&this._interface.renderMode==ht.Mesh&&fi.assignMeshLOD(this.renderer.particleMesh,0).then(t=>{t&&this.particleSystem&&this._interface.renderMode==ht.Mesh&&(this.particleSystem.instancingGeometry=t)})}onDestroy(){var t,i,n,r;(t=this._container)==null||t.removeFromParent(),(i=this._batchSystem)==null||i.removeFromParent(),(n=this._particleSystem)==null||n.emitter.removeFromParent(),(r=this._particleSystem)==null||r.dispose()}onEnable(){this.main&&(this.inheritVelocity&&(this.inheritVelocity.system=this),this._batchSystem&&(this._batchSystem.visible=!0),this.playOnAwake&&this.play(),this._isPlaying=this.playOnAwake)}onDisable(){this._batchSystem&&(this._batchSystem.visible=!1)}onBeforeRender(){var t;this.main&&(this._didPreWarm===!1&&((t=this.main)==null?void 0:t.prewarm)===!0&&(this._didPreWarm=!0,this.preWarm()),this.onUpdate(),this.onSimulate(this.deltaTime))}preWarm(){var h;if(!((h=this.emission)!=null&&h.enabled)||this.emission.rateOverTime.getMax()<=0)return;const i=1/60,n=this.main.duration,r=this.main.startLifetime.getMax(),o=1e3,a=Math.min(Math.max(n,r)/Math.max(.01,this.main.simulationSpeed),o),l=Math.ceil(a/i),c=Date.now();tA&&console.log(`Particles ${this.name} - Prewarm for ${l} frames (${a} sec). Duration: ${n}, Lifetime: ${r}`);for(let d=0;d<l&&!(this.currentParticles>=this.maxParticles);d++){const f=Date.now()-c;if(f>2e3){console.warn(`Particles ${this.name} - Prewarm took too long. Aborting: ${f}`);break}this.onUpdate(),this.onSimulate(i)}}onSimulate(t){if(this._batchSystem){let i=this.context.time.frameCount%60===0;this._lastBatchesCount!==this._batchSystem.batches.length&&(this._lastBatchesCount=this._batchSystem.batches.length,i=!0),i&&this.updateLayers(),this._batchSystem.update(t)}this._time+=t,this._time>this.duration&&(this._time=0)}updateLayers(){if(this._batchSystem)for(let t=0;t<this._batchSystem.batches.length;t++){const i=this._batchSystem.batches[t];i.layers.disableAll();const n=this.layer;i.layers.mask=1<<n}}onUpdate(){var o,a;const t=this.renderer.getMaterial(this.trails.enabled);if(t&&t.version!=this.lastMaterialVersion&&this._particleSystem&&(this.lastMaterialVersion=t.version,this._particleSystem.texture=this._interface.texture),this._bursts&&(this.emission.bursts=this._bursts,delete this._bursts),!this._isPlaying)return;const i=this.context.mainCamera;if(i){const l=ln(i);this._cameraScale=l.x}const n=!this.worldspace,r=this.gameObject;if(qi(r,this.__worldQuaternion),this._worldQuaternionInverted.copy(this.__worldQuaternion).invert(),ln(this.gameObject,this._worldScale),n&&this._container&&((o=this.gameObject)!=null&&o.parent)){const l=A8(this,fP);this._container.matrix.makeScale(l.x,l.y,l.z),this._container.matrix.makeRotationFromQuaternion(this.__worldQuaternion),this._container.matrix.setPosition(this.worldPos),this._container.matrix.scale(this.gameObject.scale)}this.emission.system=this,this._interface.update(),this.shape.update(this,this.context,this.main.simulationSpace,this.gameObject),this.noise.update(this.context),(a=this.inheritVelocity)==null||a.update(this.context),this.velocityOverLifetime.update(this)}addSubParticleSystems(){var t;if(this._subEmitterSystems&&this._particleSystem)for(const i of this._subEmitterSystems){i.particleSystem&&(i.particleSystem.__internalAwake?i.particleSystem.__internalAwake():Xe()&&console.warn("SubParticleSystem serialization issue(?)",i.particleSystem,i));const n=(t=i.particleSystem)==null?void 0:t._particleSystem;if(n){i.particleSystem._isUsedAsSubsystem=!0;const r=new t1(this,this._particleSystem,i.particleSystem,n);r.emitterType=i.type,r.emitterProbability=i.emitProbability,this._particleSystem.addBehavior(r)}else tA&&console.warn("Could not add SubParticleSystem",i,this)}}}Wn([x(N_)],Bn.prototype,"colorOverLifetime",void 0);Wn([x(Ir)],Bn.prototype,"main",void 0);Wn([x(sh)],Bn.prototype,"emission",void 0);Wn([x(ef)],Bn.prototype,"sizeOverLifetime",void 0);Wn([x(en)],Bn.prototype,"shape",void 0);Wn([x(ji)],Bn.prototype,"noise",void 0);Wn([x(Ln)],Bn.prototype,"trails",void 0);Wn([x(jn)],Bn.prototype,"velocityOverLifetime",void 0);Wn([x(ws)],Bn.prototype,"limitVelocityOverLifetime",void 0);Wn([x(rh)],Bn.prototype,"inheritVelocity",void 0);Wn([x(nm)],Bn.prototype,"colorBySpeed",void 0);Wn([x(Rr)],Bn.prototype,"textureSheetAnimation",void 0);Wn([x(nl)],Bn.prototype,"rotationOverLifetime",void 0);Wn([x(Ta)],Bn.prototype,"rotationBySpeed",void 0);Wn([x(Mo)],Bn.prototype,"sizeBySpeed",void 0);class k0{constructor(){u(this,"particleSystem");u(this,"emitProbability",1);u(this,"properties");u(this,"type")}_deserialize(e,t){const i=this.particleSystem;if(i instanceof Bn)return;let n="";i&&typeof i.guid=="string"&&(n=i.guid,this.particleSystem=ne.findByGuid(n,t)),tA&&!(this.particleSystem instanceof Bn)&&console.warn("Could not find particle system for sub emitter",n,t,this)}}function A8(s,e){if(e.set(1,1,1),s.gameObject.parent&&s.localspace)switch(s.main.scalingMode){case OS.Local:e=ln(s.gameObject.parent,e),e.x=1/e.x,e.y=1/e.y,e.z=1/e.z;break;default:if(!s.unsupported_scaling_mode){s.unsupported_scaling_mode=!0;const t="ParticleSystem scale mode "+OS[s.main.scalingMode]+" is not supported";Xe()&&Yi(t),console.warn(t,s.name,s)}e=ln(s.gameObject,e);break}return e}new w(1,1,1);new w(0,0,1);class t1{constructor(e,t,i,n){u(this,"system");u(this,"particleSystem");u(this,"subSystem");u(this,"subParticleSystem");u(this,"type","NeedleParticleSubEmitter");u(this,"emitterType");u(this,"emitterProbability");u(this,"q_",new xe);u(this,"v_",new w);u(this,"v2_",new w);u(this,"_emitterMatrix",new fe);u(this,"_circularBuffer");this.system=e,this.particleSystem=t,this.subSystem=i,this.subParticleSystem=n,this.subParticleSystem&&this.subParticleSystem&&(this.subParticleSystem.onlyUsedByOther=!0);const r=1e3;this._circularBuffer=new _a(()=>new fe,r)}clone(){throw new Error("Method not implemented.")}initialize(e){e.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this._emitterMatrix.copy(this.subSystem.matrixWorld).invert().premultiply(this.system.matrixWorld),this._emitterMatrix.setPosition(0,0,0),this.emitterType===VS.Birth&&this.run(e)}update(e,t){this.run(e)}frameUpdate(e){}toJSON(){}reset(){}run(e){if(this.subSystem.currentParticles>=this.subSystem.main.maxParticles||!this.subParticleSystem||!e.emissionState||this.emitterProbability&&Math.random()>this.emitterProbability)return;const t=this.system.deltaTime;if(this.emitterType===VS.Death){let n=e.life;if(e[vg]!==void 0&&(n=e[vg]),!(e.age+t*1.2>=n))return;const o=this.subSystem.main.maxParticles-this.subSystem.currentParticles;e.emissionState.waitEmiting=o}const i=new fe;i.set(1,0,0,e.position.x,0,1,0,e.position.y,0,0,1,e.position.z,0,0,0,1),this.particleSystem.worldSpace||i.multiplyMatrices(this._emitterMatrix,i),this.subParticleSystem.emit(t,e.emissionState,i)}}var Sde=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class X_ extends er{constructor(){super(...arguments);u(this,"granularity",new Ze(10))}get typeName(){return"PixelationEffect"}onCreateEffect(){const t=new _H;return this.granularity.onValueChanged=i=>{t.granularity=i},t}}Sde([x(Ze)],X_.prototype,"granularity",void 0);il("PixelationEffect",X_);class av extends Te{constructor(){super(...arguments);u(this,"_didAssignPlayerColor",!1);u(this,"tryAssignColor",()=>{const t=ne.getComponentInParent(this.gameObject,Xs);if(t&&t.owner)return this._didAssignPlayerColor=!0,this.assignUserColor(t.owner),!0;const i=ne.getComponentInParent(this.gameObject,Ps);return i!=null&&i.connectionId?(this._didAssignPlayerColor=!0,this.assignUserColor(i.connectionId),!0):!1})}onEnable(){this.context.connection.beginListen(Ut.JoinedRoom,this.tryAssignColor),this._didAssignPlayerColor||this.startCoroutine(this.waitForConnection())}onDisable(){this.context.connection.stopListen(Ut.JoinedRoom,this.tryAssignColor)}*waitForConnection(){for(;!this.destroyed&&this.activeAndEnabled&&(yield Q5(.2),!this.tryAssignColor()););}assignUserColor(t){const i=av.hashCode(t),n=av.colorFromHashCode(i);if(this.gameObject.type==="Mesh"){const r=this.gameObject;this.assignColor(n,t,r)}else if(this.gameObject.children)for(const r of this.gameObject.children){const o=r;o.material&&o.material.color&&this.assignColor(n,t,o)}}assignColor(t,i,n){let r=n.material;r&&(r._playerMaterial!==i&&(r=r.clone(),r._playerMaterial=i,n.material=r),r.color=t)}static hashCode(t){var i=0,n,r;if(t.length===0)return i;for(n=0;n<t.length;n++)r=t.charCodeAt(n),i=(i<<5)-i+r,i|=0;return i}static colorFromHashCode(t){const i=(t&16711680)>>16,n=(t&65280)>>8,r=t&255;return new me(i/255,n/255,r/255)}}class Y_{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Cde=new Nl(-1,1,1,-1,0,1);class Ede extends pt{constructor(){super(),this.setAttribute("position",new nt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new nt([0,2,0,0,2,0],2))}}const Tde=new Ede;class _8{constructor(e){this._mesh=new le(Tde,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Cde)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}const K_=new pt;K_.setAttribute("position",new ot(new Float32Array([-1,-1,3,-1,-1,3]),2));K_.setAttribute("uv",new ot(new Float32Array([0,0,2,0,0,2]),2));K_.boundingSphere=new _n;K_.computeBoundingSphere=function(){};const Mde=new Nl;class Mf{constructor(e){this._mesh=new le(K_,e),this._mesh.frustumCulled=!1}render(e){e.render(this._mesh,Mde)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const Ide={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new fe},viewMat:{value:new fe},projViewMat:{value:new fe},projectionMatrixInv:{value:new fe},viewMatrixInv:{value:new fe},cameraPos:{value:new w},resolution:{value:new Z},biasAdjustment:{value:new Z},time:{value:0},samples:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1},frame:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform highp sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform vec2 biasAdjustment;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform float frame;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      /*return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);*/
       #ifdef ORTHO

       return linearize_depth_ortho(d, nearZ, farZ);

        #else
        return linearize_depth(linDepth, nearZ, farZ);
        #endif
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        #ifndef ORTHO
          return getWorldPosLog(vec3(coord, depth));
        #endif
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

mat3 makeRotationZ(float theta) {
	float c = cos(theta);
	float s = sin(theta);
	return mat3(c, - s, 0,
			s,  c, 0,
			0,  0, 1);
  }

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec2 harmoniousNumbers = vec2(
        1.618033988749895,
        1.324717957244746
      );
      noise.rg += harmoniousNumbers * frame;
      noise.rg = fract(noise.rg);
        vec3 helperVec = vec3(0.0, 1.0, 0.0);
        if (dot(helperVec, normal) > 0.99) {
          helperVec = vec3(1.0, 0.0, 0.0);
        }
        vec3 tangent = normalize(cross(helperVec, normal));
        vec3 bitangent = cross(normal, tangent);
        mediump mat3 tbn = mat3(tangent, bitangent, normal) *  makeRotationZ( noise.r * 3.1415962 * 2.0) ;

      mediump float occluded = 0.0;
      mediump float totalWeight = 0.0;
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : radiusToUse * distanceFalloff * 0.2;
      float bias = (min(
        0.1,
        distanceFalloffToUse * 0.1
      ) / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      bias = biasAdjustment.x + biasAdjustment.y * bias;
      mediump float offsetMove = noise.g;
      mediump float offsetMoveInv = 1.0 / FSAMPLES;
      float farTimesNear = far * near;
      float farMinusNear = far - near;
      
      for(int i = 0; i < SAMPLES; i++) {
        mediump vec3 sampleDirection = tbn * samples[i];

        float moveAmt = fract(offsetMove);
        offsetMove += offsetMoveInv;
        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        
        if (all(greaterThan(offset.xyz * (1.0 - offset.xyz), vec3(0.0)))) {
          float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;

          /*#ifdef LOGDEPTH
          float distSample = linearize_depth_log(sampleDepth, near, far);
      #else
          #ifdef ORTHO
              float distSample = near + farMinusNear * sampleDepth;
          #else
              float distSample = (farTimesNear) / (far - sampleDepth * farMinusNear);
          #endif
      #endif*/
      #ifdef ORTHO
          float distSample = near + sampleDepth * farMinusNear;
      #else
          #ifdef LOGDEPTH
              float distSample = linearize_depth_log(sampleDepth, near, far);
          #else
              float distSample = (farTimesNear) / (far - sampleDepth * farMinusNear);
          #endif
      #endif
      
      #ifdef ORTHO
          float distWorld = near + offset.z * farMinusNear;
      #else
          float distWorld = (farTimesNear) / (far - offset.z * farMinusNear);
      #endif
          
          mediump float rangeCheck = smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
          vec2 diff = gl_FragCoord.xy - floor(offset.xy * resolution);
          occluded += rangeCheck * float(distSample != distWorld) * float(sampleDepth != depth) * step(distSample + bias, distWorld) * step(
            1.0,
            dot(diff, diff)
          );
          
          totalWeight ++;
        }
      }
      float occ = clamp(1.0 - occluded / (totalWeight == 0.0 ? 1.0 : totalWeight), 0.0, 1.0);
      gl_FragColor = vec4(occ, 0.5 + 0.5 * normal);
}`},Rde={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},transparencyDWFalse:{value:null},transparencyDWTrue:{value:null},transparencyDWTrueDepth:{value:null},transparencyAware:{value:!1},projMat:{value:new fe},viewMat:{value:new fe},projectionMatrixInv:{value:new fe},viewMatrixInv:{value:new fe},cameraPos:{value:new w},resolution:{value:new Z},color:{value:new w(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1},fog:{value:!1},fogExp:{value:!1},fogDensity:{value:0},fogNear:{value:1/0},fogFar:{value:1/0},colorMultiply:{value:!0},aoTones:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform highp sampler2D downsampledDepth;
    uniform highp sampler2D transparencyDWFalse;
    uniform highp sampler2D transparencyDWTrue;
    uniform highp sampler2D transparencyDWTrueDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform float aoTones;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform bool fog;
    uniform bool fogExp;
    uniform bool colorMultiply;
    uniform bool transparencyAware;
    uniform float fogDensity;
    uniform float fogNear;
    uniform float fogFar;
    uniform float radius;
    uniform float distanceFalloff;
    uniform vec3 cameraPos;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          #ifndef ORTHO
            return getWorldPosLog(vec3(coord, depth));
          #endif
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        #ifdef HALFRES 
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.gba * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

        #ifdef LOGDEPTH
        texel.r = clamp(texel.r, 0.0, 1.0);
        if (texel.r == 0.0) {
          texel.r = 1.0;
        }
        #endif
     
        float finalAo = pow(texel.r, intensity);
        if (aoTones > 0.0) {
            finalAo = ceil(finalAo * aoTones) / aoTones;
        }
        float fogFactor;
        float fogDepth = distance(
            cameraPos,
            getWorldPos(depth, vUv)
        );
        if (fog) {
            if (fogExp) {
                fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
            } else {
                fogFactor = smoothstep( fogNear, fogFar, fogDepth );
            }
        }
        if (transparencyAware) {
            float transparencyDWOff = texture2D(transparencyDWFalse, vUv).a;
            float transparencyDWOn = texture2D(transparencyDWTrue, vUv).a;
            float adjustmentFactorOff = transparencyDWOff;
            float adjustmentFactorOn = (1.0 - transparencyDWOn) * (
                texture2D(transparencyDWTrueDepth, vUv).r == texture2D(sceneDepth, vUv).r ? 1.0 : 0.0
            );
            float adjustmentFactor = max(adjustmentFactorOff, adjustmentFactorOn);
            finalAo = mix(finalAo, 1.0, adjustmentFactor);
        }
        finalAo = mix(finalAo, 1.0, fogFactor);
        vec3 aoApplied = color * mix(vec3(1.0), sceneTexel.rgb, float(colorMultiply));
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = sRGBTransferOETF(gl_FragColor);
        }
    }
    `},Pde={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new fe},viewMat:{value:new fe},projectionMatrixInv:{value:new fe},viewMatrixInv:{value:new fe},cameraPos:{value:new w},resolution:{value:new Z},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
      #ifndef ORTHO
          return getWorldPosLog(vec3(coord, depth));
      #endif
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.r;
        float baseOcc = data.r;
        vec3 normal = data.gba * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        if (d == 1.0) {
          gl_FragColor = data;
          return;
        }
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
        radiusToUse * distanceFalloff
    : radiusToUse * distanceFalloff * 0.2;

        float invDistance = (1.0 / distanceFalloffToUse);
        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.r;
            vec3 normalSample = dataSample.gba * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
            float rangeCheck = float(dSample != 1.0) * exp(-1.0 * tangentPlaneDist * invDistance ) * max(dot(normal, normalSample), 0.0);
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        if (count > 0.0) {
          occlusion /= count;
        }
        #ifdef LOGDEPTH
          occlusion = clamp(occlusion, 0.0, 1.0);
          if (occlusion == 0.0) {
            occlusion = 1.0;
          }
        #endif
        gl_FragColor = vec4(occlusion, 0.5 + 0.5 * normal);
    }
    `},Bde={uniforms:{sceneDepth:{value:null},resolution:{value:new Z},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new fe},projectionMatrixInv:{value:new fe},logDepth:{value:!1},ortho:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform highp sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform bool ortho;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth && !ortho) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        highp vec2[4] uvSamples;
        uvSamples[0] = uv;
        uvSamples[1] = uv + vec2(pixelSize.x, 0.0);
        uvSamples[2] = uv + vec2(0.0, pixelSize.y);
        uvSamples[3] = uv + pixelSize;
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[4] samples;
        samples[0] = depth00;
        samples[1] = depth10;
        samples[2] = depth01;
        samples[3] = depth11;
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
    }`};var b8="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";const Dde=(()=>parseInt(Wc.replace(/\D+/g,"")))(),Ode=Dde>=162?class extends Yt{constructor(s=1,e=1,t=1,i={}){super(s,e,{...i,count:t}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}:class extends Yt{constructor(s=1,e=1,t=1,i={}){super(s,e,i),this.isWebGLMultipleRenderTargets=!0;const n=this.texture;this.texture=[];for(let r=0;r<t;r++)this.texture[r]=n.clone(),this.texture[r].isRenderTargetTexture=!0}setSize(s,e,t=1){if(this.width!==s||this.height!==e||this.depth!==t){this.width=s,this.height=e,this.depth=t;for(let i=0,n=this.texture.length;i<n;i++)this.texture[i].image.width=s,this.texture[i].image.height=e,this.texture[i].image.depth=t;this.dispose()}this.viewport.set(0,0,s,e),this.scissor.set(0,0,s,e)}copy(s){this.dispose(),this.width=s.width,this.height=s.height,this.depth=s.depth,this.scissor.copy(s.scissor),this.scissorTest=s.scissorTest,this.viewport.copy(s.viewport),this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,s.depthTexture!==null&&(this.depthTexture=s.depthTexture.clone()),this.texture.length=0;for(let e=0,t=s.texture.length;e<t;e++)this.texture[e]=s.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}},Lde=Uint8Array.from(atob(b8),s=>s.charCodeAt(0));function x8(s,e,t){if(e.getQueryParameter(s,e.QUERY_RESULT_AVAILABLE)){const r=e.getQueryParameter(s,e.QUERY_RESULT)/1e6;t.lastTime=t.lastTime===0?r:t.timeRollingAverage*t.lastTime+(1-t.timeRollingAverage)*r}else setTimeout(()=>{x8(s,e,t)},1)}class w8 extends $s{constructor(e,t,i=512,n=512){super(),this.width=i,this.height=n,this.clear=!0,this.camera=t,this.scene=e,this.autosetGamma=!0,this.configuration=new Proxy({aoSamples:16,aoRadius:5,aoTones:0,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,biasOffset:0,biasMultiplier:0,color:new me(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0,colorMultiply:!0,transparencyAware:!1,accumulate:!1},{set:(r,o,a)=>{const l=r[o];return r[o]=a,a.equals?a.equals(l)||this.firstFrame():l!==a&&this.firstFrame(),o==="aoSamples"&&l!==a&&this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),o==="denoiseSamples"&&l!==a&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),o==="halfRes"&&l!==a&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.setSize(this.width,this.height)),o==="depthAwareUpsampling"&&l!==a&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),o==="gammaCorrection"&&(this.autosetGamma=!1),o==="transparencyAware"&&l!==a&&(this.autoDetectTransparency=!1,this.configureTransparencyTarget()),!0}}),this.samples=[],this.samplesDenoise=[],this.autoDetectTransparency=!0,this.frames=0,this.lastViewMatrix=new fe,this.lastProjectionMatrix=new fe,this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.detectTransparency(),this.configureTransparencyTarget(),this.copyQuad=new Mf(new Rt({uniforms:{tDiffuse:{value:null}},depthWrite:!1,vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }
            `,fragmentShader:`
            uniform sampler2D tDiffuse;
            varying vec2 vUv;
            void main() {
                gl_FragColor = texture2D(tDiffuse, vUv);
            }
            `})),this.writeTargetInternal=new Yt(this.width,this.height,{minFilter:Nt,magFilter:Nt,depthBuffer:!1,format:Ti}),this.readTargetInternal=new Yt(this.width,this.height,{minFilter:Nt,magFilter:Nt,depthBuffer:!1,format:Ti}),this.outputTargetInternal=new Yt(this.width,this.height,{minFilter:Nt,magFilter:Nt,depthBuffer:!1}),this.accumulationRenderTarget=new Yt(this.width,this.height,{minFilter:Nt,magFilter:Nt,depthBuffer:!1,format:Ti,type:$i,stencilBuffer:!1,depthBuffer:!1,alpha:!0}),this.accumulationQuad=new Mf(new Rt({uniforms:{frame:{value:0},tDiffuse:{value:null}},transparent:!0,opacity:1,vertexShader:`
             varying vec2 vUv;
             void main() {
                 vUv = uv;
                 gl_Position = vec4(position, 1);
             }`,fragmentShader:`
             uniform sampler2D tDiffuse;
             uniform float frame;
                varying vec2 vUv;
                void main() {
                    vec4 color = texture2D(tDiffuse, vUv);
                    gl_FragColor = vec4(color.rgb, 1.0 / (frame + 1.0));
                }
                `})),this.bluenoise=new Go(Lde,128,128),this.bluenoise.colorSpace=jr,this.bluenoise.wrapS=wo,this.bluenoise.wrapT=wo,this.bluenoise.minFilter=ei,this.bluenoise.magFilter=ei,this.bluenoise.needsUpdate=!0,this.lastTime=0,this.timeRollingAverage=.99,this.needsDepthTexture=!0,this.needsSwap=!0,this._r=new Z,this._c=new me}configureHalfResTargets(){this.firstFrame(),this.configuration.halfRes?(this.depthDownsampleTarget=new Ode(this.width/2,this.height/2,2),this.depthDownsampleTarget.textures[0].format=Tl,this.depthDownsampleTarget.textures[0].type=vn,this.depthDownsampleTarget.textures[0].minFilter=ei,this.depthDownsampleTarget.textures[0].magFilter=ei,this.depthDownsampleTarget.textures[0].depthBuffer=!1,this.depthDownsampleTarget.textures[1].format=Ti,this.depthDownsampleTarget.textures[1].type=$i,this.depthDownsampleTarget.textures[1].minFilter=ei,this.depthDownsampleTarget.textures[1].magFilter=ei,this.depthDownsampleTarget.textures[1].depthBuffer=!1,this.depthDownsampleQuad=new Mf(new Rt(Bde))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}detectTransparency(){if(this.autoDetectTransparency){let e=!1;this.scene.traverse(t=>{t.material&&t.material.transparent&&(e=!0)}),e&&(this.configuration.transparencyAware=!0)}}configureTransparencyTarget(){this.configuration.transparencyAware?(this.transparencyRenderTargetDWFalse=new Yt(this.width,this.height,{minFilter:Nt,magFilter:ei,type:$i,format:Ti}),this.transparencyRenderTargetDWTrue=new Yt(this.width,this.height,{minFilter:Nt,magFilter:ei,type:$i,format:Ti}),this.transparencyRenderTargetDWTrue.depthTexture=new mv(this.width,this.height,El),this.depthCopyPass=new Mf(new Rt({uniforms:{depthTexture:{value:this.depthTexture}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }`,fragmentShader:`
            uniform sampler2D depthTexture;
            varying vec2 vUv;
            void main() {
               gl_FragDepth = texture2D(depthTexture, vUv).r + 0.00001;
               gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
            }
            `}))):(this.transparencyRenderTargetDWFalse&&(this.transparencyRenderTargetDWFalse.dispose(),this.transparencyRenderTargetDWFalse=null),this.transparencyRenderTargetDWTrue&&(this.transparencyRenderTargetDWTrue.dispose(),this.transparencyRenderTargetDWTrue=null),this.depthCopyPass&&(this.depthCopyPass.dispose(),this.depthCopyPass=null))}renderTransparency(e){const t=this.scene.background,i=e.getClearColor(new me),n=e.getClearAlpha(),r=new Map,o=e.autoClearDepth;this.scene.traverse(a=>{r.set(a,a.visible)}),this.scene.background=null,e.autoClearDepth=!1,e.setClearColor(new me(0,0,0),0),this.depthCopyPass.material.uniforms.depthTexture.value=this.depthTexture,e.setRenderTarget(this.transparencyRenderTargetDWFalse),this.scene.traverse(a=>{a.material&&(a.visible=r.get(a)&&(a.material.transparent&&!a.material.depthWrite&&!a.userData.treatAsOpaque||!!a.userData.cannotReceiveAO))}),e.clear(!0,!0,!0),this.depthCopyPass.render(e),e.render(this.scene,this.camera),e.setRenderTarget(this.transparencyRenderTargetDWTrue),this.scene.traverse(a=>{a.material&&(a.visible=r.get(a)&&a.material.transparent&&a.material.depthWrite&&!a.userData.treatAsOpaque)}),e.clear(!0,!0,!0),this.depthCopyPass.render(e),e.render(this.scene,this.camera),this.scene.traverse(a=>{a.visible=r.get(a)}),e.setClearColor(i,n),this.scene.background=t,e.autoClearDepth=o}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera)}configureAOPass(e=!1,t=!1){this.firstFrame(),this.samples=this.generateHemisphereSamples(this.configuration.aoSamples);const i={...Ide};i.fragmentShader=i.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),e&&(i.fragmentShader=`#define LOGDEPTH
`+i.fragmentShader),t&&(i.fragmentShader=`#define ORTHO
`+i.fragmentShader),this.configuration.halfRes&&(i.fragmentShader=`#define HALFRES
`+i.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new Rt(i)):this.effectShaderQuad=new Mf(new Rt(i))}configureDenoisePass(e=!1,t=!1){this.firstFrame(),this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const i={...Pde};i.fragmentShader=i.fragmentShader.replace("16",this.configuration.denoiseSamples),e&&(i.fragmentShader=`#define LOGDEPTH
`+i.fragmentShader),t&&(i.fragmentShader=`#define ORTHO
`+i.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new Rt(i)):this.poissonBlurQuad=new Mf(new Rt(i))}configureEffectCompositer(e=!1,t=!1){this.firstFrame();const i={...Rde};e&&(i.fragmentShader=`#define LOGDEPTH
`+i.fragmentShader),t&&(i.fragmentShader=`#define ORTHO
`+i.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(i.fragmentShader=`#define HALFRES
`+i.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new Rt(i)):this.effectCompositerQuad=new Mf(new Rt(i))}generateHemisphereSamples(e){const t=[];for(let i=0;i<e;i++){const n=2.399963*i,r=Math.sqrt(i+.5)/Math.sqrt(e),o=r*Math.cos(n),a=r*Math.sin(n),l=Math.sqrt(1-(o*o+a*a));t.push(new w(o,a,l))}return t}generateDenoiseSamples(e,t){const i=2*Math.PI*t/e,n=1/e,r=n,o=[];let a=n,l=0;for(let c=0;c<e;c++)o.push(new Z(Math.cos(l),Math.sin(l)).multiplyScalar(Math.pow(a,.75))),a+=r,l+=i;return o}setSize(e,t){this.firstFrame(),this.width=e,this.height=t;const i=this.configuration.halfRes?.5:1;this.writeTargetInternal.setSize(e*i,t*i),this.readTargetInternal.setSize(e*i,t*i),this.accumulationRenderTarget.setSize(e*i,t*i),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(e*i,t*i),this.configuration.transparencyAware&&(this.transparencyRenderTargetDWFalse.setSize(e,t),this.transparencyRenderTargetDWTrue.setSize(e,t)),this.outputTargetInternal.setSize(e,t)}setDepthTexture(e){this.depthTexture=e}firstFrame(){this.needsFrame=!0}render(e,t,i){const n=e.xr.enabled;e.xr.enabled=!1,e.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=e.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera)),this.detectTransparency(),(t.texture.type!==this.outputTargetInternal.texture.type||t.texture.format!==this.outputTargetInternal.texture.format)&&(this.outputTargetInternal.texture.type=t.texture.type,this.outputTargetInternal.texture.format=t.texture.format,this.outputTargetInternal.texture.needsUpdate=!0),this.camera.updateMatrixWorld(),this.lastViewMatrix.equals(this.camera.matrixWorldInverse)&&this.lastProjectionMatrix.equals(this.camera.projectionMatrix)&&this.configuration.accumulate&&!this.needsFrame?this.frame++:(this.configuration.accumulate&&(e.setRenderTarget(this.accumulationRenderTarget),e.clear(!0,!0,!0)),this.frame=0,this.needsFrame=!1),this.lastViewMatrix.copy(this.camera.matrixWorldInverse),this.lastProjectionMatrix.copy(this.camera.projectionMatrix);let r,o,a;this.debugMode&&(r=e.getContext(),o=r.getExtension("EXT_disjoint_timer_query_webgl2"),o===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),this.debugMode&&(a=r.createQuery(),r.beginQuery(o.TIME_ELAPSED_EXT,a)),this.configuration.transparencyAware&&this.renderTransparency(e),this._r.set(this.width,this.height);let l=this.configuration.aoRadius;if(this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(l*=.5),this.frame<1024/this.configuration.aoSamples){this.configuration.halfRes&&(e.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.depthDownsampleQuad.render(e)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=t.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new w),this.effectShaderQuad.material.uniforms.biasAdjustment.value=new Z(this.configuration.biasOffset,this.configuration.biasMultiplier),this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=l,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectShaderQuad.material.uniforms.frame.value=this.frame,e.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(e);for(let h=0;h<this.configuration.denoiseIterations;h++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new w),this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=l,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=h,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(e);e.setRenderTarget(this.accumulationRenderTarget);const c=e.autoClear;e.autoClear=!1,this.accumulationQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.accumulationQuad.material.uniforms.frame.value=this.frame,this.accumulationQuad.render(e),e.autoClear=c}this.configuration.transparencyAware&&(this.effectCompositerQuad.material.uniforms.transparencyDWFalse.value=this.transparencyRenderTargetDWFalse.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrue.value=this.transparencyRenderTargetDWTrue.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrueDepth.value=this.transparencyRenderTargetDWTrue.depthTexture,this.effectCompositerQuad.material.uniforms.transparencyAware.value=!0),this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=t.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.effectCompositerQuad.material.uniforms.aoTones.value=this.configuration.aoTones,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=l,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.autosetGamma?this.renderToScreen:this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.accumulationRenderTarget.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),this.effectCompositerQuad.material.uniforms.colorMultiply.value=this.configuration.colorMultiply,this.effectCompositerQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new w),this.effectCompositerQuad.material.uniforms.fog.value=!!this.scene.fog,this.scene.fog&&(this.scene.fog.isFog?(this.effectCompositerQuad.material.uniforms.fogExp.value=!1,this.effectCompositerQuad.material.uniforms.fogNear.value=this.scene.fog.near,this.effectCompositerQuad.material.uniforms.fogFar.value=this.scene.fog.far):this.scene.fog.isFogExp2?(this.effectCompositerQuad.material.uniforms.fogExp.value=!0,this.effectCompositerQuad.material.uniforms.fogDensity.value=this.scene.fog.density):console.error(`Unsupported fog type ${this.scene.fog.constructor.name} in SSAOPass.`)),e.setRenderTarget(this.outputTargetInternal),this.effectCompositerQuad.render(e),e.setRenderTarget(this.renderToScreen?null:i),this.copyQuad.material.uniforms.tDiffuse.value=this.outputTargetInternal.texture,this.copyQuad.render(e),this.debugMode&&(r.endQuery(o.TIME_ELAPSED_EXT),x8(a,r,this)),e.xr.enabled=n}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(e){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(e)}setQualityMode(e){e==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):e==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):e==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}Uint8Array.from(atob(b8),s=>s.charCodeAt(0));var S8=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class J_ extends er{constructor(){super(...arguments);u(this,"_effect")}get typeName(){return"Sharpening"}onCreateEffect(){return this.effect}get effect(){return this._effect??(this._effect=new C8),this._effect}set amount(t){this.effect.uniforms.get("amount").value=t}get amount(){return this.effect.uniforms.get("amount").value}set radius(t){this.effect.uniforms.get("radius").value=t}get radius(){return this.effect.uniforms.get("radius").value}}S8([x()],J_.prototype,"amount",null);S8([x()],J_.prototype,"radius",null);const kde=`
  void mainSupport() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,Fde=`
uniform sampler2D tDiffuse;
uniform float amount;
uniform float radius;

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
    float tx = 1.0 / resolution.x;
    float ty = 1.0 / resolution.y;
    vec2 texelSize = vec2(tx, ty);

    vec4 blurred = vec4(0.0);
    float total = 0.0;

    for (float x = -radius; x <= radius; x++) {
        for (float y = -radius; y <= radius; y++) {
            vec2 offset = vec2(x, y) * texelSize;
            vec4 diffuse = texture2D(tDiffuse, uv + offset);
            float weight = exp(-length(offset) * amount);
            blurred += diffuse * weight;
            total += weight;
        }
    }

    if (total > 0.0) {
        blurred /= total;
    }

    // Calculate the sharpened color using inputColor
    vec4 sharp = inputColor + clamp(inputColor - blurred, 0.0, 1.0) * amount;
    // Keep original alpha
    sharp.a = inputColor.a;

    // Ensure the sharp color does not go below 0 or above 1
    // This means: sharpening must happen AFTER tonemapping.
    sharp = clamp(sharp, 0.0, 1.0);

    outputColor = sharp;
}

`;class C8 extends Co{constructor(){super("Sharpening",Fde,{vertexShader:kde,blendFunction:$t.NORMAL,uniforms:new Map([["amount",new Se(1)],["radius",new Se(1)]])})}}const If=ie("debugpost"),GM=Symbol("needle:postprocessing-handler"),HM=Symbol("needle:previous-autoclear-state");class i1{constructor(e){u(this,"_composer",null);u(this,"_lastVolumeComponents");u(this,"_effects",[]);u(this,"_isActive",!1);u(this,"context");this.context=e}get isActive(){return this._isActive}get composer(){return this._composer}apply(e){this._isActive=!0,this.onApply(this.context,e)}unapply(){var i;if(If&&console.log("Unapplying postprocessing effects"),this._isActive=!1,this._lastVolumeComponents){for(const n of this._lastVolumeComponents)n.unapply();this._lastVolumeComponents.length=0}const e=this.context;e[GM]===this&&delete e[GM],e.composer===this._composer&&((i=e.composer)==null||i.dispose(),e.composer=null),typeof e.renderer[HM]=="boolean"&&(e.renderer.autoClear=e.renderer[HM])}dispose(){this.unapply();for(const e of this._effects)e.dispose();this._effects.length=0,this._composer=null}onApply(e,t){if(!t)return;e[GM]=this,If&&console.log("Apply Postprocessing Effects",t),this._lastVolumeComponents=[...t],this._effects.length=0;const i={handler:this,components:this._lastVolumeComponents};for(let n=0;n<this._lastVolumeComponents.length;n++){const r=this._lastVolumeComponents[n];if(r.context=e,r.apply){if(r.active){if(!e.mainCameraComponent){console.error("No camera in scene found or available yet - can not create postprocessing effects");return}const o=r.apply(i);if(!o)continue;Array.isArray(o)?this._effects.push(...o):this._effects.push(o)}}else r.active&&Yi("Volume component is not a VolumeComponent: "+r.__type)}if(this.context.renderer.toneMapping!=_o&&!this._effects.find(n=>n instanceof oS)){const n=new oS;this._effects.push(n)}this.applyEffects(e)}applyEffects(e){const t=this._effects;if(t.length<=0)return;const i=e.mainCameraComponent,n=e.renderer,r=e.scene,o=i.threeCamera;n[HM]=n.autoClear;const a=n.capabilities.maxSamples;this._composer||(this._composer=new rD(n,{frameBufferType:$i,stencilBuffer:!0,multisampling:Math.min(St.isMobileDevice()?4:8,a)})),e.composer&&e.composer!==this._composer&&console.warn("There's already an active EffectComposer in your scene: replacing it with a new one. This might cause unexpected behaviour. Make sure to only use one PostprocessingManager/Volume in your scene."),e.composer=this._composer;const l=e.composer;l.setMainCamera(o),l.setRenderer(n),l.setMainScene(r);for(const h of l.passes)h.dispose();l.removeAllPasses();const c=new nE(r,o);c.name="Render To Screen",c.mainScene=r,l.addPass(c);try{this.orderEffects();const h=[];for(const d of t)if(d instanceof Co)h.push(d);else if(d instanceof $s){const f=new Dk(o,...h);f.mainScene=r,f.name=h.map(p=>p.constructor.name).join(", "),f.enabled=!0,h.length=0,l.addPass(d)}if(h.length>0){const d=new Dk(o,...h);d.name=h.map(f=>f.name).join(" "),d.mainScene=r,d.enabled=!0,l.addPass(d)}}catch(h){console.error("Error while applying postprocessing effects",h),l.removeAllPasses()}If&&console.log("PostProcessing Passes",t,"->",l.passes)}orderEffects(){var t;If&&console.log("Before ordering effects",[...this._effects]);const e=this._effects;e.sort((i,n)=>{const r=pP.findIndex(a=>i.constructor.name.endsWith(a.name)),o=pP.findIndex(a=>n.constructor.name.endsWith(a.name));return r<0?(If&&console.warn("Unknown effect found: ",i.constructor.name),-1):o<0?(If&&console.warn("Unknown effect found: ",n.constructor.name),1):r<0?1:o<0?-1:r-o}),If&&console.log("After ordering effects",[...this._effects]);for(let i=0;i<e.length;i++){const n=e[i];if(((t=n==null?void 0:n.configuration)==null?void 0:t.gammaCorrection)!==void 0){const r=i===e.length-1;n.configuration.gammaCorrection=r}}}}const pP=[EH,cD,xH,wH,w8,SH,yH,mH,aD,bH,CH,_H,oS,AH,pH,C8];async function qO(s){const{NeedleEngineHTMLElement:e}=await jc(()=>Promise.resolve().then(()=>Bfe),void 0,import.meta.url);e.observedAttributes.includes(s)||e.observedAttributes.push(s)}var Z_=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Ha=ie("debugskybox");qO("skybox-image");qO("environment-image");function vN(s,e,t,i,n){const r=new $c;r.allowDrop=!1,r.allowNetworking=!1,r.background=t,r.environment=i,ne.addComponent(s.scene,r);const o=a=>{typeof a=="string"&&(Ha&&console.log(n,"CHANGED TO",a),r.setSkybox(a))};return J4(s.domElement,n,o),r.addEventListener("destroy",()=>{Ha&&console.log("Destroyed attribute remote skybox",n),Z4(s.domElement,n,o)}),r.setSkybox(e)}xi.addContextCreatedCallback(s=>{var r;const e=s.context,t=e.domElement.getAttribute("skybox-image")||e.domElement.getAttribute("background-image"),i=e.domElement.getAttribute("environment-image"),n=new Array;if(t){Ha&&console.log("Creating remote skybox to load "+t),((r=e.mainCameraComponent)==null?void 0:r.clearFlags)!==uo.Skybox&&console.warn('"skybox-image"/"background-image" attribute has no effect: camera clearflags are not set to "Skybox"');const o=vN(e,t,!0,!1,"skybox-image");n.push(o)}if(i){Ha&&console.log("Creating remote environment to load "+i);const o=vN(e,i,!1,!0,"environment-image");n.push(o)}return n.length>0?YC(n):Promise.resolve()});function E8(){return globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES||(globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES=new Array),globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES}function yN(s){const t=E8().find(i=>i.src===s);return t?(Ha&&console.log("Skybox: Found previously loaded texture for "+s),t.texture):null}async function Ude(s){const e=await s;CD(e,!0),rn(e)}function Nde(s,e){const t=E8();for(;t.length>5;){const i=t.shift();i&&Ude(i.texture)}e.then(i=>CD(i,!1)),t.push({src:s,texture:e})}class $c extends Te{constructor(){super(...arguments);u(this,"url");u(this,"allowDrop",!0);u(this,"background",!0);u(this,"environment",!0);u(this,"allowNetworking",!0);u(this,"_loader");u(this,"_prevUrl");u(this,"_prevLoadedEnvironment");u(this,"_prevEnvironment",null);u(this,"_prevBackground",null);u(this,"validTextureTypes",[".hdr",".exr",".jpg",".jpeg",".png"]);u(this,"onDragOverEvent",t=>{if(this.allowDrop&&t.dataTransfer)for(const i of t.dataTransfer.types)(i==="text/uri-list"||i==="Files")&&t.preventDefault()});u(this,"onDrop",t=>{var i,n,r,o;if(this.allowDrop&&t.dataTransfer){for(const a of t.dataTransfer.types)if(Ha&&console.log(a),a==="text/uri-list"){const l=t.dataTransfer.getData(a);Ha&&console.log(a,l);let c=(n=(i=new RegExp(/polyhaven.com\/asset_img\/.+?\/(?<name>.+)\.png/).exec(l))==null?void 0:i.groups)==null?void 0:n.name;if(c||(c=(o=(r=new RegExp(/polyhaven\.com\/a\/(?<name>.+)/).exec(l))==null?void 0:r.groups)==null?void 0:o.name),Ha&&console.log(c),c){const h="https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/"+c+"_1k.exr";console.log(`[Remote Skybox] Setting skybox from url: ${h}`),t.preventDefault(),this.setSkybox(h);break}else if(this.isValidTextureType(l)){console.log("[Remote Skybox] Setting skybox from url: "+l),t.preventDefault(),this.setSkybox(l);break}else{console.warn(`[RemoteSkybox] Unknown url ${l}. If you want to load a skybox from a url, make sure it is a valid image url. Url must end with${this.validTextureTypes.join(", ")}.`);const h=new CustomEvent("dropped-unknown-url",{detail:{sender:this,event:t,url:l,apply:d=>{t.preventDefault(),this.setSkybox(d)}}});this.dispatchEvent(h)}}else if(a=="Files"){const l=t.dataTransfer.files.item(0);if(Ha&&console.log(a,l),!l)continue;if(!this.isValidTextureType(l.name)){console.warn(`[RemoteSkybox]: File "${l.name}" is not supported. Supported files are ${this.validTextureTypes.join(", ")}`);return}if(yN(l.name)===null){const c=new Blob([l]),h=URL.createObjectURL(c);t.preventDefault(),this.setSkybox(h,l.name)}else t.preventDefault(),this.setSkybox(l.name);break}}})}onEnable(){this.setSkybox(this.url),this.registerDropEvents()}onDisable(){var t;this.context.scene.environment===this._prevLoadedEnvironment&&(this.context.scene.environment=this._prevEnvironment,Mi.backgroundShouldBeTransparent(this.context)||(this.context.scene.background=this._prevBackground),this._prevLoadedEnvironment=void 0),this.unregisterDropEvents(),(t=this.context.mainCameraComponent)==null||t.applyClearFlags()}urlChangedSyncField(){this.allowNetworking&&this.url&&this.isRemoteTexture(this.url)&&this.setSkybox(this.url)}async setSkybox(t,i){var o;if(!this.activeAndEnabled||(t=zde(t,this.environment,this.background),!t))return!1;if(i??(i=t),this.isValidTextureType(i)||console.warn("Potentially invalid skybox url",i,"on",this.name),Ha&&console.log("Set remote skybox url: "+t),this._prevUrl===t&&this._prevLoadedEnvironment)return this.applySkybox(),!0;(o=this._prevLoadedEnvironment)==null||o.dispose(),this._prevLoadedEnvironment=void 0,this._prevUrl=t;const n=await this.loadTexture(t,i);if(!n||!this.enabled)return!1;this.url=t;const r=t.lastIndexOf("/");return n.name=t.substring(r>=0?r+1:0),this._loader instanceof Xa&&(n.colorSpace=_t),this._prevLoadedEnvironment=n,this.applySkybox(),!0}async loadTexture(t,i){var c,h,d,f,p;if(!t)return Promise.resolve(null);i??(i=t);const n=yN(i);if(n){const m=await n;if(((h=(c=m.source)==null?void 0:c.data)==null?void 0:h.length)>0||(p=(f=(d=m.source)==null?void 0:d.data)==null?void 0:f.data)!=null&&p.length)return m}const r=i.endsWith(".exr"),o=i.endsWith(".hdr");r?this._loader instanceof x0||(this._loader=new x0):o?this._loader instanceof AS||(this._loader=new AS):this._loader instanceof Xa||(this._loader=new Xa),Ha&&console.log("Loading skybox: "+t);const a=this._loader.loadAsync(t);return Nde(i,a),await a}applySkybox(){var i;const t=this._prevLoadedEnvironment;t&&(t.mapping=Vg,t.needsUpdate=!0,this.context.scene.background!==t&&(this._prevBackground=this.context.scene.background),this.context.scene.environment!==t&&(this._prevEnvironment=this.context.scene.environment),Ha&&console.log("Set remote skybox",this.url,!Mi.backgroundShouldBeTransparent(this.context)),this.environment&&(this.context.scene.environment=t),this.background&&!Mi.backgroundShouldBeTransparent(this.context)&&(this.context.scene.background=t),((i=this.context.mainCameraComponent)==null?void 0:i.backgroundBlurriness)!==void 0&&(this.context.scene.backgroundBlurriness=this.context.mainCameraComponent.backgroundBlurriness))}isRemoteTexture(t){return t.startsWith("http://")||t.startsWith("https://")}isValidTextureType(t){for(const i of this.validTextureTypes)if(t.endsWith(i))return!0;return!1}registerDropEvents(){this.unregisterDropEvents(),this.context.domElement.addEventListener("dragover",this.onDragOverEvent),this.context.domElement.addEventListener("drop",this.onDrop)}unregisterDropEvents(){this.context.domElement.removeEventListener("dragover",this.onDragOverEvent),this.context.domElement.removeEventListener("drop",this.onDrop)}}Z_([$D($c.prototype.urlChangedSyncField),x(URL)],$c.prototype,"url",void 0);Z_([x()],$c.prototype,"allowDrop",void 0);Z_([x()],$c.prototype,"background",void 0);Z_([x()],$c.prototype,"environment",void 0);Z_([x()],$c.prototype,"allowNetworking",void 0);function zde(s,e,t){const i=e&&!t;switch(s==null?void 0:s.toLowerCase()){case"studio":return i?"https://cdn.needle.tools/static/skybox/modelviewer-Neutral-small.hdr":"https://cdn.needle.tools/static/skybox/modelviewer-Neutral.hdr";case"blurred-skybox":return i?"https://cdn.needle.tools/static/skybox/blurred-skybox-small.exr":"https://cdn.needle.tools/static/skybox/blurred-skybox.exr";case"quicklook-ar":return i?"https://cdn.needle.tools/static/skybox/QuickLook-ARMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ARMode.exr";case"quicklook":return i?"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode.exr"}return s===void 0?null:s}var Jr=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const ko=ie("debugsceneswitcher"),Gde=ie("sceneswitcher:clearscene"),Pw="scene";qO(Pw);const Yu=Promise.resolve(!1);class zs extends Te{constructor(){super(...arguments);u(this,"autoLoadFirstScene",!0);u(this,"scenes",[]);u(this,"loadingScene");u(this,"queryParameterName","scene");u(this,"useSceneName",!0);u(this,"clamp",!0);u(this,"useHistory",!0);u(this,"useKeyboard",!0);u(this,"useSwipe",!0);u(this,"useSceneLighting",!0);u(this,"useSceneBackground",!0);u(this,"preloadNext",1);u(this,"preloadPrevious",1);u(this,"preloadConcurrent",2);u(this,"createMenuButtons",!1);u(this,"sceneLoaded",new un);u(this,"_currentIndex",-1);u(this,"_currentScene");u(this,"_engineElementOverserver");u(this,"_preloadScheduler");u(this,"_menuButtons");u(this,"onPopState",async t=>{if(!this.useHistory)return;const i=this.useHistory;try{this.useHistory=!1;let n=!1;if(this.queryParameterName&&(n=await this.tryLoadFromQueryParam()),!n){const r=t==null?void 0:t.state;if(r&&r.startsWith(this.guid)){const o=r.substr(this.guid.length+2);ko&&console.log("PopState",o),await this.trySelectSceneFromValue(o)}}}finally{this.useHistory=i}});u(this,"normalizedSwipeThresholdX",.1);u(this,"_didSwipe",!1);u(this,"onInputPointerMove",t=>{if(this.useSwipe&&!this._didSwipe&&t.button===0&&t.pointerType==="touch"&&this.context.input.getPointerPressedCount()===1){const i=this.context.input.getPointerPositionDelta(t.button);if(i){const n=i.x/this.context.domWidth;n>=this.normalizedSwipeThresholdX?(this._didSwipe=!0,this.selectPrev()):n<=-this.normalizedSwipeThresholdX&&(this._didSwipe=!0,this.selectNext())}}});u(this,"onInputPointerUp",t=>{t.button===0&&(this._didSwipe=!1)});u(this,"onInputKeyDown",t=>{if(!this.useKeyboard||!this.scenes)return;const i=t.key.toLowerCase();if(!i)return;const n=parseInt(i)-1;if(n>=0){this.trySelectSceneFromValue(n);return}switch(i){case"arrowright":case"d":this.selectNext();break;case"arrowleft":case"a":this.selectPrev();break}});u(this,"__lastSwitchScene");u(this,"__lastSwitchScenePromise");u(this,"_currentlyLoadingScene");u(this,"_lastLoadingScene");u(this,"_loadingScenePromise");u(this,"_isCurrentlyLoading",!1);u(this,"_currentLoadingProgress")}get currentIndex(){return this._currentIndex}get currentLoadingProgress(){return this._currentLoadingProgress}get currentlyLoadingScene(){return this._currentlyLoadingScene}get currentlyLoadedScene(){return this._currentScene}awake(){this.scenes===void 0&&(this.scenes=[]);for(const t of this.scenes)t&&!t.hasUrl&&t.asset instanceof ge&&t.asset.removeFromParent();ko&&console.log("SceneSwitcher",this)}async onEnable(){if(globalThis.addEventListener("popstate",this.onPopState),this.context.input.addEventListener(Ai.KeyDown,this.onInputKeyDown),this.context.input.addEventListener(Ai.PointerMove,this.onInputPointerMove),this.context.input.addEventListener(Ai.PointerUp,this.onInputPointerUp),this._engineElementOverserver||(this._engineElementOverserver=new MutationObserver(t=>{for(const i of t)if(i.type==="attributes"&&i.attributeName===Pw){const n=this.context.domElement.getAttribute(Pw);n!==null&&this.trySelectSceneFromValue(n)}})),this._engineElementOverserver.observe(this.context.domElement,{attributes:!0}),this._preloadScheduler||(this._preloadScheduler=new Hde(this)),this._preloadScheduler.maxLoadAhead=this.preloadNext,this._preloadScheduler.maxLoadBehind=this.preloadPrevious,this._preloadScheduler.maxConcurrent=this.preloadConcurrent,this._preloadScheduler.begin(),this.autoLoadFirstScene&&this._currentIndex===-1&&!await this.tryLoadFromQueryParam()){const t=this.context.domElement.getAttribute(Pw);try{(t===null||!await this.trySelectSceneFromValue(t))&&this._currentIndex===-1&&this.select(0)}finally{}}this.createMenuButtons&&(this._menuButtons??(this._menuButtons=[]),this._menuButtons.push(this.context.menu.appendChild({label:"Previous",icon:"arrow_back_ios",onClick:()=>this.selectPrev(),priority:-1005,class:"row2"})),this._menuButtons.push(this.context.menu.appendChild({label:"Next",icon:"arrow_forward_ios",iconSide:"right",onClick:()=>this.selectNext(),priority:-1e3,class:"row2"})))}onDisable(){var t;if(globalThis.removeEventListener("popstate",this.onPopState),this.context.input.removeEventListener(Ai.KeyDown,this.onInputKeyDown),this.context.input.removeEventListener(Ai.PointerMove,this.onInputPointerMove),this.context.input.removeEventListener(Ai.PointerUp,this.onInputPointerUp),(t=this._preloadScheduler)==null||t.stop(),this._menuButtons){for(const i of this._menuButtons)i.remove();this._menuButtons=void 0}}addScene(t){if(typeof t=="string"){let i=this.context.addressables.findAssetReference(t);return i||(i=new si(t),this.context.addressables.registerAssetReference(i)),this.scenes.push(i),i}return this.scenes.push(t),t}selectNext(){return this.select(this._currentIndex+1)}selectPrev(){return this.select(this._currentIndex-1)}select(t){var n,r,o;if(ko&&console.log("select",t),typeof t=="object"&&console.warn('Switching to "'+t+'" might not work. Please either use an index or a AssetReference (not a scene reference)'),typeof t=="string"){const a=(n=this.scenes)==null?void 0:n.find(l=>l.url===t);if(!a){const l=si.getOrCreate(this.sourceId??"",t,this.context);return this.switchScene(l)}if(a)t=(r=this.scenes)==null?void 0:r.indexOf(a);else return Yu}if(!((o=this.scenes)!=null&&o.length))return Yu;if(t<0){if(this.clamp)return Yu;t=this.scenes.length-1}else if(t>=this.scenes.length){if(this.clamp)return Yu;t=0}const i=this.scenes[t];return this.switchScene(i)}async switchScene(t){if(!(t instanceof si)){const n=typeof t;return n==="string"?this.select(t):n==="number"?this.select(t):(console.warn("SceneSwitcher: Can't switch to scene",t,"of type",n),!1)}return t.url===this.sourceId?(console.warn("SceneSwitcher: can't load own scene - prevent recursive loading",this.sourceId),!1):this.__lastSwitchScene===t&&this.__lastSwitchScenePromise?this.__lastSwitchScenePromise:(this.__lastSwitchScene=t,this.__lastSwitchScenePromise=this.__internalSwitchScene(t),await this.__lastSwitchScenePromise)}async __internalSwitchScene(t){var n,r,o,a;if(this._currentScene){ko&&console.log("UNLOAD",this._currentScene.url,"HasURL?: "+this._currentScene.hasUrl);const l=this.tryGetSceneEventListener(this._currentScene.asset);if(l!=null&&l.sceneClosing){const c=l.sceneClosing();c instanceof Promise&&await c}this._currentScene.hasUrl?this._currentScene.unload():this._currentScene.asset instanceof ge&&this._currentScene.asset.removeFromParent()}this._currentScene=void 0;const i=this._currentIndex=((n=this.scenes)==null?void 0:n.indexOf(t))??-1;try{this._currentlyLoadingScene=t,this._currentLoadingProgress=new ProgressEvent("progress",{loaded:0,total:1});const l=new CustomEvent("loadscene-start",{detail:{scene:t,switcher:this,index:i}});this.dispatchEvent(l),await this.onStartLoading(),await t.loadAssetAsync((h,d)=>{this._currentLoadingProgress=d,this.dispatchEvent(d)}).catch(console.error),await this.onEndLoading();const c=new CustomEvent("loadscene-finished",{detail:{scene:t,switcher:this,index:i}});if(this.dispatchEvent(c),this._currentLoadingProgress=void 0,this._currentlyLoadingScene=void 0,c.defaultPrevented)return ko&&console.warn("Adding loaded scene prevented:",t,c),!1;if(!t.asset)return ko&&console.warn("Failed loading scene:",t),!1;if(this._currentIndex===i){if(ko&&console.log("ADD",t.url),this._currentScene=t,Gde){const f=((r=this.context.mainCameraComponent)==null?void 0:r.gameObject)||this.context.mainCamera;f==null||f.removeFromParent();const p=this.gameObject.removeFromParent();ba(this.context.scene,!0,!0),this.context.scene=new Ks,this.context.scene.add(p),f&&this.context.scene.add(f)}if(ne.add(t.asset,this.gameObject),this.useSceneLighting&&this.context.sceneLighting.enable(t),this.useSceneBackground){const f=this.context.lightmaps.tryGetSkybox(t.url);f?(f.mapping=bo,this.context.scene.background=f):ko&&console.warn("SceneSwitcher: Can't find skybox for scene "+t.url)}if(this.useHistory&&i>=0){let f=i.toString();if(this.useSceneName&&(f=AN(t.url)),(o=this.queryParameterName)!=null&&o.length)Zw(this.queryParameterName,f,this.useHistory);else{const p=history.state,m=this.guid+"::"+i;p!==m&&history.pushState(m,"unused",location.href)}}const h=this.tryGetSceneEventListener(t.asset);if(h!=null&&h.sceneOpened){const f=h.sceneOpened(this);f instanceof Promise&&await f}const d=new CustomEvent("scene-opened",{detail:{scene:t,switcher:this,index:i}});return this.dispatchEvent(d),(a=this.sceneLoaded)==null||a.invoke(this),!0}}catch(l){console.error(l)}return!1}preload(t){if(t>=0&&t<this.scenes.length){const i=this.scenes[t];if(i instanceof si)return i.preload()}return Yu}tryLoadFromQueryParam(){var i;if(!((i=this.queryParameterName)!=null&&i.length))return Yu;const t=ie(this.queryParameterName);return typeof t=="boolean"?Yu:this.trySelectSceneFromValue(t)}trySelectSceneFromValue(t){if(typeof t=="string"){const i=parseInt(t);if(i>=0&&i<this.scenes.length)return this.select(i);{const n=t.toLowerCase();for(let r=0;r<this.scenes.length;r++){const o=this.scenes[r];if(o&&AN(o.url).toLowerCase().includes(n))return this.select(r)}}}else if(typeof t=="number"&&t>=0&&t<this.scenes.length)return this.select(t);return So()&&console.warn('Can not find scene: "'+t+'"',this),Yu}async onStartLoading(){var t,i;if(this._isCurrentlyLoading=!0,this.loadingScene&&(this._lastLoadingScene!==this.loadingScene&&(this._loadingScenePromise=void 0),this._lastLoadingScene=this.loadingScene,this._loadingScenePromise||(this._loadingScenePromise=(t=this.loadingScene)==null?void 0:t.loadAssetAsync()),await this._loadingScenePromise,this._isCurrentlyLoading&&((i=this.loadingScene)!=null&&i.asset))){ko&&console.log("Add loading scene",this.loadingScene.url,this.loadingScene.asset);const n=this.loadingScene.asset;ne.add(n,this.gameObject);const r=this.tryGetSceneEventListener(n);if(r!=null&&r.sceneOpened){const o=r.sceneOpened(this);o instanceof Promise&&await o}}if(this._isCurrentlyLoading){const n=this.tryGetSceneEventListener(this.gameObject);if(n&&n.sceneOpened){const r=n.sceneOpened(this);r instanceof Promise&&await r}}}async onEndLoading(){var t;if(this._isCurrentlyLoading=!1,(t=this.loadingScene)!=null&&t.asset){ko&&console.log("Remove loading scene",this.loadingScene.url);const i=this.loadingScene.asset,n=this.tryGetSceneEventListener(i);if(typeof(n==null?void 0:n.sceneClosing)=="function"){const r=n.sceneClosing();r instanceof Promise&&await r}ne.remove(i)}if(!this._isCurrentlyLoading){const i=this.tryGetSceneEventListener(this.gameObject);if(i&&i.sceneClosing){const n=i.sceneClosing();n instanceof Promise&&await n}}}tryGetSceneEventListener(t,i=0){const n=ne.foreachComponent(t,r=>{const o=r;if(o.sceneClosing||o.sceneOpened)return o});if(i===0&&!n&&t.children.length)for(const r of t.children){const o=this.tryGetSceneEventListener(r,i+1);if(o)return o}return n||null}}Jr([x()],zs.prototype,"autoLoadFirstScene",void 0);Jr([x(si)],zs.prototype,"scenes",void 0);Jr([x(si)],zs.prototype,"loadingScene",void 0);Jr([x()],zs.prototype,"queryParameterName",void 0);Jr([x()],zs.prototype,"useSceneName",void 0);Jr([x()],zs.prototype,"clamp",void 0);Jr([x()],zs.prototype,"useHistory",void 0);Jr([x()],zs.prototype,"useKeyboard",void 0);Jr([x()],zs.prototype,"useSwipe",void 0);Jr([x()],zs.prototype,"useSceneLighting",void 0);Jr([x()],zs.prototype,"useSceneBackground",void 0);Jr([x()],zs.prototype,"preloadNext",void 0);Jr([x()],zs.prototype,"preloadPrevious",void 0);Jr([x()],zs.prototype,"preloadConcurrent",void 0);Jr([x()],zs.prototype,"createMenuButtons",void 0);Jr([x(un)],zs.prototype,"sceneLoaded",void 0);function AN(s){const e=s.split("/").pop(),t=e==null?void 0:e.split(".").shift();return t!=null&&t.length?t:s}class Hde{constructor(e,t=1,i=1,n=2){u(this,"maxLoadAhead");u(this,"maxLoadBehind");u(this,"maxConcurrent");u(this,"_isRunning",!1);u(this,"_switcher");u(this,"_loadTasks",[]);u(this,"_maxConcurrentLoads",1);this._switcher=e,this.maxLoadAhead=t,this.maxLoadBehind=i,this.maxConcurrent=n}begin(){if(this._isRunning)return;ko&&console.log("Preload begin"),this._isRunning=!0;let e=-1,t,i;const n=this._switcher.scenes,r=setInterval(()=>{if(this.allLoaded()&&(ko&&console.log("All scenes loaded"),this.stop()),!this._isRunning){clearInterval(r);return}if(this.canLoadNewScene()===!1)return;e!==this._switcher.currentIndex&&(e=this._switcher.currentIndex,i=0,t=0);const o=i%2===0;o&&(t+=1),i+=1;const a=o?this.maxLoadAhead:this.maxLoadBehind;if(t>a)return;const l=o?e+t:e-t;if(l<0||l<0||l>=n.length)return;const c=n[l];new Vde(l,c,this._loadTasks)},200)}stop(){this._isRunning=!1}canLoadNewScene(){return this._loadTasks.length<this._maxConcurrentLoads}allLoaded(){if(this._switcher.scenes){for(const e of this._switcher.scenes)if((e==null?void 0:e.isLoaded())===!1)return!1}return!0}}class Vde{constructor(e,t,i){u(this,"index");u(this,"asset");u(this,"tasks");this.index=e,this.asset=t,this.tasks=i,i.push(this),this.awaitLoading()}async awaitLoading(){this.asset&&!this.asset.isLoaded()&&(ko&&console.log("Preload start: "+this.asset.url,this.index),await this.asset.preload(),ko&&console.log("Preload finished: "+this.asset.url,this.index));const e=this.tasks.indexOf(this);e>=0&&this.tasks.splice(e,1)}}function Qde(){return new Promise((s,e)=>{const i=()=>{i!=null&&(document.removeEventListener("pointerdown",i),document.removeEventListener("click",i),document.removeEventListener("dragstart",i),document.removeEventListener("touchstart",i),s())};document.addEventListener("pointerdown",i),document.addEventListener("click",i),document.addEventListener("dragstart",i),document.addEventListener("touchstart",i)})}async function jde(s){await Qde(),s()}var Ma=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Vs=ie("debugvideo");var ad;(function(s){s[s.None=0]="None",s[s.AdjustHeight=1]="AdjustHeight",s[s.AdjustWidth=2]="AdjustWidth"})(ad||(ad={}));var Bh;(function(s){s[s.VideoClip=0]="VideoClip",s[s.Url=1]="Url"})(Bh||(Bh={}));var PA;(function(s){s[s.None=0]="None",s[s.AudioSource=1]="AudioSource",s[s.Direct=2]="Direct",s[s.APIOnly=3]="APIOnly"})(PA||(PA={}));var BA;(function(s){s[s.CameraFarPlane=0]="CameraFarPlane",s[s.CameraNearPlane=1]="CameraNearPlane",s[s.RenderTexture=2]="RenderTexture",s[s.MaterialOverride=3]="MaterialOverride"})(BA||(BA={}));class Ns extends Te{constructor(){super();u(this,"playOnAwake",!0);u(this,"aspectMode",ad.None);u(this,"clip",null);u(this,"source",Bh.Url);u(this,"_url",null);u(this,"renderMode");u(this,"targetMaterialProperty");u(this,"targetMaterialRenderer");u(this,"targetTexture");u(this,"time",0);u(this,"_playbackSpeed",1);u(this,"_isLooping",!1);u(this,"_muted",!1);u(this,"_audioOutputMode",PA.Direct);u(this,"playInBackground",!0);u(this,"_crossOrigin","anonymous");u(this,"_videoElement",null);u(this,"_videoTexture",null);u(this,"_videoMaterial",null);u(this,"_isPlaying",!1);u(this,"wasPlaying",!1);u(this,"visibilityChanged",t=>{switch(document.visibilityState){case"hidden":this.playInBackground||(this.wasPlaying=this._isPlaying,this.pause());break;case"visible":this.wasPlaying&&!this._isPlaying&&this.play();break}});u(this,"_receivedInput",!1);u(this,"_overlay",null);u(this,"_targetObjects");u(this,"_updateAspectRoutineId",-1);u(this,"_hls");u(this,"onHlsAvailable",()=>{var t;Vs&&console.log("HLS: available",this.clip),!(!this.shouldUseM3U||!this.url)&&(this._hls||(this._hls=new Hls),this.videoElement.autoplay=!0,this._hls.loadSource(this.url),this._hls.attachMedia(this.videoElement),(t=this._videoElement)==null||t.play(),Vs&&console.log("HLS: loaded",this.clip))});jde(()=>{this._receivedInput=!0,this.updateVideoElementSettings()}),this._targetObjects=[],ie("videoscreenspace")&&window.addEventListener("keydown",t=>{t.key==="f"&&(this.screenspace=!this.screenspace)})}get url(){return this._url}set url(t){const n=this._url!==t;this.__didAwake?n&&this.setClipURL(t??""):this._url=t}get playbackSpeed(){var t;return((t=this._videoElement)==null?void 0:t.playbackRate)??this._playbackSpeed}set playbackSpeed(t){this._playbackSpeed=t,this._videoElement&&(this._videoElement.playbackRate=t)}get isLooping(){var t;return((t=this._videoElement)==null?void 0:t.loop)??this._isLooping}set isLooping(t){this._isLooping=t,this._videoElement&&(this._videoElement.loop=t)}get currentTime(){var t;return((t=this._videoElement)==null?void 0:t.currentTime)??this.time}set currentTime(t){this._videoElement?this._videoElement.currentTime=t:this.time=t}get isPlaying(){const t=this._videoElement;if(t){if(t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>t.HAVE_CURRENT_DATA)return!0;if(t.srcObject&&t.srcObject.active)return!0}return!1}get crossOrigin(){var t;return((t=this._videoElement)==null?void 0:t.crossOrigin)??this._crossOrigin}set crossOrigin(t){this._crossOrigin=t,this._videoElement&&(t!==null?this._videoElement.setAttribute("crossorigin",t):this._videoElement.removeAttribute("crossorigin"))}get videoMaterial(){return!this._videoMaterial&&!this.create(!1)?null:this._videoMaterial}get videoTexture(){return!this._videoTexture&&!this.create(!1)?null:this._videoTexture}get videoElement(){return!this._videoElement&&!this.create(!1)?null:this._videoElement}requestPictureInPicture(){return this._videoElement?this._videoElement.requestPictureInPicture():null}get muted(){var t;return((t=this._videoElement)==null?void 0:t.muted)??this._muted}set muted(t){this._muted=t,this._videoElement&&(this._videoElement.muted=t)}get currentVideo(){return this.clip}set audioOutputMode(t){t!==this._audioOutputMode&&(t===PA.AudioSource&&Xe()&&console.warn("VideoAudioOutputMode.AudioSource is not yet implemented"),this._audioOutputMode=t,this.updateVideoElementSettings())}get audioOutputMode(){return this._audioOutputMode}preloadVideo(){Vs&&console.log("Video Preload: "+this.name,this.clip),this.create(!1)}preload(){this.preloadVideo()}setVideo(t){this.clip=t,this.source=Bh.VideoClip,this._videoElement?(this._videoElement.srcObject=t,this._isPlaying&&this.play(),this.updateAspect()):this.create(this.playOnAwake)}setClipURL(t){this._url!==t&&(this._url=t,this.source=Bh.Url,Vs&&console.log("set url",t),this._videoElement?t.endsWith(".m3u8")||t.includes(".m3u")?this.ensureM3UCanBePlayed():(this._videoElement.src=t,this._isPlaying&&(this.stop(),this.play())):this.create(this.playOnAwake))}onEnable(){var t,i;Vs&&console.log("VideoPlayer.onEnable",Bh[this.source],this.clip,this.url,this),window.addEventListener("visibilitychange",this.visibilityChanged),this.playOnAwake===!0?this.create(!0):this.preloadVideo(),this.screenspace?(t=this._overlay)==null||t.start():(i=this._overlay)==null||i.stop()}onDisable(){var t;window.removeEventListener("visibilitychange",this.visibilityChanged),(t=this._overlay)==null||t.stop(),this.pause()}onDestroy(){var t;this._videoElement&&((t=this.videoElement)==null||t.remove(),this._videoElement=null),this._videoTexture&&(this._videoTexture.dispose(),this._videoTexture=null)}play(){var t,i;if(this._videoElement||this.create(!1),!this._videoElement){Vs&&console.warn("Can not play: no video element found",this);return}if(!(this._isPlaying&&!((t=this._videoElement)!=null&&t.ended)&&!((i=this._videoElement)!=null&&i.paused))){if(this._isPlaying=!0,this._receivedInput||(this._videoElement.muted=!0),this.handleBeginPlaying(!1),this.shouldUseM3U){this.ensureM3UCanBePlayed();return}Vs&&console.log("Video Play()",this.clip,this._videoElement,this.time),this._videoElement.currentTime=this.time,this._videoElement.play().catch(n=>{var r;console.log(n),Vs&&console.error("Error playing video",n,"CODE="+n.code,(r=this.videoElement)==null?void 0:r.src,this),setTimeout(()=>{this._isPlaying&&!this.destroyed&&this.activeAndEnabled&&this.play()},1e3)}),Vs&&console.log("play",this._videoElement,this.time)}}stop(){this._isPlaying=!1,this.time=0,this._videoElement&&(this._videoElement.currentTime=0,this._videoElement.pause(),Vs&&console.log("STOP",this))}pause(){var t,i;this.time=((t=this._videoElement)==null?void 0:t.currentTime)??0,this._isPlaying=!1,(i=this._videoElement)==null||i.pause(),Vs&&console.log("PAUSE",this,this.currentTime)}create(t){let i;switch(this.source){case Bh.VideoClip:i=this.clip;break;case Bh.Url:i=this.url,!(i!=null&&i.length)&&typeof this.clip=="string"&&(i=this.clip);break}return i?(this._videoElement||(Vs&&console.warn("Create VideoElement",this),this._videoElement=this.createVideoElement(),this.context.domElement.shadowRoot.prepend(this._videoElement),this.updateVideoElementStyles()),typeof i=="string"?(Vs&&console.log("Set Video src",i),this._videoElement.src=i):(Vs&&console.log("Set Video srcObject",i),this._videoElement.srcObject=i),this._videoTexture||(this._videoTexture=new d4(this._videoElement)),this._videoTexture.flipY=!1,this._videoTexture.colorSpace=_t,t&&this.handleBeginPlaying(t),Vs&&console.log("Video: handle playing done...",i,t),!0):(Vs&&console.warn("No video source set",this),!1)}updateAspect(){this.aspectMode!==ad.None&&this.startCoroutine(this.updateAspectImpl())}get screenspace(){var t;return((t=this._overlay)==null?void 0:t.enabled)??!1}set screenspace(t){var i;if(t){if(!this._videoTexture)return;this._overlay||(this._overlay=new Wde(this.context)),this._overlay.add(this._videoTexture)}else(i=this._overlay)==null||i.remove(this._videoTexture);this._overlay&&(this._overlay.enabled=t)}createVideoElement(){const t=document.createElement("video");return this._crossOrigin&&t.setAttribute("crossorigin",this._crossOrigin),Vs&&console.log("created video element",t),t}handleBeginPlaying(t){var r,o;if(!this.activeAndEnabled||!this._videoElement)return;this._targetObjects.length=0;let i=this.gameObject;switch(this.renderMode){case BA.MaterialOverride:i=(r=this.targetMaterialRenderer)==null?void 0:r.gameObject,i||(i=(o=ne.getComponent(this.gameObject,dn))==null?void 0:o.gameObject);break;case BA.RenderTexture:console.error("VideoPlayer renderTexture not implemented yet. Please use material override instead");return}if(!i){console.error("Missing target for video material renderer",this.name,BA[this.renderMode],this);return}const n=i.material;if(n){this._targetObjects.push(i),n!==this._videoMaterial&&(this._videoMaterial=n.clone(),i.material=this._videoMaterial);const a="map",l=this._videoMaterial;if(!this.targetMaterialProperty)l[a]=this._videoTexture;else switch(this.targetMaterialProperty){default:l[a]=this._videoTexture;break}}else{console.warn("Can not play video, no material found, this might be a multimaterial case which is not supported yet");return}this.updateVideoElementSettings(),this.updateVideoElementStyles(),t&&(this.shouldUseM3U&&this.ensureM3UCanBePlayed(),this.play())}updateVideoElementSettings(){if(!this._videoElement)return;this._videoElement.loop=this._isLooping,this._videoElement.currentTime=this.currentTime,this._videoElement.playbackRate=this._playbackSpeed,this._videoElement.playsInline=!0;let t=!this._receivedInput||this.audioOutputMode===PA.None;!t&&this._muted&&(t=!0),this._videoElement.muted=t,this.playOnAwake&&(this._videoElement.autoplay=!0)}updateVideoElementStyles(){this._videoElement&&(this._videoElement.style.userSelect="none",this._videoElement.style.visibility="hidden",this._videoElement.style.display="none",this.updateAspect())}*updateAspectImpl(){const t=++this._updateAspectRoutineId,i=void 0,n=this.clip;for(;t===this._updateAspectRoutineId&&this.aspectMode!==ad.None&&this.clip&&n===this.clip&&this._isPlaying;){if(!n||typeof n=="string")return;let r;for(const o of n.getVideoTracks()){const a=o.getSettings();if(a&&a.width&&a.height){r=a.width/a.height;break}else r=this.context.renderer.domElement.clientWidth/this.context.renderer.domElement.clientHeight}if(r===void 0){for(let o=0;o<10;o++)yield;if(!this.isPlaying)break;continue}if(i===r){yield;continue}for(const o of this._targetObjects){let a=1;if(o.parent){const l=ln(o.parent);a=l.x/l.y}switch(this.aspectMode){case ad.AdjustHeight:o.scale.y=1/r*o.scale.x*a;break;case ad.AdjustWidth:o.scale.x=r*o.scale.y*a;break}}for(let o=0;o<3;o++)yield}}get shouldUseM3U(){return this.url!=null&&(this.url.endsWith(".m3u8")||this.url.endsWith(".m3u"))&&this.source===Bh.Url}ensureM3UCanBePlayed(){if(!this.shouldUseM3U)return;let t=document.head.querySelector("script[data-hls_library]");t?globalThis.Hls?this.onHlsAvailable():t.addEventListener("load",this.onHlsAvailable):(Vs&&console.log("HLS: load script"),t=document.createElement("script"),t.dataset.hls_library="hls.js",t.src="https://cdn.jsdelivr.net/npm/hls.js@1",t.addEventListener("load",this.onHlsAvailable),document.head.append(t))}}Ma([x()],Ns.prototype,"playOnAwake",void 0);Ma([x()],Ns.prototype,"aspectMode",void 0);Ma([x(URL)],Ns.prototype,"clip",void 0);Ma([x()],Ns.prototype,"source",void 0);Ma([x(URL)],Ns.prototype,"url",null);Ma([x()],Ns.prototype,"renderMode",void 0);Ma([x()],Ns.prototype,"targetMaterialProperty",void 0);Ma([x(dn)],Ns.prototype,"targetMaterialRenderer",void 0);Ma([x(Pt)],Ns.prototype,"targetTexture",void 0);Ma([x()],Ns.prototype,"time",void 0);Ma([x()],Ns.prototype,"playbackSpeed",null);Ma([x()],Ns.prototype,"isLooping",null);Ma([x()],Ns.prototype,"audioOutputMode",null);class Wde{constructor(e){u(this,"context");u(this,"_videos",[]);u(this,"_screenspaceModeQuad");u(this,"_isInScreenspaceMode",!1);u(this,"_input");this.context=e,this._input=new qde(this)}get enabled(){return this._isInScreenspaceMode}set enabled(e){e?this.start():this.stop()}add(e){this._videos.indexOf(e)===-1&&this._videos.push(e)}remove(e){if(!e)return;const t=this._videos.indexOf(e);t>=0&&this._videos.splice(t,1)}start(){var n;if(this._isInScreenspaceMode||this._videos.length<0)return;const e=this._videos[this._videos.length-1];if(!e)return;if(this._isInScreenspaceMode=!0,!this._screenspaceModeQuad){if(this._screenspaceModeQuad=Vd.createPrimitive(Wa.Quad,{material:new Xde(e)}),!this._screenspaceModeQuad)return;this._screenspaceModeQuad.geometry.scale(2,2,2)}const t=this._screenspaceModeQuad;this.context.scene.add(t),this.updateScreenspaceMaterialUniforms();const i=t.material;i==null||i.reset(),(n=this._input)==null||n.enable(i)}stop(){var e;this._isInScreenspaceMode=!1,this._screenspaceModeQuad&&((e=this._input)==null||e.disable(),this._screenspaceModeQuad.removeFromParent())}updateScreenspaceMaterialUniforms(){var t;const e=(t=this._screenspaceModeQuad)==null?void 0:t.material;e&&(e.screenAspect=this.context.domElement.clientWidth/this.context.domElement.clientHeight)}}class qde{constructor(e){u(this,"_onResizeScreenFn");u(this,"_onKeyUpFn");u(this,"_onMouseWheelFn");u(this,"context");u(this,"overlay");u(this,"_material");u(this,"_isPinching",!1);u(this,"_lastPinch",0);this.overlay=e,this.context=e.context}enable(e){this._material=e,window.addEventListener("resize",this._onResizeScreenFn=()=>{this.overlay.updateScreenspaceMaterialUniforms()}),window.addEventListener("keyup",this._onKeyUpFn=n=>{n.key==="Escape"&&this.overlay.stop()}),window.addEventListener("wheel",this._onMouseWheelFn=n=>{this.overlay.enabled&&(e.zoom+=n.deltaY*5e-4,n.preventDefault())},{passive:!1});const t=new Z;window.addEventListener("mousemove",n=>{if(this.overlay.enabled&&this.context.input.getPointerPressed(0)){const r=new Z(n.movementX,n.movementY);r.x/=this.context.domElement.clientWidth,r.y/=this.context.domElement.clientHeight,t.set(r.x,r.y),t.multiplyScalar(e.zoom/-this.context.time.deltaTime*.01),e.offset=e.offset.add(t)}}),window.addEventListener("pointermove",n=>{this.overlay.enabled&&this.context.input.getPointerPressed(0)&&this.context.input.getTouchesPressedCount()===1&&(t.set(n.movementX,n.movementY),t.multiplyScalar(e.zoom*-this.context.time.deltaTime*.05),e.offset=e.offset.add(t))});let i=0;window.addEventListener("touchstart",n=>{if(n.touches.length<2){this.context.time.time-i<.3&&this.overlay.stop(),i=this.context.time.time;return}this._isPinching=!0,this._lastPinch=0}),window.addEventListener("touchmove",n=>{if(!this._isPinching||!this._material)return;const r=n.touches[0],o=n.touches[1],a=r.clientX-o.clientX,l=r.clientY-o.clientY,c=Math.sqrt(a*a+l*l);if(this._lastPinch!==0){const h=c-this._lastPinch;this._material.zoom-=h*.004}this._lastPinch=c}),window.addEventListener("touchend",()=>{this._isPinching=!1})}disable(){this._onResizeScreenFn&&(window.removeEventListener("resize",this._onResizeScreenFn),this._onResizeScreenFn=void 0),this._onKeyUpFn&&(window.removeEventListener("keyup",this._onKeyUpFn),this._onKeyUpFn=void 0),this._onMouseWheelFn&&(window.removeEventListener("wheel",this._onMouseWheelFn),this._onMouseWheelFn=void 0)}}class Xde extends Rt{constructor(t){super();u(this,"_offset",new Z);this.uniforms={map:{value:t},screenAspect:{value:1},offsetScale:{value:new Je(0,0,1,1)}},this.vertexShader=`
        uniform sampler2D map;
        uniform float screenAspect;
        uniform vec4 offsetScale;
        varying vec2 vUv;

        void main() {

            gl_Position = vec4( position , 1.0 );
            vUv = uv;
            vUv.y = 1. - vUv.y;

            // fit into screen
            ivec2 res = textureSize(map, 0);
            float videoAspect = float(res.x) / float(res.y);
            float aspect = videoAspect / screenAspect;
            if(aspect >= 1.0) 
            {
                vUv.y = vUv.y * aspect;
                float offset = (1. - aspect) * .5;
                vUv.y = vUv.y + offset;
            }
            else
            {
                vUv.x = vUv.x / aspect;
                float offset = (1. - 1. / aspect) * .5;
                vUv.x = vUv.x + offset;
            }

            vUv.x -= .5;
            vUv.y -= .5;

            vUv.x *= offsetScale.z;
            vUv.y *= offsetScale.z;
            vUv.x += offsetScale.x;
            vUv.y += offsetScale.y;

            vUv.x += .5;
            vUv.y += .5;
        }

        `,this.fragmentShader=`
        uniform sampler2D map;
        varying vec2 vUv;
        void main() {
            if(vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.)
                gl_FragColor = vec4(0., 0., 0., 1.);
            else
            {
                vec4 texcolor = texture2D(map, vUv);
                texcolor = LinearTosRGB(texcolor);
                gl_FragColor = texcolor;
            }
        }
        `}set screenAspect(t){this.uniforms.screenAspect.value=t,this.needsUpdate=!0}set offset(t){const i=this.uniforms.offsetScale.value;i.x=t.x,i.y=t.y,this.uniforms.offsetScale.value=i,this.needsUpdate=!0}get offset(){const t=this.uniforms.offsetScale.value;return this._offset.set(t.x,t.y),this._offset}set zoom(t){const i=this.uniforms.offsetScale.value;t<.001&&(t=.001),i.z=t,this.needsUpdate=!0}get zoom(){return this.uniforms.offsetScale.value.z}reset(){this.offset=this.offset.set(0,0),this.zoom=1,this.needsUpdate=!0}}var $_=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const cr=ie("debugscreensharing");var mP;(function(s){s[s.Screen=0]="Screen",s[s.Camera=1]="Camera",s[s.Canvas=2]="Canvas",s[s.Microphone=3]="Microphone"})(mP||(mP={}));var sa;(function(s){s[s.Idle=0]="Idle",s[s.Sending=1]="Sending",s[s.Receiving=2]="Receiving"})(sa||(sa={}));class of extends Te{constructor(){super(...arguments);u(this,"allowStartOnClick",!0);u(this,"autoConnect",!1);u(this,"_videoPlayer");u(this,"_audioSource");u(this,"device","Screen");u(this,"deviceName");u(this,"deviceFilter");u(this,"_net");u(this,"_requestOpen",!1);u(this,"_currentStream",null);u(this,"_currentMode",sa.Idle);u(this,"onJoinedRoom",async()=>{await Xc(1e3),this.autoConnect&&!this.isSending&&!this.isReceiving&&this.context.connection.isInRoom&&this.share()});u(this,"_activeShareRequest",null);u(this,"onReceiveStream",t=>{var i;((i=t.stream)==null?void 0:i.active)===!0&&this.setStream(t.stream,sa.Receiving)});u(this,"onCallEnded",t=>{cr&&console.log("CALL ENDED",this.isReceiving,this==null?void 0:this.screenspace),this.isReceiving&&(this.screenspace=!1)})}onPointerEnter(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorPointer()}onPointerExit(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorNormal()}onPointerClick(t){var i;if(this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&!(t&&t.pointerId!==0)){if(this.isReceiving&&((i=this.videoPlayer)!=null&&i.isPlaying)){this.videoPlayer&&(this.videoPlayer.screenspace=!this.videoPlayer.screenspace);return}if(this.isSending){this.close();return}this.share()}}set videoPlayer(t){this._videoPlayer&&(this.isSending||this.isReceiving)&&this._videoPlayer.stop(),this._videoPlayer=t,this._videoPlayer&&this._currentStream&&(this.isSending||this.isReceiving)&&this._videoPlayer.setVideo(this._currentStream)}get videoPlayer(){return this._videoPlayer}get screenspace(){var t;return((t=this.videoPlayer)==null?void 0:t.screenspace)??!1}set screenspace(t){this.videoPlayer&&(this.videoPlayer.screenspace=t)}get currentScream(){return this._currentStream}get currentMode(){return this._currentMode}get isSending(){var t;return((t=this._currentStream)==null?void 0:t.active)&&this._currentMode===sa.Sending}get isReceiving(){if(this._currentMode===sa.Receiving){if(!this._currentStream||this._currentStream.active===!1)return!1;const t=this._currentStream.getTracks();for(const i of t)if(i.readyState==="live")return!0}return!1}get requiresVideoPlayer(){return this.device!=="Microphone"}awake(){typeof this.device=="number"&&(this.device=mP[this.device]),cr&&console.log("Screensharing",this.name,this),Fi.registerWaitForAllowAudio(()=>{this._videoPlayer&&this._currentStream&&this._currentMode===sa.Receiving&&(this._videoPlayer.playInBackground=!0,this._videoPlayer.setVideo(this._currentStream))}),this._net=new R_(this)}onEnable(){var t,i,n;(t=this._net)==null||t.enable(),(i=this._net)==null||i.addEventListener(Nn.StreamReceived,this.onReceiveStream),(n=this._net)==null||n.addEventListener(Nn.StreamEnded,this.onCallEnded),this.context.connection.beginListen(Ut.JoinedRoom,this.onJoinedRoom),this.autoConnect&&Xc(1e3).then(()=>(this.enabled&&this.autoConnect&&!this.isReceiving&&!this.isSending&&this.context.connection.isInRoom&&this.share(),0))}onDisable(){var t,i,n;(t=this._net)==null||t.removeEventListener(Nn.StreamReceived,this.onReceiveStream),(i=this._net)==null||i.removeEventListener(Nn.StreamEnded,this.onCallEnded),this.context.connection.stopListen(Ut.JoinedRoom,this.onJoinedRoom),(n=this._net)==null||n.disable(),this.close()}_ensureVideoPlayer(){const t=new Ns;t.aspectMode=ad.AdjustWidth,ne.addComponent(this.gameObject,t),this._videoPlayer=t}async share(t){return this._activeShareRequest?this._activeShareRequest:(this._activeShareRequest=this.internalShare(t),this._activeShareRequest.then(()=>this._activeShareRequest=null))}async internalShare(t){if(this.context.connection.isInRoom===!1){console.warn("Can not start screensharing: requires network connection"),Xe()&&Yi("Can not start screensharing: requires network connection. Add a SyncedRoom component or join a room first.");return}if(t!=null&&t.device&&(this.device=t.device),!this.videoPlayer&&this.requiresVideoPlayer&&(this._videoPlayer||(this._videoPlayer=ne.getComponent(this.gameObject,Ns)??void 0),this.videoPlayer||this._ensureVideoPlayer(),!this.videoPlayer)){console.warn("Can not share video without a videoPlayer assigned");return}this._requestOpen=!0;try{const i=(t==null?void 0:t.constraints)??{echoCancellation:!0,autoGainControl:!1},n={video:i,audio:i},r=n.video;switch(r!==void 0&&typeof r!="boolean"&&(r.width||(r.width={max:1920}),r.height||(r.height={max:1920}),r.aspectRatio||(r.aspectRatio={ideal:1.7777777778}),r.frameRate||(r.frameRate={ideal:24}),r.facingMode||(r.facingMode={ideal:"user"})),this.device){case"Camera":this.tryShareUserCamera(n,t);break;case"Screen":{if(!navigator.mediaDevices.getDisplayMedia){console.error("No getDisplayMedia support");return}const l=await navigator.mediaDevices.getDisplayMedia(n);this._requestOpen?this.setStream(l,sa.Sending):Rc(l)}break;case"Canvas":const o=0,a=this.context.renderer.domElement.captureStream(o);this.setStream(a,sa.Sending);break;case"Microphone":{if(!navigator.mediaDevices.getUserMedia){console.error("No getDisplayMedia support");return}n.video=!1;const l=await navigator.mediaDevices.getUserMedia(n);this._requestOpen?this.setStream(l,sa.Sending):Rc(l)}break;default:console.error("Can not start screen sharing: Unknown device type",this.device)}}catch(i){if(i.name==="NotAllowedError"){console.log("Selection cancelled"),this._requestOpen=!1;return}console.error("Error opening video",i)}}close(){var t;this._requestOpen=!1,this._currentStream&&(cr&&console.warn("Close current stream / disposing resources, stream was active?",this._currentStream.active),(t=this._net)==null||t.stopSendingStream(this._currentStream),Rc(this._currentStream),this._currentMode=sa.Idle,this._currentStream=null)}setStream(t,i){var o,a,l;if(t===this._currentStream||(this.close(),!t))return;this._currentStream=t,this._requestOpen=!0,this._currentMode=i;const n=this.device!=="Microphone",r=i===sa.Sending;n?(this._videoPlayer||this._ensureVideoPlayer(),this._videoPlayer?this._videoPlayer.setVideo(t):console.error("No video player assigned for video stream")):(this._audioSource||(this._audioSource=new Fi,this._audioSource.spatialBlend=0,this._audioSource.volume=1,this.gameObject.addComponent(this._audioSource)),r||(cr&&console.log("PLAY",t.getAudioTracks()),this._audioSource.volume=1,(o=this._audioSource)==null||o.play(t))),r&&((a=this._net)==null||a.startSendingStream(t)),r&&(this._videoPlayer&&(this._videoPlayer.muted=!0),(l=this._audioSource)==null||l.stop());for(const c of t.getTracks())c.addEventListener("ended",()=>{cr&&console.log("Track ended",c),this.close()}),cr&&c.kind==="video"&&console.log(r?"Video →":"Video ←",c.getSettings())}async tryShareUserCamera(t,i){const n=(await navigator.mediaDevices.enumerateDevices()).filter(o=>o.kind==="videoinput");cr&&console.log(`Request camera. These are your kind:videoinput devices:
`,n);let r=!1;for(const o of n)try{if(!this._requestOpen){cr&&console.log("Camera selection cancelled");break}if(o.kind!=="videoinput"){cr&&console.log("Skipping non-video device",o);continue}const a=o.deviceId;if((i==null?void 0:i.deviceId)!=null||(i==null?void 0:i.deviceFilter)!=null){if((i==null?void 0:i.deviceId)!==void 0&&a!==i.deviceId){cr&&console.log("Skipping device due to options.deviceId: "+o.label+"; "+o.deviceId);continue}if(i!=null&&i.deviceFilter&&i.deviceFilter(o)===!1){cr&&console.log("Skipping device due to options.deviceFilter: "+o.label+"; "+o.deviceId);continue}}else if(this.deviceFilter)if(this.deviceFilter(o)===!1){cr&&console.log("Skipping device due to ScreenShare.deviceFilter: "+o.label+"; "+o.deviceId);continue}else cr&&console.log("Selected device by filter",o);else if(this.deviceName){const h=o.label.toLowerCase(),d=this.deviceName.toLowerCase(),f=h.includes(d),p=o.deviceId===this.deviceName;if(!f&&!p){cr&&console.log("Skipping device due to ScreenShare.deviceName: "+o.label+"; "+o.deviceId);continue}else cr&&console.log("Selected device by name",o)}t.video!==!1&&((typeof t.video>"u"||typeof t.video=="boolean")&&(t.video={}),t.video.deviceId=a),r=!0;const c=await navigator.mediaDevices.getUserMedia(t).catch(h=>(console.error("Failed to get user media",h),null));if(c===null)continue;this._requestOpen?(this.setStream(c,sa.Sending),cr&&console.log("Selected camera",o)):(Rc(c),cr&&console.log("Camera selection cancelled"));break}catch(a){if(a.message==="Failed to allocate videosource"||a.message==="Could not start video source"){Yi("Failed to start video: Try another camera (Code "+a.code+")"),console.warn(a);continue}else console.error("Failed to get user media",a.message,a.code,a)}!r&&Xe()&&(Yi("No camera found for sharing. Please connect a camera (see console for more information)"),console.warn("No camera found for sharing. Please connect a camera",n,this.deviceName,"Using deviceFilter? "+this.deviceFilter!=null,"Using options? "+i!=null,"Using deviceName? "+this.deviceName!=null,"Using options.deviceId? "+(i==null?void 0:i.deviceId)!=null,"Using options.deviceFilter? "+(i==null?void 0:i.deviceFilter)!=null))}}$_([x()],of.prototype,"allowStartOnClick",void 0);$_([x()],of.prototype,"autoConnect",void 0);$_([x(Ns)],of.prototype,"videoPlayer",null);$_([x()],of.prototype,"device",void 0);$_([x()],of.prototype,"deviceName",void 0);var eb=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class Cu extends er{constructor(){super(...arguments);u(this,"intensity",new Ze(2));u(this,"falloff",new Ze(1));u(this,"samples",new Ze(9));u(this,"color",new Ze(new me(0,0,0)));u(this,"luminanceInfluence",new Ze(.7));u(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusion"}onBeforeRender(){if(this._ssao&&this.context.mainCamera instanceof zt){const t=this.context.mainCamera.far-this.context.mainCamera.near;this._ssao.ssaoMaterial.worldDistanceFalloff=t*.01,this._ssao.ssaoMaterial.worldDistanceThreshold=this.context.mainCamera.far}}onCreateEffect(){const t=this.context.mainCamera,i=new EH(this.context.scene,t),n=new cD({normalBuffer:i.texture,resolutionScale:.5}),r=this._ssao=new wH(t,i.texture,{normalDepthBuffer:n.texture,worldDistanceThreshold:1,worldDistanceFalloff:1,worldProximityThreshold:.1,worldProximityFalloff:2,intensity:1,blendFunction:$t.MULTIPLY,luminanceInfluence:.5});this.intensity.onValueChanged=a=>{r.intensity=a},this.falloff.onValueChanged=a=>{r.ssaoMaterial.radius=a*.1},this.samples.onValueChanged=a=>{r.ssaoMaterial.samples=a},this.color.onValueChanged=a=>{r.color||(r.color=new me),r.color.copy(a)},this.luminanceInfluence.onValueChanged=a=>{r.luminanceInfluence=a};const o=new Array;return o.push(i),o.push(n),o.push(r),o}}eb([x(Ze)],Cu.prototype,"intensity",void 0);eb([x(Ze)],Cu.prototype,"falloff",void 0);eb([x(Ze)],Cu.prototype,"samples",void 0);eb([x(Ze)],Cu.prototype,"color",void 0);eb([x(Ze)],Cu.prototype,"luminanceInfluence",void 0);il("ScreenSpaceAmbientOcclusion",Cu);var lm=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r},DA;(function(s){s[s.Performance=0]="Performance",s[s.Low=1]="Low",s[s.Medium=2]="Medium",s[s.High=3]="High",s[s.Ultra=4]="Ultra"})(DA||(DA={}));class Ql extends er{constructor(){super(...arguments);u(this,"gammaCorrection",!0);u(this,"aoRadius",new Ze(1));u(this,"falloff",new Ze(1));u(this,"intensity",new Ze(1));u(this,"color",new Ze(new me(0,0,0)));u(this,"screenspaceRadius",!1);u(this,"quality",DA.Medium);u(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusionN8"}onValidate(){this._ssao&&(this._ssao.setQualityMode(DA[this.quality]),this._ssao.configuration.gammaCorrection=this.gammaCorrection,this._ssao.configuration.screenSpaceRadius=this.screenspaceRadius)}onCreateEffect(){const t=this.context.mainCamera,i=this._ssao=new w8(this.context.scene,t,this.context.domWidth,this.context.domHeight),n=DA[this.quality];i.setQualityMode(n),i.configuration.gammaCorrection=this.gammaCorrection,i.configuration.screenSpaceRadius=this.screenspaceRadius,this.intensity.onValueChanged=o=>{i.configuration.intensity=o},this.falloff.onValueChanged=o=>{i.configuration.distanceFalloff=o},this.aoRadius.onValueChanged=o=>{i.configuration.aoRadius=o},this.color.onValueChanged=o=>{i.color||(i.color=new me),i.configuration.color.copy(o)};const r=new Array;return r.push(i),r}}lm([Mr(),x()],Ql.prototype,"gammaCorrection",void 0);lm([x(Ze)],Ql.prototype,"aoRadius",void 0);lm([x(Ze)],Ql.prototype,"falloff",void 0);lm([x(Ze)],Ql.prototype,"intensity",void 0);lm([x(Ze)],Ql.prototype,"color",void 0);lm([Mr(),x()],Ql.prototype,"screenspaceRadius",void 0);lm([Mr(),x()],Ql.prototype,"quality",void 0);il("ScreenSpaceAmbientOcclusionN8",Ql);var T8=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r},yg;(function(s){s[s.ShadowMask=0]="ShadowMask",s[s.Additive=1]="Additive",s[s.Occluder=2]="Occluder"})(yg||(yg={}));class tb extends Te{constructor(){super(...arguments);u(this,"mode",yg.ShadowMask);u(this,"shadowColor",new Vi(0,0,0,1));u(this,"targetMesh")}start(){if(this.gameObject instanceof le)this.gameObject instanceof le&&this.gameObject.material&&(this.gameObject.material=this.gameObject.material.clone(),this.targetMesh=this.gameObject,this.targetMesh.receiveShadow=!0);else{const t=Vd.createPrimitive(Wa.Quad,{name:"ShadowCatcher",material:new ms({color:10066329,roughness:1,metalness:0,transparent:!0})});t.receiveShadow=!0,t.geometry.rotateX(-Math.PI/2),this.gameObject.add(t),this.targetMesh=t}if(!this.targetMesh){console.warn("ShadowCatcher: no mesh to apply shadow catching to. Groups are currently not supported.");return}switch(this.targetMesh.layers.set(2),this.mode){case yg.ShadowMask:this.applyShadowMaterial();break;case yg.Additive:this.applyLightBlendMaterial();break;case yg.Occluder:this.applyOccluderMaterial();break}}applyLightBlendMaterial(){if(!this.targetMesh)return;const t=this.targetMesh.material;t.blending=Ed,this.applyMaterialOptions(t),t.onBeforeCompile=i=>{i.fragmentShader=i.fragmentShader.replace("vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;",`vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
            // diffuse-only lighting with overdrive to somewhat compensate
            // for the loss of indirect lighting and to make it more visible.
            vec3 direct = (reflectedLight.directDiffuse + reflectedLight.directSpecular) * 6.6;
            float max = max(direct.r, max(direct.g, direct.b));
            
            // early out - we're simply returning direct lighting and some alpha based on it so it can 
            // be blended onto the scene.
            gl_FragColor = vec4(direct, max);
            return;
            `)},t.userData.isLightBlendMaterial=!0}applyShadowMaterial(){if(this.targetMesh)if(this.targetMesh.material.type!=="ShadowMaterial"){const t=new FC;t.color=this.shadowColor,t.opacity=this.shadowColor.alpha,this.applyMaterialOptions(t),this.targetMesh.material=t,t.userData.isShadowCatcherMaterial=!0}else{const t=this.targetMesh.material;t.color=this.shadowColor,t.opacity=this.shadowColor.alpha,this.applyMaterialOptions(t),t.userData.isShadowCatcherMaterial=!0}}applyOccluderMaterial(){if(this.targetMesh){let t=this.targetMesh.material;if(!t){const i=new Kt;this.targetMesh.material=i,t=i}t.depthWrite=!0,t.stencilWrite=!0,t.colorWrite=!1,this.gameObject.renderOrder=-100}}applyMaterialOptions(t){t&&(t.depthWrite=!1,t.stencilWrite=!1)}}T8([x()],tb.prototype,"mode",void 0);T8([x(Vi)],tb.prototype,"shadowColor",void 0);var n1=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const w2=class extends Te{constructor(){super(...arguments);u(this,"target",null);u(this,"followFactor",.1);u(this,"rotateFactor",.1);u(this,"positionAxes",sp.All);u(this,"flipForward",!1);u(this,"_firstUpdate",!0)}onBeforeRender(){this.updateNow(!1)}updateNow(t){if(!(!this.target||this.target===this.gameObject)){if(this.followFactor>0){const i=Qt(this.target),n=this._firstUpdate||t?1:et.clamp01(this.context.time.deltaTime*this.followFactor),r=this.worldPosition;this.positionAxes&sp.X&&(r.x=et.lerp(r.x,i.x,n)),this.positionAxes&sp.Y&&(r.y=et.lerp(r.y,i.y,n)),this.positionAxes&sp.Z&&(r.z=et.lerp(r.z,i.z,n)),this.worldPosition=r}if(this.rotateFactor>0){const i=qi(this.target);this.flipForward&&i.premultiply(w2._invertForward);const n=this._firstUpdate||t?1:et.clamp01(this.context.time.deltaTime*this.rotateFactor);this.worldQuaternion=this.worldQuaternion.slerp(i,n)}this._firstUpdate=!1}}};let kl=w2;u(kl,"_invertForward",new xe().setFromAxisAngle(new w(0,1,0),Math.PI));n1([x(ge)],kl.prototype,"target",void 0);n1([x()],kl.prototype,"followFactor",void 0);n1([x()],kl.prototype,"rotateFactor",void 0);n1([x()],kl.prototype,"positionAxes",void 0);class Yde extends le{constructor(e){const t=new Kde(e),i=new _s(t.image.width*.001,t.image.height*.001),n=new Kt({map:t,toneMapped:!1,transparent:!0});super(i,n);function r(o){n.map.dispatchDOMEvent(o)}this.addEventListener("mousedown",r),this.addEventListener("mousemove",r),this.addEventListener("mouseup",r),this.addEventListener("click",r),this.dispose=function(){i.dispose(),n.dispose(),n.map.dispose(),gP.delete(e),this.removeEventListener("mousedown",r),this.removeEventListener("mousemove",r),this.removeEventListener("mouseup",r),this.removeEventListener("click",r)}}}class Kde extends JP{constructor(e){super(_N(e)),this.dom=e,this.anisotropy=16,this.colorSpace=_t,this.minFilter=Nt,this.magFilter=Nt;const t=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),i={attributes:!0,childList:!0,subtree:!0,characterData:!0};t.observe(e,i),this.observer=t}dispatchDOMEvent(e){e.data&&Jde(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=_N(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const gP=new WeakMap;function _N(s){const e=document.createRange(),t=new me;function i(f){const p=[];let m=!1;function v(){if(m&&(m=!1,f.restore()),p.length===0)return;let y=-1/0,g=-1/0,_=1/0,A=1/0;for(let b=0;b<p.length;b++){const E=p[b];y=Math.max(y,E.x),g=Math.max(g,E.y),_=Math.min(_,E.x+E.width),A=Math.min(A,E.y+E.height)}f.save(),f.beginPath(),f.rect(y,g,_-y,A-g),f.clip(),m=!0}return{add:function(y){p.push(y),v()},remove:function(){p.pop(),v()}}}function n(f,p,m,v){v!==""&&(f.textTransform==="uppercase"&&(v=v.toUpperCase()),h.font=f.fontWeight+" "+f.fontSize+" "+f.fontFamily,h.textBaseline="top",h.fillStyle=f.color,h.fillText(v,p,m+parseFloat(f.fontSize)*.1))}function r(f,p,m,v,y){m<2*y&&(y=m/2),v<2*y&&(y=v/2),h.beginPath(),h.moveTo(f+y,p),h.arcTo(f+m,p,f+m,p+v,y),h.arcTo(f+m,p+v,f,p+v,y),h.arcTo(f,p+v,f,p,y),h.arcTo(f,p,f+m,p,y),h.closePath()}function o(f,p,m,v,y,g){const _=f[p+"Width"],A=f[p+"Style"],b=f[p+"Color"];_!=="0px"&&A!=="none"&&b!=="transparent"&&b!=="rgba(0, 0, 0, 0)"&&(h.strokeStyle=b,h.lineWidth=parseFloat(_),h.beginPath(),h.moveTo(m,v),h.lineTo(m+y,v+g),h.stroke())}function a(f,p){let m=0,v=0,y=0,g=0;if(f.nodeType===Node.TEXT_NODE){e.selectNode(f);const A=e.getBoundingClientRect();m=A.left-l.left-.5,v=A.top-l.top-.5,y=A.width,g=A.height,n(p,m,v,f.nodeValue.trim())}else{if(f.nodeType===Node.COMMENT_NODE)return;if(f instanceof HTMLCanvasElement){if(f.style.display==="none")return;const A=f.getBoundingClientRect();m=A.left-l.left-.5,v=A.top-l.top-.5,h.save();const b=window.devicePixelRatio;h.scale(1/b,1/b),h.drawImage(f,m,v),h.restore()}else if(f instanceof HTMLImageElement){if(f.style.display==="none")return;const A=f.getBoundingClientRect();m=A.left-l.left-.5,v=A.top-l.top-.5,y=A.width,g=A.height,h.drawImage(f,m,v,y,g)}else{if(f.style.display==="none")return;const A=f.getBoundingClientRect();m=A.left-l.left-.5,v=A.top-l.top-.5,y=A.width,g=A.height,p=window.getComputedStyle(f),r(m,v,y,g,parseFloat(p.borderRadius));const b=p.backgroundColor;b!=="transparent"&&b!=="rgba(0, 0, 0, 0)"&&(h.fillStyle=b,h.fill());const E=["borderTop","borderLeft","borderBottom","borderRight"];let C=!0,T=null;for(const M of E){if(T!==null&&(C=p[M+"Width"]===p[T+"Width"]&&p[M+"Color"]===p[T+"Color"]&&p[M+"Style"]===p[T+"Style"]),C===!1)break;T=M}if(C===!0){const M=parseFloat(p.borderTopWidth);p.borderTopWidth!=="0px"&&p.borderTopStyle!=="none"&&p.borderTopColor!=="transparent"&&p.borderTopColor!=="rgba(0, 0, 0, 0)"&&(h.strokeStyle=p.borderTopColor,h.lineWidth=M,h.stroke())}else o(p,"borderTop",m,v,y,0),o(p,"borderLeft",m,v,0,g),o(p,"borderBottom",m,v+g,y,0),o(p,"borderRight",m+y,v,0,g);if(f instanceof HTMLInputElement){let M=p.accentColor;(M===void 0||M==="auto")&&(M=p.color),t.set(M);const S=Math.sqrt(.299*t.r**2+.587*t.g**2+.114*t.b**2)<.5?"white":"#111111";if(f.type==="radio"&&(r(m,v,y,g,g),h.fillStyle="white",h.strokeStyle=M,h.lineWidth=1,h.fill(),h.stroke(),f.checked&&(r(m+2,v+2,y-4,g-4,g),h.fillStyle=M,h.strokeStyle=S,h.lineWidth=2,h.fill(),h.stroke())),f.type==="checkbox"&&(r(m,v,y,g,2),h.fillStyle=f.checked?M:"white",h.strokeStyle=f.checked?S:M,h.lineWidth=1,h.stroke(),h.fill(),f.checked)){const I=h.textAlign;h.textAlign="center";const L={color:S,fontFamily:p.fontFamily,fontSize:g+"px",fontWeight:"bold"};n(L,m+y/2,v,"✔"),h.textAlign=I}if(f.type==="range"){const[I,L,U]=["min","max","value"].map(V=>parseFloat(f[V])),D=(U-I)/(L-I)*(y-g);r(m,v+g/4,y,g/2,g/4),h.fillStyle=S,h.strokeStyle=M,h.lineWidth=1,h.fill(),h.stroke(),r(m,v+g/4,D+g/2,g/2,g/4),h.fillStyle=M,h.fill(),r(m+D,v,g,g,g/2),h.fillStyle=M,h.fill()}(f.type==="color"||f.type==="text"||f.type==="number")&&(d.add({x:m,y:v,width:y,height:g}),n(p,m+parseInt(p.paddingLeft),v+parseInt(p.paddingTop),f.value),d.remove())}}}const _=p.overflow==="auto"||p.overflow==="hidden";_&&d.add({x:m,y:v,width:y,height:g});for(let A=0;A<f.childNodes.length;A++)a(f.childNodes[A],p);_&&d.remove()}const l=s.getBoundingClientRect();let c=gP.get(s);c===void 0&&(c=document.createElement("canvas"),c.width=l.width,c.height=l.height,gP.set(s,c));const h=c.getContext("2d"),d=new i(h);return h.clearRect(0,0,c.width,c.height),a(s),c}function Jde(s,e,t,i){const n={clientX:t*s.offsetWidth+s.offsetLeft,clientY:i*s.offsetHeight+s.offsetTop,view:s.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(e,n));const r=s.getBoundingClientRect();t=t*r.width+r.left,i=i*r.height+r.top;function o(a){if(a.nodeType!==Node.TEXT_NODE&&a.nodeType!==Node.COMMENT_NODE){const l=a.getBoundingClientRect();if(t>l.left&&t<l.right&&i>l.top&&i<l.bottom&&(a.dispatchEvent(new MouseEvent(e,n)),a instanceof HTMLInputElement&&a.type==="range"&&(e==="mousedown"||e==="click"))){const[c,h]=["min","max"].map(m=>parseFloat(a[m])),d=l.width,p=(t-l.x)/d;a.value=c+(h-c)*p,a.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let c=0;c<a.childNodes.length;c++)o(a.childNodes[c])}}o(s)}const Bw=new Z,Vm={type:"",data:Bw},bN=new Nd;class Zde extends vs{listenToPointerEvents(e,t){const i=this,n=new Nd,r=e.domElement;function o(a){a.stopPropagation();const l=e.domElement.getBoundingClientRect();Bw.x=(a.clientX-l.left)/l.width*2-1,Bw.y=-(a.clientY-l.top)/l.height*2+1,n.setFromCamera(Bw,t);const c=n.intersectObjects(i.children,!1);if(c.length>0){const h=c[0],d=h.object,f=h.uv;Vm.type=a.type,Vm.data.set(f.x,1-f.y),d.dispatchEvent(Vm)}}r.addEventListener("pointerdown",o),r.addEventListener("pointerup",o),r.addEventListener("pointermove",o),r.addEventListener("mousedown",o),r.addEventListener("mouseup",o),r.addEventListener("mousemove",o),r.addEventListener("click",o)}listenToXRControllerEvents(e){const t=this,i={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function n(r){const o=r.target;bN.setFromXRController(o);const a=bN.intersectObjects(t.children,!1);if(a.length>0){const l=a[0],c=l.object,h=l.uv;Vm.type=i[r.type],Vm.data.set(h.x,1-h.y),c.dispatchEvent(Vm)}}e.addEventListener("move",n),e.addEventListener("select",n),e.addEventListener("selectstart",n),e.addEventListener("selectend",n)}}var M8=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class ib extends Te{constructor(){super(...arguments);u(this,"id",null);u(this,"keepAspect",!1);u(this,"_object",null)}onEnable(){if(this._object){this.gameObject.add(this._object);return}if(!this.id||!this.context.mainCamera)return;const t=document.getElementById(this.id);if(!t){console.warn('Could not find element with id "'+this.id+'"');return}t.style.display="block",t.style.visibility="hidden";const i=new Zde;i.listenToPointerEvents(this.context.renderer,this.context.mainCamera),this.gameObject.add(i);const n=new Yde(t);i.add(n),n.visible=!1;const r=n.material;r.transparent=!0,setTimeout(()=>{n.visible=!0;const o=l_(this.gameObject).clone();c_(this.gameObject,0,0,0),this.gameObject.updateMatrixWorld();const a=new Si;a.setFromObject(i),this.setWorldRotation(o.x,o.y,o.z);const l=a.max.x-a.min.x,c=a.max.y-a.min.y;if(this.keepAspect){const d=l/c;l>c?n.scale.set(1/l,1/c/d,1):n.scale.set(1/l*d,1/c,1)}else n.scale.set(1/l,1/c,1);const h=this.gameObject.scale;n.scale.multiply(h)},1)}onDisable(){var t;(t=this._object)==null||t.removeFromParent()}}M8([x()],ib.prototype,"id",void 0);M8([x()],ib.prototype,"keepAspect",void 0);var nb=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const OA=ie("debugspatialtrigger"),xN=new Wr,wN=new Wr;function $de(s,e){return xN.mask=s,wN.mask=e,xN.test(wN)}class Qc extends Te{constructor(){super(...arguments);u(this,"triggerMask",0);u(this,"onEnter");u(this,"onStay");u(this,"onExit");u(this,"currentIntersected",[]);u(this,"lastIntersected",[])}start(){OA&&console.log(this.name,this.triggerMask,this)}update(){this.currentIntersected.length=0;for(const t of Sd.triggers)$de(t.triggerMask,this.triggerMask)&&t.test(this.gameObject)&&this.currentIntersected.push(t);for(let t=this.lastIntersected.length-1;t>=0;t--){const i=this.lastIntersected[t];this.currentIntersected.indexOf(i)<0&&(this.onExitTrigger(i),this.lastIntersected.splice(t,1))}for(const t of this.currentIntersected)this.lastIntersected.indexOf(t)<0&&this.onEnterTrigger(t),this.onStayTrigger(t);this.lastIntersected.length=0,this.lastIntersected.push(...this.currentIntersected)}onEnterTrigger(t){var i;OA&&console.log("ENTER TRIGGER",this.name,t.name,this,t),t.raiseOnEnterEvent(this),(i=this.onEnter)==null||i.invoke(this,t)}onExitTrigger(t){var i;OA&&console.log("EXIT TRIGGER",this.name,t.name,this,t),t.raiseOnExitEvent(this),(i=this.onExit)==null||i.invoke(this,t)}onStayTrigger(t){var i;t.raiseOnStayEvent(this),(i=this.onStay)==null||i.invoke(this,t)}}nb([x()],Qc.prototype,"triggerMask",void 0);nb([x(un)],Qc.prototype,"onEnter",void 0);nb([x(un)],Qc.prototype,"onStay",void 0);nb([x(un)],Qc.prototype,"onExit",void 0);const jA=class extends Te{constructor(){super(...arguments);u(this,"triggerMask");u(this,"boxHelper")}start(){OA&&console.log(this.name,this.triggerMask,this)}onEnable(){var t;jA.triggers.push(this),this.boxHelper||(this.boxHelper=ne.addComponent(this.gameObject,No),(t=this.boxHelper)==null||t.showHelper(null,OA))}onDisable(){jA.triggers.splice(jA.triggers.indexOf(this),1)}test(t){return this.boxHelper?this.boxHelper.isInBox(t)??!1:!1}raiseOnEnterEvent(t){ne.foreachComponent(this.gameObject,i=>{i!==t&&i instanceof Qc&&i.onEnterTrigger(this)},!1)}raiseOnStayEvent(t){ne.foreachComponent(this.gameObject,i=>{i!==t&&i instanceof Qc&&i.onStayTrigger(this)},!1)}raiseOnExitEvent(t){ne.foreachComponent(this.gameObject,i=>{i!==t&&i instanceof Qc&&i.onExitTrigger(this)},!1)}};let Sd=jA;u(Sd,"triggers",[]);nb([x()],Sd.prototype,"triggerMask",void 0);var efe=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r},lv;(function(s){s[s.FirstPerson=0]="FirstPerson",s[s.ThirdPerson=1]="ThirdPerson"})(lv||(lv={}));const fa=ie("debugspectator");class s1 extends Te{constructor(){super(...arguments);u(this,"cam",null);u(this,"useKeys",!0);u(this,"_mode",lv.FirstPerson);u(this,"orbit",null);u(this,"_handler");u(this,"eventSub_WebXRRequestStartEvent",null);u(this,"eventSub_WebXRStartEvent",null);u(this,"eventSub_WebXREndEvent",null);u(this,"_debug");u(this,"_networking")}get mode(){return this._mode}set mode(t){this._mode=t}get isSpectating(){var t;return((t=this._handler)==null?void 0:t.currentTarget)!==void 0}isSpectatingUser(t){var i;return((i=this.target)==null?void 0:i.userId)===t}isFollowedBy(t){var i;return(i=this.followers)==null?void 0:i.includes(t)}get followers(){return this._networking.followers}stopSpectating(){if(this.context.isInXR){this.followSelf();return}this.target=void 0}get localId(){return this.context.connection.connectionId??"local"}set target(t){var i;if(this._handler){const n=(i=this._handler.currentTarget)==null?void 0:i.userId,r=this.context.players.getPlayerView(this.localId);t===void 0||this.context.isInXR===!1&&(r==null?void 0:r.currentObject)===t.currentObject?this._handler.currentTarget!==void 0&&(this._handler.disable(),ne.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),this._networking.onSpectatedObjectChanged(t,n)):this._handler.currentTarget!==t&&(this._handler.set(t),ne.setActive(this.gameObject,!0),this.orbit&&(this.orbit.enabled=!1),this._networking.onSpectatedObjectChanged(t,n))}}get target(){var t;return(t=this._handler)==null?void 0:t.currentTarget}requestAllFollowMe(){this._networking.onRequestFollowMe()}get isSpectatingSelf(){var t,i;return this.isSpectating&&((t=this.target)==null?void 0:t.currentObject)===((i=this.context.players.getPlayerView(this.localId))==null?void 0:i.currentObject)}awake(){if(this._debug=new nfe(this.context,this),this._networking=new ofe(this.context,this),this._networking.awake(),ne.setActive(this.gameObject,!1),this.cam=ne.getComponent(this.gameObject,Mi),!this.cam){console.warn("SpectatorCamera: Spectator camera needs camera component on the same object.",this);return}!this._handler&&this.cam&&(this._handler=new tfe(this.context,this.cam,this)),this.orbit=ne.getComponent(this.context.mainCamera,Ni)}onDestroy(){var t,i;this.stopSpectating(),(t=this._handler)==null||t.destroy(),(i=this._networking)==null||i.destroy()}isSupportedPlatform(){const t=window.navigator.userAgent,i=/Windows|MacOS/.test(t),n=/Windows NT/.test(t)&&/Edg/.test(t)&&!/Win64/.test(t);return i&&!n}onBeforeXR(t){this.isSupportedPlatform()&&ne.setActive(this.gameObject,!0)}onEnterXR(t){this.isSupportedPlatform()&&(fa&&console.log(this.context.mainCamera),this.context.mainCamera&&this.followSelf())}onLeaveXR(t){var i,n;this.context.removeCamera(this.cam),ne.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),(i=this._handler)==null||i.set(void 0),(n=this._handler)==null||n.disable(),this.isSpectatingSelf&&this.stopSpectating()}followSelf(){this.target=this.context.players.getPlayerView(this.context.connection.connectionId),this.target||(this.context.players.setPlayerView(this.localId,this.context.mainCamera,Uc.Headset),this.target=this.context.players.getPlayerView(this.localId)),fa&&console.log("Follow self",this.target)}onAfterRender(){var h,d,f;if(!this.cam)return;const t=this.context.renderer,i=t.xr.enabled;if(!t.xr.isPresenting&&!((h=this._handler)!=null&&h.currentTarget))return;(d=this._handler)==null||d.update(this._mode);const n=t.getRenderTarget();let r=null;const o=t.state;if(!n){if(!t.state.bindFramebuffer||!o.bindXRFramebuffer)return;r=t._framebuffer,o.bindXRFramebuffer(null)}this.setAvatarFlagsBeforeRender();const a=this.context.mainCameraComponent;if(a){const p=a.backgroundColor;p&&t.setClearColor(p,p.alpha),this.cam.backgroundColor=p,this.cam.clearFlags=a.clearFlags,this.cam.nearClipPlane=a.nearClipPlane,this.cam.farClipPlane=a.farClipPlane}else t.setClearColor(new me(1,1,1));t.setRenderTarget(null),t.xr.enabled=!1;const l=(f=this.cam)==null?void 0:f.threeCamera;this.context.updateAspect(l);const c=t.xr.isPresenting;t.xr.isPresenting=!1,t.setSize(this.context.domWidth,this.context.domHeight),t.render(this.context.scene,l),t.xr.isPresenting=c,t.xr.enabled=i,n?t.setRenderTarget(n):o.bindXRFramebuffer&&o.bindXRFramebuffer(r),this.resetAvatarFlags()}setAvatarFlagsBeforeRender(){const t=this._mode===lv.FirstPerson;for(const i of Ps.instances)if(i.avatar&&"isLocalAvatar"in i.avatar&&"flags"in i.avatar){let n=da.All;this.isSpectatingSelf&&(n=t&&i.avatar.isLocalAvatar?da.FirstPerson:da.ThirdPerson);const r=i.avatar.flags;if(!r)continue;for(const o of r)o.UpdateVisible(n)}}resetAvatarFlags(){var t;for(const i of Ps.instances)if(i.avatar&&"flags"in i.avatar){const n=i.avatar.flags;if(!n)continue;for(const r of n)"isLocalAvatar"in i.avatar&&((t=i.avatar)!=null&&t.isLocalAvatar)?r.UpdateVisible(da.FirstPerson):r.UpdateVisible(da.ThirdPerson)}}}efe([x()],s1.prototype,"useKeys",void 0);class tfe{constructor(e,t,i){u(this,"context");u(this,"cam");u(this,"spectator");u(this,"follow");u(this,"target");u(this,"view");u(this,"currentObject");this.context=e,this.cam=t,this.spectator=i}get currentTarget(){return this.view}set(e){const t=e==null?void 0:e.currentObject;if(!t){this.spectator.stopSpectating();return}t!==this.currentObject&&(this.currentObject=t,this.view=e,this.follow||(this.follow=ne.addComponent(this.cam.gameObject,kl)),this.target||(this.target=new ge),t.add(this.target),this.follow.enabled=!0,this.follow.target=this.target,fa&&console.log("FOLLOW",t),this.context.isInXR?this.context.removeCamera(this.cam):this.context.setCurrentCamera(this.cam))}disable(){fa&&console.log("STOP FOLLOW",this.currentObject),this.view=void 0,this.currentObject=void 0,this.context.removeCamera(this.cam),this.follow&&(this.follow.enabled=!1)}destroy(){var e;(e=this.target)==null||e.removeFromParent(),this.follow&&ne.destroy(this.follow)}update(e){var n,r,o,a,l,c;if(((n=this.currentTarget)==null?void 0:n.isConnected)===!1||((r=this.currentTarget)==null?void 0:r.removed)===!0){fa&&console.log("Target disconnected or timeout",this.currentTarget),this.spectator.stopSpectating();return}this.currentTarget&&((o=this.currentTarget)==null?void 0:o.currentObject)!==this.currentObject&&(fa&&console.log("Target changed",this.currentObject,"to",this.currentTarget.currentObject),this.set(this.currentTarget));const t=this.context.mainCamera;if(t){const h=this.cam.threeCamera;(h.near!==t.near||h.far!==t.far)&&(h.near=t.near,h.far=t.far,h.updateProjectionMatrix())}const i=(a=this.follow)==null?void 0:a.target;if(!(!i||!this.follow)){switch(e){case lv.FirstPerson:((l=this.view)==null?void 0:l.viewDevice)!==Uc.Browser?(this.follow.followFactor=5,this.follow.rotateFactor=5):(this.follow.followFactor=50,this.follow.rotateFactor=50),i.position.set(0,0,0);break;case lv.ThirdPerson:this.follow.followFactor=3,this.follow.rotateFactor=2,i.position.set(0,.5,1.5);break}this.follow.flipForward=!1,((c=this.view)==null?void 0:c.viewDevice)!==Uc.Browser?i.quaternion.copy(ife):i.quaternion.identity()}}}const ife=new xe().setFromAxisAngle(new w(0,1,0),Math.PI);class nfe{constructor(e,t){u(this,"context");u(this,"spectator");this.context=e,this.spectator=t,console.log("[Spectator Camera] Click other avatars or cameras to follow them. Press ESC to exit spectator mode."),this.context.domElement.addEventListener("keydown",n=>{if(!this.spectator.useKeys)return;n.key==="Escape"&&this.spectator.stopSpectating()});let i=0;this.context.input.addEventListener(Ai.PointerDown,n=>{i=this.context.time.time}),this.context.input.addEventListener(Ai.PointerUp,n=>{const r=this.context.time.time-i;r>1?this.spectator.stopSpectating():this.context.input.getPointerClicked(0)&&r<.3&&this.trySelectObject()})}trySelectObject(){const e=new Yc;e.setMask(16777215);const t=this.context.physics.raycast(e);if(fa&&console.log(...t),t!=null&&t.length)for(const i of t){if(i.distance<.2)continue;const n=i.object,r=ne.getComponentInParent(n,Ps),o=r==null?void 0:r.connectionId;if(o){const a=this.context.players.getPlayerView(o);this.spectator.target=a,fa&&console.log("spectate",o,r);break}}}}class sfe{constructor(e,t,i){u(this,"guid");u(this,"dontSave",!0);u(this,"targetUserId");u(this,"stoppedFollowing");this.guid=e,this.targetUserId=t,this.stoppedFollowing=i}}class rfe{constructor(e,t){u(this,"guid");u(this,"userId");this.guid=e.guid,this.userId=t}}class ofe{constructor(e,t){u(this,"followers",[]);u(this,"context");u(this,"spectator");u(this,"_followerEventMethod");u(this,"_requestFollowMethod");u(this,"_joinedRoomMethod");u(this,"_lastRequestFollowUser");u(this,"_enforceFollowInterval");this.context=e,this.spectator=t,this._followerEventMethod=this.onFollowerEvent.bind(this),this._requestFollowMethod=this.onRequestFollowEvent.bind(this),this._joinedRoomMethod=this.onUserJoinedRoom.bind(this)}awake(){this.context.connection.beginListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.beginListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.beginListen(Ut.JoinedRoom,this._joinedRoomMethod),this.context.domElement.addEventListener("keydown",e=>{this.spectator.useKeys&&(e.key==="f"?this.onRequestFollowMe():e.key==="Escape"&&this.onRequestFollowMe(!0))})}destroy(){this.context.connection.stopListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.stopListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.stopListen(Ut.JoinedRoom,this._joinedRoomMethod)}onSpectatedObjectChanged(e,t){if(fa&&console.log(this.context.connection.connectionId,"onSpectatedObjectChanged",e,t),this.context.connection.connectionId){const i=(e==null?void 0:e.userId)===void 0,n=i?t:e==null?void 0:e.userId,r=new sfe(this.context.connection.connectionId,n,i);this.context.connection.send("spectator-follower-changed",r)}}onRequestFollowMe(e=!1){if(fa&&console.log("Request follow",this.context.connection.connectionId),this.context.connection.connectionId){this.spectator.stopSpectating();const t=e?void 0:this.context.connection.connectionId,i=new rfe(this.spectator,t);this.context.connection.send("spectator-request-follow",i)}}onUserJoinedRoom(){ie("followme")&&this.onRequestFollowMe()}onFollowerEvent(e){const t=e.targetUserId,i=e.guid;if(fa&&console.log(e),t===this.context.connection.connectionId)if(e.stoppedFollowing){const n=this.followers.indexOf(i);n!==-1&&(this.followers.splice(n,1),this.removeDisconnectedFollowers(),console.log(i,"unfollows you",this.followers.length))}else this.followers.includes(i)||(this.followers.push(i),this.removeDisconnectedFollowers(),console.log(i,"follows you",this.followers.length))}removeDisconnectedFollowers(){for(let e=this.followers.length-1;e>=0;e--){const t=this.followers[e];this.context.connection.userIsInRoom(t)===!1&&this.followers.splice(e,1)}}onRequestFollowEvent(e){if(this._lastRequestFollowUser=e,e.userId===this.context.connection.connectionId)this.spectator.stopSpectating();else if(e.userId===void 0)this.spectator.stopSpectating();else{const t=this.context.players.getPlayerView(e.userId);if(t)this.spectator.target=t;else return fa&&console.warn("Could not find view",e.userId),this.enforceFollow(),!1}return!0}enforceFollow(){this._enforceFollowInterval||(this._enforceFollowInterval=setInterval(()=>{this._lastRequestFollowUser===void 0||this._lastRequestFollowUser.userId&&this.spectator.isFollowedBy(this._lastRequestFollowUser.userId)?(clearInterval(this._enforceFollowInterval),this._enforceFollowInterval=void 0):(fa&&console.log("REQUEST FOLLOW AGAIN",this._lastRequestFollowUser.userId),this.onRequestFollowEvent(this._lastRequestFollowUser))},1e3))}}class yc{constructor(){u(this,"bb",null);u(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSyncedCameraModel(e,t){return(t||new yc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedCameraModel(e,t){return e.setPosition(e.position()+fD),(t||new yc).__init(e.readInt32(e.position())+e.position(),e)}userId(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}guid(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}dontSave(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}pos(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new vp).__init(this.bb_pos+t,this.bb):null}rot(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new vp).__init(this.bb_pos+t,this.bb):null}static startSyncedCameraModel(e){e.startObject(5)}static addUserId(e,t){e.addFieldOffset(0,t,0)}static addGuid(e,t){e.addFieldOffset(1,t,0)}static addDontSave(e,t){e.addFieldInt8(2,+t,0)}static addPos(e,t){e.addFieldStruct(3,t,0)}static addRot(e,t){e.addFieldStruct(4,t,0)}static endSyncedCameraModel(e){return e.endObject()}static finishSyncedCameraModelBuffer(e,t){e.finish(t)}static finishSizePrefixedSyncedCameraModelBuffer(e,t){e.finish(t,void 0,!0)}}var afe=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const QS="SCAM";mD(QS,yc.getRootAsSyncedCameraModel);const ia=new u_;class lfe{constructor(e,t){u(this,"userId");u(this,"guid");this.guid=t,this.userId=e}send(e,t){if(e){ia.clear();const i=ia.createString(this.guid),n=ia.createString(this.userId);yc.startSyncedCameraModel(ia),yc.addGuid(ia,i),yc.addUserId(ia,n);const r=Qt(e),o=l_(e);yc.addPos(ia,vp.createVec3(ia,r.x,r.y,r.z)),yc.addRot(ia,vp.createVec3(ia,o.x,o.y,o.z));const a=yc.endSyncedCameraModel(ia);ia.finish(a,QS),t.sendBinary(ia.asUint8Array())}}}const oC=class extends Te{constructor(){super(...arguments);u(this,"cameraPrefab",null);u(this,"_lastWorldPosition");u(this,"_lastWorldQuaternion");u(this,"_model",null);u(this,"_needsUpdate",!0);u(this,"_lastUpdateTime",0);u(this,"remoteCams",{});u(this,"userToCamMap",{});u(this,"_camTimeoutInSeconds",10);u(this,"_receiveCallback",null)}getCameraObject(t){const i=this.userToCamMap[t];return i?this.remoteCams[i].obj:null}async awake(){this._lastWorldPosition=this.worldPosition.clone(),this._lastWorldQuaternion=this.worldQuaternion.clone(),this.cameraPrefab&&("uri"in this.cameraPrefab&&(this.cameraPrefab=await this.cameraPrefab.instantiate(this.gameObject)),this.cameraPrefab&&"isObject3D"in this.cameraPrefab&&(this.cameraPrefab.visible=!1))}onEnable(){this._receiveCallback=this.context.connection.beginListenBinary(QS,this.onReceivedRemoteCameraInfoBin.bind(this))}onDisable(){this.context.connection.stopListenBinary(QS,this._receiveCallback)}update(){for(const r in this.remoteCams){const o=this.remoteCams[r],a=this.context.time.realtimeSinceStartup-o.lastUpdate;if(!o||a>this._camTimeoutInSeconds){Xe()&&console.log("Remote cam timeout",r),o!=null&&o.obj&&ne.destroy(o.obj),delete this.remoteCams[r],o&&delete this.userToCamMap[o.userId],oC.instances.push(o),this.context.players.removePlayerView(o.userId,Uc.Browser);continue}}if(this.context.isInXR)return;const t=this.context.mainCamera;if(t===null){this.enabled=!1;return}if(!this.context.connection.isConnected||this.context.connection.connectionId===null)return;this._model===null&&(this._model=new lfe(this.context.connection.connectionId,this.context.connection.connectionId+"_camera"));const i=Qt(t),n=qi(t);(i.distanceTo(this._lastWorldPosition)>.001||n.angleTo(this._lastWorldQuaternion)>.01)&&(this._needsUpdate=!0),this._lastWorldPosition.copy(i),this._lastWorldQuaternion.copy(n),!((!this._needsUpdate||this.context.time.frameCount%2!==0)&&!(this.context.time.realtimeSinceStartup-this._lastUpdateTime>this._camTimeoutInSeconds*.5))&&(this._lastUpdateTime=this.context.time.realtimeSinceStartup,this._needsUpdate=!1,this._model.send(t,this.context.connection),this.context.isInXR||this.context.players.setPlayerView(this.context.connection.connectionId,t,Uc.Browser))}onReceivedRemoteCameraInfoBin(t){const i=t.guid();if(!i)return;const n=t.userId();if(!n||!this.context.connection.userIsInRoom(n)||!this.cameraPrefab)return;let r=this.remoteCams[i];if(!r)if("isObject3D"in this.cameraPrefab){const c=new Gl;c.context=this.context;const h=ne.instantiate(this.cameraPrefab,c);r=this.remoteCams[i]={obj:h,lastUpdate:this.context.time.realtimeSinceStartup,userId:n},r.obj.visible=!0,this.gameObject.add(h),this.userToCamMap[n]=i,oC.instances.push(r);const d=ne.getOrAddComponent(h,Ps);d.connectionId=n,d.avatar=h}else return;const o=r.obj;this.context.players.setPlayerView(n,o,Uc.Browser),r.lastUpdate=this.context.time.realtimeSinceStartup,Ya.markDirty(o);const a=t.pos();a&&kp(o,a.x(),a.y(),a.z());const l=t.rot();l&&c_(o,l.x(),l.y(),l.z())}};let Cp=oC;u(Cp,"instances",[]);afe([x([ge,si])],Cp.prototype,"cameraPrefab",void 0);var af=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const VM="view",QM=ie("debugsyncedroom");class jl extends Te{constructor(){super(...arguments);u(this,"roomName","");u(this,"urlParameterName","room");u(this,"joinRandomRoom");u(this,"requireRoomParameter",!1);u(this,"autoRejoin",!0);u(this,"createJoinButton",!0);u(this,"createViewOnlyButton",!1);u(this,"_lastJoinedRoom");u(this,"_roomPrefix","");u(this,"_lastPingTime",0);u(this,"_lastRoomTime",-1);u(this,"_userWantsToBeInARoom",!1);u(this,"_roomButton");u(this,"_roomButtonIconJoin");u(this,"_roomButtonIconLeave");u(this,"updateRoomButtonState",()=>{var t,i;this._roomButton&&(this.context.connection.isInRoom?(this._roomButton.title="Leave the networked room",this._roomButton.textContent="Leave Room",(t=this._roomButtonIconJoin)==null||t.remove(),this._roomButton.prepend(this._roomButtonIconLeave)):(this._roomButton.title="Create or join a networked room",this._roomButton.textContent="Join Room",(i=this._roomButtonIconLeave)==null||i.remove(),this._roomButton.prepend(this._roomButtonIconJoin)))});u(this,"_viewOnlyButton");u(this,"onCreateViewOnlyButton",()=>{if(!this._viewOnlyButton){const t=document.createElement("button");this._viewOnlyButton=t,t.classList.add("view-only-button"),t.setAttribute("priority","90"),t.onclick=()=>{var n;const i=this.getViewOnlyUrl();i!=null&&i.length?navigator.canShare({url:i})?(n=navigator.share({url:i}))==null||n.catch(r=>{console.warn(r)}):(navigator.clipboard.writeText(i),Pn("View only URL copied to clipboard")):Yi("Could not create view only URL")},t.title="Copy the view only URL: A page accessed by the view only URL can not be modified by visiting users.",t.textContent="Share View URL",t.prepend(br("visibility"))}this.context.menu.appendChild(this._viewOnlyButton)})}get currentRoomName(){const t=ie(VM);return t||ie(this.urlParameterName)}set roomPrefix(t){this._roomPrefix=t}get roomPrefix(){return this._roomPrefix}awake(){var t;this.joinRandomRoom===void 0&&((t=this.roomName)==null?void 0:t.length)<=0&&(this.joinRandomRoom=!0),QM&&console.log(`SyncedRoom roomName:${this.roomName}, urlParamName:${this.urlParameterName}, joinRandomRoom:${this.joinRandomRoom}`)}onEnable(){const t=ie(VM);if(t&&typeof t=="string"&&t.length>0){console.log("Join as viewer"),this.context.connection.joinRoom(t,!0);return}if(this.tryJoinRoom(),this.createJoinButton){const i=this.createRoomButton();this.context.menu.appendChild(i)}this.createViewOnlyButton&&this.onEnableViewOnlyButton()}onDisable(){var t;(t=this._roomButton)==null||t.remove(),this.onDisableViewOnlyButton(),this.roomName&&this.roomName.length>0&&this.context.connection.leaveRoom(this.roomName)}onDestroy(){this.destroyRoomButton()}tryJoinRandomRoom(){this.setRandomRoomUrlParameter(),this.tryJoinRoom()}tryJoinRoom(t=0){var n;t===void 0&&(t=0);let i=!1;if(((n=this.urlParameterName)==null?void 0:n.length)>0){const r=ie(this.urlParameterName);if(r&&(typeof r=="string"||typeof r=="number")){i=!0;const o=Y4(r.toString());this.roomName=o}else if(this.joinRandomRoom&&(console.log("No room name found in url, generating random one"),this.setRandomRoomUrlParameter(),t<1))return this.tryJoinRoom(t+1)}else this.joinRandomRoom&&(this.roomName===null||this.roomName===void 0||this.roomName.length<=0)&&(this.roomName=this.generateRoomName());return this.requireRoomParameter&&!i?((QM||Xe())&&console.warn('[SyncedRoom] Missing required room parameter "'+this.urlParameterName+`" in url - will not connect.
To allow joining a room without a query parameter you can set "requireRoomParameter" to false.`),!1):(this.context.connection.isConnected||this.context.connection.connect(),this._lastJoinedRoom=this.roomName,this._roomPrefix&&(this.roomName=this._roomPrefix+this.roomName),this.roomName.length<=0?(console.warn(`[SyncedRoom] Room name is not set so we can not join a networked room.
Please choose one of the following options to fix this:
A) Set a room name in the SyncedRoom component
B) Set a room name in the URL parameter "?`+this.urlParameterName+`=my_room"
C) Set "joinRandomRoom" to true`),!1):(QM&&console.log("Join "+this.roomName),this._userWantsToBeInARoom=!0,this.context.connection.joinRoom(this.roomName),!0))}update(){this.context.connection.isConnected&&(this.context.time.time-this._lastPingTime>3&&(this._lastPingTime=this.context.time.time,this.context.connection.sendPing()),this.context.connection.isInRoom&&(this._lastRoomTime=this.context.time.time)),this._lastRoomTime>0&&this.context.time.time-this._lastRoomTime>.3&&(this._lastRoomTime=-1,this.autoRejoin?this._userWantsToBeInARoom&&(console.log("Disconnected from networking backend - attempt reconnecting now"),this.tryJoinRoom()):Xe()&&console.warn("You are not connected to a room anymore (possibly because the tab was inactive for too long and the server kicked you?)"))}getViewOnlyUrl(){if(this.context.connection.isConnected&&this.context.connection.currentRoomViewId){const t=window.location.search,i=new URLSearchParams(t);return i.has(this.urlParameterName)&&i.delete(this.urlParameterName),i.set(VM,this.context.connection.currentRoomViewId),window.location.origin+window.location.pathname+"?"+i.toString()}return null}setRandomRoomUrlParameter(){const t=n_(),i=this.generateRoomName();ie(this.urlParameterName)?t.set(this.urlParameterName,i):t.append(this.urlParameterName,i),bB(i,t)}generateRoomName(){let t="";for(let i=0;i<6;i++)t+=Math.floor(Math.random()*10).toFixed(0);return t}createRoomButton(){if(this._roomButton)return this._roomButton;const t=document.createElement("button");return this._roomButton=t,t.classList.add("create-room-button"),t.setAttribute("priority","90"),t.onclick=()=>{if(this.context.connection.isInRoom)this.urlParameterName&&Zw(this.urlParameterName,null),this.context.connection.leaveRoom(),this._userWantsToBeInARoom=!1;else{if(this.urlParameterName){const i=ie(this.urlParameterName);(!i||i===!0)&&(this._lastJoinedRoom?Zw(this.urlParameterName,this._lastJoinedRoom):this.setRandomRoomUrlParameter())}this.tryJoinRoom()}},this._roomButtonIconJoin=br("group"),this._roomButtonIconLeave=br("group_off"),this.updateRoomButtonState(),this.context.connection.beginListen(Ut.JoinedRoom,this.updateRoomButtonState),this.context.connection.beginListen(Ut.LeftRoom,this.updateRoomButtonState),t}destroyRoomButton(){this.context.connection.stopListen(Ut.JoinedRoom,this.updateRoomButtonState),this.context.connection.stopListen(Ut.LeftRoom,this.updateRoomButtonState)}onEnableViewOnlyButton(){this.context.connection.isConnected?this.onCreateViewOnlyButton():(this.context.connection.stopListen(Ut.JoinedRoom,this.onCreateViewOnlyButton),this.context.connection.beginListen(Ut.JoinedRoom,this.onCreateViewOnlyButton))}onDisableViewOnlyButton(){var t;this.context.connection.stopListen(Ut.JoinedRoom,this.onCreateViewOnlyButton),(t=this._viewOnlyButton)==null||t.remove()}}af([x()],jl.prototype,"roomName",void 0);af([x()],jl.prototype,"urlParameterName",void 0);af([x()],jl.prototype,"joinRandomRoom",void 0);af([x()],jl.prototype,"requireRoomParameter",void 0);af([x()],jl.prototype,"autoRejoin",void 0);af([x()],jl.prototype,"createJoinButton",void 0);af([x()],jl.prototype,"createViewOnlyButton",void 0);af([x()],jl.prototype,"roomPrefix",null);function cfe(){const s=ie("testwindowcount")||0;s&&s>0&&hfe(s)}function hfe(s){if(ie("testwindow"))return null;const e=new URL(window.location.href);zI(e.searchParams,Zle,1),zI(e.searchParams,"testwindow",1);const t=e.toString(),i=[];window.onbeforeunload=()=>{for(const l of i)l.close()};const n=.05,r=128;let o=0,a=0;for(let l=0;l<s;l++){o*r+r*.01>=window.innerWidth&&(a+=1,o=0);const c=o*(r*(1+n))+window.screenLeft,h=a*(r*(1+n))+window.screenTop+90+60*a;o+=1;const d=window.open(t,"test window "+l,`popup=yes width=${r} height=${r} top=${h} left=${c}`);if(!d){console.warn("Failed to open window");continue}i.push(d),d.onload=()=>{d.onbeforeunload=()=>{for(let f=0;f<i.length;f++){const p=i[f];p!==d&&p.close()}i.length=0}}}return i}class XO extends Te{awake(){cfe()}}class YO extends Te{constructor(){super(...arguments);u(this,"transformsPerFrame",10);u(this,"interval",0);u(this,"useFlatbuffers",!0);u(this,"builder",null);u(this,"models",null)}awake(){if(this.useFlatbuffers)this.context.connection.beginListenBinary(S0,t=>{});else{this.models=[];for(let t=0;t<this.transformsPerFrame;t++)this.models.push(new I8(this.context.connection.connectionId+"_simulatedTransform_"+t,this))}}update(){if(this.context.connection.isConnected){if(this.useFlatbuffers){if(!this.context.connection.connectionId||this.context.time.frameCount%this.interval!==0)return;this.builder===null&&(this.builder=new u_(1024));const t=this.builder;for(let i=0;i<this.transformsPerFrame;i++){t.clear();const n=OQ(this.context.connection.connectionId,this);this.context.connection.sendBinary(n)}}else if(this.models)for(let t=0;t<this.models.length;t++){const i=this.models[t];i.dontSave=!0,i.update(this,null),this.context.connection.send("TestSimulateUserData-"+t,i)}}}}class I8{constructor(e,t){u(this,"guid");u(this,"fast",!1);u(this,"position");u(this,"rotation");u(this,"velocity");u(this,"dontSave");this.guid=e,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0,w:0},this.update(t,null)}isValid(){return this.fast!==void 0||this.position!==void 0||this.rotation!==void 0||this.velocity!==void 0}update(e,t){const i=e.worldPosition;this.position.x=i.x,this.position.y=i.y,this.position.z=i.z;const n=e.worldQuaternion;if(this.rotation.x=n.x,this.rotation.y=n.y,this.rotation.z=n.z,this.rotation.w=n.w,this.fast=!1,t){const r=t.getVelocity();this.velocity===void 0&&(this.velocity={x:0,y:0,z:0}),this.velocity.x=r.x,this.velocity.y=r.y,this.velocity.z=r.z}}}u(I8,"temp",new w);var Gv=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class ch extends er{constructor(){super(...arguments);u(this,"offset",new Ze(0));u(this,"rotation",new Ze(0));u(this,"focusArea",new Ze(.4));u(this,"feather",new Ze(.3));u(this,"kernelSize",new Ze(kc.MEDIUM));u(this,"resolutionScale",new Ze(1/window.devicePixelRatio))}get typeName(){return"TiltShiftEffect"}init(){this.offset.defaultValue=0,this.rotation.defaultValue=0,this.focusArea.defaultValue=.4,this.feather.defaultValue=.3,this.kernelSize.defaultValue=kc.MEDIUM,this.resolutionScale.defaultValue=1/window.devicePixelRatio}onCreateEffect(){const t=new SH({kernelSize:kc.VERY_LARGE,offset:this.offset.value,rotation:this.rotation.value,focusArea:this.focusArea.value,feather:this.feather.value});return this.offset.onValueChanged=i=>t.offset=i,this.rotation.onValueChanged=i=>t.rotation=i,this.focusArea.onValueChanged=i=>t.focusArea=i,this.feather.onValueChanged=i=>t.feather=i,this.kernelSize.onValueChanged=i=>t.blurPass.kernelSize=i,this.resolutionScale.onValueChanged=i=>t.resolution.scale=i/window.devicePixelRatio,t}}Gv([x(Ze)],ch.prototype,"offset",void 0);Gv([x(Ze)],ch.prototype,"rotation",void 0);Gv([x(Ze)],ch.prototype,"focusArea",void 0);Gv([x(Ze)],ch.prototype,"feather",void 0);Gv([x(Ze)],ch.prototype,"kernelSize",void 0);Gv([x(Ze)],ch.prototype,"resolutionScale",void 0);il("TiltShiftEffect",ch);var r1=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class cm extends Te{constructor(){super(...arguments);u(this,"isGizmo",!1);u(this,"translationSnap",1);u(this,"rotationSnapAngle",15);u(this,"scaleSnap",.25);u(this,"control");u(this,"orbit");u(this,"onControlChangedEvent",t=>{const i=this.orbit;if(i&&(i.enabled=!t.value),t.value){const n=ne.getComponentInParent(this.gameObject,Kc);n&&n.requestOwnership()}});u(this,"windowKeyDownListener",t=>{if(this.enabled&&this.control)switch(t.keyCode){case 81:this.control.setSpace(this.control.space==="local"?"world":"local");break;case 16:this.enableSnapping();break;case 87:this.control.setMode("translate");break;case 69:this.control.setMode("rotate");break;case 82:this.control.setMode("scale");break;case 187:case 107:this.control.setSize(this.control.size+.1);break;case 189:case 109:this.control.setSize(Math.max(this.control.size-.1,.1));break;case 88:this.control.showX=!this.control.showX;break;case 89:this.control.showY=!this.control.showY;break;case 90:this.control.showZ=!this.control.showZ;break;case 32:this.control.enabled=!this.control.enabled;break}});u(this,"windowKeyUpListener",t=>{if(this.enabled)switch(t.keyCode){case 16:this.disableSnapping();break}})}onEnable(){var t;this.isGizmo&&!m_||this.context.mainCamera&&(this.control||(this.control=new Fre(this.context.mainCamera,this.context.renderer.domElement),this.control.visible=!0,this.control.enabled=!0,this.control.getRaycaster().layers.set(2),this.control.size=1,this.control.traverse(i=>{const n=i;if(n.layers.set(2),n){const r=n.material;r&&(r.opacity=.3)}}),this.orbit=ne.getComponentInParent(this.context.mainCamera,Ni)??void 0),this.control&&(this.context.scene.add(this.control),this.control.attach(this.gameObject),(t=this.control)==null||t.addEventListener("dragging-changed",this.onControlChangedEvent),window.addEventListener("keydown",this.windowKeyDownListener),window.addEventListener("keyup",this.windowKeyUpListener)))}onDisable(){var t,i;(t=this.control)==null||t.removeFromParent(),(i=this.control)==null||i.removeEventListener("dragging-changed",this.onControlChangedEvent),window.removeEventListener("keydown",this.windowKeyDownListener),window.removeEventListener("keyup",this.windowKeyUpListener)}enableSnapping(){this.control&&(this.control.setTranslationSnap(this.translationSnap),this.control.setRotationSnap(li.degToRad(this.rotationSnapAngle)),this.control.setScaleSnap(this.scaleSnap))}disableSnapping(){this.control&&(this.control.setTranslationSnap(null),this.control.setRotationSnap(null),this.control.setScaleSnap(null))}}r1([x()],cm.prototype,"isGizmo",void 0);r1([x()],cm.prototype,"translationSnap",void 0);r1([x()],cm.prototype,"rotationSnapAngle",void 0);r1([x()],cm.prototype,"scaleSnap",void 0);var KO=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class hm extends er{constructor(){super(...arguments);u(this,"color",new Ze({r:0,g:0,b:0,a:1}));u(this,"intensity",new Ze(0));u(this,"center",new Ze({x:.5,y:.5}))}get typeName(){return"Vignette"}init(){this.color.defaultValue={r:0,g:0,b:0,a:1},this.intensity.defaultValue=0,this.center.defaultValue={x:.5,y:.5}}onCreateEffect(){const t=new CH;return this.intensity.onValueChanged=i=>{t.offset=i,this.updateDarkness(t)},this.color.onValueChanged=i=>{this.updateDarkness(t)},t}updateDarkness(t){const i=this.intensity.value;t.darkness=i}}KO([x(Ze)],hm.prototype,"color",void 0);KO([x(Ze)],hm.prototype,"intensity",void 0);KO([x(Ze)],hm.prototype,"center",void 0);il("Vignette",hm);var ufe=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Yx=ie("debugpost");class cv extends Te{constructor(){super(...arguments);u(this,"sharedProfile");u(this,"_postprocessing");u(this,"_activeEffects",[]);u(this,"_effects",[]);u(this,"_lastApplyTime");u(this,"_rapidApplyCount",0);u(this,"_isDirty",!1);u(this,"_modificationQueue");u(this,"_recreateId",-1)}get isPostProcessingManager(){return!0}get effects(){return this._activeEffects}addEffect(t){let i=t;return i instanceof Co&&(i=new P0(i)),this._effects.includes(i)||(this._effects.push(i),this._isDirty=!0),t}removeEffect(t){var n,r,o,a;let i=-1;if(t instanceof Co?i=this._effects.findIndex(l=>l instanceof P0&&l.effect===t):i=this._effects.indexOf(t),i!==-1)return this._effects.splice(i,1),this._isDirty=!0,t;if(t instanceof er){const l=(r=(n=this.sharedProfile)==null?void 0:n.components)==null?void 0:r.indexOf(t);l!==void 0&&l!==-1&&(this._isDirty=!0,(a=(o=this.sharedProfile)==null?void 0:o.components)==null||a.splice(l,1))}return t}markDirty(){this._isDirty=!0}awake(){var t;Yx&&(console.log("PostprocessingManager Awake",this),console.log("Press P to toggle post processing"),window.addEventListener("keydown",i=>{i.key==="p"&&(this.enabled=!this.enabled,Pn("Toggle PostProcessing "+this.name+": Enabled="+this.enabled),this.markDirty())})),(t=this.sharedProfile)==null||t.init()}onEnable(){this._isDirty=!0}onDisable(){var t;(t=this._postprocessing)==null||t.unapply(),this._isDirty=!1}onBeforeRender(){var t;if(!this.context.isInXR){if(this.context.composer&&!(this.context.composer instanceof rD)){Yx&&console.warn("PostProcessing: The current composer is not an EffectComposer - this is not supported");return}this.context.mainCamera&&this._isDirty&&this.apply(),this.context.composer&&((t=this._postprocessing)==null?void 0:t.composer)===this.context.composer&&(this.context.renderer.getContext().isContextLost()&&this.context.renderer.forceContextRestore(),this.context.composer.setRenderer(this.context.renderer),this.context.composer.setMainScene(this.context.scene),this.context.mainCamera&&this.context.composer.setMainCamera(this.context.mainCamera))}}onDestroy(){var t;(t=this._postprocessing)==null||t.dispose()}apply(){var t;if(Yx&&console.log("Apply PostProcessing "+this.name),Xe()&&(this._lastApplyTime!==void 0&&Date.now()-this._lastApplyTime<100&&(this._rapidApplyCount++,this._rapidApplyCount===5&&console.warn("Detected rapid post processing modifications - this might be a bug",this)),this._lastApplyTime=Date.now()),this._isDirty=!1,this.unapply(),this._activeEffects.length=0,(t=this.sharedProfile)!=null&&t.components){const i=this.sharedProfile.components;for(const n of i)n.active&&!this._activeEffects.includes(n)&&this._activeEffects.push(n)}for(const i of this._effects)i.active&&!this._activeEffects.includes(i)&&this._activeEffects.push(i);Yx&&console.log("Apply PostProcessing",this._activeEffects),this._activeEffects.length>0&&(this._postprocessing||(this._postprocessing=new i1(this.context)),this._postprocessing.apply(this._activeEffects),this._applyPostQueue())}unapply(){var t;(t=this._postprocessing)==null||t.unapply()}_applyPostQueue(){if(this._modificationQueue){for(const t of this._modificationQueue.values())this.onEditorModification(t);this._modificationQueue.clear()}}onEditorModification(t){var i,n;if(t.propertyName.startsWith("postprocessing.")){if(!this._postprocessing)return this._modificationQueue||(this._modificationQueue=new Map),this._modificationQueue.set(t.propertyName,t),!0;if(!((i=this._activeEffects)!=null&&i.length))return;const r=t.propertyName.split(".");if(r.length===3||r.length===4){const o=r[1],a=r[2];for(const l of this._activeEffects)if(((n=l.typeName)==null?void 0:n.toLowerCase())===o.toLowerCase()){if(a==="active"){l.active=t.value,this.scheduleRecreate();return}if(!Kx.has(o)){const c=new Array;Kx.set(o,c);const h=Object.keys(l);for(const d of h)l[d]instanceof Ze&&c.push(d)}if(Kx.has(o)){const c=a.toLowerCase(),h=Kx.get(o);for(const d of h)if(d.toLowerCase()===c){const f=l[d];f instanceof Ze&&(r.length===4&&r[3]==="active"?(f.overrideState=t.value,this.scheduleRecreate()):f&&f.value!==void 0&&(f.value=t.value));return}}console.warn("Unknown modification",a);return}}return!0}return!1}scheduleRecreate(){const t=++this._recreateId;setTimeout(()=>{t===this._recreateId&&(this.onDisable(),this.onEnable())},200)}}ufe([Cv(M_)],cv.prototype,"sharedProfile",void 0);const Kx=new Map;Rle(cv);var dfe=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Dw=ie("debugarcamera");class o1 extends Te{constructor(){super(...arguments);u(this,"backgroundTint",new Vi(1,1,1,1));u(this,"backgroundPlane");u(this,"threeTexture");u(this,"forceTextureInitialization",function(){const t=new Kt,i=new _s,n=new Ks;n.add(new le(i,t));const r=new zt;return function(a,l){t.map=l,a.render(n,r),Dw&&console.warn("Force texture initialization")}}());u(this,"preRender",()=>{if(!this||!this.gameObject)return;const i=this.context.renderer.xr.getFrame();i&&(!this.threeTexture&&this.context.renderer&&(this.threeTexture=new Pt,this.forceTextureInitialization(this.context.renderer,this.threeTexture)),this.backgroundPlane===void 0&&(this.backgroundPlane=pfe(this.backgroundTint)),this.backgroundPlane.parent!==this.scene&&this.scene.add(this.backgroundPlane),this.updateFromFrame(i))})}onBeforeXR(t,i){i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push("camera-access"),Dw&&console.warn("Requesting camera-access")}onEnterXR(t){this.backgroundPlane&&(this.context.scene.add(this.backgroundPlane),this.backgroundPlane.visible=!1),this.backgroundPlane&&this.context.scene.add(this.backgroundPlane),this.context.pre_render_callbacks.push(this.preRender)}onLeaveXR(t){this.backgroundPlane&&this.backgroundPlane.removeFromParent();const i=this.context.pre_render_callbacks.indexOf(this.preRender);i>=0&&this.context.pre_render_callbacks.splice(i,1)}get background(){return this.backgroundPlane}onBeforeRender(t){this.updateFromFrame(t)}updateFromFrame(t){if(!t)return;const i=t.session.enabledFeatures;if(i&&!i.some(r=>r==="camera-access")){this.background&&(this.background.visible=!1);return}const n=t.getViewerPose(this.context.renderer.xr.getReferenceSpace());if(n){for(const r of n.views)if("camera"in r&&r.camera){let a=this.context.renderer.xr.getBinding();if(a||(a=new XRWebGLBinding(t.session,this.context.renderer.getContext())),a){let l=null;if("getCameraImage"in a){l=a.getCameraImage(r.camera);const c=this.context.renderer.properties.get(this.threeTexture);c.__webglTexture=l,this.backgroundPlane?(this.backgroundPlane.setTexture(this.threeTexture),this.backgroundPlane.visible=!0):Dw&&console.warn("No background plane to set texture on")}}}}}}dfe([x(Vi)],o1.prototype,"backgroundTint",void 0);const ffe=`
uniform sampler2D t2D;

varying vec2 vUv;

void main() {

    vec4 texColor = texture2D( t2D, vUv );
    texColor.w = 1.0;

    // inline sRGB decode
    texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );

    gl_FragColor = texColor * <backgroundTint>;

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`;function pfe(s){const e="vec4("+s.r.toFixed(3)+","+s.g.toFixed(3)+","+s.b.toFixed(3)+","+s.a.toFixed(3)+")";Dw&&console.log(e);const t=new le(new _s(2,2),new Rt({name:"BackgroundMaterial",uniforms:fu.clone(_r.background.uniforms),vertexShader:_r.background.vertexShader,fragmentShader:ffe.replaceAll("<backgroundTint>",e),side:Pi,depthTest:!1,depthWrite:!1,fog:!1}));return t.geometry.deleteAttribute("normal"),Object.defineProperty(t.material,"map",{get:function(){return this.threeTexture}}),t.renderOrder=-1e4,t.layers.set(2),t.frustumCulled=!1,t.setTexture=function(i){t.material.uniforms.t2D.value=i},t}var um=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const SN=ie("debugimagetracking"),aC=class{constructor(e,t,i,n,r,o){u(this,"measuredSize");u(this,"state");u(this,"_position");u(this,"_rotation");u(this,"_trackingComponent");u(this,"_trackedImage");u(this,"_bitmap");u(this,"_pose");this._trackingComponent=e,this._trackedImage=t,this._bitmap=i,this.measuredSize=n,this.state=r,this._pose=o}get url(){return this._trackedImage.image??""}get widthInMeters(){return this._trackedImage.widthInMeters??void 0}get bitmap(){return this._bitmap}get model(){return this._trackedImage}getPosition(e){return this.ensureTransformData(),e.copy(this._position),e}getQuaternion(e){return this.ensureTransformData(),e.copy(this._rotation),e}applyToObject(e,t=void 0){this.ensureTransformData();const i=e.position.distanceToSquared(this._position)/.05+e.quaternion.angleTo(this._rotation)/.05;t&&(t*=Math.max(1,i)),t===void 0||t>=1?(e.position.copy(this._position),e.quaternion.copy(this._rotation)):(t=Math.max(0,Math.min(1,t)),e.position.lerp(this._position,t),e.quaternion.slerp(this._rotation,t))}ensureTransformData(){if(!this._position){this._position=aC._positionBuffer.get(),this._rotation=aC._rotationBuffer.get();const e=this._pose.transform,t=It.active.convertSpace(e);this._position.copy(t==null?void 0:t.position),this._rotation.copy(t==null?void 0:t.quaternion)}}};let fd=aC;u(fd,"_positionBuffer",new _a(()=>new w,20)),u(fd,"_rotationBuffer",new _a(()=>new xe,20));class hh{constructor(){u(this,"image");u(this,"widthInMeters",.25);u(this,"object");u(this,"createObjectInstance",!1);u(this,"imageDoesNotMove",!1);u(this,"hideWhenTrackingIsLost",!0)}}um([x(URL)],hh.prototype,"image",void 0);um([x()],hh.prototype,"widthInMeters",void 0);um([x(si)],hh.prototype,"object",void 0);um([x()],hh.prototype,"createObjectInstance",void 0);um([x()],hh.prototype,"imageDoesNotMove",void 0);um([x()],hh.prototype,"hideWhenTrackingIsLost",void 0);class mfe{constructor(e,t,i){u(this,"filename");u(this,"widthInMeters");u(this,"imageData");this.filename=e,this.imageData=t,this.widthInMeters=i}get extensionName(){return"image-tracking"}onAfterHierarchy(e,t){t.beginBlock('def Preliminary_ReferenceImage "AnchoringReferenceImage"'),t.appendLine("uniform asset image = @image_tracking/"+this.filename+"@"),t.appendLine("uniform double physicalWidth = "+(this.widthInMeters*100).toFixed(8)),t.closeBlock()}onBeforeBuildDocument(e){const t=ne.findObjectOfType(cu);!t||!t.trackedImages||t.trackedImages.length>1&&(Xe()&&Yi("USDZ: Only one tracked image is supported."),console.warn("USDZ: Only one tracked image is supported."))}onAfterSerialize(e){e.files["image_tracking/"+this.filename]=this.imageData}onExportObject(e,t,i){var r;const n=ne.findObjectOfType(cu);if(!(!n||!n.trackedImages)){for(const o of n.trackedImages)if(((r=o.object)==null?void 0:r.asset)===e){const a=ne.findObjectOfType(tn);if(!a)continue;const{scale:l,target:c}=a.getARScaleAndTarget();let h=e;const d=new fe;if(e!==c)for(;h.parent&&h.parent!==c;)h=h.parent,d.premultiply(h.matrix);const f=d.clone().invert();t.setMatrix(f.scale(new w(l,l,l)));break}}}}const Eg=class extends Te{constructor(){super(...arguments);u(this,"trackedImages");u(this,"smooth",!0);u(this,"trackedImageIndexMap",new Map);u(this,"imageToObjectMap",new Map);u(this,"currentImages",[]);u(this,"onImageTrackingUpdate",t=>{const i=It.active;if(i)for(const n of t){const r=n.model,o=n.state==="tracked";if(!r.object)continue;let a=this.imageToObjectMap.get(r);if(a===void 0)a={object:null,frames:0,lastTrackingTime:Date.now()},this.imageToObjectMap.set(r,a),r.object.loadAssetAsync().then(l=>{if(r.createObjectInstance&&l&&(l=ne.instantiate(l)),l){a.object=l;for(const c of l.getComponentsInChildren(dn))c.setInstancingEnabled(!1);i.rig?(i.rig.gameObject.add(l),n.applyToObject(l),l.activeSelf||ne.setActive(l,!0)):console.warn("XRImageTracking: missing XRRig")}});else{if(a.frames++,o&&(a.lastTrackingTime=Date.now()),r.imageDoesNotMove&&a.frames>10||!a.object)continue;i.rig&&(i.rig.gameObject.add(a.object),n.applyToObject(a.object,this.smooth?this.context.time.deltaTimeUnscaled*3:void 0),a.object.activeSelf||ne.setActive(a.object,!0))}}})}awake(){if(SN&&console.log(this),!!this.trackedImages){for(const t of this.trackedImages)if(t.image&&!Eg._imageElements.has(t.image)){const i=t.image;Eg._imageElements.set(i,null);const n=document.createElement("img");n.src=i,n.addEventListener("load",async()=>{const r=await createImageBitmap(n);Eg._imageElements.set(i,r);const o=await SQ(r);if(o){const l=await(await o.convertToBlob({type:"image/png"})).arrayBuffer(),c=ne.findObjectOfType(tn);c&&this.trackedImages&&(c.extensions.push(new mfe("marker.png",new Uint8Array(l),this.trackedImages[0].widthInMeters)),c.anchoringType="image")}})}}}onBeforeXR(t,i){var n;if(this.trackedImages){i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.includes("image-tracking")||i.optionalFeatures.push("image-tracking"),i.trackedImages=[];for(const r of this.trackedImages)if((n=r.image)!=null&&n.length&&r.widthInMeters>0){const o=Eg._imageElements.get(r.image);o&&(this.trackedImageIndexMap.set(i.trackedImages.length,r),i.trackedImages.push({image:o,widthInMeters:r.widthInMeters}))}}}onEnterXR(t){var i;if(this.trackedImages){for(const n of this.trackedImages)if((i=n.object)!=null&&i.asset){const r=n.object.asset;r.userData||(r.userData={});const o={visible:r.visible,parent:r.parent,matrix:r.matrix.clone()};r.userData["image-tracking"]=o}}for(const n of this.imageToObjectMap.values())n.frames=0}onLeaveXR(t){var i,n;if(this.trackedImages){for(const r of this.trackedImages)if((i=r.object)!=null&&i.asset){const o=r.object.asset;if(o.userData){const a=o.userData["image-tracking"];a&&(o.visible=a.visible,(n=a.parent)==null||n.add(o),o.matrix.copy(a.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale)),delete o.userData["image-tracking"]}}}}onUpdateXR(t){var r;this.currentImages.length=0;const i=t.xr.frame;if(!i)return;if("getImageTrackingResults"in i){if(((r=t.xr.session.enabledFeatures)==null?void 0:r.includes("image-tracking"))===!1)return;if(i.session&&typeof i.getImageTrackingResults=="function"){const o=i.getImageTrackingResults();if(o.length>0){const a=this.context.renderer.xr.getReferenceSpace();if(a){for(const l of o){const c=l.trackingState,h=l.index,d=this.trackedImageIndexMap.get(h);if(d){const f=i.getPose(l.imageSpace,a),p=new fd(this,d,l.image,l.measuredSize,c,f);this.currentImages.push(p)}else SN&&console.warn("No tracked image for index",h)}if(this.currentImages.length>0)try{this.dispatchEvent(new CustomEvent("image-tracking",{detail:this.currentImages})),this.onImageTrackingUpdate(this.currentImages)}catch(l){console.error(l)}}}}}else{const o=`Image tracking is currently not supported on this device. On Chrome for Android, you can enable the <a target="_blank" href="#" onclick="() => console.log('I')">chrome://flags/#webxr-incubations</a> flag.`;this.didPrintWarning||(this.didPrintWarning=!0,console.log(o)),Yi(o);return}const n=1e3;for(const[o,a]of this.imageToObjectMap){if(!a.object||!o||o.hideWhenTrackingIsLost===!1)continue;let l=!1;for(const c of this.currentImages)if(c.model===o){const h=Date.now()-a.lastTrackingTime;if(o.imageDoesNotMove||c.state==="tracked"||h<=n){l=!0;break}}l||ne.setActive(a.object,!1)}}};let cu=Eg;u(cu,"_imageElements",new Map);um([x(hh)],cu.prototype,"trackedImages",void 0);const Ey=new w,Ty=new w,CN=new Ht;class gfe extends Xr{constructor(e,t=1,i=16711680){const n=new pt,r=e.geometry.attributes.normal.count,o=new nt(r*2*3,3);n.setAttribute("position",o),super(n,new hn({color:i,toneMapped:!1})),this.object=e,this.size=t,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0),CN.getNormalMatrix(this.object.matrixWorld);const e=this.object.matrixWorld,t=this.geometry.attributes.position,i=this.object.geometry;if(i){const n=i.attributes.position,r=i.attributes.normal;let o=0;for(let a=0,l=n.count;a<l;a++)Ey.fromBufferAttribute(n,a).applyMatrix4(e),Ty.fromBufferAttribute(r,a),Ty.applyMatrix3(CN).normalize().multiplyScalar(this.size).add(Ey),t.setXYZ(o,Ey.x,Ey.y,Ey.z),o=o+1,t.setXYZ(o,Ty.x,Ty.y,Ty.z),o=o+1}t.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}var Hv=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const Rf=ie("debugplanetracking");class Eu extends Te{constructor(){super(...arguments);u(this,"dataTemplate");u(this,"occluder",!0);u(this,"initiateRoomCaptureIfNoData",!0);u(this,"usePlaneData",!0);u(this,"useMeshData",!0);u(this,"runInVR",!0);u(this,"bounds",new Si);u(this,"center",new w);u(this,"labelOffset",new w);u(this,"_dataId",1);u(this,"_allPlanes",new Map);u(this,"_allMeshes",new Map);u(this,"firstTimeNoPlanesDetected",-100);u(this,"makeOccluder",(t,i,n=!1)=>{if(i){if(i instanceof Array){for(const r of i)this.makeOccluder(t,r,n);return}!n&&!i.name.toLowerCase().includes("occlu")||(i.colorWrite=!1,i.depthTest=!0,i.depthWrite=!0,i.transparent=!1,i.polygonOffset=!0,i.polygonOffsetFactor=1,i.polygonOffsetUnits=.1,t.renderOrder=-1e3)}});u(this,"_flipForwardMatrix",new fe().makeRotationY(Math.PI));u(this,"_verticesCache",new Map)}get trackedPlanes(){return this._allPlanes.values()}get trackedMeshes(){return this._allMeshes.values()}onBeforeXR(t,i){t==="immersive-vr"&&!this.runInVR||(i.optionalFeatures=i.optionalFeatures||[],this.usePlaneData&&!i.optionalFeatures.includes("plane-detection")&&i.optionalFeatures.push("plane-detection"),this.useMeshData&&!i.optionalFeatures.includes("mesh-detection")&&i.optionalFeatures.push("mesh-detection"))}onEnterXR(t){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onLeaveXR(t){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onUpdateXR(t){if(!this.runInVR&&t.xr.isVR)return;const i=t.xr.rig;if(!i){console.warn("No XR rig found, cannot parent tracked planes to it");return}const n=t.xr.frame;if(!this.context.renderer.xr.getReferenceSpace())return;const a=n.detectedPlanes,l=n.detectedMeshes,c=a!==void 0&&a.size>0,h=l!==void 0&&l.size>0;if(this.initiateRoomCaptureIfNoData&&(!c&&!h&&this.firstTimeNoPlanesDetected<-10&&(this.firstTimeNoPlanesDetected=Date.now()),(c||h)&&(this.firstTimeNoPlanesDetected=-1),this.firstTimeNoPlanesDetected>0&&Date.now()-this.firstTimeNoPlanesDetected>2500&&"initiateRoomCapture"in n.session&&(n.session.initiateRoomCapture(),this.firstTimeNoPlanesDetected=-1)),a!==void 0&&this.processFrameData(t.xr,i.gameObject,n,a,this._allPlanes),l!==void 0&&this.processFrameData(t.xr,i.gameObject,n,l,this._allMeshes),Rf){const d=this.context.mainCameraComponent.gameObject.worldPosition;for(const f of this._allPlanes.values())!f.mesh||!f.mesh.visible||(this.bounds.makeEmpty(),f.mesh.traverse(p=>{p instanceof le&&this.bounds.expandByObject(p)}),this.bounds.getCenter(this.center),this.labelOffset.copy(d).sub(this.center).normalize().multiplyScalar(.1),At.DrawLabel(this.center.add(this.labelOffset),(f.xrData.semanticLabel||"plane").toUpperCase()+`
`+f.xrData.lastChangedTime.toFixed(2),.02))}}removeData(t,i){const n=i.get(t);if(!n)return;i.delete(t),Rf&&console.log("Plane no longer tracked, id="+n.id),n.mesh&&(n.mesh.removeFromParent(),n.mesh.traverse(o=>{const a=o.userData.normalsHelper;a?(a.dispose(),a.removeFromParent()):Rf&&console.warn("No normals helper found for mesh",n.mesh)}),ba(n.mesh,!0,!0));const r=new CustomEvent("plane-tracking",{detail:{type:"plane-removed",context:n}});this.dispatchEvent(r)}processFrameData(t,i,n,r,o){const l=this.context.renderer.xr.getReferenceSpace();if(l){for(const c of o.keys())r.has(c)||this.removeData(c,o);for(const c of r){const h="planeSpace"in c?c.planeSpace:"meshSpace"in c?c.meshSpace:void 0;if(!h)continue;const d=n.getPose(h,l);let f;if(o.has(c)){const p=o.get(c);if(f=p.mesh,p.timestamp<c.lastChangedTime){if(p.timestamp=c.lastChangedTime,p.mesh){const v=this.createGeometry(c);if(p.mesh instanceof le)p.mesh.geometry.dispose(),p.mesh.geometry=v,this.makeOccluder(p.mesh,p.mesh.material);else if(p.mesh instanceof vs)for(const y of p.mesh.children)y instanceof le&&(y.geometry.dispose(),y.geometry=v,this.makeOccluder(y,y.material));if(p.collider){const y=p.mesh;p.collider.sharedMesh=y,p.collider.convex=this.checkIfContextShouldBeConvex(y,p.xrData),p.collider.onDisable(),p.collider.onEnable()}Rf&&(console.log("Plane updated, id="+p.id,p),p.mesh.traverse(y=>{if(!(y instanceof le))return;const g=y.userData.normalsHelper;g&&g.update()}))}const m=new CustomEvent("plane-tracking",{detail:{type:"plane-updated",context:p}});this.dispatchEvent(m)}}else{if(!this.dataTemplate){const p=new le;Rf?p.material=new NC:this.occluder?(p.material=new Kt,this.makeOccluder(p,p.material,!0)):p.material=new Kt({wireframe:!0,opacity:.5,transparent:!0,color:3355443}),this.dataTemplate=new si("","",p)}if(!this.dataTemplate.asset)this.dataTemplate.loadAssetAsync();else{const p=ne.instantiate(this.dataTemplate.asset);if(p.name="xr-tracked-plane",f=p,tD(p,!1),p instanceof le)rn(p.geometry),p.geometry=this.createGeometry(c),this.makeOccluder(p,p.material,this.occluder);else if(p instanceof vs)for(const y of p.children)y instanceof le&&(rn(y.geometry),y.geometry=this.createGeometry(c),this.makeOccluder(y,y.material,this.occluder));const m=p.getComponent($p);if(m){const y=p;m.sharedMesh=y,m.convex=this.checkIfContextShouldBeConvex(y,c),m.onDisable(),m.onEnable()}p.matrixAutoUpdate=!1,p.matrixWorldNeedsUpdate=!0,i.add(p);const v={id:this._dataId++,xrData:c,timestamp:c.lastChangedTime,mesh:p,collider:m};o.set(c,v),Rf&&console.log("New plane detected, id="+v.id,v,{hasCollider:!!m,isGroup:p instanceof vs});try{const y=new CustomEvent("plane-tracking",{detail:{type:"plane-added",context:v}});this.dispatchEvent(y)}catch(y){console.error(y)}}}f&&(d?(f.visible=!0,f.matrix.fromArray(d.transform.matrix),f.matrix.premultiply(this._flipForwardMatrix)):f.visible=!1,Rf&&f.traverse(p=>{if(p instanceof le)if(p.userData.normalsHelper)p.userData.normalsHelper.update();else{const m=new gfe(p,.05,255);m.layers.disableAll(),m.layers.set(2),this.context.scene.add(m),p.userData.normalsHelper=m}}))}}}checkIfContextShouldBeConvex(t,i){if(!t)return!0;if(t){const n=new Si;n.expandByObject(t);const r=new w;n.getSize(r);let o=!0;return r.x>2&&r.y>2&&r.z>1.5&&(o=!1),o&&"semanticLabel"in i&&i.semanticLabel==="wall"&&(o=!0),o}return!0}createGeometry(t){return"polygon"in t?this.createPlaneGeometry(t.polygon):"vertices"in t&&"indices"in t?this.createMeshGeometry(t.vertices,t.indices):new pt}createMeshGeometry(t,i){const n=t.toString()+"_"+i.toString();if(this._verticesCache.has(n))return this._verticesCache.get(n);const r=new pt;r.setIndex(new ot(i,1)),r.setAttribute("position",new ot(t,3));const o=Array();for(let a=0;a<t.length;a+=3)o.push(t[a],t[a+2]);return r.setAttribute("uv",new ot(t,3)),r.computeVertexNormals(),this._verticesCache.set(n,r),r}createPlaneGeometry(t){const i=new pt,n=[],r=[];t.forEach(p=>{n.push(p.x,p.y,p.z),r.push(p.x,p.z)});const o=new w(n[0],n[1],n[2]),a=new w(n[3],n[4],n[5]),l=new w(n[6],n[7],n[8]),c=new w,h=new w;c.subVectors(a,o),h.subVectors(l,o),c.cross(h),c.normalize();const d=[];for(let p=0;p<n.length/3;p++)d.push(c.x,c.y,c.z);const f=[];for(let p=2;p<t.length;++p)f.push(0,p-1,p);return i.setAttribute("position",new ot(new Float32Array(n),3)),i.setAttribute("uv",new ot(new Float32Array(r),2)),i.setAttribute("normal",new ot(new Float32Array(d),3)),i.setIndex(f),i.computeBoundingBox(),i.computeBoundingSphere(),i}}Hv([x(si)],Eu.prototype,"dataTemplate",void 0);Hv([x()],Eu.prototype,"occluder",void 0);Hv([x()],Eu.prototype,"initiateRoomCaptureIfNoData",void 0);Hv([x()],Eu.prototype,"usePlaneData",void 0);Hv([x()],Eu.prototype,"useMeshData",void 0);Hv([x()],Eu.prototype,"runInVR",void 0);var Vv=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class Tu extends Te{constructor(){super(...arguments);u(this,"side","none");u(this,"controller",!0);u(this,"hands",!1);u(this,"controlVisibility",!0);u(this,"useGripSpace",!1);u(this,"resetTransformAfterXRSession",!0);u(this,"_startPosition",new w);u(this,"_startRotation",new xe);u(this,"_startScale",new w)}get activeAndEnabled(){return!0}onEnterXR(t){this._startPosition.copy(this.gameObject.position),this._startRotation.copy(this.gameObject.quaternion),this._startScale.copy(this.gameObject.scale)}onUpdateXR(t){const i=t.xr.getController(this.side);if(i){if(i.hand&&!this.hands){this.controlVisibility&&(this.gameObject.visible=!1);return}else if(!this.controller){this.controlVisibility&&(this.gameObject.visible=!1);return}this.controlVisibility&&(this.gameObject.visible=!0),this.useGripSpace||i.targetRayMode==="transient-pointer"?(this.gameObject.worldPosition=i.gripWorldPosition,this.gameObject.worldQuaternion=i.gripWorldQuaternion,this.gameObject.worldScale=yt(i.xr.rigScale,i.xr.rigScale,i.xr.rigScale).multiply(this._startScale)):(this.gameObject.worldPosition=i.rayWorldPosition,this.gameObject.worldQuaternion=i.rayWorldQuaternion,this.gameObject.worldScale=yt(i.xr.rigScale,i.xr.rigScale,i.xr.rigScale).multiply(this._startScale))}}onLeaveXR(t){this.resetTransformAfterXRSession&&(this.gameObject.position.copy(this._startPosition),this.gameObject.quaternion.copy(this._startRotation),this.gameObject.scale.copy(this._startScale))}}Vv([x()],Tu.prototype,"side",void 0);Vv([x()],Tu.prototype,"controller",void 0);Vv([x()],Tu.prototype,"hands",void 0);Vv([x()],Tu.prototype,"controlVisibility",void 0);Vv([x()],Tu.prototype,"useGripSpace",void 0);Vv([x()],Tu.prototype,"resetTransformAfterXRSession",void 0);var vfe=globalThis&&globalThis.__decorate||function(s,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,i);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(n<3?o(r):n>3?o(e,t,r):o(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};const EN=ie("debugwebxr");class a1 extends Te{constructor(){super(...arguments);u(this,"priority",0);u(this,"_startScale")}get isActive(){return this.activeAndEnabled&&this.gameObject.visible}setAsActiveXRRig(){var t;(t=It.active)==null||t.setRigActive(this)}awake(){if(EN){const t=new ge;t.position.y+=.5,this.gameObject.add(t);const i=t.addNewComponent(em);i&&(i.isGizmo=!1);const n=new xo(.5);this.gameObject.add(n)}}isXRRig(){return!0}supportsXR(t){return!0}onEnterXR(t){this._startScale=this.gameObject.scale.clone(),t.xr.addRig(this),EN&&console.log("WebXR: add Rig",this.name,this.priority)}onLeaveXR(t){t.xr.removeRig(this),this._startScale&&this.gameObject&&this.gameObject.scale.copy(this._startScale)}}vfe([x()],a1.prototype,"priority",void 0);class JO{}const yfe=Object.freeze(Object.defineProperty({__proto__:null,ActionBuilder:wi,ActionCollection:qD,ActionModel:ho,AlignmentConstraint:b_,Animation:qr,AnimationCurve:qa,AnimationExtension:x_,AnimationTrackHandler:TE,Animator:Cr,AnimatorController:Aa,Antialiasing:I_,AudioExtension:jd,AudioListener:xd,AudioSource:Fi,AudioTrackHandler:yp,Avatar:Bd,AvatarBlink_Simple:Zp,AvatarEyeLook_Rotation:au,AvatarLoader:rO,AvatarMarker:Ps,AvatarModel:PE,Avatar_Brain_LookAt:T0,Avatar_MouthShapes:P_,Avatar_MustacheShake:nO,Avatar_POI:zc,AxesHelper:Mv,BaseUIComponent:$a,BasicIKConstraint:aO,BehaviorExtension:BE,BehaviorModel:ys,BloomEffect:Gc,BoxCollider:Xd,BoxGizmo:em,BoxHelperComponent:No,Button:Au,CallInfo:bc,Camera:Mi,CameraTargetReachedEvent:C0,Canvas:Us,CanvasGroup:Dd,CapsuleCollider:mu,ChangeMaterialOnClick:Pc,ChangeTransformOnClick:tm,CharacterController:im,CharacterControllerInput:bu,ChromaticAberration:F_,Collider:Xo,ColorAdjustments:Zd,ColorBySpeedModule:nm,ColorOverLifetimeModule:N_,ContactShadows:Vo,ControlTrackHandler:ME,CustomBranding:nf,Deletable:TO,DeleteBox:Sp,DepthOfField:Vl,DeviceFlag:GE,DocumentExtension:MO,DragControls:Bs,DropListener:sf,Duplicatable:Su,EffectWrapper:P0,EmissionModule:sh,EmphasizeOnClick:Bv,EventList:un,EventListEvent:wE,EventSystem:zo,EventTrigger:VE,FieldWithDefault:wO,FixedJoint:DO,FlyControls:OO,Fog:kv,GltfExport:Cl,GltfExportBox:kO,Gradient:$d,Graphic:Hc,GraphicRaycaster:SE,GridHelper:Fv,GridLayoutGroup:mO,GroundProjectedEnv:ih,GroupActionModel:$h,HideOnStart:vO,HingeJoint:V_,HorizontalLayoutGroup:pO,Image:Pv,InheritVelocityModule:rh,InputField:ua,InstanceHandle:bp,InstancingHandler:wd,Interactable:EO,Keyframe:Ao,LODGroup:j_,LODModel:om,Light:Ko,LimitVelocityOverLifetimeModule:ws,LogStats:UO,LookAt:Vc,LookAtConstraint:Jp,MainModule:Ir,MaskableGraphic:D_,MeshCollider:$p,MeshRenderer:U_,MinMaxCurve:ut,MinMaxGradient:Ds,NeedleMenu:ah,NestedGltf:qE,Networking:vu,NoiseModule:ji,ObjectRaycaster:xa,OffsetConstraint:am,OpenURL:Uv,OrbitControls:Ni,Outline:Rv,Padding:Kd,ParticleBurst:I0,ParticleSubEmitter:t1,ParticleSystem:Bn,ParticleSystemRenderer:sl,PhysicsExtension:UE,PixelationEffect:X_,PlayAnimationOnClick:Il,PlayAudioOnClick:Od,PlayableDirector:Dl,PlayerColor:av,PointerEventData:Ev,PostProcessingHandler:i1,PreliminaryAction:Dv,PreliminaryTrigger:L_,RawImage:OE,Rect:uO,RectTransform:Js,ReflectionProbe:Bc,RegisteredAnimationInfo:eu,RemoteSkybox:$c,Renderer:dn,RendererLightmap:M0,Rigidbody:Ci,RotationBySpeedModule:Ta,RotationOverLifetimeModule:nl,SceneSwitcher:zs,ScreenCapture:of,ScreenSpaceAmbientOcclusion:Cu,ScreenSpaceAmbientOcclusionN8:Ql,SetActiveOnClick:ha,ShadowCatcher:tb,ShapeModule:en,SharpeningEffect:J_,SignalAsset:E_,SignalReceiver:ou,SignalReceiverEvent:Tv,SignalTrackHandler:E0,Size:hO,SizeBySpeedModule:Mo,SizeOverLifetimeModule:ef,SkinnedMeshRenderer:SO,SmoothFollow:kl,SpatialGrabRaycaster:bd,SpatialHtml:ib,SpatialTrigger:Sd,SpatialTriggerReceiver:Qc,SpectatorCamera:s1,SphereCollider:Iv,Sprite:oh,SpriteData:Ll,SpriteRenderer:Yo,SpriteSheet:Ld,SubEmitterSystem:k0,SyncedCamera:Cp,SyncedRoom:jl,SyncedTransform:Kc,TapGestureTrigger:yO,TeleportTarget:FE,TestRunner:XO,TestSimulateUserData:YO,Text:Kr,TextBuilder:NE,TextExtension:z_,TextureSheetAnimationModule:Rr,TiltShiftEffect:ch,ToneMappingEffect:Jc,TrailModule:Ln,TransformData:mn,TransformGizmo:cm,TriggerBuilder:Ys,TriggerModel:Nc,UIRaycastUtils:CE,UIRootComponent:S_,USDZExporter:tn,USDZText:dd,USDZUIExtension:zE,UsageMarker:G_,VariantAction:WD,VelocityOverLifetimeModule:jn,VerticalLayoutGroup:fO,VideoPlayer:Ns,Vignette:hm,VisibilityAction:k_,Voip:qd,Volume:cv,VolumeParameter:Ze,VolumeProfile:M_,WebARCameraBackground:o1,WebARSessionRoot:gu,WebXR:bn,WebXRImageTracking:cu,WebXRImageTrackingModel:hh,WebXRPlaneTracking:Eu,WebXRTrackedImage:fd,XRControllerFollow:Tu,XRControllerModel:Zc,XRControllerMovement:wa,XRFlag:Ws,XRRig:a1,XRState:xr,__Ignore:JO},Symbol.toStringTag,{value:"Module"}));class Afe extends Te{constructor(){super(...arguments);u(this,"toggleKey","KeyP")}update(){this.context.input.isKeyDown(this.toggleKey)&&this.context.domElement.classList.toggle("presentation-mode")}}X.add("__Ignore",JO);X.add("ActionBuilder",wi);X.add("ActionCollection",qD);X.add("ActionModel",ho);X.add("AlignmentConstraint",b_);X.add("Animation",qr);X.add("AnimationCurve",qa);X.add("AnimationExtension",x_);X.add("AnimationTrackHandler",TE);X.add("Animator",Cr);X.add("AnimatorController",Aa);X.add("Antialiasing",I_);X.add("AudioExtension",jd);X.add("AudioListener",xd);X.add("AudioSource",Fi);X.add("AudioTrackHandler",yp);X.add("Avatar",Bd);X.add("Avatar_Brain_LookAt",T0);X.add("Avatar_MouthShapes",P_);X.add("Avatar_MustacheShake",nO);X.add("Avatar_POI",zc);X.add("AvatarBlink_Simple",Zp);X.add("AvatarEyeLook_Rotation",au);X.add("AvatarLoader",rO);X.add("AvatarMarker",Ps);X.add("AvatarModel",PE);X.add("AxesHelper",Mv);X.add("BaseUIComponent",$a);X.add("BasicIKConstraint",aO);X.add("BehaviorExtension",BE);X.add("BehaviorModel",ys);X.add("BloomEffect",Gc);X.add("BoxCollider",Xd);X.add("BoxGizmo",em);X.add("BoxHelperComponent",No);X.add("Button",Au);X.add("CallInfo",bc);X.add("Camera",Mi);X.add("CameraTargetReachedEvent",C0);X.add("Canvas",Us);X.add("CanvasGroup",Dd);X.add("CapsuleCollider",mu);X.add("ChangeMaterialOnClick",Pc);X.add("ChangeTransformOnClick",tm);X.add("CharacterController",im);X.add("CharacterControllerInput",bu);X.add("ChromaticAberration",F_);X.add("Collider",Xo);X.add("ColorAdjustments",Zd);X.add("ColorBySpeedModule",nm);X.add("ColorOverLifetimeModule",N_);X.add("ContactShadows",Vo);X.add("ControlTrackHandler",ME);X.add("CustomBranding",nf);X.add("Deletable",TO);X.add("DeleteBox",Sp);X.add("DepthOfField",Vl);X.add("DeviceFlag",GE);X.add("DocumentExtension",MO);X.add("DragControls",Bs);X.add("DropListener",sf);X.add("Duplicatable",Su);X.add("EffectWrapper",P0);X.add("EmissionModule",sh);X.add("EmphasizeOnClick",Bv);X.add("EventList",un);X.add("EventListEvent",wE);X.add("EventSystem",zo);X.add("EventTrigger",VE);X.add("FieldWithDefault",wO);X.add("FixedJoint",DO);X.add("FlyControls",OO);X.add("Fog",kv);X.add("GltfExport",Cl);X.add("GltfExportBox",kO);X.add("Gradient",$d);X.add("Graphic",Hc);X.add("GraphicRaycaster",SE);X.add("GridHelper",Fv);X.add("GridLayoutGroup",mO);X.add("GroundProjectedEnv",ih);X.add("GroupActionModel",$h);X.add("HideOnStart",vO);X.add("HingeJoint",V_);X.add("HorizontalLayoutGroup",pO);X.add("Image",Pv);X.add("InheritVelocityModule",rh);X.add("InputField",ua);X.add("InstanceHandle",bp);X.add("InstancingHandler",wd);X.add("Interactable",EO);X.add("Keyframe",Ao);X.add("Light",Ko);X.add("LimitVelocityOverLifetimeModule",ws);X.add("LODGroup",j_);X.add("LODModel",om);X.add("LogStats",UO);X.add("LookAt",Vc);X.add("LookAtConstraint",Jp);X.add("MainModule",Ir);X.add("MaskableGraphic",D_);X.add("MeshCollider",$p);X.add("MeshRenderer",U_);X.add("MinMaxCurve",ut);X.add("MinMaxGradient",Ds);X.add("NeedleMenu",ah);X.add("NestedGltf",qE);X.add("Networking",vu);X.add("NoiseModule",ji);X.add("ObjectRaycaster",xa);X.add("OffsetConstraint",am);X.add("OpenURL",Uv);X.add("OrbitControls",Ni);X.add("Outline",Rv);X.add("Padding",Kd);X.add("ParticleBurst",I0);X.add("ParticleSubEmitter",t1);X.add("ParticleSystem",Bn);X.add("ParticleSystemRenderer",sl);X.add("PhysicsExtension",UE);X.add("PixelationEffect",X_);X.add("PlayableDirector",Dl);X.add("PlayAnimationOnClick",Il);X.add("PlayAudioOnClick",Od);X.add("PlayerColor",av);X.add("PlayerState",Xs);X.add("PlayerSync",Wd);X.add("PointerEventData",Ev);X.add("PostProcessingHandler",i1);X.add("PreliminaryAction",Dv);X.add("PreliminaryTrigger",L_);X.add("PresentationMode",Afe);X.add("RawImage",OE);X.add("Rect",uO);X.add("RectTransform",Js);X.add("ReflectionProbe",Bc);X.add("RegisteredAnimationInfo",eu);X.add("RemoteSkybox",$c);X.add("Renderer",dn);X.add("RendererLightmap",M0);X.add("Rigidbody",Ci);X.add("RotationBySpeedModule",Ta);X.add("RotationOverLifetimeModule",nl);X.add("SceneSwitcher",zs);X.add("ScreenCapture",of);X.add("ScreenSpaceAmbientOcclusion",Cu);X.add("ScreenSpaceAmbientOcclusionN8",Ql);X.add("SetActiveOnClick",ha);X.add("ShadowCatcher",tb);X.add("ShapeModule",en);X.add("SharpeningEffect",J_);X.add("SignalAsset",E_);X.add("SignalReceiver",ou);X.add("SignalReceiverEvent",Tv);X.add("SignalTrackHandler",E0);X.add("Size",hO);X.add("SizeBySpeedModule",Mo);X.add("SizeOverLifetimeModule",ef);X.add("SkinnedMeshRenderer",SO);X.add("SmoothFollow",kl);X.add("SpatialGrabRaycaster",bd);X.add("SpatialHtml",ib);X.add("SpatialTrigger",Sd);X.add("SpatialTriggerReceiver",Qc);X.add("SpectatorCamera",s1);X.add("SphereCollider",Iv);X.add("Sprite",oh);X.add("SpriteData",Ll);X.add("SpriteRenderer",Yo);X.add("SpriteSheet",Ld);X.add("SubEmitterSystem",k0);X.add("SyncedCamera",Cp);X.add("SyncedRoom",jl);X.add("SyncedTransform",Kc);X.add("TapGestureTrigger",yO);X.add("TeleportTarget",FE);X.add("TestRunner",XO);X.add("TestSimulateUserData",YO);X.add("Text",Kr);X.add("TextBuilder",NE);X.add("TextExtension",z_);X.add("TextureSheetAnimationModule",Rr);X.add("TiltShiftEffect",ch);X.add("ToneMappingEffect",Jc);X.add("TrailModule",Ln);X.add("TransformData",mn);X.add("TransformGizmo",cm);X.add("TriggerBuilder",Ys);X.add("TriggerModel",Nc);X.add("UIRaycastUtils",CE);X.add("UIRootComponent",S_);X.add("UsageMarker",G_);X.add("USDZExporter",tn);X.add("USDZText",dd);X.add("USDZUIExtension",zE);X.add("VariantAction",WD);X.add("VelocityOverLifetimeModule",jn);X.add("VerticalLayoutGroup",fO);X.add("VideoPlayer",Ns);X.add("Vignette",hm);X.add("VisibilityAction",k_);X.add("Voip",qd);X.add("Volume",cv);X.add("VolumeParameter",Ze);X.add("VolumeProfile",M_);X.add("WebARCameraBackground",o1);X.add("WebARSessionRoot",gu);X.add("WebXR",bn);X.add("WebXRImageTracking",cu);X.add("WebXRImageTrackingModel",hh);X.add("WebXRPlaneTracking",Eu);X.add("WebXRTrackedImage",fd);X.add("XRControllerFollow",Tu);X.add("XRControllerModel",Zc);X.add("XRControllerMovement",wa);X.add("XRFlag",Ws);X.add("XRRig",a1);X.add("XRState",xr);const LA=qs,_fe=ie("debugtypestore");_fe&&console.log(X);function bfe(s,e){const i=_5(s,e);return i!==void 0?i:null}const xfe=new Tre,jM=Symbol("deserialize-queue");async function wfe(s,e,t,i=null,n){if(!t)return;let r=i;typeof r=="number"&&(r=new Ls(i));const o=e.indexOf("?");e=o===-1?e:e.substring(0,o);const a=new BD(t.scene);a.gltfId=e,a.context=s,a.gltf=t,a.nodeToObject=n==null?void 0:n.nodeToObjectMap,a.implementationInformation=xfe;let l=s[jM];if(l||(l=s[jM]=[]),t.scenes)for(const c of t.scenes)await AP(a,c,l);if(t.children)for(const c of t.children)await AP(a,c,l);s.new_scripts_pre_setup_callbacks.push(()=>{const c=s[jM];if(c){for(const h of c)Sfe(h,a);c.length=0}if(r){const h={},d=[];yP(t,r,h,d);for(const f of t.scenes)yP(f,r,h,d);for(const f of d)f.resolveGuids(h)}})}const vP=Symbol("original-component-name"),Qm=new Map;function yP(s,e,t,i){if(e===null||!s)return;const n=s.guid,r=s.guid;r!=null&&r.length&&(Qm.has(r)||(LA&&console.log('Creating InstanceIdProvider with key "'+r+'" for object '+s.name),Qm.set(r,new Ls(r))));const o=r&&Qm.get(r)||e;if(s.guid=o.generateUUID(),n&&n!=="invalid"&&(t[n]=s.guid),s&&s.userData&&s.userData.components)for(const a of s.userData.components){if(a===null)continue;const l=a.guid;l?Qm.has(l)||(LA&&console.log('Creating InstanceIdProvider with key "'+l+'" for component '+a[vP]),Qm.set(l,new Ls(l))):LA&&console.warn("Can not create IdProvider: component "+a[vP]+" has no guid",a.guid);const c=Qm.get(l)||e,h=a.guid;a.guid=c.generateUUID(),h&&h!=="invalid"&&(t[h]=a.guid),a.resolveGuids&&i.push(a)}if(s.children)for(const a of s.children)yP(a,e,t,i)}const My=[];async function AP(s,e,t,i){if(!e)return;const n=e.userData;if(n){const r=n.builtin_components;if(r&&r.length>0)for(const o of r)try{if(o===null)continue;const a=X.get(o.name);if(a!=null){const l=new a;l.sourceId=s.gltfId,iv(l,o,s.implementationInformation),l.context=s.context,"guid"in o&&(l[hA]=o.guid),l[vP]=o.name,mp(e,l,!1),t.push({instance:l,compData:o,obj:e}),l.isCamera&&s.context&&s.context.mainCamera===null&&l.tag==="MainCamera"&&s.context.setCurrentCamera(l)}else LA&&console.debug("unknown component: "+o.name),My.includes(o.name)||My.push(o.name)}catch(a){console.error(o.name+" - "+a.message,a)}if(My.length>0){const o=My.join(", ");console.warn("unknown components: "+o),My.length=0,So()&&Pn(`<strong>Unknown components in scene</strong>:

${o}

This could mean you forgot to add a npmdef to your ExportInfo
<a href="https://engine.needle.tools/docs/project_structure.html#creating-and-installing-a-npmdef" target="_blank">documentation</a>`,os.Warn)}}if(e.children)for(const r of e.children)await AP(s,r,t)}function Sfe(s,e){const{instance:t,compData:i,obj:n}=s;e.object=n,e.target=t,gS(t,i,e),LA&&console.debug("add "+i.name,i,t)}const jS=ie("debugfileformat");async function R8(s,e=!0){var i;if(e){const n=s,r=new URL(n,globalThis.location.origin);let o=null;const a=r.searchParams.get("filetype");switch(a&&(o=a.toUpperCase()),o!=null&&o.length||(o=(i=r.pathname.split(".").pop())==null?void 0:i.toUpperCase()),jS&&console.debug("Use file extension to determine type: "+o),o){case"GLTF":return"gltf";case"VRM":return"vrm";case"GLB":return"glb";case"FBX":return"fbx";case"USD":return"usd";case"USDA":return"usda";case"USDZ":return"usdz";case"OBJ":return"obj"}}const t=await fetch(s,{method:"GET",headers:{range:"bytes=0-32"}}).catch(n=>null);if(t!=null&&t.ok){const n=await t.arrayBuffer(),r=P8(n,t);return jS&&console.log("Determined file type from header: "+r),r}return"unknown"}function P8(s,e){if(s.byteLength<4)return"unknown";const t=new Uint8Array(s);if(jS&&console.warn(`Trying to determine file type from binary data
`,'"'+new TextDecoder().decode(s)+`"
`,t),t[0]==103&&t[1]==108&&t[2]==84&&t[3]==70)return console.debug("GLTF detected"),"glb";if(t[0]==80&&t[1]==75&&t[2]==3&&t[3]==4)return console.debug("USDZ detected"),"usdz";if(t[0]==80&&t[1]==88&&t[2]==82&&t[3]==45&&t[4]==85&&t[5]==83&&t[6]==68&&t[7]==67)return console.debug("Binary USD detected"),"usd";if(t[0]==35&&t[1]==117&&t[2]==115&&t[3]==100&&t[4]==97)return console.debug("ASCII USD detected"),"usda";if(t[0]==75&&t[1]==97&&t[2]==121&&t[3]==100&&t[4]==97&&t[5]==114&&t[6]==97&&t[7]==32)return console.debug("Binary FBX detected"),"fbx";if(t[0]==59&&t[1]==32&&t[2]==70&&t[3]==66&&t[4]==88&&t[5]==32)return console.debug("ASCII FBX detected"),"fbx";if(t[0]==35&&t[1]==32&&t[2]==66&&t[3]==108&&t[4]==101&&t[5]==110&&t[6]==100&&t[7]==101&&t[8]==114&&t[9]==32)return console.debug("OBJ detected"),"obj";if(t[0]==35&&t[1]==32&&t[2]==65&&t[3]==108&&t[4]==105&&t[5]==97&&t[6]==115&&t[7]==32&&t[8]==79&&t[9]==66&&t[10]==74)return console.debug("OBJ detected"),"obj";if(t[0]==118&&t[1]==32||t[0]==102&&t[1]==32)return console.debug("OBJ detected (the file has no header and starts with vertex or face)"),"obj";if(t[0]==35&&t[1]==32&&t[2]==70&&t[3]==105&&t[4]==108&&t[5]==101&&t[6]==32&&t[7]==101&&t[8]==120&&t[9]==112&&t[10]==111&&t[11]==114&&t[12]==116&&t[13]==101&&t[14]==100&&t[15]==32&&t[16]==98&&t[17]==121&&t[18]==32&&t[19]==90&&t[20]==66&&t[21]==114&&t[22]==117&&t[23]==115&&t[24]==104)return console.debug("OBJ detected (exported by ZBrush)"),"obj";{const i=e.headers.get("content-type");switch(console.debug("Content-Type: "+i),i){case"model/gltf+json":return"gltf";case"model/gltf-binary":return"glb";case"model/vnd.usdz+zip":return"usdz";case"model/vnd.usd+zip":return"usd";case"model/vnd.usda+zip":return"usda";case"model/fbx":return"fbx"}if(Xe()||jS){const n=new TextDecoder().decode(s.slice(0,16));console.debug('Could not determine file type from binary data: "'+n+'..."',t)}else console.debug("Could not determine file type from binary data",t)}return"unknown"}class ZO{createBuiltinComponents(e,t,i,n,r){return wfe(e,t,i,n,r)}writeBuiltinComponentData(e,t){return bfe(e,t)}parseSync(e,t,i,n){return L8(e,t,i,n)}loadSync(e,t,i,n,r){return e2(e,t,i,n,r)}}_B(ZO);const B8=ie("printGltf")||ie("printgltf"),D8=ie("downloadgltf"),Cfe=ie("debugfileformat");var hu;(function(s){s[s.BeforeLoad=0]="BeforeLoad",s[s.AfterLoaded=1]="AfterLoaded",s[s.FinishedSetup=10]="FinishedSetup"})(hu||(hu={}));class Ep{constructor(e,t,i,n){u(this,"context");u(this,"loader");u(this,"path");u(this,"gltf");this.context=e,this.path=t,this.loader=i,this.gltf=n}}const Cd={};function Efe(s,e){Cd[s]=Cd[s]||[],Cd[s].push(e)}function Tfe(s,e){if(Cd[s]){const t=Cd[s].indexOf(e);t>=0&&Cd[s].splice(t,1)}}function Ug(s,e){if(Cd[s])for(const t of Cd[s])t(e)}async function O8(s,e,t,i,n){B8&&console.warn("glTF",e,t),e.includes("?")&&(e=e.split("?")[0]),await Fl().createBuiltinComponents(s,e,t,i,n)}async function $O(s,e){const t=await R8(s)||"unknown";switch(Cfe&&console.debug("Determined file type: "+t+" for url",s),t){case"unknown":return console.warn("Unknown file type. Assuming glTF:",s),new Za;case"fbx":return new hQ;case"obj":return new VD;case"usd":case"usda":case"usdz":return console.warn("USD files are not supported."),null;default:console.warn("Unknown file type:",t);case"gltf":case"glb":case"vrm":const i=new Za;return await _O(i,e,s),i}}async function L8(s,e,t,i){typeof t!="string"&&(console.warn("Parse gltf binary without path, this might lead to errors in resolving extensions. Please provide the source path of the gltf/glb file",t,typeof t),t=""),B8&&console.log("Parse glTF",t);const n=await $O(t,s);if(!n)return;if(n instanceof VD){typeof e!="string"&&(e=new TextDecoder().decode(e));const o=n.parse(e);return{animations:o.animations,scene:o,scenes:[o]}}if(!(n instanceof Za)){const o=n.parse(e,t);return U8(n,o),{animations:o.animations,scene:o,scenes:[o]}}const r=AO(n);return new Promise((o,a)=>{try{let l=t.split("?")[0].trimEnd();if(l.endsWith(".glb")||l.endsWith(".gltf")){const h=l.split("/");h.pop(),l=h.join("/"),l.endsWith("/")||(l+="/")}n.resourcePath=l,bE(n,s),Ug(hu.BeforeLoad,new Ep(s,t,n));const c=s.mainCamera;n.parse(e,"",async h=>{xO(t,h,s),Ug(hu.AfterLoaded,new Ep(s,t,n,h)),await O8(s,t,h,i,r),await k8(h.scene,s,c),Ug(hu.FinishedSetup,new Ep(s,t,n,h)),o(h),D8&&F8(e)},h=>{console.error('Loading asset at "'+t+`" failed
`,h),o(void 0)})}catch(l){console.error(l),a(l)}})}async function e2(s,e,t,i,n){Mfe(e);const r=await $O(e,s);if(!r)return;if(!(r instanceof Za)){const a=await r.loadAsync(e,n);return U8(r,a),{animations:a.animations,scene:a,scenes:[a]}}const o=AO(r);return new Promise((a,l)=>{try{bE(r,s),Ug(hu.BeforeLoad,new Ep(s,e,r));const c=s.mainCamera;r.load(e,async h=>{xO(e,h,s),Ug(hu.AfterLoaded,new Ep(s,e,r,h)),await O8(s,t,h,i,o),await k8(h.scene,s,c),Ug(hu.FinishedSetup,new Ep(s,e,r,h)),a(h),D8&&F8(e)},h=>{n==null||n.call(r,h)},h=>{console.error('Loading asset at "'+e+`" failed
`,h),a(void 0)})}catch(c){console.error(c),l(c)}})}async function k8(s,e,t){t||(t=e.mainCamera);try{t?await e.renderer.compileAsync(s,t,e.scene).catch(i=>{console.warn(i.message)}):tre(s,e)}catch(i){console.warn((i==null?void 0:i.message)||i)}}function Mfe(s){if(new URL(s,window.location.href).href.startsWith("file://")){const t=`Hi - it looks like you are trying to load a local file which will not work. You need to use a webserver to serve your files.
Please refer to the documentation on <a href="https://fwd.needle.tools/needle-engine/docs/local-server">https://docs.needle.tools</a> or ask for help in our <a href="https://discord.needle.tools">discord community</a>`;Pn(t),console.warn(t)}}function F8(s){if(typeof s=="string"){const e=document.createElement("a");e.href=s,e.download=s.split("/").pop(),e.click()}else{const e=new Blob([s],{type:"application/octet-stream"}),t=window.URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download="download.glb",i.click()}}function U8(s,e){if(e!=null&&e.isObject3D){const t=e;s instanceof hQ?t.traverse(i=>{const n=i;n!=null&&n.isMesh&&iD(n,n.material)}):s instanceof VD&&t.traverse(i=>{})}}_B(ZO);const Yn=ie("debugwebcomponent"),TN="needle-engine",N8="vr",z8="desktop",Ife=[lQ,N8,z8],Iy="ar-session-active",Ry="desktop-session-active",Rfe=["hash","src","camera-controls","loadstart","progress","loadfinished","dracoDecoderPath","dracoDecoderType","ktx2DecoderPath","tone-mapping","tone-mapping-exposure","background-blurriness","background-color"];class t2 extends HTMLElement{constructor(){super();u(this,"_context");u(this,"_overlay_ar");u(this,"_loadingProgress01",0);u(this,"_loadingView");u(this,"_previousSrc",null);u(this,"_didFullyLoad",!1);u(this,"_loadId",0);u(this,"_abortController",null);u(this,"_lastSourceFiles",null);u(this,"_createContextPromise",null);u(this,"onXRSessionStarted",()=>{var i;const t=this.context.xrSessionMode;t==="immersive-ar"?this.onEnterAR(this.context.xrSession):t==="immersive-vr"&&this.onEnterVR(this.context.xrSession),(i=this.context.xrSession)==null||i.addEventListener("end",()=>{this.dispatchEvent(new CustomEvent("xr-session-ended",{detail:{session:this.context.xrSession,context:this._context,sessionMode:t}})),t==="immersive-ar"?this.onExitAR(this.context.xrSession):t==="immersive-vr"&&this.onExitVR(this.context.xrSession)})});u(this,"onReady",()=>{var t;return(t=this._loadingView)==null?void 0:t.onLoadingFinished()});u(this,"onError",()=>{var t;return(t=this._loadingView)==null?void 0:t.setMessage("Loading failed!")});u(this,"_previouslyRegisteredMap",new Map);this._overlay_ar=new Zoe,this.addEventListener("ready",this.onReady),rQ(),this.attachShadow({mode:"open"});const t=document.createElement("template");t.innerHTML=`<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

    :host {
        position: absolute;
        display: block;
        width: max(600px, 100%);
        height: max(300px, 100%);
        touch-action: none;

        -webkit-tap-highlight-color: transparent;
    }

    @media (max-width: 600px) {
        :host {
            width: 100%;
        }
    }
    @media (max-height: 300px) {
        :host {
            height: 100%;
        }
    }

    :host > div.canvas-wrapper {
        width: 100%;
        height: 100%;
    }

    :host canvas {   
        position: absolute;
        user-select: none;
        -webkit-user-select: none;

        /** allow touch panning but no pinch zoom **/
        /** but this doesnt work yet: 
         * touch-action: pan-x, pan-y;
         **/
        
        -webkit-touch-callout: none;
        -webkit-user-drag: none;
        -webkit-user-modify: none;
    }
    :host .content {
        position: absolute;
        top: 0;
        width: 100%;
        height: 100%;
        visibility: visible;
        z-index: 500; /* < must be less than the webxr buttons element */
        pointer-events: none;
    }
    :host .overlay-content {
        position: absolute;
        user-select: auto;
        pointer-events: all;
    }
    :host slot[name="quit-ar"]:hover {
        cursor: pointer;
    }
    :host .quit-ar-button {
        position: absolute;
        // top: env(titlebar-area-y); /** this doesnt work **/
        top: 60px; /** camera access needs a bit more space **/
        right: 20px;
        z-index: 9999;
    }
</style>
<div class="canvas-wrapper"> <!-- this wrapper is necessary for WebXR https://github.com/meta-quest/immersive-web-emulator/issues/55 -->
    <canvas></canvas>
</div>
<div class="content">
    <slot class="overlay-content"></slot>
</div>
`,this.shadowRoot&&this.shadowRoot.appendChild(t.content.cloneNode(!0)),this._context=new Ot({domElement:this}),this.addEventListener("error",this.onError)}static get observedAttributes(){return Rfe}get loadingProgress01(){return this._loadingProgress01}get loadingFinished(){return this.loadingProgress01>.999}get cameraControls(){const t=this.getAttribute("camera-controls");return t==null?null:!(t===null||t==="False"||t==="false"||t==="0")}getContext(){return new Promise((t,i)=>{if(this._context&&this.loadingFinished)t(this._context);else{const n=()=>{this.removeEventListener("loadfinished",n),this._context&&this.loadingFinished&&t(this._context)};this.addEventListener("loadfinished",n)}})}get context(){return this._context}async connectedCallback(){if(Yn&&console.log("<needle-engine> connected"),this.addEventListener("xr-session-started",this.onXRSessionStarted),this.onSetupDesktop(),!this.getAttribute("src")){const i=globalThis["needle:codegen_files"];Yn&&console.log('src is null, trying to load from globalThis["needle:codegen_files"]',i),i&&(Yn&&console.log('globalThis["needle:codegen_files"]',i),this.setAttribute("src",i))}Yn&&console.log("src",this.getAttribute("src"));const t=this._loadId;setTimeout(()=>{this.isConnected!==!1&&t===this._loadId&&this.onLoad()},1),ja!=null&&ja.length&&this.setAttribute("version",ja)}disconnectedCallback(){var n;this.removeEventListener("xr-session-started",this.onXRSessionStarted),this._didFullyLoad=!1;const t=this.getAttribute("keep-alive"),i=t==null||(t==null?void 0:t.length)>0&&t!=="true"&&t!=="1";Yn&&console.warn('<needle-engine> disconnected, keep-alive: "'+t+'"',typeof t,"Dispose=",i),i?(Yn&&console.warn("<needle-engine> dispose"),(n=this._context)==null||n.dispose(),this._context=null,this._lastSourceFiles=null,this._loadId+=1):Yn&&console.warn("<needle-engine> is not disposed because keep-alive is set")}attributeChangedCallback(t,i,n){switch(Yn&&console.log("attributeChangedCallback",t,i,n),t){case"src":Yn&&console.warn(`<needle-engine src>
changed from "`,i,'" to "',n,'"'),this.onLoad();break;case"hash":this._context&&(this._context.hash=n);break;case"loadstart":case"progress":case"loadfinished":typeof n=="string"&&n.length>0&&(Yn&&console.log(t+" attribute changed",n),this.registerEventFromAttribute(t,n));break;case"dracoDecoderPath":Yn&&console.log("dracoDecoderPath",n),SU(n);break;case"dracoDecoderType":n==="wasm"||n==="js"?(Yn&&console.log("dracoDecoderType",n),CU(n)):console.error("Invalid dracoDecoderType",n,"expected js or wasm");break;case"ktx2DecoderPath":Yn&&console.log("ktx2DecoderPath",n),EU(n);break;case"tone-mapping":{this.applyAttributes();break}case"tone-mapping-exposure":{this.applyAttributes();break}case"background-blurriness":{const r=parseFloat(n);r!=null&&this._context&&(this._context.scene.backgroundBlurriness=r);break}case"background-color":{this.applyAttributes();break}}}async onLoad(){var v,y;if(!this.isConnected)return;if(this._context||(Yn&&console.warn("Create new context"),this._context=new Ot({domElement:this})),!this._context){console.error("Needle Engine: Context not initialized");return}const t=this.getSourceFiles();if(!this.checkIfSourceHasChanged(t,this._lastSourceFiles))return;this._abortController&&(Yn&&console.warn("Abort previous loading process"),this._abortController.abort(),this._abortController=null),this._lastSourceFiles=t;const i=++this._loadId;if((t==null||t.length<=0)&&(Yn&&console.warn("Clear scene",t),this._context.clear(),i!==this._loadId))return;const n=this.getAttribute("alias");this.classList.add("loading");const r=ru();this.ensureLoadStartIsRegistered();let o=this.dispatchEvent(new CustomEvent("loadstart",{detail:{context:this._context,alias:n},cancelable:!0}));if(r){const g=this.getAttribute("hide-loading-overlay");g!=null&&g!=="0"&&(o=!1)}o===!1&&!r&&(Xe()||(o=!0),console.warn("Needle Engine: You need a commercial license to override the default loading view. Visit https://needle.tools/pricing"),Xe()&&Yi('You need a <a target="_blank" href="https://needle.tools/pricing">commercial license</a> to override the default loading view. This will not work in production.')),!this._loadingView&&o&&(this._loadingView=new _A(this)),o&&(this._didFullyLoad!==!0?(v=this._loadingView)==null||v.onLoadingBegin("begin load"):setTimeout(()=>{this._loadingView&&this._loadingProgress01<.3&&this._loadId===i&&this._loadingView.onLoadingBegin("begin load")},300)),Yn&&console.warn(`--------------
Needle Engine: Begin loading `+i+`
`,t),this.onBeforeBeginLoading();const a=[],l={context:this._context,name:"",progress:{},index:0,count:t.length,totalProgress01:this._loadingProgress01},c=new CustomEvent("progress",{detail:l}),h=new Array,d=new AbortController;this._abortController=d;const f={files:t,abortSignal:d.signal,onLoadingProgress:g=>{var A;if(d.signal.aborted)return;const _=g.index;!h[_]&&g.name&&(h[_]=Pfe(g.name)),g.name=h[_],o&&((A=this._loadingView)==null||A.onLoadingUpdate(g)),l.name=g.name,l.progress=g.progress,this._loadingProgress01=HD(g),l.totalProgress01=this._loadingProgress01,this.dispatchEvent(c)},onLoadingFinished:(g,_,A)=>{d.signal.aborted||A&&a.push({src:_,file:A})}},p=this.getAttribute("hash");p!=null&&(this._context.hash=p),this._context.alias=n,this._createContextPromise=this._context.create(f);const m=await this._createContextPromise;if(this.applyAttributes(),Yn&&console.warn(`--------------
Needle Engine: finished loading `+i+`
`,t,`Aborted? ${d.signal.aborted}`),this._loadId!==i||d.signal.aborted){console.log("Loading finished but aborted...");return}this._loadingProgress01=1,o&&m&&((y=this._loadingView)==null||y.onLoadingUpdate(1,"creating scene")),this._didFullyLoad=!0,this.classList.remove("loading"),this.classList.add("loading-finished"),this.dispatchEvent(new CustomEvent("loadfinished",{detail:{context:this._context,src:n,loadedFiles:a}}))}applyAttributes(){if(this._context.renderer){const n=this.getAttribute("tonemapping")||this.getAttribute("tone-mapping");switch(n==null?void 0:n.toLowerCase()){case"none":this._context.renderer.toneMapping=_o;break;case"linear":this._context.renderer.toneMapping=uv;break;case"neutral":this._context.renderer.toneMapping=Mp;break;case"agx":this._context.renderer.toneMapping=dv;break;default:n!=null&&console.warn("Invalid tone-mapping attribute: "+n)}const r=this.getAttribute("tone-mapping-exposure");if(r!=null){const o=parseFloat(r);isNaN(o)||(this._context.renderer.toneMappingExposure=o)}}const t=this.getAttribute("background-blurriness");if(t!=null){const n=parseFloat(t);n!==void 0&&this._context&&(this._context.scene.backgroundBlurriness=n)}const i=this.getAttribute("background-color");if(this._context&&typeof i=="string"&&i.length>0){const n=this._context.scene.background;n instanceof me?n.set(i):this._context.scene.background=new me(i)}}internalSetLoadingMessage(t){var i;(i=this._loadingView)==null||i.setMessage(t)}getSourceFiles(){const t=this.getAttribute("src");if(!t)return[];let i;Array.isArray(t)?i=t:t.startsWith("[")&&t.endsWith("]")?i=JSON.parse(t):t.includes(",")?i=t.split(","):i=[t];for(let n=i.length-1;n>=0;n--){const r=i[n];(r==="null"||r==="undefined"||(r==null?void 0:r.length)<=0)&&i.splice(n,1)}return i}checkIfSourceHasChanged(t,i){if((t==null?void 0:t.length)!==(i==null?void 0:i.length)||t==null&&i!==null||t!==null&&i==null)return!0;if(t!==null&&i!==null){for(let n=0;n<(t==null?void 0:t.length);n++)if(t[n]!==i[n])return!0}return!1}ensureLoadStartIsRegistered(){const t=this.getAttribute("loadstart");t&&this.registerEventFromAttribute("loadstart",t)}registerEventFromAttribute(t,i){const n=this._previouslyRegisteredMap.get(t);if(n&&(this._previouslyRegisteredMap.delete(t),this.removeEventListener(t,n)),typeof i=="string"&&i.length>0)try{const r=(0,eval)(i);typeof r=="function"&&(this._previouslyRegisteredMap.set(t,r),this.addEventListener(t,o=>r==null?void 0:r.call(globalThis,this._context,o)))}catch(r){console.error("Error registering event "+t+'="'+i+`" failed with the following error:
`,r)}}getAROverlayContainer(){return this._overlay_ar.createOverlayContainer(this)}getVROverlayContainer(){for(let t=0;t<this.children.length;t++){const i=this.children[t];if(i.classList.contains("vr"))return i}return null}onEnterAR(t){var n;this.onSetupAR();const i=this.getAROverlayContainer();this._overlay_ar.onBegin(this._context,i,t),this.dispatchEvent(new CustomEvent("enter-ar",{detail:{session:t,context:this._context,htmlContainer:(n=this._overlay_ar)==null?void 0:n.ARContainer}}))}onExitAR(t){var i;this._overlay_ar.onEnd(this._context),this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-ar",{detail:{session:t,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onEnterVR(t){this.onSetupVR(),this.dispatchEvent(new CustomEvent("enter-vr",{detail:{session:t,context:this._context}}))}onExitVR(t){this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-vr",{detail:{session:t,context:this._context}}))}onSetupAR(){this.classList.add(Iy),this.classList.remove(Ry);const t=this.getAROverlayContainer();Yn&&console.warn("onSetupAR:",t),t&&(t.classList.add(Iy),t.classList.remove(Ry)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,lQ))}onSetupVR(){this.classList.remove(Iy),this.classList.remove(Ry),this.foreachHtmlElement(t=>this.setupElementsForMode(t,N8))}onSetupDesktop(){this.classList.remove(Iy),this.classList.add(Ry);const t=this.getAROverlayContainer();t&&(t.classList.remove(Iy),t.classList.add(Ry)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,z8))}setupElementsForMode(t,i,n=null){var o,a;if(t===((a=(o=this._context)==null?void 0:o.renderer)==null?void 0:a.domElement)||t.id==="VRButton"||t.id==="ARButton")return;if(t.classList.contains(i))t.style.visibility="visible",t.style.display==="none"&&(t.style.display="block");else for(const l of Ife)t.classList.contains(l)&&(t.style.visibility="hidden",t.style.display="none")}foreachHtmlElement(t){for(let i=0;i<this.children.length;i++){const n=this.children[i];n.style&&t(n)}}onBeforeBeginLoading(){const t=this.getAttribute("dracoDecoderPath");t&&(Yn&&console.log("using custom draco decoder path",t),SU(t));const i=this.getAttribute("dracoDecoderType");i&&(Yn&&console.log("using custom draco decoder type",i),CU(i));const n=this.getAttribute("ktx2DecoderPath");n&&(Yn&&console.log("using custom ktx2 decoder path",n),EU(n))}}typeof window<"u"&&!window.customElements.get(TN)&&window.customElements.define(TN,t2);function Pfe(s){if(s.startsWith("blob:"))return"blob";const e=s.split("/");let t=e[e.length-1];const i=t.indexOf("?");i>0&&(t=t.substring(0,i));const n=t.indexOf("=");n>0&&(t=t.substring(n));const r=t.split(".").pop(),a=r?["glb","gltf","usdz","usd","fbx","obj","mtl"].indexOf(r.toLowerCase()):-1;if(r&&a>=0&&(t=t.substring(0,t.length-r.length-1)),t=decodeURIComponent(t),t.length>3){let l="",c=!1;const h=["(",")","[","]","{","}",":",";",",",".","!","?"];for(let d=0;d<t.length;d++){let f=t[d];(f==="_"||f==="-")&&(f=" "),!(f===" "&&l.length<=0||h.includes(f)||(l.length===0&&(f=f.toUpperCase()),c&&f===" "))&&(c&&(f=f.toUpperCase()),c=!1,l+=f,f===" "&&(c=!0))}return Xe()&&t!==l&&console.debug('Generated display name: "'+t+'" → "'+l+'"'),l.trim()}return Xe()&&console.debug("Loading: use default name",t),t}const Bfe=Object.freeze(Object.defineProperty({__proto__:null,NeedleEngineHTMLElement:t2},Symbol.toStringTag,{value:"Module"}));function Dfe(){Bl.registerWaitForInteraction(()=>{const s=QC.getContext();s.addEventListener("statechange",()=>{setTimeout(()=>{const e=s.state;(e==="suspended"||e==="interrupted")&&s.resume().then(()=>{console.log("AudioContext resumed successfully")}).catch(t=>{console.log("Failed to resume AudioContext: "+t)})},500)})})}setTimeout(Dfe,1e3);const Ow=ie("debughotreload");let F0=!1;const kA=new Map;function Ofe(){return F0}function Lfe(s){var i;if(F0)return;const t=s.constructor.name;kA.has(t)?(i=kA.get(t))==null||i.push(s):kA.set(t,[s])}function kfe(s){if(F0)return;const t=s.constructor.name,i=kA.get(t);if(!i)return;const n=i.indexOf(s);n!==-1&&i.splice(n,1)}let MN=!1;function Ffe(){if(Ow||MN)return;MN=!0;const s=console.error;console.error=(...e)=>{if(e.length){const t=e[0];if(typeof t=="string"&&t.includes("[hmr] Failed to reload ")){console.log("[Needle Engine] Hot reloading failed"),window.location.reload();return}}s.apply(console,e)}}function Ufe(s){Ow&&console.log("[HMR] Apply changes",s,Object.keys(s)),Ffe();for(const e of Object.keys(s))try{F0=!0;const t=X.get(e);if(!t){Ow&&console.log("[HMR] Type not found: "+e);continue}const i=s[e],n=kA.get(i.name);let r="[Needle Engine] Updating type: "+e;const o=(n==null?void 0:n.length)??-1;o>0?r+=" x"+o:r+=" - no instances",console.log(r);const a=Object.getOwnPropertyNames(t.prototype),l=Object.getOwnPropertyDescriptors(i.prototype);for(const c in l)l[c].writable&&(t.prototype[c]=s[e].prototype[c]);for(const c of a)l[c]||delete t.prototype[c];if(n){const c=new i,h=Object.getOwnPropertyDescriptors(c);for(const d of n){const f=d,p=f.isComponent===!0,m=p?f.activeAndEnabled:!0,v=p?f.context:void 0;try{if(p&&v&&jh(f,v),p&&m&&(f.enabled=!1),d.onBeforeHotReloadFields&&d.onBeforeHotReloadFields()===!1)continue;for(const y in h)if(h[y].writable){if(d[y]===void 0)d[y]=c[y];else if(typeof d[y]=="function"&&!d[y].prototype){const _=d[y],A=_.name,b="bound ";if(A===b)continue;const E=_.name.substring(b.length),C=i.prototype[E];C&&(d[y]=C.bind(d))}}d.onAfterHotReloadFields&&d.onAfterHotReloadFields()}finally{p&&v&&TD(f,v),p&&m&&(f.enabled=!0)}}}}catch(t){if(Ow)console.error(t);else return!1}finally{F0=!1,Ec(os.Log,"Script changes applied (HMR)")}return!0}let Ue;const U0=new Array(128).fill(void 0);U0.push(void 0,null,!0,!1);U0.length;let Jx=null;function IN(){return Jx!==null&&Jx.byteLength!==0||(Jx=new Int32Array(Ue.memory.buffer)),Jx}const Nfe=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Nfe.decode();function xt(s,e){if(!(s instanceof e))throw new Error(`expected instance of ${e.name}`);return s.ptr}let Zx=null;function zfe(){return Zx!==null&&Zx.byteLength!==0||(Zx=new Float32Array(Ue.memory.buffer)),Zx}let FA=128;function RN(s){if(FA==1)throw new Error("out of js stack");return U0[--FA]=s,FA}let $x=null;function Gfe(){return $x!==null&&$x.byteLength!==0||($x=new Uint32Array(Ue.memory.buffer)),$x}let ra=0;function Pf(s,e){const t=e(4*s.length,4)>>>0;return zfe().set(s,t/4),ra=s.length,t}function ew(s,e){const t=e(4*s.length,4)>>>0;return Gfe().set(s,t/4),ra=s.length,t}const hr=Object.freeze({Ball:0,0:"Ball",Cuboid:1,1:"Cuboid",Capsule:2,2:"Capsule",Segment:3,3:"Segment",Polyline:4,4:"Polyline",Triangle:5,5:"Triangle",TriMesh:6,6:"TriMesh",HeightField:7,7:"HeightField",Compound:8,8:"Compound",ConvexPolyhedron:9,9:"ConvexPolyhedron",Cylinder:10,10:"Cylinder",Cone:11,11:"Cone",RoundCuboid:12,12:"RoundCuboid",RoundTriangle:13,13:"RoundTriangle",RoundCylinder:14,14:"RoundCylinder",RoundCone:15,15:"RoundCone",RoundConvexPolyhedron:16,16:"RoundConvexPolyhedron",HalfSpace:17,17:"HalfSpace"});class Hfe{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_raweventqueue_free(e)}constructor(e){const t=Ue.raweventqueue_new(e);return this.__wbg_ptr=t>>>0,this}drainCollisionEvents(e){try{Ue.raweventqueue_drainCollisionEvents(this.__wbg_ptr,RN(e))}finally{U0[FA++]=void 0}}drainContactForceEvents(e){try{Ue.raweventqueue_drainContactForceEvents(this.__wbg_ptr,RN(e))}finally{U0[FA++]=void 0}}clear(){Ue.raweventqueue_clear(this.__wbg_ptr)}}class Vr{static __wrap(e){e>>>=0;const t=Object.create(Vr.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawgenericjoint_free(e)}static generic(e,t,i,n){xt(e,ft),xt(t,ft),xt(i,ft);const r=Ue.rawgenericjoint_generic(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n);return r===0?void 0:Vr.__wrap(r)}static spring(e,t,i,n,r){xt(n,ft),xt(r,ft);const o=Ue.rawgenericjoint_spring(e,t,i,n.__wbg_ptr,r.__wbg_ptr);return Vr.__wrap(o)}static rope(e,t,i){xt(t,ft),xt(i,ft);const n=Ue.rawgenericjoint_rope(e,t.__wbg_ptr,i.__wbg_ptr);return Vr.__wrap(n)}static spherical(e,t){xt(e,ft),xt(t,ft);const i=Ue.rawgenericjoint_spherical(e.__wbg_ptr,t.__wbg_ptr);return Vr.__wrap(i)}static prismatic(e,t,i,n,r,o){xt(e,ft),xt(t,ft),xt(i,ft);const a=Ue.rawgenericjoint_prismatic(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n,r,o);return a===0?void 0:Vr.__wrap(a)}static fixed(e,t,i,n){xt(e,ft),xt(t,gr),xt(i,ft),xt(n,gr);const r=Ue.rawgenericjoint_fixed(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr);return Vr.__wrap(r)}static revolute(e,t,i){xt(e,ft),xt(t,ft),xt(i,ft);const n=Ue.rawgenericjoint_revolute(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr);return n===0?void 0:Vr.__wrap(n)}}class i2{static __wrap(e){e>>>=0;const t=Object.create(i2.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawpointprojection_free(e)}point(){const e=Ue.rawpointprojection_point(this.__wbg_ptr);return ft.__wrap(e)}isInside(){return Ue.rawpointprojection_isInside(this.__wbg_ptr)!==0}}class n2{static __wrap(e){e>>>=0;const t=Object.create(n2.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawrayintersection_free(e)}normal(){const e=Ue.rawraycolliderintersection_normal(this.__wbg_ptr);return ft.__wrap(e)}toi(){return Ue.rawraycolliderintersection_toi(this.__wbg_ptr)}featureType(){return Ue.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const i=Ue.__wbindgen_add_to_stack_pointer(-16);Ue.rawpointcolliderprojection_featureId(i,this.__wbg_ptr);var e=IN()[i/4+0],t=IN()[i/4+1];return e===0?void 0:t>>>0}finally{Ue.__wbindgen_add_to_stack_pointer(16)}}}class gr{static __wrap(e){e>>>=0;const t=Object.create(gr.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawrotation_free(e)}constructor(e,t,i,n){const r=Ue.rawrotation_new(e,t,i,n);return this.__wbg_ptr=r>>>0,this}static identity(){const e=Ue.rawrotation_identity();return gr.__wrap(e)}get x(){return Ue.rawrotation_x(this.__wbg_ptr)}get y(){return Ue.rawintegrationparameters_dt(this.__wbg_ptr)}get z(){return Ue.rawraycolliderintersection_toi(this.__wbg_ptr)}get w(){return Ue.rawintegrationparameters_erp(this.__wbg_ptr)}}class ii{static __wrap(e){e>>>=0;const t=Object.create(ii.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawshape_free(e)}static cuboid(e,t,i){const n=Ue.rawshape_cuboid(e,t,i);return ii.__wrap(n)}static roundCuboid(e,t,i,n){const r=Ue.rawshape_roundCuboid(e,t,i,n);return ii.__wrap(r)}static ball(e){const t=Ue.rawshape_ball(e);return ii.__wrap(t)}static halfspace(e){xt(e,ft);const t=Ue.rawshape_halfspace(e.__wbg_ptr);return ii.__wrap(t)}static capsule(e,t){const i=Ue.rawshape_capsule(e,t);return ii.__wrap(i)}static cylinder(e,t){const i=Ue.rawshape_cylinder(e,t);return ii.__wrap(i)}static roundCylinder(e,t,i){const n=Ue.rawshape_roundCylinder(e,t,i);return ii.__wrap(n)}static cone(e,t){const i=Ue.rawshape_cone(e,t);return ii.__wrap(i)}static roundCone(e,t,i){const n=Ue.rawshape_roundCone(e,t,i);return ii.__wrap(n)}static polyline(e,t){const i=Pf(e,Ue.__wbindgen_malloc),n=ra,r=ew(t,Ue.__wbindgen_malloc),o=ra,a=Ue.rawshape_polyline(i,n,r,o);return ii.__wrap(a)}static trimesh(e,t){const i=Pf(e,Ue.__wbindgen_malloc),n=ra,r=ew(t,Ue.__wbindgen_malloc),o=ra,a=Ue.rawshape_trimesh(i,n,r,o);return ii.__wrap(a)}static heightfield(e,t,i,n){const r=Pf(i,Ue.__wbindgen_malloc),o=ra;xt(n,ft);const a=Ue.rawshape_heightfield(e,t,r,o,n.__wbg_ptr);return ii.__wrap(a)}static segment(e,t){xt(e,ft),xt(t,ft);const i=Ue.rawshape_segment(e.__wbg_ptr,t.__wbg_ptr);return ii.__wrap(i)}static triangle(e,t,i){xt(e,ft),xt(t,ft),xt(i,ft);const n=Ue.rawshape_triangle(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr);return ii.__wrap(n)}static roundTriangle(e,t,i,n){xt(e,ft),xt(t,ft),xt(i,ft);const r=Ue.rawshape_roundTriangle(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n);return ii.__wrap(r)}static convexHull(e){const t=Pf(e,Ue.__wbindgen_malloc),i=ra,n=Ue.rawshape_convexHull(t,i);return n===0?void 0:ii.__wrap(n)}static roundConvexHull(e,t){const i=Pf(e,Ue.__wbindgen_malloc),n=ra,r=Ue.rawshape_roundConvexHull(i,n,t);return r===0?void 0:ii.__wrap(r)}static convexMesh(e,t){const i=Pf(e,Ue.__wbindgen_malloc),n=ra,r=ew(t,Ue.__wbindgen_malloc),o=ra,a=Ue.rawshape_convexMesh(i,n,r,o);return a===0?void 0:ii.__wrap(a)}static roundConvexMesh(e,t,i){const n=Pf(e,Ue.__wbindgen_malloc),r=ra,o=ew(t,Ue.__wbindgen_malloc),a=ra,l=Ue.rawshape_roundConvexMesh(n,r,o,a,i);return l===0?void 0:ii.__wrap(l)}castShape(e,t,i,n,r,o,a,l,c){xt(e,ft),xt(t,gr),xt(i,ft),xt(n,ii),xt(r,ft),xt(o,gr),xt(a,ft);const h=Ue.rawshape_castShape(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr,o.__wbg_ptr,a.__wbg_ptr,l,c);return h===0?void 0:r2.__wrap(h)}intersectsShape(e,t,i,n,r){return xt(e,ft),xt(t,gr),xt(i,ii),xt(n,ft),xt(r,gr),Ue.rawshape_intersectsShape(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr)!==0}contactShape(e,t,i,n,r,o){xt(e,ft),xt(t,gr),xt(i,ii),xt(n,ft),xt(r,gr);const a=Ue.rawshape_contactShape(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr,o);return a===0?void 0:s2.__wrap(a)}containsPoint(e,t,i){return xt(e,ft),xt(t,gr),xt(i,ft),Ue.rawshape_containsPoint(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr)!==0}projectPoint(e,t,i,n){xt(e,ft),xt(t,gr),xt(i,ft);const r=Ue.rawshape_projectPoint(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n);return i2.__wrap(r)}intersectsRay(e,t,i,n,r){return xt(e,ft),xt(t,gr),xt(i,ft),xt(n,ft),Ue.rawshape_intersectsRay(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r)!==0}castRay(e,t,i,n,r,o){return xt(e,ft),xt(t,gr),xt(i,ft),xt(n,ft),Ue.rawshape_castRay(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r,o)}castRayAndGetNormal(e,t,i,n,r,o){xt(e,ft),xt(t,gr),xt(i,ft),xt(n,ft);const a=Ue.rawshape_castRayAndGetNormal(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r,o);return a===0?void 0:n2.__wrap(a)}}class s2{static __wrap(e){e>>>=0;const t=Object.create(s2.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawshapecontact_free(e)}distance(){return Ue.rawkinematiccharactercontroller_maxSlopeClimbAngle(this.__wbg_ptr)}point1(){const e=Ue.rawpointprojection_point(this.__wbg_ptr);return ft.__wrap(e)}point2(){const e=Ue.rawraycolliderintersection_normal(this.__wbg_ptr);return ft.__wrap(e)}normal1(){const e=Ue.rawshapecollidertoi_witness2(this.__wbg_ptr);return ft.__wrap(e)}normal2(){const e=Ue.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return ft.__wrap(e)}}class r2{static __wrap(e){e>>>=0;const t=Object.create(r2.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawshapetoi_free(e)}toi(){return Ue.rawrotation_x(this.__wbg_ptr)}witness1(){const e=Ue.rawshapetoi_witness1(this.__wbg_ptr);return ft.__wrap(e)}witness2(){const e=Ue.rawcontactforceevent_total_force(this.__wbg_ptr);return ft.__wrap(e)}normal1(){const e=Ue.rawshapetoi_normal1(this.__wbg_ptr);return ft.__wrap(e)}normal2(){const e=Ue.rawshapetoi_normal2(this.__wbg_ptr);return ft.__wrap(e)}}class ft{static __wrap(e){e>>>=0;const t=Object.create(ft.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawvector_free(e)}static zero(){const e=Ue.rawvector_zero();return ft.__wrap(e)}constructor(e,t,i){const n=Ue.rawvector_new(e,t,i);return this.__wbg_ptr=n>>>0,this}get x(){return Ue.rawrotation_x(this.__wbg_ptr)}set x(e){Ue.rawvector_set_x(this.__wbg_ptr,e)}get y(){return Ue.rawintegrationparameters_dt(this.__wbg_ptr)}set y(e){Ue.rawintegrationparameters_set_dt(this.__wbg_ptr,e)}get z(){return Ue.rawraycolliderintersection_toi(this.__wbg_ptr)}set z(e){Ue.rawvector_set_z(this.__wbg_ptr,e)}xyz(){const e=Ue.rawvector_xyz(this.__wbg_ptr);return ft.__wrap(e)}yxz(){const e=Ue.rawvector_yxz(this.__wbg_ptr);return ft.__wrap(e)}zxy(){const e=Ue.rawvector_zxy(this.__wbg_ptr);return ft.__wrap(e)}xzy(){const e=Ue.rawvector_xzy(this.__wbg_ptr);return ft.__wrap(e)}yzx(){const e=Ue.rawvector_yzx(this.__wbg_ptr);return ft.__wrap(e)}zyx(){const e=Ue.rawvector_zyx(this.__wbg_ptr);return ft.__wrap(e)}}class Vfe{constructor(e,t,i){this.x=e,this.y=t,this.z=i}}class Ie{static new(e,t,i){return new Vfe(e,t,i)}static intoRaw(e){return new ft(e.x,e.y,e.z)}static zeros(){return Ie.new(0,0,0)}static fromRaw(e){if(!e)return null;let t=Ie.new(e.x,e.y,e.z);return e.free(),t}static copy(e,t){e.x=t.x,e.y=t.y,e.z=t.z}}class PN{constructor(e,t,i,n){this.x=e,this.y=t,this.z=i,this.w=n}}class an{static identity(){return new PN(0,0,0,1)}static fromRaw(e){if(!e)return null;let t=new PN(e.x,e.y,e.z,e.w);return e.free(),t}static intoRaw(e){return new gr(e.x,e.y,e.z,e.w)}static copy(e,t){e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w}}class Qfe{constructor(e){this.elements=e}get m11(){return this.elements[0]}get m12(){return this.elements[1]}get m21(){return this.m12}get m13(){return this.elements[2]}get m31(){return this.m13}get m22(){return this.elements[3]}get m23(){return this.elements[4]}get m32(){return this.m23}get m33(){return this.elements[5]}}class BN{static fromRaw(e){const t=new Qfe(e.elements());return e.free(),t}}var UA,Ur,DN,ON,fs,_P,as,LN,WS,bP,kN,qS,Ag;(function(s){s[s.Dynamic=0]="Dynamic",s[s.Fixed=1]="Fixed",s[s.KinematicPositionBased=2]="KinematicPositionBased",s[s.KinematicVelocityBased=3]="KinematicVelocityBased"})(UA||(UA={}));class FN{constructor(e,t,i){this.rawSet=e,this.colliderSet=t,this.handle=i}finalizeDeserialization(e){this.colliderSet=e}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(e,t){return this.rawSet.rbLockTranslations(this.handle,e,t)}lockRotations(e,t){return this.rawSet.rbLockRotations(this.handle,e,t)}setEnabledTranslations(e,t,i,n){return this.rawSet.rbSetEnabledTranslations(this.handle,e,t,i,n)}restrictTranslations(e,t,i,n){this.setEnabledTranslations(e,t,i,n)}setEnabledRotations(e,t,i,n){return this.rawSet.rbSetEnabledRotations(this.handle,e,t,i,n)}restrictRotations(e,t,i,n){this.setEnabledRotations(e,t,i,n)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(e){this.rawSet.rbSetDominanceGroup(this.handle,e)}additionalSolverIterations(){return this.rawSet.rbAdditionalSolverIterations(this.handle)}setAdditionalSolverIterations(e){this.rawSet.rbSetAdditionalSolverIterations(this.handle,e)}enableCcd(e){this.rawSet.rbEnableCcd(this.handle,e)}translation(){let e=this.rawSet.rbTranslation(this.handle);return Ie.fromRaw(e)}rotation(){let e=this.rawSet.rbRotation(this.handle);return an.fromRaw(e)}nextTranslation(){let e=this.rawSet.rbNextTranslation(this.handle);return Ie.fromRaw(e)}nextRotation(){let e=this.rawSet.rbNextRotation(this.handle);return an.fromRaw(e)}setTranslation(e,t){this.rawSet.rbSetTranslation(this.handle,e.x,e.y,e.z,t)}setLinvel(e,t){let i=Ie.intoRaw(e);this.rawSet.rbSetLinvel(this.handle,i,t),i.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(e,t){this.rawSet.rbSetGravityScale(this.handle,e,t)}setRotation(e,t){this.rawSet.rbSetRotation(this.handle,e.x,e.y,e.z,e.w,t)}setAngvel(e,t){let i=Ie.intoRaw(e);this.rawSet.rbSetAngvel(this.handle,i,t),i.free()}setNextKinematicTranslation(e){this.rawSet.rbSetNextKinematicTranslation(this.handle,e.x,e.y,e.z)}setNextKinematicRotation(e){this.rawSet.rbSetNextKinematicRotation(this.handle,e.x,e.y,e.z,e.w)}linvel(){return Ie.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return Ie.fromRaw(this.rawSet.rbAngvel(this.handle))}mass(){return this.rawSet.rbMass(this.handle)}effectiveInvMass(){return Ie.fromRaw(this.rawSet.rbEffectiveInvMass(this.handle))}invMass(){return this.rawSet.rbInvMass(this.handle)}localCom(){return Ie.fromRaw(this.rawSet.rbLocalCom(this.handle))}worldCom(){return Ie.fromRaw(this.rawSet.rbWorldCom(this.handle))}invPrincipalInertiaSqrt(){return Ie.fromRaw(this.rawSet.rbInvPrincipalInertiaSqrt(this.handle))}principalInertia(){return Ie.fromRaw(this.rawSet.rbPrincipalInertia(this.handle))}principalInertiaLocalFrame(){return an.fromRaw(this.rawSet.rbPrincipalInertiaLocalFrame(this.handle))}effectiveWorldInvInertiaSqrt(){return BN.fromRaw(this.rawSet.rbEffectiveWorldInvInertiaSqrt(this.handle))}effectiveAngularInertia(){return BN.fromRaw(this.rawSet.rbEffectiveAngularInertia(this.handle))}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(e){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,e))}setEnabled(e){this.rawSet.rbSetEnabled(this.handle,e)}isEnabled(){return this.rawSet.rbIsEnabled(this.handle)}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(e,t){return this.rawSet.rbSetBodyType(this.handle,e,t)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(e){this.rawSet.rbSetLinearDamping(this.handle,e)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(e,t){this.rawSet.rbSetAdditionalMass(this.handle,e,t)}setAdditionalMassProperties(e,t,i,n,r){let o=Ie.intoRaw(t),a=Ie.intoRaw(i),l=an.intoRaw(n);this.rawSet.rbSetAdditionalMassProperties(this.handle,e,o,a,l,r),o.free(),a.free(),l.free()}setAngularDamping(e){this.rawSet.rbSetAngularDamping(this.handle,e)}resetForces(e){this.rawSet.rbResetForces(this.handle,e)}resetTorques(e){this.rawSet.rbResetTorques(this.handle,e)}addForce(e,t){const i=Ie.intoRaw(e);this.rawSet.rbAddForce(this.handle,i,t),i.free()}applyImpulse(e,t){const i=Ie.intoRaw(e);this.rawSet.rbApplyImpulse(this.handle,i,t),i.free()}addTorque(e,t){const i=Ie.intoRaw(e);this.rawSet.rbAddTorque(this.handle,i,t),i.free()}applyTorqueImpulse(e,t){const i=Ie.intoRaw(e);this.rawSet.rbApplyTorqueImpulse(this.handle,i,t),i.free()}addForceAtPoint(e,t,i){const n=Ie.intoRaw(e),r=Ie.intoRaw(t);this.rawSet.rbAddForceAtPoint(this.handle,n,r,i),n.free(),r.free()}applyImpulseAtPoint(e,t,i){const n=Ie.intoRaw(e),r=Ie.intoRaw(t);this.rawSet.rbApplyImpulseAtPoint(this.handle,n,r,i),n.free(),r.free()}}(function(s){s[s.Revolute=0]="Revolute",s[s.Fixed=1]="Fixed",s[s.Prismatic=2]="Prismatic",s[s.Rope=3]="Rope",s[s.Spring=4]="Spring",s[s.Spherical=5]="Spherical",s[s.Generic=6]="Generic"})(Ur||(Ur={})),function(s){s[s.AccelerationBased=0]="AccelerationBased",s[s.ForceBased=1]="ForceBased"}(DN||(DN={})),function(s){s[s.X=1]="X",s[s.Y=2]="Y",s[s.Z=4]="Z",s[s.AngX=8]="AngX",s[s.AngY=16]="AngY",s[s.AngZ=32]="AngZ"}(ON||(ON={}));class Dh{constructor(){}static fixed(e,t,i,n){let r=new Dh;return r.anchor1=e,r.anchor2=i,r.frame1=t,r.frame2=n,r.jointType=Ur.Fixed,r}static spring(e,t,i,n,r){let o=new Dh;return o.anchor1=n,o.anchor2=r,o.length=e,o.stiffness=t,o.damping=i,o.jointType=Ur.Spring,o}static rope(e,t,i){let n=new Dh;return n.anchor1=t,n.anchor2=i,n.length=e,n.jointType=Ur.Rope,n}static generic(e,t,i,n){let r=new Dh;return r.anchor1=e,r.anchor2=t,r.axis=i,r.axesMask=n,r.jointType=Ur.Generic,r}static spherical(e,t){let i=new Dh;return i.anchor1=e,i.anchor2=t,i.jointType=Ur.Spherical,i}static prismatic(e,t,i){let n=new Dh;return n.anchor1=e,n.anchor2=t,n.axis=i,n.jointType=Ur.Prismatic,n}static revolute(e,t,i){let n=new Dh;return n.anchor1=e,n.anchor2=t,n.axis=i,n.jointType=Ur.Revolute,n}intoRaw(){let e,t,i=Ie.intoRaw(this.anchor1),n=Ie.intoRaw(this.anchor2),r=!1,o=0,a=0;switch(this.jointType){case Ur.Fixed:let l=an.intoRaw(this.frame1),c=an.intoRaw(this.frame2);t=Vr.fixed(i,l,n,c),l.free(),c.free();break;case Ur.Spring:t=Vr.spring(this.length,this.stiffness,this.damping,i,n);break;case Ur.Rope:t=Vr.rope(this.length,i,n);break;case Ur.Prismatic:e=Ie.intoRaw(this.axis),this.limitsEnabled&&(r=!0,o=this.limits[0],a=this.limits[1]),t=Vr.prismatic(i,n,e,r,o,a),e.free();break;case Ur.Generic:e=Ie.intoRaw(this.axis);let h=this.axesMask;t=Vr.generic(i,n,e,h);break;case Ur.Spherical:t=Vr.spherical(i,n);break;case Ur.Revolute:e=Ie.intoRaw(this.axis),t=Vr.revolute(i,n,e),e.free()}return i.free(),n.free(),t}}(function(s){s[s.Average=0]="Average",s[s.Min=1]="Min",s[s.Multiply=2]="Multiply",s[s.Max=3]="Max"})(fs||(fs={}));class N0{constructor(e,t,i,n,r){this.distance=e,this.point1=t,this.point2=i,this.normal1=n,this.normal2=r}static fromRaw(e){if(!e)return null;const t=new N0(e.distance(),Ie.fromRaw(e.point1()),Ie.fromRaw(e.point2()),Ie.fromRaw(e.normal1()),Ie.fromRaw(e.normal2()));return e.free(),t}}(function(s){s[s.Vertex=0]="Vertex",s[s.Edge=1]="Edge",s[s.Face=2]="Face",s[s.Unknown=3]="Unknown"})(_P||(_P={}));class l1{constructor(e,t){this.point=e,this.isInside=t}static fromRaw(e){if(!e)return null;const t=new l1(Ie.fromRaw(e.point()),e.isInside());return e.free(),t}}class jfe{constructor(e,t){this.origin=e,this.dir=t}pointAt(e){return{x:this.origin.x+this.dir.x*e,y:this.origin.y+this.dir.y*e,z:this.origin.z+this.dir.z*e}}}class c1{constructor(e,t,i,n){this.featureType=_P.Unknown,this.featureId=void 0,this.toi=e,this.normal=t,n!==void 0&&(this.featureId=n),i!==void 0&&(this.featureType=i)}static fromRaw(e){if(!e)return null;const t=new c1(e.toi(),Ie.fromRaw(e.normal()),e.featureType(),e.featureId());return e.free(),t}}class sb{constructor(e,t,i,n,r){this.toi=e,this.witness1=t,this.witness2=i,this.normal1=n,this.normal2=r}static fromRaw(e,t){if(!t)return null;const i=new sb(t.toi(),Ie.fromRaw(t.witness1()),Ie.fromRaw(t.witness2()),Ie.fromRaw(t.normal1()),Ie.fromRaw(t.normal2()));return t.free(),i}}class o2 extends sb{constructor(e,t,i,n,r,o){super(t,i,n,r,o),this.collider=e}static fromRaw(e,t){if(!t)return null;const i=new o2(e.get(t.colliderHandle()),t.toi(),Ie.fromRaw(t.witness1()),Ie.fromRaw(t.witness2()),Ie.fromRaw(t.normal1()),Ie.fromRaw(t.normal2()));return t.free(),i}}class nr{static fromRaw(e,t){const i=e.coShapeType(t);let n,r,o,a,l,c,h;switch(i){case hr.Ball:return new a2(e.coRadius(t));case hr.Cuboid:return n=e.coHalfExtents(t),new G8(n.x,n.y,n.z);case hr.RoundCuboid:return n=e.coHalfExtents(t),r=e.coRoundRadius(t),new H8(n.x,n.y,n.z,r);case hr.Capsule:return l=e.coHalfHeight(t),c=e.coRadius(t),new V8(l,c);case hr.Segment:return o=e.coVertices(t),new Q8(Ie.new(o[0],o[1],o[2]),Ie.new(o[3],o[4],o[5]));case hr.Polyline:return o=e.coVertices(t),a=e.coIndices(t),new q8(o,a);case hr.Triangle:return o=e.coVertices(t),new j8(Ie.new(o[0],o[1],o[2]),Ie.new(o[3],o[4],o[5]),Ie.new(o[6],o[7],o[8]));case hr.RoundTriangle:return o=e.coVertices(t),r=e.coRoundRadius(t),new W8(Ie.new(o[0],o[1],o[2]),Ie.new(o[3],o[4],o[5]),Ie.new(o[6],o[7],o[8]),r);case hr.HalfSpace:return h=Ie.fromRaw(e.coHalfspaceNormal(t)),new Wfe(h);case hr.TriMesh:return o=e.coVertices(t),a=e.coIndices(t),new X8(o,a);case hr.HeightField:const d=e.coHeightfieldScale(t),f=e.coHeightfieldHeights(t),p=e.coHeightfieldNRows(t),m=e.coHeightfieldNCols(t);return new Y8(p,m,f,d);case hr.ConvexPolyhedron:return o=e.coVertices(t),a=e.coIndices(t),new xP(o,a);case hr.RoundConvexPolyhedron:return o=e.coVertices(t),a=e.coIndices(t),r=e.coRoundRadius(t),new wP(o,a,r);case hr.Cylinder:return l=e.coHalfHeight(t),c=e.coRadius(t),new K8(l,c);case hr.RoundCylinder:return l=e.coHalfHeight(t),c=e.coRadius(t),r=e.coRoundRadius(t),new J8(l,c,r);case hr.Cone:return l=e.coHalfHeight(t),c=e.coRadius(t),new Z8(l,c);case hr.RoundCone:return l=e.coHalfHeight(t),c=e.coRadius(t),r=e.coRoundRadius(t),new $8(l,c,r);default:throw new Error("unknown shape type: "+i)}}castShape(e,t,i,n,r,o,a,l,c){let h=Ie.intoRaw(e),d=an.intoRaw(t),f=Ie.intoRaw(i),p=Ie.intoRaw(r),m=an.intoRaw(o),v=Ie.intoRaw(a),y=this.intoRaw(),g=n.intoRaw(),_=sb.fromRaw(null,y.castShape(h,d,f,g,p,m,v,l,c));return h.free(),d.free(),f.free(),p.free(),m.free(),v.free(),y.free(),g.free(),_}intersectsShape(e,t,i,n,r){let o=Ie.intoRaw(e),a=an.intoRaw(t),l=Ie.intoRaw(n),c=an.intoRaw(r),h=this.intoRaw(),d=i.intoRaw(),f=h.intersectsShape(o,a,d,l,c);return o.free(),a.free(),l.free(),c.free(),h.free(),d.free(),f}contactShape(e,t,i,n,r,o){let a=Ie.intoRaw(e),l=an.intoRaw(t),c=Ie.intoRaw(n),h=an.intoRaw(r),d=this.intoRaw(),f=i.intoRaw(),p=N0.fromRaw(d.contactShape(a,l,f,c,h,o));return a.free(),l.free(),c.free(),h.free(),d.free(),f.free(),p}containsPoint(e,t,i){let n=Ie.intoRaw(e),r=an.intoRaw(t),o=Ie.intoRaw(i),a=this.intoRaw(),l=a.containsPoint(n,r,o);return n.free(),r.free(),o.free(),a.free(),l}projectPoint(e,t,i,n){let r=Ie.intoRaw(e),o=an.intoRaw(t),a=Ie.intoRaw(i),l=this.intoRaw(),c=l1.fromRaw(l.projectPoint(r,o,a,n));return r.free(),o.free(),a.free(),l.free(),c}intersectsRay(e,t,i,n){let r=Ie.intoRaw(t),o=an.intoRaw(i),a=Ie.intoRaw(e.origin),l=Ie.intoRaw(e.dir),c=this.intoRaw(),h=c.intersectsRay(r,o,a,l,n);return r.free(),o.free(),a.free(),l.free(),c.free(),h}castRay(e,t,i,n,r){let o=Ie.intoRaw(t),a=an.intoRaw(i),l=Ie.intoRaw(e.origin),c=Ie.intoRaw(e.dir),h=this.intoRaw(),d=h.castRay(o,a,l,c,n,r);return o.free(),a.free(),l.free(),c.free(),h.free(),d}castRayAndGetNormal(e,t,i,n,r){let o=Ie.intoRaw(t),a=an.intoRaw(i),l=Ie.intoRaw(e.origin),c=Ie.intoRaw(e.dir),h=this.intoRaw(),d=c1.fromRaw(h.castRayAndGetNormal(o,a,l,c,n,r));return o.free(),a.free(),l.free(),c.free(),h.free(),d}}(function(s){s[s.Ball=0]="Ball",s[s.Cuboid=1]="Cuboid",s[s.Capsule=2]="Capsule",s[s.Segment=3]="Segment",s[s.Polyline=4]="Polyline",s[s.Triangle=5]="Triangle",s[s.TriMesh=6]="TriMesh",s[s.HeightField=7]="HeightField",s[s.ConvexPolyhedron=9]="ConvexPolyhedron",s[s.Cylinder=10]="Cylinder",s[s.Cone=11]="Cone",s[s.RoundCuboid=12]="RoundCuboid",s[s.RoundTriangle=13]="RoundTriangle",s[s.RoundCylinder=14]="RoundCylinder",s[s.RoundCone=15]="RoundCone",s[s.RoundConvexPolyhedron=16]="RoundConvexPolyhedron",s[s.HalfSpace=17]="HalfSpace"})(as||(as={}));class a2 extends nr{constructor(e){super(),this.type=as.Ball,this.radius=e}intoRaw(){return ii.ball(this.radius)}}class Wfe extends nr{constructor(e){super(),this.type=as.HalfSpace,this.normal=e}intoRaw(){let e=Ie.intoRaw(this.normal),t=ii.halfspace(e);return e.free(),t}}class G8 extends nr{constructor(e,t,i){super(),this.type=as.Cuboid,this.halfExtents=Ie.new(e,t,i)}intoRaw(){return ii.cuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z)}}class H8 extends nr{constructor(e,t,i,n){super(),this.type=as.RoundCuboid,this.halfExtents=Ie.new(e,t,i),this.borderRadius=n}intoRaw(){return ii.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z,this.borderRadius)}}class V8 extends nr{constructor(e,t){super(),this.type=as.Capsule,this.halfHeight=e,this.radius=t}intoRaw(){return ii.capsule(this.halfHeight,this.radius)}}class Q8 extends nr{constructor(e,t){super(),this.type=as.Segment,this.a=e,this.b=t}intoRaw(){let e=Ie.intoRaw(this.a),t=Ie.intoRaw(this.b),i=ii.segment(e,t);return e.free(),t.free(),i}}class j8 extends nr{constructor(e,t,i){super(),this.type=as.Triangle,this.a=e,this.b=t,this.c=i}intoRaw(){let e=Ie.intoRaw(this.a),t=Ie.intoRaw(this.b),i=Ie.intoRaw(this.c),n=ii.triangle(e,t,i);return e.free(),t.free(),i.free(),n}}class W8 extends nr{constructor(e,t,i,n){super(),this.type=as.RoundTriangle,this.a=e,this.b=t,this.c=i,this.borderRadius=n}intoRaw(){let e=Ie.intoRaw(this.a),t=Ie.intoRaw(this.b),i=Ie.intoRaw(this.c),n=ii.roundTriangle(e,t,i,this.borderRadius);return e.free(),t.free(),i.free(),n}}class q8 extends nr{constructor(e,t){super(),this.type=as.Polyline,this.vertices=e,this.indices=t??new Uint32Array(0)}intoRaw(){return ii.polyline(this.vertices,this.indices)}}class X8 extends nr{constructor(e,t){super(),this.type=as.TriMesh,this.vertices=e,this.indices=t}intoRaw(){return ii.trimesh(this.vertices,this.indices)}}class xP extends nr{constructor(e,t){super(),this.type=as.ConvexPolyhedron,this.vertices=e,this.indices=t}intoRaw(){return this.indices?ii.convexMesh(this.vertices,this.indices):ii.convexHull(this.vertices)}}class wP extends nr{constructor(e,t,i){super(),this.type=as.RoundConvexPolyhedron,this.vertices=e,this.indices=t,this.borderRadius=i}intoRaw(){return this.indices?ii.roundConvexMesh(this.vertices,this.indices,this.borderRadius):ii.roundConvexHull(this.vertices,this.borderRadius)}}class Y8 extends nr{constructor(e,t,i,n){super(),this.type=as.HeightField,this.nrows=e,this.ncols=t,this.heights=i,this.scale=n}intoRaw(){let e=Ie.intoRaw(this.scale),t=ii.heightfield(this.nrows,this.ncols,this.heights,e);return e.free(),t}}class K8 extends nr{constructor(e,t){super(),this.type=as.Cylinder,this.halfHeight=e,this.radius=t}intoRaw(){return ii.cylinder(this.halfHeight,this.radius)}}class J8 extends nr{constructor(e,t,i){super(),this.type=as.RoundCylinder,this.borderRadius=i,this.halfHeight=e,this.radius=t}intoRaw(){return ii.roundCylinder(this.halfHeight,this.radius,this.borderRadius)}}class Z8 extends nr{constructor(e,t){super(),this.type=as.Cone,this.halfHeight=e,this.radius=t}intoRaw(){return ii.cone(this.halfHeight,this.radius)}}class $8 extends nr{constructor(e,t,i){super(),this.type=as.RoundCone,this.halfHeight=e,this.radius=t,this.borderRadius=i}intoRaw(){return ii.roundCone(this.halfHeight,this.radius,this.borderRadius)}}(function(s){s[s.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",s[s.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",s[s.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",s[s.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",s[s.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",s[s.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",s[s.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",s[s.ONLY_FIXED=6]="ONLY_FIXED"})(LN||(LN={}));(function(s){s[s.NONE=0]="NONE",s[s.COLLISION_EVENTS=1]="COLLISION_EVENTS",s[s.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"})(WS||(WS={}));class qfe{free(){this.raw&&this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return Ie.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return Ie.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class Xfe{constructor(e,t){this.raw=t||new Hfe(e)}free(){this.raw&&this.raw.free(),this.raw=void 0}drainCollisionEvents(e){this.raw.drainCollisionEvents(e)}drainContactForceEvents(e){let t=new qfe;this.raw.drainContactForceEvents(i=>{t.raw=i,e(t),t.free()})}clear(){this.raw.clear()}}(function(s){s[s.NONE=0]="NONE",s[s.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",s[s.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(bP||(bP={})),function(s){s[s.EMPTY=0]="EMPTY",s[s.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"}(kN||(kN={})),function(s){s[s.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",s[s.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",s[s.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",s[s.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",s[s.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",s[s.FIXED_FIXED=32]="FIXED_FIXED",s[s.DEFAULT=15]="DEFAULT",s[s.ALL=60943]="ALL"}(qS||(qS={}));class UN{constructor(e,t,i,n){this.colliderSet=e,this.handle=t,this._parent=i,this._shape=n}finalizeDeserialization(e){this.handle!=null&&(this._parent=e.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=nr.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return Ie.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return an.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(e){this.colliderSet.raw.coSetSensor(this.handle,e)}setShape(e){let t=e.intoRaw();this.colliderSet.raw.coSetShape(this.handle,t),t.free(),this._shape=e}setEnabled(e){this.colliderSet.raw.coSetEnabled(this.handle,e)}isEnabled(){return this.colliderSet.raw.coIsEnabled(this.handle)}setRestitution(e){this.colliderSet.raw.coSetRestitution(this.handle,e)}setFriction(e){this.colliderSet.raw.coSetFriction(this.handle,e)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(e){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,e)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(e){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,e)}setCollisionGroups(e){this.colliderSet.raw.coSetCollisionGroups(this.handle,e)}setSolverGroups(e){this.colliderSet.raw.coSetSolverGroups(this.handle,e)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(e){this.colliderSet.raw.coSetActiveHooks(this.handle,e)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(e){this.colliderSet.raw.coSetActiveEvents(this.handle,e)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(e){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,e)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(e){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,e)}setDensity(e){this.colliderSet.raw.coSetDensity(this.handle,e)}setMass(e){this.colliderSet.raw.coSetMass(this.handle,e)}setMassProperties(e,t,i,n){let r=Ie.intoRaw(t),o=Ie.intoRaw(i),a=an.intoRaw(n);this.colliderSet.raw.coSetMassProperties(this.handle,e,r,o,a),r.free(),o.free(),a.free()}setTranslation(e){this.colliderSet.raw.coSetTranslation(this.handle,e.x,e.y,e.z)}setTranslationWrtParent(e){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,e.x,e.y,e.z)}setRotation(e){this.colliderSet.raw.coSetRotation(this.handle,e.x,e.y,e.z,e.w)}setRotationWrtParent(e){this.colliderSet.raw.coSetRotationWrtParent(this.handle,e.x,e.y,e.z,e.w)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return Ie.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}setHalfExtents(e){const t=Ie.intoRaw(e);this.colliderSet.raw.coSetHalfExtents(this.handle,t)}radius(){return this.colliderSet.raw.coRadius(this.handle)}setRadius(e){this.colliderSet.raw.coSetRadius(this.handle,e)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}setRoundRadius(e){this.colliderSet.raw.coSetRoundRadius(this.handle,e)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}setHalfHeight(e){this.colliderSet.raw.coSetHalfHeight(this.handle,e)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let e=this.colliderSet.raw.coHeightfieldScale(this.handle);return Ie.fromRaw(e)}heightfieldNRows(){return this.colliderSet.raw.coHeightfieldNRows(this.handle)}heightfieldNCols(){return this.colliderSet.raw.coHeightfieldNCols(this.handle)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(e){let t=Ie.intoRaw(e),i=this.colliderSet.raw.coContainsPoint(this.handle,t);return t.free(),i}projectPoint(e,t){let i=Ie.intoRaw(e),n=l1.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,i,t));return i.free(),n}intersectsRay(e,t){let i=Ie.intoRaw(e.origin),n=Ie.intoRaw(e.dir),r=this.colliderSet.raw.coIntersectsRay(this.handle,i,n,t);return i.free(),n.free(),r}castShape(e,t,i,n,r,o,a){let l=Ie.intoRaw(e),c=Ie.intoRaw(i),h=an.intoRaw(n),d=Ie.intoRaw(r),f=t.intoRaw(),p=sb.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,l,f,c,h,d,o,a));return l.free(),c.free(),h.free(),d.free(),f.free(),p}castCollider(e,t,i,n,r){let o=Ie.intoRaw(e),a=Ie.intoRaw(i),l=o2.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,o,t.handle,a,n,r));return o.free(),a.free(),l}intersectsShape(e,t,i){let n=Ie.intoRaw(t),r=an.intoRaw(i),o=e.intoRaw(),a=this.colliderSet.raw.coIntersectsShape(this.handle,o,n,r);return n.free(),r.free(),o.free(),a}contactShape(e,t,i,n){let r=Ie.intoRaw(t),o=an.intoRaw(i),a=e.intoRaw(),l=N0.fromRaw(this.colliderSet.raw.coContactShape(this.handle,a,r,o,n));return r.free(),o.free(),a.free(),l}contactCollider(e,t){return N0.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,e.handle,t))}castRay(e,t,i){let n=Ie.intoRaw(e.origin),r=Ie.intoRaw(e.dir),o=this.colliderSet.raw.coCastRay(this.handle,n,r,t,i);return n.free(),r.free(),o}castRayAndGetNormal(e,t,i){let n=Ie.intoRaw(e.origin),r=Ie.intoRaw(e.dir),o=c1.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,n,r,t,i));return n.free(),r.free(),o}}(function(s){s[s.Density=0]="Density",s[s.Mass=1]="Mass",s[s.MassProps=2]="MassProps"})(Ag||(Ag={}));class In{constructor(e){this.enabled=!0,this.shape=e,this.massPropsMode=Ag.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=an.identity(),this.translation=Ie.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=fs.Average,this.restitutionCombineRule=fs.Average,this.activeCollisionTypes=qS.DEFAULT,this.activeEvents=WS.NONE,this.activeHooks=bP.NONE,this.mass=0,this.centerOfMass=Ie.zeros(),this.contactForceEventThreshold=0,this.principalAngularInertia=Ie.zeros(),this.angularInertiaLocalFrame=an.identity()}static ball(e){const t=new a2(e);return new In(t)}static capsule(e,t){const i=new V8(e,t);return new In(i)}static segment(e,t){const i=new Q8(e,t);return new In(i)}static triangle(e,t,i){const n=new j8(e,t,i);return new In(n)}static roundTriangle(e,t,i,n){const r=new W8(e,t,i,n);return new In(r)}static polyline(e,t){const i=new q8(e,t);return new In(i)}static trimesh(e,t){const i=new X8(e,t);return new In(i)}static cuboid(e,t,i){const n=new G8(e,t,i);return new In(n)}static roundCuboid(e,t,i,n){const r=new H8(e,t,i,n);return new In(r)}static heightfield(e,t,i,n){const r=new Y8(e,t,i,n);return new In(r)}static cylinder(e,t){const i=new K8(e,t);return new In(i)}static roundCylinder(e,t,i){const n=new J8(e,t,i);return new In(n)}static cone(e,t){const i=new Z8(e,t);return new In(i)}static roundCone(e,t,i){const n=new $8(e,t,i);return new In(n)}static convexHull(e){const t=new xP(e,null);return new In(t)}static convexMesh(e,t){const i=new xP(e,t);return new In(i)}static roundConvexHull(e,t){const i=new wP(e,null,t);return new In(i)}static roundConvexMesh(e,t,i){const n=new wP(e,t,i);return new In(n)}setTranslation(e,t,i){if(typeof e!="number"||typeof t!="number"||typeof i!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:e,y:t,z:i},this}setRotation(e){return an.copy(this.rotation,e),this}setSensor(e){return this.isSensor=e,this}setEnabled(e){return this.enabled=e,this}setDensity(e){return this.massPropsMode=Ag.Density,this.density=e,this}setMass(e){return this.massPropsMode=Ag.Mass,this.mass=e,this}setMassProperties(e,t,i,n){return this.massPropsMode=Ag.MassProps,this.mass=e,Ie.copy(this.centerOfMass,t),Ie.copy(this.principalAngularInertia,i),an.copy(this.angularInertiaLocalFrame,n),this}setRestitution(e){return this.restitution=e,this}setFriction(e){return this.friction=e,this}setFrictionCombineRule(e){return this.frictionCombineRule=e,this}setRestitutionCombineRule(e){return this.restitutionCombineRule=e,this}setCollisionGroups(e){return this.collisionGroups=e,this}setSolverGroups(e){return this.solverGroups=e,this}setActiveHooks(e){return this.activeHooks=e,this}setActiveEvents(e){return this.activeEvents=e,this}setActiveCollisionTypes(e){return this.activeCollisionTypes=e,this}setContactForceEventThreshold(e){return this.contactForceEventThreshold=e,this}}for(var pme={byteLength:function(s){var e=NN(s),t=e[0],i=e[1];return 3*(t+i)/4-i},toByteArray:function(s){var e,t,i=NN(s),n=i[0],r=i[1],o=new Yfe(function(c,h,d){return 3*(h+d)/4-d}(0,n,r)),a=0,l=r>0?n-4:n;for(t=0;t<l;t+=4)e=Oa[s.charCodeAt(t)]<<18|Oa[s.charCodeAt(t+1)]<<12|Oa[s.charCodeAt(t+2)]<<6|Oa[s.charCodeAt(t+3)],o[a++]=e>>16&255,o[a++]=e>>8&255,o[a++]=255&e;return r===2&&(e=Oa[s.charCodeAt(t)]<<2|Oa[s.charCodeAt(t+1)]>>4,o[a++]=255&e),r===1&&(e=Oa[s.charCodeAt(t)]<<10|Oa[s.charCodeAt(t+1)]<<4|Oa[s.charCodeAt(t+2)]>>2,o[a++]=e>>8&255,o[a++]=255&e),o},fromByteArray:function(s){for(var e,t=s.length,i=t%3,n=[],r=16383,o=0,a=t-i;o<a;o+=r)n.push(Jfe(s,o,o+r>a?a:o+r));return i===1?(e=s[t-1],n.push(Ac[e>>2]+Ac[e<<4&63]+"==")):i===2&&(e=(s[t-2]<<8)+s[t-1],n.push(Ac[e>>10]+Ac[e>>4&63]+Ac[e<<2&63]+"=")),n.join("")}},Ac=[],Oa=[],Yfe=typeof Uint8Array<"u"?Uint8Array:Array,WM="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jm=0,Kfe=WM.length;jm<Kfe;++jm)Ac[jm]=WM[jm],Oa[WM.charCodeAt(jm)]=jm;function NN(s){var e=s.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=s.indexOf("=");return t===-1&&(t=e),[t,t===e?0:4-t%4]}function Jfe(s,e,t){for(var i,n,r=[],o=e;o<t;o+=3)i=(s[o]<<16&16711680)+(s[o+1]<<8&65280)+(255&s[o+2]),r.push(Ac[(n=i)>>18&63]+Ac[n>>12&63]+Ac[n>>6&63]+Ac[63&n]);return r.join("")}Oa["-".charCodeAt(0)]=62,Oa["_".charCodeAt(0)]=63;const dr=ie("debugphysics"),qM=ie("debugcolliderplacement"),XM=ie("debugcollisions"),Zfe=ie("showcolliders"),YM=ie("debugraycasts"),Bo=Symbol("needle component"),so=Symbol("physics body"),zN=Symbol("rigidbody");let Bf;globalThis.false=globalThis.false!==void 0?globalThis.false:!0;dr&&console.log("Use Rapier",!1,globalThis.false);const WA=class{constructor(){u(this,"debugRenderColliders",!1);u(this,"debugRenderRaycasts",!1);u(this,"context");u(this,"_initializePromise");u(this,"_isInitialized",!1);u(this,"rapierRay",new jfe({x:0,y:0,z:0},{x:0,y:0,z:1}));u(this,"raycastVectorsBuffer",new _a(()=>new w,10));u(this,"rapierSphere",null);u(this,"rapierColliderArray",[]);u(this,"rapierIdentityRotation",{x:0,y:0,z:0,w:1});u(this,"rapierForwardVector",{x:0,y:0,z:1});u(this,"enabled",!1);u(this,"_tempPosition",new w);u(this,"_tempQuaternion",new xe);u(this,"_tempScale",new w);u(this,"_tempMatrix",new fe);u(this,"_isUpdatingPhysicsWorld",!1);u(this,"_world");u(this,"_hasCreatedWorld",!1);u(this,"eventQueue");u(this,"collisionHandler");u(this,"objects",[]);u(this,"bodies",[]);u(this,"_meshCache",new Map);u(this,"_gravity",{x:0,y:-9.81,z:0});u(this,"lines");u(this,"_tempCenterPos",new w);u(this,"_tempCenterVec",new w);u(this,"_tempCenterQuaternion",new xe)}removeBody(e){var i,n,r;if(!e)return;this.validate();const t=e[so];if(e[so]=null,t&&this.world){const o=this.objects.findIndex(a=>a===e);if(o>=0){const a=this.bodies[o];if(this.bodies.splice(o,1),this.objects.splice(o,1),a instanceof UN){const l=a;(i=this.world)==null||i.removeCollider(l,!0);const c=l.parent();c&&c.numColliders()<=0&&(c[Bo]||(n=this.world)==null||n.removeRigidBody(c))}else a instanceof FN&&(a.numColliders()<=0?(r=this.world)==null||r.removeRigidBody(a):Xe()&&(a.did_log_removing||setTimeout(()=>{a.numColliders()>0&&(a.did_log_removing=!0,console.warn("RapierPhysics: removing rigidbody with colliders from the physics world is not possible right now, please remove the colliders first"))},1)))}}}updateBody(e,t,i){if(this.validate(),!!this.enabled&&!(e.destroyed||!e.gameObject)&&!(!t&&!i))if(e.isCollider===!0)console.warn("TODO: implement updating collider position");else{const n=e,r=n[so];r&&this.syncPhysicsBody(n.gameObject,r,t,i)}}updateProperties(e){if(this.validate(),e.isCollider){const t=e,i=t[so];i&&(this.internalUpdateColliderProperties(t,i),t.sharedMaterial&&this.updatePhysicsMaterial(t))}else{const t=e,i=this.internal_getRigidbody(t);i&&this.internalUpdateRigidbodyProperties(t,i)}}addForce(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.addForce(t,i):console.warn("Rigidbody doesn't exist: can not apply force (does your object with the Rigidbody have a collider?)")}addImpulse(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.applyImpulse(t,i):console.warn("Rigidbody doesn't exist: can not apply impulse (does your object with the Rigidbody have a collider?)")}getLinearVelocity(e){this.validate();const t=this.internal_getRigidbody(e);return t?t.linvel():null}getAngularVelocity(e){this.validate();const t=this.internal_getRigidbody(e);return t?t.angvel():null}resetForces(e,t){this.validate();const i=this.internal_getRigidbody(e);i==null||i.resetForces(t)}resetTorques(e,t){this.validate();const i=this.internal_getRigidbody(e);i==null||i.resetTorques(t)}applyImpulse(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.applyImpulse(t,i):console.warn("Rigidbody doesn't exist: can not apply impulse (does your object with the Rigidbody have a collider?)")}wakeup(e){this.validate();const t=this.internal_getRigidbody(e);t?t.wakeUp():console.warn("Rigidbody doesn't exist: can not wake up (does your object with the Rigidbody have a collider?)")}isSleeping(e){this.validate();const t=this.internal_getRigidbody(e);return t==null?void 0:t.isSleeping()}setAngularVelocity(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.setAngvel(t,i):console.warn("Rigidbody doesn't exist: can not set angular velocity (does your object with the Rigidbody have a collider?)")}setLinearVelocity(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.setLinvel(t,i):console.warn("Rigidbody doesn't exist: can not set linear velocity (does your object with the Rigidbody have a collider?)")}async initialize(e){return this.context=e,this._initializePromise||(this._initializePromise=this.internalInitialization()),this._initializePromise}async internalInitialization(){return dr&&console.log("Initialize rapier physics engine"),"env"in import.meta&&{}.VITE_NEEDLE_USE_RAPIER==="false"&&dr&&console.log("Rapier disabled"),!1}validate(){this._isInitialized||dr&&(this._lastWarnTime=this._lastWarnTime??0,Date.now()-this._lastWarnTime>1e3&&(this._lastWarnTime=Date.now(),console.warn("Physics engine is not initialized")))}raycast(e,t,i){var l;let n=i==null?void 0:i.maxDistance,r=i==null?void 0:i.solid;n===void 0&&(n=1/0),r===void 0&&(r=!0);const o=this.getPhysicsRay(this.rapierRay,e,t);if(!o)return null;(this.debugRenderRaycasts||YM)&&At.DrawRay(o.origin,o.dir,255,1);const a=(l=this.world)==null?void 0:l.castRay(o,n,r,i==null?void 0:i.queryFilterFlags,i==null?void 0:i.filterGroups,void 0,void 0,c=>{const h=c[Bo];return i!=null&&i.filterPredicate?i.filterPredicate(h):(i==null?void 0:i.useIgnoreRaycastLayer)!==!1?!(h!=null&&h.gameObject.layers.isEnabled(2)):!0});if(a){const c=o.pointAt(a.toi),h=this.raycastVectorsBuffer.get();return h.set(c.x,c.y,c.z),{point:h,collider:a.collider[Bo]}}return null}raycastAndGetNormal(e,t,i){var l;let n=i==null?void 0:i.maxDistance,r=i==null?void 0:i.solid;n===void 0&&(n=1/0),r===void 0&&(r=!0);const o=this.getPhysicsRay(this.rapierRay,e,t);if(!o)return null;(this.debugRenderRaycasts||YM)&&At.DrawRay(o.origin,o.dir,255,1);const a=(l=this.world)==null?void 0:l.castRayAndGetNormal(o,n,r,i==null?void 0:i.queryFilterFlags,i==null?void 0:i.filterGroups,void 0,void 0,c=>{const h=c[Bo];return i!=null&&i.filterPredicate?i.filterPredicate(h):(i==null?void 0:i.useIgnoreRaycastLayer)!==!1?!(h!=null&&h.gameObject.layers.isEnabled(2)):!0});if(a){const c=o.pointAt(a.toi),h=a.normal,d=this.raycastVectorsBuffer.get(),f=this.raycastVectorsBuffer.get();return d.set(c.x,c.y,c.z),f.set(h.x,h.y,h.z),{point:d,normal:f,collider:a.collider[Bo]}}return null}getPhysicsRay(e,t,i){var a,l,c;const n=(a=this.context)==null?void 0:a.mainCamera;if(t===void 0){const h=(l=this.context)==null?void 0:l.input.getPointerPosition(0);if(h)t=h;else return null}if(t.z===void 0){if(!n)return console.error("Can not perform raycast from 2d point - no main camera found"),null;const h=this.raycastVectorsBuffer.get();h.x=t.x,h.y=t.y,h.z=0,(h.x>1||h.y>1||h.y<-1||h.x<-1)&&(dr&&console.warn("Converting screenspace to raycast space",h),(c=this.context)==null||c.input.convertScreenspaceToRaycastSpace(h)),h.unproject(n),t=h}const r=t;e.origin.x=r.x,e.origin.y=r.y,e.origin.z=r.z;const o=this.raycastVectorsBuffer.get();if(i)o.set(i.x,i.y,i.z);else{if(!n)return console.error("Can not perform raycast - no camera found"),null;o.set(e.origin.x,e.origin.y,e.origin.z);const h=Qt(n);o.sub(h)}return o.normalize(),e.dir.x=o.x,e.dir.y=o.y,e.dir.z=o.z,e}sphereOverlap(e,t){return this.rapierColliderArray.length=0,this.world?(this.rapierSphere||(this.rapierSphere=new a2(t)),this.rapierSphere.radius=t,(this.debugRenderRaycasts||YM)&&At.DrawWireSphere(e,t,3359999,1),this.world.intersectionsWithShape(e,this.rapierIdentityRotation,this.rapierSphere,i=>{const n=i[Bo],r=new jQ(n.gameObject,n);return this.rapierColliderArray.push(r),!0},void 0,void 0,void 0,void 0,i=>i.isSensor()?!1:i[Bo].gameObject.layers.isEnabled(2)==!1),this.rapierColliderArray):this.rapierColliderArray}get world(){return this._world}get isUpdating(){return this._isUpdatingPhysicsWorld}get gravity(){var e;return((e=this.world)==null?void 0:e.gravity)??this._gravity}set gravity(e){this.world?this.world.gravity=e:this._gravity=e}clearCaches(){var e,t,i,n;this._meshCache.clear(),(e=this.eventQueue)!=null&&e.raw&&((t=this.eventQueue)==null||t.free()),(i=this.world)!=null&&i.bodies&&((n=this.world)==null||n.free())}async addBoxCollider(e,t){if(this._isInitialized||await this.initialize(e.context),!e.activeAndEnabled)return;if(!this.enabled){dr&&console.warn("Physics are disabled");return}const i=e.gameObject,n=ln(i,this._tempPosition).multiply(t);n.multiplyScalar(.5),n.x<0&&(n.x=Math.abs(n.x)),n.y<0&&(n.y=Math.abs(n.y)),n.z<0&&(n.z=Math.abs(n.z)),n.x==0&&(n.x=1e-7),n.y==0&&(n.y=1e-7),n.z==0&&(n.z=1e-7);const r=In.cuboid(n.x,n.y,n.z);this.createCollider(e,r)}async addSphereCollider(e){if(this._isInitialized||await this.initialize(e.context),!e.activeAndEnabled)return;if(!this.enabled){dr&&console.warn("Physics are disabled");return}const t=In.ball(.5);this.createCollider(e,t),this.updateProperties(e)}async addCapsuleCollider(e,t,i){if(this._isInitialized||await this.initialize(e.context),!e.activeAndEnabled)return;if(!this.enabled){dr&&console.warn("Physics are disabled");return}const n=e.gameObject,r=ln(n,this._tempPosition);r.x=Math.abs(r.x),r.y=Math.abs(r.y);const o=i*r.x;t=Math.max(t,o*2);const a=et.clamp(t*.5*r.y-i*r.x,0,Number.MAX_SAFE_INTEGER),l=In.capsule(a,o);this.createCollider(e,l)}async addMeshCollider(e,t,i,n){var c,h,d;if(this._isInitialized||await this.initialize(e.context),!e.activeAndEnabled)return;if(!this.enabled){dr&&console.warn("Physics are disabled");return}let r=t.geometry;if(!r){dr&&console.warn("Missing mesh geometry",t.name);return}(h=(c=r.index)==null?void 0:c.array)!=null&&h.length||(console.warn(`Your MeshCollider is missing vertices or indices in the assined mesh "${t.name}". Consider providing an indexed geometry.`),r=uie(r));let o=r.getAttribute("position").array;const a=(d=r.index)==null?void 0:d.array;if(Math.abs(n.x-1)>1e-4||Math.abs(n.y-1)>1e-4||Math.abs(n.z-1)>1e-4){const f=r.uuid+"_"+n.x+"_"+n.y+"_"+n.z+"_"+i;if(this._meshCache.has(f))dr&&console.warn("Use cached mesh collider"),o=this._meshCache.get(f);else{(dr||Xe())&&console.warn(`Your MeshCollider "${e.name}" is scaled: consider applying the scale to the collider mesh instead (${n.x}, ${n.y}, ${n.z})`);const p=new Float32Array(o.length);for(let m=0;m<o.length;m+=3)p[m]=o[m]*n.x,p[m+1]=o[m+1]*n.y,p[m+2]=o[m+2]*n.z;o=p,this._meshCache.set(f,p)}}const l=i?In.convexHull(o):In.trimesh(o,a);l&&this.createCollider(e,l)}updatePhysicsMaterial(e){if(!e)return;const t=e.sharedMaterial,i=e[so];if(i&&t){if(t.bounciness!==void 0&&i.setRestitution(t.bounciness),t.bounceCombine!==void 0)switch(t.bounceCombine){case Is.Average:i.setRestitutionCombineRule(fs.Average);break;case Is.Maximum:i.setRestitutionCombineRule(fs.Max);break;case Is.Minimum:i.setRestitutionCombineRule(fs.Min);break;case Is.Multiply:i.setRestitutionCombineRule(fs.Multiply);break}if(t.dynamicFriction!==void 0&&i.setFriction(t.dynamicFriction),t.frictionCombine!==void 0)switch(t.frictionCombine){case Is.Average:i.setFrictionCombineRule(fs.Average);break;case Is.Maximum:i.setFrictionCombineRule(fs.Max);break;case Is.Minimum:i.setFrictionCombineRule(fs.Min);break;case Is.Multiply:i.setFrictionCombineRule(fs.Multiply);break}}}getBody(e){return e?e[so]:null}getComponent(e){return e?e[Bo]:null}createCollider(e,t){var o;if(!this.world)throw new Error("Physics world not initialized");const i=this._tempMatrix;let n;e.attachedRigidbody?n=this.getRigidbody(e,this._tempMatrix):(dr&&console.log("Create collider without rigidbody",e.name),i.makeRotationFromQuaternion(qi(e.gameObject)),i.setPosition(Qt(e.gameObject))),i.decompose(this._tempPosition,this._tempQuaternion,this._tempScale),this.tryApplyCenter(e,this._tempPosition),t.setTranslation(this._tempPosition.x,this._tempPosition.y,this._tempPosition.z),t.setRotation(this._tempQuaternion),t.setSensor(e.isTrigger);const r=e.sharedMaterial;if(r){if(r.bounciness!==void 0&&t.setRestitution(r.bounciness),r.bounceCombine!==void 0)switch(r.bounceCombine){case Is.Average:t.setRestitutionCombineRule(fs.Average);break;case Is.Maximum:t.setRestitutionCombineRule(fs.Max);break;case Is.Minimum:t.setRestitutionCombineRule(fs.Min);break;case Is.Multiply:t.setRestitutionCombineRule(fs.Multiply);break}if(r.dynamicFriction!==void 0&&t.setFriction(r.dynamicFriction),r.frictionCombine!==void 0)switch(r.frictionCombine){case Is.Average:t.setFrictionCombineRule(fs.Average);break;case Is.Maximum:t.setFrictionCombineRule(fs.Max);break;case Is.Minimum:t.setFrictionCombineRule(fs.Min);break;case Is.Multiply:t.setFrictionCombineRule(fs.Multiply);break}}((o=e.attachedRigidbody)==null?void 0:o.autoMass)===!1&&(t.setDensity(1e-6),t.setMass(1e-6));try{const a=this.world.createCollider(t,n);return a[Bo]=e,e[so]=a,a.setActiveEvents(WS.COLLISION_EVENTS),a.setActiveCollisionTypes(qS.ALL),this.objects.push(e),this.bodies.push(a),this.updateColliderCollisionGroups(e),a}catch(a){return console.error('Error creating collider "'+e.name+`"
Error:`,a),null}}updateColliderCollisionGroups(e){const t=e[so],i=e.membership;let n=0;if(i==null)n=65535;else for(let a=0;a<i.length;a++){const l=i[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):n|=1<<Math.floor(l)}const r=e.filter;let o=0;if(r==null)o=65535;else for(let a=0;a<r.length;a++){const l=r[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):o|=1<<Math.floor(l)}t.setCollisionGroups(n<<16|o)}getRigidbody(e,t){if(!this.world)throw new Error("Physics world not initialized");let i=null;if(e.attachedRigidbody){const n=e.attachedRigidbody;if(i=n[so],!i){const r=n.isKinematic&&!qM;dr&&console.log("Create rigidbody",r);const o=r?Bf.RigidBodyDesc.kinematicPositionBased():Bf.RigidBodyDesc.dynamic(),a=Qt(e.attachedRigidbody.gameObject);o.setTranslation(a.x,a.y,a.z),o.setRotation(qi(e.attachedRigidbody.gameObject)),o.centerOfMass=new Bf.Vector3(n.centerOfMass.x,n.centerOfMass.y,n.centerOfMass.z),i=this.world.createRigidBody(o),this.bodies.push(i),this.objects.push(n)}i[Bo]=n,n[so]=i,this.internalUpdateRigidbodyProperties(n,i),this.getRigidbodyRelativeMatrix(e.gameObject,n.gameObject,t),e[zN]=i}else{const n=Bf.RigidBodyDesc.kinematicPositionBased(),r=Qt(e.gameObject);n.setTranslation(r.x,r.y,r.z),n.setRotation(qi(e.gameObject)),i=this.world.createRigidBody(n),t.identity(),i[Bo]=null}return i}internal_getRigidbody(e){return e.isCollider===!0?e[zN]:e[so]}internalUpdateColliderProperties(e,t){const i=t.shape;let n=!1;switch(i.type){case as.Ball:{const f=i,p=e,m=e.gameObject,v=ln(m,this._tempPosition),y=Math.abs(p.radius*v.x);n=f.radius!==y,f.radius=y,n&&t.setShape(f);break}case as.Cuboid:const r=i,o=e,a=e.gameObject,l=ln(a,this._tempPosition),c=o.size.x*.5*l.x,h=o.size.y*.5*l.y,d=o.size.z*.5*l.z;n=r.halfExtents.x!==c||r.halfExtents.y!==h||r.halfExtents.z!==d,r.halfExtents.x=c,r.halfExtents.y=h,r.halfExtents.z=d,n&&t.setShape(r);break}if(n){const r=e.attachedRigidbody;if(r!=null&&r.autoMass){const o=this.getBody(r);o==null||o.recomputeMassPropertiesFromColliders()}}this.updateColliderCollisionGroups(e),e.isTrigger!==t.isSensor()&&t.setSensor(e.isTrigger)}internalUpdateRigidbodyProperties(e,t){if(t.enableCcd(e.collisionDetectionMode!==w0.Discrete),t.setLinearDamping(e.drag),t.setAngularDamping(e.angularDrag),t.setGravityScale(e.useGravity?e.gravityScale:0,!0),e.dominanceGroup<=127&&e.dominanceGroup>=-127?t.setDominanceGroup(Math.floor(e.dominanceGroup)):t.setDominanceGroup(0),e.autoMass){t.setAdditionalMass(0,!1);for(let i=0;i<t.numColliders();i++)t.collider(i).setDensity(1);t.recomputeMassPropertiesFromColliders()}else{t.setAdditionalMass(e.mass,!1);for(let i=0;i<t.numColliders();i++)t.collider(i).setDensity(1e-7);t.recomputeMassPropertiesFromColliders()}t.setEnabledRotations(!e.lockRotationX,!e.lockRotationY,!e.lockRotationZ,!1),t.setEnabledTranslations(!e.lockPositionX,!e.lockPositionY,!e.lockPositionZ,!1),e.isKinematic?t.setBodyType(Bf.RigidBodyType.KinematicPositionBased,!1):t.setBodyType(Bf.RigidBodyType.Dynamic,!1)}step(e){if(this.world&&this.enabled){if(this._isUpdatingPhysicsWorld=!0,this.eventQueue||(this.eventQueue=new Xfe(!1)),e===void 0||e<=0){this._isUpdatingPhysicsWorld=!1;return}else e!==void 0&&(this.world.timestep=et.lerp(this.world.timestep,e,.8));try{this.world.step(this.eventQueue)}catch(t){console.warn("Error running physics step",t)}this._isUpdatingPhysicsWorld=!1}}postStep(){this.world&&this.enabled&&(this._isUpdatingPhysicsWorld=!0,this.syncObjects(),this._isUpdatingPhysicsWorld=!1,this.eventQueue&&!this.collisionHandler&&(this.collisionHandler=new $fe(this.world,this.eventQueue)),this.collisionHandler&&(this.collisionHandler.handleCollisionEvents(),this.collisionHandler.update()),this.updateDebugRendering(this.world))}updateDebugRendering(e){var t,i,n,r;if(dr||qM||Zfe||this.debugRenderColliders===!0){if(!this.lines){const a=new hn({color:7855479,fog:!1}),l=new pt;this.lines=new Xr(l,a),this.lines.layers.disableAll(),this.lines.layers.enable(2)}this.lines.parent!==((t=this.context)==null?void 0:t.scene)&&((i=this.context)==null||i.scene.add(this.lines));const o=e.debugRender();this.lines.geometry.setAttribute("position",new ot(o.vertices,3)),this.lines.geometry.setAttribute("color",new ot(o.colors,4)),(this.context.time.frame%30===0||((n=this.lines.geometry.boundingSphere)==null?void 0:n.radius)===0)&&this.lines.geometry.computeBoundingSphere()}else this.lines&&((r=this.context)==null||r.scene.remove(this.lines))}syncObjects(){if(!qM)for(let e=0;e<this.bodies.length;e++){const t=this.objects[e],i=this.bodies[e],n=t;if((n==null?void 0:n.isCollider)===!0&&!n.attachedRigidbody){const l=i.parent();l?this.syncPhysicsBody(t.gameObject,l,!0,!0):this.syncPhysicsBody(t.gameObject,i,!0,!0);continue}const r=i.translation(),o=i.rotation();if(Number.isNaN(r.x)||Number.isNaN(o.x)){!n.__COLLIDER_NAN&&Xe()&&(console.warn("Collider has NaN values",n.name,n.gameObject,i),n.__COLLIDER_NAN=!0);continue}const a=t.center;if(a&&a.isVector3){this._tempQuaternion.set(o.x,o.y,o.z,o.w);const l=this._tempPosition.copy(a).applyQuaternion(this._tempQuaternion),c=ln(t.gameObject);l.multiply(c),r.x-=l.x,r.y-=l.y,r.z-=l.z}kp(t.gameObject,r.x,r.y,r.z),KB(t.gameObject,o.x,o.y,o.z,o.w)}}syncPhysicsBody(e,t,i,n){if(t instanceof FN){const r=Qt(e,this._tempPosition),o=qi(e,this._tempQuaternion);switch(t.bodyType()){case UA.Fixed:case UA.KinematicPositionBased:case UA.KinematicVelocityBased:i&&t.setNextKinematicTranslation(r),n&&t.setNextKinematicRotation(o);break;default:i&&t.setTranslation(r,!1),n&&t.setRotation(o,!1);break}}else if(t instanceof UN){e.matrixWorldNeedsUpdate&&e.updateWorldMatrix(!0,!1),e.matrixWorld.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const r=this._tempPosition,o=this._tempQuaternion,a=t[Bo];if(this.tryApplyCenter(a,r),i){const l=t.translation();(l.x!==r.x||l.y!==r.y||l.z!==r.z)&&t.setTranslation(r)}if(n){const l=t.rotation();(l.x!==o.x||l.y!==o.y||l.z!==o.z||l.w!==o.w)&&t.setRotation(o)}}}tryApplyCenter(e,t){const i=e.center;i&&e.gameObject&&(i.x!==0||i.y!==0||i.z!==0)&&(this._tempCenterPos.x=i.x,this._tempCenterPos.y=i.y,this._tempCenterPos.z=i.z,ln(e.gameObject,this._tempCenterVec),this._tempCenterPos.multiply(this._tempCenterVec),e.attachedRigidbody?this._tempCenterPos.applyQuaternion(e.gameObject.quaternion):(qi(e.gameObject,this._tempCenterQuaternion),this._tempCenterPos.applyQuaternion(this._tempCenterQuaternion)),t.x+=this._tempCenterPos.x,t.y+=this._tempCenterPos.y,t.z+=this._tempCenterPos.z)}getRigidbodyRelativeMatrix(e,t,i,n){if(n===void 0&&(n=WA._matricesBuffer,n.length=0),e===t){const r=ln(e,this._tempPosition);i.makeScale(r.x,r.y,r.z);for(let o=n.length-1;o>=0;o--)i.multiply(n[o]);return i}return n.push(e.matrix),e.parent&&this.getRigidbodyRelativeMatrix(e.parent,t,i,n),i}addFixedJoint(e,t){if(!this.world){console.error("Physics world not initialized");return}const i=e[so],n=t[so];this.calculateJointRelativeMatrices(e.gameObject,t.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const r=Dh.fixed(WA.centerConnectionPos,WA.centerConnectionRot,this._tempPosition,this._tempQuaternion),o=this.world.createImpulseJoint(r,i,n,!0);dr&&console.log("ADD FIXED JOINT",o)}addHingeJoint(e,t,i,n){if(!this.world){console.error("Physics world not initialized");return}const r=e[so],o=t[so];this.calculateJointRelativeMatrices(e.gameObject,t.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const a=Bf.JointData.revolute(i,this._tempPosition,n),l=this.world.createImpulseJoint(a,r,o,!0);dr&&console.log("ADD HINGE JOINT",l)}calculateJointRelativeMatrices(e,t,i){e.updateWorldMatrix(!0,!1),t.updateWorldMatrix(!0,!1);const n=e.matrixWorld,r=t.matrixWorld;n.elements[0]=1,n.elements[5]=1,n.elements[10]=1,r.elements[0]=1,r.elements[5]=1,r.elements[10]=1,i.copy(r).premultiply(n.invert()).invert()}};let Nf=WA;u(Nf,"_didLoadPhysicsEngine",!1),u(Nf,"_matricesBuffer",[]),u(Nf,"centerConnectionPos",{x:0,y:0,z:0}),u(Nf,"centerConnectionRot",{x:0,y:0,z:0,w:1});class $fe{constructor(e,t){u(this,"world");u(this,"eventQueue");u(this,"activeCollisions",[]);u(this,"activeCollisionsStay",[]);u(this,"activeTriggers",[]);this.world=e,this.eventQueue=t}handleCollisionEvents(){this.eventQueue&&this.world&&this.eventQueue.drainCollisionEvents((e,t,i)=>{const n=this.world.getCollider(e),r=this.world.getCollider(t);if(!n||!r)return;const o=n[Bo],a=r[Bo];XM&&console.log("EVT",o.name,a.name,i,n,r),o&&a&&(i?(this.onCollisionStarted(o,n,a,r),this.onCollisionStarted(a,r,o,n)):(this.onCollisionEnded(o,a),this.onCollisionEnded(a,o)))})}update(){this.onHandleCollisionStay()}onCollisionStarted(e,t,i,n){let r=null;if(e.isTrigger||i.isTrigger)Np(e.gameObject,o=>{o.onTriggerEnter&&!o.destroyed&&o.onTriggerEnter(i),this.activeTriggers.push({collider:e,component:o,otherCollider:i})});else{const o=e.gameObject;this.world.contactPair(t,n,(a,l)=>{Np(o,c=>{var d;if(c.destroyed)return;const h=c.onCollisionEnter||c.onCollisionStay||c.onCollisionExit;if(h||XM){if(!r){const f=[],p=a.normal();for(let m=0;m<a.numSolverContacts();m++){const v=a.solverContactPoint(m),y=a.contactImpulse(m);if(v){const g=a.contactDist(m),_=a.solverContactFriction(m),A=a.solverContactTangentVelocity(m),b=new VQ(v,g,p,y,_,A);f.push(b),XM&&At.DrawDirection(v,p,16711680,3,!0)}}r=new QQ(o,i,f)}if(h){const f={collider:e,component:c,collision:r};this.activeCollisions.push(f),c.onCollisionStay&&this.activeCollisionsStay.push(f),(d=c.onCollisionEnter)==null||d.call(c,r)}}})})}}onHandleCollisionStay(){for(const e of this.activeCollisionsStay){const t=e.component;if(!t.destroyed&&t.activeAndEnabled&&t.onCollisionStay){if(e.collision.collider.destroyed)continue;const i=e.collision;t.onCollisionStay(i)}}for(const e of this.activeTriggers){const t=e.component;if(!t.destroyed&&t.activeAndEnabled&&t.onTriggerStay){const i=e.otherCollider;if(i.destroyed)continue;t.onTriggerStay(i)}}}onCollisionEnded(e,t){if(!(e.destroyed||t.destroyed)){for(let i=0;i<this.activeCollisions.length;i++){const n=this.activeCollisions[i],r=n.collider;if(r.destroyed||n.collision.collider.destroyed){this.activeCollisions.splice(i,1),i--;continue}if(r===e&&n.collision.collider===t){const o=n.component;if(this.activeCollisions.splice(i,1),i--,o.activeAndEnabled&&o.onCollisionExit){const a=n.collision;o.onCollisionExit(a)}}}for(let i=0;i<this.activeCollisionsStay.length;i++){const n=this.activeCollisionsStay[i],r=n.collider;if(r.destroyed||n.collision.collider.destroyed){this.activeCollisionsStay.splice(i,1),i--;continue}if(r===e&&n.collision.collider===t){const o=n.component;if(this.activeCollisionsStay.splice(i,1),i--,o.activeAndEnabled&&o.onCollisionExit){const a=n.collision;o.onCollisionExit(a)}}}for(let i=0;i<this.activeTriggers.length;i++){const n=this.activeTriggers[i],r=n.collider;if(r.destroyed||n.otherCollider.destroyed){this.activeTriggers.splice(i,1),i--;continue}if(r===e&&n.otherCollider===t){const o=n.component;if(this.activeTriggers.splice(i,1),i--,o.activeAndEnabled&&o.onTriggerExit){const a=n.otherCollider;o.onTriggerExit(a)}}}}}}class epe{static async createComparisonScene(e){const{files:t}=e,n=await Promise.all(t.map(y=>new si(y).loadAssetAsync())),r=new Ks;let o=0;for(const y of n)if(y instanceof ge){y.position.y=o,r.add(y);const g=Ja([y]);o+=g.getSize(new w).y,o+=.1}const a=new zt(20);r.add(a);const l=e.environment||"https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/studio_small_09_1k.exr";if(l){let y=null;if(l.endsWith(".hdr")){const g=(await jc(()=>Promise.resolve().then(()=>boe),void 0,import.meta.url)).RGBELoader;y=new g}else if(l.endsWith(".exr")){const g=(await jc(()=>Promise.resolve().then(()=>_oe),void 0,import.meta.url)).EXRLoader;y=new g}if(y){const g=await y.loadAsync(l).catch(_=>(console.error(_),null));g&&(g.mapping=bo,g.needsUpdate=!0,r.background=g,r.environment=g,r.backgroundBlurriness=.75)}else console.warn("Unsupported environment map format",l)}const c=Ja(r.children),h=c.getCenter(new w),d=c.getSize(new w),p=Math.max(d.x,d.y,d.z)/(2*Math.tan(Math.PI*a.fov/360));a.position.set(h.x,h.y,p),a.lookAt(h);const m=new PQ(a,e.domElement||document.body);m.target=h,m.update();const v=(e.domElement||document.body).getBoundingClientRect();return a.aspect=v.width/v.height,a.updateProjectionMatrix(),{scene:r,camera:a}}}function tpe(s,e,t,i="image/webp",n){return e6({context:s,width:e,height:t,mimeType:i,camera:n})}function e6(s){s||(s={});const{mimeType:e="image/png",transparent:t=!1}=s;let{context:i,width:n,height:r,camera:o}=s;if(!i&&(i=xi.Current,!i))return console.error("Can not save screenshot: No needle-engine context found or provided."),null;if(!o&&(o=i.mainCamera,!o))return console.error("No camera found"),null;const a=i.renderer.domElement.width,l=i.renderer.domElement.height;n||(n=a),r||(r=l);const c=window.devicePixelRatio||1;n/=c,r/=c;const h=i.renderer.xr.enabled;i.renderer.xr.enabled=!1,i.renderer.domElement.style.width=n+"px",i.renderer.domElement.style.height=r+"px";const d=i.renderer.getRenderTarget(),f=i.renderer.getClearColor(new me),p=i.renderer.getClearAlpha(),m=i.scene.background,v="aspect"in o?o.aspect:null;try{const y=i.renderer.domElement,g=s.render_events!==!1,_=new Array;g&&(xv(i.scene,dn,_),_.forEach(C=>C==null?void 0:C.onBeforeRender())),t&&(i.scene.background=null,i.renderer.setClearColor(0,0)),s.background&&(i.scene.background=null,i.renderer.setClearColor(s.background),s.background instanceof Vi&&i.renderer.setClearAlpha(s.background.a)),t&&i.renderer.setClearAlpha(0),i.renderer.setSize(n,r,!1),"cam"in o&&(o=o.threeCamera),o instanceof zt&&(o.aspect=n/r,o.updateProjectionMatrix());const A="type"in s&&s.type==="texture";let b=null;if(A&&(b=new Yt(n,r,{wrapS:du,wrapT:du,format:1023}),i.renderer.setRenderTarget(b)),i.renderNow(o||null),g&&_.forEach(C=>C.onAfterRender()),"type"in s){if(s.type==="texture")return b?(s.target&&(s.target.image=b==null?void 0:b.texture.image,s.target.needsUpdate=!0),b.texture.offset.set(0,-1),b.texture.needsUpdate=!0,b.texture):(console.error("No target texture found"),null);if(s.type==="blob")return new Promise((T,M)=>{y.toBlob(R=>{T(R)},e)})}const E=y.toDataURL(e);return"download_filename"in s&&s.download_filename&&t6(E,s.download_filename),E}finally{i.renderer.setRenderTarget(d),i.scene.background=m,i.renderer.setSize(a,l,!1),i.updateSize(!0),i.renderer.setClearColor(f,p),v!=null&&o instanceof zt&&(o.aspect=v,o.updateProjectionMatrix()),i.renderer.xr.enabled=h}return null}let Py=null;function t6(s,e){if(s){if(!s.startsWith("data:image")){console.error("Can not save image: Data url is not an image",s);return}Py||(Py=document.createElement("a")),Py.href=s,Py.download=e,Py.click()}}let SP=0;function GN(s){s?SP++:SP--}function ipe(){return SP>0}class i6{constructor(e){u(this,"writer");this.writer=e}writeNode(e){}}class npe extends i6{beforeWriteNode(e,t){At.isGizmo(e)&&(t.keep=!1)}}class spe extends i6{beforeWriteTexture(e,t){e.isRenderTargetTexture&&(t.newTexture=zD(new Vi(1,1,1,0)))}}const rpe={binary:!0,animations:!0};async function ope(s){if(!s.context)throw new Error("No context provided to exportAsGLTF");s.scene||(s.scene=s.context.scene);const e={...rpe,...s},{context:t}=e,i=new QE;i.register(a=>new h8(a)),i.register(a=>new npe(a)),i.register(a=>new spe(a)),bO(i,e.context);const n={binary:e.binary,animations:lpe(t,e.scene,[])},r=new ape;console.log("Exporting GLTF",n),r.onBeforeExport(e),GN(!0);const o=await i.parseAsync(e.scene,n).catch(a=>(console.error(a),null));if(GN(!1),r.onAfterExport(e),!o)throw new Error("Failed to export GLTF");if(e.downloadAs!=null){let a=null;if(o instanceof ArrayBuffer?a=new Blob([o],{type:"application/octet-stream"}):console.error("Can not download GLTF as a blob",o),a){const l=URL.createObjectURL(a),c=document.createElement("a");c.href=l;let h=e.downloadAs;!h.endsWith(".glb")&&!h.endsWith(".gltf")&&(h+=e.binary?".glb":".gltf"),c.download=h,c.click()}}return o}const HN=Symbol("needle:weight");class ape{constructor(){u(this,"_undo",[])}onBeforeExport(e){e.context.animations.mixers.forEach(t=>{const i=nv.tryGetActionsFromMixer(t);if(i)for(let n=0;n<i.length;n++){const r=i[n];r[HN]=r.weight,r.weight=0,this._undo.push(()=>{r.weight=r[HN]})}t.update(0)})}onAfterExport(e){this._undo.forEach(t=>t()),this._undo.length=0}}function lpe(s,e,t){s.animations.mixers.forEach(n=>{const r=nv.tryGetActionsFromMixer(n);if(r)for(let o=0;o<r.length;o++){const l=r[o].getClip();t.push(l)}}),Array.isArray(e)||(e=[e]);for(const n of e)nv.tryGetAnimationClipsFromObjectHierarchy(n,t);const i=new Set(t);return Array.from(i)}const VN="needle-button",KM=Xe();var op,ap,lp,lo,Nh,Gg,lC,n6,cC,s6,V0;class l2 extends HTMLElement{constructor(){super();ls(this,lC);ls(this,cC);ls(this,op,void 0);ls(this,ap,void 0);ls(this,lp,void 0);ls(this,lo,void 0);ls(this,Nh,void 0);ls(this,Gg,void 0);ls(this,V0,t=>{KM&&console.log("Needle Button clicked"),!t.defaultPrevented&&wt(this,lo)&&wt(this,lo).click()});this.removeEventListener("click",wt(this,V0)),this.addEventListener("click",wt(this,V0))}attributeChangedCallback(t,i,n){lf(this,lC,n6).call(this)}}op=new WeakMap,ap=new WeakMap,lp=new WeakMap,lo=new WeakMap,Nh=new WeakMap,Gg=new WeakMap,lC=new WeakSet,n6=function(){var i,n;if((i=wt(this,lo))==null||i.remove(),this.getAttribute("ar")!=null)wt(this,Nh)??cs(this,Nh,new lu),cs(this,lo,wt(this,Nh).createARButton());else if(this.getAttribute("vr")!=null)wt(this,Nh)??cs(this,Nh,new lu),cs(this,lo,wt(this,Nh).createVRButton());else if(this.getAttribute("quicklook")!=null)wt(this,Nh)??cs(this,Nh,new lu),cs(this,lo,wt(this,Nh).createQuicklookButton());else{KM?console.warn("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute."):console.debug("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute.");return}wt(this,op)??cs(this,op,this.attachShadow({mode:"open"})),wt(this,ap)??cs(this,ap,document.createElement("slot")),wt(this,lp)??cs(this,lp,document.createElement("style")),wt(this,lp).innerHTML=`
            button {
                all: initial;
                cursor: inherit;
                color: inherit;
                font-family: inherit;
                gap: inherit;
                white-space: nowrap;
            }
        `,this.getAttribute("unstyled")!=null||(wt(this,lp).innerHTML+=`
            :host {
                display: inline-block;
                background: rgba(255, 255, 255, .8);
                backdrop-filter: blur(10px);
                width: fit-content;
                transition: background .2s;

                cursor: pointer;
                padding: 0.4rem .5rem;
                border-radius: 0.8rem;
                color: black;
                background: rgba(245, 245, 245, .8);
                outline: rgba(0,0,0,.05) 1px solid;
            }
            :host(:hover) {
                background: rgba(255, 255, 255, 1);
                transition: background .2s;
            }
            slot {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: .5rem;
            }
`),wt(this,ap).innerHTML=wt(this,lo).innerHTML,wt(this,ap).style.cssText="display: flex; align-items: center; justify-content: center;",wt(this,lo).innerHTML=wt(this,ap).outerHTML,wt(this,op).innerHTML=wt(this,lo).outerHTML,wt(this,op).prepend(wt(this,lp)),bS(GR,{element:wt(this,op)}),(n=wt(this,Gg))==null||n.disconnect(),wt(this,Gg)??cs(this,Gg,new MutationObserver(()=>lf(this,cC,s6).call(this))),wt(this,Gg).observe(wt(this,lo),{attributes:!0}),KM&&console.log("Needle Button updated")},cC=new WeakSet,s6=function(){wt(this,lo)&&(wt(this,lo).style.display==="none"?this.style.display="none":this.style.display==="none"&&(this.style.display=""))},V0=new WeakMap,u(l2,"observedAttributes",["ar","vr","quicklook"]);typeof window<"u"&&!window.customElements.get(VN)&&window.customElements.define(VN,l2);const XS=ie("debugmissingcamera");xi.registerCallback(yi.MissingCamera,s=>{var a,l,c;XS&&console.warn("Creating missing camera");const e=s.context.scene,t=new zt;t.name="Default Fallback Camera",e.add(t);const i=new Mi;i.sourceId=((l=(a=s.files)==null?void 0:a[0])==null?void 0:l.src)??"unknown",(c=s.context.domElement.getAttribute("skybox-image"))!=null&&c.length||0>0||s.context.lightmaps.tryGetSkybox(i.sourceId)?i.clearFlags=uo.Skybox:i.clearFlags=uo.SolidColor,i.backgroundColor=new Vi(.5,.5,.5,1),i.fieldOfView=35,s.context.domElement.getAttribute("transparent")!=null&&(i.clearFlags=uo.Uninitialized),i.backgroundBlurriness=.2;const r=mp(t,i,!0);t.position.x=0,t.position.y=1,t.position.z=2;const o=s.context.domElement;return(o==null?void 0:o.cameraControls)!=!1&&r6(s.context,r),r});xi.registerCallback(yi.ContextCreated,s=>{if(!s.context.mainCamera){XS&&console.log("Will not auto-fit because a default camera exists");return}const e=s.context.domElement;if((e==null?void 0:e.cameraControls)==!0){const t=YG(s.context.mainCamera);if((t==null?void 0:t.isCameraController)==!0){XS&&console.log("Will not auto-fit because a camera controller exists");return}r6(s.context)}});function r6(s,e){e=e??s.mainCameraComponent;const t=e==null?void 0:e.gameObject;if(XS&&console.log("Creating default camera controls",e==null?void 0:e.name),t){const i=g_(t,Ni);i.sourceId=(e==null?void 0:e.sourceId)??"unknown";const n=s.domElement.getAttribute("auto-rotate");if(i.autoRotate=n!=null&&n!="0"&&(n==null?void 0:n.toLowerCase())!="false",i.autoRotateSpeed=.5,i.autoFit=!0,i.autoRotate&&n){const r=parseFloat(n);isNaN(r)||(i.autoRotateSpeed=r)}}else console.warn("Missing camera object, can not add orbit controls")}xi.registerCallback(yi.ContextCreated,s=>{const e=s.context.domElement.getAttribute("autoplay");if(e!==void 0&&(e===""||e==="true"||e==="1")&&s.files)for(const t of s.files)ne.foreachComponent(t.file.scene,n=>{if(n.enabled!==!1){if(n instanceof qr&&n.playAutomatically||n instanceof Cr||n instanceof Dl&&n.playOnAwake===!0)return!0;if(n instanceof qr)return n.playAutomatically=!0,!0;if(n instanceof Dl)return n.playOnAwake=!0,!0}},!0)!==!0&&nv.assignAnimationsFromFile(t.file,{createAnimationComponent:(n,r)=>ya(n,qr)})});const dm={Context:Ot,glTF:{loadFromURL:e2}};globalThis.Needle!==void 0&&console.warn("Needle Engine is already imported");globalThis.Needle=dm;function o6(s){for(const e in s)dm[e]=s[e]}o6(Vae);o6(yfe);dm.onStart=YD;dm.onUpdate=KD;dm.onBeforeRender=BQ;dm.NeedleXRSession=It;for(const s of Object.getOwnPropertyNames(ne))switch(s){case"prototype":case"constructor":case"length":case"name":continue;default:dm[s]=ne[s];break}globalThis.THREE?console.warn("Threejs is already imported"):globalThis.THREE=AB;const cpe=Object.freeze(Object.defineProperty({__proto__:null,$physicsKey:Yle,ActionBuilder:wi,ActionCollection:qD,ActionModel:ho,Addressables:G5,AlignmentConstraint:b_,get AmbientMode(){return Sl},Animation:qr,AnimationCurve:qa,AnimationExtension:x_,AnimationTrackHandler:TE,AnimationUtils:nv,Animator:Cr,get AnimatorConditionMode(){return kh},AnimatorController:Aa,get AnimatorControllerParameterType(){return SS},AnimatorStateInfo:Jy,Antialiasing:I_,Application:Bl,get ApplicationEvents(){return vd},AssetDatabase:t5,AssetReference:si,AudioExtension:jd,AudioListener:xd,AudioSource:Fi,AudioTrackHandler:yp,Avatar:Bd,AvatarBlink_Simple:Zp,AvatarEyeLook_Rotation:au,AvatarLoader:rO,AvatarMarker:Ps,AvatarModel:PE,Avatar_Brain_LookAt:T0,Avatar_MouthShapes:P_,Avatar_MustacheShake:nO,Avatar_POI:zc,get Axes(){return sp},AxesHelper:Mv,BUILD_TIME:sD,BaseUIComponent:$a,BasicIKConstraint:aO,BehaviorExtension:BE,BehaviorModel:ys,Behaviour:Te,BloomEffect:Gc,BoxCollider:Xd,BoxGizmo:em,BoxHelperComponent:No,Button:Au,ButtonsFactory:Ml,get CallDirection(){return xc},CallInfo:bc,Camera:Mi,CameraTargetReachedEvent:C0,Canvas:Us,CanvasGroup:Dd,CapsuleCollider:mu,ChangeMaterialOnClick:Pc,ChangeTransformOnClick:tm,CharacterController:im,CharacterControllerInput:bu,ChromaticAberration:F_,CircularBuffer:_a,get ClearFlags(){return uo},get ClipExtrapolation(){return _l},Collider:Xo,Collision:QQ,get CollisionDetectionMode(){return w0},ColorAdjustments:Zd,ColorBySpeedModule:nm,ColorOverLifetimeModule:N_,Component:Te,get ComponentEvents(){return tv},ComponentLifecycleEvents:f_,get ConnectionEvents(){return hS},ContactPoint:VQ,ContactShadows:Vo,Context:Ot,ContextArgs:Hoe,get ContextEvent(){return yi},ContextRegistry:xi,ControlTrackHandler:ME,CustomBranding:nf,CustomShader:na,get DefaultReflectionMode(){return rv},Deletable:TO,DeleteBox:Sp,DepthOfField:Vl,DeviceFlag:GE,get DeviceUtilities(){return St},DocumentExtension:MO,DragControls:Bs,get DragMode(){return vr},DropListener:sf,Duplicatable:Su,EffectWrapper:P0,EmissionModule:sh,EmphasizeOnClick:Bv,EngineLoadingView:_A,EventList:un,EventListEvent:wE,EventSystem:zo,EventTrigger:VE,FieldWithDefault:wO,FileReference:Lg,FileReferenceSerializer:V5,FileSpawnModel:r8,get File_Event(){return R0},FixedJoint:DO,FlyControls:OO,Fog:kv,get FrameEvent(){return Wt},GENERATOR:tE,GameObject:ne,Gizmos:At,GltfExport:Cl,GltfExportBox:kO,GltfLoadEvent:Ep,get GltfLoadEventType(){return hu},Gradient:$d,Graphic:Hc,GraphicRaycaster:SE,Graphics:za,GridHelper:Fv,GridLayoutGroup:mO,GroundProjectedEnv:ih,GroupActionModel:$h,get HideFlags(){return MR},HideOnStart:vO,HingeJoint:V_,HorizontalLayoutGroup:pO,HostData:mre,Image:Pv,ImageReference:Og,ImageReferenceSerializer:H5,InheritVelocityModule:rh,Input:tV,get InputEventQueue(){return Uo},get InputEvents(){return Ai},InputField:ua,InstanceHandle:bp,InstancingHandler:wd,InstancingUtil:Ya,get InstantiateEvent(){return Fp},InstantiateIdProvider:Ls,InstantiateOptions:Gl,Interactable:EO,JoinedRoomResponse:Ese,KeyEventArgs:One,Keyframe:Ao,LODGroup:j_,LODModel:om,LeftRoomResponse:Tse,Light:Ko,LightData:tQ,LimitVelocityOverLifetimeModule:ws,LoadingElementOptions:Koe,LogStats:UO,get LogType(){return os},LookAt:Vc,LookAtConstraint:Jp,MainModule:Ir,get MarkerType(){return MS},MaskableGraphic:D_,Mathf:et,MeshCollider:$p,MeshRenderer:U_,MinMaxCurve:ut,MinMaxGradient:Ds,NEEDLE_progressive:fi,NEKeyboardEvent:Ny,NEPointerEvent:Th,NeedleButtonElement:l2,NeedleEngine:xi,NeedleEngineHTMLElement:t2,NeedleGltfLoader:ZO,NeedleMenu:ah,NeedlePatchesKey:fw,NeedleUSDZExporter:_Q,NeedleXRController:dD,NeedleXRSession:It,NeedleXRSync:JV,NeedleXRUtils:e5,NestedGltf:qE,NetworkConnection:KV,get NetworkedStreamEvents(){return Nn},NetworkedStreams:R_,Networking:vu,NewInstanceModel:f5,NoiseModule:ji,ObjectRaycaster:xa,ObjectUtils:Vd,OffsetConstraint:am,OneEuroFilter:uw,OneEuroFilterXYZ:XB,OpenURL:Uv,OrbitControls:Ni,Outline:Rv,get OwnershipEvent(){return fr},OwnershipModel:bD,Padding:Kd,ParticleBurst:I0,ParticleSubEmitter:t1,ParticleSystem:Bn,ParticleSystemBaseBehaviour:rf,ParticleSystemRenderer:sl,get ParticleSystemShapeType(){return Nr},PeerHandle:Ap,PeerNetworking:YV,Physics:Bg,PhysicsExtension:UE,get PhysicsMaterialCombine(){return Is},PixelationEffect:X_,PlayAnimationOnClick:Il,PlayAudioOnClick:Od,PlayableDirector:Dl,PlayerColor:av,PlayerState:Xs,get PlayerStateEvent(){return IS},PlayerSync:Wd,PlayerView:Z5,PlayerViewManager:$5,PointerEventData:Ev,get PointerType(){return Kh},PostProcessingEffect:er,PostProcessingHandler:i1,PostProcessingManager:cv,PreliminaryAction:Dv,PreliminaryTrigger:L_,get PrimitiveType(){return Wa},Progress:gi,PromiseAllWithErrors:YC,PromiseErrorResult:GI,RGBAColor:Vi,RapierPhysics:Nf,RawImage:OE,RaycastOptions:Yc,Rect:uO,RectTransform:Js,ReflectionProbe:Bc,RegisteredAnimationInfo:eu,RemoteSkybox:$c,RenderTexture:_d,RenderTextureSerializer:kQ,Renderer:dn,RendererData:eQ,RendererLightmap:M0,Rigidbody:Ci,get RigidbodyConstraints(){return Kn},get RoomEvents(){return Ut},RotationBySpeedModule:Ta,RotationOverLifetimeModule:nl,SceneLightSettings:PS,SceneSwitcher:zs,ScreenCapture:of,ScreenSpaceAmbientOcclusion:Cu,ScreenSpaceAmbientOcclusionN8:Ql,get SendQueue(){return Ga},SerializationContext:BD,SetActiveOnClick:ha,ShadowCatcher:tb,ShapeModule:en,SharpeningEffect:J_,SignalAsset:E_,SignalReceiver:ou,SignalReceiverEvent:Tv,SignalTrackHandler:E0,Size:hO,SizeBySpeedModule:Mo,SizeOverLifetimeModule:ef,SkinnedMeshRenderer:SO,SmoothFollow:kl,SpatialGrabRaycaster:bd,SpatialHtml:ib,SpatialTrigger:Sd,SpatialTriggerReceiver:Qc,SpectatorCamera:s1,SphereCollider:Iv,SphereIntersection:SD,SphereOverlapResult:jQ,Sprite:oh,SpriteData:Ll,SpriteRenderer:Yo,SpriteSheet:Ld,StateMachineBehaviour:Wae,StreamEndedEvent:tO,StreamReceivedEvent:WQ,SubEmitterSystem:k0,SyncedCamera:Cp,SyncedRoom:jl,SyncedTransform:Kc,TapGestureTrigger:yO,TeleportTarget:FE,TestRunner:XO,TestSceneUtils:epe,TestSimulateUserData:YO,Text:Kr,TextBuilder:NE,TextExtension:z_,TextureSheetAnimationModule:Rr,TiltShiftEffect:ch,Time:iQ,ToneMappingEffect:Jc,TrackHandler:T_,get TrackType(){return Oo},TrailModule:Ln,TransformData:mn,TransformGizmo:cm,TriggerBuilder:Ys,TriggerModel:Nc,TypeStore:X,UIRaycastUtils:CE,UIRootComponent:S_,USDDocument:QD,USDObject:wr,USDWriter:AQ,USDZExporter:tn,USDZText:dd,USDZUIExtension:zE,Upload_Result:DR,UriSerializer:FQ,UsageMarker:G_,UserJoinedOrLeftRoomModel:Mse,VERSION:ja,VariantAction:WD,VelocityOverLifetimeModule:jn,VerticalLayoutGroup:fO,VideoPlayer:Ns,get ViewDevice(){return Uc},Vignette:hm,VisibilityAction:k_,Voip:qd,Volume:cv,VolumeParameter:Ze,VolumeProfile:M_,WaitForFrames:ioe,WaitForPromise:j5,WaitForSeconds:Q5,Watch:iu,WebARCameraBackground:o1,WebARSessionRoot:gu,WebXR:bn,WebXRButtonFactory:lu,WebXRImageTracking:cu,WebXRImageTrackingModel:hh,WebXRPlaneTracking:Eu,WebXRTrackedImage:fd,XRControllerFollow:Tu,XRControllerModel:Zc,XRControllerMovement:wa,XRFlag:Ws,XRRig:a1,XRState:xr,get XRStateFlag(){return da},__Ignore:JO,__internalNotifyObjectDestroyed:o5,activeInHierarchyFieldName:nu,addAttributeChangeCallback:J4,addComponent:ya,addCustomExtensionPlugin:Tce,addFile:o8,addFileFromUrl:a8,addGltfLoadEventListener:Efe,addNewComponent:mp,addPatch:sE,apply:fE,applyHMRChanges:Ufe,applyPrototypeExtensions:S5,beginListenDestroy:d5,beginListenFileSpawn:l8,beginListenInstantiate:p5,binaryIdentifierCasts:pD,build_scene_functions:Goe,builtinComponentKeyName:Hf,calculateProgress01:HD,clearBalloonMessages:lk,clearOverlayMessages:lk,colorSerializer:dle,compareAssociation:y5,componentSerializer:Rw,copyTexture:eH,createLoader:$O,createMotion:RQ,debugNet:oo,debugOwner:Vy,deepClone:s_,delay:Xc,delayForFrames:qC,deserializeObject:gS,destroy:ba,destroyComponentInstance:T5,disposeObjectResources:rn,disposeStream:Rc,download:z5,download_file:kD,editorGuidKeyName:hA,effectsOrder:pP,enableSpatialConsole:fp,euler:ple,eventListSerializer:yle,exportAsGLTF:ope,findByGuid:A_,findObjectOfType:dE,findObjectsOfType:I5,findResourceUsers:ED,fitObjectIntoVolume:iH,foreachComponent:Np,foreachComponentEnumerator:mE,forward:U$,generateQRCode:$4,generateSeed:hE,getBoundingBox:Ja,getCameraController:YG,getComponent:Xp,getComponentInChildren:y_,getComponentInParent:_0,getComponents:v_,getComponentsInChildren:xv,getComponentsInParent:uE,getFormattedDate:mQ,getIconElement:br,getIconTexture:zR,getIp:VY,getIpAndLocation:QY,getIpCloudflare:HY,getLoader:Fl,getOrAddComponent:g_,getParam:ie,getParentHierarchyPath:G$,getPath:MY,getPeerOptions:xse,getPeerjsInstance:XV,getResourceUserCount:Yse,getTempColor:ZG,getTempQuaternion:bl,getTempVector:yt,getUrlParams:n_,getVisibleInCustomShadowRendering:tH,getWorldDirection:JB,getWorldEuler:ZB,getWorldPosition:Qt,getWorldQuaternion:qi,getWorldRotation:l_,getWorldScale:ln,hasCommercialLicense:ru,hasIndieLicense:GD,hasPointerEventComponent:CS,hasProLicense:yd,hash:LD,hideDebugConsole:oH,imageToCanvas:SQ,instantiate:Sv,invokeAfterImportPluginHooks:xO,invokeXRSessionEnd:$H,invokeXRSessionStart:ZH,isActiveInHierarchy:R5,isActiveSelf:wv,isAndroidDevice:OY,isAnimationAction:$G,isComponent:HQ,isDebugMode:SY,isDesktop:RY,isDestroyed:Up,isDevEnvironment:Xe,isDisposed:qse,isExporting:ipe,isHostedOnGlitch:j4,isHotReloading:Ofe,isIPad:BY,isIconElement:sQ,isLocalNetwork:So,isMacOS:kY,isMobileDevice:PY,isMozillaXR:LY,isQuest:NY,isResourceTrackingEnabled:n5,isSafari:UY,isUsingInstancing:pE,isiOS:FY,isiPad:DY,loadSync:e2,logHierarchy:rS,lookAtInverse:P$,lookAtObject:a_,makeId:EY,makeIdFromRandomWords:X4,makeNameSafeForUSD:Ul,markAsInstancedRendered:P5,microphonePermissionsGranted:zY,nameof:wY,nameofFactory:W4,objectSerializer:LQ,offXRSessionEnd:Ene,offXRSessionStart:Cne,onAfterRender:nle,onBeforeRender:BQ,onClear:tle,onDestroy:ile,onInitialized:ele,onStart:YD,onUpdate:KD,onXRSessionEnd:uD,onXRSessionStart:oE,parseSync:L8,placeOnSurface:nH,postprocessFBXMaterials:iD,prefix:rle,pushState:q4,randomNumber:TY,registerBinaryType:mD,registerComponent:yE,registerComponentExtension:AO,registerCustomEffectType:il,registerExportExtensions:bO,registerExtensions:_O,registerHotReloadType:Lfe,registerLoader:_B,registerPrefabProvider:g5,registerPrototypeExtensions:C5,registerType:_re,relativePathPrefix:K4,removeAttributeChangeCallback:Z4,removeComponent:OD,removeCustomImportExtensionType:Mce,removeGltfLoadEventListener:Tfe,removePatch:cie,resolveUrl:zd,sanitizeString:Y4,saveImage:t6,screenshot:tpe,screenshot2:e6,sendDestroyed:MD,serializable:x,serializeObject:_5,serializeable:Cv,setActive:yA,setAllowBalloonMessages:nG,setAllowOverlayMessages:XY,setAutoFitEnabled:YI,setCameraController:qI,setDestroyed:D5,setDevEnvironment:Y$,setDisposable:CD,setDontDestroy:RR,setOrAddParamsToUrl:zI,setParam:CY,setParamWithoutReload:Zw,setPeerOptions:wse,setResourceTrackingEnabled:Wse,setState:bB,setVisibleInCustomShadowRendering:tD,setWorldEuler:$B,setWorldPosition:Os,setWorldPositionXYZ:kp,setWorldQuaternion:Ka,setWorldQuaternionXYZW:KB,setWorldRotation:eD,setWorldRotationXYZ:c_,setWorldScale:Jg,showBalloonError:eE,showBalloonMessage:Pn,showBalloonWarning:Yi,showDebugConsole:nD,slerp:R$,syncDestroy:p_,syncField:$D,syncInstantiate:ID,textureToCanvas:H$,tryCastBinary:nV,tryDetermineFileTypeFromBinary:P8,tryDetermineFileTypeFromURL:R8,tryFindObject:qg,tryGetGuid:sV,unregisterHotReloadType:kfe,unwatchWrite:xB,upload_file:N5,useForAutoFit:KG,validate:Mr,watchWrite:XC},Symbol.toStringTag,{value:"Module"}));/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Un={LEFT:1,RIGHT:2,MIDDLE:4},Ce=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),Wm={NONE:0,IN:1,OUT:-1};function Df(s){return s.isPerspectiveCamera}function Zu(s){return s.isOrthographicCamera}const qm=Math.PI*2,QN=Math.PI/2,a6=1e-5,By=Math.PI/180;function ml(s,e,t){return Math.max(e,Math.min(t,s))}function nn(s,e=a6){return Math.abs(s)<e}function Gi(s,e,t=a6){return nn(s-e,t)}function jN(s,e){return Math.round(s/e)*e}function Dy(s){return isFinite(s)?s:s<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Oy(s){return Math.abs(s)<Number.MAX_VALUE?s:s*(1/0)}function tw(s,e,t,i,n=1/0,r){i=Math.max(1e-4,i);const o=2/i,a=o*r,l=1/(1+a+.48*a*a+.235*a*a*a);let c=s-e;const h=e,d=n*i;c=ml(c,-d,d),e=s-c;const f=(t.value+o*c)*r;t.value=(t.value-o*f)*l;let p=e+(c+f)*l;return h-s>0==p>h&&(p=h,t.value=(p-h)/r),p}function WN(s,e,t,i,n=1/0,r,o){i=Math.max(1e-4,i);const a=2/i,l=a*r,c=1/(1+l+.48*l*l+.235*l*l*l);let h=e.x,d=e.y,f=e.z,p=s.x-h,m=s.y-d,v=s.z-f;const y=h,g=d,_=f,A=n*i,b=A*A,E=p*p+m*m+v*v;if(E>b){const V=Math.sqrt(E);p=p/V*A,m=m/V*A,v=v/V*A}h=s.x-p,d=s.y-m,f=s.z-v;const C=(t.x+a*p)*r,T=(t.y+a*m)*r,M=(t.z+a*v)*r;t.x=(t.x-a*C)*c,t.y=(t.y-a*T)*c,t.z=(t.z-a*M)*c,o.x=h+(p+C)*c,o.y=d+(m+T)*c,o.z=f+(v+M)*c;const R=y-s.x,S=g-s.y,I=_-s.z,L=o.x-y,U=o.y-g,D=o.z-_;return R*L+S*U+I*D>0&&(o.x=y,o.y=g,o.z=_,t.x=(o.x-y)/r,t.y=(o.y-g)/r,t.z=(o.z-_)/r),o}function JM(s,e){e.set(0,0),s.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=s.length,e.y/=s.length}function ZM(s,e){return Zu(s)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class hpe{constructor(){this._listeners={}}addEventListener(e,t){const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const i=this._listeners[e.type];if(i!==void 0){e.target=this;const n=i.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e)}}}var $M;const upe="2.9.0",iw=1/8,dpe=/Mac/.test(($M=globalThis==null?void 0:globalThis.navigator)===null||$M===void 0?void 0:$M.platform);let Jt,qN,nw,eI,Io,ri,Di,Xm,Ly,tc,ic,Of,XN,YN,Da,ky,Ym,KN,tI,JN,iI,nI,sw;class yu extends hpe{static install(e){Jt=e.THREE,qN=Object.freeze(new Jt.Vector3(0,0,0)),nw=Object.freeze(new Jt.Vector3(0,1,0)),eI=Object.freeze(new Jt.Vector3(0,0,1)),Io=new Jt.Vector2,ri=new Jt.Vector3,Di=new Jt.Vector3,Xm=new Jt.Vector3,Ly=new Jt.Vector3,tc=new Jt.Vector3,ic=new Jt.Vector3,Of=new Jt.Vector3,XN=new Jt.Vector3,YN=new Jt.Vector3,Da=new Jt.Spherical,ky=new Jt.Spherical,Ym=new Jt.Box3,KN=new Jt.Box3,tI=new Jt.Sphere,JN=new Jt.Quaternion,iI=new Jt.Quaternion,nI=new Jt.Matrix4,sw=new Jt.Raycaster}static get ACTION(){return Ce}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=Ce.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Wm.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Jt.Vector3,this._focalOffsetVelocity=new Jt.Vector3,this._zoomVelocity={value:0},this._truckInternal=(g,_,A)=>{let b,E;if(Df(this._camera)){const C=ri.copy(this._camera.position).sub(this._target),T=this._camera.getEffectiveFOV()*By,M=C.length()*Math.tan(T*.5);b=this.truckSpeed*g*M/this._elementRect.height,E=this.truckSpeed*_*M/this._elementRect.height}else if(Zu(this._camera)){const C=this._camera;b=g*(C.right-C.left)/C.zoom/this._elementRect.width,E=_*(C.top-C.bottom)/C.zoom/this._elementRect.height}else return;this.verticalDragToForward?(A?this.setFocalOffset(this._focalOffsetEnd.x+b,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(b,0,!0),this.forward(-E,!0)):A?this.setFocalOffset(this._focalOffsetEnd.x+b,this._focalOffsetEnd.y+E,this._focalOffsetEnd.z,!0):this.truck(b,E,!0)},this._rotateInternal=(g,_)=>{const A=qm*this.azimuthRotateSpeed*g/this._elementRect.height,b=qm*this.polarRotateSpeed*_/this._elementRect.height;this.rotate(A,b,!0)},this._dollyInternal=(g,_,A)=>{const b=Math.pow(.95,-g*this.dollySpeed),E=this._sphericalEnd.radius,C=this._sphericalEnd.radius*b,T=ml(C,this.minDistance,this.maxDistance),M=T-C;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(C,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(M,!0),this._dollyToNoClamp(T,!0)):this._dollyToNoClamp(T,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?C:T)-E,this._dollyControlCoord.set(_,A)),this._lastDollyDirection=Math.sign(-g)},this._zoomInternal=(g,_,A)=>{const b=Math.pow(.95,g*this.dollySpeed),E=this._zoom,C=this._zoom*b;this.zoomTo(C,!0),this.dollyToCursor&&(this._changedZoom+=C-E,this._dollyControlCoord.set(_,A))},typeof Jt>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new Jt.Quaternion().setFromUnitVectors(this._camera.up,nw),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=Ce.NONE,this._target=new Jt.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Jt.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new Jt.Spherical().setFromVector3(ri.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Jt.Vector3,new Jt.Vector3,new Jt.Vector3,new Jt.Vector3],this._updateNearPlaneCorners(),this._boundary=new Jt.Box3(new Jt.Vector3(-1/0,-1/0,-1/0),new Jt.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Jt.Vector2,this.mouseButtons={left:Ce.ROTATE,middle:Ce.DOLLY,right:Ce.TRUCK,wheel:Df(this._camera)?Ce.DOLLY:Zu(this._camera)?Ce.ZOOM:Ce.NONE},this.touches={one:Ce.TOUCH_ROTATE,two:Df(this._camera)?Ce.TOUCH_DOLLY_TRUCK:Zu(this._camera)?Ce.TOUCH_ZOOM_TRUCK:Ce.NONE,three:Ce.TOUCH_TRUCK};const i=new Jt.Vector2,n=new Jt.Vector2,r=new Jt.Vector2,o=g=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const b=this._domElement.getBoundingClientRect(),E=g.clientX/b.width,C=g.clientY/b.height;if(E<this._interactiveArea.left||E>this._interactiveArea.right||C<this._interactiveArea.top||C>this._interactiveArea.bottom)return}const _=g.pointerType!=="mouse"?null:(g.buttons&Un.LEFT)===Un.LEFT?Un.LEFT:(g.buttons&Un.MIDDLE)===Un.MIDDLE?Un.MIDDLE:(g.buttons&Un.RIGHT)===Un.RIGHT?Un.RIGHT:null;if(_!==null){const b=this._findPointerByMouseButton(_);b&&this._disposePointer(b)}if((g.buttons&Un.LEFT)===Un.LEFT&&this._lockedPointer)return;const A={pointerId:g.pointerId,clientX:g.clientX,clientY:g.clientY,deltaX:0,deltaY:0,mouseButton:_};this._activePointers.push(A),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,f(g)},a=g=>{g.cancelable&&g.preventDefault();const _=g.pointerId,A=this._lockedPointer||this._findPointerById(_);if(A){if(A.clientX=g.clientX,A.clientY=g.clientY,A.deltaX=g.movementX,A.deltaY=g.movementY,this._state=0,g.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(g.buttons&Un.LEFT)===Un.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(g.buttons&Un.MIDDLE)===Un.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(g.buttons&Un.RIGHT)===Un.RIGHT&&(this._state=this._state|this.mouseButtons.right);p()}},l=g=>{const _=this._findPointerById(g.pointerId);if(!(_&&_===this._lockedPointer)){if(_&&this._disposePointer(_),g.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=Ce.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=Ce.NONE;m()}};let c=-1;const h=g=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===Ce.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const C=this._domElement.getBoundingClientRect(),T=g.clientX/C.width,M=g.clientY/C.height;if(T<this._interactiveArea.left||T>this._interactiveArea.right||M<this._interactiveArea.top||M>this._interactiveArea.bottom)return}if(g.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===Ce.ROTATE||this.mouseButtons.wheel===Ce.TRUCK){const C=performance.now();c-C<1e3&&this._getClientRect(this._elementRect),c=C}const _=dpe?-1:-3,A=g.deltaMode===1?g.deltaY/_:g.deltaY/(_*10),b=this.dollyToCursor?(g.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,E=this.dollyToCursor?(g.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case Ce.ROTATE:{this._rotateInternal(g.deltaX,g.deltaY),this._isUserControllingRotate=!0;break}case Ce.TRUCK:{this._truckInternal(g.deltaX,g.deltaY,!1),this._isUserControllingTruck=!0;break}case Ce.OFFSET:{this._truckInternal(g.deltaX,g.deltaY,!0),this._isUserControllingOffset=!0;break}case Ce.DOLLY:{this._dollyInternal(-A,b,E),this._isUserControllingDolly=!0;break}case Ce.ZOOM:{this._zoomInternal(-A,b,E),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},d=g=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===yu.ACTION.NONE){const _=g instanceof PointerEvent?g.pointerId:0,A=this._findPointerById(_);A&&this._disposePointer(A),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}g.preventDefault()}},f=g=>{if(!this._enabled)return;if(JM(this._activePointers,Io),this._getClientRect(this._elementRect),i.copy(Io),n.copy(Io),this._activePointers.length>=2){const A=Io.x-this._activePointers[1].clientX,b=Io.y-this._activePointers[1].clientY,E=Math.sqrt(A*A+b*b);r.set(0,E);const C=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,T=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;n.set(C,T)}if(this._state=0,!g)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in g&&g.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(g.buttons&Un.LEFT)===Un.LEFT&&(this._state=this._state|this.mouseButtons.left),(g.buttons&Un.MIDDLE)===Un.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(g.buttons&Un.RIGHT)===Un.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&Ce.ROTATE)===Ce.ROTATE||(this._state&Ce.TOUCH_ROTATE)===Ce.TOUCH_ROTATE||(this._state&Ce.TOUCH_DOLLY_ROTATE)===Ce.TOUCH_DOLLY_ROTATE||(this._state&Ce.TOUCH_ZOOM_ROTATE)===Ce.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&Ce.TRUCK)===Ce.TRUCK||(this._state&Ce.TOUCH_TRUCK)===Ce.TOUCH_TRUCK||(this._state&Ce.TOUCH_DOLLY_TRUCK)===Ce.TOUCH_DOLLY_TRUCK||(this._state&Ce.TOUCH_ZOOM_TRUCK)===Ce.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&Ce.DOLLY)===Ce.DOLLY||(this._state&Ce.TOUCH_DOLLY)===Ce.TOUCH_DOLLY||(this._state&Ce.TOUCH_DOLLY_TRUCK)===Ce.TOUCH_DOLLY_TRUCK||(this._state&Ce.TOUCH_DOLLY_OFFSET)===Ce.TOUCH_DOLLY_OFFSET||(this._state&Ce.TOUCH_DOLLY_ROTATE)===Ce.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&Ce.ZOOM)===Ce.ZOOM||(this._state&Ce.TOUCH_ZOOM)===Ce.TOUCH_ZOOM||(this._state&Ce.TOUCH_ZOOM_TRUCK)===Ce.TOUCH_ZOOM_TRUCK||(this._state&Ce.TOUCH_ZOOM_OFFSET)===Ce.TOUCH_ZOOM_OFFSET||(this._state&Ce.TOUCH_ZOOM_ROTATE)===Ce.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&Ce.OFFSET)===Ce.OFFSET||(this._state&Ce.TOUCH_OFFSET)===Ce.TOUCH_OFFSET||(this._state&Ce.TOUCH_DOLLY_OFFSET)===Ce.TOUCH_DOLLY_OFFSET||(this._state&Ce.TOUCH_ZOOM_OFFSET)===Ce.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},p=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,JM(this._activePointers,Io);const _=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,A=_?-_.deltaX:n.x-Io.x,b=_?-_.deltaY:n.y-Io.y;if(n.copy(Io),((this._state&Ce.ROTATE)===Ce.ROTATE||(this._state&Ce.TOUCH_ROTATE)===Ce.TOUCH_ROTATE||(this._state&Ce.TOUCH_DOLLY_ROTATE)===Ce.TOUCH_DOLLY_ROTATE||(this._state&Ce.TOUCH_ZOOM_ROTATE)===Ce.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(A,b),this._isUserControllingRotate=!0),(this._state&Ce.DOLLY)===Ce.DOLLY||(this._state&Ce.ZOOM)===Ce.ZOOM){const E=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,C=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0,T=this.dollyDragInverted?-1:1;(this._state&Ce.DOLLY)===Ce.DOLLY?(this._dollyInternal(T*b*iw,E,C),this._isUserControllingDolly=!0):(this._zoomInternal(T*b*iw,E,C),this._isUserControllingZoom=!0)}if((this._state&Ce.TOUCH_DOLLY)===Ce.TOUCH_DOLLY||(this._state&Ce.TOUCH_ZOOM)===Ce.TOUCH_ZOOM||(this._state&Ce.TOUCH_DOLLY_TRUCK)===Ce.TOUCH_DOLLY_TRUCK||(this._state&Ce.TOUCH_ZOOM_TRUCK)===Ce.TOUCH_ZOOM_TRUCK||(this._state&Ce.TOUCH_DOLLY_OFFSET)===Ce.TOUCH_DOLLY_OFFSET||(this._state&Ce.TOUCH_ZOOM_OFFSET)===Ce.TOUCH_ZOOM_OFFSET||(this._state&Ce.TOUCH_DOLLY_ROTATE)===Ce.TOUCH_DOLLY_ROTATE||(this._state&Ce.TOUCH_ZOOM_ROTATE)===Ce.TOUCH_ZOOM_ROTATE){const E=Io.x-this._activePointers[1].clientX,C=Io.y-this._activePointers[1].clientY,T=Math.sqrt(E*E+C*C),M=r.y-T;r.set(0,T);const R=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,S=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&Ce.TOUCH_DOLLY)===Ce.TOUCH_DOLLY||(this._state&Ce.TOUCH_DOLLY_ROTATE)===Ce.TOUCH_DOLLY_ROTATE||(this._state&Ce.TOUCH_DOLLY_TRUCK)===Ce.TOUCH_DOLLY_TRUCK||(this._state&Ce.TOUCH_DOLLY_OFFSET)===Ce.TOUCH_DOLLY_OFFSET?(this._dollyInternal(M*iw,R,S),this._isUserControllingDolly=!0):(this._zoomInternal(M*iw,R,S),this._isUserControllingZoom=!0)}((this._state&Ce.TRUCK)===Ce.TRUCK||(this._state&Ce.TOUCH_TRUCK)===Ce.TOUCH_TRUCK||(this._state&Ce.TOUCH_DOLLY_TRUCK)===Ce.TOUCH_DOLLY_TRUCK||(this._state&Ce.TOUCH_ZOOM_TRUCK)===Ce.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(A,b,!1),this._isUserControllingTruck=!0),((this._state&Ce.OFFSET)===Ce.OFFSET||(this._state&Ce.TOUCH_OFFSET)===Ce.TOUCH_OFFSET||(this._state&Ce.TOUCH_DOLLY_OFFSET)===Ce.TOUCH_DOLLY_OFFSET||(this._state&Ce.TOUCH_ZOOM_OFFSET)===Ce.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(A,b,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},m=()=>{JM(this._activePointers,Io),n.copy(Io),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",v),this._domElement.ownerDocument.addEventListener("pointerlockerror",y),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),f())},this.unlockPointer=()=>{var g,_,A;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(g=this._domElement)===null||g===void 0||g.ownerDocument.exitPointerLock(),(_=this._domElement)===null||_===void 0||_.ownerDocument.removeEventListener("pointerlockchange",v),(A=this._domElement)===null||A===void 0||A.ownerDocument.removeEventListener("pointerlockerror",y),this.cancel()};const v=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},y=()=>{this.unlockPointer()};this._addAllEventListeners=g=>{this._domElement=g,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",h,{passive:!1}),this._domElement.addEventListener("contextmenu",d)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",h,{passive:!1}),this._domElement.removeEventListener("contextmenu",d),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement.ownerDocument.removeEventListener("pointerlockerror",y))},this.cancel=()=>{this._state!==Ce.NONE&&(this._state=Ce.NONE,this._activePointers.length=0,m())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=ml(e.width,0,1),this._interactiveArea.height=ml(e.height,0,1),this._interactiveArea.x=ml(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=ml(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,i=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,i)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,i=!1){this._isUserControllingRotate=!1;const n=ml(e,this.minAzimuthAngle,this.maxAzimuthAngle),r=ml(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=n,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!i||Gi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Gi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Wm.NONE,this._changedDolly=0,this._dollyToNoClamp(ml(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),a=Gi(o,this._spherical.radius);if(!(i>e)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,o)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const r=!t||Gi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(r)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(Ly).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const i=!t||Gi(this._target.x,this._targetEnd.x,this.restThreshold)&&Gi(this._target.y,this._targetEnd.y,this.restThreshold)&&Gi(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=ml(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const i=!t||Gi(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(e,t,i=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,i)}truck(e,t,i=!1){this._camera.updateMatrix(),tc.setFromMatrixColumn(this._camera.matrix,0),ic.setFromMatrixColumn(this._camera.matrix,1),tc.multiplyScalar(e),ic.multiplyScalar(-t);const n=ri.copy(tc).add(ic),r=Di.copy(this._targetEnd).add(n);return this.moveTo(r.x,r.y,r.z,i)}forward(e,t=!1){ri.setFromMatrixColumn(this._camera.matrix,0),ri.crossVectors(this._camera.up,ri),ri.multiplyScalar(e);const i=Di.copy(this._targetEnd).add(ri);return this.moveTo(i.x,i.y,i.z,t)}elevate(e,t=!1){return ri.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+ri.x,this._targetEnd.y+ri.y,this._targetEnd.z+ri.z,t)}moveTo(e,t,i,n=!1){this._isUserControllingTruck=!1;const r=ri.set(e,t,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,n||this._target.copy(this._targetEnd);const o=!n||Gi(this._target.x,this._targetEnd.x,this.restThreshold)&&Gi(this._target.y,this._targetEnd.y,this.restThreshold)&&Gi(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,t,i,n=!1){const a=ri.set(e,t,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(a.x,a.y,a.z,n)}fitToBox(e,t,{cover:i=!1,paddingLeft:n=0,paddingRight:r=0,paddingBottom:o=0,paddingTop:a=0}={}){const l=[],c=e.isBox3?Ym.copy(e):Ym.setFromObject(e);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const h=jN(this._sphericalEnd.theta,QN),d=jN(this._sphericalEnd.phi,QN);l.push(this.rotateTo(h,d,t));const f=ri.setFromSpherical(this._sphericalEnd).normalize(),p=JN.setFromUnitVectors(f,eI),m=Gi(Math.abs(f.y),1);m&&p.multiply(iI.setFromAxisAngle(nw,h)),p.multiply(this._yAxisUpSpaceInverse);const v=KN.makeEmpty();Di.copy(c.min).applyQuaternion(p),v.expandByPoint(Di),Di.copy(c.min).setX(c.max.x).applyQuaternion(p),v.expandByPoint(Di),Di.copy(c.min).setY(c.max.y).applyQuaternion(p),v.expandByPoint(Di),Di.copy(c.max).setZ(c.min.z).applyQuaternion(p),v.expandByPoint(Di),Di.copy(c.min).setZ(c.max.z).applyQuaternion(p),v.expandByPoint(Di),Di.copy(c.max).setY(c.min.y).applyQuaternion(p),v.expandByPoint(Di),Di.copy(c.max).setX(c.min.x).applyQuaternion(p),v.expandByPoint(Di),Di.copy(c.max).applyQuaternion(p),v.expandByPoint(Di),v.min.x-=n,v.min.y-=o,v.max.x+=r,v.max.y+=a,p.setFromUnitVectors(eI,f),m&&p.premultiply(iI.invert()),p.premultiply(this._yAxisUpSpace);const y=v.getSize(ri),g=v.getCenter(Di).applyQuaternion(p);if(Df(this._camera)){const _=this.getDistanceToFitBox(y.x,y.y,y.z,i);l.push(this.moveTo(g.x,g.y,g.z,t)),l.push(this.dollyTo(_,t)),l.push(this.setFocalOffset(0,0,0,t))}else if(Zu(this._camera)){const _=this._camera,A=_.right-_.left,b=_.top-_.bottom,E=i?Math.max(A/y.x,b/y.y):Math.min(A/y.x,b/y.y);l.push(this.moveTo(g.x,g.y,g.z,t)),l.push(this.zoomTo(E,t)),l.push(this.setFocalOffset(0,0,0,t))}return Promise.all(l)}fitToSphere(e,t){const i=[],r="isObject3D"in e?yu.createBoundingSphere(e,tI):tI.copy(e);if(i.push(this.moveTo(r.center.x,r.center.y,r.center.z,t)),Df(this._camera)){const o=this.getDistanceToFitSphere(r.radius);i.push(this.dollyTo(o,t))}else if(Zu(this._camera)){const o=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,l=2*r.radius,c=Math.min(o/l,a/l);i.push(this.zoomTo(c,t))}return i.push(this.setFocalOffset(0,0,0,t)),Promise.all(i)}setLookAt(e,t,i,n,r,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Wm.NONE,this._changedDolly=0;const l=Di.set(n,r,o),c=ri.set(e,t,i);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(c.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const h=!a||Gi(this._target.x,this._targetEnd.x,this.restThreshold)&&Gi(this._target.y,this._targetEnd.y,this.restThreshold)&&Gi(this._target.z,this._targetEnd.z,this.restThreshold)&&Gi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Gi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Gi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(h)}lerpLookAt(e,t,i,n,r,o,a,l,c,h,d,f,p,m=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Wm.NONE,this._changedDolly=0;const v=ri.set(n,r,o),y=Di.set(e,t,i);Da.setFromVector3(y.sub(v).applyQuaternion(this._yAxisUpSpace));const g=Xm.set(h,d,f),_=Di.set(a,l,c);ky.setFromVector3(_.sub(g).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(v.lerp(g,p));const A=ky.theta-Da.theta,b=ky.phi-Da.phi,E=ky.radius-Da.radius;this._sphericalEnd.set(Da.radius+E*p,Da.phi+b*p,Da.theta+A*p),this.normalizeRotations(),this._needsUpdate=!0,m||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const C=!m||Gi(this._target.x,this._targetEnd.x,this.restThreshold)&&Gi(this._target.y,this._targetEnd.y,this.restThreshold)&&Gi(this._target.z,this._targetEnd.z,this.restThreshold)&&Gi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Gi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Gi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(C)}setPosition(e,t,i,n=!1){return this.setLookAt(e,t,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n)}setTarget(e,t,i,n=!1){const r=this.getPosition(ri),o=this.setLookAt(r.x,r.y,r.z,e,t,i,n);return this._sphericalEnd.phi=ml(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,t,i,n=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,i),this._needsUpdate=!0,n||this._focalOffset.copy(this._focalOffsetEnd);const r=!n||Gi(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Gi(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Gi(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(e,t,i){this._camera.updateMatrixWorld(),tc.setFromMatrixColumn(this._camera.matrixWorldInverse,0),ic.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Of.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const n=ri.set(e,t,i),r=n.distanceTo(this._camera.position),o=n.sub(this._camera.position);tc.multiplyScalar(o.x),ic.multiplyScalar(o.y),Of.multiplyScalar(o.z),ri.copy(tc).add(ic).add(Of),ri.z=ri.z+r,this.dollyTo(r,!1),this.setFocalOffset(-ri.x,ri.y,-ri.z,!1),this.moveTo(e,t,i,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,i,n){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new Jt.Vector4,typeof e=="number"?this._viewport.set(e,t,i,n):this._viewport.copy(e)}getDistanceToFitBox(e,t,i,n=!1){if(ZM(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const r=e/t,o=this._camera.getEffectiveFOV()*By,a=this._camera.aspect;return((n?r>a:r<a)?t:e/a)*.5/Math.tan(o*.5)+i*.5}getDistanceToFitSphere(e){if(ZM(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*By,i=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,n=1<this._camera.aspect?t:i;return e/Math.sin(n*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new Jt.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new Jt.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new Jt.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new Jt.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%qm,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=qm),this._spherical.theta+=qm*Math.round((this._sphericalEnd.theta-this._spherical.theta)/qm)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!Gi(this._camera.up.x,this._cameraUp0.x)||!Gi(this._camera.up.y,this._cameraUp0.y)||!Gi(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const i=this.getPosition(ri);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,nw),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=ri.subVectors(this._target,this._camera.position).normalize(),t=Di.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const i=this.getPosition(ri);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,r=XN.subVectors(this._targetEnd,this._target),o=YN.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(nn(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const d=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=tw(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,d,1/0,e),this._needsUpdate=!0}if(nn(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const d=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=tw(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,d,1/0,e),this._needsUpdate=!0}if(nn(n))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const d=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=tw(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,d,this.maxSpeed,e),this._needsUpdate=!0}if(nn(r.x)&&nn(r.y)&&nn(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const d=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;WN(this._target,this._targetEnd,this._targetVelocity,d,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(nn(o.x)&&nn(o.y)&&nn(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const d=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;WN(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,d,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(nn(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const d=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=tw(this._zoom,this._zoomEnd,this._zoomVelocity,d,1/0,e)}if(this.dollyToCursor){if(Df(this._camera)&&this._changedDolly!==0){const d=this._spherical.radius-this._lastDistance,f=this._camera,p=this._getCameraDirection(Ly),m=ri.copy(p).cross(f.up).normalize();m.lengthSq()===0&&(m.x=1);const v=Di.crossVectors(m,p),y=this._sphericalEnd.radius*Math.tan(f.getEffectiveFOV()*By*.5),_=(this._sphericalEnd.radius-d-this._sphericalEnd.radius)/this._sphericalEnd.radius,A=Xm.copy(this._targetEnd).add(m.multiplyScalar(this._dollyControlCoord.x*y*f.aspect)).add(v.multiplyScalar(this._dollyControlCoord.y*y)),b=ri.copy(this._targetEnd).lerp(A,_),E=this._lastDollyDirection===Wm.IN&&this._spherical.radius<=this.minDistance,C=this._lastDollyDirection===Wm.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(E||C)){this._sphericalEnd.radius-=d,this._spherical.radius-=d;const M=Di.copy(p).multiplyScalar(-d);b.add(M)}this._boundary.clampPoint(b,b);const T=Di.subVectors(b,this._targetEnd);this._targetEnd.copy(b),this._target.add(T),this._changedDolly-=d,nn(this._changedDolly)&&(this._changedDolly=0)}else if(Zu(this._camera)&&this._changedZoom!==0){const d=this._zoom-this._lastZoom,f=this._camera,p=ri.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(f.near+f.far)/(f.near-f.far)).unproject(f),m=Di.set(0,0,-1).applyQuaternion(f.quaternion),v=Xm.copy(p).add(m.multiplyScalar(-p.dot(f.up))),g=-(this._zoom-d-this._zoom)/this._zoom,_=this._getCameraDirection(Ly),A=this._targetEnd.dot(_),b=ri.copy(this._targetEnd).lerp(v,g),E=b.dot(_),C=_.multiplyScalar(E-A);b.sub(C),this._boundary.clampPoint(b,b);const T=Di.subVectors(b,this._targetEnd);this._targetEnd.copy(b),this._target.add(T),this._changedZoom-=d,nn(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!nn(this._focalOffset.x)||!nn(this._focalOffset.y)||!nn(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),tc.setFromMatrixColumn(this._camera.matrix,0),ic.setFromMatrixColumn(this._camera.matrix,1),Of.setFromMatrixColumn(this._camera.matrix,2),tc.multiplyScalar(this._focalOffset.x),ic.multiplyScalar(-this._focalOffset.y),Of.multiplyScalar(this._focalOffset.z),ri.copy(tc).add(ic).add(Of),this._camera.position.add(ri)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),ri.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const h=this._needsUpdate;return h&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):h?(this.dispatchEvent({type:"update"}),nn(t,this.restThreshold)&&nn(i,this.restThreshold)&&nn(n,this.restThreshold)&&nn(r.x,this.restThreshold)&&nn(r.y,this.restThreshold)&&nn(r.z,this.restThreshold)&&nn(o.x,this.restThreshold)&&nn(o.y,this.restThreshold)&&nn(o.z,this.restThreshold)&&nn(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!h&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=h,this._needsUpdate=!1,h}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Dy(this.maxDistance),minZoom:this.minZoom,maxZoom:Dy(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Dy(this.maxPolarAngle),minAzimuthAngle:Dy(this.minAzimuthAngle),maxAzimuthAngle:Dy(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:ri.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const i=JSON.parse(e);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=Oy(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=Oy(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=Oy(i.maxPolarAngle),this.minAzimuthAngle=Oy(i.minAzimuthAngle),this.maxAzimuthAngle=Oy(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this.verticalDragToForward=i.verticalDragToForward,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],t),Da.setFromVector3(ri.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Da.theta,Da.phi,t),this.dollyTo(Da.radius,t),this.zoomTo(i.zoom,t),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",upe),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,i){const n=t.lengthSq();if(n===0)return e;const r=Di.copy(t).add(e),a=this._boundary.clampPoint(r,Xm).sub(r),l=a.lengthSq();if(l===0)return e.add(t);if(l===n)return e;if(i===0)return e.add(t).add(a);{const c=1+i*l/t.dot(a);return e.add(Di.copy(t).multiplyScalar(c)).add(a.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(Df(this._camera)){const e=this._camera,t=e.near,i=e.getEffectiveFOV()*By,n=Math.tan(i*.5)*t,r=n*e.aspect;this._nearPlaneCorners[0].set(-r,-n,0),this._nearPlaneCorners[1].set(r,-n,0),this._nearPlaneCorners[2].set(r,n,0),this._nearPlaneCorners[3].set(-r,n,0)}else if(Zu(this._camera)){const e=this._camera,t=1/e.zoom,i=e.left*t,n=e.right*t,r=e.top*t,o=e.bottom*t;this._nearPlaneCorners[0].set(i,r,0),this._nearPlaneCorners[1].set(n,r,0),this._nearPlaneCorners[2].set(n,o,0),this._nearPlaneCorners[3].set(i,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||ZM(this._camera,"_collisionTest"))return e;const i=this._getTargetDirection(Ly);nI.lookAt(qN,i,this._camera.up);for(let n=0;n<4;n++){const r=Di.copy(this._nearPlaneCorners[n]);r.applyMatrix4(nI);const o=Xm.addVectors(this._target,r);sw.set(o,i),sw.far=this._spherical.radius+1;const a=sw.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const i=()=>{this.removeEventListener("rest",i),t()};this.addEventListener("rest",i)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new Jt.Sphere){const i=t,n=i.center;Ym.makeEmpty(),e.traverseVisible(o=>{o.isMesh&&Ym.expandByObject(o)}),Ym.getCenter(n);let r=0;return e.traverseVisible(o=>{if(!o.isMesh)return;const a=o,l=a.geometry.clone();l.applyMatrix4(a.matrixWorld);const h=l.attributes.position;for(let d=0,f=h.count;d<f;d++)ri.fromBufferAttribute(h,d),r=Math.max(r,n.distanceToSquared(ri))}),i.radius=Math.sqrt(r),i}}yu.install({THREE:AB});class fpe extends Te{constructor(){super(...arguments);u(this,"_cameraControls")}onEnable(){if(!this._cameraControls){const t=this.gameObject.getComponent(Mi);if(!t){console.warn("CameraControlsSample requires a camera to be attached to the same game object");return}this._cameraControls=new yu(t.cam,this.context.domElement),this._cameraControls.touches.two=yu.ACTION.TOUCH_ZOOM_TRUCK,this._cameraControls.maxPolarAngle=li.degToRad(50),this._cameraControls.maxDistance=100,this._cameraControls.minDistance=10;const i=new le(new Xi(5,5,5),new Kt({color:65280,wireframe:!0}));this.scene.add(i),i.visible=!1;const n=new le(new Wo(.05),new Kt({color:16776960}));this.scene.add(n);const r=new Av(25,25);r.position.y=-1,this.scene.add(r);const o=new Si(new w(-75,20,-75),new w(75,20,75));this._cameraControls.setBoundary(o),i.position.set(0,0,0),i.scale.set(10,10,10),i.visible=!1}}onBeforeRender(){this._cameraControls&&(this.onHandleInput(),this._cameraControls.update(this.context.time.deltaTime))}onHandleInput(){if(!this._cameraControls)return;const t=this.context.time.deltaTime*5;this.context.input.isKeyPressed("KeyW")?this._cameraControls.dolly(1*t):this.context.input.isKeyPressed("KeyS")&&this._cameraControls.dolly(-1*t),this.context.input.isKeyPressed("KeyA")?this._cameraControls.truck(-1*t,0,!1):this.context.input.isKeyPressed("KeyD")&&this._cameraControls.truck(1*t,0,!1)}}yu.install({THREE:AB});class ppe extends Te{constructor(){super(...arguments);u(this,"_cameraControls")}onEnable(){if(!this._cameraControls){const t=this.gameObject.getComponent(Mi);if(!t){console.warn("CameraControlsSample requires a camera to be attached to the same game object");return}this._cameraControls=new yu(t.cam,this.context.domElement),this._cameraControls.touches.two=yu.ACTION.TOUCH_ZOOM_TRUCK,this._cameraControls.maxPolarAngle=li.degToRad(60),this._cameraControls.maxDistance=1e5,this._cameraControls.minDistance=1e4;const i=new le(new Xi(5e4,5e4,5e4),new Kt({color:65280,wireframe:!0}));this.scene.add(i),i.visible=!1;const n=new le(new Wo(.05),new Kt({color:16776960}));this.scene.add(n);const r=new Av(25,25);r.position.y=-1,this.scene.add(r);const o=new Si(new w(-1e4,5e3,-1e4),new w(1e4,5e3,1e4));this._cameraControls.setBoundary(o),i.position.set(0,0,0),i.scale.set(10,10,10),i.visible=!1}}onBeforeRender(){this._cameraControls&&(this.onHandleInput(),this._cameraControls.update(this.context.time.deltaTime))}onHandleInput(){if(!this._cameraControls)return;const t=this.context.time.deltaTime*5;this.context.input.isKeyPressed("KeyW")?this._cameraControls.dolly(1*t):this.context.input.isKeyPressed("KeyS")&&this._cameraControls.dolly(-1*t),this.context.input.isKeyPressed("KeyA")?this._cameraControls.truck(-1*t,0,!1):this.context.input.isKeyPressed("KeyD")&&this._cameraControls.truck(1*t,0,!1)}}const l6={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class mpe extends Y_{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof Rt?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=fu.clone(e.uniforms),this.material=new Rt({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new _8(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class ZN extends Y_{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const n=e.getContext(),r=e.state;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),r.buffers.stencil.setFunc(n.ALWAYS,o,4294967295),r.buffers.stencil.setClear(a),r.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.color.setMask(!0),r.buffers.depth.setMask(!0),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(n.EQUAL,1,4294967295),r.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),r.buffers.stencil.setLocked(!0)}}class gpe extends Y_{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class vpe{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const i=e.getSize(new Z);this._width=i.width,this._height=i.height,t=new Yt(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:$i}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new mpe(l6),this.copyPass.material.blending=An,this.clock=new i_}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let n=0,r=this.passes.length;n<r;n++){const o=this.passes[n];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),o.needsSwap){if(i){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}ZN!==void 0&&(o instanceof ZN?i=!0:o instanceof gpe&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Z);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(i,n),this.renderTarget2.setSize(i,n);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(i,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class ype extends Y_{constructor(e,t,i=null,n=null,r=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=n,this.clearAlpha=r,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new me}render(e,t,i){const n=e.autoClear;e.autoClear=!1;let r,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),this.clearAlpha!==null&&(r=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(r),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=n}}const Ape={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new me(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			vec3 luma = vec3( 0.299, 0.587, 0.114 );

			float v = dot( texel.xyz, luma );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`};class hv extends Y_{constructor(e,t,i,n){super(),this.strength=t!==void 0?t:1,this.radius=i,this.threshold=n,this.resolution=e!==void 0?new Z(e.x,e.y):new Z(256,256),this.clearColor=new me(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let r=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);this.renderTargetBright=new Yt(r,o,{type:$i}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let d=0;d<this.nMips;d++){const f=new Yt(r,o,{type:$i});f.texture.name="UnrealBloomPass.h"+d,f.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(f);const p=new Yt(r,o,{type:$i});p.texture.name="UnrealBloomPass.v"+d,p.texture.generateMipmaps=!1,this.renderTargetsVertical.push(p),r=Math.round(r/2),o=Math.round(o/2)}const a=Ape;this.highPassUniforms=fu.clone(a.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new Rt({uniforms:this.highPassUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.separableBlurMaterials=[];const l=[3,5,7,9,11];r=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);for(let d=0;d<this.nMips;d++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(l[d])),this.separableBlurMaterials[d].uniforms.invSize.value=new Z(1/r,1/o),r=Math.round(r/2),o=Math.round(o/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1;const c=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=c,this.bloomTintColors=[new w(1,1,1),new w(1,1,1),new w(1,1,1),new w(1,1,1),new w(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const h=l6;this.copyUniforms=fu.clone(h.uniforms),this.blendMaterial=new Rt({uniforms:this.copyUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,blending:Ed,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new me,this.oldClearAlpha=1,this.basic=new Kt,this.fsQuad=new _8(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let i=Math.round(e/2),n=Math.round(t/2);this.renderTargetBright.setSize(i,n);for(let r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(i,n),this.renderTargetsVertical[r].setSize(i,n),this.separableBlurMaterials[r].uniforms.invSize.value=new Z(1/i,1/n),i=Math.round(i/2),n=Math.round(n/2)}render(e,t,i,n,r){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),r&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=i.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let a=this.renderTargetBright;for(let l=0;l<this.nMips;l++)this.fsQuad.material=this.separableBlurMaterials[l],this.separableBlurMaterials[l].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[l].uniforms.direction.value=hv.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[l]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[l].uniforms.colorTexture.value=this.renderTargetsHorizontal[l].texture,this.separableBlurMaterials[l].uniforms.direction.value=hv.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[l]),e.clear(),this.fsQuad.render(e),a=this.renderTargetsVertical[l];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,r&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o}getSeperableBlurMaterial(e){const t=[];for(let i=0;i<e;i++)t.push(.39894*Math.exp(-.5*i*i/(e*e))/e);return new Rt({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new Z(.5,.5)},direction:{value:new Z(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 invSize;
				uniform vec2 direction;
				uniform float gaussianCoefficients[KERNEL_RADIUS];

				void main() {
					float weightSum = gaussianCoefficients[0];
					vec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianCoefficients[i];
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new Rt({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}}hv.BlurDirectionX=new Z(1,0);hv.BlurDirectionY=new Z(0,1);class _pe extends Te{constructor(){super(...arguments);u(this,"params",{exposure:1,bloomStrength:1.5,bloomThreshold:0,bloomRadius:0});u(this,"mainComposer");u(this,"renderer")}start(){var n,r;const t=new hv(new THREE.Vector2(window.innerWidth,window.innerHeight),1.5,.4,.85);t.threshold=this.params.bloomThreshold,t.strength=this.params.bloomStrength,t.radius=this.params.bloomRadius,this.mainComposer=new vpe(this.context.renderer);const i=new ype(this.scene,this.context.mainCamera);this.renderer=new eh({antialias:!0}),(n=this.renderer)==null||n.setSize(this.context.domWidth,this.context.domHeight),this.mainComposer.addPass(i),(r=this.mainComposer)==null||r.addPass(t),this.mainComposer.setSize(this.context.domWidth,this.context.domHeight),this.context.composer=this.mainComposer}}X.add("CameraControlsSample",fpe);X.add("CC",ppe);X.add("PostProcessing",_pe);jc(()=>Promise.resolve().then(()=>cpe),void 0,import.meta.url);export{Ho as A,pt as B,cB as C,Go as D,Rd as E,vn as F,vs as G,IP as I,hn as L,Kt as M,ei as N,ge as O,Ar as P,qc as Q,jo as R,xz as S,mo as T,El as U,w as V,ot as a,Si as b,le as c,fe as d,Ri as e,pC as f,bz as g,Ti as h,OP as i,ld as j,Tl as k,DP as l,BP as m,Ht as n,Je as o,Z as p,WC as q,_n as r,Gn as s,Pi as t,As as u,Xt as v,ga as w,Id as x,Ip as y,pu as z};
